/*! @maps4html/mapml 05-09-2024 */

!function(){"use strict";function t(t){return new s(t)}function e(t,e){return new l(t,e)}function i(t,e){return new h(t,e)}function o(t,e){return new c(t,e)}function n(t){return new u(t)}function a(t,e){return new m(t,e)}function r(t,e){return new d(t,e)}var s=L.GridLayer.extend({initialize:function(t){L.setOptions(this,t),this.zoomBounds=this._getZoomBounds(t.tileContainer,t.maxZoomBound),L.extend(this.options,this.zoomBounds),this._groups=this._groupTiles(this.options.tileContainer.getElementsByTagName("map-tile")),this._bounds=this._getLayerBounds(this._groups,this.options.projection),this.layerBounds=this._bounds[Object.keys(this._bounds)[0]];for(var e of Object.keys(this._bounds))this.layerBounds.extend(this._bounds[e].min),this.layerBounds.extend(this._bounds[e].max)},onAdd:function(t){this._map=t,L.GridLayer.prototype.onAdd.call(this,this._map),this._handleMoveEnd()},getEvents:function(){let t=L.GridLayer.prototype.getEvents.call(this,this._map);return this._parentOnMoveEnd=t.moveend,t.moveend=this._handleMoveEnd,t.move=()=>{},t},isVisible:function(){var t=this._map.getZoom();let e=t;return e=e>this.options.maxNativeZoom?this.options.maxNativeZoom:e,e=e<this.options.minNativeZoom?this.options.minNativeZoom:e,t<=this.zoomBounds.maxZoom&&t>=this.zoomBounds.minZoom&&this._bounds[e]&&this._bounds[e].overlaps(M.pixelToPCRSBounds(this._map.getPixelBounds(),this._map.getZoom(),this._map.options.projection))},_handleMoveEnd:function(t){this.isVisible()&&this._parentOnMoveEnd()},_isValidTile(t){return this._groups[this._tileCoordsToKey(t)]},createTile:function(t){let i=this._groups[this._tileCoordsToKey(t)]||[],o=document.createElement("map-tile"),n=this.getTileSize();o.setAttribute("col",t.x),o.setAttribute("row",t.y),o.setAttribute("zoom",t.z);for(let e=0;e<i.length;e++){let t=document.createElement("img");t.width=n.x,t.height=n.y,t.alt="",t.setAttribute("role","presentation"),t.src=i[e].src,o.appendChild(t)}return o},_getLayerBounds:function(t,e){let i={},o=M[e].options.crs.tile.bounds.max.x;for(var n in t){let t=n.split(":"),e={};e.x=+t[0]*o,e.y=+t[1]*o,e.z=+t[2],t[2]in i?(i[t[2]].extend(L.point(e.x,e.y)),i[t[2]].extend(L.point(e.x+o,e.y+o))):i[t[2]]=L.bounds(L.point(e.x,e.y),L.point(e.x+o,e.y+o))}for(var a in i){var r=+a;i[a]=M.pixelToPCRSBounds(i[a],r,e)}return i},_getZoomBounds:function(t,e){if(!t)return null;let i=M._metaContentToObject(this.options._leafletLayer._layerEl.querySelector("map-meta[name=zoom]").getAttribute("content")),o={},n=t.getElementsByTagName("map-tile");o.nativeZoom=+i.value||0,o.maxNativeZoom=0,o.minNativeZoom=e;for(let e=0;e<n.length;e++){let t=+n[e].getAttribute("zoom");n[e].getAttribute("zoom")||(t=o.nativeZoom),o.minNativeZoom=Math.min(o.minNativeZoom,t),o.maxNativeZoom=Math.max(o.maxNativeZoom,t)}return o.minZoom=+i.min||0,o.maxZoom=+i.max||e,o},_groupTiles:function(i){let o={};for(let e=0;e<i.length;e++){let t={};t.row=+i[e].getAttribute("row"),t.col=+i[e].getAttribute("col"),t.zoom=+i[e].getAttribute("zoom")||this.options.nativeZoom,t.src=i[e].getAttribute("src");var n=t.col+":"+t.row+":"+t.zoom;n in o?o[n].push(t):o[n]=[t]}return o}}),l=L.Control.Layers.extend({options:{autoZIndex:!1,sortLayers:!0,sortFunction:function(t,e){return t.options.zIndex<e.options.zIndex?-1:t.options.zIndex>e.options.zIndex?1:0}},initialize:function(t,e){for(var i in L.setOptions(this,e),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[i],i,!0)},onAdd:function(){return this._initLayout(),L.DomEvent.on(this._container.getElementsByTagName("a")[0],"keydown",this._focusFirstLayer,this._container),L.DomEvent.on(this._container,"contextmenu",this._preventDefaultContextMenu,this),this._update(),this._layers.length<1&&!this._map._showControls?this._container.setAttribute("hidden",""):this._map._showControls=!0,this._container},onRemove:function(t){L.DomEvent.off(this._container.getElementsByTagName("a")[0],"keydown",this._focusFirstLayer,this._container)},addOrUpdateOverlay:function(t,e){for(var i=!1,o=0;o<this._layers.length;o++)if(this._layers[o].layer===t){i=!0,this._layers[o].name=e;break}return i||this.addOverlay(t,e),0<this._layers.length&&(this._container.removeAttribute("hidden"),this._map._showControls=!0),this._map?this._update():this},removeLayer:function(t){L.Control.Layers.prototype.removeLayer.call(this,t),0===this._layers.length&&this._container.setAttribute("hidden","")},_checkDisabledLayers:function(){},_focusFirstLayer:function(t){var e;"Enter"!==t.key||"leaflet-control-layers leaflet-control leaflet-control-layers-expanded"!==this.className||(e=this.children[1].children[2].children[0].children[0].children[0].children[0])&&setTimeout(()=>e.focus(),0)},_update:function(){if(!this._container)return this;L.DomUtil.empty(this._baseLayersList),L.DomUtil.empty(this._overlaysList),this._layerControlInputs=[];var t,e,i,o,n=0;for(this.options.sortLayers&&this._layers.sort((t,e)=>this.options.sortFunction(t.layer,e.layer,t.name,e.name)),i=0;i<this._layers.length;i++)o=this._layers[i],this._addItem(o),e=e||o.overlay,t=t||!o.overlay,n+=o.overlay?0:1;return this.options.hideSingleBase&&(this._baseLayersList.style.display=(t=t&&1<n)?"":"none"),this._separator.style.display=e&&t?"":"none",this},_addItem:function(t){var e=t.layer._layerEl._layerControlHTML;return t.input=e.querySelector("input.leaflet-control-layers-selector"),this._layerControlInputs.push(t.input),t.input.layerId=L.stamp(t.layer),this._overlaysList.appendChild(e),e},collapse:function(t){if(this._container.className.includes("expanded")&&this._map.contextMenu._extentLayerMenu.hidden&&this._map.contextMenu._layerMenu.hidden)return"SELECT"===t.target.tagName||t.relatedTarget&&t.relatedTarget.parentElement&&("mapml-contextmenu mapml-layer-menu"===t.relatedTarget.className||"mapml-contextmenu mapml-layer-menu"===t.relatedTarget.parentElement.className)||this._map&&"block"===this._map.contextMenu._layerMenu.style.display||(L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),"touch"===t.originalEvent?.pointerType&&(this._container._isExpanded=!1)),this},_preventDefaultContextMenu:function(t){var e=this._map.mouseEventToLatLng(t),i=this._map.mouseEventToContainerPoint(t);t.preventDefault(),this._container._isExpanded||"touch"!==t.pointerType?this._map.fire("contextmenu",{originalEvent:t,containerPoint:i,latlng:e}):this._container._isExpanded=!0}}),h=L.FeatureGroup.extend({initialize:function(t,e){L.FeatureGroup.prototype.initialize.call(this,null,e),this.options.tiles||(this._container=null,this.options.query||this.options._leafletLayer?this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane):this._container=this.options.pane,L.DomUtil.addClass(this._container,"leaflet-pane mapml-vector-container"),L.setOptions(this.options.renderer,{pane:this._container})),this.options.query?this._queryFeatures=t.features||t:t||this.options._leafletLayer&&(this._features={},this._staticFeature=!0)},isVisible:function(){let n=this.options.mapEl._map;if(this.options.query)return!0;if(this._staticFeature&&0===Object.keys(this._features).length)return!1;{let t=n.getZoom(),e=this.zoomBounds||this.options.zoomBounds,i=this.layerBounds||this.options.layerBounds,o=!!e&&(t<=e.maxZoom&&t>=e.minZoom);return o&&this._layers&&i&&i.overlaps(M.pixelToPCRSBounds(n.getPixelBounds(),t,n.options.projection))}},onAdd:function(t){this._map=t,L.FeatureGroup.prototype.onAdd.call(this,t),this._staticFeature&&this._validateRendering(),this._queryFeatures&&t.on("featurepagination",this.showPaginationFeature,this)},addLayer:function(t){var e;return L.FeatureGroup.prototype.addLayer.call(this,t),this.options.layerBounds||(this.layerBounds=this.layerBounds?this.layerBounds.extend(t.layerBounds):L.bounds(t.layerBounds.min,t.layerBounds.max),this.zoomBounds?(t.zoomBounds.minZoom<this.zoomBounds.minZoom&&(this.zoomBounds.minZoom=t.zoomBounds.minZoom),t.zoomBounds.maxZoom>this.zoomBounds.maxZoom&&(this.zoomBounds.maxZoom=t.zoomBounds.maxZoom),t.zoomBounds.minNativeZoom<this.zoomBounds.minNativeZoom&&(this.zoomBounds.minNativeZoom=t.zoomBounds.minNativeZoom),t.zoomBounds.maxNativeZoom>this.zoomBounds.maxNativeZoom&&(this.zoomBounds.maxNativeZoom=t.zoomBounds.maxNativeZoom)):this.zoomBounds=t.zoomBounds),this._staticFeature&&((e=t.options.mapmlFeature.zoom)in this._features?this._features[e].push(t):this._features[e]=[t],this._validateRendering()),this},addRendering:function(t){L.FeatureGroup.prototype.addLayer.call(this,t)},onRemove:function(t){this._queryFeatures&&(t.off("featurepagination",this.showPaginationFeature,this),delete this._queryFeatures,L.DomUtil.remove(this._container)),L.FeatureGroup.prototype.onRemove.call(this,t),this._map.featureIndex.cleanIndex()},removeLayer:function(i){if(L.FeatureGroup.prototype.removeLayer.call(this,i),!this.options.layerBounds){delete this.layerBounds,delete this.options._leafletLayer.bounds,delete this.zoomBounds,delete this.options._leafletLayer.zoomBounds,delete this._layers[i._leaflet_id],this._removeFromFeaturesList(i);let t,e;var o;for(o of Object.keys(this._layers)){var n=this._layers[o];t?t.extend(n.layerBounds):t=L.bounds(n.layerBounds.min,n.layerBounds.max),e?(n.zoomBounds.minZoom<e.minZoom&&(e.minZoom=n.zoomBounds.minZoom),n.zoomBounds.maxZoom>e.maxZoom&&(e.maxZoom=n.zoomBounds.maxZoom),n.zoomBounds.minNativeZoom<e.minNativeZoom&&(e.minNativeZoom=n.zoomBounds.minNativeZoom),n.zoomBounds.maxNativeZoom>e.maxNativeZoom&&(e.maxNativeZoom=n.zoomBounds.maxNativeZoom)):(e={},e.minZoom=n.zoomBounds.minZoom,e.maxZoom=n.zoomBounds.maxZoom,e.minNativeZoom=n.zoomBounds.minNativeZoom,e.maxNativeZoom=n.zoomBounds.maxNativeZoom)}t?this.layerBounds=t:delete this.layerBounds,e?this.zoomBounds=e:(delete this.zoomBounds,delete this.options.zoomBounds)}return this},removeRendering:function(t){L.FeatureGroup.prototype.removeLayer.call(this,t)},_removeFromFeaturesList:function(t){for(var e in this._features)for(let t=0;t<this._features[e].length;++t){var i=this._features[e][t];if(i._leaflet_id==i._leaflet_id){this._features[e].splice(t,1);break}}},getEvents:function(){return this._staticFeature?{moveend:this._handleMoveEnd,zoomend:this._handleZoomEnd}:{}},showPaginationFeature:function(t){if(this.options.query&&this._queryFeatures[t.i]){let e=this._queryFeatures[t.i];if(e._linkEl.shadowRoot.replaceChildren(),this.clearLayers(),e.meta)for(let t=0;t<e.meta.length;t++)e._linkEl.shadowRoot.appendChild(e.meta[t]);e._linkEl.shadowRoot.appendChild(e),e.addFeature(this),t.popup._navigationBar.querySelector("p").innerText=t.i+1+"/"+this.options._leafletLayer._totalFeatureCount,t.popup._content.querySelector("iframe").setAttribute("sandbox","allow-same-origin allow-forms"),t.popup._content.querySelector("iframe").srcdoc=e.querySelector("map-properties").innerHTML,this._map.fire("attachZoomLink",{i:t.i,currFeature:e}),this._map.once("popupclose",function(t){this.shadowRoot.innerHTML=""},e._linkEl)}},_handleMoveEnd:function(){this._removeCSS()},_handleZoomEnd:function(t){this.zoomBounds&&this._validateRendering()},_validateRendering:function(){this._map&&this._map.featureIndex.cleanIndex();let o=this._map||this.options._leafletLayer._map;if(o.hasLayer(this)&&this._features)for(var n in this._features)for(let i=0;i<this._features[n].length;i++){let e=this._features[n][i],t=e._checkRender(o.getZoom(),this.zoomBounds.minZoom,this.zoomBounds.maxZoom);if(t){if(!o.hasLayer(e)&&!e._map){this.addRendering(e);let t=e.defaultOptions.group.parentNode.querySelector(`span[id="${e._leaflet_id}"]`);t.replaceWith(e.defaultOptions.group)}}else{let t=document.createElement("span");t.id=e._leaflet_id,e.defaultOptions.group.insertAdjacentElement("beforebegin",t),this.removeRendering(e)}}},_setZoomTransform:function(t,e){var i=this._map.getZoomScale(this._map.getZoom(),e),t=t.multiplyBy(i).subtract(this._map._getNewPixelOrigin(t,this._map.getZoom())).round();any3d?L.setTransform(this._layers[e],t,i):L.setPosition(this._layers[e],t)},createGeometry:function(o,n,a){let r=Object.assign({},this.options);if(!r.filter||r.filter(o)){o.classList.length&&(r.className=o.classList.value);let t=o.zoom??a,e=o.querySelector("map-featurecaption");e=e?e.innerHTML:"Feature",o.querySelector("map-properties")&&(r.properties=document.createElement("div"),r.properties.classList.add("mapml-popup-content"),r.properties.insertAdjacentHTML("afterbegin",o.querySelector("map-properties").innerHTML));n=o.getElementsByTagName("map-geometry")[0]?.getAttribute("cs")??n;(this._staticFeature||this.options.query)&&(r.layerBounds=M.extentToBounds(o.extent,"PCRS"),r.zoomBounds=o.extent.zoom);let i=this._geometryToLayer(o,r,n,+t,e);return i&&0!==Object.keys(i._layers).length?(!i.options.color&&o.hasAttribute("class")&&(i.options.className=o.getAttribute("class")),i.defaultOptions=i.options,this.resetStyle(i),r.onEachFeature&&i.bindTooltip(e,{interactive:!0,sticky:!0}),"MAP-FEATURE"===o.tagName.toUpperCase()&&(o._groupEl=i.options.group),i):void 0}},resetStyle:function(t){var e=this.options.style;e&&(L.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(e){this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)},_removeCSS:function(){var e=this._container.querySelectorAll("link[rel=stylesheet],style");for(let t=0;t<e.length;t++)this._container.removeChild(e[t])},_geometryToLayer:function(i,o,n,a,r){let s=i.getElementsByTagName("map-geometry")[0],l=[],h=L.SVG.create("g"),c=Object.assign({},o);if(h._featureEl=i,s){for(var u of s.querySelectorAll("map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint"))l.push(M.path(u,Object.assign(c,{nativeCS:n,nativeZoom:a,projection:this.options.projection,featureID:i.id,group:h,wrappers:this._getGeometryParents(u.parentElement),featureLayer:this,_leafletLayer:this.options._leafletLayer})));let t={group:h,mapmlFeature:i,featureID:i.id,accessibleTitle:r,onEachFeature:o.onEachFeature,properties:o.properties,_leafletLayer:this.options._leafletLayer,layerBounds:o.layerBounds,zoomBounds:o.zoomBounds},e=s.querySelector("map-multipolygon")||s.querySelector("map-geometrycollection");return e&&(t.wrappers=this._getGeometryParents(e.parentElement)),M.geometry(l,t)}},_getGeometryParents:function(t,e=[]){return t&&"MAP-GEOMETRY"!==t.tagName.toUpperCase()?"MAP-MULTIPOLYGON"===t.tagName.toUpperCase()||"MAP-GEOMETRYCOLLECTION"===t.tagName.toUpperCase()?this._getGeometryParents(t.parentElement,e):this._getGeometryParents(t.parentElement,e.concat([t])):e}}),c=L.TileLayer.extend({initialize:function(t,e){e.tms=t.tms,this.zoomBounds=Object.assign({},e.zoomBounds),L.extend(e,this.zoomBounds),L.setOptions(this,e),this._setUpTileTemplateVars(t),this._linkEl=e.linkEl,this.extentBounds=this.options.extentBounds,delete this.options.zoomBounds,delete this.options.extentBounds,this._template=t,this._initContainer(),L.TileLayer.prototype.initialize.call(this,t.template,L.extend(e,{pane:this.options.pane}))},onAdd:function(t){this.options.pane.appendChild(this._container),L.TileLayer.prototype.onAdd.call(this,t),this._handleMoveEnd()},onRemove:function(){L.DomUtil.remove(this._container);for(var t of this._container.children)L.DomUtil.remove(t)},getEvents:function(){let t=L.TileLayer.prototype.getEvents.call(this,this._map);return this._parentOnMoveEnd=t.moveend,t.moveend=this._handleMoveEnd,t},isVisible:function(){let t=this._linkEl.getMapEl()._map;var e=t.getZoom(),i=M.pixelToPCRSBounds(t.getPixelBounds(),e,t.options.projection);return e<=this.zoomBounds.maxZoom&&e>=this.zoomBounds.minZoom&&this.extentBounds.overlaps(i)},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"mapml-templated-tile-container"),this._updateZIndex())},_handleMoveEnd:function(t){this.isVisible()&&this._parentOnMoveEnd()},createTile:function(e){let i=document.createElement("DIV"),o=this.getTileSize();if(L.DomUtil.addClass(i,"mapml-tile-group"),L.DomUtil.addClass(i,"leaflet-tile"),this._template.linkEl.dispatchEvent(new CustomEvent("tileloadstart",{detail:{x:e.x,y:e.y,zoom:e.z,appendTile:t=>{i.appendChild(t)}}})),this._template.type.startsWith("image/")){let t=L.TileLayer.prototype.createTile.call(this,e,function(){});t.width=o.x,t.height=o.y,i.appendChild(t)}else this._url.includes(M.BLANK_TT_TREF)||this._fetchTile(e,i);return i},_mapmlTileReady:function(t){L.DomUtil.addClass(t,"leaflet-tile-loaded")},getPane:function(){return this.options.pane},_fetchTile:function(e,i){var t=this.getTileUrl(e);t&&fetch(t,{redirect:"follow"}).then(function(t){return 200<=t.status&&t.status<300?Promise.resolve(t):(console.log("Looks like there was a problem. Status Code: "+t.status),Promise.reject(t))}).then(function(t){return t.text()}).then(t=>{return(new DOMParser).parseFromString(t,"application/xml")}).then(t=>{this._createFeatures(t,e,i),this._mapmlTileReady(i)}).catch(t=>{console.log("Error Creating Tile")})},_parseStylesheetAsHTML:function(t,e,i){if(i instanceof Element&&t&&t.querySelector("map-link[rel=stylesheet],map-style")){if(e instanceof Element)e=e.getAttribute("href")?e.getAttribute("href"):document.URL;else if(!e||""===e||e instanceof Object)return;for(var o,n,a=[],r=t.querySelectorAll("map-link[rel=stylesheet],map-style"),s=0;s<r.length;s++)"MAP-LINK"===r[s].nodeName.toUpperCase()?(o=r[s].hasAttribute("href")?new URL(r[s].getAttribute("href"),e).href:null)&&(i.querySelector("link[href='"+o+"']")||(n=document.createElement("link"),h(r[s],n),n.setAttribute("href",o),a.push(n))):(n=document.createElement("style"),h(r[s],n),n.textContent=r[s].textContent,a.push(n));for(var l=a.length-1;0<=l;l--)i.insertAdjacentElement("afterbegin",a[l])}function h(t,e){return Array.from(t.attributes).forEach(t=>{"href"!==t.nodeName&&e.setAttribute(t.nodeName,t.nodeValue)})}},_createFeatures:function(t,e,i){var o;t.querySelector("map-link[rel=stylesheet],map-style")&&(o=t.querySelector("map-base")&&t.querySelector("map-base").hasAttribute("href")?new URL(t.querySelector("map-base").getAttribute("href")).href:t.URL,this._parseStylesheetAsHTML(t,o,i));let n=L.SVG.create("svg"),a=L.SVG.create("g"),r=this._map.options.crs.options.crs.tile.bounds.max.x,s=e.x*r,l=e.y*r,h=M.featureLayer(null,{projection:this._map.options.projection,tiles:!0,layerBounds:this.extentBounds,zoomBounds:this.zoomBounds,interactive:!1,mapEl:this._linkEl.getMapEl()});var c=M.getNativeVariables(t),u=t.querySelectorAll("map-feature:has(> map-geometry)");for(let t=0;t<u.length;t++){var m,d=h.createGeometry(u[t],c.cs,e.z);for(m in d._layers){let t=d._layers[m];M.FeatureRenderer.prototype._initPath(t,!1),t._project(this._map,L.point([s,l]),e.z),M.FeatureRenderer.prototype._addPath(t,a,!1),M.FeatureRenderer.prototype._updateFeature(t)}}n.setAttribute("width",r.toString()),n.setAttribute("height",r.toString()),n.appendChild(a),i.appendChild(n)},getTileUrl:function(t){if(t.z>=this._template.tilematrix.bounds.length||!this._template.tilematrix.bounds[t.z].contains(t))return"";var e,i={},o=this._template.linkEl,n=o.zoomInput;for(e in i[this._template.tilematrix.col.name]=t.x,i[this._template.tilematrix.row.name]=t.y,n&&o.hasAttribute("tref")&&o.getAttribute("tref").includes(`{${n.getAttribute("name")}}`)&&(i[this._template.zoom.name]=this._getZoomForUrl()),i[this._template.pcrs.easting.left]=this._tileMatrixToPCRSPosition(t,"top-left").x,i[this._template.pcrs.easting.right]=this._tileMatrixToPCRSPosition(t,"top-right").x,i[this._template.pcrs.northing.top]=this._tileMatrixToPCRSPosition(t,"top-left").y,i[this._template.pcrs.northing.bottom]=this._tileMatrixToPCRSPosition(t,"bottom-left").y,this._template.tile)["row","col","zoom","left","right","top","bottom"].indexOf(e)<0&&(i[e]=this._template.tile[e]);return this._map&&!this._map.options.crs.infinite&&(t=this._globalTileRange.max.y-t.y,this.options.tms&&(i[this._template.tilematrix.row.name]=t)),i.r=this.options.detectRetina&&L.Browser.retina&&0<this.options.maxZoom?"@2x":"",L.Util.template(this._url,i)},_tileMatrixToPCRSPosition:function(t,e){var i=this._map.options.crs,o=this.getTileSize(),n=t.scaleBy(o),a=n.add(o),o=n.add(Math.floor(o/2)),r=i.transformation.untransform(n,i.scale(t.z)),s=i.transformation.untransform(a,i.scale(t.z)),l=i.transformation.untransform(o,i.scale(t.z)),h=null;switch(e){case"top-left":h=r;break;case"bottom-left":h=new L.Point(r.x,s.y);break;case"center-left":h=new L.Point(r.x,l.y);break;case"top-right":h=new L.Point(s.x,r.y);break;case"bottom-right":h=s;break;case"center-right":h=new L.Point(s.x,l.y);break;case"top-center":h=new L.Point(l.x,r.y);break;case"bottom-center":h=new L.Point(l.x,s.y);break;case"center":h=l}return h},_setUpTileTemplateVars:function(t){t.tile={};for(var e,i,o,n,a=t.values,r=this.options.crs.options,s=0;s<t.values.length;s++){var l=a[s].getAttribute("type"),h=a[s].getAttribute("units"),c=a[s].getAttribute("axis"),u=a[s].getAttribute("name"),m=a[s].getAttribute("position"),d="map-select"===a[s].tagName.toLowerCase();a[s].getAttribute("value");var p=a[s].getAttribute("min"),f=a[s].getAttribute("max");if("location"===l&&"tilematrix"===h)switch(c){case"column":n={name:u,min:r.crs.tilematrix.horizontal.min,max:r.crs.tilematrix.horizontal.max(r.resolutions.length-1)},isNaN(Number.parseFloat(p))||(n.min=Number.parseFloat(p)),isNaN(Number.parseFloat(f))||(n.max=Number.parseFloat(f));break;case"row":o={name:u,min:r.crs.tilematrix.vertical.min,max:r.crs.tilematrix.vertical.max(r.resolutions.length-1)},isNaN(Number.parseFloat(p))||(o.min=Number.parseFloat(p)),isNaN(Number.parseFloat(f))||(o.max=Number.parseFloat(f));break;case"longitude":case"easting":e=e||{min:r.crs.pcrs.horizontal.min,max:r.crs.pcrs.horizontal.max},isNaN(Number.parseFloat(p))||(e.min=Number.parseFloat(p)),isNaN(Number.parseFloat(f))||(e.max=Number.parseFloat(f)),m&&(m.match(/.*?-left/i)?e.left=u:m.match(/.*?-right/i)&&(e.right=u));break;case"latitude":case"northing":i=i||{min:r.crs.pcrs.vertical.min,max:r.crs.pcrs.vertical.max},isNaN(Number.parseFloat(p))||(i.min=Number.parseFloat(p)),isNaN(Number.parseFloat(f))||(i.max=Number.parseFloat(f)),m&&(m.match(/top-.*?/i)?i.top=u:m.match(/bottom-.*?/i)&&(i.bottom=u))}else if(d){const S=a[s].htmlselect;t.tile[u]=function(){return S.value}}else if("hidden"===l){const T=a[s];t.tile[u]=function(){return T.getAttribute("value")}}}function y(t,e){return _.transform(t,b(e)).divideBy(g).floor()}var _=this.options.crs.transformation,g=this.options.crs.options.crs.tile.bounds.max.x,b=L.bind(this.options.crs.scale,this.options.crs);e&&i?(t.pcrs={},t.pcrs.bounds=L.bounds([e.min,i.min],[e.max,i.max]),t.pcrs.easting=e,t.pcrs.northing=i):n&&o&&!isNaN(t.zoom.initialValue)&&(t.pcrs||(t.pcrs={},t.pcrs.easting="",t.pcrs.northing=""),t.pcrs.bounds=M.boundsToPCRSBounds(L.bounds(L.point([n.min,o.min]),L.point([n.max,o.max])),t.zoom.initialValue,this.options.crs,M.axisToCS("column")),t.tilematrix={},t.tilematrix.col=n,t.tilematrix.row=o),t.tilematrix||(t.tilematrix={},t.tilematrix.col={},t.tilematrix.row={}),t.tilematrix.bounds=[];for(var x=t.pcrs.bounds,v=this.options.minNativeZoom,w=this.options.maxNativeZoom,C=0;C<=w;C++)t.tilematrix.bounds[C]=v<=C?L.bounds(y(x.min,C),y(x.max,C)):L.bounds(L.point([-1,-1]),L.point([-1,-1]))},_clampZoom:function(t){var e=L.GridLayer.prototype._clampZoom.call(this,t);return this._template.step>this.options.maxNativeZoom&&(this._template.step=this.options.maxNativeZoom),t!==e?t=e:t%this._template.step!=0&&(t=Math.floor(t/this._template.step)*this._template.step),t}}),u=L.LayerGroup.extend({initialize:function(t){L.LayerGroup.prototype.initialize.call(this,null,t),this._container=L.DomUtil.create("div","leaflet-layer"),this._extentEl=this.options.extentEl,this.changeOpacity(this.options.opacity),L.DomUtil.addClass(this._container,"mapml-extentlayer-container")},getEvents:function(){return{zoomstart:this._onZoomStart}},_onZoomStart:function(){this.closePopup()},getContainer:function(){return this._container},onAdd:function(t){L.LayerGroup.prototype.onAdd.call(this,t);let e=this.options.extentEl.parentLayer._layer._container;e.appendChild(this._container)},redraw:function(){this.eachLayer(function(t){t.redraw()})},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(){L.LayerGroup.prototype.onRemove.call(this,this._map),L.DomUtil.remove(this._container)},_previousFeature:function(t){0<=this._count+-1&&(this._count--,this._map.fire("featurepagination",{i:this._count,popup:this}))},_nextFeature:function(t){this._count+1<this._source._totalFeatureCount&&(this._count++,this._map.fire("featurepagination",{i:this._count,popup:this}))},changeOpacity:function(t){this._container.style.opacity=t,this._extentEl._opacity=t,this._extentEl._opacitySlider&&(this._extentEl._opacitySlider.value=t)},appendStyleLink:function(e){if(e.link){let t=this._getStylePositionAndNode();t.node.insertAdjacentElement(t.position,e.link)}},_getStylePositionAndNode:function(){return this._container.lastChild&&("SVG"===this._container.lastChild.nodeName.toUpperCase()||this._container.lastChild.classList.contains("mapml-vector-container"))?{position:"beforebegin",node:this._container.lastChild}:this._container.lastChild?{position:"afterend",node:this._container.lastChild}:{position:"afterbegin",node:this._container}},appendStyleElement:function(e){if(e.styleElement){let t=this._getStylePositionAndNode();t.node.insertAdjacentElement(t.position,e.styleElement)}}}),m=L.Layer.extend({initialize:function(t,e){this._template=t,this._container=L.DomUtil.create("div","leaflet-layer"),L.DomUtil.addClass(this._container,"mapml-features-container"),this.zoomBounds=e.zoomBounds,this.extentBounds=e.extentBounds,delete e.zoomBounds,delete e.extentBounds,this._linkEl=e.linkEl,L.setOptions(this,L.extend(e,this._setUpFeaturesTemplateVars(t)))},isVisible:function(){let t=this._linkEl.getMapEl()._map;var e=t.getZoom(),i=M.pixelToPCRSBounds(t.getPixelBounds(),e,t.options.projection);return e<=this.zoomBounds.maxZoom&&e>=this.zoomBounds.minZoom&&this.extentBounds.overlaps(i)},getEvents:function(){return{moveend:this._onMoveEnd}},onAdd:function(e){this._map=e,this.options.pane.appendChild(this._container);var t=this.options.opacity||1,i=this._container;this._features?this._features.eachLayer(t=>t.addTo(e)):(this._features=M.featureLayer(null,{renderer:M.featureRenderer(),pane:i,layerBounds:this.extentBounds,zoomBounds:this.zoomBounds,opacity:t,projection:e.options.projection,mapEl:this._linkEl.getMapEl(),onEachFeature:function(t,e){var i=document.createElement("div");i.classList.add("mapml-popup-content"),i.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(i,{autoClose:!1,minWidth:108})}}),L.extend(this._features.options,{_leafletLayer:this._features}),this._features._layerEl=this._linkEl.getLayerEl()),this._onMoveEnd()},onRemove:function(){this._features&&this._features.eachLayer(t=>t.remove()),L.DomUtil.remove(this._container)},appendStyleLink:function(e){if(e.link){let t=this._getStylePositionAndNode();t.node.insertAdjacentElement(t.position,e.link)}},_getStylePositionAndNode:function(){return this._container.lastChild&&("SVG"===this._container.lastChild.nodeName.toUpperCase()||this._container.lastChild.classList.contains("mapml-vector-container"))?{position:"beforebegin",node:this._container.lastChild}:this._container.lastChild?{position:"afterend",node:this._container.lastChild}:{position:"afterbegin",node:this._container}},appendStyleElement:function(e){if(e.styleElement){let t=this._getStylePositionAndNode();t.node.insertAdjacentElement(t.position,e.styleElement)}},redraw:function(){this._onMoveEnd()},_removeCSS:function(){var i=this._container.querySelectorAll("link[rel=stylesheet],style");for(let e=0;e<i.length;e++){let t=i[e].parentNode;t.removeChild(i[e])}},_onMoveEnd:function(){var t=this._map.options.mapEl._history,e=t[t.length-1],i=t[t.length-2]??e,o=this._template.step,t=this._map.getZoom();let n=t;if("1"!==o&&(t+1)%o==0&&e.zoom===i.zoom-1||e.zoom===i.zoom||Math.floor(t/o)*o!=Math.floor(i.zoom/o)*o)n=Math.floor(t/o)*o;else if(t%this._template.step!=0)return;var s,l,h,c,u,a,r,m,o=this._map.getPixelBounds(this._map.getCenter(),n),o=this._getfeaturesUrl(n,o);o!==this._url&&(this._features.clearLayers(),this._linkEl.shadowRoot&&(this._linkEl.shadowRoot.innerHTML=""),this._removeCSS(),this.isVisible()||n!==t?(l=new Headers({Accept:"text/mapml;q=0.9,application/geo+json;q=0.8"}),h=new DOMParser,c=this._features,u=this._linkEl,a=this._map,m=function(a,r){return fetch(a,{redirect:"follow",headers:l}).then(function(t){return t.text()}).then(function(t){s=h.parseFromString(t,"application/xml");t=new URL(s.querySelector("map-base")?s.querySelector("map-base").getAttribute("href"):a).href;a=(a=s.querySelector("map-link[rel=next]")?s.querySelector("map-link[rel=next]").getAttribute("href"):null)?new URL(a,t).href:null;let e=document.createDocumentFragment();var i=s.querySelectorAll("map-head > *, map-body > *");for(let t=0;t<i.length;t++)e.appendChild(i[t]);u.shadowRoot.appendChild(e);let o=u.shadowRoot.querySelectorAll("map-feature"),n=[];for(let t=0;t<o.length;t++)n.push(o[t].whenReady());if(Promise.allSettled(n).then(()=>{for(let t=0;t<o.length;t++)o[t].addFeature(c)}),a&&--r)return m(a,r)})},(r=this)._url=o,m(o,10).then(function(){a.addLayer(c),a.fire("templatedfeatureslayeradd"),M.TemplatedFeaturesLayer.prototype._updateTabIndex(r)}).catch(function(t){console.log(t)})):this._url="")},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateTabIndex:function(t){var i,o=t||this;for(i in o._features._layers){let e=o._features._layers[i];if(e._path&&("M0 0"!==e._path.getAttribute("d")?e._path.setAttribute("tabindex",0):e._path.removeAttribute("tabindex"),0===e._path.childElementCount)){let t=document.createElement("title");t.innerText="Feature",e._path.appendChild(t)}}},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_getfeaturesUrl:function(t,e){void 0===t&&(t=this._map.getZoom()),void 0===e&&(e=this._map.getPixelBounds());var i,o={};for(i in this.options.feature.zoom&&(o[this.options.feature.zoom]=t),this.options.feature.width&&(o[this.options.feature.width]=this._map.getSize().x),this.options.feature.height&&(o[this.options.feature.height]=this._map.getSize().y),this.options.feature.bottom&&(o[this.options.feature.bottom]=this._TCRSToPCRS(e.max,t).y),this.options.feature.left&&(o[this.options.feature.left]=this._TCRSToPCRS(e.min,t).x),this.options.feature.top&&(o[this.options.feature.top]=this._TCRSToPCRS(e.min,t).y),this.options.feature.right&&(o[this.options.feature.right]=this._TCRSToPCRS(e.max,t).x),this.options.feature)["width","height","left","right","top","bottom","zoom"].indexOf(i)<0&&(o[i]=this.options.feature[i]);return L.Util.template(this._template.template,o)},_TCRSToPCRS:function(t,e){var i=this._map.options.crs;return i.transformation.untransform(t,i.scale(e))},_setUpFeaturesTemplateVars:function(t){var e={feature:{}},i=t.values;e.feature.hidden=[];for(var o=0;o<i.length;o++){var n=i[o].getAttribute("type"),a=i[o].getAttribute("units"),r=i[o].getAttribute("axis"),s=i[o].getAttribute("name"),l=i[o].getAttribute("position");i[o].getAttribute("value");var h="map-select"===i[o].tagName.toLowerCase();if("width"===n)e.feature.width=s;else if("height"===n)e.feature.height=s;else if("zoom"===n)e.feature.zoom=s;else if("location"!==n||"pcrs"!==a&&"gcrs"!==a)if(h){const c=i[o].htmlselect;e.feature[s]=function(){return c.value}}else{const u=i[o];e.feature[s]=function(){return u.getAttribute("value")}}else switch(r){case"x":case"longitude":case"easting":l&&(l.match(/.*?-left/i)?e.feature.left=s:l.match(/.*?-right/i)&&(e.feature.right=s));break;case"y":case"latitude":case"northing":l&&(l.match(/top-.*?/i)?e.feature.top=s:l.match(/bottom-.*?/i)&&(e.feature.bottom=s))}}return e}}),d=L.Layer.extend({initialize:function(t,e){this._template=t,this._container=L.DomUtil.create("div","leaflet-layer"),L.DomUtil.addClass(this._container,"mapml-image-container"),this._linkEl=e.linkEl,this.zoomBounds=e.zoomBounds,this.extentBounds=e.extentBounds,delete e.zoomBounds,delete e.extentBounds,L.setOptions(this,L.extend(e,this._setUpExtentTemplateVars(t)))},getEvents:function(){return{moveend:this._onMoveEnd,zoomstart:this._clearLayer}},onAdd:function(t){this._map=t,this.options.pane.appendChild(this._container),this.setZIndex(this.options.zIndex),this._onAdd()},redraw:function(){this._onMoveEnd()},isVisible:function(){let t=this._linkEl.getMapEl()._map;var e=t.getZoom(),i=M.pixelToPCRSBounds(t.getPixelBounds(),e,t.options.projection);return e<=this.zoomBounds.maxZoom&&e>=this.zoomBounds.minZoom&&this.extentBounds.overlaps(i)},_clearLayer:function(){var e=this._container.querySelectorAll("img");for(let t=0;t<e.length;t++)this._container.removeChild(e[t])},_addImage:function(t,e,i){let o=this._map,n=this._imageOverlay;t=this.getImageUrl(t,e),e=o.getSize();this._imageOverlay=M.imageLayer(t,i,e,0,this._container),this._imageOverlay._step=this._template.step,this._imageOverlay.addTo(o),n&&(this._imageOverlay._overlayToRemove=n._url,this._imageOverlay.on("load error",function(){o.removeLayer(n)}))},_scaleImage:function(i,o){let n=this;setTimeout(function(){var t,e;n._map&&(t=n._template.step,e=Math.floor(o/t)*t,t=n._map.getZoomScale(o,e),e=i.min.multiplyBy(t).subtract(n._map._getNewPixelOrigin(n._map.getCenter(),o)).round(),L.DomUtil.setTransform(n._imageOverlay._image,e,t))})},_onAdd:function(){var t=this._map.getZoom();let e=t;var i=this._template.step;t%i!=0&&(e=Math.floor(t/i)*i);var o=this._map.getPixelBounds(this._map.getCenter(),e);this._pixelOrigins={},this._pixelOrigins[e]=o.min;i=this._map.getPixelBounds().min.subtract(this._map.getPixelOrigin());this._addImage(o,e,i),t!==e&&this._scaleImage(o,t)},_onMoveEnd:function(t){var e=this._map.getZoom(),i=this._map.options.mapEl._history,o=i[i.length-1];let n=i[i.length-2];n=n||o;var a,r=this._template.step,i=Math.floor(e/r)*r;let s=this._map.getPixelBounds(this._map.getCenter(),i);"1"!==r&&(e+1)%r==0&&o.zoom===n.zoom-1?(this._addImage(s,i,L.point(0,0)),this._scaleImage(s,e)):t&&e%r!=0?(this._imageOverlay._overlayToRemove=this._imageOverlay._url,o.zoom!==n.zoom?(this._addImage(s,i,L.point(0,0)),this._pixelOrigins[i]=s.min,this._scaleImage(s,e)):(a=this._pixelOrigins[i],a=s.min.subtract(a),this.getImageUrl(s,i)!==this._imageOverlay._url&&(this._addImage(s,i,a),this._scaleImage(s,e)))):this.isVisible?(a=(i=this._map).getPixelBounds().min.subtract(i.getPixelOrigin()),this._addImage(i.getPixelBounds(),e,a),this._pixelOrigins[e]=i.getPixelOrigin()):this._clearLayer()},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(t){L.DomUtil.remove(this._container),this._clearLayer()},getImageUrl:function(t,e){var i,o={};for(i in o[this.options.extent.width]=this._map.getSize().x,o[this.options.extent.height]=this._map.getSize().y,o[this.options.extent.bottom]=this._TCRSToPCRS(t.max,e).y,o[this.options.extent.left]=this._TCRSToPCRS(t.min,e).x,o[this.options.extent.top]=this._TCRSToPCRS(t.min,e).y,o[this.options.extent.right]=this._TCRSToPCRS(t.max,e).x,this.options.extent)["width","height","left","right","top","bottom"].indexOf(i)<0&&(o[i]=this.options.extent[i]);return L.Util.template(this._template.template,o)},_TCRSToPCRS:function(t,e){var i=this._map.options.crs;return i.transformation.untransform(t,i.scale(e))},_setUpExtentTemplateVars:function(t){for(var e={extent:{}},i=t.values,o=0;o<t.values.length;o++){var n=i[o].getAttribute("type"),a=i[o].getAttribute("units"),r=i[o].getAttribute("axis"),s=i[o].getAttribute("name"),l=i[o].getAttribute("position"),h="map-select"===i[o].tagName.toLowerCase();if("width"===n)e.extent.width=s;else if("height"===n)e.extent.height=s;else if("location"!==n||"pcrs"!==a&&"gcrs"!==a)if(h){const c=i[o].htmlselect;e.extent[s]=function(){return c.value}}else{const u=i[o];e.extent[s]=function(){return u.getAttribute("value")}}else switch(r){case"longitude":case"easting":l&&(l.match(/.*?-left/i)?e.extent.left=s:l.match(/.*?-right/i)&&(e.extent.right=s));break;case"latitude":case"northing":l&&(l.match(/top-.*?/i)?e.extent.top=s:l.match(/bottom-.*?/i)&&(e.extent.bottom=s))}}return e}});function C(t,e){this.x=t,this.y=e}function p(t,e,i){return Math.min(Math.max(t,i),e)}C.prototype={clone(){return new C(this.x,this.y)},add(t){return this.clone()._add(t)},sub(t){return this.clone()._sub(t)},multByPoint(t){return this.clone()._multByPoint(t)},divByPoint(t){return this.clone()._divByPoint(t)},mult(t){return this.clone()._mult(t)},div(t){return this.clone()._div(t)},rotate(t){return this.clone()._rotate(t)},rotateAround(t,e){return this.clone()._rotateAround(t,e)},matMult(t){return this.clone()._matMult(t)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(t){return this.x===t.x&&this.y===t.y},dist(t){return Math.sqrt(this.distSqr(t))},distSqr(t){var e=t.x-this.x,t=t.y-this.y;return e*e+t*t},angle(){return Math.atan2(this.y,this.x)},angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith(t){return this.angleWithSep(t.x,t.y)},angleWithSep(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult(t){var e=t[0]*this.x+t[1]*this.y,t=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=t,this},_add(t){return this.x+=t.x,this.y+=t.y,this},_sub(t){return this.x-=t.x,this.y-=t.y,this},_mult(t){return this.x*=t,this.y*=t,this},_div(t){return this.x/=t,this.y/=t,this},_multByPoint(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint(t){return this.x/=t.x,this.y/=t.y,this},_unit(){return this._div(this.mag()),this},_perp(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate(t){var e=Math.cos(t),i=Math.sin(t),t=e*this.x-i*this.y,e=i*this.x+e*this.y;return this.x=t,this.y=e,this},_rotateAround(t,e){var i=Math.cos(t),o=Math.sin(t),t=e.x+i*(this.x-e.x)-o*(this.y-e.y),e=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=t,this.y=e,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(t){if(t instanceof C)return t;if(Array.isArray(t))return new C(+t[0],+t[1]);if(void 0!==t.x&&void 0!==t.y)return new C(+t.x,+t.y);throw new Error("Expected [x, y] or {x, y} point format")};class f extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var y=f;function _(t){if("string"!=typeof t)throw new y(t);if("transparent"===t.trim().toLowerCase())return[0,0,0,0];t.trim();var e=E.test(t)?function(t){var e=t.toLowerCase().trim(),e=b[function(t){let e=5381,i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return(e>>>0)%2341}(e)];if(!e)throw new y(t);return"#"+e}(t):t,i=v.exec(e);if(i){const a=Array.from(i).slice(1);return[...a.slice(0,3).map(t=>parseInt(x(t,2),16)),parseInt(x(a[3]||"f",2),16)/255]}var o=w.exec(e);if(o){const r=Array.from(o).slice(1);return[...r.slice(0,3).map(t=>parseInt(t,16)),parseInt(r[3]||"ff",16)/255]}var n=S.exec(e);if(n){const s=Array.from(n).slice(1);return[...s.slice(0,3).map(t=>parseInt(t,10)),parseFloat(s[3]||"1")]}i=T.exec(e);if(i){var[o,n,e,i]=Array.from(i).slice(1).map(parseFloat);if(p(0,100,n)!==n)throw new y(t);if(p(0,100,e)!==e)throw new y(t);return[...z(o,n,e),Number.isNaN(i)?1:i]}throw new y(t)}const g=t=>parseInt(t.replace(/_/g,""),36),b="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((t,e)=>{var i=g(e.substring(0,3)),o=g(e.substring(3)).toString(16);let n="";for(let t=0;t<6-o.length;t++)n+="0";return t[i]=""+n+o,t},{});const x=(t,e)=>Array.from(Array(e)).map(()=>t).join(""),v=new RegExp(`^#${x("([a-f0-9])",3)}([a-f0-9])?$`,"i"),w=new RegExp(`^#${x("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),S=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${x(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),T=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,E=/^[a-z]+$/i,k=t=>Math.round(255*t),z=(t,e,i)=>{let o=i/100;if(0===e)return[o,o,o].map(k);i=(t%360+360)%360/60,t=(1-Math.abs(2*o-1))*(e/100),e=t*(1-Math.abs(i%2-1));let n=0,a=0,r=0;0<=i&&i<1?(n=t,a=e):1<=i&&i<2?(n=e,a=t):2<=i&&i<3?(a=t,r=e):3<=i&&i<4?(a=e,r=t):4<=i&&i<5?(n=e,r=t):5<=i&&i<6&&(n=t,r=e);t=o-t/2;const s=n+t,l=a+t,h=r+t;return[s,l,h].map(k)};function A(t,e,i){var o=(t,e)=>3===e?t:t/255,[n,a,r,s]=_(t).map(o),[l,h,c,t]=_(e).map(o),e=t-s,o=2*i-1,o=(1+(o*e==-1?o:o+e/(1+o*e)))/2,e=1-o;return h=255*(a*e+h*o),c=255*(r*e+c*o),i=t*i+s*(1-i),`rgba(${p(0,255,255*(n*e+l*o)).toFixed()}, ${p(0,255,h).toFixed()}, ${p(0,255,c).toFixed()}, ${parseFloat(p(0,1,i).toFixed(3))})`}class I{constructor(t,e,i,o,n){this.properties={},this.extent=i,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=n,t.readFields(P,this,e)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;var e,i=t.readVarint()+t.pos;const o=[];let n,a=1,r=0,s=0,l=0;for(;t.pos<i;)if(r<=0&&(e=t.readVarint(),a=7&e,r=e>>3),r--,1===a||2===a)s+=t.readSVarint(),l+=t.readSVarint(),1===a&&(n&&o.push(n),n=[]),n&&n.push(new C(s,l));else{if(7!==a)throw new Error("unknown command "+a);n&&n.push(n[0].clone())}return n&&o.push(n),o}bbox(){const t=this._pbf;t.pos=this._geometry;var e,i=t.readVarint()+t.pos;let o=1,n=0,a=0,r=0,s=1/0,l=-1/0,h=1/0,c=-1/0;for(;t.pos<i;)if(n<=0&&(e=t.readVarint(),o=7&e,n=e>>3),n--,1===o||2===o)a+=t.readSVarint(),r+=t.readSVarint(),a<s&&(s=a),a>l&&(l=a),r<h&&(h=r),r>c&&(c=r);else if(7!==o)throw new Error("unknown command "+o);return[s,h,l,c]}toGeoJSON(t,e,i){const o=this.extent*Math.pow(2,i),n=this.extent*t,a=this.extent*e,r=this.loadGeometry();function s(t){return[360*(t.x+n)/o-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+a)/o)*Math.PI))-90]}function l(t){return t.map(s)}let h;if(1===this.type){const m=[];for(const d of r)m.push(d[0]);var c=l(m);h=1===m.length?{type:"Point",coordinates:c[0]}:{type:"MultiPoint",coordinates:c}}else if(2===this.type){c=r.map(l);h=1===c.length?{type:"LineString",coordinates:c[0]}:{type:"MultiLineString",coordinates:c}}else{if(3!==this.type)throw new Error("unknown feature type");{const p=[];for(const f of function(e){var i=e.length;if(i<=1)return[e];const o=[];let n,a;for(let t=0;t<i;t++){var r=function(a){let r=0;for(let t=0,e=a.length,i=e-1,o,n;t<e;i=t++)o=a[t],n=a[i],r+=(n.x-o.x)*(o.y+n.y);return r}(e[t]);0!==r&&(void 0===a&&(a=r<0),a===r<0?(n&&o.push(n),n=[e[t]]):n&&n.push(e[t]))}n&&o.push(n);return o}(r))p.push(f.map(l));h=1===p.length?{type:"Polygon",coordinates:p[0]}:{type:"MultiPolygon",coordinates:p}}}const u={type:"Feature",geometry:h,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function P(t,e,i){1===t?e.id=i.readVarint():2===t?function(t,e){var i=t.readVarint()+t.pos;for(;t.pos<i;){var o=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[o]=n}}(i,e):3===t?e.type=i.readVarint():4===t&&(e._geometry=i.pos)}I.types=["Unknown","Point","LineString","Polygon"];class B{constructor(t,e){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(F,this,e),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];t=this._pbf.readVarint()+this._pbf.pos;return new I(this._pbf,t,this.extent,this._keys,this._values)}}function F(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){let e=null;var i=t.readVarint()+t.pos;for(;t.pos<i;){var o=t.readVarint()>>3;e=1==o?t.readString():2==o?t.readFloat():3==o?t.readDouble():4==o?t.readVarint64():5==o?t.readVarint():6==o?t.readSVarint():7==o?t.readBoolean():null}return e}(i))}class R{constructor(t,e){this.layers=t.readFields(D,{},e)}}function D(t,e,i){3!==t||(i=new B(i,i.readVarint()+i.pos)).length&&(e[i.name]=i)}const O=4294967296,N=1/O,q="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class j{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,e,i=this.length){for(;this.pos<i;){var o=this.readVarint(),n=o>>3,a=this.pos;this.type=7&o,t(n,e,this),this.pos===a&&this.skip(o)}return e}readMessage(t,e){return this.readFields(t,e,this.readVarint()+this.pos)}readFixed32(){var t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){var t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){var t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*O;return this.pos+=8,t}readSFixed64(){var t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*O;return this.pos+=8,t}readFloat(){var t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){var t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){var e=this.buf;let i,o;return o=e[this.pos++],i=127&o,o<128?i:(o=e[this.pos++],i|=(127&o)<<7,o<128?i:(o=e[this.pos++],i|=(127&o)<<14,o<128?i:(o=e[this.pos++],i|=(127&o)<<21,o<128?i:(o=e[this.pos],i|=(15&o)<<28,function(t,e,i){var o=i.buf;let n,a;if(a=o[i.pos++],n=(112&a)>>4,a<128)return U(t,n,e);if(a=o[i.pos++],n|=(127&a)<<3,a<128)return U(t,n,e);if(a=o[i.pos++],n|=(127&a)<<10,a<128)return U(t,n,e);if(a=o[i.pos++],n|=(127&a)<<17,a<128)return U(t,n,e);if(a=o[i.pos++],n|=(127&a)<<24,a<128)return U(t,n,e);if(a=o[i.pos++],n|=(1&a)<<31,a<128)return U(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(i,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return Boolean(this.readVarint())}readString(){var t=this.readVarint()+this.pos,e=this.pos;return 12<=(this.pos=t)-e&&q?q.decode(this.buf.subarray(e,t)):function(a,t,r){let s="",l=t;for(;l<r;){var h=a[l];let t=null,e=239<h?4:223<h?3:191<h?2:1;if(l+e>r)break;let i,o,n;1===e?h<128&&(t=h):2===e?(i=a[l+1],128==(192&i)&&(t=(31&h)<<6|63&i,t<=127&&(t=null))):3===e?(i=a[l+1],o=a[l+2],128==(192&i)&&128==(192&o)&&(t=(15&h)<<12|(63&i)<<6|63&o,(t<=2047||55296<=t&&t<=57343)&&(t=null))):4===e&&(i=a[l+1],o=a[l+2],n=a[l+3],128==(192&i)&&128==(192&o)&&128==(192&n)&&(t=(15&h)<<18|(63&i)<<12|(63&o)<<6|63&n,(t<=65535||1114112<=t)&&(t=null))),null===t?(t=65533,e=1):65535<t&&(t-=65536,s+=String.fromCharCode(t>>>10&1023|55296),t=56320|1023&t),s+=String.fromCharCode(t),l+=e}return s}(this.buf,e,t)}readBytes(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e}readPackedVarint(t=[],e){for(var i=this.readPackedEnd();this.pos<i;)t.push(this.readVarint(e));return t}readPackedSVarint(t=[]){for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readFloat());return t}readPackedDouble(t=[]){for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){for(var e=this.readPackedEnd();this.pos<e;)t.push(this.readSFixed64());return t}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(t){t&=7;if(0==t)for(;127<this.buf[this.pos++];);else if(2==t)this.pos=this.readVarint()+this.pos;else if(5==t)this.pos+=4;else{if(1!=t)throw new Error("Unimplemented type: "+t);this.pos+=8}}writeTag(t,e){this.writeVarint(t<<3|e)}realloc(t){let e=this.length||16;for(;e<this.pos+t;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*N),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*N),!0),this.pos+=8}writeVarint(t){268435455<(t=+t||0)||t<0?function(t,e){let i,o;0<=t?(i=t%4294967296|0,o=t/4294967296|0):(i=~(-t%4294967296),o=~(-t/4294967296),4294967295^i?i=i+1|0:(i=0,o=o+1|0));if(0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}(i,(o,e)),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(o,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,n,a){for(let t=0,e,i;t<n.length;t++){if(e=n.charCodeAt(t),55295<e&&e<57344){if(!i){56319<e||t+1===n.length?(o[a++]=239,o[a++]=191,o[a++]=189):i=e;continue}if(e<56320){o[a++]=239,o[a++]=191,o[a++]=189,i=e;continue}e=i-55296<<10|e-56320|65536,i=null}else i&&(o[a++]=239,o[a++]=191,o[a++]=189,i=null);e<128?o[a++]=e:(e<2048?o[a++]=e>>6|192:(e<65536?o[a++]=e>>12|224:(o[a++]=e>>18|240,o[a++]=e>>12&63|128),o[a++]=e>>6&63|128),o[a++]=63&e|128)}return a}(this.buf,t,this.pos);t=this.pos-e;128<=t&&Z(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(e){var i=e.length;this.writeVarint(i),this.realloc(i);for(let t=0;t<i;t++)this.buf[this.pos++]=e[t]}writeRawMessage(t,e){this.pos++;var i=this.pos;t(e,this);e=this.pos-i;128<=e&&Z(i,e,this),this.pos=i-1,this.writeVarint(e),this.pos+=e}writeMessage(t,e,i){this.writeTag(t,2),this.writeRawMessage(e,i)}writePackedVarint(t,e){e.length&&this.writeMessage(t,H,e)}writePackedSVarint(t,e){e.length&&this.writeMessage(t,Y,e)}writePackedBoolean(t,e){e.length&&this.writeMessage(t,X,e)}writePackedFloat(t,e){e.length&&this.writeMessage(t,V,e)}writePackedDouble(t,e){e.length&&this.writeMessage(t,G,e)}writePackedFixed32(t,e){e.length&&this.writeMessage(t,$,e)}writePackedSFixed32(t,e){e.length&&this.writeMessage(t,W,e)}writePackedFixed64(t,e){e.length&&this.writeMessage(t,K,e)}writePackedSFixed64(t,e){e.length&&this.writeMessage(t,J,e)}writeBytesField(t,e){this.writeTag(t,2),this.writeBytes(e)}writeFixed32Field(t,e){this.writeTag(t,5),this.writeFixed32(e)}writeSFixed32Field(t,e){this.writeTag(t,5),this.writeSFixed32(e)}writeFixed64Field(t,e){this.writeTag(t,1),this.writeFixed64(e)}writeSFixed64Field(t,e){this.writeTag(t,1),this.writeSFixed64(e)}writeVarintField(t,e){this.writeTag(t,0),this.writeVarint(e)}writeSVarintField(t,e){this.writeTag(t,0),this.writeSVarint(e)}writeStringField(t,e){this.writeTag(t,2),this.writeString(e)}writeFloatField(t,e){this.writeTag(t,5),this.writeFloat(e)}writeDoubleField(t,e){this.writeTag(t,1),this.writeDouble(e)}writeBooleanField(t,e){this.writeVarintField(t,+e)}}function U(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Z(e,t,i){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(o);for(let t=i.pos-1;t>=e;t--)i.buf[t+o]=i.buf[t]}function H(e,i){for(let t=0;t<e.length;t++)i.writeVarint(e[t])}function Y(e,i){for(let t=0;t<e.length;t++)i.writeSVarint(e[t])}function V(e,i){for(let t=0;t<e.length;t++)i.writeFloat(e[t])}function G(e,i){for(let t=0;t<e.length;t++)i.writeDouble(e[t])}function X(e,i){for(let t=0;t<e.length;t++)i.writeBoolean(e[t])}function $(e,i){for(let t=0;t<e.length;t++)i.writeFixed32(e[t])}function W(e,i){for(let t=0;t<e.length;t++)i.writeSFixed32(e[t])}function K(e,i){for(let t=0;t<e.length;t++)i.writeFixed64(e[t])}function J(e,i){for(let t=0;t<e.length;t++)i.writeSFixed64(e[t])}function Q(t,e){for(var i=new ot(31),o=0;o<31;++o)i[o]=e+=1<<t[o-1];for(var n=new nt(i[30]),o=1;o<30;++o)for(var a=i[o];a<i[o+1];++a)n[a]=a-i[o]<<5|o;return{b:i,r:n}}var tt=Math.pow,et=(t,r,s)=>new Promise((e,i)=>{var o=t=>{try{a(s.next(t))}catch(t){i(t)}},n=t=>{try{a(s.throw(t))}catch(t){i(t)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,n);a((s=s.apply(t,r)).next())}),it=Uint8Array,ot=Uint16Array,nt=Int32Array,at=new it([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rt=new it([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),st=new it([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lt=Q(at,2),ht=lt.b;lt.r[ht[28]=258]=28;var ct,ut=Q(rt,0).b,mt=new ot(32768);for(ft=0;ft<32768;++ft)mt[ft]=((65280&(ct=(61680&(ct=(52428&(ct=(43690&ft)>>1|(21845&ft)<<1))>>2|(13107&ct)<<2))>>4|(3855&ct)<<4))>>8|(255&ct)<<8)>>1;var dt=function(t,e,i){for(var o=t.length,n=0,a=new ot(e);n<o;++n)t[n]&&++a[t[n]-1];var r=new ot(e);for(n=1;n<e;++n)r[n]=r[n-1]+a[n-1]<<1;if(i){for(var s=new ot(1<<e),l=15-e,n=0;n<o;++n)if(t[n])for(var h=n<<4|t[n],c=e-t[n],u=r[t[n]-1]++<<c,m=u|(1<<c)-1;u<=m;++u)s[mt[u]>>l]=h}else for(s=new ot(o),n=0;n<o;++n)t[n]&&(s[n]=mt[r[t[n]-1]++]>>15-t[n]);return s},pt=new it(288);for(ft=0;ft<144;++ft)pt[ft]=8;for(ft=144;ft<256;++ft)pt[ft]=9;for(ft=256;ft<280;++ft)pt[ft]=7;for(ft=280;ft<288;++ft)pt[ft]=8;var ft,yt=new it(32);for(ft=0;ft<32;++ft)yt[ft]=5;function _t(t,e,i,o){var n=t.length,a=o?o.length:0;if(!n||e.f&&!e.l)return i||new it(0);var r=!i||2!=e.i,s=e.i;function l(t){var e=i.length;e<t&&((t=new it(Math.max(2*e,t))).set(i),i=t)}i=i||new it(3*n);var h=e.f||0,c=e.p||0,u=e.b||0,m=e.l,d=e.d,p=e.m,f=e.n,y=8*n;do{if(!m){var h=Mt(t,c,1),_=Mt(t,c+1,3);if(c+=3,!_){var g=t[(T=St(c)+4)-4]|t[T-3]<<8,b=T+g;if(n<b){s&&kt(0);break}r&&l(u+g),i.set(t.subarray(T,b),u),e.b=u+=g,e.p=c=8*b,e.f=h;continue}if(1==_)m=vt,d=Lt,p=9,f=5;else if(2==_){var g=Mt(t,c,31)+257,x=Mt(t,c+10,15)+4,v=g+Mt(t,c+5,31)+1;c+=14;for(var L=new it(v),w=new it(19),M=0;M<x;++M)w[st[M]]=Mt(t,c+3*M,7);c+=3*x;for(var b=wt(w),C=(1<<b)-1,S=dt(w,b,1),M=0;M<v;){var T,E=S[Mt(t,c,C)];if(c+=15&E,(T=E>>4)<16)L[M++]=T;else{var k=0,z=0;for(16==T?(z=3+Mt(t,c,3),c+=2,k=L[M-1]):17==T?(z=3+Mt(t,c,7),c+=3):18==T&&(z=11+Mt(t,c,127),c+=7);z--;)L[M++]=k}}var b=L.subarray(0,g),A=L.subarray(g),p=wt(b),f=wt(A),m=dt(b,p,1),d=dt(A,f,1)}else kt(1);if(y<c){s&&kt(0);break}}r&&l(u+131072);for(var I=(1<<p)-1,P=(1<<f)-1,B=c;;B=c){var F=(k=m[Ct(t,c)&I])>>4;if(y<(c+=15&k)){s&&kt(0);break}if(k||kt(2),F<256)i[u++]=F;else{if(256==F){B=c,m=null;break}var R=F-254;264<F&&(O=at[M=F-257],R=Mt(t,c,(1<<O)-1)+ht[M],c+=O);var D=d[Ct(t,c)&P],F=D>>4;D||kt(3),c+=15&D;var O,A=ut[F];if(3<F&&(O=rt[F],A+=Ct(t,c)&(1<<O)-1,c+=O),y<c){s&&kt(0);break}r&&l(u+131072);var N=u+R;if(u<A){var q=a-A,j=Math.min(A,N);for(q+u<0&&kt(3);u<j;++u)i[u]=o[q+u]}for(;u<N;u+=4)i[u]=i[u-A],i[u+1]=i[u+1-A],i[u+2]=i[u+2-A],i[u+3]=i[u+3-A];u=N}}e.l=m,e.p=B,e.b=u,e.f=h,m&&(h=1,e.m=p,e.d=d,e.n=f)}while(!h);return u==i.length?i:Tt(i,0,u)}function gt(t){31==t[0]&&139==t[1]&&8==t[2]||kt(6,"invalid gzip data");var e=t[3],i=10;4&e&&(i+=2+(t[10]|t[11]<<8));for(var o=(e>>3&1)+(e>>4&1);0<o;o-=!t[i++]);return i+(2&e)}function bt(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function xt(t,e){return(8!=(15&t[0])||7<t[0]>>4||(t[0]<<8|t[1])%31)&&kt(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&kt(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)}var vt=dt(pt,9,1),Lt=dt(yt,5,1),wt=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Mt=function(t,e,i){var o=e/8|0;return(t[o]|t[1+o]<<8)>>(7&e)&i},Ct=function(t,e){var i=e/8|0;return(t[i]|t[1+i]<<8|t[2+i]<<16)>>(7&e)},St=function(t){return(t+7)/8|0},Tt=function(t,e,i){(null==i||i>t.length)&&(i=t.length);var o=new it(i-(e=null==e||e<0?0:e));return o.set(t.subarray(e,i)),o},Et=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],kt=function(t,e,i){e=new Error(e||Et[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,kt),!i)throw e;return e},zt=new it(0);function At(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?(o=e,(n=gt(i=t))+8>i.length&&kt(6,"invalid gzip data"),_t(i.subarray(n,-8),{i:2},o&&o.out||new it(bt(i)),o&&o.dictionary)):8!=(15&t[0])||7<t[0]>>4||(t[0]<<8|t[1])%31?_t(t,{i:2},(o=e)&&o.out,o&&o.dictionary):(e=e,_t(t.subarray(xt(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary));var i,o,n}var It="undefined"!=typeof TextDecoder&&new TextDecoder;try{It.decode(zt,{stream:!0})}catch(t){}var Pt=(t,e)=>t*tt(2,e),Bt=(t,e)=>Math.floor(t/tt(2,e)),Ft=(t,e)=>Pt(t.getUint16(e+1,!0),8)+t.getUint8(e),Rt=(t,e)=>Pt(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),Dt=(t,e,i,o)=>{t=Ot(t,e,i,o);return t?{z:e,x:i,y:o,offset:t[0],length:t[1],isDir:!1}:null},Ot=(t,e,i,o)=>{let n=0,a=t.byteLength/17-1;for(;n<=a;){var r=a+n>>1,s=((t,e,i,o,n)=>{if(t!==o.getUint8(n))return t-o.getUint8(n);t=Ft(o,n+1);if(e!==t)return e-t;n=Ft(o,n+4);return i!==n?i-n:0})(e,i,o,t,17*r);if(0<s)n=1+r;else{if(!(s<0))return[Rt(t,17*r+7),t.getUint32(17*r+13,!0)];a=r-1}}return null},Nt=(t,e)=>t.isDir&&!e.isDir?1:!t.isDir&&e.isDir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,qt=(t,e)=>{var i=t.getUint8(17*e);return{z:127&i,x:Ft(t,17*e+1),y:Ft(t,17*e+4),offset:Rt(t,17*e+7),length:t.getUint32(17*e+13,!0),isDir:i>>7==1}},jt=t=>{const e=[];var i=new DataView(t);for(let t=0;t<i.byteLength/17;t++)e.push(qt(i,t));return Ut(e)},Ut=i=>{i.sort(Nt);var t=new ArrayBuffer(17*i.length);const o=new Uint8Array(t);for(let e=0;e<i.length;e++){var n=i[e];let t=n.z;n.isDir&&(t|=128),o[17*e]=t,o[17*e+1]=255&n.x,o[17*e+2]=n.x>>8&255,o[17*e+3]=n.x>>16&255,o[17*e+4]=255&n.y,o[17*e+5]=n.y>>8&255,o[17*e+6]=n.y>>16&255,o[17*e+7]=255&n.offset,o[17*e+8]=255&Bt(n.offset,8),o[17*e+9]=255&Bt(n.offset,16),o[17*e+10]=255&Bt(n.offset,24),o[17*e+11]=255&Bt(n.offset,32),o[17*e+12]=255&Bt(n.offset,48),o[17*e+13]=255&n.length,o[17*e+14]=n.length>>8&255,o[17*e+15]=n.length>>16&255,o[17*e+16]=n.length>>24&255}return t};var Zt={getHeader:function(_){return et(this,null,function*(){var t=yield _.getBytes(0,512e3);const e=new DataView(t.data);var i,o=e.getUint32(4,!0),n=e.getUint16(8,!0);const a=new TextDecoder("utf-8"),r=JSON.parse(a.decode(new DataView(t.data,10,o)));let s=0;"gzip"===r.compression&&(s=2);let l=0;"minzoom"in r&&(l=+r.minzoom);let h=0;"maxzoom"in r&&(h=+r.maxzoom);let c=0,u=0,m=0,d=-180,p=-85,f=180,y=85;return r.bounds&&(i=r.bounds.split(","),d=+i[0],p=+i[1],f=+i[2],y=+i[3]),r.center&&(i=r.center.split(","),c=+i[0],u=+i[1],m=+i[2]),{specVersion:e.getUint16(2,!0),rootDirectoryOffset:10+o,rootDirectoryLength:17*n,jsonMetadataOffset:10,jsonMetadataLength:o,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:l,maxZoom:h,minLon:d,minLat:p,maxLon:f,maxLat:y,centerZoom:m,centerLon:c,centerLat:u,etag:t.etag}})},getZxy:function(n,a,r,s,l,h,c){return et(this,null,function*(){let t=yield r.getArrayBuffer(a,n.rootDirectoryOffset,n.rootDirectoryLength,n);1===n.specVersion&&(t=jt(t));var e=Dt(new DataView(t),s,l,h);if(e){let t=(yield a.getBytes(e.offset,e.length,c)).data;const i=new DataView(t);return 31===i.getUint8(0)&&139===i.getUint8(1)&&(t=At(new Uint8Array(t))),{data:t}}e=((t,e)=>{if(t.byteLength<17)return null;var i=t.byteLength/17,t=qt(t,i-1);if(t.isDir){i=t.z,t=e.z-i;return{z:i,x:Math.trunc(e.x/(1<<t)),y:Math.trunc(e.y/(1<<t))}}return null})(new DataView(t),{z:s,x:l,y:h});if(e){e=((t,e,i,o)=>{t=Ot(t,128|e,i,o);return t?{z:e,x:i,y:o,offset:t[0],length:t[1],isDir:!0}:null})(new DataView(t),e.z,e.x,e.y);if(e){let t=yield r.getArrayBuffer(a,e.offset,e.length,n);1===n.specVersion&&(t=jt(t));e=Dt(new DataView(t),s,l,h);if(e){let t=(yield a.getBytes(e.offset,e.length,c)).data;const o=new DataView(t);return 31===o.getUint8(0)&&139===o.getUint8(1)&&(t=At(new Uint8Array(t))),{data:t}}}}})}};function Ht(t,e){return 4294967296*(e>>>0)+(t>>>0)}function Yt(t){var e=t.buf,i=e[t.pos++];let o=127&i;return i<128?o:(i=e[t.pos++],o|=(127&i)<<7,i<128?o:(i=e[t.pos++],o|=(127&i)<<14,i<128?o:(i=e[t.pos++],o|=(127&i)<<21,i<128?o:(i=e[t.pos],o|=(15&i)<<28,function(t,e){var i=e.buf,o=i[e.pos++];let n=(112&o)>>4;if(o<128)return Ht(t,n);if(o=i[e.pos++],n|=(127&o)<<3,o<128)return Ht(t,n);if(o=i[e.pos++],n|=(127&o)<<10,o<128)return Ht(t,n);if(o=i[e.pos++],n|=(127&o)<<17,o<128)return Ht(t,n);if(o=i[e.pos++],n|=(127&o)<<24,o<128)return Ht(t,n);if(o=i[e.pos++],n|=(1&o)<<31,o<128)return Ht(t,n);throw new Error("Expected varint not more than 10 bytes")}(o,t)))))}var Vt=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Gt(i,o){return et(this,null,function*(){if(1===o||0===o)return i;if(2!==o)throw Error("Compression method not supported");{if(void 0===globalThis.DecompressionStream)return At(new Uint8Array(i));const e=new Response(i).body;if(!e)throw Error("Failed to read response stream");var t=e.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(t).arrayBuffer()}})}var Xt=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(l,h,c,u){return et(this,null,function*(){let t,e;e=c||(t=new AbortController,t.signal);const i=new Headers(this.customHeaders);i.set("range",`bytes=${l}-`+(l+h-1));let o;this.mustReload&&(o="reload");let n=yield fetch(this.url,{signal:e,cache:o,headers:i});if(0===l&&416===n.status){const s=n.headers.get("Content-Range");if(!s||!s.startsWith("bytes */"))throw Error("Missing content-length on 416 response");var a=+s.substr(8);n=yield fetch(this.url,{signal:e,cache:"reload",headers:{range:"bytes=0-"+(a-1)}})}let r=n.headers.get("Etag");if(null!=r&&r.startsWith("W/")&&(r=null),416===n.status||u&&r&&r!==u)throw this.mustReload=!0,new Kt(`Server returned non-matching ETag ${u} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(300<=n.status)throw Error("Bad response code: "+n.status);a=n.headers.get("Content-Length");if(200===n.status&&(!a||h<+a))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield n.arrayBuffer(),etag:r||void 0,cacheControl:n.headers.get("Cache-Control")||void 0,expires:n.headers.get("Expires")||void 0}})}};function $t(t,e){var i=t.getUint32(e+4,!0),e=t.getUint32(e+0,!0);return i*tt(2,32)+e}function Wt(t){var e={buf:new Uint8Array(t),pos:0},i=Yt(e);const o=[];let n=0;for(let t=0;t<i;t++){var a=Yt(e);o.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let t=0;t<i;t++)o[t].runLength=Yt(e);for(let t=0;t<i;t++)o[t].length=Yt(e);for(let t=0;t<i;t++){var r=Yt(e);0===r&&0<t?o[t].offset=o[t-1].offset+o[t-1].length:o[t].offset=r-1}return o}var Kt=class extends Error{};function Jt(a,r){return et(this,null,function*(){const t=yield a.getBytes(0,16384),e=new DataView(t.data);if(19792!==e.getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");if(function(t){const e=new DataView(t);return 2===e.getUint16(2,!0)?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):1===e.getUint16(2,!0)?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}(t.data)<3)return[yield Zt.getHeader(a)];var i=function(t,e){const i=new DataView(t);if(3<(t=i.getUint8(7)))throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:$t(i,8),rootDirectoryLength:$t(i,16),jsonMetadataOffset:$t(i,24),jsonMetadataLength:$t(i,32),leafDirectoryOffset:$t(i,40),leafDirectoryLength:$t(i,48),tileDataOffset:$t(i,56),tileDataLength:$t(i,64),numAddressedTiles:$t(i,72),numTileEntries:$t(i,80),numTileContents:$t(i,88),clustered:1===i.getUint8(96),internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:e}}(t.data.slice(0,127),t.etag),o=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),n=`${a.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|`+i.rootDirectoryLength,o=Wt(yield r(o,i.internalCompression));return[i,[n,o.length,o]]})}var Qt=class{constructor(t=100,e,i=Gt){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=i}getHeader(o){return et(this,null,function*(){var t=o.getKey();const e=this.cache.get(t);if(e)return e.lastUsed=this.counter++,yield e.data;var i=new Promise((e,i)=>{Jt(o,this.decompress).then(t=>{t[1]&&this.cache.set(t[1][0],{lastUsed:this.counter++,data:Promise.resolve(t[1][2])}),e(t[0]),this.prune()}).catch(t=>{i(t)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(o,n,a,r){return et(this,null,function*(){var t=`${o.getKey()}|${r.etag||""}|${n}|`+a;const e=this.cache.get(t);if(e)return e.lastUsed=this.counter++,yield e.data;var i=new Promise((e,i)=>{!function(e,i,o,n,a){return et(this,null,function*(){var t=yield e.getBytes(o,n,void 0,a.etag),t=Wt(yield i(t.data,a.internalCompression));if(0===t.length)throw new Error("Empty directory is invalid");return t})}(o,this.decompress,n,a,r).then(t=>{e(t),this.prune()}).catch(t=>{i(t)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getArrayBuffer(n,a,r,s){return et(this,null,function*(){const o=`${n.getKey()}|${s.etag||""}|${a}|`+r,t=this.cache.get(o);if(t)return t.lastUsed=this.counter++,yield t.data;var e=new Promise((e,i)=>{n.getBytes(a,r,void 0,s.etag).then(t=>{e(t.data),this.cache.has(o),this.prune()}).catch(t=>{i(t)})});return this.cache.set(o,{lastUsed:this.counter++,data:e}),e})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,o=void 0;this.cache.forEach((t,e)=>{t.lastUsed<i&&(i=t.lastUsed,o=e)}),o&&this.cache.delete(o)}}invalidate(n){return et(this,null,function*(){const o=n.getKey();if(this.invalidations.get(o))return yield this.invalidations.get(o);this.cache.delete(n.getKey());var t=new Promise((e,i)=>{this.getHeader(n).then(t=>{e(),this.invalidations.delete(o)}).catch(t=>{i(t)})});this.invalidations.set(o,t)})}},te=class{constructor(t,e,i){this.source="string"==typeof t?new Xt(t):t,this.decompress=i||Gt,this.cache=e||new Qt}getHeader(){return et(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,i,s){return et(this,null,function*(){var o=function(t,e,i){if(26<t)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>tt(2,t)-1||i>tt(2,t)-1)throw Error("tile x/y outside zoom level bounds");var o,n=Vt[t],t=tt(2,t);let a=0;var r,s,l,h=[e,i];let c=t/2;for(;0<c;)l=0<(h[0]&c)?1:0,o=0<(h[1]&c)?1:0,a+=c*c*(3*l^o),r=c,s=h,l=l,0===o&&(1===l&&(s[0]=r-1-s[0],s[1]=r-1-s[1]),r=s[0],s[0]=s[1],s[1]=r),c/=2;return n+a}(t,e,i),n=yield this.cache.getHeader(this.source);if(n.specVersion<3)return Zt.getZxy(n,this.source,this.cache,t,e,i,s);if(!(t<n.minZoom||t>n.maxZoom)){let e=n.rootDirectoryOffset,i=n.rootDirectoryLength;for(let t=0;t<=3;t++){var a=function(t,e){let i=0,o=t.length-1;for(;i<=o;){var n=o+i>>1,a=e-t[n].tileId;if(0<a)i=1+n;else{if(!(a<0))return t[n];o=n-1}}if(0<=o){if(0===t[o].runLength)return t[o];if(e-t[o].tileId<t[o].runLength)return t[o]}return null}(yield this.cache.getDirectory(this.source,e,i,n),o);if(!a)return;if(0<a.runLength){var r=yield this.source.getBytes(n.tileDataOffset+a.offset,a.length,s,n.etag);return{data:yield this.decompress(r.data,n.tileCompression),cacheControl:r.cacheControl,expires:r.expires}}e=n.leafDirectoryOffset+a.offset,i=a.length}throw Error("Maximum directory depth exceeded")}})}getZxy(e,i,o,n){return et(this,null,function*(){try{return yield this.getZxyAttempt(e,i,o,n)}catch(t){if(t instanceof Kt)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,i,o,n);throw t}})}getMetadataAttempt(){return et(this,null,function*(){var t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength,void 0,t.etag),t=yield this.decompress(e.data,t.internalCompression);const i=new TextDecoder("utf-8");return JSON.parse(i.decode(t))})}getMetadata(){return et(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof Kt)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw t}})}};function ee(t,e,i,o,n){!function t(e,i,o,n,a){for(;o<n;){var r,s,l,h,c;600<n-o&&(r=n-o+1,s=i-o+1,h=Math.log(r),l=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*l*(r-l)/r)*(s-r/2<0?-1:1),h=Math.max(o,Math.floor(i-s*l/r+c)),c=Math.min(n,Math.floor(i+(r-s)*l/r+c)),t(e,i,h,c,a));var u=e[i],m=o,d=n;for(ie(e,o,i),0<a(e[n],u)&&ie(e,o,n);m<d;){for(ie(e,m,d),m++,d--;a(e[m],u)<0;)m++;for(;0<a(e[d],u);)d--}0===a(e[o],u)?ie(e,o,d):ie(e,++d,n),d<=i&&(o=d+1),i<=d&&(n=d-1)}}(t,e,i||0,o||t.length-1,n||oe)}function ie(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}function oe(t,e){return t<e?-1:e<t?1:0}class ne{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let i=this.data;const o=[];if(!de(e,i))return o;const n=this.toBBox,a=[];for(;i;){for(let t=0;t<i.children.length;t++){var r=i.children[t],s=i.leaf?n(r):r;de(e,s)&&(i.leaf?o.push(r):me(e,s)?this._all(r,o):a.push(r))}i=a.pop()}return o}collides(e){let i=this.data;if(!de(e,i))return!1;const o=[];for(;i;){for(let t=0;t<i.children.length;t++){var n=i.children[t],a=i.leaf?this.toBBox(n):n;if(de(e,a)){if(i.leaf||me(e,a))return!0;o.push(n)}}i=o.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);var i;return this.data.children.length?this.data.height===t.height?this._splitRoot(this.data,t):(this.data.height<t.height&&(i=this.data,this.data=t,t=i),this._insert(t,this.data.height-t.height-1,!0)):this.data=t,this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=pe([]),this}remove(t,e){if(!t)return this;let i=this.data;var o=this.toBBox(t);const n=[],a=[];let r,s,l;for(;i||n.length;){if(i||(i=n.pop(),s=n[n.length-1],r=a.pop(),l=!0),i.leaf){var h=function(e,i,o){if(!o)return i.indexOf(e);for(let t=0;t<i.length;t++)if(o(e,i[t]))return t;return-1}(t,i.children,e);if(-1!==h)return i.children.splice(h,1),n.push(i),this._condense(n),this}l||i.leaf||!me(i,o)?s?(r++,i=s.children[r],l=!1):i=null:(n.push(i),a.push(r),r=0,s=i,i=i.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)(t.leaf?e:i).push(...t.children),t=i.pop();return e}_build(i,t,o,n){var e=o-t+1;let a=this._maxEntries,r;if(e<=a)return r=pe(i.slice(t,o+1)),ae(r,this.toBBox),r;n||(n=Math.ceil(Math.log(e)/Math.log(a)),a=Math.ceil(e/Math.pow(a,n-1))),r=pe([]),r.leaf=!1,r.height=n;var s=Math.ceil(e/a),l=s*Math.ceil(Math.sqrt(a));fe(i,t,o,l,this.compareMinX);for(let e=t;e<=o;e+=l){var h=Math.min(e+l-1,o);fe(i,e,h,s,this.compareMinY);for(let t=e;t<=h;t+=s){var c=Math.min(t+s-1,h);r.children.push(this._build(i,t,c,n-1))}}return ae(r,this.toBBox),r}_chooseSubtree(n,a,t,r){for(;;){if(r.push(a),a.leaf||r.length-1===t)break;let e=1/0,i=1/0,o;for(let t=0;t<a.children.length;t++){var s=a.children[t],l=ce(s),h=(h=n,c=s,(Math.max(c.maxX,h.maxX)-Math.min(c.minX,h.minX))*(Math.max(c.maxY,h.maxY)-Math.min(c.minY,h.minY))-l);h<i?(i=h,e=l<e?l:e,o=s):h===i&&l<e&&(e=l,o=s)}a=o||a.children[0]}var h,c;return a}_insert(t,e,i){var i=i?t:this.toBBox(t),o=[];const n=this._chooseSubtree(i,this.data,e,o);for(n.children.push(t),se(n,i);0<=e&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)}_split(t,e){const i=t[e];var o=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,o);o=this._chooseSplitIndex(i,n,o);const a=pe(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,ae(i,this.toBBox),ae(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=pe([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ae(this.data,this.toBBox)}_chooseSplitIndex(e,i,o){let n,a=1/0,r=1/0;for(let t=i;t<=o-i;t++){var s=re(e,0,t,this.toBBox),l=re(e,t,o,this.toBBox),h=(c=s,u=l,d=h=m=void 0,m=Math.max(c.minX,u.minX),h=Math.max(c.minY,u.minY),d=Math.min(c.maxX,u.maxX),u=Math.min(c.maxY,u.maxY),Math.max(0,d-m)*Math.max(0,u-h)),l=ce(s)+ce(l);h<a?(a=h,n=t,r=l<r?l:r):h===a&&l<r&&(r=l,n=t)}var c,u,m,h,d;return n||o-i}_chooseSplitAxis(t,e,i){var o=t.leaf?this.compareMinX:le,n=t.leaf?this.compareMinY:he;this._allDistMargin(t,e,i,o)<this._allDistMargin(t,e,i,n)&&t.children.sort(o)}_allDistMargin(e,i,o,t){e.children.sort(t);const n=this.toBBox;var a=re(e,0,i,n),r=re(e,o-i,o,n);let s=ue(a)+ue(r);for(let t=i;t<o-i;t++){var l=e.children[t];se(a,e.leaf?n(l):l),s+=ue(a)}for(let t=o-i-1;t>=i;t--){var h=e.children[t];se(r,e.leaf?n(h):h),s+=ue(r)}return s}_adjustParentBBoxes(e,i,o){for(let t=o;0<=t;t--)se(i[t],e)}_condense(i){for(let t=i.length-1,e;0<=t;t--)0===i[t].children.length?0<t?(e=i[t-1].children,e.splice(e.indexOf(i[t]),1)):this.clear():ae(i[t],this.toBBox)}}function ae(t,e){re(t,0,t.children.length,e,t)}function re(e,i,o,n,a){(a=a||pe(null)).minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(let t=i;t<o;t++){var r=e.children[t];se(a,e.leaf?n(r):r)}return a}function se(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function le(t,e){return t.minX-e.minX}function he(t,e){return t.minY-e.minY}function ce(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ue(t){return t.maxX-t.minX+(t.maxY-t.minY)}function me(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function de(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function pe(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function fe(t,e,i,o,n){const a=[e,i];for(;a.length;){var r;(i=a.pop())-(e=a.pop())<=o||(ee(t,r=e+Math.ceil((i-e)/o/2)*o,e,i,n),a.push(e,r,r,i))}}var ye=Object.defineProperty,_e=Math.pow,ge=(t,e)=>ye(t,"name",{value:e,configurable:!0}),be=(t,r,s)=>new Promise((e,i)=>{var o=t=>{try{a(s.next(t))}catch(t){i(t)}},n=t=>{try{a(s.throw(t))}catch(t){i(t)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,n);a((s=s.apply(t,r)).next())}),xe=class{constructor(t,e){this.str=null!=t?t:e,this.perFeature="function"==typeof this.str&&2===this.str.length}get(t,e){return"function"==typeof this.str?this.str(t,e):this.str}};ge(xe,"StringAttr");var ve=xe,Le=class{constructor(t,e=1){this.value=null!=t?t:e,this.perFeature="function"==typeof this.value&&2===this.value.length}get(t,e){return"function"==typeof this.value?this.value(t,e):this.value}};ge(Le,"NumberAttr");var we=Le,Me=class{constructor(t){var e;this.labelProps=null!=(e=null==t?void 0:t.labelProps)?e:["name"],this.textTransform=null==t?void 0:t.textTransform}get(t,e){let i,o;o="function"==typeof this.labelProps?this.labelProps(t,e):this.labelProps;for(var n of o)if(Object.prototype.hasOwnProperty.call(e.props,n)&&"string"==typeof e.props[n]){i=e.props[n];break}let a;return a="function"==typeof this.textTransform?this.textTransform(t,e):this.textTransform,i&&"uppercase"===a?i=i.toUpperCase():i&&"lowercase"===a?i=i.toLowerCase():i&&"capitalize"===a&&(i=i.toLowerCase().split(" ").map(t=>t[0].toUpperCase()+t.slice(1)).join(" ")),i}};ge(Me,"TextAttr");var Ce=Me,Se=class{constructor(t){var e;null!=t&&t.font?this.font=t.font:(this.family=null!=(e=null==t?void 0:t.fontFamily)?e:"sans-serif",this.size=null!=(e=null==t?void 0:t.fontSize)?e:12,this.weight=null==t?void 0:t.fontWeight,this.style=null==t?void 0:t.fontStyle)}get(t,e){if(this.font)return"function"==typeof this.font?this.font(t,e):this.font;let i="";this.style&&(i="function"==typeof this.style?this.style(t,e)+" ":this.style+" ");let o="";this.weight&&(o="function"==typeof this.weight?this.weight(t,e)+" ":this.weight+" ");let n;n="function"==typeof this.size?this.size(t,e):this.size;let a;return a="function"==typeof this.family?this.family(t,e):this.family,""+i+o+n+"px "+a}};ge(Se,"FontAttr");var Te=Se,Ee=class{constructor(t,e=[]){this.value=null!=t?t:e,this.perFeature="function"==typeof this.value&&2===this.value.length}get(t,e){return"function"==typeof this.value?this.value(t,e):this.value}};ge(Ee,"ArrayAttr");var ke=Ee,ze=ge((t,e,i)=>{let o=[],n,a,r,s=0,l,h=0,c=0,u=0,m,d,p,f,y=0,_=0;if(t.length<2)return[];if(2===t.length)return h=Math.sqrt(_e(t[1].x-t[0].x,2)+_e(t[1].y-t[0].y,2)),[{length:h,beginIndex:0,beginDistance:0,endIndex:2,endDistance:h}];for(c=Math.sqrt(_e(t[1].x-t[0].x,2)+_e(t[1].y-t[0].y,2)),s=1,l=t.length-1;s<l;s++)n=t[s-1],a=t[s],r=t[s+1],m=a.x-n.x,d=a.y-n.y,p=r.x-a.x,f=r.y-a.y,u=Math.sqrt(p*p+f*f),h+=c,(e<Math.acos((m*p+d*f)/(c*u))||h-_>i)&&(o.push({length:h-_,beginDistance:_,beginIndex:y,endIndex:s+1,endDistance:h}),y=s,_=h),c=u;return 0<s-y&&o.push({length:h-_+u,beginIndex:y,beginDistance:_,endIndex:s+1,endDistance:h+u}),o},"linelabel");function Ae(t,o,n,a){let r=[];for(var s of t){var l;for(l of ze(s,Math.PI/45,o))if(l.length>=o+a){let e=new C(s[l.beginIndex].x,s[l.beginIndex].y),t=s[l.endIndex-1],i=new C((t.x-e.x)/l.length,(t.y-e.y)/l.length);for(let t=a;t<l.length-o;t+=n)r.push({start:e.add(i.mult(t)),end:e.add(i.mult(t+o))})}}return r}function Ie(e,t,i,o){let n=t.x-e.x,a=t.y-e.y,r=Math.sqrt(_e(t.x-e.x,2)+_e(t.y-e.y,2)),s=[];for(let t=0;t<i+o;t+=2*o){var l=+t/r;s.push({x:e.x+l*n,y:e.y+l*a})}return s}function Pe(t,e){if(t.length<=e)return[t];var i=e-1,o=t.lastIndexOf(" ",i),n=t.indexOf(" ",i);if(-1===o&&-1===n)return[t];let a,r;return r=-1===n||0<=o&&i-o<n-i?(a=t.substring(0,o),t.substring(o+1,t.length)):(a=t.substring(0,n),t.substring(n+1,t.length)),[a,...Pe(r,e)]}ge(Ae,"simpleLabel"),ge(Ie,"lineCells"),ge(Pe,"linebreak");var Be=((co={})[co.Point=1]="Point",co[co.Line=2]="Line",co[co.Polygon=3]="Polygon",co);function Fe(t){return`${t.x}:${t.y}:`+t.z}ge(Fe,"toIndex");var Re=ge((t,e,i)=>{t.pos=e;let o=t.readVarint()+t.pos,n=1,a=0,r=0,s=0,l=1/0,h=-1/0,c=1/0,u=-1/0,m=[],d=[];for(;t.pos<o;){var p;if(a<=0&&(p=t.readVarint(),n=7&p,a=p>>3),a--,1===n||2===n)r+=t.readSVarint()*i,s+=t.readSVarint()*i,r<l&&(l=r),r>h&&(h=r),s<c&&(c=s),s>u&&(u=s),1===n&&(0<d.length&&m.push(d),d=[]),d.push(new C(r,s));else{if(7!==n)throw new Error("unknown command "+n);d&&d.push(d[0].clone())}}return d&&m.push(d),{geom:m,bbox:{minX:l,minY:c,maxX:h,maxY:u}}},"loadGeomAndBbox");function De(t,a){let e=new R(new j(t)),i=new Map;for(var[r,s]of Object.entries(e.layers)){let o=[],n=s;for(let i=0;i<n.length;i++){let t=Re(n.feature(i)._pbf,n.feature(i)._geometry,a/n.extent),e=0;for(var l of t.geom)e+=l.length;o.push({id:n.feature(i).id,geomType:n.feature(i).type,geom:t.geom,numVertices:e,bbox:t.bbox,props:n.feature(i).properties})}i.set(r,o)}return i}ge(De,"parseTile");var Oe=class{constructor(t,e){this.p="string"==typeof t?new te(t):t,this.zoomaborts=[],this.shouldCancelZooms=e}get(e,i){return be(this,null,function*(){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter(t=>t.z===e.z||(t.controller.abort(),!1)));var t=new AbortController;this.zoomaborts.push({z:e.z,controller:t});t=t.signal,t=yield this.p.getZxy(e.z,e.x,e.y,t);return t?De(t.data,i):new Map})}};ge(Oe,"PmtilesSource");var Ne=Oe,qe=class{constructor(t,e){this.url=t,this.zoomaborts=[],this.shouldCancelZooms=e}get(i,n){return be(this,null,function*(){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter(t=>t.z===i.z||(t.controller.abort(),!1)));let t=this.url.replace("{z}",i.z.toString()).replace("{x}",i.x.toString()).replace("{y}",i.y.toString()),e=new AbortController;this.zoomaborts.push({z:i.z,controller:e});let o=e.signal;return new Promise((e,i)=>{fetch(t,{signal:o}).then(t=>t.arrayBuffer()).then(t=>{t=De(t,n);e(t)}).catch(t=>{i(t)})})})}};ge(qe,"ZxySource");var je=qe,Ue=6378137,Ze=85.0511287798,He=Ue*Math.PI,Ye=ge(t=>{var e=Math.PI/180,i=Math.max(Math.min(Ze,t[0]),-Ze),i=Math.sin(i*e);return new C(Ue*t[1]*e,Ue*Math.log((1+i)/(1-i))/2)},"project");function Ve(t){return t*t}function Ge(t,e){return Ve(t.x-e.x)+Ve(t.y-e.y)}function Xe(t,e,i){var o=Ge(e,i);if(0===o)return Ge(t,e);o=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o,o=Math.max(0,Math.min(1,o));return Ge(t,new C(e.x+o*(i.x-e.x),e.y+o*(i.y-e.y)))}function $e(i,o){let n=!1;for(let t=0,e=o.length-1;t<o.length;e=t++){var a=o[t].x,r=o[t].y,s=o[e].x,l=o[e].y;r>i.y!=l>i.y&&i.x<(s-a)*(i.y-r)/(l-r)+a&&(n=!n)}return n}function We(e){let i=0;for(let t=0;t<e.length;t++){var o=(t+1)%e.length;i+=e[t].x*e[o].y,i-=e[o].x*e[t].y}return i<0}function Ke(t,e){let i=!1;for(var o of e)if(We(o))$e(t,o)&&(i=!1);else{if(i)return!0;$e(t,o)&&(i=!0)}return i}function Je(t,e){let i=1/0;for(var o of e){o=Math.sqrt(Ge(t,o[0]));o<i&&(i=o)}return i}function Qe(e,t){let i=1/0;for(var o of t)for(let t=0;t<o.length-1;t++){var n=Math.sqrt(Xe(e,o[t],o[t+1]));n<i&&(i=n)}return i}ge(Ve,"sqr"),ge(Ge,"dist2"),ge(Xe,"distToSegmentSquared"),ge($e,"isInRing"),ge(We,"isCcw"),ge(Ke,"pointInPolygon"),ge(Je,"pointMinDistToPoints"),ge(Qe,"pointMinDistToLines");var ti=class{constructor(t,e){this.source=t,this.cache=new Map,this.inflight=new Map,this.tileSize=e}get(e){return be(this,null,function*(){let a=Fe(e);return new Promise((o,n)=>{let t=this.cache.get(a);if(t)t.used=performance.now(),o(t.data);else{let t=this.inflight.get(a);t?t.push({resolve:o,reject:n}):(this.inflight.set(a,[]),this.source.get(e,this.tileSize).then(t=>{this.cache.set(a,{used:performance.now(),data:t});var e=this.inflight.get(a);if(e)for(var i of e)i.resolve(t);if(this.inflight.delete(a),o(t),64<=this.cache.size){let i=1/0,o;this.cache.forEach((t,e)=>{t.used<i&&(i=t.used,o=e)}),o&&this.cache.delete(o)}}).catch(t=>{var e=this.inflight.get(a);if(e)for(var i of e)i.reject(t);this.inflight.delete(a),n(t)}))}})})}queryFeatures(t,e,i,o){let n=Ye([e,t]),a=new C((n.x+He)/(2*He),1-(n.y+He)/(2*He));1<a.x&&(a.x=a.x-Math.floor(a.x));let r=a.mult(1<<i),s=Math.floor(r.x),l=Math.floor(r.y),h=Fe({z:i,x:s,y:l}),c=[],u=this.cache.get(h);if(u){var m,d,p=new C((r.x-s)*this.tileSize,(r.y-l)*this.tileSize);for([m,d]of u.data.entries())for(var f of d)1===f.geomType?Je(p,f.geom)<o&&c.push({feature:f,layerName:m}):2===f.geomType?Qe(p,f.geom)<o&&c.push({feature:f,layerName:m}):Ke(p,f.geom)&&c.push({feature:f,layerName:m})}return c}};ge(ti,"TileCache");var ei=ti,ii=((ko={})[ko.Left=1]="Left",ko[ko.Center=2]="Center",ko[ko.Right=3]="Right",ko),oi=((zo={})[zo.N=1]="N",zo[zo.Ne=2]="Ne",zo[zo.E=3]="E",zo[zo.Se=4]="Se",zo[zo.S=5]="S",zo[zo.Sw=6]="Sw",zo[zo.W=7]="W",zo[zo.Nw=8]="Nw",zo),ni=ge((t,e,i)=>{let o=document.createElement("canvas"),n=o.getContext("2d");return o.width=t,o.height=e,null!==n&&i(o,n),o},"createPattern"),ai=class{constructor(t){this.pattern=t.pattern,this.fill=new ve(t.fill,"black"),this.opacity=new we(t.opacity,1),this.stroke=new ve(t.stroke,"black"),this.width=new we(t.width,0),this.perFeature=null!=(t=this.fill.perFeature||this.opacity.perFeature||this.stroke.perFeature||this.width.perFeature||t.perFeature)&&t,this.doStroke=!1}before(t,e){var i;this.perFeature||(t.globalAlpha=this.opacity.get(e),t.fillStyle=this.fill.get(e),t.strokeStyle=this.stroke.get(e),0<(i=this.width.get(e))&&(this.doStroke=!0),t.lineWidth=i),!this.pattern||(i=t.createPattern(this.pattern,"repeat"))&&(t.fillStyle=i)}draw(e,t,i,o){let n=!1;var a,r;this.perFeature&&(e.globalAlpha=this.opacity.get(i,o),e.fillStyle=this.fill.get(i,o),(a=this.width.get(i,o))&&(n=!0,e.strokeStyle=this.stroke.get(i,o),e.lineWidth=a));let s=ge(()=>{e.fill(),(n||this.doStroke)&&e.stroke()},"drawPath");e.beginPath();for(r of t)for(let t=0;t<r.length;t++){var l=r[t];0===t?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}s()}};ge(ai,"PolygonSymbolizer");var ri=ai;function si(e,i){return t=>{t-=e;return 0<=t&&t<i.length?i[t]:0}}function li(t,e){let i=0;for(;e[i+1][0]<t;)i++;return i}function hi(t,e,i){return t*(i-e)+e}function ci(t,e,i,o){var n=o[e+1][0]-o[e][0],e=t-o[e][0];return 0==n?0:1===i?e/n:(_e(i,e)-1)/(_e(i,n)-1)}function ui(i,o){return t=>{if(o.length<1)return 0;if(t<=o[0][0])return o[0][1];if(t>=o[o.length-1][0])return o[o.length-1][1];var e=li(t,o);return hi(ci(t,e,i,o),o[e][1],o[e+1][1])}}function mi(t,o){return e=>{if(o.length<1)return 0;let i=t;for(let t=0;t<o.length;t++)e>=o[t][0]&&(i=o[t][1]);return i}}function di(t){return ui(1,t)}ge(si,"arr"),ge(li,"getStopIndex"),ge(hi,"interpolate"),ge(ci,"computeInterpolationFactor"),ge(ui,"exp"),ge(mi,"step"),ge(di,"linear");var pi=class{constructor(t){var e;this.color=new ve(t.color,"black"),this.width=new we(t.width),this.opacity=new we(t.opacity),this.dash=t.dash?new ke(t.dash):null,this.dashColor=new ve(t.dashColor,"black"),this.dashWidth=new we(t.dashWidth,1),this.lineCap=new ve(t.lineCap,"butt"),this.lineJoin=new ve(t.lineJoin,"miter"),this.skip=!1,this.perFeature=!!(null!=(e=this.dash)&&e.perFeature||this.color.perFeature||this.opacity.perFeature||this.width.perFeature||this.lineCap.perFeature||this.lineJoin.perFeature||t.perFeature)}before(t,e){this.perFeature||(t.strokeStyle=this.color.get(e),t.lineWidth=this.width.get(e),t.globalAlpha=this.opacity.get(e),t.lineCap=this.lineCap.get(e),t.lineJoin=this.lineJoin.get(e))}draw(e,i,o,n){if(!this.skip){let t=ge(()=>{this.perFeature&&(e.globalAlpha=this.opacity.get(o,n),e.lineCap=this.lineCap.get(o,n),e.lineJoin=this.lineJoin.get(o,n)),this.dash?(e.save(),this.perFeature?(e.lineWidth=this.dashWidth.get(o,n),e.strokeStyle=this.dashColor.get(o,n),e.setLineDash(this.dash.get(o,n))):e.setLineDash(this.dash.get(o))):(e.save(),this.perFeature&&(e.lineWidth=this.width.get(o,n),e.strokeStyle=this.color.get(o,n))),e.stroke(),e.restore()},"strokePath");e.beginPath();for(var a of i)for(let t=0;t<a.length;t++){var r=a[t];0===t?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}t()}}};ge(pi,"LineSymbolizer");var fi=pi,yi=class{constructor(t){this.name=t.name,this.sheet=t.sheet,this.dpr=window.devicePixelRatio}place(t,e,i){e[0];let o=new C(e[0][0].x,e[0][0].y),n=this.sheet.get(this.name),a=n.w/this.dpr,r=n.h/this.dpr,s={minX:o.x-a/2,minY:o.y-r/2,maxX:o.x+a/2,maxY:o.y+r/2};return[{anchor:o,bboxes:[s],draw:ge(t=>{t.globalAlpha=1,t.drawImage(this.sheet.canvas,n.x,n.y,n.w,n.h,-n.w/2/this.dpr,-n.h/2/this.dpr,n.w/2,n.h/2)},"draw")}]}};ge(yi,"IconSymbolizer");var _i=yi,gi=class{constructor(t){this.radius=new we(t.radius,3),this.fill=new ve(t.fill,"black"),this.stroke=new ve(t.stroke,"white"),this.width=new we(t.width,0),this.opacity=new we(t.opacity)}draw(t,e,i,o){t.globalAlpha=this.opacity.get(i,o);var n=this.radius.get(i,o),a=this.width.get(i,o);0<a&&(t.strokeStyle=this.stroke.get(i,o),t.lineWidth=a,t.beginPath(),t.arc(e[0][0].x,e[0][0].y,n+a/2,0,2*Math.PI),t.stroke()),t.fillStyle=this.fill.get(i,o),t.beginPath(),t.arc(e[0][0].x,e[0][0].y,n,0,2*Math.PI),t.fill()}place(e,t,i){t[0];var o=new C(t[0][0].x,t[0][0].y),t=this.radius.get(e.zoom,i);return[{anchor:o,bboxes:[{minX:o.x-t,minY:o.y-t,maxX:o.x+t,maxY:o.y+t}],draw:ge(t=>{this.draw(t,[[new C(0,0)]],e.zoom,i)},"draw")}]}};ge(gi,"CircleSymbolizer");var bi=gi,xi=class{constructor(t){this.font=new Te(t),this.text=new Ce(t),this.fill=new ve(t.fill,"black"),this.background=new ve(t.background,"white"),this.padding=new we(t.padding,0)}place(l,h,c){let u=this.text.get(l.zoom,c);if(u){let e=this.font.get(l.zoom,c);l.scratch.font=e;let t=l.scratch.measureText(u),i=t.width,o=t.actualBoundingBoxAscent,n=t.actualBoundingBoxDescent;h[0];let a=new C(h[0][0].x,h[0][0].y),r=this.padding.get(l.zoom,c),s={minX:a.x-i/2-r,minY:a.y-o-r,maxX:a.x+i/2+r,maxY:a.y+n+r};return[{anchor:a,bboxes:[s],draw:ge(t=>{t.globalAlpha=1,t.fillStyle=this.background.get(l.zoom,c),t.fillRect(-i/2-r,-o-r,i+2*r,o+n+2*r),t.fillStyle=this.fill.get(l.zoom,c),t.font=e,t.fillText(u,-i/2,0)},"draw")}]}}};ge(xi,"ShieldSymbolizer");var vi=xi,Li=class{constructor(t){this.list=t}place(r,s,l){var h=this.list[0].place(r,s,l);if(h){let e=h[0],t=e.anchor,i=e.bboxes[0],o=i.maxY-i.minY,n=[{draw:e.draw,translate:{x:0,y:0}}],a=[[new C(s[0][0].x,s[0][0].y+o)]];for(let t=1;t<this.list.length;t++)(h=this.list[t].place(r,a,l))&&(e=h[0],i=Mi(i,e.bboxes[0]),n.push({draw:e.draw,translate:{x:0,y:o}}));return[{anchor:t,bboxes:[i],draw:ge(t=>{for(var e of n)t.save(),t.translate(e.translate.x,e.translate.y),e.draw(t),t.restore()},"draw")}]}}};ge(Li,"FlexSymbolizer");var wi=Li,Mi=ge((t,e)=>({minX:Math.min(t.minX,e.minX),minY:Math.min(t.minY,e.minY),maxX:Math.max(t.maxX,e.maxX),maxY:Math.max(t.maxY,e.maxY)}),"mergeBbox"),Ci=class{constructor(t){this.list=t}place(n,a,r){let t=this.list[0];if(t){var s=t.place(n,a,r);if(s){let e=s[0],t=e.anchor,i=e.bboxes[0],o=[e.draw];for(let t=1;t<this.list.length;t++){if(!(s=this.list[t].place(n,a,r)))return;e=s[0],i=Mi(i,e.bboxes[0]),o.push(e.draw)}return[{anchor:t,bboxes:[i],draw:ge(t=>{for(var e of o)e(t)},"draw")}]}}}};ge(Ci,"GroupSymbolizer");var Si=Ci,Ti=class{constructor(t){this.symbolizer=t}place(t,a,r){a=a[0][0],r=this.symbolizer.place(t,[[new C(0,0)]],r);if(r&&0!==r.length){let e=r[0],i=e.bboxes[0],o=i.maxX-i.minX,n=i.maxY-i.minY,t={minX:a.x-o/2,maxX:a.x+o/2,minY:a.y-n/2,maxY:a.y+n/2};return[{anchor:a,bboxes:[t],draw:ge(t=>{t.translate(-o/2,n/2-i.maxY),e.draw(t,{justify:2})},"draw")}]}}};ge(Ti,"CenteredSymbolizer");var Ei=Ti,ki=class{constructor(t,e){this.padding=new we(t,0),this.symbolizer=e}place(t,e,i){e=this.symbolizer.place(t,e,i);if(e&&0!==e.length){var o,n=this.padding.get(t.zoom,i);for(o of e)for(var a of o.bboxes)a.minX-=n,a.minY-=n,a.maxX+=n,a.maxY+=n;return e}}};ge(ki,"Padding");var zi=ki,Ai=class{constructor(t){this.font=new Te(t),this.text=new Ce(t),this.fill=new ve(t.fill,"black"),this.stroke=new ve(t.stroke,"black"),this.width=new we(t.width,0),this.lineHeight=new we(t.lineHeight,1),this.letterSpacing=new we(t.letterSpacing,0),this.maxLineCodeUnits=new we(t.maxLineChars,15),this.justify=t.justify}place(m,d,p){var f=this.text.get(m.zoom,p);if(f){let e=this.font.get(m.zoom,p);m.scratch.font=e;let l=this.letterSpacing.get(m.zoom,p),h=Pe(f,this.maxLineCodeUnits.get(m.zoom,p)),t="",i=0;for(var y of h)y.length>i&&(i=y.length,t=y);let o=m.scratch.measureText(t),c=o.width+l*(i-1),n=o.actualBoundingBoxAscent,a=o.actualBoundingBoxDescent,u=(n+a)*this.lineHeight.get(m.zoom,p),r=new C(d[0][0].x,d[0][0].y),s={minX:r.x,minY:r.y-n,maxX:r.x+c,maxY:r.y+a+(h.length-1)*u};return[{anchor:r,bboxes:[s],draw:ge((i,t)=>{i.globalAlpha=1,i.font=e,i.fillStyle=this.fill.get(m.zoom,p);let o=this.width.get(m.zoom,p),n=0;for(var a of h){let e=0;if(2===this.justify||t&&2===t.justify?e=(c-i.measureText(a).width)/2:(3===this.justify||t&&3===t.justify)&&(e=c-i.measureText(a).width),o)if(i.lineWidth=2*o,i.strokeStyle=this.stroke.get(m.zoom,p),0<l){let t=e;for(var r of a)i.strokeText(r,t,n),t+=i.measureText(r).width+l}else i.strokeText(a,e,n);if(0<l){let t=e;for(var s of a)i.fillText(s,t,n),t+=i.measureText(s).width+l}else i.fillText(a,e,n);n+=u}},"draw")}]}}};ge(Ai,"TextSymbolizer");var Ii=Ai,Pi=class{constructor(t){this.centered=new Ei(new Ii(t))}place(t,e,i){return this.centered.place(t,e,i)}};ge(Pi,"CenteredTextSymbolizer");var Bi=Pi,Fi=class{constructor(t,e){this.symbolizer=t,this.offsetX=new we(e.offsetX,0),this.offsetY=new we(e.offsetY,0),this.justify=null!=(t=e.justify)?t:void 0,this.placements=null!=(t=e.placements)?t:[2,6,8,4,1,3,5,7],this.ddValues=null!=(e=e.ddValues)?e:()=>({})}place(b,t,x){if(1===x.geomType){let _=t[0][0],g=this.symbolizer.place(b,[[new C(0,0)]],x);if(g&&0!==g.length){let e=g[0],i=e.bboxes[0],t=this.offsetX,o=this.offsetY,n=this.justify,a=this.placements,{offsetX:r,offsetY:s,justify:l,placements:h}=this.ddValues(b.zoom,x)||{};r&&(t=new we(r,0)),s&&(o=new we(s,0)),l&&(n=l),h&&(a=h);let c=t.get(b.zoom,x),u=o.get(b.zoom,x),m=ge((t,e)=>({minX:t.x+e.x+i.minX,minY:t.y+e.y+i.minY,maxX:t.x+e.x+i.maxX,maxY:t.y+e.y+i.maxY}),"getBbox"),d=new C(c,u),p,f=ge(t=>{t.translate(d.x,d.y),e.draw(t,{justify:p})},"draw"),y=ge((t,e)=>{e=m(t,e);if(!b.index.bboxCollides(e,b.order))return[{anchor:_,bboxes:[e],draw:f}]},"placeLabelInPoint");for(var v of a){var L=this.computeXaxisOffset(c,i,v),w=this.computeYaxisOffset(u,i,v);return p=this.computeJustify(n,v),d=new C(L,w),y(_,d)}}}}computeXaxisOffset(t,e,i){var o=e.maxX,e=o/2;return[1,5].includes(i)?t-e:[8,7,6].includes(i)?t-o:t}computeYaxisOffset(t,e,i){var o=Math.abs(e.minY),n=e.maxY,e=(e.minY+e.maxY)/2;return[3,7].includes(i)?t-e:[8,2,1].includes(i)?t-n:[6,4,5].includes(i)?t+o:t}computeJustify(t,e){return t||([1,5].includes(e)?2:[2,3,4].includes(e)?1:3)}};ge(Fi,"OffsetSymbolizer");var Ri=Fi,Di=class{constructor(t){this.symbolizer=new Ri(new Ii(t),t)}place(t,e,i){return this.symbolizer.place(t,e,i)}};ge(Di,"OffsetTextSymbolizer");var Oi=Di,lt=((Ao={})[Ao.Above=1]="Above",Ao[Ao.Center=2]="Center",Ao[Ao.Below=3]="Below",Ao),It=class{constructor(t){var e;this.font=new Te(t),this.text=new Ce(t),this.fill=new ve(t.fill,"black"),this.stroke=new ve(t.stroke,"black"),this.width=new we(t.width,0),this.offset=new we(t.offset,0),this.position=null!=(e=t.position)?e:1,this.maxLabelCodeUnits=new we(t.maxLabelChars,40),this.repeatDistance=new we(t.repeatDistance,250)}place(c,i,u){let m=this.text.get(c.zoom,u);if(m&&!(m.length>this.maxLabelCodeUnits.get(c.zoom,u))){var t=u.bbox;if(!(t.maxY-t.minY<20&&t.maxX-t.minX<20)){let a=this.font.get(c.zoom,u);c.scratch.font=a;let t=c.scratch.measureText(m),r=t.width,s=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent,l=this.repeatDistance.get(c.zoom,u);4<c.overzoom&&(l*=1<<c.overzoom-4);let h=2*s,e=Ae(i,r,l,h);if(0!==e.length){let i=[];for(var d of e){let o=d.end.x-d.start.x,n=d.end.y-d.start.y,t=Ie(d.start,d.end,r,h/2).map(t=>({minX:t.x-h/2,minY:t.y-h/2,maxX:t.x+h/2,maxY:t.y+h/2})),e=ge(t=>{t.globalAlpha=1,t.rotate(Math.atan2(n,o)),o<0&&(t.scale(-1,-1),t.translate(-r,0));let e=0;3===this.position?e+=s:2===this.position&&(e+=s/2),t.translate(0,e-this.offset.get(c.zoom,u)),t.font=a;var i=this.width.get(c.zoom,u);i&&(t.lineWidth=i,t.strokeStyle=this.stroke.get(c.zoom,u),t.strokeText(m,0,0)),t.fillStyle=this.fill.get(c.zoom,u),t.fillText(m,0,0)},"draw");i.push({anchor:d.start,bboxes:t,draw:e,deduplicationKey:m,deduplicationDistance:l})}return i}}}}};ge(It,"LineLabelSymbolizer");var Ni=It,qi=ge((t,e)=>{e=t[e];return"string"==typeof e?e:""},"getString"),ji=ge((t,e)=>{e=t[e];return"number"==typeof e?e:0},"getNumber"),Ui=ge(i=>[{dataLayer:"earth",symbolizer:new ri({fill:i.earth})},{dataLayer:"landuse",symbolizer:new ri({fill:ge((t,e)=>A(i.park_a,i.park_b,Math.min(Math.max(t/12,12),0)),"fill")}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["allotments","village_green","playground"].includes(e)},"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.park_b,opacity:.7}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["national_park","park","cemetery","protected_area","nature_reserve","forest","golf_course"].includes(e)},"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.hospital}),filter:ge((t,e)=>"hospital"===e.props["pmap:kind"],"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.industrial}),filter:ge((t,e)=>"industrial"===e.props["pmap:kind"],"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.school}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["school","university","college"].includes(e)},"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.beach}),filter:ge((t,e)=>"beach"===e.props["pmap:kind"],"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.zoo}),filter:ge((t,e)=>"zoo"===e.props["pmap:kind"],"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.zoo}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["military","naval_base","airfield"].includes(e)},"filter")},{dataLayer:"natural",symbolizer:new ri({fill:ge((t,e)=>A(i.wood_a,i.wood_b,Math.min(Math.max(t/12,12),0)),"fill")}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["wood","nature_reserve","forest"].includes(e)},"filter")},{dataLayer:"natural",symbolizer:new ri({fill:ge((t,e)=>A(i.scrub_a,i.scrub_b,Math.min(Math.max(t/12,12),0)),"fill")}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["scrub","grassland","grass"].includes(e)},"filter")},{dataLayer:"natural",symbolizer:new ri({fill:i.scrub_b}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["scrub","grassland","grass"].includes(e)},"filter")},{dataLayer:"natural",symbolizer:new ri({fill:i.glacier}),filter:ge((t,e)=>"glacier"===e.props["pmap:kind"],"filter")},{dataLayer:"natural",symbolizer:new ri({fill:i.sand}),filter:ge((t,e)=>"sand"===e.props["pmap:kind"],"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.aerodrome}),filter:ge((t,e)=>"aerodrome"===e.props["pmap:kind"],"filter")},{dataLayer:"water",symbolizer:new ri({fill:i.water})},{dataLayer:"transit",symbolizer:new fi({color:i.runway,width:ge((t,e)=>ui(1.6,[[11,0],[13,4],[19,30]])(t),"width")}),filter:ge((t,e)=>"runway"===e.props["pmap:kind_detail"],"filter")},{dataLayer:"transit",symbolizer:new fi({color:i.runway,width:ge((t,e)=>ui(1.6,[[14,0],[14.5,1],[16,6]])(t),"width")}),filter:ge((t,e)=>"taxiway"===e.props["pmap:kind_detail"],"filter")},{dataLayer:"transit",symbolizer:new fi({color:i.pier,width:ge((t,e)=>ui(1.6,[[13,0],[13.5,0,5],[21,16]])(t),"width")}),filter:ge((t,e)=>"pier"===e.props["pmap:kind"],"filter")},{dataLayer:"physical_line",minzoom:14,symbolizer:new fi({color:i.water,width:ge((t,e)=>ui(1.6,[[9,0],[9.5,1],[18,12]])(t),"width")}),filter:ge((t,e)=>"river"===e.props["pmap:kind"],"filter")},{dataLayer:"physical_line",minzoom:14,symbolizer:new fi({color:i.water,width:.5}),filter:ge((t,e)=>"stream"===e.props["pmap:kind"],"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.pedestrian}),filter:ge((t,e)=>"pedestrian"===e.props["pmap:kind"],"filter")},{dataLayer:"landuse",symbolizer:new ri({fill:i.pier}),filter:ge((t,e)=>"pier"===e.props["pmap:kind"],"filter")},{dataLayer:"buildings",symbolizer:new ri({fill:i.buildings,opacity:.5})},{dataLayer:"roads",symbolizer:new fi({color:i.major,width:ge((t,e)=>ui(1.6,[[14,0],[20,7]])(t),"width")}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["other","path"].includes(e)},"filter")},{dataLayer:"roads",symbolizer:new fi({color:i.major,width:ge((t,e)=>ui(1.6,[[13,0],[18,8]])(t),"width")}),filter:ge((t,e)=>"minor_road"===e.props["pmap:kind"],"filter")},{dataLayer:"roads",symbolizer:new fi({color:i.major,width:ge((t,e)=>ui(1.6,[[7,0],[12,1.2],[15,3],[18,13]])(t),"width")}),filter:ge((t,e)=>"medium_road"===e.props["pmap:kind"],"filter")},{dataLayer:"roads",symbolizer:new fi({color:i.major,width:ge((t,e)=>ui(1.6,[[6,0],[12,1.6],[15,3],[18,13]])(t),"width")}),filter:ge((t,e)=>"major_road"===e.props["pmap:kind"],"filter")},{dataLayer:"roads",symbolizer:new fi({color:i.major,width:ge((t,e)=>ui(1.6,[[3,0],[6,1.1],[12,1.6],[15,5],[18,15]])(t),"width")}),filter:ge((t,e)=>"highway"===e.props["pmap:kind"],"filter")},{dataLayer:"boundaries",symbolizer:new fi({dash:[3,2],color:i.boundaries,width:1}),filter:ge((t,e)=>{e=e.props["pmap:min_admin_level"];return"number"==typeof e&&e<=2},"filter")},{dataLayer:"transit",symbolizer:new fi({dash:[.3,.75],color:i.railway,dashWidth:ge((t,e)=>ui(1.6,[[4,0],[7,.15],[19,9]])(t),"dashWidth"),opacity:.5}),filter:ge((t,e)=>"rail"===e.props["pmap:kind"],"filter")},{dataLayer:"boundaries",symbolizer:new fi({dash:[3,2],color:i.boundaries,width:.5}),filter:ge((t,e)=>{e=e.props["pmap:min_admin_level"];return"number"==typeof e&&2<e},"filter")}],"paintRules"),Zi=ge(t=>{let i=["name"];return[{dataLayer:"roads",symbolizer:new Ni({labelProps:i,fill:t.roads_label_minor,font:"400 12px sans-serif",width:2,stroke:t.roads_label_minor_halo}),minzoom:16,filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["minor_road","other","path"].includes(e)},"filter")},{dataLayer:"roads",symbolizer:new Ni({labelProps:i,fill:t.roads_label_major,font:"400 12px sans-serif",width:2,stroke:t.roads_label_major_halo}),minzoom:12,filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["highway","major_road","medium_road"].includes(e)},"filter")},{dataLayer:"roads",symbolizer:new Ni({labelProps:i,fill:t.roads_label_major,font:"400 12px sans-serif",width:2,stroke:t.roads_label_major_halo}),minzoom:12,filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["highway","major_road","medium_road"].includes(e)},"filter")},{dataLayer:"physical_point",symbolizer:new Bi({labelProps:i,fill:t.ocean_label,lineHeight:1.5,letterSpacing:1,font:ge((t,e)=>`400 ${di([[3,10],[10,12]])(t)}px sans-serif`,"font"),textTransform:"uppercase"}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["ocean","bay","strait","fjord"].includes(e)},"filter")},{dataLayer:"physical_point",symbolizer:new Bi({labelProps:i,fill:t.ocean_label,lineHeight:1.5,letterSpacing:1,font:ge((t,e)=>`400 ${di([[3,0],[6,12],[10,12]])(t)}px sans-serif`,"font")}),filter:ge((t,e)=>{e=qi(e.props,"pmap:kind");return["sea","lake","water"].includes(e)},"filter")},{dataLayer:"places",symbolizer:new Bi({labelProps:ge((t,e)=>t<6?["name:short"]:i,"labelProps"),fill:t.state_label,stroke:t.state_label_halo,width:1,lineHeight:1.5,font:ge((t,e)=>t<6?"400 16px sans-serif":"400 12px sans-serif","font"),textTransform:"uppercase"}),filter:ge((t,e)=>"region"===e.props["pmap:kind"],"filter")},{dataLayer:"places",symbolizer:new Bi({labelProps:i,fill:t.country_label,lineHeight:1.5,font:ge((t,e)=>"600 12px sans-serif","font"),textTransform:"uppercase"}),filter:ge((t,e)=>"country"===e.props["pmap:kind"],"filter")},{dataLayer:"places",minzoom:9,symbolizer:new Bi({labelProps:i,fill:t.city_label,lineHeight:1.5,font:ge((t,e)=>{if(!e)return"400 12px sans-serif";let i=e.props["pmap:min_zoom"],o=400;i&&i<=5&&(o=600);let n=12,a=e.props["pmap:population_rank"];return a&&9<a&&(n=16),`${o} ${n}px sans-serif`},"font")}),sort:ge((t,e)=>{return ji(t,"pmap:population_rank")-ji(e,"pmap:population_rank")},"sort"),filter:ge((t,e)=>"locality"===e.props["pmap:kind"],"filter")},{dataLayer:"places",maxzoom:8,symbolizer:new Si([new bi({radius:2,fill:t.city_circle,stroke:t.city_circle_stroke,width:1.5}),new Oi({labelProps:i,fill:t.city_label,stroke:t.city_label_halo,width:1,offsetX:6,offsetY:4.5,font:ge((t,e)=>"400 12px sans-serif","font")})]),filter:ge((t,e)=>"locality"===e.props["pmap:kind"],"filter")}]},"labelRules"),Hi={light:{background:"#cccccc",earth:"#e0e0e0",park_a:"#cfddd5",park_b:"#9cd3b4",hospital:"#e4dad9",industrial:"#d1dde1",school:"#e4ded7",wood_a:"#d0ded0",wood_b:"#a0d9a0",pedestrian:"#e3e0d4",scrub_a:"#cedcd7",scrub_b:"#99d2bb",glacier:"#e7e7e7",sand:"#e2e0d7",beach:"#e8e4d0",aerodrome:"#dadbdf",runway:"#e9e9ed",water:"#80deea",pier:"#e0e0e0",zoo:"#c6dcdc",military:"#dcdcdc",tunnel_other_casing:"#e0e0e0",tunnel_minor_casing:"#e0e0e0",tunnel_link_casing:"#e0e0e0",tunnel_medium_casing:"#e0e0e0",tunnel_major_casing:"#e0e0e0",tunnel_highway_casing:"#e0e0e0",tunnel_other:"#d5d5d5",tunnel_minor:"#d5d5d5",tunnel_link:"#d5d5d5",tunnel_medium:"#d5d5d5",tunnel_major:"#d5d5d5",tunnel_highway:"#d5d5d5",transit_pier:"#e0e0e0",buildings:"#cccccc",minor_service_casing:"#e0e0e0",minor_casing:"#e0e0e0",link_casing:"#e0e0e0",medium_casing:"#e0e0e0",major_casing_late:"#e0e0e0",highway_casing_late:"#e0e0e0",other:"#ebebeb",minor_service:"#ebebeb",minor_a:"#ebebeb",minor_b:"#ffffff",link:"#ffffff",medium:"#f5f5f5",major_casing_early:"#e0e0e0",major:"#ffffff",highway_casing_early:"#e0e0e0",highway:"#ffffff",railway:"#a7b1b3",boundaries:"#adadad",waterway_label:"#ffffff",bridges_other_casing:"#e0e0e0",bridges_minor_casing:"#e0e0e0",bridges_link_casing:"#e0e0e0",bridges_medium_casing:"#e0e0e0",bridges_major_casing:"#e0e0e0",bridges_highway_casing:"#e0e0e0",bridges_other:"#ebebeb",bridges_minor:"#ffffff",bridges_link:"#ffffff",bridges_medium:"#f0eded",bridges_major:"#f5f5f5",bridges_highway:"#ffffff",roads_label_minor:"#91888b",roads_label_minor_halo:"#ffffff",roads_label_major:"#938a8d",roads_label_major_halo:"#ffffff",ocean_label:"#ffffff",peak_label:"#7e9aa0",subplace_label:"#8f8f8f",subplace_label_halo:"#e0e0e0",city_circle:"#ffffff",city_circle_stroke:"#a3a3a3",city_label:"#5c5c5c",city_label_halo:"#e0e0e0",state_label:"#b3b3b3",state_label_halo:"#e0e0e0",country_label:"#a3a3a3"},dark:{background:"#34373d",earth:"#1f1f1f",park_a:"#232325",park_b:"#232325",hospital:"#252424",industrial:"#222222",school:"#262323",wood_a:"#202121",wood_b:"#202121",pedestrian:"#1e1e1e",scrub_a:"#222323",scrub_b:"#222323",glacier:"#1c1c1c",sand:"#212123",beach:"#28282a",aerodrome:"#1e1e1e",runway:"#333333",water:"#34373d",pier:"#222222",zoo:"#222323",military:"#242323",tunnel_other_casing:"#141414",tunnel_minor_casing:"#141414",tunnel_link_casing:"#141414",tunnel_medium_casing:"#141414",tunnel_major_casing:"#141414",tunnel_highway_casing:"#141414",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#333333",buildings:"#111111",minor_service_casing:"#1f1f1f",minor_casing:"#1f1f1f",link_casing:"#1f1f1f",medium_casing:"#1f1f1f",major_casing_late:"#1f1f1f",highway_casing_late:"#1f1f1f",other:"#333333",minor_service:"#333333",minor_a:"#3d3d3d",minor_b:"#333333",link:"#3d3d3d",medium:"#3d3d3d",major_casing_early:"#1f1f1f",major:"#3d3d3d",highway_casing_early:"#1f1f1f",highway:"#474747",railway:"#000000",boundaries:"#5b6374",waterway_label:"#717784",bridges_other_casing:"#2b2b2b",bridges_minor_casing:"#1f1f1f",bridges_link_casing:"#1f1f1f",bridges_medium_casing:"#1f1f1f",bridges_major_casing:"#1f1f1f",bridges_highway_casing:"#1f1f1f",bridges_other:"#333333",bridges_minor:"#333333",bridges_link:"#3d3d3d",bridges_medium:"#3d3d3d",bridges_major:"#3d3d3d",bridges_highway:"#474747",roads_label_minor:"#525252",roads_label_minor_halo:"#1f1f1f",roads_label_major:"#666666",roads_label_major_halo:"#1f1f1f",ocean_label:"#717784",peak_label:"#898080",subplace_label:"#525252",subplace_label_halo:"#1f1f1f",city_circle:"#000000",city_circle_stroke:"#7a7a7a",city_label:"#7a7a7a",city_label_halo:"#212121",state_label:"#3d3d3d",state_label_halo:"#1f1f1f",country_label:"#5c5c5c"},white:{background:"#ffffff",earth:"#ffffff",park_a:"#fcfcfc",park_b:"#fcfcfc",hospital:"#f8f8f8",industrial:"#fcfcfc",school:"#f8f8f8",wood_a:"#fafafa",wood_b:"#fafafa",pedestrian:"#fdfdfd",scrub_a:"#fafafa",scrub_b:"#fafafa",glacier:"#fcfcfc",sand:"#fafafa",beach:"#f6f6f6",aerodrome:"#fdfdfd",runway:"#efefef",water:"#dcdcdc",pier:"#f5f5f5",zoo:"#f7f7f7",military:"#fcfcfc",tunnel_other_casing:"#d6d6d6",tunnel_minor_casing:"#fcfcfc",tunnel_link_casing:"#fcfcfc",tunnel_medium_casing:"#fcfcfc",tunnel_major_casing:"#fcfcfc",tunnel_highway_casing:"#fcfcfc",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#efefef",buildings:"#efefef",minor_service_casing:"#ffffff",minor_casing:"#ffffff",link_casing:"#ffffff",medium_casing:"#ffffff",major_casing_late:"#ffffff",highway_casing_late:"#ffffff",other:"#f5f5f5",minor_service:"#f5f5f5",minor_a:"#ebebeb",minor_b:"#f5f5f5",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#ffffff",major:"#ebebeb",highway_casing_early:"#ffffff",highway:"#ebebeb",railway:"#d6d6d6",boundaries:"#adadad",waterway_label:"#adadad",bridges_other_casing:"#ffffff",bridges_minor_casing:"#ffffff",bridges_link_casing:"#ffffff",bridges_medium_casing:"#ffffff",bridges_major_casing:"#ffffff",bridges_highway_casing:"#ffffff",bridges_other:"#f5f5f5",bridges_minor:"#f5f5f5",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#adadad",roads_label_minor_halo:"#ffffff",roads_label_major:"#999999",roads_label_major_halo:"#ffffff",ocean_label:"#adadad",peak_label:"#adadad",subplace_label:"#8f8f8f",subplace_label_halo:"#ffffff",city_circle:"#ffffff",city_circle_stroke:"#adadad",city_label:"#5c5c5c",city_label_halo:"#ffffff",state_label:"#b3b3b3",state_label_halo:"#ffffff",country_label:"#b8b8b8"},grayscale:{background:"#a3a3a3",earth:"#cccccc",park_a:"#c2c2c2",park_b:"#c2c2c2",hospital:"#d0d0d0",industrial:"#c6c6c6",school:"#d0d0d0",wood_a:"#c2c2c2",wood_b:"#c2c2c2",pedestrian:"#c4c4c4",scrub_a:"#c2c2c2",scrub_b:"#c2c2c2",glacier:"#d2d2d2",sand:"#d2d2d2",beach:"#d2d2d2",aerodrome:"#c9c9c9",runway:"#f5f5f5",water:"#a3a3a3",pier:"#b8b8b8",zoo:"#c7c7c7",military:"#bfbfbf",tunnel_other_casing:"#b8b8b8",tunnel_minor_casing:"#b8b8b8",tunnel_link_casing:"#b8b8b8",tunnel_medium_casing:"#b8b8b8",tunnel_major_casing:"#b8b8b8",tunnel_highway_casing:"#b8b8b8",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#b8b8b8",buildings:"#e0e0e0",minor_service_casing:"#cccccc",minor_casing:"#cccccc",link_casing:"#cccccc",medium_casing:"#cccccc",major_casing_late:"#cccccc",highway_casing_late:"#cccccc",other:"#e0e0e0",minor_service:"#e0e0e0",minor_a:"#ebebeb",minor_b:"#e0e0e0",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#cccccc",major:"#ebebeb",highway_casing_early:"#cccccc",highway:"#ebebeb",railway:"#f5f5f5",boundaries:"#5c5c5c",waterway_label:"#7a7a7a",bridges_other_casing:"#cccccc",bridges_minor_casing:"#cccccc",bridges_link_casing:"#cccccc",bridges_medium_casing:"#cccccc",bridges_major_casing:"#cccccc",bridges_highway_casing:"#cccccc",bridges_other:"#e0e0e0",bridges_minor:"#e0e0e0",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#999999",roads_label_minor_halo:"#e0e0e0",roads_label_major:"#8f8f8f",roads_label_major_halo:"#ebebeb",ocean_label:"#7a7a7a",peak_label:"#5c5c5c",subplace_label:"#7a7a7a",subplace_label_halo:"#cccccc",city_circle:"#c2c2c2",city_circle_stroke:"#7a7a7a",city_label:"#474747",city_label_halo:"#cccccc",state_label:"#999999",state_label_halo:"#cccccc",country_label:"#858585"},black:{background:"#2b2b2b",earth:"#141414",park_a:"#181818",park_b:"#181818",hospital:"#1d1d1d",industrial:"#101010",school:"#111111",wood_a:"#1a1a1a",wood_b:"#1a1a1a",pedestrian:"#191919",scrub_a:"#1c1c1c",scrub_b:"#1c1c1c",glacier:"#191919",sand:"#161616",beach:"#1f1f1f",aerodrome:"#191919",runway:"#323232",water:"#333333",pier:"#0a0a0a",zoo:"#191919",military:"#121212",tunnel_other_casing:"#101010",tunnel_minor_casing:"#101010",tunnel_link_casing:"#101010",tunnel_medium_casing:"#101010",tunnel_major_casing:"#101010",tunnel_highway_casing:"#101010",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#0a0a0a",buildings:"#0a0a0a",minor_service_casing:"#141414",minor_casing:"#141414",link_casing:"#141414",medium_casing:"#141414",major_casing_late:"#141414",highway_casing_late:"#141414",other:"#1f1f1f",minor_service:"#1f1f1f",minor_a:"#292929",minor_b:"#1f1f1f",link:"#1f1f1f",medium:"#292929",major_casing_early:"#141414",major:"#292929",highway_casing_early:"#141414",highway:"#292929",railway:"#292929",boundaries:"#707070",waterway_label:"#707070",bridges_other_casing:"#141414",bridges_minor_casing:"#141414",bridges_link_casing:"#141414",bridges_medium_casing:"#141414",bridges_major_casing:"#141414",bridges_highway_casing:"#141414",bridges_other:"#1f1f1f",bridges_minor:"#1f1f1f",bridges_link:"#292929",bridges_medium:"#292929",bridges_major:"#292929",bridges_highway:"#292929",roads_label_minor:"#525252",roads_label_minor_halo:"#141414",roads_label_major:"#5c5c5c",roads_label_major_halo:"#141414",ocean_label:"#707070",peak_label:"#707070",subplace_label:"#5c5c5c",subplace_label_halo:"#141414",city_circle:"#000000",city_circle_stroke:"#666666",city_label:"#999999",city_label_halo:"#141414",state_label:"#3d3d3d",state_label_halo:"#141414",country_label:"#707070"}},Yi=ge((t,e,i)=>{let o=[];for(var n of t){let t=[];for(var a of n)t.push(a.clone().mult(e).add(i));o.push(t)}return o},"transformGeom"),Vi=ge((t,e)=>{e=1<<e;return t<0?e+t:e<=t?t%e:t},"wrap"),zt=class{constructor(t,e,i){this.tileCache=t,this.maxDataLevel=e,this.levelDiff=i}dataTilesForBounds(t,e){let i=_e(2,t)/_e(2,Math.ceil(t)),o=[],n=1,a=this.tileCache.tileSize;if(t<this.levelDiff)n=1/(1<<this.levelDiff-t)*i,o.push({dataTile:{z:0,x:0,y:0},origin:new C(0,0),scale:n,dim:a*n});else if(t<=this.levelDiff+this.maxDataLevel){var r=1<<this.levelDiff,s=256*i,l=Math.ceil(t)-this.levelDiff,h=Math.floor(e.minX/r/s),c=Math.floor(e.minY/r/s),u=Math.floor(e.maxX/r/s),m=Math.floor(e.maxY/r/s);for(let e=h;e<=u;e++)for(let t=c;t<=m;t++){var d=new C(e*r*s,t*r*s);o.push({dataTile:{z:l,x:Vi(e,l),y:Vi(t,l)},origin:d,scale:i,dim:a*i})}}else{var p=1<<this.levelDiff;n=(1<<Math.ceil(t)-this.maxDataLevel-this.levelDiff)*i;var t=Math.floor(e.minX/p/256/n),f=Math.floor(e.minY/p/256/n),y=Math.floor(e.maxX/p/256/n),_=Math.floor(e.maxY/p/256/n);for(let e=t;e<=y;e++)for(let t=f;t<=_;t++){var g=new C(e*p*256*n,t*p*256*n);o.push({dataTile:{z:this.maxDataLevel,x:Vi(e,this.maxDataLevel),y:Vi(t,this.maxDataLevel)},origin:g,scale:n,dim:a*n})}}return o}dataTileForDisplayTile(t){let e,i=1,o=this.tileCache.tileSize,n;var a;return t.z<this.levelDiff?(e={z:0,x:0,y:0},i=1/(1<<this.levelDiff-t.z),n=new C(0,0),o*=i):t.z<=this.levelDiff+this.maxDataLevel?(a=1<<this.levelDiff,e={z:t.z-this.levelDiff,x:Math.floor(t.x/a),y:Math.floor(t.y/a)},n=new C(e.x*a*256,e.y*a*256)):(i=1<<t.z-this.maxDataLevel-this.levelDiff,a=1<<this.levelDiff,e={z:this.maxDataLevel,x:Math.floor(t.x/a/i),y:Math.floor(t.y/a/i)},n=new C(e.x*a*i*256,e.y*a*i*256),o*=i),{dataTile:e,scale:i,origin:n,dim:o}}getBbox(o,t){return be(this,null,function*(){let i=this.dataTilesForBounds(o,t);return(yield Promise.all(i.map(t=>this.tileCache.get(t.dataTile)))).map((t,e)=>{e=i[e];return{data:t,z:o,dataTile:e.dataTile,scale:e.scale,dim:e.dim,origin:e.origin}})})}getDisplayTile(e){return be(this,null,function*(){var t=this.dataTileForDisplayTile(e);return{data:yield this.tileCache.get(t.dataTile),z:e.z,dataTile:t.dataTile,scale:t.scale,origin:t.origin,dim:t.dim}})}queryFeatures(t,e,i,o){var n=Math.round(i),i=Math.min(n-this.levelDiff,this.maxDataLevel);return this.tileCache.queryFeatures(t,e,i,o/(1<<n-i))}};ge(zt,"View");var Gi=zt,Xi=ge(t=>{let e=ge(t=>{let e=void 0===t.levelDiff?1:t.levelDiff,i=t.maxDataZoom||15,o;if("string"==typeof t.url)o=new(new URL(t.url,"http://example.com").pathname.endsWith(".pmtiles")?Ne:je)(t.url,!0);else{if(!t.url)throw new Error("Invalid source "+t.url);o=new Ne(t.url,!0)}t=new ei(o,256<<e);return new Gi(t,i,e)},"sourceToViews"),i=new Map;if(t.sources)for(var o in t.sources)i.set(o,e(t.sources[o]));else i.set("",e(t));return i},"sourcesToViews"),$i=ge((e,t,i)=>{let o=t/256,n=Math.floor(i.minX/256),a=Math.floor(i.minY/256),r=Math.floor(i.maxX/256),s=Math.floor(i.maxY/256),l=Math.log2(o),h=[];for(let t=n;t<=r;t++){var c=t%(1<<e);for(let t=a;t<=s;t++)h.push({display:Fe({z:e,x:c,y:t}),key:Fe({z:e-l,x:Math.floor(c/o),y:Math.floor(t/o)})})}return h},"covering"),xe=class{constructor(t,e){this.tree=new ne,this.current=new Map,this.dim=t,this.maxLabeledTiles=e}hasPrefix(t){for(var e of this.current.keys())if(e.startsWith(t))return!0;return!1}has(t){return this.current.has(t)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(t,e){let i=new Set;for(var o of this.tree.search(t))o.indexedLabel.order<=e&&i.add(o.indexedLabel);return i}searchLabel(t,e){let i=new Set;for(var o of t.bboxes)for(var n of this.tree.search(o))n.indexedLabel.order<=e&&i.add(n.indexedLabel);return i}bboxCollides(t,e){for(var i of this.tree.search(t))if(i.indexedLabel.order<=e)return!0;return!1}labelCollides(t,e){for(var i of t.bboxes)for(var o of this.tree.search(i))if(o.indexedLabel.order<=e)return!0;return!1}deduplicationCollides(t){if(!t.deduplicationKey||!t.deduplicationDistance)return!1;var e,i=t.deduplicationDistance,o={minX:t.anchor.x-i,minY:t.anchor.y-i,maxX:t.anchor.x+i,maxY:t.anchor.y+i};for(e of this.tree.search(o))if(e.indexedLabel.deduplicationKey===t.deduplicationKey&&e.indexedLabel.anchor.dist(t.anchor)<i)return!0;return!1}makeEntry(t){this.current.get(t)&&console.log("consistency error 1");var e=new Set;this.current.set(t,e)}insert(n,a,r){let t={anchor:n.anchor,bboxes:n.bboxes,draw:n.draw,order:a,tileKey:r,deduplicationKey:n.deduplicationKey,deduplicationDistance:n.deduplicationDistance},e=this.current.get(r);var i,o;e||(i=new Set,this.current.set(r,i),e=i),e.add(t);let s=!1,l=!1;for(o of n.bboxes)this.tree.insert({minX:o.minX,minY:o.minY,maxX:o.maxX,maxY:o.maxY,indexedLabel:t}),o.minX<0&&(s=!0),o.maxX>this.dim&&(l=!0);if(s||l){let t=s?this.dim:-this.dim,e=[];for(var h of n.bboxes)e.push({minX:h.minX+t,minY:h.minY,maxX:h.maxX+t,maxY:h.maxY});let i={anchor:new C(n.anchor.x+t,n.anchor.y),bboxes:e,draw:n.draw,order:a,tileKey:r},o=this.current.get(r);o&&o.add(i);for(var c of e)this.tree.insert({minX:c.minX,minY:c.minY,maxX:c.maxX,maxY:c.maxY,indexedLabel:i})}}pruneOrNoop(t){let e=t.split(":"),i,o=0,n=0;for(var a of this.current.keys()){var r=a.split(":");r[3]===e[3]&&(n++,(r=Math.sqrt(_e(+r[0]-+e[0],2)+_e(+r[1]-+e[1],2)))>o&&(o=r,i=a)),i&&n>this.maxLabeledTiles&&this.pruneKey(i)}}pruneKey(e){let i=this.current.get(e);if(i){let t=[];for(var o of this.tree.all())i.has(o.indexedLabel)&&t.push(o);for(var n of t)this.tree.remove(n);this.current.delete(e)}}removeLabel(t){let e=[];for(var i of this.tree.all())t===i.indexedLabel&&e.push(i);for(var o of e)this.tree.remove(o);let n=this.current.get(t.tileKey);n&&n.delete(t)}};ge(xe,"Index");var Wi=xe,Le=class{constructor(t,e,i,o,n){this.index=new Wi(256<<t,o),this.z=t,this.scratch=e,this.labelRules=i,this.callback=n}layout(t){let e=performance.now(),o=new Set;for(var[i,n]of t)for(var a of n){a=Fe(a.dataTile)+":"+i;this.index.has(a)||(this.index.makeEntry(a),o.add(a))}var r,s=new Set;for(let[e,i]of this.labelRules.entries())if(!(!1===i.visible||i.minzoom&&this.z<i.minzoom||i.maxzoom&&this.z>i.maxzoom)){var l=i.dataSource||"",h=t.get(l);if(h)for(var c of h){var u=Fe(c.dataTile)+":"+l;if(o.has(u)){var m=c.data.get(i.dataLayer);if(void 0!==m){let t=m;i.sort&&t.sort((t,e)=>i.sort?i.sort(t.props,e.props):0);var d,p={index:this.index,zoom:this.z,scratch:this.scratch,order:e,overzoom:this.z-c.dataTile.z};for(d of t)if(!i.filter||i.filter(this.z,d)){var f,y=Yi(d.geom,c.scale,c.origin),y=i.symbolizer.place(p,y,d);if(y)for(var _ of y){let t=!1;if(!_.deduplicationKey||!this.index.deduplicationCollides(_)){if(this.index.labelCollides(_,1/0)){if(!this.index.labelCollides(_,e)){for(f of this.index.searchLabel(_,1/0)){this.index.removeLabel(f);for(var g of f.bboxes)this.findInvalidatedTiles(s,c.dim,g,u)}this.index.insert(_,e,u),t=!0}}else this.index.insert(_,e,u),t=!0;if(t)for(var b of _.bboxes)(b.maxX>c.origin.x+c.dim||b.minX<c.origin.x||b.minY<c.origin.y||b.maxY>c.origin.y+c.dim)&&this.findInvalidatedTiles(s,c.dim,b,u)}}}}}}}for(r of o)this.index.pruneOrNoop(r);return 0<s.size&&this.callback&&this.callback(s),performance.now()-e}findInvalidatedTiles(t,e,i,o){var n;for(n of $i(this.z,e,i))n.key!==o&&this.index.hasPrefix(n.key)&&t.add(n.display)}add(t){let e=!0;for(var[i,o]of t)for(var n of o)this.index.has(Fe(n.dataTile)+":"+i)||(e=!1);return e?0:this.layout(t)}};ge(Le,"Labeler");var Ki=Le,Me=class{constructor(t,e,i,o){this.labelers=new Map,this.scratch=t,this.labelRules=e,this.maxLabeledTiles=i,this.callback=o}add(t,e){let i=this.labelers.get(t);return i||(i=new Ki(t,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(t,i)),i.add(e)}getIndex(t){t=this.labelers.get(t);if(t)return t.index}};ge(Me,"Labelers");var Ji=Me;function Qi(i,t,e,o,n,a,r,s,l){var h,c,u=performance.now();i.save(),i.miterLimit=2;for(h of n)if(!(h.minzoom&&t<h.minzoom||h.maxzoom&&t>h.maxzoom)){var m=e.get(h.dataSource||"");if(m)for(var d of m){var p=d.data.get(h.dataLayer);if(void 0!==p){h.symbolizer.before&&h.symbolizer.before(i,d.z);var f,y,_,g,b=d.origin,x=d.dim,v=d.scale;i.save(),s&&(i.beginPath(),f=Math.max(b.x-r.x,a.minX-r.x),y=Math.max(b.y-r.y,a.minY-r.y),_=Math.min(b.x-r.x+x,a.maxX-r.x),x=Math.min(b.y-r.y+x,a.maxY-r.y),i.rect(f,y,_-f,x-y),i.clip()),i.translate(b.x-r.x,b.y-r.y);for(g of p){let t=g.geom,e=g.bbox;e.maxX*v+b.x<a.minX||e.minX*v+b.x>a.maxX||e.minY*v+b.y>a.maxY||e.maxY*v+b.y<a.minY||h.filter&&!h.filter(d.z,g)||(1!==v&&(t=Yi(t,v,new C(0,0))),h.symbolizer.draw(i,t,d.z,g))}i.restore()}}}if(s&&(i.beginPath(),i.rect(a.minX-r.x,a.minY-r.y,a.maxX-a.minX,a.maxY-a.minY),i.clip()),o)for(c of o.searchBbox(a,1/0))if(i.save(),i.translate(c.anchor.x-r.x,c.anchor.y-r.y),c.draw(i),i.restore(),l){i.lineWidth=.5,i.strokeStyle=l,i.fillStyle=l,i.globalAlpha=1,i.fillRect(c.anchor.x-r.x-2,c.anchor.y-r.y-2,4,4);for(var L of c.bboxes)i.strokeRect(L.minX-r.x,L.minY-r.y,L.maxX-L.minX,L.maxY-L.minY)}return i.restore(),performance.now()-u}ge(Qi,"paint");var to=6378137,eo=85.0511287798,io=to*Math.PI,oo=ge(t=>{var e=Math.PI/180,i=Math.max(Math.min(eo,t.y),-eo),i=Math.sin(i*e);return new C(to*t.x*e,to*Math.log((1+i)/(1-i))/2)},"project"),no=ge(t=>{var e=180/Math.PI;return{lat:(2*Math.atan(Math.exp(t.y/to))-Math.PI/2)*e,lng:t.x*e/to}},"unproject"),ao=ge((e,i)=>t=>{t=oo(t);return new C((t.x+io)/(2*io),1-(t.y+io)/(2*io)).mult(256*(1<<i)).sub(e)},"instancedProject"),ro=ge((e,i)=>t=>{t=new C(t.x,t.y).add(e).div(256*(1<<i)),t=new C(t.x*(2*io)-io,(1-t.y)*(2*io)-io);return no(t)},"instancedUnproject"),so=ge((t,e)=>{return Math.log2(e*(360/t)/256)},"getZoom"),Se=class{constructor(t){var e;t.theme?(e=Hi[t.theme],this.paintRules=Ui(e),this.labelRules=Zi(e),this.backgroundColor=e.background):(this.paintRules=t.paintRules||[],this.labelRules=t.labelRules||[],this.backgroundColor=t.backgroundColor),this.views=Xi(t),this.debug=t.debug||""}drawContext(y,_,g,b,x){return be(this,null,function*(){let t=oo(b),e=new C((t.x+io)/(2*io),1-(t.y+io)/(2*io)).clone().mult(256*_e(2,x)).sub(new C(_/2,g/2)),i={minX:e.x,minY:e.y,maxX:e.x+_,maxY:e.y+g},o=[];for(var[n,a]of this.views){a=a.getBbox(x,i);o.push({key:n,promise:a})}let r=yield Promise.all(o.map(e=>e.promise.then(t=>({status:"fulfilled",value:t,key:e.key}),t=>({status:"rejected",value:[],reason:t,key:e.key})))),s=new Map;for(var l of r)"fulfilled"===l.status&&s.set(l.key,l.value);let h=performance.now(),c=new Ki(x,y,this.labelRules,16,void 0);c.add(s),this.backgroundColor&&(y.save(),y.fillStyle=this.backgroundColor,y.fillRect(0,0,_,g),y.restore());var u=this.paintRules;if(Qi(y,x,s,c.index,u,i,e,!0,this.debug),this.debug){y.save(),y.translate(-e.x,-e.y),y.strokeStyle=this.debug,y.fillStyle=this.debug,y.font="12px sans-serif";let t=0;for(var[m,d]of s){for(var p of d){y.strokeRect(p.origin.x,p.origin.y,p.dim,p.dim);var f=p.dataTile;y.fillText(m+(m?" ":"")+f.z+` ${f.x} `+f.y,p.origin.x+4,p.origin.y+14*(1+t))}t++}y.restore()}return{elapsed:performance.now()-h,project:ao(e,x),unproject:ro(e,x)}})}drawCanvas(t,e,i){return be(this,arguments,function*(t,e,i,o={}){var n=window.devicePixelRatio,a=t.clientWidth,r=t.clientHeight;t.width===a*n&&t.height===r*n||(t.width=a*n,t.height=r*n),o.lang&&(t.lang=o.lang);let s=t.getContext("2d");if(s)return s.setTransform(n,0,0,n,0,0),this.drawContext(s,a,r,e,i);console.error("Failed to initialize canvas2d context.")})}drawContextBounds(i,o,n,a,r){return be(this,null,function*(){var t=n.x-o.x,e=new C((o.x+n.x)/2,(o.y+n.y)/2);return this.drawContext(i,a,r,e,so(t,a))})}drawCanvasBounds(t,e,i,o){return be(this,arguments,function*(t,e,i,o,n={}){var a=i.x-e.x,i=new C((e.x+i.x)/2,(e.y+i.y)/2);return this.drawCanvas(t,i,so(a,o),n)})}};ge(Se,"Static");var Ee=Se,lo=ge(e=>new Promise(t=>{setTimeout(()=>{t()},e)}),"timer"),ho=ge(t=>t.then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t})),"reflect"),co=ge((t={})=>{let e=class extends L.GridLayer{constructor(t={}){t.noWrap&&!t.bounds&&(t.bounds=[[-90,-180],[90,180]]),null==t.attribution&&(t.attribution='<a href="https://protomaps.com">Protomaps</a>  <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(t),t.theme?(e=Hi[t.theme],this.paintRules=Ui(e),this.labelRules=Zi(e),this.backgroundColor=e.background):(this.paintRules=t.paintRules||[],this.labelRules=t.labelRules||[],this.backgroundColor=t.backgroundColor),this.lastRequestedZ=void 0,this.tasks=t.tasks||[],this.views=Xi(t),this.debug=t.debug;var e=document.createElement("canvas").getContext("2d");this.scratch=e,this.onTilesInvalidated=t=>{for(var e of t)this.rerenderTile(e)},this.labelers=new Ji(this.scratch,this.labelRules,16,this.onTilesInvalidated),this.tileSize=256*window.devicePixelRatio,this.tileDelay=t.tileDelay||3,this.lang=t.lang}renderTile(u,m,d,p=()=>{}){return be(this,null,function*(){this.lastRequestedZ=u.z;let t=[];for(var[e,i]of this.views){i=i.getDisplayTile(u);t.push({key:e,promise:i})}let o=yield Promise.all(t.map(e=>e.promise.then(t=>({status:"fulfilled",value:t,key:e.key}),t=>({status:"rejected",reason:t,key:e.key})))),n=new Map;for(var a of o)"fulfilled"===a.status?n.set(a.key,[a.value]):"AbortError"===a.reason.name||console.error(a.reason);if(m.key===d&&this.lastRequestedZ===u.z&&(yield Promise.all(this.tasks.map(ho)),m.key===d)&&this.lastRequestedZ===u.z){let o=this.labelers.add(u.z,n);if(m.key===d&&this.lastRequestedZ===u.z){var r=this.labelers.getIndex(u.z);if(this._map){var s=this._map.getCenter().wrap(),l=this._getTiledPixelBounds(s),s=this._pxBoundsToTileRange(l).getCenter(),l=u.distanceTo(s)*this.tileDelay;if(yield lo(l),m.key===d&&this.lastRequestedZ===u.z){s={minX:256*u.x-16,minY:256*u.y-16,maxX:256*(u.x+1)+16,maxY:256*(u.y+1)+16},l=new C(256*u.x,256*u.y);m.width=this.tileSize,m.height=this.tileSize;let i=m.getContext("2d");if(i){i.setTransform(this.tileSize/256,0,0,this.tileSize/256,0,0),i.clearRect(0,0,256,256),this.backgroundColor&&(i.save(),i.fillStyle=this.backgroundColor,i.fillRect(0,0,256,256),i.restore());let e=0,t=this.paintRules;if(e=Qi(i,u.z,n,this.xray?null:r,t,s,l,!1,this.debug),this.debug){i.save(),i.fillStyle=this.debug,i.font="600 12px sans-serif",i.fillText(`${u.z} ${u.x} `+u.y,4,14),i.font="12px sans-serif";let t=28;for(var[h,c]of n){c=c[0].dataTile;i.fillText(h+(h?" ":"")+c.z+` ${c.x} `+c.y,4,t),t+=14}i.font="600 10px sans-serif",8<e&&(i.fillText(e.toFixed()+" ms paint",4,t),t+=14),8<o&&i.fillText(o.toFixed()+" ms layout",4,t),i.strokeStyle=this.debug,i.lineWidth=.5,i.beginPath(),i.moveTo(0,0),i.lineTo(0,256),i.stroke(),i.lineWidth=.5,i.beginPath(),i.moveTo(0,0),i.lineTo(256,0),i.stroke(),i.restore()}p()}else console.error("Failed to get Canvas context")}}}}})}rerenderTile(t){for(var e in this._tiles){var i=this._wrapCoords(this._keyToTileCoords(e));t===this._tileCoordsToKey(i)&&this.renderTile(i,this._tiles[e].el,t)}}queryTileFeaturesDebug(t,e,i=16){let o=new Map;for(var[n,a]of this.views)o.set(n,a.queryFeatures(t,e,this._map.getZoom(),i));return o}clearLayout(){this.labelers=new Ji(this.scratch,this.labelRules,16,this.onTilesInvalidated)}rerenderTiles(){for(var t in this._tiles){var e=this._wrapCoords(this._keyToTileCoords(t)),i=this._tileCoordsToKey(e);this.renderTile(e,this._tiles[t].el,i)}}createTile(t,e){let i=L.DomUtil.create("canvas","leaflet-tile");i.lang=this.lang;var o=this._tileCoordsToKey(t);return i.key=o,this.renderTile(t,i,o,()=>{e(void 0,i)}),i}_removeTile(t){let e=this._tiles[t];e&&(e.el.removed=!0,e.el.key=void 0,L.DomUtil.removeClass(e.el,"leaflet-tile-loaded"),e.el.width=e.el.height=0,L.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))}};ge(e,"LeafletLayer");let i=e;return new i(t)},"leafletLayer"),Oe=ge((t,e,i)=>{let o=new FontFace(t,`url(${e})`,{weight:i});return document.fonts.add(o),o.load()},"Font"),uo=ge(o=>be(void 0,null,function*(){return new Promise((t,e)=>{let i=new Image;i.onload=()=>t(i),i.onerror=()=>e("Invalid SVG"),i.src=o})}),"mkimg"),qe=class{constructor(t){this.src=t,this.canvas=document.createElement("canvas"),this.mapping=new Map,this.missingBox={x:0,y:0,w:0,h:0}}load(){return be(this,null,function*(){let t=this.src,e=window.devicePixelRatio;t.endsWith(".html")&&(t=yield(yield fetch(t)).text());let i=(new window.DOMParser).parseFromString(t,"text/html"),o=Array.from(i.body.children),n=yield uo("data:image/svg+xml;base64,"+btoa(`
<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <rect width="50" height="50" fill="#cccccc"/>
    <g transform="translate(5,5)">
        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>
    </g>
</svg>
`)),a=[{w:n.width*e,h:n.height*e,img:n,id:""}],r=new XMLSerializer;for(var s of o){var l="data:image/svg+xml;base64,"+btoa(r.serializeToString(s)),l=yield uo(l);a.push({w:l.width*e,h:l.height*e,img:l,id:s.id})}var h=function(t){let e=0,i=0;for(const s of t)e+=s.w*s.h,i=Math.max(i,s.w);var o;t.sort((t,e)=>e.h-t.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,r=0;for(const l of t)for(let t=n.length-1;0<=t;t--){const h=n[t];if(!(l.w>h.w||l.h>h.h)){l.x=h.x,l.y=h.y,r=Math.max(r,l.y+l.h),a=Math.max(a,l.x+l.w),l.w===h.w&&l.h===h.h?(o=n.pop(),t<n.length&&(n[t]=o)):l.h===h.h?(h.x+=l.w,h.w-=l.w):(l.w===h.w||n.push({x:h.x+l.w,y:h.y,w:h.w-l.w,h:l.h}),h.y+=l.h,h.h-=l.h);break}}return{w:a,h:r,fill:e/(a*r)||0}}(a);this.canvas.width=h.w,this.canvas.height=h.h;let c=this.canvas.getContext("2d");if(c)for(var u of a)void 0!==u.x&&void 0!==u.y&&(c.drawImage(u.img,u.x,u.y,u.w,u.h),u.id?this.mapping.set(u.id,{x:u.x,y:u.y,w:u.w,h:u.h}):this.missingBox={x:u.x,y:u.y,w:u.w,h:u.h});return this})}get(t){let e=this.mapping.get(t);return e=e||this.missingBox,e}};ge(qe,"Sheet");function mo(t,e){return new _o(t,e)}function po(t,e,i,o,n,a){return new go(t,e,i,o,n,a)}function fo(t,e,i){return t||e?new bo(t,e,i):null}function yo(){return new xo}var ti=Object.freeze({__proto__:null,CenteredSymbolizer:Ei,CenteredTextSymbolizer:Bi,CircleSymbolizer:bi,FlexSymbolizer:wi,Font:Oe,GeomType:Be,GroupSymbolizer:Si,IconSymbolizer:_i,Index:Wi,Justify:ii,Labeler:Ki,Labelers:Ji,LineLabelPlacement:lt,LineLabelSymbolizer:Ni,LineSymbolizer:fi,OffsetSymbolizer:Ri,OffsetTextSymbolizer:Oi,Padding:zi,PmtilesSource:Ne,PolygonSymbolizer:ri,Sheet:qe,ShieldSymbolizer:vi,Static:Ee,TextPlacements:oi,TextSymbolizer:Ii,TileCache:ei,View:Gi,ZxySource:je,arr:si,covering:$i,createPattern:ni,exp:ui,getZoom:so,isCcw:We,isInRing:$e,labelRules:Zi,leafletLayer:co,linear:di,paint:Qi,paintRules:Ui,pointInPolygon:Ke,pointMinDistToLines:Qe,pointMinDistToPoints:Je,sourcesToViews:Xi,step:mi,toIndex:Fe,transformGeom:Yi,wrap:Vi}),_o=L.Layer.extend({initialize:function(t,e){this._template=t,this._container=L.DomUtil.create("div","leaflet-layer mapml-pmtiles-container"),this._pmtilesOptions={pane:this._container,maxDataZoom:t.zoom?.max??15,url:this._mapInputNamesToProtomapsUrl(t),noWrap:!0};t=e?.pmtilesRules?.get(this._template.template);t?.rules?(L.extend(this._pmtilesOptions,{paintRules:t.rules.PAINT_RULES}),L.extend(this._pmtilesOptions,{labelRules:t.rules.LABEL_RULES})):t?.theme?.theme?L.extend(this._pmtilesOptions,{theme:t.theme.theme}):console.warn("pmtiles symbolizer rules or theme not found for map-link@tref ->  "+this._template.template),this.zoomBounds=e.zoomBounds,this.extentBounds=e.extentBounds,delete e.zoomBounds,delete e.extentBounds,this._linkEl=e.linkEl,L.setOptions(this,e)},_mapInputNamesToProtomapsUrl:function(t){let e=t.template;var i=new RegExp(t.zoom?.name?"{"+t.zoom.name+"}":"{z}","ig");e=e.replace(i,"{z}");var o=t.values.find(t=>"location"===t.type&&"row"===t.axis)?.name,i=new RegExp(o?"{"+o+"}":"{y}","ig");e=e.replace(i,"{y}");t=t.values.find(t=>"location"===t.type&&"column"===t.axis)?.name;return i=new RegExp(t?"{"+t+"}":"{x}","ig"),e=e.replace(i,"{x}"),e},onAdd:function(t){this._map=t,this.options.pane.appendChild(this._container),this.setZIndex(this.options.zIndex),this._pmtilesLayer=M.protomapsL.leafletLayer(this._pmtilesOptions).addTo(t)},onRemove:function(t){this._pmtilesLayer.remove(),L.DomUtil.remove(this._container)},isVisible:function(){if("OSMTILE"!==this._template.projection)return!1;let t=this._linkEl.getMapEl()._map;var e=t.getZoom(),i=M.pixelToPCRSBounds(t.getPixelBounds(),e,t.options.projection);return e<=this.zoomBounds.maxZoom&&e>=this.zoomBounds.minZoom&&this.extentBounds.overlaps(i)},setZIndex:function(t){return this.options.zIndex=t,this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex),this}}),go=L.ImageOverlay.extend({initialize:function(t,e,i,o,n,a){this._container=n,this._url=t,this._location=e,this._size=L.point(i),this._angle=o,L.setOptions(this,a)},getEvents:function(){var t={viewreset:this._reset};return this._zoomAnimated&&this._step<=1&&(t.zoomanim=this._animateZoom),t},onAdd:function(t){this.on({load:this._onImageLoad}),this._image||this._initImage(),this.options.interactive&&(L.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this._container.appendChild(this._image),this._reset()},onRemove:function(){L.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},_onImageLoad:function(){this._image&&(this._image.loaded=+new Date,this._updateOpacity())},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),t=this._map.getPixelOrigin().add(this._location).multiplyBy(e).subtract(this._map._getNewPixelOrigin(t.center,t.zoom)).round();L.Browser.any3d?L.DomUtil.setTransform(this._image,t,e):L.DomUtil.setPosition(this._image,t)},_reset:function(t){var e=this._image,i=this._location,o=this._size;t&&1<this._step&&(void 0===this._overlayToRemove||this._url===this._overlayToRemove)||(L.DomUtil.setPosition(e,i),e.style.width=o.x+"px",e.style.height=o.y+"px")},_updateOpacity:function(){var t,e,i;this._map&&(i=+new Date,t=!1,e=this._image,i=Math.min(1,(i-e.loaded)/200),L.DomUtil.setOpacity(e,i),(t=i<1?!0:t)&&(L.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this)),L.DomUtil.addClass(e,"leaflet-image-loaded"))}}),bo=L.LayerGroup.extend({options:{zIndex:0,opacity:"1.0"},initialize:function(t,e,i){L.LayerGroup.prototype.initialize.call(this,null,i),t&&(this._href=t),this._layerEl=e,this._content=e.src?e.shadowRoot:e,L.setOptions(this,i),this._container=L.DomUtil.create("div","leaflet-layer"),this.changeOpacity(this.options.opacity),L.DomUtil.addClass(this._container,"mapml-layer"),this._mapmlTileContainer=L.DomUtil.create("div","mapml-tile-container",this._container),this._initialize(this._content)},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getHref:function(){return this._href??""},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},changeOpacity:function(t){this._container.style.opacity=t,this._layerEl._opacity=t,this._layerEl._opacitySlider&&(this._layerEl._opacitySlider.value=t)},titleIsReadOnly(){return!!this._titleIsReadOnly},setName(t){this.titleIsReadOnly()||(this._title=t,this._layerEl._layerControlHTML.querySelector(".mapml-layer-item-name").innerHTML=t)},getName(){return this._title},onAdd:function(t){L.LayerGroup.prototype.onAdd.call(this,t),this.getPane().appendChild(this._container),this._staticTileLayer&&this.addLayer(this._staticTileLayer),this.setZIndex(this.options.zIndex),t.on("popupopen",this._attachSkipButtons,this)},_calculateBounds:function(){delete this.bounds,delete this.zoomBounds;let r,s;var t;r=this._layerEl.src&&this._layerEl.shadowRoot.querySelector(":host > map-meta[name=extent][content]")?M.getBoundsFromMeta(this._layerEl.shadowRoot):this._layerEl.querySelector(":scope > map-meta[name=extent][content]")?M.getBoundsFromMeta(this._layerEl):void 0,s=this._layerEl.src&&this._layerEl.shadowRoot.querySelector(":host > map-meta[name=zoom][content]")?M.getZoomBoundsFromMeta(this._layerEl.shadowRoot):this._layerEl.querySelector(":scope > map-meta[name=zoom][content]")?M.getZoomBoundsFromMeta(this._layerEl):void 0;const l=(this._layerEl.src?this._layerEl.shadowRoot:this._layerEl).querySelectorAll("map-extent");["_staticTileLayer","_mapmlvectors","_extentLayer"].forEach(t=>{let e,i,o,n;if(s&&(e=s.maxZoom,i=s.minZoom,n=s.maxNativeZoom||-1/0,o=s.minNativeZoom||1/0),"_extentLayer"===t&&l.length)for(let t=0;t<l.length;t++){var a;l[t]._extentLayer.bounds&&(a=l[t]._extentLayer,r?r.extend(a.bounds):r=L.bounds(a.bounds.min,a.bounds.max),a.zoomBounds&&(s?(e=Math.max(e,a.zoomBounds.maxZoom),i=Math.min(i,a.zoomBounds.minZoom),n=Math.max(n,a.zoomBounds.maxNativeZoom),o=Math.min(o,a.zoomBounds.minNativeZoom),s.minZoom=i,s.maxZoom=e,s.minNativeZoom=o,s.maxNativeZoom=n):s=a.zoomBounds))}else("_mapmlvectors"===t||"_staticTileLayer"===t&&this._staticTileLayer)&&(this[t].layerBounds&&(r?r.extend(this[t].layerBounds):r=this[t].layerBounds),this[t].zoomBounds&&(s?(e=Math.max(e,this[t].zoomBounds.maxZoom),i=Math.min(i,this[t].zoomBounds.minZoom),n=Math.max(n,this[t].zoomBounds.maxNativeZoom),o=Math.min(o,this[t].zoomBounds.minNativeZoom),s.minZoom=i,s.maxZoom=e,s.minNativeZoom=o,s.maxNativeZoom=n):s=this[t].zoomBounds))}),r?this.bounds=r:(t=M[this.options.projection].options.bounds,this.bounds=L.bounds(t.min,t.max)),s=s||{},s.minZoom||(s.minZoom=0),s.maxZoom||(s.maxZoom=M[this.options.projection].options.resolutions.length-1),s.minNativeZoom===1/0&&(s.minNativeZoom=s.minZoom),s.maxNativeZoom===-1/0&&(s.maxNativeZoom=s.maxZoom),this.zoomBounds=s},onRemove:function(t){L.LayerGroup.prototype.onRemove.call(this,t),L.DomUtil.remove(this._container),t.off("popupopen",this._attachSkipButtons)},getAttribution:function(){return this.options.attribution},getBase:function(){return new URL(this._content.querySelector("map-base")?this._content.querySelector("map-base").getAttribute("href"):"LAYER-"===this._content.nodeName?this._content.baseURI:this._href,this._href).href},appendStyleLink:function(e){if(e.link){let t=this._getStylePositionAndNode();t.node.insertAdjacentElement(t.position,e.link)}},_getStylePositionAndNode:function(){return this._container.lastChild&&("SVG"===this._container.lastChild.nodeName.toUpperCase()||this._container.lastChild.classList.contains("mapml-vector-container"))?{position:"beforebegin",node:this._container.lastChild}:this._container.lastChild?{position:"afterend",node:this._container.lastChild}:{position:"afterbegin",node:this._container}},appendStyleElement:function(e){if(e.styleElement){let t=this._getStylePositionAndNode();t.node.insertAdjacentElement(t.position,e.styleElement)}},_initialize:function(){var n=this;n.getBase();var t,a=this._content;!function(){var t=a.querySelector("map-link[rel=license]");t&&(e=t.getAttribute("title"),t=t.getAttribute("href"),e='<a href="'+t+'" title="'+e+'">'+e+"</a>");L.setOptions(n,{attribution:e});var e=a.querySelector("map-link[rel=legend]");e&&(n._legendUrl=e.getAttribute("href"));n._map&&n._map.hasLayer(n)&&n._map.attributionControl.addAttribution(n.getAttribution())}(),a.querySelector("map-title")?(n._title=a.querySelector("map-title").textContent.trim(),n._titleIsReadOnly=!0):n._layerEl&&n._layerEl.hasAttribute("label")&&(n._title=n._layerEl.getAttribute("label").trim()),M[n.options.projection]&&function(){if(a.querySelector("map-tile")){var t=document.createElement("map-tiles"),e=a.querySelector("map-meta[name=zoom][content]")||a.querySelector("map-input[type=zoom][value]");t.setAttribute("zoom",e&&e.getAttribute("content")||e&&e.getAttribute("value")||"0");for(var i=a.getElementsByTagName("map-tile"),o=0;o<i.length;o++)t.appendChild(document.importNode(i[o],!0));n._mapmlTileContainer.appendChild(t),n._staticTileLayer=M.staticTileLayer({pane:n._container,_leafletLayer:n,projection:n.options.projection,className:"mapml-static-tile-layer",tileContainer:n._mapmlTileContainer,maxZoomBound:M[n.options.projection].options.resolutions.length-1,tileSize:M[n.options.projection].options.crs.tile.bounds.max.x})}}(),t=M.getNativeVariables(n._content),n._mapmlvectors=M.featureLayer(null,{renderer:M.featureRenderer(),pane:n._container,opacity:n.options.opacity,projection:n.options.projection,native:t,_leafletLayer:n,mapEl:n._layerEl.parentElement,onEachFeature:function(t,e){var i;t&&((i=document.createElement("div")).classList.add("mapml-popup-content"),i.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(i,{autoClose:!1,minWidth:165}))}}).addTo(n),n._layerEl.parentElement&&n._layerEl.parentElement._toggleControls()},getQueryTemplates:function(e,i){const o=this._layerEl.querySelectorAll("map-extent[checked] map-link[rel=query]").length?this._layerEl.querySelectorAll("map-extent[checked] map-link[rel=query]"):this._layerEl.shadowRoot.querySelectorAll("map-extent[checked] map-link[rel=query]").length?this._layerEl.shadowRoot.querySelectorAll("map-extent[checked] map-link[rel=query]"):null;if(o){var n=[];for(let t=0;t<o.length;t++){const r=o[t].extent.zoom.minZoom,s=o[t].extent.zoom.maxZoom,l=o[t].getBounds();l.contains(e)&&(a=i,r<=a&&a<=s)&&n.push(o[t]._templateVars)}return n}var a},_attachSkipButtons:function(t){let n=t.popup,r=t.target,e,a,i=n._container.getElementsByClassName("mapml-popup-content")[0];n._container.setAttribute("role","dialog"),i.setAttribute("tabindex","-1"),i.setAttribute("role","document"),n._count=0,n._source._eventParents?(e=n._source._eventParents[Object.keys(n._source._eventParents)[0]],a=n._source.group,f.call(n)):(m=n._source._layerEl.querySelector("map-extent")||n._source._layerEl.shadowRoot.querySelector("map-extent"),e=m._extentLayer,r.on("attachZoomLink",f,n)),n._container.querySelector('nav[class="mapml-focus-buttons"]')&&(L.DomUtil.remove(n._container.querySelector('nav[class="mapml-focus-buttons"]')),L.DomUtil.remove(n._container.querySelector("hr")));t=L.DomUtil.create("nav","mapml-focus-buttons");let o=L.DomUtil.create("button","mapml-popup-button",t);o.type="button",o.title="Focus Map",o.innerHTML="<span aria-hidden='true'>|&#10094;</span>",L.DomEvent.on(o,"click",t=>{L.DomEvent.stop(t),r.featureIndex._sortIndex(),r.closePopup(),r._container.focus()},n);let s=L.DomUtil.create("button","mapml-popup-button",t);s.type="button",s.title="Previous Feature",s.innerHTML="<span aria-hidden='true'>&#10094;</span>",L.DomEvent.on(s,"click",e._previousFeature,n);let l=L.DomUtil.create("p","mapml-feature-count",t),h=this._totalFeatureCount||1;l.innerText=n._count+1+"/"+h;let c=L.DomUtil.create("button","mapml-popup-button",t);c.type="button",c.title="Next Feature",c.innerHTML="<span aria-hidden='true'>&#10095;</span>",L.DomEvent.on(c,"click",e._nextFeature,n);let u=L.DomUtil.create("button","mapml-popup-button",t);u.type="button",u.title="Focus Controls",u.innerHTML="<span aria-hidden='true'>&#10095;|</span>",L.DomEvent.on(u,"click",t=>{r.featureIndex._sortIndex(),r.featureIndex.currentIndex=r.featureIndex.inBoundFeatures.length-1,r.featureIndex.inBoundFeatures[0]?.path.setAttribute("tabindex",-1),r.featureIndex.inBoundFeatures[r.featureIndex.currentIndex]?.path.setAttribute("tabindex",0),L.DomEvent.stop(t),r.closePopup(),r._controlContainer.querySelector("A:not([hidden])").focus()},n);var m=L.DomUtil.create("hr","mapml-popup-divider");function d(t){let e=t.originalEvent.path||t.originalEvent.composedPath();var i=9===t.originalEvent.keyCode,o=t.originalEvent.shiftKey;(e[0].classList.contains("leaflet-popup-close-button")&&i&&!o||27===t.originalEvent.keyCode||e[0].classList.contains("leaflet-popup-close-button")&&13===t.originalEvent.keyCode||e[0].classList.contains("mapml-popup-content")&&i&&o||e[0]===n._content.querySelector("a")&&i&&o)&&setTimeout(()=>{r.closePopup(n),a.focus(),L.DomEvent.stop(t)},0)}function p(t){let e=t.originalEvent.path||t.originalEvent.composedPath();var i=9===t.originalEvent.keyCode,o=t.originalEvent.shiftKey;13===t.originalEvent.keyCode&&e[0].classList.contains("leaflet-popup-close-button")||27===t.originalEvent.keyCode?(L.DomEvent.stopPropagation(t),r.closePopup(n),r._container.focus(),27!==t.originalEvent.keyCode&&(r._popupClosed=!0)):i&&e[0].classList.contains("leaflet-popup-close-button")?r.closePopup(n):e[0].classList.contains("mapml-popup-content")&&i&&o?(r.closePopup(n),setTimeout(()=>{L.DomEvent.stop(t),r._container.focus()},0)):e[0]===n._content.querySelector("a")&&i&&o&&(r.closePopup(n),setTimeout(()=>{L.DomEvent.stop(t),r.getContainer.focus()},0))}function f(i){let o=this._content,n=i?i.currFeature:this._source._groupLayer._featureEl;if(o.querySelector("a.mapml-zoom-link")&&o.querySelector("a.mapml-zoom-link").remove(),n.querySelector("map-geometry")){var a=n.extent.topLeft.gcrs,i=n.extent.bottomRight.gcrs,i=L.latLngBounds(L.latLng(a.horizontal,a.vertical),L.latLng(i.horizontal,i.vertical)).getCenter(!0);let t=document.createElement("a");t.href=`#${n.getZoomToZoom()},${i.lng},`+i.lat,t.innerHTML=""+M.options.locale.popupZoom,t.className="mapml-zoom-link",t.onclick=t.onkeydown=function(t){(t instanceof MouseEvent||13===t.keyCode)&&(t.preventDefault(),n.zoomTo(),r.closePopup(),r.getContainer().focus())};let e=o.querySelector(".mapml-zoom-link");e&&e.remove(),o.insertBefore(t,o.querySelector("hr.mapml-popup-divider"))}}n._navigationBar=t,n._content.appendChild(m),n._content.appendChild(t),i.focus(),a&&!M.options.featureIndexOverlayOption?(a.setAttribute("aria-expanded","true"),r.on("keydown",d)):r.on("keydown",p),r.on("popupclose",function t(e){e.popup===n&&(r.off("keydown",d),r.off("keydown",p),r.off("popupopen",f),r.off("popupclose",t),a&&a.setAttribute("aria-expanded","false"))})}}),xo=L.Layer.extend({onAdd:function(t){var e=t.getSize();(400<e.x||300<e.y)&&(this._container=L.DomUtil.create("table","mapml-debug",t._container),this._panel=Lo({className:"mapml-debug-panel",pane:this._container}),t.addLayer(this._panel)),this._grid=Mo({className:"mapml-debug-grid",pane:t._panes.mapPane,zIndex:400,tileSize:t.options.crs.options.crs.tile.bounds.max.x}),t.addLayer(this._grid),this._vectors=So({className:"mapml-debug-vectors",pane:t._panes.mapPane,toolPane:this._container}),t.addLayer(this._vectors)},onRemove:function(t){t.removeLayer(this._grid),t.removeLayer(this._vectors),this._panel&&(t.removeLayer(this._panel),L.DomUtil.remove(this._container))}}),vo=L.Layer.extend({initialize:function(t){L.setOptions(this,t)},onAdd:function(t){this._title=L.DomUtil.create("caption","mapml-debug-banner",this.options.pane),this._title.innerHTML="Debug mode",t.debug={},t.debug._infoContainer=this._debugContainer=L.DomUtil.create("tbody","mapml-debug-panel",this.options.pane);var e=t.debug._infoContainer;t.debug._tileCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._tileMatrixCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._mapCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._tcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._pcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._gcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),this._map.on("mousemove",this._updateCoords)},onRemove:function(){L.DomUtil.remove(this._title),this._debugContainer&&(L.DomUtil.remove(this._debugContainer),this._map.off("mousemove",this._updateCoords))},_updateCoords:function(s){if(!this.contextMenu._visible){let t=this.options.mapEl,e=t._map.project(s.latlng),i=t._map.options.crs.scale(+t.zoom),o=t._map.options.crs.transformation.untransform(e,i),n=t._map.options.crs.options.crs.tile.bounds.max.x,a=e.x%n,r=e.y%n;a<0&&(a+=n),r<0&&(r+=n),this.debug._tileCoord.innerHTML=`
      <th scope="row">tile: </th>
      <td>i: ${Math.trunc(a)}, </td>
      <td>j: ${Math.trunc(r)}</td>
      `,this.debug._mapCoord.innerHTML=`
      <th scope="row">map: </th>
      <td>i: ${Math.trunc(s.containerPoint.x)}, </td>
      <td>j: ${Math.trunc(s.containerPoint.y)}</td>
      `,this.debug._gcrsCoord.innerHTML=`
      <th scope="row">gcrs: </th>
      <td>lon: ${s.latlng.lng.toFixed(6)}, </td>
      <td>lat: ${s.latlng.lat.toFixed(6)}</td>
      `,this.debug._tcrsCoord.innerHTML=`
      <th scope="row">tcrs: </th>
      <td>x: ${Math.trunc(e.x)}, </td>
      <td>y: ${Math.trunc(e.y)}</td>
      `,this.debug._tileMatrixCoord.innerHTML=`
      <th scope="row">tilematrix: </th>
      <td>column: ${Math.trunc(e.x/n)}, </td>
      <td>row: ${Math.trunc(e.y/n)}</td>
      `,this.debug._pcrsCoord.innerHTML=`
      <th scope="row">pcrs: </th>
      <td>easting: ${o.x.toFixed(2)}, </td>
      <td>northing: ${o.y.toFixed(2)}</td>
      `}}}),Lo=function(t){return new vo(t)},wo=L.GridLayer.extend({initialize:function(t){L.setOptions(this,t),L.GridLayer.prototype.initialize.call(this,this._map)},createTile:function(t){let e=L.DomUtil.create("div","mapml-debug-tile");return e.setAttribute("col",t.x),e.setAttribute("row",t.y),e.setAttribute("zoom",t.z),e.innerHTML=["col: "+t.x,"row: "+t.y,"zoom: "+t.z].join(", "),e.style.outline="1px dashed red",e}}),Mo=function(t){return new wo(t)},Co=L.LayerGroup.extend({initialize:function(t){L.setOptions(this,t),L.LayerGroup.prototype.initialize.call(this,this._map,t)},onAdd:function(t){t.on("overlayremove",this._mapLayerUpdate,this),t.on("overlayadd",this._mapLayerUpdate,this);var e=t.options.crs.transformation.transform(L.point(0,0),t.options.crs.scale(0));this._centerVector=L.circle(t.options.crs.pointToLatLng(e,0),{radius:250,className:"mapml-debug-vectors projection-centre"}),this._centerVector.bindTooltip("Projection Center"),this._addBounds(t)},onRemove:function(t){this.clearLayers()},_addBounds:function(s){setTimeout(()=>{let t=Object.keys(s._layers),i=s._layers,o=["#FF5733","#8DFF33","#3397FF","#E433FF","#F3FF33"],n=0;this.addLayer(this._centerVector);for(var a of t)if(i[a].layerBounds||i[a].extentBounds){let t;t=i[a].layerBounds?[i[a].layerBounds.min,L.point(i[a].layerBounds.max.x,i[a].layerBounds.min.y),i[a].layerBounds.max,L.point(i[a].layerBounds.min.x,i[a].layerBounds.max.y)]:[i[a].extentBounds.min,L.point(i[a].extentBounds.max.x,i[a].extentBounds.min.y),i[a].extentBounds.max,L.point(i[a].extentBounds.min.x,i[a].extentBounds.max.y)];var r=i[a].extentBounds&&i[a].options.linkEl.getLayerEl().hasAttribute("data-testid")?i[a].options.linkEl.getLayerEl().getAttribute("data-testid"):i[a].layerBounds&&i[a].options?._leafletLayer?._layerEl?.hasAttribute("data-testid")?i[a].options._leafletLayer._layerEl.getAttribute("data-testid"):"";let e=Eo(t,{className:this.options.className.concat(" ",r),color:o[n%o.length],weight:2,opacity:1,fillOpacity:.01,fill:!0});i[a].options._leafletLayer&&e.bindTooltip(i[a].options._leafletLayer._title,{sticky:!0}),this.addLayer(e),n++}var e;s.totalLayerBounds&&(e=[s.totalLayerBounds.min,L.point(s.totalLayerBounds.max.x,s.totalLayerBounds.min.y),s.totalLayerBounds.max,L.point(s.totalLayerBounds.min.x,s.totalLayerBounds.max.y)],e=Eo(e,{className:"mapml-debug-vectors mapml-total-bounds",color:"#808080",weight:5,opacity:.5,fill:!1}),this.addLayer(e))},0)},_mapLayerUpdate:function(t){this.clearLayers(),this._addBounds(t.target)}}),So=function(t){return new Co(t)},To=L.Path.extend({getCenter:function(t){let e=this._map.options.crs;return e.unproject(L.bounds(this._locations).getCenter())},options:{className:"mapml-debug-extent"},initialize:function(t,e){this._locations=t,L.setOptions(this,e)},_project:function(){this._rings=[];let e=this._map.options.crs.scale(this._map.getZoom()),i=this._map;for(let t=0;t<this._locations.length;t++){var o=i.options.crs.transformation.transform(this._locations[t],e);this._rings.push(L.point(o.x,o.y)._subtract(i.getPixelOrigin()))}this._parts=[this._rings]},_update:function(){this._map&&this._renderer._updatePoly(this,!0)}}),Eo=function(t,e){return new To(t,e)},ko=L.Handler.extend({addHooks:function(){L.setOptions(this,{mapEl:this._map.options.mapEl}),L.DomEvent.on(this._map,"click",this._queryTopLayer,this),L.DomEvent.on(this._map,"keypress",this._queryTopLayerAtMapCenter,this)},removeHooks:function(){L.DomEvent.off(this._map,"click",this._queryTopLayer,this),L.DomEvent.on(this._map,"keypress",this._queryTopLayerAtMapCenter,this)},_getTopQueryableLayer:function(){for(var t=this.options.mapEl.layers,e=t.length-1;0<=e;e--)if(t[e].queryable())return t[e]._layer},_queryTopLayerAtMapCenter:function(t){setTimeout(()=>{!this._map.isFocused||this._map._popupClosed||" "!==t.originalEvent.key&&13!=+t.originalEvent.keyCode?delete this._map._popupClosed:this._map.fire("click",{latlng:this._map.getCenter(),layerPoint:this._map.latLngToLayerPoint(this._map.getCenter()),containerPoint:this._map.latLngToContainerPoint(this._map.getCenter())})},0)},_queryTopLayer:function(t){var e=this._getTopQueryableLayer();e&&(e._mapmlFeatures&&delete e._mapmlFeatures,this._query(t,e))},_query(c,a){function e(t){return n.transformation.untransform(t,n.scale(o))}function i(t){return n.unproject(n.transformation.untransform(t,n.scale(o)),o)}var o=c.target.getZoom(),r=this._map,n=M[a.options.projection],s=r.options.crs.options.crs.tile.bounds.max.x,l=a._container,h={autoClose:!1,autoPan:!0,maxHeight:.5*r.getSize().y-50},u=n.latLngToPoint(c.latlng,o),m=u.divideBy(s).floor(),d=new L.Bounds(u.divideBy(s).floor().multiplyBy(s),u.divideBy(s).ceil().multiplyBy(s)),t=this._map.project(c.latlng),p=this._map.options.crs.scale(this._map.getZoom()),p=this._map.options.crs.transformation.untransform(t,p),f=a.getQueryTemplates(p,o);let y=[];for(let t=0;t<f.length;t++){var _,g={},b=f[t];for(_ in g[b.query.tilei]=u.x.toFixed()-m.x*s,g[b.query.tilej]=u.y.toFixed()-m.y*s,g[b.query.mapi]=r.getSize().divideBy(2).x.toFixed(),g[b.query.mapj]=r.getSize().divideBy(2).y.toFixed(),g[b.query.pixelleft]=n.pointToLatLng(u,o).lng,g[b.query.pixeltop]=n.pointToLatLng(u,o).lat,g[b.query.pixelright]=n.pointToLatLng(u.add([1,1]),o).lng,g[b.query.pixelbottom]=n.pointToLatLng(u.add([1,1]),o).lat,g[b.query.column]=m.x,g[b.query.row]=m.y,g[b.query.x]=u.x.toFixed(),g[b.query.y]=u.y.toFixed(),g[b.query.easting]=e(u).x,g[b.query.northing]=e(u).y,g[b.query.longitude]=i(u).lng,g[b.query.latitude]=i(u).lat,g[b.query.zoom]=o,g[b.query.width]=r.getSize().x,g[b.query.height]=r.getSize().y,g[b.query.mapbottom]=e(u.add(r.getSize().divideBy(2))).y,g[b.query.mapleft]=e(u.subtract(r.getSize().divideBy(2))).x,g[b.query.maptop]=e(u.subtract(r.getSize().divideBy(2))).y,g[b.query.mapright]=e(u.add(r.getSize().divideBy(2))).x,g[b.query.tilebottom]=e(d.max).y,g[b.query.tileleft]=e(d.min).x,g[b.query.tiletop]=e(d.min).y,g[b.query.tileright]=e(d.max).x,b.query)["mapi","mapj","tilei","tilej","row","col","x","y","easting","northing","longitude","latitude","width","height","zoom","mapleft","mapright",",maptop","mapbottom","tileleft","tileright","tiletop","tilebottom","pixeltop","pixelbottom","pixelleft","pixelright"].indexOf(_)<0&&(g[_]=b.query[_]);y.push(function(t,e){const h=new DOMParser;return fetch(L.Util.template(t.template,e),{redirect:"follow"}).then(e=>{if(200<=e.status&&e.status<300)return e.text().then(t=>({contenttype:e.headers.get("Content-Type"),text:t}));throw new Error(e.status)}).then(o=>{let n=[],i=[];var a="<map-geometry cs='gcrs'><map-point><map-coordinates>"+c.latlng.lng+" "+c.latlng.lat+"</map-coordinates></map-point></map-geometry>";if(o.contenttype.startsWith("text/mapml")){let t=h.parseFromString(o.text,"application/xml");var r=t.querySelectorAll("map-feature:not(:has(map-geometry))");if(r.length){let i=h.parseFromString(a,"application/xml");for(let e=0;e<r.length;e++){let t=r[e];t.appendChild(i.firstElementChild.cloneNode(!0))}}n=Array.prototype.slice.call(t.querySelectorAll("map-feature")),i=Array.prototype.slice.call(t.querySelectorAll("map-meta[name=cs], map-meta[name=zoom], map-meta[name=projection]")),i.length&&n.forEach(t=>t.meta=i)}else try{let t=h.parseFromString(o.text,"application/xml");var s,l=t.querySelectorAll("map-feature");if(t.querySelector("parsererror")||0===l.length)throw new Error("parsererror");let e=h.parseFromString(a,"application/xml");i=Array.prototype.slice.call(t.querySelectorAll("map-meta[name=cs], map-meta[name=zoom], map-meta[name=projection]"));for(s of l)s.querySelector("map-geometry")||s.appendChild(e.firstElementChild.cloneNode(!0)),s.meta=i,n.push(s)}catch(t){let e=h.parseFromString(o.text,"text/html"),i=h.parseFromString("<map-feature><map-properties></map-properties>"+a+"</map-feature>","text/html");e.body?i.querySelector("map-properties").appendChild(e.querySelector("html")):i.querySelector("map-properties").append(o.text),n.push(i.querySelector("map-feature"))}return{features:n,template:t}}).catch(t=>{console.log("Looks like there was a problem. Status: "+t.message)})}(b,g))}Promise.allSettled(y).then(t=>{a._mapmlFeatures=[];for(var e of t)if("fulfilled"===e.status){for(var i of e.value.features)i._linkEl=e.value.template.linkEl;a._mapmlFeatures=a._mapmlFeatures.concat(e.value.features)}0<a._mapmlFeatures.length&&function(o,n){if(0!==o.length){let t=M.featureLayer(o,{renderer:M.featureRenderer(),pane:l,projection:r.options.projection,_leafletLayer:a,query:!0,mapEl:a.options.mapEl});t.addTo(a);let e=L.DomUtil.create("div","mapml-popup-content"),i=L.DomUtil.create("iframe");i.style="border: none",i.srcdoc=o[0].querySelector("map-feature map-properties").innerHTML,i.setAttribute("sandbox","allow-same-origin allow-forms"),e.appendChild(i),a._totalFeatureCount=o.length,a.bindPopup(e,h).openPopup(n),a.on("popupclose",function(){a.removeLayer(t)}),t.showPaginationFeature({i:0,popup:a._popup})}}(a._mapmlFeatures,c.latlng)})}}),zo=L.Handler.extend({_touchstart:L.Browser.msPointer?"MSPointerDown":L.Browser.pointer?"pointerdown":"touchstart",initialize:function(t){L.Handler.prototype.initialize.call(this,t),this.activeIndex=0,this.excludedIndices=[4,7],this.isRunned=!1,this._menuItems={};this._menuItems.CTXBACK=0,this._menuItems.CTXFWD=1,this._menuItems.CTXRELOAD=2,this._menuItems.CTXFULLSCR=3,this._menuItems.CTXSPACER1=4,this._menuItems.CTXCOPY=5,this._menuItems.CTXPASTE=6,this._menuItems.CTXSPACER2=7,this._menuItems.CTXCNTRLS=8,this._menuItems.CTXDEBUG=9,this._menuItems.CTXVWSRC=10,this._items=[{text:M.options.locale.cmBack+" (<kbd>Alt+Left Arrow</kbd>)",callback:this._goBack},{text:M.options.locale.cmForward+" (<kbd>Alt+Right Arrow</kbd>)",callback:this._goForward},{text:M.options.locale.cmReload+" (<kbd>Ctrl+R</kbd>)",callback:this._reload},{text:M.options.locale.btnFullScreen+" (<kbd>F</kbd>)",callback:this._toggleFullScreen},{spacer:"-"},{text:M.options.locale.cmCopyCoords+" (<kbd>C</kbd>)<span></span>",callback:this._copyCoords,hideOnSelect:!1,popup:!0,submenu:[{text:M.options.locale.cmCopyMapML,callback:this._copyMapML},{text:M.options.locale.cmCopyExtent,callback:this._copyExtent},{text:M.options.locale.cmCopyLocation,callback:this._copyLocation}]},{text:M.options.locale.cmPasteLayer+" (<kbd>P</kbd>)",callback:this._paste},{spacer:"-"},{text:M.options.locale.cmToggleControls+" (<kbd>T</kbd>)",callback:this._toggleControls},{text:M.options.locale.cmToggleDebug+" (<kbd>D</kbd>)",callback:this._toggleDebug},{text:M.options.locale.cmViewSource+" (<kbd>V</kbd>)",callback:this._viewSource}],this.defExtCS=M.options.defaultExtCoor,this.defLocCS=M.options.defaultLocCoor;this._menuItems.LYRZOOMTO=0,this._menuItems.LYRCOPY=1,this._layerItems=[{text:M.options.locale.lmZoomToLayer+" (<kbd>Z</kbd>)",callback:this._zoomToLayer},{text:M.options.locale.lmCopyLayer+" (<kbd>L</kbd>)",callback:this._copyLayer}],this._extentLayerItems=[{text:M.options.locale.lmZoomToExtent+" (<kbd>Z</kbd>)",callback:this._zoomToMapExtent},{text:M.options.locale.lmCopyExtent+" (<kbd>L</kbd>)",callback:this._copyMapExtent}],this._mapMenuVisible=!1,this._keyboardEvent=!1,this._container=L.DomUtil.create("div","mapml-contextmenu",t.getContainer()),this._container.setAttribute("hidden",""),this._items[0].el=this._createItem(this._container,this._items[0]),this._items[1].el=this._createItem(this._container,this._items[1]),this._items[2].el=this._createItem(this._container,this._items[2]),this._items[3].el=this._createItem(this._container,this._items[3]),this._items[4].el=this._createItem(this._container,this._items[4]),this._items[5].el=this._createItem(this._container,this._items[5]),this._copySubMenu=L.DomUtil.create("div","mapml-contextmenu mapml-submenu",this._container),this._copySubMenu.id="mapml-copy-submenu",this._copySubMenu.setAttribute("hidden",""),this._clickEvent=null;this._menuItems.CPYMENUMAP=0,this._menuItems.CPYMENUEXTENT=1,this._menuItems.CPYMENULOC=2,this._createItem(this._copySubMenu,this._items[5].submenu[0],0),this._createItem(this._copySubMenu,this._items[5].submenu[1],1),this._createItem(this._copySubMenu,this._items[5].submenu[2],2),this._items[6].el=this._createItem(this._container,this._items[6]),this._items[7].el=this._createItem(this._container,this._items[7]),this._items[8].el=this._createItem(this._container,this._items[8]),this._items[9].el=this._createItem(this._container,this._items[9]),this._items[10].el=this._createItem(this._container,this._items[10]),this._layerMenu=L.DomUtil.create("div","mapml-contextmenu mapml-layer-menu",t.getContainer()),this._layerMenu.setAttribute("hidden",""),this._createItem(this._layerMenu,this._layerItems[0]),this._createItem(this._layerMenu,this._layerItems[1]),this._extentLayerMenu=L.DomUtil.create("div","mapml-contextmenu mapml-extent-menu",t.getContainer()),this._extentLayerMenu.setAttribute("hidden",""),this._createItem(this._extentLayerMenu,this._extentLayerItems[0]),this._createItem(this._extentLayerMenu,this._extentLayerItems[1]),L.DomEvent.on(this._container,"click",L.DomEvent.stop).on(this._container,"mousedown",L.DomEvent.stop).on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"contextmenu",L.DomEvent.stop).on(this._layerMenu,"click",L.DomEvent.stop).on(this._layerMenu,"mousedown",L.DomEvent.stop).on(this._layerMenu,"dblclick",L.DomEvent.stop).on(this._layerMenu,"contextmenu",L.DomEvent.stop).on(this._extentLayerMenu,"click",L.DomEvent.stop).on(this._extentLayerMenu,"mousedown",L.DomEvent.stop).on(this._extentLayerMenu,"dblclick",L.DomEvent.stop).on(this._extentLayerMenu,"contextmenu",L.DomEvent.stop),this.t=document.createElement("template"),this.t.innerHTML=`<map-feature zoom="">
        <map-featurecaption></map-featurecaption>
        <map-properties>
            <h2></h2>
            <div style="text-align:center"></div>
        </map-properties>
        <map-geometry cs="">
          <map-point>
            <map-coordinates></map-coordinates>
          </map-point>
        </map-geometry>
      </map-feature>`},addHooks:function(){var t=this._map.getContainer();L.DomEvent.on(t,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),L.Browser.touch&&L.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var t=this._map.getContainer();L.DomEvent.off(t,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),L.Browser.touch&&L.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},_updateCS:function(){this.defExtCS===M.options.defaultExtCoor&&this.defLocCS===M.options.defaultLocCoor||(this.defExtCS=M.options.defaultExtCoor,this.defLocCS=M.options.defaultLocCoor)},_copyExtent:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,i=e.defExtCS?e.defExtCS.toLowerCase():"pcrs",o=(t instanceof KeyboardEvent?this:this.options.mapEl).extent.topLeft[i],n=(t instanceof KeyboardEvent?this:this.options.mapEl).extent.bottomRight[i],a="";"pcrs"===i?a=`<map-meta name="extent" content="top-left-easting=${Math.round(o.horizontal)}, top-left-northing=${Math.round(o.vertical)}, bottom-right-easting=${Math.round(n.horizontal)}, bottom-right-northing=${Math.round(n.vertical)}"></map-meta>`:"gcrs"===i?a=`<map-meta name="extent" content="top-left-longitude=${o.horizontal}, top-left-latitude=${o.vertical}, bottom-right-longitude=${n.horizontal}, bottom-right-latitude=${n.vertical}"></map-meta>`:"tcrs"===i?a=`<map-meta name="extent" content="top-left-x=${o[0].horizontal}, top-left-y=${o[0].vertical}, bottom-right-x=${n[n.length-1].horizontal}, bottom-right-y=${n[n.length-1].vertical}"></map-meta>`:"tilematrix"===i?a=`<map-meta name="extent" content="top-left-column=${o[0].horizontal}, top-left-row=${o[0].vertical}, bottom-right-column=${n[n.length-1].horizontal}, bottom-right-row=${n[n.length-1].vertical}"></map-meta>`:console.log("not support"),e._copyData(a)},_zoomToLayer:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu;e._layerClicked.layer._layerEl.zoomTo()},_copyLayer:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,i=e._layerClicked.layer._layerEl;e._copyData(i.getOuterHTML())},_zoomToMapExtent:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu;e._layerClicked.extent.zoomTo()},_copyMapExtent:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,i=e._layerClicked.extent;e._copyData(i.getOuterHTML())},_goForward:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.forward()},_goBack:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.back()},_reload:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.reload()},_toggleFullScreen:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e._toggleFullScreen()},_toggleControls:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.controls?e.controls=!1:e.controls=!0},_copyMapML:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,i=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e._copyData(i.outerHTML.replace(/<div class="mapml-web-map">.*?<\/div>|<style>\[is="web-map"].*?<\/style>|<style>mapml-viewer.*?<\/style>/gm,""))},_paste:function(t){(t instanceof KeyboardEvent?this._map:this).contextMenu;let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;navigator.clipboard.readText().then(t=>{M._pasteLayer(e,t)})},_viewSource:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.viewSource()},_toggleDebug:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.toggleDebug()},_copyCoords:function(t){let e=this.contextMenu||this;e._showCopySubMenu(t)},_copyData:function(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},_copyLocation:function(t){const e=this.contextMenu;switch(e.defLocCS.toLowerCase()){case"tile":e._copyTile.call(this,t);break;case"tilematrix":e._copyTileMatrix.call(this,t);break;case"map":e._copyMap.call(this,t);break;case"tcrs":e._copyTCRS.call(this,t);break;case"pcrs":e._copyPCRS.call(this,t);break;default:e._copyGCRS.call(this,t)}},_copyGCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e.projection,n=this.contextMenu.t.content.firstElementChild.cloneNode(!0),a=n.querySelector("map-featurecaption"),r=n.querySelector("h2"),s=n.querySelector("div"),l=n.querySelector("map-geometry"),h=n.querySelector("map-coordinates");n.setAttribute("zoom",e.zoom),l.setAttribute("cs","gcrs"),a.textContent=`Copied ${o} gcrs location`,r.textContent=`Copied ${o} gcrs location`,s.textContent=i.latlng.lng.toFixed(6)+" "+i.latlng.lat.toFixed(6),h.textContent=i.latlng.lng.toFixed(6)+" "+i.latlng.lat.toFixed(6),this.contextMenu._copyData(n.outerHTML)},_copyTCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=o.x.toFixed(),a=o.y.toFixed(),r=e.projection,s=this.contextMenu.t.content.firstElementChild.cloneNode(!0),l=s.querySelector("map-featurecaption"),h=s.querySelector("h2"),c=s.querySelector("div"),u=s.querySelector("map-geometry"),m=s.querySelector("map-coordinates");s.setAttribute("zoom",e.zoom),u.setAttribute("cs","tcrs"),l.textContent=`Copied ${r} tcrs location`,h.textContent=`Copied ${r} tcrs location`,c.textContent=n+" "+a,m.textContent=n+" "+a,this.contextMenu._copyData(s.outerHTML)},_copyTileMatrix:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x,a=e.projection,r=this.contextMenu.t.content.firstElementChild.cloneNode(!0),s=r.querySelector("map-featurecaption"),l=r.querySelector("h2"),h=r.querySelector("div"),c=r.querySelector("map-geometry"),u=r.querySelector("map-coordinates");r.setAttribute("zoom",e.zoom),c.setAttribute("cs","gcrs"),s.textContent=`Copied ${a} tilematrix location (not implemented yet)`,l.textContent=`Copied ${a} tilematrix location (not implemented yet)`,h.textContent=Math.trunc(o.x/n)+" "+Math.trunc(o.y/n),u.textContent=i.latlng.lng.toFixed(6)+" "+i.latlng.lat.toFixed(6),this.contextMenu._copyData(r.outerHTML)},_copyPCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=e._map.options.crs.scale(+e.zoom),a=e._map.options.crs.transformation.untransform(o,n).round(),r=e.projection,s=this.contextMenu.t.content.firstElementChild.cloneNode(!0),l=s.querySelector("map-featurecaption"),h=s.querySelector("h2"),c=s.querySelector("div"),u=s.querySelector("map-geometry"),m=s.querySelector("map-coordinates");s.setAttribute("zoom",e.zoom),u.setAttribute("cs","pcrs"),l.textContent=`Copied ${r} pcrs location`,h.textContent=`Copied ${r} pcrs location`,c.textContent=a.x+" "+a.y,m.textContent=a.x+" "+a.y,this.contextMenu._copyData(s.outerHTML)},_copyTile:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x,a=o.x%n,r=o.y%n,s=L.point(a,r).trunc(),l=e.projection,h=this.contextMenu.t.content.firstElementChild.cloneNode(!0),c=h.querySelector("map-featurecaption"),u=h.querySelector("h2"),m=h.querySelector("div"),d=h.querySelector("map-geometry"),p=h.querySelector("map-coordinates");s.x<0&&(s.x+=n),s.y<0&&(s.y+=n),h.setAttribute("zoom",e.zoom),d.setAttribute("cs","gcrs"),c.textContent=`Copied ${l} tile location (not implemented yet)`,u.textContent=`Copied ${l} tile location (not implemented yet)`,m.textContent=s.x+" "+s.y,p.textContent=i.latlng.lng.toFixed(6)+" "+i.latlng.lat.toFixed(6),this.contextMenu._copyData(h.outerHTML)},_copyMap:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=i.containerPoint.trunc(),n=e.projection,a=this.contextMenu.t.content.firstElementChild.cloneNode(!0),r=a.querySelector("map-featurecaption"),s=a.querySelector("h2"),l=a.querySelector("div"),h=a.querySelector("map-geometry"),c=a.querySelector("map-coordinates");a.setAttribute("zoom",e.zoom),h.setAttribute("cs","gcrs"),r.textContent=`Copied ${n} map location (not implemented yet)`,s.textContent=`Copied ${n} map location (not implemented yet)`,l.textContent=o.x+" "+o.y,c.textContent=i.latlng.lng.toFixed(6)+" "+i.latlng.lat.toFixed(6),this.contextMenu._copyData(a.outerHTML)},_copyAllCoords:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x,a=o.x%n,r=o.y%n,s=e._map.options.crs.scale(+e.zoom),l=e._map.options.crs.transformation.untransform(o,s);var h=`z:${e.zoom}
`;h+=`tile: i:${Math.trunc(a)}, j:${Math.trunc(r)}
`,h+=`tilematrix: column:${Math.trunc(o.x/n)}, row:${Math.trunc(o.y/n)}
`,h+=`map: i:${Math.trunc(i.containerPoint.x)}, j:${Math.trunc(i.containerPoint.y)}
`,h+=`tcrs: x:${Math.trunc(o.x)}, y:${Math.trunc(o.y)}
`,h+=`pcrs: easting:${l.x.toFixed(2)}, northing:${l.y.toFixed(2)}
`,h+=`gcrs: lon :${i.latlng.lng.toFixed(6)}, lat:`+i.latlng.lat.toFixed(6),this.contextMenu._copyData(h)},_createItem:function(t,e,i){if(e.spacer)return this._createSeparator(t,i);t=this._insertElementAt("button","mapml-contextmenu-item",t,i),i=this._createEventHandler(t,e.callback,e.context,e.hideOnSelect);return t.innerHTML=""+e.text,t.setAttribute("type","button"),t.classList.add("mapml-button"),e.popup&&(t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","mapml-copy-submenu")),L.DomEvent.on(t,"mouseover",this._onItemMouseOver,this).on(t,"mouseout",this._onItemMouseOut,this).on(t,"mousedown",L.DomEvent.stopPropagation).on(t,"click",i),L.Browser.touch&&L.DomEvent.on(t,this._touchstart,L.DomEvent.stopPropagation),L.Browser.pointer||L.DomEvent.on(t,"click",this._onItemMouseOut,this),{id:L.Util.stamp(t),el:t,callback:i}},_createSeparator:function(t,e){e=this._insertElementAt("div","mapml-contextmenu-separator",t,e);return{id:L.Util.stamp(e),el:e}},_createEventHandler:function(s,l,h,c){let u=this;return c=void 0===c||c,function(t){let e=u._map,i=u._showLocation.containerPoint,o=e.containerPointToLayerPoint(i),n=e.layerPointToLatLng(o),a=u._showLocation.relatedTarget,r={containerPoint:i,layerPoint:o,latlng:n,relatedTarget:a};c&&u._hide(),l&&l.call(h||e,r),u._map.fire("contextmenu.select",{contextmenu:u,el:s})}},_insertElementAt:function(t,e,i,o){let n,a=document.createElement(t);return a.className=e,void 0!==o&&(n=i.children[o]),n?i.insertBefore(a,n):i.appendChild(a),a},_show:function(e){if(!e.originalEvent.target.closest(".mapml-vector-container")){this._mapMenuVisible&&this._hide();let t=(this._clickEvent=e).originalEvent.target;if(t.closest("fieldset"))t=t.closest("fieldset"),"mapml-layer-item"===t.className?(t=t.querySelector("span"),this._layerMenu.removeAttribute("hidden"),this._showAtPoint(e.containerPoint,e,this._layerMenu)):"mapml-layer-extent"===t.className&&(t=t.querySelector("span"),this._extentLayerMenu.removeAttribute("hidden"),this._showAtPoint(e.containerPoint,e,this._extentLayerMenu)),this._layerClicked=t;else if(t.classList.contains("leaflet-container")||t.classList.contains("mapml-debug-extent")||"path"===t.tagName){var i=this._map.options.mapEl.layers;this._layerClicked=Array.from(i).find(t=>t.checked);let t=e.containerPoint;L.Browser.gecko&&(t=(o=this._map.getContainer(),i=o.getBoundingClientRect().width,o=o.getBoundingClientRect().height,{x:Number.parseInt(i/2),y:Number.parseInt(o/2)})),this._container.removeAttribute("hidden"),this._showAtPoint(t,e,this._container),this._updateCS()}var o,n;0!==e.originalEvent.button&&-1!==e.originalEvent.button||(this._keyboardEvent=!0,this._layerClicked.className.includes("mapml-layer-item")?(n=document.activeElement,this._elementInFocus=n.shadowRoot.activeElement,this._layerMenuTabs=1,this._layerMenu.firstChild.focus()):this._layerClicked.className.includes("mapml-extent-item")?(n=document.activeElement,this._elementInFocus=n.shadowRoot.activeElement,this._extentLayerMenuTabs=1,this._extentLayerMenu.firstChild.focus()):this._container.querySelectorAll("button:not([disabled])")[0].focus())}},_showAtPoint:function(t,e,i){var o;this._items.length&&(o=L.extend(e||{},{contextmenu:this}),this._showLocation={containerPoint:t},e&&e.relatedTarget&&(this._showLocation.relatedTarget=e.relatedTarget),this._setPosition(t,i),this._mapMenuVisible||(i.removeAttribute("hidden"),this._mapMenuVisible=!0),this._map.fire("contextmenu.show",o))},_hide:function(){this._mapMenuVisible&&(this._mapMenuVisible=!1,this._container.setAttribute("hidden",""),this._copySubMenu.setAttribute("hidden",""),this._layerMenu.setAttribute("hidden",""),this._extentLayerMenu.setAttribute("hidden",""),this._map.fire("contextmenu.hide",{contextmenu:this}),setTimeout(()=>this._map._container.focus(),0),this.activeIndex=0,this.isRunned=!1)},_setPosition:function(t,e){var i,o=this._map.getSize(),n=this._getElementSize(e);this._map.options.contextmenuAnchor&&(i=L.point(this._map.options.contextmenuAnchor),t=t.add(i)),(e._leaflet_pos=t).x+n.x>o.x?(e.style.left="auto",e.style.right=Math.min(Math.max(o.x-t.x,0),o.x-n.x-1)+"px"):(e.style.left=Math.max(t.x,0)+"px",e.style.right="auto"),t.y+n.y>o.y?(e.style.top="auto",e.style.bottom=Math.min(Math.max(o.y-t.y,0),o.y-n.y-1)+"px"):(e.style.top=Math.max(t.y,0)+"px",e.style.bottom="auto")},_getElementSize:function(t){let e=this._size;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",this._sizeChanged=!1),e},_focusOnLayerControl:function(){this._mapMenuVisible=!1,delete this._layerMenuTabs,delete this._extentLayerMenuTabs,this._layerMenu.setAttribute("hidden",""),this._extentLayerMenu.setAttribute("hidden",""),(this._elementInFocus||this._layerClicked.parentElement.firstChild).focus(),delete this._elementInFocus},_setActiveItem:function(i){if(null===document.activeElement.shadowRoot&&!0===this.noActiveEl&&(this.noActiveEl=!1,this._items[9].el.el.focus()),document.activeElement.shadowRoot.activeElement.innerHTML===this._items[i].el.el.innerHTML){let t=i+1;for(;this._items[t].el.el.disabled;)t++,t>=this._items.length&&(t=0);this._setActiveItem(t)}else if(this.excludedIndices.includes(i)){let t=i+1,e=i-1;for(;this.excludedIndices.includes(t)||this._items[t].el.el.disabled;)t++,t>=this._items.length&&(t=0);for(;this.excludedIndices.includes(e)||this._items[e].el.el.disabled;)e--,e<0&&(e=this._items.length-1);this.activeIndex<i?this._setActiveItem(t):this._setActiveItem(e)}else this._items[i].el.el.focus(),this.activeIndex=i},_onKeyDown:function(t){if(this._mapMenuVisible&&"Shift"!==t.key){if("Enter"!==t.code&&"Tab"!==t.code&&!t.code.startsWith("Arrow")||t.preventDefault(),"ArrowUp"===t.code||t.shiftKey&&"Tab"===t.code)if(this._copySubMenu.hasAttribute("hidden")||null!==document.activeElement.shadowRoot&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML)if(this._copySubMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML)if(this._copySubMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML)if(this._layerMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML)if(this._layerMenu.hasAttribute("hidden"))if(this._extentLayerMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._extentLayerMenu.children[this._menuItems.LYRZOOMTO].innerHTML)if(this._extentLayerMenu.hasAttribute("hidden"))if(0<this.activeIndex){let t=this.activeIndex-1;for(;this._items[t].el.el.disabled;)t--,t<0&&(t=this._items.length-1);this._setActiveItem(t)}else this._setActiveItem(this._items.length-1);else this._extentLayerMenu.children[this._menuItems.LYRZOOMTO].focus();else this._extentLayerMenu.children[this._menuItems.LYRCOPY].focus();else this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();else this._layerMenu.children[this._menuItems.LYRCOPY].focus();else this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();else this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();else this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();else if("ArrowDown"===t.code||"Tab"===t.code)if(this._copySubMenu.hasAttribute("hidden")||null!==document.activeElement.shadowRoot&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML)if(this._copySubMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML)if(this._copySubMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML)if(this._layerMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML)if(this._layerMenu.hasAttribute("hidden"))if(this._extentLayerMenu.hasAttribute("hidden")||document.activeElement.shadowRoot.activeElement.innerHTML!==this._extentLayerMenu.children[this._menuItems.LYRZOOMTO].innerHTML)if(this._extentLayerMenu.hasAttribute("hidden"))if(this.activeIndex<this._items.length-1)if(this.isRunned||0!==this.activeIndex||this._items[this.activeIndex].el.el.disabled){let t=this.activeIndex+1;for(;this._items[t].el.el.disabled;)t++,t>=this._items.length&&(t=0);this._setActiveItem(t)}else this._setActiveItem(0),this.isRunned=!0;else{let t=0;for(;this._items[t].el.el.disabled;)t++,t>=this._items.length&&(t=0);this._setActiveItem(t)}else this._extentLayerMenu.children[this._menuItems.LYRZOOMTO].focus();else this._extentLayerMenu.children[this._menuItems.LYRCOPY].focus();else this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();else this._layerMenu.children[this._menuItems.LYRCOPY].focus();else this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();else this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();else this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();else if("ArrowRight"===t.code)null!==document.activeElement.shadowRoot&&document.activeElement.shadowRoot.activeElement.innerHTML===this._items[this._menuItems.CTXCOPY].el.el.innerHTML&&this._copySubMenu.hasAttribute("hidden")?(this._showCopySubMenu(),this._copySubMenu.children[0].focus()):document.activeElement.shadowRoot.activeElement.innerHTML!==this._items[this._menuItems.CTXCOPY].el.el.innerHTML||this._copySubMenu.hasAttribute("hidden")||this._copySubMenu.children[0].focus();else if("ArrowLeft"===t.code)this._copySubMenu.hasAttribute("hidden")||null===document.activeElement.shadowRoot||document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML||(this._copySubMenu.setAttribute("hidden",""),this._setActiveItem(this._menuItems.CTXCOPY));else if("Escape"===t.code){if(this._layerMenuTabs||this._extentLayerMenuTabs)return L.DomEvent.stop(t),void this._focusOnLayerControl();null===document.activeElement.shadowRoot||this._copySubMenu.hasAttribute("hidden")?this._hide():document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML||(this._copySubMenu.setAttribute("hidden",""),this._setActiveItem(this._menuItems.CTXCOPY))}else"KeyC"!==t.code&&document.activeElement.shadowRoot.activeElement.innerHTML!==this._items[this._menuItems.CTXCOPY].el.el.innerHTML&&this._hide();switch(t.code){case"Enter":document.activeElement.shadowRoot.activeElement.innerHTML===this._items[this._menuItems.CTXCOPY].el.el.innerHTML?(this._copyCoords({latlng:this._map.getCenter()}),this._copySubMenu.firstChild.focus()):this._map._container.parentNode.activeElement.parentNode.classList.contains("mapml-contextmenu")&&this._map._container.parentNode.activeElement.click();break;case"Space":this._map._container.parentNode.activeElement.parentNode.classList.contains("mapml-contextmenu")&&this._map._container.parentNode.activeElement.click();break;case"KeyC":this._copyCoords({latlng:this._map.getCenter()}),this._copySubMenu.firstChild.focus();break;case"KeyD":this._toggleDebug(t);break;case"KeyM":this._copyMapML(t);break;case"KeyL":this._layerClicked.className.includes("mapml-layer-item")?this._copyLayer(t):this._layerClicked.className.includes("mapml-extent-item")&&this._copyMapExtent(t);break;case"KeyF":this._toggleFullScreen(t);break;case"KeyP":this._paste(t);break;case"KeyT":this._toggleControls(t);break;case"KeyV":this._viewSource(t);break;case"KeyZ":this._layerClicked.className.includes("mapml-layer-item")?this._zoomToLayer(t):this._layerClicked.className.includes("mapml-extent-item")&&this._zoomToMapExtent(t)}}},_showCopySubMenu:function(t){let e=this._map.getSize(),i=this._clickEvent,o=this._copySubMenu,n=this._items[5].el.el;n.setAttribute("aria-expanded","true"),o.removeAttribute("hidden");var a=this._container.offsetWidth;this._container.offsetHeight;var r=o.offsetWidth;i.containerPoint.x+a+r>e.x?(o.style.left="auto",o.style.right=a+"px"):(o.style.left=a+"px",o.style.right="auto"),o.style.top="78px",o.style.bottom="auto"},_hideCopySubMenu:function(t){if(t.relatedTarget&&t.relatedTarget.parentElement&&!t.relatedTarget.parentElement.classList.contains("mapml-submenu")&&!t.relatedTarget.classList.contains("mapml-submenu")){let t=this._copySubMenu,e=this._items[4].el.el;e.setAttribute("aria-expanded","false"),t.setAttribute("hidden",""),this.noActiveEl=!0}},_onItemMouseOver:function(t){L.DomUtil.addClass(t.target||t.srcElement,"over"),t.srcElement.innerText===M.options.locale.cmCopyCoords+" (C)"&&this._showCopySubMenu(t)},_onItemMouseOut:function(t){L.DomUtil.removeClass(t.target||t.srcElement,"over"),this._hideCopySubMenu(t)},toggleContextMenuItem:function(t,e){t=t.toUpperCase(),"disabled"===e?"CONTROLS"===t?this._items[8].el.el.disabled=!0:"BACK"===t?this._items[0].el.el.disabled=!0:"FORWARD"===t?this._items[1].el.el.disabled=!0:"RELOAD"===t&&(this._items[2].el.el.disabled=!0):"enabled"===e&&("CONTROLS"===t?this._items[8].el.el.disabled=!1:"BACK"===t?this._items[0].el.el.disabled=!1:"FORWARD"===t?this._items[1].el.el.disabled=!1:"RELOAD"===t&&(this._items[2].el.el.disabled=!1))},setViewFullScreenInnerHTML:function(t){"view"===t?this._map.contextMenu._items[3].el.el.innerHTML=M.options.locale.btnFullScreen+" (<kbd>F</kbd>)":"exit"===t&&(this._map.contextMenu._items[3].el.el.innerHTML=M.options.locale.btnExitFullScreen+" (<kbd>F</kbd>)")}}),ai=function(e,i,t){if(!e||!i)return{};let o=[],n=[],a=[],r=[],s=i.options.crs.tile.bounds.max.y;for(let t=0;t<i.options.resolutions.length;t++){var l=i.scale(t),h=i.transformation.transform(e.min,l),l=i.transformation.transform(e.max,l);o.push({horizontal:h.x,vertical:l.y}),n.push({horizontal:l.x,vertical:h.y}),a.push({horizontal:o[t].horizontal/s,vertical:o[t].vertical/s}),r.push({horizontal:n[t].horizontal/s,vertical:n[t].vertical/s})}var c=i.unproject(e.min),u=i.unproject(e.max),u={topLeft:{horizontal:c.lng,vertical:u.lat},bottomRight:{horizontal:u.lng,vertical:c.lat}},c={topLeft:{horizontal:e.min.x,vertical:e.max.y},bottomRight:{horizontal:e.max.x,vertical:e.min.y}};let m={topLeft:{tcrs:o,tilematrix:a,gcrs:u.topLeft,pcrs:c.topLeft},bottomRight:{tcrs:n,tilematrix:r,gcrs:u.bottomRight,pcrs:c.bottomRight}};return t&&(m.projection=t),m},pi=function(t,e){switch(e.toUpperCase()){case"PCRS":return L.bounds(L.point(t.topLeft.pcrs.horizontal,t.topLeft.pcrs.vertical),L.point(t.bottomRight.pcrs.horizontal,t.bottomRight.pcrs.vertical));case"GCRS":return L.latLngBounds(L.latLng(t.topLeft.gcrs.vertical,t.topLeft.gcrs.horizontal),L.latLng(t.bottomRight.gcrs.vertical,t.bottomRight.gcrs.horizontal))}},yi=function(t){try{switch(t.toLowerCase()){case"row":case"column":return"TILEMATRIX";case"i":case"j":return["MAP","TILE"];case"x":case"y":return"TCRS";case"latitude":case"longitude":return"GCRS";case"northing":case"easting":return"PCRS";default:return M.FALLBACK_CS}}catch(t){return}},gi=function(t){try{switch(t.toLowerCase()){case"tilematrix":return["column","row"];case"map":case"tile":return["i","j"];case"tcrs":return["x","y"];case"gcrs":return["longitude","latitude"];case"pcrs":return["easting","northing"]}}catch(t){return}},xi=function(t){try{switch(t.toLowerCase()){case"i":case"column":case"longitude":case"x":case"easting":return"x";case"row":case"j":case"latitude":case"y":case"northing":return"y";default:return}}catch(t){return}},Li=function(t,e,i,o){if(t&&(e||0===e)&&Number.isFinite(+e)&&i&&o)switch(i="string"==typeof i?M[i]:i,o.toUpperCase()){case"PCRS":return t;case"TCRS":case"TILEMATRIX":var n=i.transformation.transform(t.min,i.scale(+e)),a=i.transformation.transform(t.max,i.scale(+e));if("TCRS"===o.toUpperCase())return L.bounds(n,a);var r=i.options.crs.tile.bounds.max.x;return L.bounds(L.point(n.x/r,n.y/r),L.point(a.x/r,a.y/r));case"GCRS":a=i.unproject(t.min),r=i.unproject(t.max);return L.bounds(L.point(a.lng,a.lat),L.point(r.lng,r.lat));default:return}},Ci=function(t,e,i,o){if(t&&(void 0===e||Number.isFinite(+e))&&(void 0!==e||"TILEMATRIX"!==o&&"TCRS"!==o&&"TILE"!==o)&&o&&i){var n=(i="string"==typeof i?M[i]:i).options.crs.tile.bounds.max.x;switch(o.toUpperCase()){case"TILEMATRIX":return M.pixelToPCRSPoint(L.point(t.x*n,t.y*n),e,i);case"PCRS":return t;case"TCRS":return M.pixelToPCRSPoint(t,e,i);case"GCRS":return i.project(L.latLng(t.y,t.x));default:return}}},Ti=function(t,e,i){if(t&&(e||0===e)&&Number.isFinite(+e)&&i)return(i="string"==typeof i?M[i]:i).transformation.untransform(t,i.scale(e))},ki=function(t,e,i,o){if(t&&t.max&&t.min&&(void 0===e||Number.isFinite(+e))&&(void 0!==e||"TILEMATRIX"!==o&&"TCRS"!==o&&"TILE"!==o)&&i&&o)return i="string"==typeof i?M[i]:i,L.bounds(M.pointToPCRSPoint(t.min,e,i,o),M.pointToPCRSPoint(t.max,e,i,o))},Ai=function(t,e,i){if(t&&t.max&&t.min&&(e||0===e)&&Number.isFinite(+e)&&i)return i="string"==typeof i?M[i]:i,L.bounds(M.pixelToPCRSPoint(t.min,e,i),M.pixelToPCRSPoint(t.max,e,i))},Pi=function(t){if(!t||t instanceof Object)return{};let e=t.split(/\s+/).join(""),i={},o=e.split(",");for(let t=0;t<o.length;t++){var n=o[t].split("=");2===n.length&&(i[n[0]]=n[1])}return""!==i&&1===o[0].split("=").length&&(i.content=o[0]),i},Fi=function(t){for(var e=1,i=[],o=t.split(",");e<o.length;e+=2)i.push([parseInt(o[e-1]),parseInt(o[e])]);return i},Di=function(t,e,i){var o=[];t.split(/\s+/gim).forEach(M._parseNumber,o),this.push(o)},Ao=function(t,e,i){this.push(parseFloat(t))},It=function(i,t){let o,n=!1,e,a=t._map,r;if("text/html"===i.type&&"_blank"!==i.target)i.target="_top";else if("text/html"!==i.type&&i.url.includes("#")){let t=i.url.split("#"),e=t[1].split(",");o={z:e[0]||0,lng:e[1]||0,lat:e[2]||0},n=!t[0],["/",".","#"].includes(i.url[0])&&(i.target="_self")}if(n)o&&!i.inPlace&&n&&(t._map.options.mapEl.zoomTo(+o.lat,+o.lng,+o.z),r&&(e.opacity=r),a.getContainer().focus());else switch(e=document.createElement("layer-"),e.setAttribute("src",i.url),e.setAttribute("checked",""),i.target){case"_blank":"text/html"===i.type?window.open(i.url):(l(),a.options.mapEl.appendChild(e));break;case"_parent":l();for(var s of a.options.mapEl.querySelectorAll("layer-"))s._layer!==t&&a.options.mapEl.removeChild(s);a.options.mapEl.appendChild(e),a.options.mapEl.removeChild(t._layerEl);break;case"_top":window.location.href=i.url;break;default:l(),r=t._layerEl.opacity,t._layerEl.insertAdjacentElement("beforebegin",e),a.options.mapEl.removeChild(t._layerEl)}function l(){var t;!i.inPlace&&o&&(t=o,a.options.mapEl.lat=+t.lat,a.options.mapEl.lon=+t.lng,a.options.mapEl.zoom=+t.z),e.whenReady().then(()=>{!i.inPlace&&o?e.parentElement.zoomTo(+o.lat,+o.lng,+o.z):i.inPlace||e.zoomTo(),r&&(e.opacity=r),a.getContainer().focus()})}},zt=function(t){if(!t)return null;let i,o=t instanceof ShadowRoot?":host":":scope",n=t.querySelector(o+" > map-meta[name=projection]")&&M._metaContentToObject(t.querySelector(o+" > map-meta[name=projection]").getAttribute("content")).content.toUpperCase()||M.FALLBACK_PROJECTION;try{var a=t.querySelector(o+" > map-meta[name=extent]")&&M._metaContentToObject(t.querySelector(o+" > map-meta[name=extent]").getAttribute("content")),r=a.zoom;let e=Object.keys(a);for(let t=0;t<e.length;t++)if(!e[t].includes("zoom")){i=M.axisToCS(e[t].split("-")[2]);break}if(void 0===i)throw new Error("cs undefined when getting bounds");if(void 0===r&&("TILEMATRIX"===i||"TCRS"===i||"TILE"===i))throw new Error("map-meta[name=extent] zoom= parameter not provided for tcrs,tile or tilematrix bounds");var s=M.csToAxes(i);return M.boundsToPCRSBounds(L.bounds(L.point(+a["top-left-"+s[0]],+a["top-left-"+s[1]]),L.point(+a["bottom-right-"+s[0]],+a["bottom-right-"+s[1]])),r,n,i)}catch(t){return M.boundsToPCRSBounds(M[n].options.crs.tilematrix.bounds(0),0,n,i)}},xe=function(t){if(!t)return null;var e=t instanceof ShadowRoot?":host":":scope",e=M._metaContentToObject(t.querySelector(e+"> map-meta[name=zoom]").getAttribute("content"));return e.min&&e.max&&e.value?{minZoom:+e.min,maxZoom:+e.max,minNativeZoom:+e.value,maxNativeZoom:+e.value}:e.min&&e.max?{minZoom:+e.min,maxZoom:+e.max}:e.min?{minZoom:+e.min}:e.max?{maxZoom:+e.max}:void 0},Le=function(t,i){if(!t)return null;let o=100,n=0,a=t.querySelectorAll("map-feature"),e,r;for(let e=0;e<a.length;e++){let t=+a[e].getAttribute("zoom");a[e].getAttribute("zoom")||(t=i),n=Math.max(n,t),o=Math.min(o,t)}try{r=M._metaContentToObject(t.querySelector("map-meta[name=projection]").getAttribute("content")).content,e=M._metaContentToObject(t.querySelector("map-meta[name=zoom]").getAttribute("content"))}catch(t){return{minZoom:0,maxZoom:M[r||M.FALLBACK_PROJECTION].options.resolutions.length-1,minNativeZoom:o,maxNativeZoom:n}}return{minZoom:+e.min,maxZoom:+e.max,minNativeZoom:o,maxNativeZoom:n}},Me=function(e){let i,o;if(e.length&&e[0].parentElement.parentElement&&"mapml-"===e[0].parentElement.parentElement.tagName){let t=e[0].parentElement.parentElement;i=t.querySelector&&t.querySelector("map-meta[name=zoom]")&&+M._metaContentToObject(t.querySelector("map-meta[name=zoom]").getAttribute("content")).value||0,o=t.querySelector&&t.querySelector("map-meta[name=cs]")&&M._metaContentToObject(t.querySelector("map-meta[name=cs]").getAttribute("content")).content||"GCRS"}else i=e.querySelector&&e.querySelector("map-meta[name=zoom]")&&+M._metaContentToObject(e.querySelector("map-meta[name=zoom]").getAttribute("content")).value||0,o=e.querySelector&&e.querySelector("map-meta[name=cs]")&&M._metaContentToObject(e.querySelector("map-meta[name=cs]").getAttribute("content")).content||"GCRS";return{zoom:i,cs:o}},Se=function(t){var e=t._map.project(t._map.getCenter()),t=t._map.options.crs.options.crs.tile.bounds.max.y;return[Math.trunc(e.x/t),Math.trunc(e.y/t)]},wi=function(e,i){try{new URL(i);let t='<layer- src="'+i+'" label="'+M.options.locale.dfLayer+'" checked=""></layer->';e.insertAdjacentHTML("beforeend",t),e.lastElementChild.whenReady().catch(()=>{e&&e.removeChild(e.lastChild),t=null})}catch(t){if("<layer-"===(i=i.replace(/(<!--.*?-->)|(<!--[\S\s]+?-->)|(<!--[\S\s]*?$)/g,"").trim()).slice(0,7)&&"</layer->"===i.slice(-9))e.insertAdjacentHTML("beforeend",i);else if("<map-feature"===i.slice(0,12)&&"</map-feature>"===i.slice(-14)){var o=`<layer- label="${M.options.locale.dfPastedLayer}" checked>
                       <map-meta name='projection' content='${e.projection}'></map-meta>`+i+"</layer->";e.insertAdjacentHTML("beforeend",o)}else try{e.geojson2mapml(JSON.parse(i))}catch{console.log("Invalid Input!")}}},Oe=function(o){let t=document.createElement("table"),e=t.createTHead(),i=e.insertRow(),n=document.createElement("th"),a=document.createElement("th");n.appendChild(document.createTextNode("Property name")),a.appendChild(document.createTextNode("Property value")),n.setAttribute("role","columnheader"),a.setAttribute("role","columnheader"),n.setAttribute("scope","col"),a.setAttribute("scope","col"),i.appendChild(n),i.appendChild(a);let r=t.createTBody();for(var s in o)if(o.hasOwnProperty(s)){let t=r.insertRow(),e=document.createElement("th"),i=document.createElement("td");e.appendChild(document.createTextNode(s)),i.appendChild(document.createTextNode(o[s])),e.setAttribute("scope","row"),i.setAttribute("itemprop",s),t.appendChild(e),t.appendChild(i)}return t},Be=function(t,e,i){return t==={}||(t[0]=Math.min(e,t[0]),t[1]=Math.min(i,t[1]),t[2]=Math.max(e,t[2]),t[3]=Math.max(i,t[3])),t},_i=function(h,c={},u=null,m={}){c=Object.assign({},{label:null,projection:"OSMTILE",caption:null,properties:null,geometryFunction:null},c);var d=(h="string"==typeof h?JSON.parse(h):h).type.toUpperCase();let p="",t=!1,e=new DOMParser;null===u&&(h.bbox||(t=!0),a="<layer- label='' checked><map-meta name='projection' content='"+c.projection+"'></map-meta><map-meta name='cs' content='gcrs'></map-meta></layer->",u=e.parseFromString(a,"text/html"),null!==c.label?u.querySelector("layer-").setAttribute("label",c.label):h.name?u.querySelector("layer-").setAttribute("label",h.name):h.title?u.querySelector("layer-").setAttribute("label",h.title):u.querySelector("layer-").setAttribute("label",M.options.locale.dfLayer));let f="<map-point></map-point>";f=e.parseFromString("<map-point></map-point>","text/html");let y="<map-multipoint><map-coordinates></map-coordinates></map-multipoint>";y=e.parseFromString("<map-multipoint><map-coordinates></map-coordinates></map-multipoint>","text/html");let _="<map-linestring><map-coordinates></map-coordinates></map-linestring>";_=e.parseFromString("<map-linestring><map-coordinates></map-coordinates></map-linestring>","text/html");let g="<map-multilinestring></map-multilinestring>";g=e.parseFromString("<map-multilinestring></map-multilinestring>","text/html");let b="<map-polygon></map-polygon>";b=e.parseFromString("<map-polygon></map-polygon>","text/html");let x="<map-multipolygon></map-multipolygon>";x=e.parseFromString("<map-multipolygon></map-multipolygon>","text/html");let v="<map-geometrycollection></map-geometrycollection>";v=e.parseFromString("<map-geometrycollection></map-geometrycollection>","text/html");let n="<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>";n=e.parseFromString("<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>","text/html");let L="<map-coordinates></map-coordinates>";if(L=e.parseFromString("<map-coordinates></map-coordinates>","text/html"),"FEATURECOLLECTION"===d){h.bbox?u.querySelector("layer-").insertAdjacentHTML("afterbegin","<map-meta name='extent' content='top-left-longitude="+h.bbox[0]+", top-left-latitude="+h.bbox[1]+", bottom-right-longitude="+h.bbox[2]+",bottom-right-latitude="+h.bbox[3]+"'></map-meta>"):m=[1/0,1/0,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];var i=h.features;for(let t=0;t<i.length;t++)M.geojson2mapml(i[t],c,u,m)}else if("FEATURE"===d){let t=n.cloneNode(!0),e=t.querySelector("map-feature");h.bbox?u.querySelector("layer-").insertAdjacentHTML("afterbegin","<map-meta name='extent' content='top-left-longitude="+h.bbox[0]+", top-left-latitude="+h.bbox[1]+", bottom-right-longitude="+h.bbox[2]+",bottom-right-latitude="+h.bbox[3]+"'></map-meta>"):"object"==typeof m&&void 0===m.length&&(m=[1/0,1/0,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]);let i=u.querySelector("layer-").getAttribute("label");"function"==typeof c.caption?i=c.caption(h):"string"==typeof c.caption?(i=h.properties[c.caption],void 0===i&&(i=c.caption)):h.id&&(i=h.id),e.querySelector("map-featurecaption").innerHTML=i;let o;"function"==typeof c.properties?(o=c.properties(h),o instanceof Element||(o=!1,console.error("options.properties function returns a string instead of an HTMLElement."))):o="string"==typeof c.properties?(e.querySelector("map-properties").insertAdjacentHTML("beforeend",c.properties),!1):c.properties instanceof HTMLElement?c.properties:M._properties2Table(h.properties),o&&e.querySelector("map-properties").appendChild(o);var a=M.geojson2mapml(h.geometry,c,u,m);"function"==typeof c.geometryFunction?e.querySelector("map-geometry").appendChild(c.geometryFunction(a,h)):e.querySelector("map-geometry").appendChild(a),u.querySelector("layer-").appendChild(e)}else if(["POINT","LINESTRING","POLYGON","MULTIPOINT","MULTILINESTRING","MULTIPOLYGON","GEOMETRYCOLLECTION"].includes(d))switch(d){case"POINT":m=M._updateExtent(m,h.coordinates[0],h.coordinates[1]),p=h.coordinates[0]+" "+h.coordinates[1];let t=f.cloneNode(!0);t=t.querySelector("map-point");let e=L.cloneNode(!0);return e=e.querySelector("map-coordinates"),e.innerHTML=p,t.appendChild(e),t;case"LINESTRING":let i=_.cloneNode(!0),o=i.querySelector("map-coordinates");p="";for(let t=0;t<h.coordinates.length;t++)m=M._updateExtent(m,h.coordinates[t][0],h.coordinates[t][1]),p=p+h.coordinates[t][0]+" "+h.coordinates[t][1]+" ";return o.innerHTML=p,i.querySelector("map-linestring");case"POLYGON":let n=b.cloneNode(!0);n=n.querySelector("map-polygon");for(let i=0;i<h.coordinates.length;i++){let e="",t=L.cloneNode(!0);t=t.querySelector("map-coordinates");for(let t=0;t<h.coordinates[i].length;t++)m=M._updateExtent(m,h.coordinates[i][t][0],h.coordinates[i][t][1]),e=e+h.coordinates[i][t][0]+" "+h.coordinates[i][t][1]+" ";t.innerHTML=e,n.appendChild(t)}return n;case"MULTIPOINT":p="";let a=y.cloneNode(!0);a=a.querySelector("map-multipoint");for(let t=0;t<h.coordinates.length;t++)m=M._updateExtent(m,h.coordinates[t][0],h.coordinates[t][1]),p=p+h.coordinates[t][0]+" "+h.coordinates[t][1]+" ";return a.querySelector("map-coordinates").innerHTML=p,a;case"MULTILINESTRING":let r=g.cloneNode(!0);r=r.querySelector("map-multilinestring");for(let i=0;i<h.coordinates.length;i++){let e="",t=L.cloneNode(!0);t=t.querySelector("map-coordinates");for(let t=0;t<h.coordinates[i].length;t++)m=M._updateExtent(m,h.coordinates[i][t][0],h.coordinates[i][t][1]),e=e+h.coordinates[i][t][0]+" "+h.coordinates[i][t][1]+" ";t.innerHTML=e,r.appendChild(t)}return r;case"MULTIPOLYGON":let s=x.cloneNode(!0);s=s.querySelector("map-multiPolygon");for(let n=0;n<h.coordinates.length;n++){let o=b.cloneNode(!0);o=o.querySelector("map-polygon");for(let i=0;i<h.coordinates[n].length;i++){let e="",t=L.cloneNode(!0);t=t.querySelector("map-coordinates");for(let t=0;t<h.coordinates[n][i].length;t++)m=M._updateExtent(m,h.coordinates[n][i][t][0],h.coordinates[n][i][t][1]),e=e+h.coordinates[n][i][t][0]+" "+h.coordinates[n][i][t][1]+" ";t.innerHTML=e,o.appendChild(t)}s.appendChild(o)}return s;case"GEOMETRYCOLLECTION":let l=v.cloneNode(!0);l=l.querySelector("map-geometrycollection");for(let t=0;t<h.geometries.length;t++){var w=M.geojson2mapml(h.geometries[t],c,u,m);l.appendChild(w)}return l}return t&&u.querySelector("layer-").insertAdjacentHTML("afterbegin","<map-meta name='extent' content='top-left-longitude="+m[0]+", top-left-latitude="+m[1]+", bottom-right-longitude="+m[2]+",bottom-right-latitude="+m[3]+"'></map-meta>"),u.querySelector("layer-")},ii=function(e){let i=[];e=e.filter(t=>!/[^\d.-]/g.test(t)).filter(t=>t);for(let t=0;t<e.length;t+=2)i.push(e.slice(t,t+2).map(Number));return i},lt=function(t){null!==t.querySelector("thead")&&t.querySelector("thead").remove();let e={};return t.querySelectorAll("tr").forEach(t=>{t=t.querySelectorAll("th, td");e[t[0].innerHTML]=t[1].innerHTML}),e},zi=function(t,n,a,r){for(;"MAP-SPAN"===t.nodeName.toUpperCase()||"MAP-A"===t.nodeName.toUpperCase();)t=t.firstElementChild;let s=t.nodeName,l={},h;switch(s.toUpperCase()){case"MAP-POINT":var c;l.type="Point",r?(c=proj4.transform(n,a,t.querySelector("map-coordinates").innerHTML.split(/[<>\ ]/g).map(Number)),l.coordinates=[c.x,c.y]):l.coordinates=t.querySelector("map-coordinates").innerHTML.split(/[<>\ ]/g).map(Number);break;case"MAP-LINESTRING":l.type="LineString",h=t.querySelector("map-coordinates").innerHTML.split(/[<>\ ]/g),h=M._breakArray(h),r&&(h=M._pcrsToGcrs(h,n,a)),l.coordinates=h;break;case"MAP-POLYGON":l.type="Polygon",l.coordinates=[];let e=0;t.querySelectorAll("map-coordinates").forEach(t=>{t=t.innerHTML.split(/[<>\ ]/g),t=M._breakArray(t),r&&(t=M._pcrsToGcrs(t,n,a)),l.coordinates[e]=t,e++});break;case"MAP-MULTIPOINT":l.type="MultiPoint",h=M._breakArray(t.querySelector("map-coordinates").innerHTML.split(/[<>\ ]/g)),r&&(h=M._pcrsToGcrs(h,n,a)),l.coordinates=h;break;case"MAP-MULTILINESTRING":l.type="MultiLineString",l.coordinates=[];let i=0;t.querySelectorAll("map-coordinates").forEach(t=>{t=t.innerHTML.split(/[<>\ ]/g),t=M._breakArray(t),r&&(t=M._pcrsToGcrs(t,n,a)),l.coordinates[i]=t,i++});break;case"MAP-MULTIPOLYGON":l.type="MultiPolygon",l.coordinates=[];let o=0;t.querySelectorAll("map-polygon").forEach(t=>{let e=0;l.coordinates.push([]),t.querySelectorAll("map-coordinates").forEach(t=>{t=t.innerHTML.split(/[<>\ ]/g),t=M._breakArray(t),r&&(t=M._pcrsToGcrs(t,n,a)),l.coordinates[o].push([]),l.coordinates[o][e]=t,e++}),o++})}return l},qe=function(e,i,o){let n=[];for(let t=0;t<e.length;t++){var a=[(a=proj4.transform(i,o,e[t])).x,a.y];n.push(a)}return n},vi=function(t,o={}){o=Object.assign({},{propertyFunction:null,transform:!0},o);let n={type:"FeatureCollection"};n.title=t.getAttribute("label"),n.features=[];let a=null,r=null;o.transform&&(a=new proj4.Proj(t.parentElement._map.options.crs.code),r=new proj4.Proj("EPSG:4326"),"EPSG:3857"!==t.parentElement._map.options.crs.code&&"EPSG:4326"!==t.parentElement._map.options.crs.code||(o.transform=!1));let e=t.querySelectorAll("map-meta");e.forEach(e=>{if("extent"===e.getAttribute("name")){let t=e.getAttribute("content"),i=t.split(","),o={};for(let e=0;e<i.length;e++){let t=i[e].split("=");t[0]=t[0].trim(),t[1]=parseFloat(t[1]),o[t[0]]=t[1]}n.bbox=[o["top-left-longitude"],o["top-left-latitude"],o["bottom-right-longitude"],o["bottom-right-latitude"]]}});let i=t.querySelectorAll("map-feature"),s=0;return i.forEach(t=>{var e;n.features[s]={type:"Feature"},n.features[s].geometry={},n.features[s].properties={},t.querySelector("map-properties")?"function"==typeof o.propertyFunction?(e=o.propertyFunction(t.querySelector("map-properties")),n.features[s].properties=e):null!==t.querySelector("map-properties").querySelector("table")?(e=t.querySelector("map-properties").querySelector("table").cloneNode(!0),e=M._table2properties(e),n.features[s].properties=e):n.features[s].properties={prop0:t.querySelector("map-properties").innerHTML.replace(/(<([^>]+)>)/gi,"")}:n.features[s].properties=null;let i=t.querySelector("map-geometry").firstElementChild;for(;"MAP-SPAN"===i.nodeName.toUpperCase()||"MAP-A"===i.nodeName.toUpperCase();)i=i.firstElementChild;"MAP-GEOMETRYCOLLECTION"!==i.nodeName.toUpperCase()?n.features[s].geometry=M._geometry2geojson(i,a,r,o.transform):(n.features[s].geometry.type="GeometryCollection",n.features[s].geometry.geometries=[],t=i.children,Array.from(t).forEach(t=>{var e=t.nodeName.toUpperCase();"MAP-SPAN"===e||"MAP-A"===e?([...(t=t.cloneNode(!0)).querySelectorAll("map-a, map-span")].forEach(t=>t.replaceWith(...t.children)),Array.from(t.children).forEach(t=>{t=M._geometry2geojson(t,a,r,o.transform),n.features[s].geometry.geometries.push(t)})):(t=M._geometry2geojson(t,a,r,o.transform),n.features[s].geometry.geometries.push(t))})),s++}),n},Ee=function(a,r,s,l){if(a){let t=r.getZoom(),e=r.options.crs.scale(t),i=r.options.crs.transformation.transform(a.getCenter(!0),e);var h=r.getSize().divideBy(2),c=i.subtract(h).round(),u=i.add(h).round(),m=M.pixelToPCRSPoint(c,t,r.options.projection),d=M.pixelToPCRSPoint(u,t,r.options.projection);let o=L.bounds(m,d),n=o.contains(a)?1:-1;for(;-1==n&&!o.contains(a)&&t-1>=s||1==n&&o.contains(a)&&t+1<=l;)t+=n,e=r.options.crs.scale(t),i=r.options.crs.transformation.transform(a.getCenter(!0),e),c=i.subtract(h).round(),u=i.add(h).round(),m=M.pixelToPCRSPoint(c,t,r.options.projection),d=M.pixelToPCRSPoint(u,t,r.options.projection),o=L.bounds(m,d);return 1==n&&0<=t-1&&(t!==l||!o.contains(a))&&t--,t}},oi=function(t,e){return t?t instanceof ShadowRoot?M.getClosest(t.host,e):t instanceof HTMLElement&&t.matches(e)?t:M.getClosest(t.parentNode,e):null},Io=L.Control.Attribution.extend({options:{prefix:'<img src="https://www.w3.org/community/src/templates/wordpress/StoryTeller/favicon.ico" style="position: relative; top: 5px" alt="W3C Community and Business Groups logo"> <a href="https://www.w3.org/community/maps4html/">Maps for HTML Community Group</a> | <img src="data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTIiIGhlaWdodD0iOCI+PHBhdGggZmlsbD0iIzRDN0JFMSIgZD0iTTAgMGgxMnY0SDB6Ii8+PHBhdGggZmlsbD0iI0ZGRDUwMCIgZD0iTTAgNGgxMnYzSDB6Ii8+PHBhdGggZmlsbD0iI0UwQkMwMCIgZD0iTTAgN2gxMnYxSDB6Ii8+PC9zdmc+" style="padding-right: 0.3em;" alt="Slava Ukraini"> <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> '},onAdd:function(t){for(var e in(t.attributionControl=this)._container=L.DomUtil.create("details","leaflet-control-attribution"),L.DomEvent.disableClickPropagation(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());this._update(),t.on("layeradd",this._addAttribution,this);let i=document.createElement("dialog");return i.setAttribute("class","shortcuts-dialog"),i.setAttribute("autofocus",""),i.onclick=function(t){t.stopPropagation()},i.innerHTML=`<b>${M.options.locale.kbdShortcuts} </b><button aria-label="Close" onclick='this.parentElement.close()'>X</button>`+`<ul><b>${M.options.locale.kbdMovement}</b><li><kbd>&#8593</kbd> ${M.options.locale.kbdPanUp}</li><li><kbd>&#8595</kbd> ${M.options.locale.kbdPanDown}</li><li><kbd>&#8592</kbd> ${M.options.locale.kbdPanLeft}</li><li><kbd>&#8594</kbd> ${M.options.locale.kbdPanRight}</li><li><kbd>+</kbd> ${M.options.locale.btnZoomIn}</li><li><kbd>-</kbd> ${M.options.locale.btnZoomOut}</li><li><kbd>shift</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 3x ${M.options.locale.kbdPanIncrement}</li><li><kbd>ctrl</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 0.2x ${M.options.locale.kbdPanIncrement}</li><li><kbd>shift</kbd> + <kbd>+/-</kbd> ${M.options.locale.kbdZoom}</li></ul>`+`<ul><b>${M.options.locale.kbdFeature}</b><li><kbd>&#8592/&#8593</kbd> ${M.options.locale.kbdPrevFeature}</li><li><kbd>&#8594/&#8595</kbd> ${M.options.locale.kbdNextFeature}</li></ul>`,t._container.appendChild(i),this._container},_update:function(){if(this._map){var t,e=[];for(t in this._attributions)this._attributions[t]&&e.push(t);var i=[];this.options.prefix&&i.push(this.options.prefix),e.length&&i.push(e.join(", ")),this._container.innerHTML='<summary><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></svg></summary><div class="mapml-attribution-container">'+`<button onclick="this.closest('.leaflet-container').querySelector('.shortcuts-dialog').showModal()" class="shortcuts-button mapml-button">${M.options.locale.kbdShortcuts}</button> | `+i.join(' <span aria-hidden="true">|</span> ')+"</div>",this._container.setAttribute("role","group"),this._container.setAttribute("aria-label",""+M.options.locale.btnAttribution)}}});L.Map.mergeOptions({attributionControl:!1,toggleableAttributionControl:!0}),L.Map.addInitHook(function(){this.options.toggleableAttributionControl&&(new Io).addTo(this)});function Po(t){return new Io(t)}function Bo(t){return new Ro(t)}function Fo(t){return new Do(t)}var Ro=L.Control.extend({options:{position:"topleft"},onAdd:function(t){var e=L.DomUtil.create("div","mapml-reload-button leaflet-bar");let i=L.DomUtil.create("button","mapml-reload-button",e);return i.innerHTML="<span aria-hidden='true'>&#x021BA</span>",i.title=M.options.locale.cmReload,i.setAttribute("type","button"),i.classList.add("mapml-button"),i.setAttribute("aria-label","Reload"),L.DomEvent.disableClickPropagation(i),L.DomEvent.on(i,"click",L.DomEvent.stop),L.DomEvent.on(i,"click",this._goReload,this),this._reloadButton=i,this._updateDisabled(),t.on("moveend",this._updateDisabled,this),e},onRemove:function(t){t.off("moveend",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_goReload:function(t){!this._disabled&&1<this._map.options.mapEl._history.length&&this._map.options.mapEl.reload()},_updateDisabled:function(){setTimeout(()=>{L.DomUtil.removeClass(this._reloadButton,"leaflet-disabled"),this._reloadButton.setAttribute("aria-disabled","false"),this._map&&(this._disabled||this._map.options.mapEl._history.length<=1)&&(L.DomUtil.addClass(this._reloadButton,"leaflet-disabled"),this._reloadButton.setAttribute("aria-disabled","true"))},0)}}),Do=L.Control.Scale.extend({options:{maxWidth:100,updateWhenIdle:!0,position:"bottomleft"},onAdd:function(t){t._container.insertAdjacentHTML("beforeend","<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output-scale'></output>"),this._container=L.DomUtil.create("div","mapml-control-scale");var e=L.Control.Scale.prototype.onAdd.call(this,t);return this._container.appendChild(e),this._container.setAttribute("tabindex",0),this._scaleControl=this,setTimeout(()=>{this._updateOutput(),this._focusOutput()},0),t.on("zoomend moveend",this._updateOutput,this),this._map._container.addEventListener("focus",()=>this._focusOutput()),this._container},onRemove:function(t){t.off("zoomend moveend",this._updateOutput,this)},getContainer:function(){return this._container},_pixelsToDistance:function(t,e){var i=96*window.devicePixelRatio;return"metric"===e?t/i*2.54:t/i},_scaleLength:function(t){let e=t.getAttribute("style");return parseInt(e.match(/width:\s*(\d+)px/)[1])},_focusOutput:function(){setTimeout(()=>{let t=this._map._container.querySelector(".mapml-screen-reader-output-scale");t.textContent="",setTimeout(()=>{t.textContent=this._container.getAttribute("aria-label")},100)},0)},_updateOutput:function(){let t="",e=this._scaleControl.getContainer().getElementsByClassName("leaflet-control-scale-line")[0];var i;t=this.options.metric?(i=parseFloat(this._pixelsToDistance(this._scaleLength(e),"metric").toFixed(1)),t=i+" centimeters to "+e.textContent.trim(),t=t.replace(/(\d+)\s*m\b/g,"$1 meters"),t.replace(/ km/g," kilometers")):(i=parseFloat(this._pixelsToDistance(this._scaleLength(e),"imperial").toFixed(1)),t=i+" inches to "+e.textContent.trim(),t=t.replace(/ft/g,"feet"),t.replace(/mi/g,"miles")),this._container.setAttribute("aria-label",t),this._map._container.querySelector(".mapml-screen-reader-output-scale").textContent=t}}),Oo=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",e),this.link.href="#",this.link.setAttribute("role","button"),this._map=t,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),e},onRemove:function(t){t.off("fullscreenchange",this._toggleTitle,this)},_click:function(t){L.DomEvent.stopPropagation(t),L.DomEvent.preventDefault(t),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(t){var e=M.getClosest(this.getContainer(),"mapml-viewer,[is=web-map]");this.isFullscreen()?t&&t.pseudoFullscreen?this._disablePseudoFullscreen(e):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(e):t&&t.pseudoFullscreen?this._enablePseudoFullscreen(e):e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen?e.msRequestFullscreen():this._enablePseudoFullscreen(e),this.getContainer().focus()},_enablePseudoFullscreen:function(t){L.DomUtil.addClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(t){L.DomUtil.removeClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(t){this._isFullscreen=t;var e=M.getClosest(this.getContainer(),"mapml-viewer,[is=web-map]");t?L.DomUtil.addClass(e,"mapml-fullscreen-on"):L.DomUtil.removeClass(e,"mapml-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(t){var e=M.getClosest(this.getContainer(),":fullscreen"),i=M.getClosest(this.getContainer(),"mapml-viewer,[is=web-map]");e!==i||this._isFullscreen?e!==i&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange")):(this._setFullscreen(!0),this.fire("fullscreenchange"))}}),L.Map.mergeOptions({fullscreenControl:!1}),L.Map.addInitHook(function(){var t,e;this.options.fullscreenControl&&(this.fullscreenControl=new Oo(this.options.fullscreenControl),this.addControl(this.fullscreenControl)),"onfullscreenchange"in document?t="fullscreenchange":"onmozfullscreenchange"in document?t="mozfullscreenchange":"onwebkitfullscreenchange"in document?t="webkitfullscreenchange":"onmsfullscreenchange"in document&&(t="MSFullscreenChange"),t&&(e=L.bind(this._onFullscreenChange,this),this.whenReady(function(){L.DomEvent.on(document,t,e)}),this.on("unload",function(){L.DomEvent.off(document,t,e)}))});function No(t){return new Oo(t)}function qo(t){return new Yo(t)}function jo(t){return new Vo(t)}function Uo(t,e){return new Go(t,e)}function Zo(t){return new Xo(t)}function Ho(t,e){return new $o(t,e)}var Yo=L.Control.extend({options:{position:"bottomright"},onAdd:function(t){L.Control.CustomLocate=L.Control.Locate.extend({start:function(){L.Control.Locate.prototype.start.call(this),t.getContainer().focus()},stop:function(){L.Control.Locate.prototype.stop.call(this),t.getContainer().focus()}}),this.locateControl=new L.Control.CustomLocate({showPopup:!1,strings:{title:M.options.locale.btnLocTrackOff},position:this.options.position,locateOptions:{maxZoom:16}}).addTo(t);var e=this.locateControl._container,i=this.locateControl;return new MutationObserver(function(t){e.classList.contains("active")&&e.classList.contains("following")?(e.firstChild.title=M.options.locale.btnLocTrackOn,i._marker.bindTooltip(M.options.locale.btnMyLocTrackOn,{permanent:!0})):e.classList.contains("active")?(e.firstChild.title=M.options.locale.btnLocTrackLastKnown,i._marker.bindTooltip(M.options.locale.btnMyLastKnownLocTrackOn)):e.firstChild.title=M.options.locale.btnLocTrackOff}).observe(e,{attributes:!0,attributeFilter:["class"]}),e},stop:function(){return this.locateControl.stop()}}),Vo=L.Layer.extend({onAdd:function(t){this._container=L.DomUtil.create("div","mapml-crosshair",t._container),this._container.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 100 100"><g stroke="#fff" stroke-linecap="round" stroke-linejoin="round"><circle cx="50.028" cy="50.219" r="3.923" stroke-width="2" color="currentColor" overflow="visible"/><path stroke-width="3" d="M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z" color="currentColor" overflow="visible"/><path stroke-width="3" d="M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z"/><path stroke-width="3" d="M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z" color="currentColor" overflow="visible"/></g></svg>',t.isFocused=!1,this._isQueryable=!1,t.on("layerchange layeradd layerremove overlayremove",this._toggleEvents,this),t.on("popupopen",this._isMapFocused,this),L.DomEvent.on(t._container,"keydown keyup mousedown",this._isMapFocused,this),this._addOrRemoveCrosshair()},onRemove:function(t){t.off("layerchange layeradd layerremove overlayremove",this._toggleEvents),t.off("popupopen",this._isMapFocused),L.DomEvent.off(t._container,"keydown keyup mousedown",this._isMapFocused)},_toggleEvents:function(){this._hasQueryableLayer()?this._map.on("viewreset move moveend",this._addOrRemoveCrosshair,this):this._map.off("viewreset move moveend",this._addOrRemoveCrosshair,this),this._addOrRemoveCrosshair()},_addOrRemoveCrosshair:function(t){this._hasQueryableLayer()?this._container.removeAttribute("hidden"):this._container.setAttribute("hidden","")},_addOrRemoveMapOutline:function(t){var e=this._map._container;this._map.isFocused&&!this._outline?this._outline=L.DomUtil.create("div","mapml-outline",e):!this._map.isFocused&&this._outline&&(L.DomUtil.remove(this._outline),delete this._outline)},_hasQueryableLayer:function(){var t=this._map.options.mapEl.layers;if(this._map.isFocused)for(var e of t)if(e.queryable())return!0;return!1},_isMapFocused:function(t){var e;this._map._container.parentNode.activeElement?((e=this._map._container.parentNode.activeElement.classList.contains("leaflet-container"))&&["keydown"].includes(t.type)&&t.shiftKey&&9===t.keyCode?this._map.isFocused=!1:this._map.isFocused=e&&["keyup","keydown"].includes(t.type),this._map.isFocused&&this._map.fire("mapkeyboardfocused"),this._addOrRemoveMapOutline(),this._addOrRemoveCrosshair()):this._map.isFocused=!1}}),Go=L.Path.extend({initialize:function(t,e){this.type=t.tagName.toUpperCase(),"MAP-POINT"!==this.type&&"MAP-MULTIPOINT"!==this.type||(e.fillOpacity=1),0<e.wrappers.length&&(e=Object.assign(this._convertWrappers(e.wrappers),e)),L.setOptions(this,e),this.group=this.options.group,this.options.interactive=this.options.link||this.options.properties&&this.options.onEachFeature,this._parts=[],this._markup=t,this.options.zoom=t.zoom??this.options.nativeZoom,this._convertMarkup(),(t.querySelector("map-span")||t.querySelector("map-a"))&&this._generateOutlinePoints(),this.isClosed=this._isClosed()},attachLinkHandler:function(o,n,a){let r,e=document.createElement("div"),i=document.createElement("p");function t(t){e.parentElement&&this._map.getContainer().removeChild(e)}e.classList.add("mapml-link-preview"),e.appendChild(i),o.classList.add("map-a"),n.visited&&o.classList.add("map-a-visited"),o.mousedown=t=>r={x:t.clientX,y:t.clientY},L.DomEvent.on(o,"mousedown",o.mousedown,this),o.mouseup=i=>{if(0===i.button){let t=!0,e=this.options._leafletLayer._layerEl.nextElementSibling;for(;e&&t;)e.tagName&&"LAYER-"===e.tagName.toUpperCase()&&(t=!e.queryable()),e=e.nextElementSibling;t&&r&&i.eventPhase!==Event.BUBBLING_PHASE&&Math.sqrt(Math.pow(r.x-i.clientX,2)+Math.pow(r.y-i.clientY,2))<=5&&(n.visited=!0,o.setAttribute("stroke","#6c00a2"),o.classList.add("map-a-visited"),M._handleLink(n,a))}},L.DomEvent.on(o,"mouseup",o.mouseup,this),L.DomEvent.on(o,"keypress",t=>{L.DomEvent.stop(t),13!==t.keyCode&&32!==t.keyCode||(n.visited=!0,o.setAttribute("stroke","#6c00a2"),o.classList.add("map-a-visited"),M._handleLink(n,a))},this),L.DomEvent.on(o,"mouseenter keyup",t=>{if(t.target===t.currentTarget){let t=document.createElement("a");t.href=n.url,i.innerHTML=t.href,this._map.getContainer().appendChild(e)}},this),L.DomEvent.on(o,"mouseout keydown mousedown",t=>{t.target===t.currentTarget&&e.parentElement&&this._map.getContainer().removeChild(e)},this),a.on("add",function(){L.DomEvent.on(this._map.getContainer(),"mouseout mouseenter click",t,this)},a),a.on("remove",function(){L.DomEvent.off(this._map.getContainer(),{mouseout:t,mouseenter:t,click:t})},a)},_project:function(t,e=void 0,i=void 0){let o=t||this._map,n=e||o.getPixelOrigin(),a=void 0===i?o.getZoom():i;for(var r of this._parts){r.pixelRings=this._convertRing(r.rings,o,n,a);for(var s of r.subrings)s.pixelSubrings=this._convertRing([s],o,n,a)}if(this._outline){this.pixelOutline=[];for(var l of this._outline)this.pixelOutline=this.pixelOutline.concat(this._convertRing(l,o,n,a))}},_convertRing:function(t,e,i,o){let n=e.options.crs.scale(o),a=[];for(var r of t){let t=[];for(var s of r.points){s=e.options.crs.transformation.transform(s,n);t.push(L.point(s.x,s.y)._subtract(i).round())}a.push(t)}return a},_update:function(){this._map&&this._renderer._updateFeature(this)},_convertWrappers:function(i){if(i&&0!==i.length){let t="",e={};for(var o of i)if("MAP-A"!==o.tagName.toUpperCase()&&o.className)t+=o.className+" ";else if(!e.link&&o.getAttribute("href")){let t={};t.url=o.getAttribute("href"),o.hasAttribute("target")&&(t.target=o.getAttribute("target")),o.hasAttribute("type")&&(t.type=o.getAttribute("type")),o.hasAttribute("inplace")&&(t.inPlace=!0),e.link=t}return e.className=(t+" "+this.options.className).trim(),e}},_convertMarkup:function(){if(this._markup){var o,e=this._markup.attributes;this.featureAttributes={},this.options.link&&"MAP-A"===this._markup.parentElement.tagName.toUpperCase()&&"MAP-GEOMETRY"!==this._markup.parentElement.parentElement.tagName.toUpperCase()&&(this.featureAttributes.tabindex="0");for(let t=0;t<e.length;t++)this.featureAttributes[e[t].name]=e[t].value;let i=!0;for(o of this._markup.querySelectorAll("map-coordinates")){let t=[],e=[];if(this._coordinateToArrays(o,t,e,this.options.className),i||"MAP-POLYGON"!==this.type)if("MAP-MULTIPOINT"===this.type)for(var n of t[0].points.concat(e))this._parts.push({rings:[{points:[n]}],subrings:[],cls:(`${n.cls||""} `+(this.options.className||"")).trim()});else this._parts.push({rings:t,subrings:e,cls:(`${this.featureAttributes.class||""} `+(this.options.className||"")).trim()});else this._parts[0].rings.push(t[0]),0<e.length&&(this._parts[0].subrings=this._parts[0].subrings.concat(e));i=!1}}},_generateOutlinePoints:function(){if("MAP-MULTIPOINT"!==this.type&&"MAP-POINT"!==this.type&&"MAP-LINESTRING"!==this.type&&"MAP-MULTILINESTRING"!==this.type){this._outline=[];for(var t of this._markup.querySelectorAll("map-coordinates")){let i=t.childNodes,o=0,n=document.createElement("div");i.length;for(let t=0;t<i.length;t++)0===i[t].textContent.trim().length&&i[t].remove();for(var a of i){var r,s=[];if(!a.tagName){let t="",e=((o-1)%i.length+i.length)%i.length;i[e].tagName&&(r=i[e].textContent.trim().split(/\s+/),t+=`${r[r.length-2]} ${r[r.length-1]} `),t+=a.textContent,e=((o+1)%i.length+i.length)%i.length,i[e].tagName&&(a=i[e].textContent.trim().split(/\s+/),t+=` ${a[0]} ${a[1]} `),n.innerHTML=t,this._coordinateToArrays(n,s,[],!0,this.featureAttributes.class||this.options.className),this._outline.push(s)}o++}}}},_coordinateToArrays:function(o,t,n,e=!0,a=void 0,r=[]){for(var i of o.children)this._coordinateToArrays(i,t,n,!1,i.getAttribute("class"),r.concat([i]));let s=o.textContent.replace(/(<([^>]+)>)/gi,""),l=s.trim().match(/(\S+\s+\S+)/gim),h=[],c;for(var u of l){var m=[];u.split(/\s+/gim).forEach(M._parseNumber,m);m=M.pointToPCRSPoint(L.point(m),this.options.zoom,this.options.projection,this.options.nativeCS);h.push(m),c=c?c.extend(m):L.bounds(m,m)}if(this._bounds?(this._bounds.extend(c.min),this._bounds.extend(c.max)):this._bounds=c,e)t.push({points:h});else{let e={},i=o.attributes,t=this._convertWrappers(r);t.link&&(e.tabindex="0");for(let t=0;t<i.length;t++)"class"!==i[t].name&&(e[i[t].name]=i[t].value);n.unshift({points:h,center:c.getCenter(),cls:(`${a||""} `+(t.className||"")).trim(),attr:e,link:t.link,linkTarget:t.linkTarget,linkType:t.linkType})}},_isClosed:function(){switch(this.type){case"MAP-POLYGON":case"MAP-MULTIPOLYGON":case"MAP-POINT":case"MAP-MULTIPOINT":return!0;default:return!1}},getCenter:function(){return this._bounds?this._map.options.crs.unproject(this._bounds.getCenter()):null},getPCRSCenter:function(){return this._bounds.getCenter()}}),Xo=L.SVG.extend({_initContainer:function(){L.SVG.prototype._initContainer.call(this),this._container.setAttribute("role","none presentation")},_initPath:function(e,t=!0){if(e._outline){let t=L.SVG.create("path");e.options.className&&L.DomUtil.addClass(t,e.featureAttributes.class||e.options.className),L.DomUtil.addClass(t,"mapml-feature-outline"),t.style.fill="none",e.outlinePath=t}for(var i of e._parts){if(i.rings&&(this._createPath(i,e.options.className,e.featureAttributes["aria-label"],e.options.interactive,e.featureAttributes),e.outlinePath&&(i.path.style.stroke="none")),i.subrings)for(var o of i.subrings)this._createPath(o,e.options.className,o.attr["aria-label"],void 0!==o.link,o.attr);this._updateStyle(e)}t&&(t=L.stamp(e),this._layers[t]=e)},_createPath:function(t,e,i,o=!1,n=void 0){let a=L.SVG.create("path");if(t.path=a,n)for(var[r,s]of Object.entries(n))"id"!==r&&"tabindex"!==r&&a.setAttribute(r,s);else i&&a.setAttribute("aria-label",i);(t.cls||e)&&L.DomUtil.addClass(a,t.cls||e),o&&L.DomUtil.addClass(a,"leaflet-interactive")},_addPath:function(t,e=void 0,i=!0){this._rootGroup||e||this._initContainer();let o=e||this._rootGroup,n=!1;i&&t.addInteractiveTarget(t.group);for(var a of t._parts){a.path&&t.group.appendChild(a.path),i&&(t.options.link&&t.attachLinkHandler(a.path,t.options.link,t.options._leafletLayer),t.addInteractiveTarget(a.path)),!n&&t.pixelOutline&&(t.group.appendChild(t.outlinePath),n=!0);for(var r of a.subrings)r.path&&(r.link&&(t.attachLinkHandler(r.path,r.link,t.options._leafletLayer),t.addInteractiveTarget(r.path)),t.group.appendChild(r.path))}o.appendChild(t.group)},_removePath:function(t){for(var e of t._parts){e.path&&(t.removeInteractiveTarget(e.path),L.DomUtil.remove(e.path));for(var i of e.subrings)i.path&&L.DomUtil.remove(i.path)}t.outlinePath&&L.DomUtil.remove(t.outlinePath),t.removeInteractiveTarget(t.group),L.DomUtil.remove(t.group),delete this._layers[L.stamp(t)]},_updateFeature:function(t){t.pixelOutline&&this._setPath(t.outlinePath,this.geometryToPath(t.pixelOutline,!1));for(var e of t._parts){this._setPath(e.path,this.geometryToPath(e.pixelRings,t.isClosed));for(var i of e.subrings)this._setPath(i.path,this.geometryToPath(i.pixelSubrings,!1))}},_pointToMarker:function(t){return`M${t.x} ${t.y} L${t.x-12.5} ${t.y-30} C${t.x-12.5} ${t.y-50}, ${t.x+12.5} ${t.y-50}, ${t.x+12.5} ${t.y-30} L${t.x} ${t.y}z`},_updateStyle:function(t){this._updatePathStyle(t.outlinePath,t,!1,!0);for(var e of t._parts){e.path&&this._updatePathStyle(e.path,t,!0);for(var i of e.subrings)i.path&&this._updatePathStyle(i.path,t)}},_updatePathStyle:function(t,e,i=!1,o=!1){var n,a;t&&e&&(n=e.options,a=e.isClosed,n.stroke&&(!a||o)||i&&!e.outlinePath?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset"),n.link&&(t.setAttribute("stroke",n.link.visited?"#6c00a2":"#0000EE"),t.setAttribute("stroke-opacity","1"),t.setAttribute("stroke-width","1px"),t.setAttribute("stroke-dasharray","none"))):t.setAttribute("stroke","none"),a&&!o?n.fill?t.setAttribute("fill",n.color):(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_setPath:function(t,e){t.setAttribute("d",e)},geometryToPath:function(t,e){let i="",o,n,a,r,s,l;for(o=0,a=t.length;o<a;o++){if(1===(s=t[o]).length)return this._pointToMarker(s[0]);for(n=0,r=s.length;n<r;n++)l=s[n],i+=(n?"L":"M")+l.x+" "+l.y;i+=e?"z":""}return i||"M0 0"}}),$o=L.FeatureGroup.extend({initialize:function(t,e){e.wrappers&&0<e.wrappers.length&&(e=Object.assign(M.Path.prototype._convertWrappers(e.wrappers),e)),L.LayerGroup.prototype.initialize.call(this,t,e),this._featureEl=this.options.mapmlFeature,this.layerBounds=e.layerBounds,this.zoomBounds=e.zoomBounds;var i,e=t[Object.keys(t)[0]];1===t.length&&e.options.link&&(this.options.link=e.options.link),(this.options.onEachFeature&&this.options.properties||this.options.link)&&(L.DomUtil.addClass(this.options.group,"leaflet-interactive"),this.options.link?(M.Path.prototype.attachLinkHandler.call(this,this.options.group,this.options.link,this.options._leafletLayer),this.options.group.setAttribute("role","link")):(this.options.group.setAttribute("aria-expanded","false"),this.options.group.setAttribute("role","button"),this.options.onEachFeature(this.options.properties,this),this.off("click",this._openPopup))),L.DomEvent.on(this.options.group,"keyup keydown",this._handleFocus,this),this.options.group.setAttribute("aria-label",this.options.accessibleTitle),this.options.featureID&&this.options.group.setAttribute("data-fid",this.options.featureID);for(i of t)i._groupLayer=this},onAdd:function(t){L.LayerGroup.prototype.onAdd.call(this,t),this.updateInteraction()},updateInteraction:function(){let e=this._map||this.options._leafletLayer._map;for(var i in(this.options.onEachFeature||this.options.link)&&e.featureIndex.addToIndex(this,this.getPCRSCenter(),this.options.group),this._layers){let t=this._layers[i];for(var o of t._parts){t.featureAttributes&&t.featureAttributes.tabindex&&e.featureIndex.addToIndex(t,t.getPCRSCenter(),o.path);for(var n of o.subrings)n.attr&&n.attr.tabindex&&e.featureIndex.addToIndex(t,n.center,n.path)}}},_checkRender:function(t,e,i){var o=this._featureEl.min,n=this._featureEl.max;return!(i<t||t<e)&&!(null!==o&&t<+o||null!==n&&+n<t)},_handleFocus:function(t){if([9,16,27,37,38,39,40].includes(t.keyCode)&&"keydown"===t.type){var e=this._map.featureIndex.currentIndex;if(37===t.keyCode||38===t.keyCode)L.DomEvent.stop(t),this._map.featureIndex.inBoundFeatures[e].path.setAttribute("tabindex",-1),0===e?(this._map.featureIndex.inBoundFeatures[this._map.featureIndex.inBoundFeatures.length-1].path.focus(),this._map.featureIndex.currentIndex=this._map.featureIndex.inBoundFeatures.length-1):(this._map.featureIndex.inBoundFeatures[e-1].path.focus(),this._map.featureIndex.currentIndex--);else if(39===t.keyCode||40===t.keyCode)L.DomEvent.stop(t),this._map.featureIndex.inBoundFeatures[e].path.setAttribute("tabindex",-1),e===this._map.featureIndex.inBoundFeatures.length-1?(this._map.featureIndex.inBoundFeatures[0].path.focus(),this._map.featureIndex.currentIndex=0):(this._map.featureIndex.inBoundFeatures[e+1].path.focus(),this._map.featureIndex.currentIndex++);else if(27===t.keyCode){if("g"!==(this._map.options.mapEl.shadowRoot||this._map.options.mapEl.querySelector(".mapml-web-map").shadowRoot).activeElement.nodeName)return;this._map._container.focus()}else if(9===t.keyCode){let t=this;setTimeout(function(){t._map.featureIndex.inBoundFeatures[0].path.setAttribute("tabindex",0)},0)}}else[9,16,13,27,37,38,39,40,49,50,51,52,53,54,55].includes(t.keyCode)||(this._map.featureIndex.currentIndex=0,this._map.featureIndex.inBoundFeatures[0].path.focus());"G"===t.target.tagName.toUpperCase()&&([9,13,16,37,38,39,40,49,50,51,52,53,54,55,27].includes(t.keyCode)&&"keyup"===t.type?this.openTooltip():13===t.keyCode||32===t.keyCode?(this.closeTooltip(),!this.options.link&&this.options.onEachFeature&&(L.DomEvent.stop(t),this.openPopup())):this.closeTooltip())},addLayer:function(t){!t.options.link&&t.options.interactive&&this.options.onEachFeature(this.options.properties,t),L.FeatureGroup.prototype.addLayer.call(this,t)},_previousFeature:function(t){L.DomEvent.stop(t),this._map.featureIndex.currentIndex=Math.max(this._map.featureIndex.currentIndex-1,0);let e=this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];e.path.focus(),this._map.closePopup()},_nextFeature:function(t){L.DomEvent.stop(t),this._map.featureIndex.currentIndex=Math.min(this._map.featureIndex.currentIndex+1,this._map.featureIndex.inBoundFeatures.length-1);let e=this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];e.path.focus(),this._map.closePopup()},getPCRSCenter:function(){let e;for(var i in this._layers){let t=this._layers[i];e?e.extend(t.getPCRSCenter()):e=L.bounds(t.getPCRSCenter(),t.getPCRSCenter())}return e.getCenter()}}),ni=L.Handler.extend({addHooks:function(){this._map.on({layeradd:this.totalBounds,layerremove:this.totalBounds}),this._map.options.mapEl.addEventListener("map-moveend",this.announceBounds),this._map.dragging._draggable.addEventListener("dragstart",this.dragged),this._map.options.mapEl.addEventListener("mapfocused",this.focusAnnouncement)},removeHooks:function(){this._map.off({layeradd:this.totalBounds,layerremove:this.totalBounds}),this._map.options.mapEl.removeEventListener("map-moveend",this.announceBounds),this._map.dragging._draggable.removeEventListener("dragstart",this.dragged),this._map.options.mapEl.removeEventListener("mapfocused",this.focusAnnouncement)},focusAnnouncement:function(){let o=this;setTimeout(function(){let t=(o.querySelector(".mapml-web-map")?o.querySelector(".mapml-web-map"):o).shadowRoot.querySelector(".leaflet-container");var e=o._map.getZoom();let i=M.options.locale.amZoom+" "+e;e===o._map.getMaxZoom()?i=M.options.locale.amMaxZoom+" "+i:e===o._map._layersMinZoom&&(i=M.options.locale.amMinZoom+" "+i),t.setAttribute("aria-roledescription","region "+i),setTimeout(function(){t.removeAttribute("aria-roledescription")},2e3)},0)},announceBounds:function(){if(!(0<this._traversalCall)){var i=this._map.getZoom(),o=M.pixelToPCRSBounds(this._map.getPixelBounds(),i,this._map.options.projection);let t=!0;this._map.totalLayerBounds&&(t=i<=this._map.getMaxZoom()&&i>=this._map.getMinZoom()&&this._map.totalLayerBounds.overlaps(o));let e=(this.querySelector(".mapml-web-map")?this.querySelector(".mapml-web-map"):this).shadowRoot.querySelector(".mapml-screen-reader-output");var n,o=M.options.locale.amZoom+" "+i;t?(n=(this._history[this._historyIndex-1]?this._history[this._historyIndex-1]:this._history[this._historyIndex]).zoom,i===this._map.getMaxZoom()&&i!==n?e.innerText=M.options.locale.amMaxZoom+" "+o:i===this._map._layersMinZoom&&i!==n?e.innerText=M.options.locale.amMinZoom+" "+o:e.innerText=o):(n=this._history[this._historyIndex],o=this._history[this._historyIndex-1],this.back(),this._history.pop(),n.zoom!==o.zoom?e.innerText=M.options.locale.amZoomedOut:this._map.dragging._draggable.wasDragged?e.innerText=M.options.locale.amDraggedOut:n.x>o.x?e.innerText=M.options.locale.amEastBound:n.x<o.x?e.innerText=M.options.locale.amWestBound:n.y<o.y?e.innerText=M.options.locale.amNorthBound:n.y>o.y&&(e.innerText=M.options.locale.amSouthBound)),this._map.dragging._draggable.wasDragged=!1}},totalBounds:function(t){if(t.layer._layerEl){let t=this.options.mapEl;t.whenLayersReady().then(()=>{var e,i=t.querySelectorAll("layer-");let o;for(let t=0;t<i.length;t++)i[t]._layer&&(e=i[t].extent,o&&e?o.extend(M.extentToBounds(e,"pcrs")):e&&(o=M.extentToBounds(e,"pcrs")));this.totalLayerBounds=o})}},dragged:function(){this.wasDragged=!0}}),co=L.Handler.extend({initialize:function(t){L.Handler.prototype.initialize.call(this,t),this.inBoundFeatures=[],this.outBoundFeatures=[],this.currentIndex=0,this._mapPCRSBounds=M.pixelToPCRSBounds(t.getPixelBounds(),t.getZoom(),t.options.projection)},addHooks:function(){this._map.on("mapkeyboardfocused",this._updateMapBounds,this),this._map.on("mapkeyboardfocused",this._sortIndex,this)},removeHooks:function(){this._map.off("mapkeyboardfocused",this._updateMapBounds),this._map.off("mapkeyboardfocused",this._sortIndex)},addToIndex:function(t,e,i){var o=this._mapPCRSBounds.getCenter(),o=Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2));let n=this._mapPCRSBounds.contains(e)?this.inBoundFeatures:this.outBoundFeatures;o={path:i,layer:t,center:e,dist:o};i.setAttribute("tabindex",-1),n.push(o);for(let t=n.length-1;0<t&&n[t].dist<n[t-1].dist;t--){var a=n[t];n[t]=n[t-1],n[t-1]=a}this._mapPCRSBounds.contains(e)?this.inBoundFeatures=n:this.outBoundFeatures=n},cleanIndex:function(){this.currentIndex=0,this.inBoundFeatures=this.inBoundFeatures.filter(t=>{var e=this._mapPCRSBounds.contains(t.center);return t.path.setAttribute("tabindex",-1),t.layer._map&&!e&&this.outBoundFeatures.push(t),t.layer._map&&e}),this.outBoundFeatures=this.outBoundFeatures.filter(t=>{var e=this._mapPCRSBounds.contains(t.center);return t.path.setAttribute("tabindex",-1),t.layer._map&&e&&this.inBoundFeatures.push(t),t.layer._map&&!e})},_sortIndex:function(){if(this.cleanIndex(),0!==this.inBoundFeatures.length){let n=this._mapPCRSBounds.getCenter();this.inBoundFeatures.sort(function(t,e){var i=t.center,o=e.center;return t.dist=Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)),e.dist=Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2)),t.dist-e.dist}),this.inBoundFeatures[0].path.setAttribute("tabindex",0)}},_updateMapBounds:function(t){this._mapPCRSBounds=M.pixelToPCRSBounds(this._map.getPixelBounds(),this._map.getZoom(),this._map.options.projection)}}),Wo={featureIndexOverlayOption:!1,announceMovement:!1,announceScale:{metric:!0,imperial:!1},defaultExtCoor:"pcrs",defaultLocCoor:"gcrs",locale:{cmBack:"Back",cmForward:"Forward",cmReload:"Reload",cmToggleControls:"Toggle Controls",cmCopyCoords:"Copy",cmCopyMapML:"Map",cmCopyExtent:"Extent",cmCopyLocation:"Location",cmToggleDebug:"Toggle Debug Mode",cmPasteLayer:"Paste",cmViewSource:"View Map Source",lmZoomToLayer:"Zoom To Layer",lmCopyLayer:"Copy Layer",lmZoomToExtent:"Zoom To Sub-layer",lmCopyExtent:"Copy Sub-layer",lcOpacity:"Opacity",btnAttribution:"Map data attribution",btnZoomIn:"Zoom in",btnZoomOut:"Zoom out",btnFullScreen:"View Fullscreen",btnExitFullScreen:"Exit Fullscreen",btnLocTrackOn:"Show my location - location tracking on",btnMyLocTrackOn:"My current location, shown on map",btnLocTrackOff:"Show my location - location tracking off",btnLocTrackLastKnown:"Show my location - last known location shown",btnMyLastKnownLocTrackOn:"My last known location, shown on map",amZoom:"zoom level",amColumn:"column",amRow:"row",amMaxZoom:"At maximum zoom level, zoom in disabled",amMinZoom:"At minimum zoom level, zoom out disabled",amZoomedOut:"Zoomed out of bounds, returning to",amDraggedOut:"Dragged out of bounds, returning to",amEastBound:"Reached east bound, panning east disabled",amWestBound:"Reached west bound, panning west disabled",amNorthBound:"Reached north bound, panning north disabled",amSouthBound:"Reached south bound, panning south disabled",kbdShortcuts:"Keyboard shortcuts",kbdMovement:"Movement keys",kbdFeature:"Feature navigation keys",kbdPanUp:"Pan up",kbdPanDown:"Pan down",kbdPanLeft:"Pan left",kbdPanRight:"Pan right",kbdPanIncrement:"pan increment",kbdZoom:"Zoom in/out 3 levels",kbdPrevFeature:"Previous feature",kbdNextFeature:"Next feature",dfLayer:"Layer",dfExtent:"Sub-layer",popupZoom:"Zoom to here",dfPastedLayer:"Pasted layer",fIndexNoFeatures:"No features found"}};L.Map.Keyboard.include({_onKeyDown:function(t){if(!t.altKey&&!t.metaKey){var e,i=t.keyCode,o=this._map;if(i in this._panKeys)o._panAnim&&o._panAnim._inProgress||(e=this._panKeys[i],t.shiftKey&&(e=L.point(e).multiplyBy(3)),t.ctrlKey&&(e=L.point(e).divideBy(5)),o.panBy(e),o.options.maxBounds&&o.panInsideBounds(o.options.maxBounds));else if(i in this._zoomKeys)(i in{187:187,107:107,61:61,171:171}&&o.getMaxZoom()!==o.getZoom()||i in{189:189,109:109,54:54,173:173}&&o._layersMinZoom!==o.getZoom())&&o.setZoom(o.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!o._popup||!o._popup.options.closeOnEscapeKey)return;o.closePopup()}L.DomEvent.stop(t)}}});function Ko(t){return new on(t)}function Jo(){var n=L.DomUtil.create("fieldset","mapml-layer-extent"),t=L.DomUtil.create("div","mapml-layer-item-properties",n),e=L.DomUtil.create("div","mapml-layer-item-settings",n),i=L.DomUtil.create("label","mapml-layer-item-toggle",t),o=L.DomUtil.create("input"),a=L.SVG.create("svg"),r=L.SVG.create("path"),s=L.SVG.create("path"),l=L.DomUtil.create("span"),h=L.DomUtil.create("div","mapml-layer-item-controls",t),c=L.DomUtil.create("details","mapml-layer-item-details mapml-control-layers",e),u=L.DomUtil.create("summary","",c),m=this.getMapEl(),d=this.getLayerEl(),t=L.DomUtil.create("input","",c);e.hidden=!0,n.setAttribute("aria-grabbed","false"),a.setAttribute("viewBox","0 0 24 24"),a.setAttribute("height","22"),a.setAttribute("width","22"),r.setAttribute("d","M0 0h24v24H0z"),r.setAttribute("fill","none"),s.setAttribute("d","M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"),a.appendChild(r),a.appendChild(s);var p=this.querySelectorAll("map-select");if(p.length){for(var f=document.createDocumentFragment(),y=0;y<p.length;y++)f.appendChild(p[y].selectdetails);e.appendChild(f)}let _=L.DomUtil.create("button","mapml-layer-item-remove-control",h);_.type="button",_.title="Remove Sub Layer",_.innerHTML="<span aria-hidden='true'>&#10005;</span>",_.classList.add("mapml-button"),_.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.remove()});let g=L.DomUtil.create("button","mapml-layer-item-settings-control",h);return g.type="button",g.title="Extent Settings",g.setAttribute("aria-expanded",!1),g.classList.add("mapml-button"),L.DomEvent.on(g,"click",t=>{!0===e.hidden?(g.setAttribute("aria-expanded",!0),e.hidden=!1):(g.setAttribute("aria-expanded",!1),e.hidden=!0)},this),l.setAttribute("aria-hidden",!0),i.appendChild(o),g.appendChild(l),l.appendChild(a),u.innerText="Opacity",u.id="mapml-extent-item-opacity-"+L.stamp(u),t.setAttribute("type","range"),t.setAttribute("min","0"),t.setAttribute("max","1.0"),t.setAttribute("step","0.1"),t.setAttribute("aria-labelledby","mapml-extent-item-opacity-"+L.stamp(u)),t.setAttribute("value",this.opacity),t.value=this._extentLayer._container.style.opacity||"1.0",t.addEventListener("change",function(t){t&&t.target&&0<=t.target.value&&t.target.value<=1&&this._extentLayer.changeOpacity(t.target.value)}.bind(this)),u=L.DomUtil.create("span","mapml-extent-item-name",i),o.type="checkbox",o.defaultChecked=this.checked,u.innerHTML=this.label,(this._layerControlCheckbox=o).addEventListener("change",function(){this.checked=!this.checked}.bind(this)),u.id="mapml-extent-item-name-{"+L.stamp(u)+"}",n.setAttribute("aria-labelledby",u.id),u.extent=this,n.ontouchstart=n.onmousedown=i=>{if("label"===i.target.parentElement.tagName.toLowerCase()&&"input"!==i.target.tagName.toLowerCase()||"label"===i.target.tagName.toLowerCase()){i.stopPropagation(),i=i instanceof TouchEvent?i.touches[0]:i;let s=n,l=n.parentNode,t=!1,h=i.clientY,e=Array.from(n.parentElement.querySelectorAll("fieldset")).indexOf(n);document.body.ontouchmove=document.body.onmousemove=a=>{a.preventDefault();var r=(a=a instanceof TouchEvent?a.touches[0]:a).clientY-h;if(t=15<Math.abs(r)||t,!(l&&!t||l&&l.childElementCount<=1||l.getBoundingClientRect().top>s.getBoundingClientRect().bottom||l.getBoundingClientRect().bottom<s.getBoundingClientRect().top)){l.classList.add("mapml-draggable"),s.style.transform="translateY("+r+"px)",s.style.pointerEvents="none";let t=a.clientX,e=a.clientY,i=("MAPML-VIEWER"===m.tagName?m:m.querySelector(".mapml-web-map")).shadowRoot,o=i.elementFromPoint(t,e),n=o&&o.closest("fieldset")?o.closest("fieldset"):s;n=Math.abs(r)<=n.offsetHeight?s:n,s.setAttribute("aria-grabbed","true"),s.setAttribute("aria-dropeffect","move"),n&&l===n.parentNode&&(n=n!==s.nextSibling?n:n.nextSibling,s!==n&&(h=a.clientY,s.style.transform=null),l.insertBefore(s,n))}},document.body.ontouchend=document.body.onmouseup=()=>{var t=Array.from(n.parentElement.querySelectorAll("fieldset")).indexOf(n);if(s.setAttribute("aria-grabbed","false"),s.removeAttribute("aria-dropeffect"),s.style.pointerEvents=null,s.style.transform=null,e!==t){let t=l.children,e=0;for(var i of t){let t=i.querySelector("span").extent;t.setAttribute("data-moving","");const o=d.src?d.shadowRoot:d;o.append(t),t.removeAttribute("data-moving"),t.extentZIndex=e,t._extentLayer.setZIndex(e),e++}}l.classList.remove("mapml-draggable"),document.body.ontouchmove=document.body.onmousemove=document.body.ontouchend=document.body.onmouseup=null}}},this._extentRootFieldset=n,this._opacitySlider=t,this._opacityControl=c,this._layerControlLabel=i,n}async function Qo(){var n=L.DomUtil.create("fieldset","mapml-layer-item"),t=L.DomUtil.create("input"),e=L.DomUtil.create("span","mapml-layer-item-name"),i=L.DomUtil.create("span"),o=L.DomUtil.create("div","mapml-layer-item-properties",n),a=L.DomUtil.create("div","mapml-layer-item-settings",n),r=L.DomUtil.create("label","mapml-layer-item-toggle",o),s=L.DomUtil.create("div","mapml-layer-item-controls",o),l=L.DomUtil.create("details","mapml-layer-item-opacity mapml-control-layers",a),h=L.DomUtil.create("input"),c=L.DomUtil.create("summary"),u=L.SVG.create("svg"),m=L.SVG.create("path"),o=L.SVG.create("path"),d=L.DomUtil.create("fieldset","mapml-layer-grouped-extents"),p=this.parentNode;u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("height","22"),u.setAttribute("width","22"),u.setAttribute("fill","currentColor"),m.setAttribute("d","M0 0h24v24H0z"),m.setAttribute("fill","none"),o.setAttribute("d","M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"),u.appendChild(m),u.appendChild(o),a.hidden=!0,i.setAttribute("aria-hidden",!0);let f=L.DomUtil.create("button","mapml-layer-item-remove-control",s);f.type="button",f.title="Remove Layer",f.innerHTML="<span aria-hidden='true'>&#10005;</span>",f.classList.add("mapml-button"),L.DomEvent.on(f,"click",L.DomEvent.stop),L.DomEvent.on(f,"click",t=>{let e=0,i,o;if(o=("MAPML-VIEWER"===p.tagName?p:p.querySelector(".mapml-web-map")).shadowRoot,t.target.closest("fieldset").nextElementSibling&&!t.target.closest("fieldset").nextElementSibling.disbaled)for(i=t.target.closest("fieldset").previousElementSibling;i;)e+=2,i=i.previousElementSibling;else i="link";p.removeChild(t.target.closest("fieldset").querySelector("span").layer._layerEl),i=i?o.querySelector(".leaflet-control-attribution").firstElementChild:i=o.querySelectorAll("input")[e],i.focus()},this._layer);let y=L.DomUtil.create("button","mapml-layer-item-settings-control",s);y.type="button",y.title="Layer Settings",y.setAttribute("aria-expanded",!1),y.classList.add("mapml-button"),L.DomEvent.on(y,"click",t=>{let e=this._layer._layerEl._layerControl._container;e._isExpanded||"touch"!==t.pointerType?!0===a.hidden?(y.setAttribute("aria-expanded",!0),a.hidden=!1):(y.setAttribute("aria-expanded",!1),a.hidden=!0):e._isExpanded=!0},this._layer),t.defaultChecked=this.checked,t.type="checkbox",t.setAttribute("class","leaflet-control-layers-selector"),e.layer=this._layer,t.addEventListener("change",function(){this.checked=!this.checked}.bind(this)),this._layer._legendUrl?((s=document.createElement("a")).text=" "+this._layer._title,s.href=this._layer._legendUrl,s.target="_blank",s.draggable=!1,e.appendChild(s)):e.innerHTML=this._layer._title,e.id="mapml-layer-item-name-{"+L.stamp(e)+"}",c.innerText="Opacity",c.id="mapml-layer-item-opacity-"+L.stamp(c),l.appendChild(c),l.appendChild(h),h.setAttribute("type","range"),h.setAttribute("min","0"),h.setAttribute("max","1.0"),h.setAttribute("value",this._layer._container.style.opacity||"1.0"),h.setAttribute("step","0.1"),h.setAttribute("aria-labelledby","mapml-layer-item-opacity-"+L.stamp(c)),h.value=this._layer._container.style.opacity||"1.0",h.addEventListener("change",function(t){t&&t.target&&0<=t.target.value&&t.target.value<=1&&this._layer.changeOpacity(t.target.value)}.bind(this)),n.setAttribute("aria-grabbed","false"),n.setAttribute("aria-labelledby",e.id),n.ontouchstart=n.onmousedown=e=>{if("label"===e.target.parentElement.tagName.toLowerCase()&&"input"!==e.target.tagName.toLowerCase()||"label"===e.target.tagName.toLowerCase()){e=e instanceof TouchEvent?e.touches[0]:e;let s=n,l=n.parentNode,t=!1,h=e.clientY,i=Array.from(l.querySelectorAll("fieldset")).indexOf(n);document.body.ontouchmove=document.body.onmousemove=a=>{a.preventDefault();var r=(a=a instanceof TouchEvent?a.touches[0]:a).clientY-h;if(t=15<Math.abs(r)||t,!(l&&!t||l&&l.childElementCount<=1||l.getBoundingClientRect().top>s.getBoundingClientRect().bottom||l.getBoundingClientRect().bottom<s.getBoundingClientRect().top)){l.classList.add("mapml-draggable"),s.style.transform="translateY("+r+"px)",s.style.pointerEvents="none";let t=a.clientX,e=a.clientY,i=("MAPML-VIEWER"===p.tagName?p:p.querySelector(".mapml-web-map")).shadowRoot,o=i.elementFromPoint(t,e),n=o&&o.closest("fieldset")?o.closest("fieldset"):s;n=Math.abs(r)<=n.offsetHeight?s:n,s.setAttribute("aria-grabbed","true"),s.setAttribute("aria-dropeffect","move"),n&&l===n.parentNode&&(n=n!==s.nextSibling?n:n.nextSibling,s!==n&&(h=a.clientY,s.style.transform=null),l.insertBefore(s,n))}},document.body.ontouchend=document.body.onmouseup=()=>{var t=Array.from(l.querySelectorAll("fieldset")).indexOf(n);if(s.setAttribute("aria-grabbed","false"),s.removeAttribute("aria-dropeffect"),s.style.pointerEvents=null,s.style.transform=null,i!==t){let t=l.children,i=1;for(var e of t){let t=e.querySelector("span").layer._layerEl;t.setAttribute("data-moving",""),p.insertAdjacentElement("beforeend",t),t.removeAttribute("data-moving")}var o=p.querySelectorAll("layer-");for(let e=0;e<o.length;e++){let t=o[e]._layer;t.options.zIndex!==i&&t.setZIndex(i),i++}}l.classList.remove("mapml-draggable"),document.body.ontouchmove=document.body.onmousemove=document.body.onmouseup=null}}},r.appendChild(t),r.appendChild(e),y.appendChild(i),i.appendChild(u);let _=this.src?this.shadowRoot:this;u=_.querySelectorAll('map-link[rel=style],map-link[rel="self style"],map-link[rel="style self"]');let g;u&&(g=this.getAlternateStyles(u),g&&a.appendChild(g)),this._layerControlCheckbox=t,this._layerControlLabel=r,this._opacityControl=l,this._opacitySlider=h,this._layerControlHTML=n,this._layerItemSettingsHTML=a,this._propertiesGroupAnatomy=d,this._styles=g,d.setAttribute("aria-label","Sublayers"),d.setAttribute("hidden","");let b=_.querySelectorAll("map-extent:not([hidden])"),x=[];for(let t=0;t<b.length;t++)x.push(b[t].whenReady()),d.removeAttribute("hidden");await Promise.all(x);for(let t=0;t<b.length;t++)d.appendChild(b[t].getLayerControlHTML());return a.appendChild(d),this._layerControlHTML}var tn,en,on=L.Layer.extend({onAdd:function(t){this._container=L.DomUtil.create("div","mapml-feature-index-box",t._container),this._container.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 100 100"><path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M0 0h100v100H0z" color="#000" overflow="visible"/></svg>',this._output=L.DomUtil.create("output","mapml-feature-index",t._container),this._output.setAttribute("role","status"),this._output.setAttribute("aria-live","polite"),this._output.setAttribute("aria-atomic","true"),this._body=L.DomUtil.create("span","mapml-feature-index-content",this._output),this._body.index=0,this._output.initialFocus=!1,t.on("focus blur popupclose",this._addOrRemoveFeatureIndex,this),t.on("moveend focus templatedfeatureslayeradd",this._checkOverlap,this),t.on("keydown",this._onKeyDown,this),this._addOrRemoveFeatureIndex()},_calculateReticleBounds:function(){let t=this._map.getPixelBounds();var e=t.getCenter(),i=Math.abs(t.min.x-t.max.x)/this._map.options.mapEl.width,o=Math.abs(t.min.y-t.max.y)/this._map.options.mapEl.height;let n=getComputedStyle(this._container).width.replace(/[^\d.]/g,"");"%"===getComputedStyle(this._container).width.slice(-1)&&(n=n*this._map.options.mapEl.width/100);var a=i*n/2,i=o*n/2,o=L.point(e.x-a,e.y+i),i=L.point(e.x+a,e.y-i),i=L.bounds(o,i);return M.pixelToPCRSBounds(i,this._map.getZoom(),this._map.options.projection)},_checkOverlap:function(t){if("focus"===t.type&&(this._output.initialFocus=!0),this._output.initialFocus)if(this._output.popupClosed)this._output.popupClosed=!1;else{this._map.fire("mapkeyboardfocused");let n=this._calculateReticleBounds(),a=this._map.featureIndex.inBoundFeatures,r=1,t=Object.keys(a),s=this._body,e=document.createElement("span");e.innerHTML=M.options.locale.fIndexNoFeatures,s.innerHTML="",s.index=0,s.allFeatures=[],t.forEach(t=>{let e=a[t].layer;var i=a[t].layer._layers;let o=L.bounds();if(i){let t=Object.keys(i);t.forEach(t=>{o=o||L.bounds(e._layers[t]._bounds.min,e._layers[t]._bounds.max),o.extend(e._layers[t]._bounds.min),o.extend(e._layers[t]._bounds.max)})}else e._bounds&&(o=L.bounds(e._bounds.min,e._bounds.max));n.overlaps(o)&&(t=a[t].path.getAttribute("aria-label"),r<8&&s.appendChild(this._updateOutput(t,r,r)),r%7!=0&&1!==r||s.allFeatures.push([]),s.allFeatures[Math.floor((r-1)/7)].push({label:t,index:r,layer:e}),s.allFeatures[1]&&1===s.allFeatures[1].length&&s.appendChild(this._updateOutput("More results",0,9)),r+=1)}),this._addToggleKeys(),1===r&&s.appendChild(e)}},_updateOutput:function(t,e,i){let o=document.createElement("span");return o.setAttribute("data-index",e),o.innerHTML=`<kbd>${i}</kbd>`+" "+t+"<span>, </span>",o},_addToggleKeys:function(){let e=this._body.allFeatures;for(let t=0;t<e.length;t++){if(0===e[t].length)return;e[t-1]&&e[t].push({label:"Previous results"}),e[t+1]&&0<e[t+1].length&&e[t].push({label:"More results"})}},_onKeyDown:function(e){var t=this._body,i=e.originalEvent.keyCode;if(49<=i&&i<=55){if(t.allFeatures[t.index]){e=t.allFeatures[t.index][i-49];if(e){let t=e.layer;t&&(this._map.featureIndex.currentIndex=e.index-1,t._popup?(this._map.closePopup(),t.openPopup()):t.options.group.focus())}}}else 56===i?this._newContent(t,-1):57===i&&this._newContent(t,1)},_newContent:function(i,t){var e=i.firstChild.getAttribute("data-index"),o=i.allFeatures[Math.floor((e-1)/7+t)];if(o&&0<o.length){i.innerHTML="",i.index+=t;for(let e=0;e<o.length;e++){var n=o[e],a=n.index||0;let t=e+1;"More results"===n.label&&(t=9),"Previous results"===n.label&&(t=8),i.appendChild(this._updateOutput(n.label,a,t))}}},_addOrRemoveFeatureIndex:function(t){if(this._output.initialFocus){if(this._output.hasAttribute("aria-hidden")){let t=this;setTimeout(function(){t._output.removeAttribute("aria-hidden")},100)}}else this._output.setAttribute("aria-hidden","true");t&&"popupclose"===t.type?(this._output.setAttribute("aria-hidden","true"),this._output.popupClosed=!0):t&&"focus"===t.type?(this._container.removeAttribute("hidden"),this._output.classList.remove("mapml-screen-reader-output")):t&&t.target._popup?this._container.setAttribute("hidden",""):t&&"blur"===t.type?(this._container.setAttribute("hidden",""),this._output.classList.add("mapml-screen-reader-output"),this._output.initialFocus=!1,this._addOrRemoveFeatureIndex()):(this._container.setAttribute("hidden",""),this._output.classList.add("mapml-screen-reader-output"))}});class nn{constructor(t,e,i,o,n,a){this.name=t,this.min=e,this.max=i,this.value=o,this.step=n,this.layer=a}validateInput(){return!!this.name}getValue(){return this.layer._map.options.mapEl.zoom}}class an{constructor(t,e){this.name=t,this.value=e}validateInput(){return!(!this.name||!this.value)}getValue(){return this.value}}class rn{constructor(t,e){this.name=t,this.layer=e}validateInput(){return!!this.name}getValue(){return this.layer._map.getSize().x}}class sn{constructor(t,e){this.name=t,this.layer=e}validateInput(){return!!this.name}getValue(){return this.layer._map.getSize().y}}class ln{constructor(t,e,i,o,n,a,r,s){this.name=t,this.position=e,this.axis=i,o||!i||["i","j"].includes(i)?this.units=o:this.units=M.axisToCS(i).toLowerCase(),this.min=n,this.max=a,this.rel=r,this.layer=s}validateInput(){if(!this.name||!this.axis)return!1;if(("i"===this.axis||"j"===this.axis)&&!["map","tile"].includes(this.units))return!1;if(this.units){let t=M.axisToCS(this.axis);if("string"==typeof t&&t.toUpperCase()!==this.units.toUpperCase())return!1}return!0}_TCRSToPCRS(t,e){var i=this.layer._map.options.crs;return i.transformation.untransform(t,i.scale(e))}getValue(t=void 0,e=void 0){if(void 0===t&&(t=this.layer._map.getZoom()),void 0===e&&(e=this.layer._map.getPixelBounds()),"pcrs"===this.units||"gcrs"===this.units)switch(this.axis){case"longitude":case"easting":if(!this.position)return this._TCRSToPCRS(e.min,t).x;if(this.position.match(/.*?-left/i))return this._TCRSToPCRS(e.min,t).x;if(this.position.match(/.*?-right/i))return this._TCRSToPCRS(e.max,t).x;break;case"latitude":case"northing":if(!this.position)return this._TCRSToPCRS(e.min,t).y;if(this.position.match(/top-.*?/i))return this._TCRSToPCRS(e.min,t).y;if(this.position.match(/bottom-.*?/i))return this._TCRSToPCRS(e.max,t).y}else{if("tilematrix"===this.units){var o=this.layer._map.getCenter();const a=this.layer._extentLayer._templates[0].layer;var o=a._getTiledPixelBounds(o),n=a._pxBoundsToTileRange(o);let i=[];for(let e=n.min.y;e<=n.max.y;e++)for(let t=n.min.x;t<=n.max.x;t++){const r=new L.Point(t,e);r.z=a._tileZoom,i.push(r)}return i}"tile"===this.units||this.units}}}class hn{#element;#valueSet;#attribute;#domain;constructor(t,e,i,o){var n=document.createElement("div");this.domtokenlist=n.classList,this.#valueSet=!1,this.domtokenlist.value=t??"",this.#element=e,this.#attribute=i,this.#domain=o}get valueSet(){return this.#valueSet}get length(){return this.domtokenlist.length}get value(){return this.domtokenlist.value}set value(t){null===t?this.domtokenlist.value="":(this.domtokenlist.value=t.toLowerCase(),this.#valueSet=!0,this.#element.setAttribute(this.#attribute,this.domtokenlist.value),this.#valueSet=!1)}item(t){return this.domtokenlist.item(t)}contains(t){return this.domtokenlist.contains(t)}add(t){this.domtokenlist.add(t),this.#element.setAttribute(this.#attribute,this.domtokenlist.value)}remove(t){this.domtokenlist.remove(t),this.#element.setAttribute(this.#attribute,this.domtokenlist.value)}replace(t,e){this.domtokenlist.replace(t,e),this.#element.setAttribute(this.#attribute,this.domtokenlist.value)}supports(t){return!!this.#domain.includes(t)}toggle(t,e){this.domtokenlist.toggle(t,e),this.#element.setAttribute(this.#attribute,this.domtokenlist.value)}entries(){return this.domtokenlist.entries()}forEach(t,e){this.domtokenlist.forEach(t,e)}keys(){return this.domtokenlist.keys()}values(){return this.domtokenlist.values()}}tn=window,en={},tn.M=en,function(){en.detectImagePath=function(t){var e=L.DomUtil.create("div","leaflet-default-icon-path",t),i=L.DomUtil.getStyle(e,"background-image")||L.DomUtil.getStyle(e,"backgroundImage");return t.removeChild(e),i=null===i||0!==i.indexOf("url")?"":i.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")},en.mime="text/mapml";var t=tn.document.head.querySelector("map-options");en.options=Wo,t&&(en.options=Object.assign(en.options,JSON.parse(t.innerHTML))),en.WGS84=new L.Proj.CRS("EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ",{origin:[-180,90],bounds:L.bounds([[-180,-90],[180,90]]),resolutions:[.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.0003433227539062,.0001716613769531,858306884766e-16,429153442383e-16,214576721191e-16,107288360596e-16,53644180298e-16,26822090149e-16,13411045074e-16,6.705522537e-7,3.352761269e-7],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>Math.round(en.WGS84.options.bounds.getSize().x/en.WGS84.options.resolutions[t])},vertical:{name:"y",min:0,max:t=>Math.round(en.WGS84.options.bounds.getSize().y/en.WGS84.options.resolutions[t])},bounds:t=>L.bounds([en.WGS84.options.crs.tcrs.horizontal.min,en.WGS84.options.crs.tcrs.vertical.min],[en.WGS84.options.crs.tcrs.horizontal.max(t),en.WGS84.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"longitude",get min(){return en.WGS84.options.crs.gcrs.horizontal.min},get max(){return en.WGS84.options.crs.gcrs.horizontal.max}},vertical:{name:"latitude",get min(){return en.WGS84.options.crs.gcrs.vertical.min},get max(){return en.WGS84.options.crs.gcrs.vertical.max}},get bounds(){return en.WGS84.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-180,max:180},vertical:{name:"latitude",min:-90,max:90},get bounds(){return L.latLngBounds([en.WGS84.options.crs.gcrs.vertical.min,en.WGS84.options.crs.gcrs.horizontal.min],[en.WGS84.options.crs.gcrs.vertical.max,en.WGS84.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([en.WGS84.options.crs.tile.horizontal.min,en.WGS84.options.crs.tile.vertical.min],[en.WGS84.options.crs.tile.horizontal.max,en.WGS84.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>Math.round(en.WGS84.options.crs.tcrs.horizontal.max(t)/en.WGS84.options.crs.tile.bounds.getSize().x)},vertical:{name:"row",min:0,max:t=>Math.round(en.WGS84.options.crs.tcrs.vertical.max(t)/en.WGS84.options.crs.tile.bounds.getSize().y)},bounds:t=>L.bounds([en.WGS84.options.crs.tilematrix.horizontal.min,en.WGS84.options.crs.tilematrix.vertical.min],[en.WGS84.options.crs.tilematrix.horizontal.max(t),en.WGS84.options.crs.tilematrix.vertical.max(t)])}}}),en.CBMTILE=new L.Proj.CRS("EPSG:3978","+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",{origin:[-34655800,3931e4],bounds:L.bounds([[-34655800,-39e6],[1e7,3931e4]]),resolutions:[38364.660062653464,22489.62831258996,13229.193125052918,7937.5158750317505,4630.2175937685215,2645.8386250105837,1587.5031750063501,926.0435187537042,529.1677250021168,317.50063500127004,185.20870375074085,111.12522225044451,66.1459656252646,38.36466006265346,22.48962831258996,13.229193125052918,7.9375158750317505,4.6302175937685215,2.6458386250105836,1.5875031750063502,.9260435187537043,.5291677250021167,.31750063500127,.18520870375074083,.11112522225044451,.06614596562526459],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>Math.round(en.CBMTILE.options.bounds.getSize().x/en.CBMTILE.options.resolutions[t])},vertical:{name:"y",min:0,max:t=>Math.round(en.CBMTILE.options.bounds.getSize().y/en.CBMTILE.options.resolutions[t])},bounds:t=>L.bounds([en.CBMTILE.options.crs.tcrs.horizontal.min,en.CBMTILE.options.crs.tcrs.vertical.min],[en.CBMTILE.options.crs.tcrs.horizontal.max(t),en.CBMTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return en.CBMTILE.options.bounds.min.x},get max(){return en.CBMTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return en.CBMTILE.options.bounds.min.y},get max(){return en.CBMTILE.options.bounds.max.y}},get bounds(){return en.CBMTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-141.01,max:-47.74},vertical:{name:"latitude",min:40.04,max:86.46},get bounds(){return L.latLngBounds([en.CBMTILE.options.crs.gcrs.vertical.min,en.CBMTILE.options.crs.gcrs.horizontal.min],[en.CBMTILE.options.crs.gcrs.vertical.max,en.CBMTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([en.CBMTILE.options.crs.tile.horizontal.min,en.CBMTILE.options.crs.tile.vertical.min],[en.CBMTILE.options.crs.tile.horizontal.max,en.CBMTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>Math.round(en.CBMTILE.options.crs.tcrs.horizontal.max(t)/en.CBMTILE.options.crs.tile.bounds.getSize().x)},vertical:{name:"row",min:0,max:t=>Math.round(en.CBMTILE.options.crs.tcrs.vertical.max(t)/en.CBMTILE.options.crs.tile.bounds.getSize().y)},bounds:t=>L.bounds([0,0],[en.CBMTILE.options.crs.tilematrix.horizontal.max(t),en.CBMTILE.options.crs.tilematrix.vertical.max(t)])}}}),en.APSTILE=new L.Proj.CRS("EPSG:5936","+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs",{origin:[-28567784.109255,32567784.109255],bounds:L.bounds([[-28567784.109254867,-28567784.109254755],[32567784.109255023,32567784.10925506]]),resolutions:[238810.813354,119405.406677,59702.7033384999,29851.3516692501,14925.675834625,7462.83791731252,3731.41895865639,1865.70947932806,932.854739664032,466.427369832148,233.213684916074,116.606842458037,58.3034212288862,29.1517106145754,14.5758553072877,7.28792765351156,3.64396382688807,1.82198191331174,.910990956788164,.45549547826179],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>Math.round(en.APSTILE.options.bounds.getSize().x/en.APSTILE.options.resolutions[t])},vertical:{name:"y",min:0,max:t=>Math.round(en.APSTILE.options.bounds.getSize().y/en.APSTILE.options.resolutions[t])},bounds:t=>L.bounds([en.APSTILE.options.crs.tcrs.horizontal.min,en.APSTILE.options.crs.tcrs.vertical.min],[en.APSTILE.options.crs.tcrs.horizontal.max(t),en.APSTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return en.APSTILE.options.bounds.min.x},get max(){return en.APSTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return en.APSTILE.options.bounds.min.y},get max(){return en.APSTILE.options.bounds.max.y}},get bounds(){return en.APSTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-180,max:180},vertical:{name:"latitude",min:60,max:90},get bounds(){return L.latLngBounds([en.APSTILE.options.crs.gcrs.vertical.min,en.APSTILE.options.crs.gcrs.horizontal.min],[en.APSTILE.options.crs.gcrs.vertical.max,en.APSTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([en.APSTILE.options.crs.tile.horizontal.min,en.APSTILE.options.crs.tile.vertical.min],[en.APSTILE.options.crs.tile.horizontal.max,en.APSTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>Math.round(en.APSTILE.options.crs.tcrs.horizontal.max(t)/en.APSTILE.options.crs.tile.bounds.getSize().x)},vertical:{name:"row",min:0,max:t=>Math.round(en.APSTILE.options.crs.tcrs.vertical.max(t)/en.APSTILE.options.crs.tile.bounds.getSize().y)},bounds:t=>L.bounds([0,0],[en.APSTILE.options.crs.tilematrix.horizontal.max(t),en.APSTILE.options.crs.tilematrix.vertical.max(t)])}}}),en.OSMTILE=L.CRS.EPSG3857,L.setOptions(en.OSMTILE,{origin:[-20037508.342787,20037508.342787],bounds:L.bounds([[-20037508.342787,-20037508.342787],[20037508.342787,20037508.342787]]),resolutions:[156543.0339,78271.51695,39135.758475,19567.8792375,9783.93961875,4891.969809375,2445.9849046875,1222.9924523438,611.49622617188,305.74811308594,152.87405654297,76.437028271484,38.218514135742,19.109257067871,9.5546285339355,4.7773142669678,2.3886571334839,1.1943285667419,.59716428337097,.29858214168549,.14929107084274,.074645535421371,.03732276771068573,.018661383855342866,.009330691927671433],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>Math.round(en.OSMTILE.options.bounds.getSize().x/en.OSMTILE.options.resolutions[t])},vertical:{name:"y",min:0,max:t=>Math.round(en.OSMTILE.options.bounds.getSize().y/en.OSMTILE.options.resolutions[t])},bounds:t=>L.bounds([en.OSMTILE.options.crs.tcrs.horizontal.min,en.OSMTILE.options.crs.tcrs.vertical.min],[en.OSMTILE.options.crs.tcrs.horizontal.max(t),en.OSMTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return en.OSMTILE.options.bounds.min.x},get max(){return en.OSMTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return en.OSMTILE.options.bounds.min.y},get max(){return en.OSMTILE.options.bounds.max.y}},get bounds(){return en.OSMTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",get min(){return en.OSMTILE.unproject(en.OSMTILE.options.bounds.min).lng},get max(){return en.OSMTILE.unproject(en.OSMTILE.options.bounds.max).lng}},vertical:{name:"latitude",get min(){return en.OSMTILE.unproject(en.OSMTILE.options.bounds.min).lat},get max(){return en.OSMTILE.unproject(en.OSMTILE.options.bounds.max).lat}},get bounds(){return L.latLngBounds([en.OSMTILE.options.crs.gcrs.vertical.min,en.OSMTILE.options.crs.gcrs.horizontal.min],[en.OSMTILE.options.crs.gcrs.vertical.max,en.OSMTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([en.OSMTILE.options.crs.tile.horizontal.min,en.OSMTILE.options.crs.tile.vertical.min],[en.OSMTILE.options.crs.tile.horizontal.max,en.OSMTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>Math.round(en.OSMTILE.options.crs.tcrs.horizontal.max(t)/en.OSMTILE.options.crs.tile.bounds.getSize().x)},vertical:{name:"row",min:0,max:t=>Math.round(en.OSMTILE.options.crs.tcrs.vertical.max(t)/en.OSMTILE.options.crs.tile.bounds.getSize().y)},bounds:t=>L.bounds([0,0],[en.OSMTILE.options.crs.tilematrix.horizontal.max(t),en.OSMTILE.options.crs.tilematrix.vertical.max(t)])}}})}(),en._handleLink=It,en.convertPCRSBounds=Li,en.axisToXY=xi,en.csToAxes=gi,en._convertAndFormatPCRS=ai,en.extentToBounds=pi,en.axisToCS=yi,en._parseNumber=Ao,en._splitCoordinate=Di,en.boundsToPCRSBounds=ki,en.pixelToPCRSBounds=Ai,en._metaContentToObject=Pi,en._coordsToArray=Fi,en.pointToPCRSPoint=Ci,en.pixelToPCRSPoint=Ti,en._gcrsToTileMatrix=Se,en._pasteLayer=wi,en._properties2Table=Oe,en._updateExtent=Be,en.geojson2mapml=_i,en._breakArray=ii,en._table2properties=lt,en._geometry2geojson=zi,en._pcrsToGcrs=qe,en.mapml2geojson=vi,en.getMaxZoom=Ee,en.getBoundsFromMeta=zt,en.getZoomBoundsFromMeta=xe,en.getZoomBounds=Le,en.getNativeVariables=Me,en.getClosest=oi,en.QueryHandler=ko,en.ContextMenu=zo,en.AnnounceMovement=ni,en.FeatureIndex=co,L.Map.addInitHook("addHandler","query",en.QueryHandler),L.Map.addInitHook("addHandler","contextMenu",en.ContextMenu),L.Map.addInitHook("addHandler","announceMovement",en.AnnounceMovement),L.Map.addInitHook("addHandler","featureIndex",en.FeatureIndex),en.MapMLLayer=bo,en.mapMLLayer=fo,en.ImageLayer=go,en.imageLayer=po,en.TemplatedImageLayer=d,en.templatedImageLayer=r,en.TemplatedFeaturesLayer=m,en.templatedFeaturesLayer=a,en.ExtentLayer=u,en.extentLayer=n,en.TemplatedTileLayer=c,en.templatedTileLayer=o,en.FeatureLayer=h,en.featureLayer=i,en.LayerControl=l,en.layerControl=e,en.AttributionButton=Io,en.attributionButton=Po,en.ReloadButton=Ro,en.reloadButton=Bo,en.ScaleBar=Do,en.scaleBar=Fo,en.FullscreenButton=Oo,en.fullscreenButton=No,en.geolocationButton=qo,en.StaticTileLayer=s,en.staticTileLayer=t,en.DebugOverlay=xo,en.debugOverlay=yo,en.Crosshair=Vo,en.crosshair=jo,en.FeatureIndexOverlay=on,en.featureIndexOverlay=Ko,en.Path=Go,en.path=Uo,en.FeatureRenderer=Xo,en.featureRenderer=Zo,en.Geometry=$o,en.geometry=Ho,en._createLayerControlExtentHTML=Jo,en._createLayerControlHTML=Qo,en.ZoomInput=nn,en.HiddenInput=an,en.WidthInput=rn,en.HeightInput=sn,en.LocationInput=ln,en.TILE_SIZE=256,en.FALLBACK_PROJECTION="OSMTILE",en.FALLBACK_CS="TILEMATRIX",en.BLANK_TT_TREF="mapmltemplatedtileplaceholder",en.DOMTokenList=hn,en.protomapsL=ti,en.templatedPMTilesLayer=mo,en.TemplatedPMTilesLayer=_o}();
//# sourceMappingURL=mapml.js.map