{"version":3,"file":"mapml.js","sources":["mapml.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  var MapMLStaticTileLayer = L.GridLayer.extend({\n\n    initialize: function (options) {\n      this.zoomBounds = this._getZoomBounds(options.tileContainer,options.maxZoomBound);\n      L.extend(options, this.zoomBounds);\n      L.setOptions(this, options);\n      this._groups = this._groupTiles(this.options.tileContainer.getElementsByTagName('map-tile'));\n    },\n\n    onAdd: function(){\n      this._bounds = this._getLayerBounds(this._groups,this._map.options.projection); //stores meter values of bounds\n      this.layerBounds = this._bounds[Object.keys(this._bounds)[0]];\n      for(let key of Object.keys(this._bounds)){\n        this.layerBounds.extend(this._bounds[key].min);\n        this.layerBounds.extend(this._bounds[key].max);\n      }\n      L.GridLayer.prototype.onAdd.call(this,this._map);\n      this._handleMoveEnd();\n    },\n    \n    getEvents: function(){\n      let events = L.GridLayer.prototype.getEvents.call(this,this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      events.move = ()=>{}; //needed to prevent moveend from running\n      return events;\n    },\n\n\n    //sets the bounds flag of the layer and calls default moveEnd if within bounds\n    //its the zoom level is between the nativeZoom and zoom then it uses the nativeZoom value to get the bound its checking\n    _handleMoveEnd : function(e){\n      let mapZoom = this._map.getZoom();\n      let zoomLevel = mapZoom;\n      zoomLevel = zoomLevel > this.options.maxNativeZoom? this.options.maxNativeZoom: zoomLevel;\n      zoomLevel = zoomLevel < this.options.minNativeZoom? this.options.minNativeZoom: zoomLevel;\n      this.isVisible = mapZoom <= this.zoomBounds.maxZoom && mapZoom >= this.zoomBounds.minZoom && \n                        this._bounds[zoomLevel] && this._bounds[zoomLevel]\n                        .overlaps(M.pixelToPCRSBounds(\n                          this._map.getPixelBounds(),\n                          this._map.getZoom(),\n                          this._map.options.projection));\n      if(!(this.isVisible))return; //onMoveEnd still gets fired even when layer is out of bounds??, most likely need to overrride _onMoveEnd\n      this._parentOnMoveEnd();\n    },\n\n    _isValidTile(coords) {\n      return this._groups[this._tileCoordsToKey(coords)];\n    },\n\n    createTile: function (coords) {\n      let tileGroup = this._groups[this._tileCoordsToKey(coords)] || [],\n          tileElem = document.createElement('map-tile'), tileSize = this.getTileSize();\n      tileElem.setAttribute(\"col\",coords.x);\n      tileElem.setAttribute(\"row\",coords.y);\n      tileElem.setAttribute(\"zoom\",coords.z);\n      \n      for(let i = 0;i<tileGroup.length;i++){\n        let tile= document.createElement('img');\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tile.alt = '';\n        tile.setAttribute(\"role\",\"presentation\");\n        tile.src = tileGroup[i].src;\n        tileElem.appendChild(tile);\n      }\n      return tileElem;\n    },\n\n    _getLayerBounds: function(tileGroups, projection){\n      let layerBounds = {}, tileSize = M[projection].options.crs.tile.bounds.max.x;\n      for(let tile in tileGroups){\n        let sCoords = tile.split(\":\"), pixelCoords = {};\n        pixelCoords.x = +sCoords[0] * tileSize;\n        pixelCoords.y = +sCoords[1] * tileSize;\n        pixelCoords.z = +sCoords[2]; //+String same as parseInt(String)\n        if(sCoords[2] in layerBounds){\n\n          layerBounds[sCoords[2]].extend(L.point(pixelCoords.x ,pixelCoords.y ));\n          layerBounds[sCoords[2]].extend(L.point(((pixelCoords.x+tileSize) ),((pixelCoords.y+tileSize) )));\n        } else {\n          layerBounds[sCoords[2]] = L.bounds(\n                                      L.point(pixelCoords.x ,pixelCoords.y ),\n                                      L.point(((pixelCoords.x+tileSize) ),((pixelCoords.y+tileSize) )));\n        }\n      }\n      // TODO: optimize by removing 2nd loop, add util function to convert point in pixels to point in pcrs, use that instead then this loop\n      // won't be needed\n      for(let pixelBounds in layerBounds){\n        let zoom = +pixelBounds;\n        layerBounds[pixelBounds] = M.pixelToPCRSBounds(layerBounds[pixelBounds],zoom,projection);\n      }\n\n      return layerBounds;\n    },\n\n    _getZoomBounds: function(container, maxZoomBound){\n      if(!container) return null;\n      let meta = M.metaContentToObject(container.getElementsByTagName('map-tiles')[0].getAttribute('zoom')),\n          zoom = {},tiles = container.getElementsByTagName(\"map-tile\");\n      zoom.nativeZoom = +meta.value || 0;\n      zoom.maxNativeZoom = 0;\n      zoom.minNativeZoom = maxZoomBound;\n      for (let i=0;i<tiles.length;i++) {\n        let lZoom = +tiles[i].getAttribute('zoom');\n        if(!tiles[i].getAttribute('zoom')) lZoom = zoom.nativeZoom;\n        zoom.minNativeZoom = Math.min(zoom.minNativeZoom, lZoom);\n        zoom.maxNativeZoom = Math.max(zoom.maxNativeZoom, lZoom);\n      }\n\n      //hard coded to only natively zoom out 2 levels, any more and too many tiles are going to be loaded in at one time\n      //lagging the users computer\n      zoom.minZoom = zoom.minNativeZoom - 2 <= 0? 0: zoom.minNativeZoom - 2;\n      zoom.maxZoom = maxZoomBound;\n      if(meta.min)zoom.minZoom = +meta.min < (zoom.minNativeZoom - 2)?(zoom.minNativeZoom - 2):+meta.min;\n      if(meta.max)zoom.maxZoom = +meta.max;\n      return zoom;\n    },\n\n    _groupTiles: function (tiles) {\n      let tileMap = {};\n      for (let i=0;i<tiles.length;i++) {\n        let tile = {};\n        tile.row = +tiles[i].getAttribute('row');\n        tile.col = +tiles[i].getAttribute('col');\n        tile.zoom = +tiles[i].getAttribute('zoom') || this.options.nativeZoom;\n        tile.src = tiles[i].getAttribute('src');\n        let tileCode = tile.col+\":\"+tile.row+\":\"+tile.zoom;\n        if(tileCode in tileMap){\n          tileMap[tileCode].push(tile);\n        } else {\n          tileMap[tileCode]=[tile];\n        }\n      }\n      return tileMap;\n    },\n  });\n\n  var mapMLStaticTileLayer = function(options) {\n    return new MapMLStaticTileLayer(options);\n  };\n\n  var MapMLLayerControl = L.Control.Layers.extend({\n      /* removes 'base' layers as a concept */\n      options: {\n        autoZIndex: false,\n        sortLayers: true,\n        sortFunction: function (layerA, layerB) {\n          return layerA.options.zIndex < layerB.options.zIndex ? -1 : (layerA.options.zIndex > layerB.options.zIndex ? 1 : 0);\n        }\n      },\n      initialize: function (overlays, options) {\n          L.setOptions(this, options);\n          \n          // the _layers array contains objects like {layer: layer, name: \"name\", overlay: true}\n          // the array index is the id of the layer returned by L.stamp(layer) which I guess is a unique hash\n          this._layerControlInputs = [];\n          this._layers = [];\n          this._lastZIndex = 0;\n          this._handlingClick = false;\n\n          for (var i in overlays) {\n              this._addLayer(overlays[i], i, true);\n          }\n      },\n      onAdd: function () {\n          this._initLayout();\n          this._map.on('validate', this._validateInput, this);\n          L.DomEvent.on(this.options.mapEl, \"layerchange\", this._validateInput, this);\n          L.DomEvent.on(this._container, 'keydown', this._focusFirstLayer, this._container);\n          this._update();\n          //this._validateExtents();\n          if(this._layers.length < 1 && !this._map._showControls){\n            this._container.setAttribute(\"hidden\",\"\");\n          } else {\n            this._map._showControls = true;\n          }\n          return this._container;\n      },\n      onRemove: function (map) {\n          map.off('validate', this._validateInput, this);\n          L.DomEvent.off(this._container, 'keydown', this._focusFirstLayer, this._container);\n          // remove layer-registerd event handlers so that if the control is not\n          // on the map it does not generate layer events\n          for (var i = 0; i < this._layers.length; i++) {\n            this._layers[i].layer.off('add remove', this._onLayerChange, this);\n            this._layers[i].layer.off('extentload', this._validateInput, this);\n          }\n      },\n      addOrUpdateOverlay: function (layer, name) {\n        var alreadyThere = false;\n        for (var i=0;i<this._layers.length;i++) {\n          if (this._layers[i].layer === layer) {\n            alreadyThere = true;\n            this._layers[i].name = name;\n            // replace the controls with updated controls if necessary.\n            break;\n          }\n        }\n        if (!alreadyThere) {\n          this.addOverlay(layer, name);\n        }\n        if(this._layers.length > 0){\n          this._container.removeAttribute(\"hidden\");\n          this._map._showControls = true;\n        }\n        return (this._map) ? this._update() : this;\n      },\n      removeLayer: function (layer) {\n        L.Control.Layers.prototype.removeLayer.call(this, layer);\n        if(this._layers.length === 0){\n          this._container.setAttribute(\"hidden\", \"\");\n        }\n      },\n      _validateInput: function (e) {\n        for (let i = 0; i < this._layers.length; i++) {\n          if(!this._layers[i].input.labels[0])continue;\n          let label = this._layers[i].input.labels[0].getElementsByTagName(\"span\"),\n              input = this._layers[i].input.labels[0].getElementsByTagName(\"input\");\n          input[0].checked = this._layers[i].layer._layerEl.checked;\n          if(this._layers[i].layer._layerEl.disabled && this._layers[i].layer._layerEl.checked){\n            input[0].closest(\"fieldset\").disabled = true;\n            label[0].style.fontStyle = \"italic\";\n          } else {\n            input[0].closest(\"fieldset\").disabled = false;\n            label[0].style.fontStyle = \"normal\";\n          }\n          // check if an extent is disabled and disable it\n          if(this._layers[i].layer._extent && this._layers[i].layer._extent._mapExtents){\n            for(let j = 0; j < this._layers[i].layer._extent._mapExtents.length; j++){\n              let input = this._layers[i].layer._extent._mapExtents[j].extentAnatomy,\n                  label = input.getElementsByClassName(\"mapml-layer-item-name\")[0];\n              if(this._layers[i].layer._extent._mapExtents[j].disabled && this._layers[i].layer._extent._mapExtents[j].checked){\n                label.style.fontStyle = \"italic\";\n                input.disabled = true;\n              } else {\n                label.style.fontStyle = \"normal\";\n                input.disabled = false;\n              }\n            }\n          }\n        }\n\n      },\n\n      // focus the first layer in the layer control when enter is pressed\n      _focusFirstLayer: function(e){\n        if(e.key === 'Enter' && this.className != 'leaflet-control-layers leaflet-control leaflet-control-layers-expanded'){\n          var elem = this.children[1].children[2].children[0].children[0].children[0].children[0];\n          if(elem) setTimeout(() => elem.focus(), 0);\n          }\n      },\n      \n      _withinZoomBounds: function(zoom, range) {\n          return range.min <= zoom && zoom <= range.max;\n      },\n      _addItem: function (obj) {\n        var layercontrols  =  obj.layer.getLayerUserControlsHTML();\n        // the input is required by Leaflet...\n        obj.input = layercontrols.querySelector('input');\n\n        this._layerControlInputs.push(obj.input);\n      \t\tobj.input.layerId = L.stamp(obj.layer);\n\n        L.DomEvent.on(obj.input, 'click', this._onInputClick, this);\n        // this is necessary because when there are several layers in the\n        // layer control, the response to the last one can be a long time\n        // after the info is first displayed, so we have to go back and\n        // verify the layer element is not disabled and can have an enabled input.\n        obj.layer.on('extentload', this._validateInput, this);\n        this._overlaysList.appendChild(layercontrols);\n        return layercontrols;\n      },\n\n      //overrides collapse and conditionally collapses the panel\n      collapse: function(e){\n        if (\n          e.target.tagName === \"SELECT\" ||\n          e.relatedTarget &&\n          e.relatedTarget.parentElement &&\n          (\n            e.relatedTarget.className === \"mapml-contextmenu mapml-layer-menu\" ||\n            e.relatedTarget.parentElement.className === \"mapml-contextmenu mapml-layer-menu\"\n          ) ||\n          (this._map && this._map.contextMenu._layerMenu.style.display === \"block\")\n        ) return this;\n\n        L.DomUtil.removeClass(this._container, 'leaflet-control-layers-expanded');\n  \t\t  return this;\n      }\n  });\n  var mapMlLayerControl = function (layers, options) {\n  \treturn new MapMLLayerControl(layers, options);\n  };\n\n  const FALLBACK_PROJECTION = \"OSMTILE\";\n  const FALLBACK_CS = \"TILEMATRIX\";\n  const BLANK_TT_TREF = \"mapmltemplatedtileplaceholder\";\n\n  var MapMLFeatures = L.FeatureGroup.extend({\n    /*\n     * M.MapML turns any MapML feature data into a Leaflet layer. Based on L.GeoJSON.\n     */\n      initialize: function (mapml, options) {\n\n        L.setOptions(this, options);\n        if(this.options.static) {\n          this._container = L.DomUtil.create('div', 'leaflet-layer', this.options.pane);\n          // must have leaflet-pane class because of new/changed rule in leaflet.css\n          // info: https://github.com/Leaflet/Leaflet/pull/4597\n          L.DomUtil.addClass(this._container, 'leaflet-pane mapml-vector-container');\n          L.setOptions(this.options.renderer, {pane: this._container});\n        }\n\n        this._layers = {};\n        if(this.options.query){\n          this._mapmlFeatures = mapml.features ? mapml.features: mapml;\n          this.isVisible = true;\n          let native = this._getNativeVariables(mapml);\n          this.options.nativeZoom = native.zoom;\n          this.options.nativeCS = native.cs;\n        }\n        if (mapml && !this.options.query) {\n          let native = this._getNativeVariables(mapml);\n          //needed to check if the feature is static or not, since this method is used by templated also\n          if(!mapml.querySelector('map-extent') && mapml.querySelector('map-feature') && this.options.static){\n            this._features = {};\n            this._staticFeature = true;\n            this.isVisible = true; //placeholder for when this actually gets updated in the future\n            this.zoomBounds = this._getZoomBounds(mapml, native.zoom);\n            this.layerBounds = this._getLayerBounds(mapml);\n            L.extend(this.options, this.zoomBounds);\n          }\n          this.addData(mapml, native.cs, native.zoom);\n          if(this._staticFeature){\n            this._resetFeatures(this._clampZoom(this.options._leafletLayer._map.getZoom()));\n\n            this.options._leafletLayer._map._addZoomLimit(this);\n          }\n        }\n      },\n\n      onAdd: function(map){\n        L.FeatureGroup.prototype.onAdd.call(this, map);\n        if(this._mapmlFeatures)map.on(\"featurepagination\", this.showPaginationFeature, this);\n      },\n\n      onRemove: function(map){\n        if(this._mapmlFeatures){\n          map.off(\"featurepagination\", this.showPaginationFeature, this);\n          delete this._mapmlFeatures;\n          L.DomUtil.remove(this._container);\n        }\n        L.FeatureGroup.prototype.onRemove.call(this, map);\n        this._map.featureIndex.cleanIndex();\n      },\n\n      getEvents: function(){\n        if(this._staticFeature){\n          return {\n            'moveend':this._handleMoveEnd,\n            'zoomend' : this._handleZoomEnd,\n          };\n        }\n        return {\n        };\n      },\n\n\n      showPaginationFeature: function(e){\n        if(this.options.query && this._mapmlFeatures[e.i]){\n          let feature = this._mapmlFeatures[e.i];\n          this.clearLayers();\n          this.addData(feature, this.options.nativeCS, this.options.nativeZoom);\n          e.popup._navigationBar.querySelector(\"p\").innerText = (e.i + 1) + \"/\" + this.options._leafletLayer._totalFeatureCount;\n          e.popup._content.querySelector(\"iframe\").setAttribute(\"sandbox\", \"allow-same-origin allow-forms\");\n          e.popup._content.querySelector(\"iframe\").srcdoc = feature.querySelector(\"map-properties\").innerHTML;\n        }\n      },\n\n      _getNativeVariables: function(mapml){\n        let nativeZoom = (mapml.querySelector && mapml.querySelector(\"map-meta[name=zoom]\") &&\n            +M.metaContentToObject(mapml.querySelector(\"map-meta[name=zoom]\").getAttribute(\"content\")).value) || 0;\n        let nativeCS = (mapml.querySelector && mapml.querySelector(\"map-meta[name=cs]\") &&\n            M.metaContentToObject(mapml.querySelector(\"map-meta[name=cs]\").getAttribute(\"content\")).content) || \"PCRS\";\n        return {zoom:nativeZoom, cs: nativeCS};\n      },\n\n      _handleMoveEnd : function(){\n        let mapZoom = this._map.getZoom(),\n            withinZoom = mapZoom <= this.zoomBounds.maxZoom && mapZoom >= this.zoomBounds.minZoom;   \n        this.isVisible = withinZoom && this._layers && this.layerBounds && \n                          this.layerBounds.overlaps(\n                            M.pixelToPCRSBounds(\n                              this._map.getPixelBounds(),\n                              mapZoom,this._map.options.projection));\n        this._removeCSS();\n      },\n\n      _handleZoomEnd: function(e){\n        let mapZoom = this._map.getZoom();\n        if(mapZoom > this.zoomBounds.maxZoom || mapZoom < this.zoomBounds.minZoom){\n          this.clearLayers();\n          return;\n        }\n        let clampZoom = this._clampZoom(mapZoom);\n        this._resetFeatures(clampZoom);\n      },\n\n      //sets default if any are missing, better to only replace ones that are missing\n      _getLayerBounds : function(container) {\n        if (!container) return null;\n        let cs = FALLBACK_CS,\n            projection = container.querySelector('map-meta[name=projection]') &&\n                      M.metaContentToObject(\n                        container.querySelector('map-meta[name=projection]').getAttribute('content'))\n                        .content.toUpperCase() || FALLBACK_PROJECTION;\n        try{\n\n          let meta = container.querySelector('map-meta[name=extent]') &&\n                      M.metaContentToObject(\n                        container.querySelector('map-meta[name=extent]').getAttribute('content'));\n\n          let zoom = meta.zoom || 0;\n          \n          let metaKeys = Object.keys(meta);\n          for(let i =0;i<metaKeys.length;i++){\n            if(!metaKeys[i].includes(\"zoom\")){\n              cs = M.axisToCS(metaKeys[i].split(\"-\")[2]);\n              break;\n            }\n          }\n          let axes = M.csToAxes(cs);\n          return M.boundsToPCRSBounds(\n                  L.bounds(L.point(+meta[`top-left-${axes[0]}`],+meta[`top-left-${axes[1]}`]),\n                  L.point(+meta[`bottom-right-${axes[0]}`],+meta[`bottom-right-${axes[1]}`])),\n                  zoom,projection,cs);\n        } catch (error){\n          //if error then by default set the layer to osm and bounds to the entire map view\n          return M.boundsToPCRSBounds(M[projection].options.crs.tilematrix.bounds(0),0,projection, cs);\n        }\n      },\n\n      _resetFeatures : function (zoom){\n        this.clearLayers();\n        // since features are removed and re-added by zoom level, need to clean the feature index before re-adding\n        if(this._map) this._map.featureIndex.cleanIndex();\n        if(this._features && this._features[zoom]){\n          for(let k =0;k < this._features[zoom].length;k++){\n            this.addLayer(this._features[zoom][k]);\n          }\n        }\n      },\n\n      _clampZoom : function(zoom){\n        if(zoom > this.zoomBounds.maxZoom || zoom < this.zoomBounds.minZoom) return zoom;\n        if (undefined !== this.zoomBounds.minNativeZoom && zoom < this.zoomBounds.minNativeZoom) {\n          return this.zoomBounds.minNativeZoom;\n        }\n        if (undefined !== this.zoomBounds.maxNativeZoom && this.zoomBounds.maxNativeZoom < zoom) {\n          return this.zoomBounds.maxNativeZoom;\n        }\n\n        return zoom;\n      },\n\n      _setZoomTransform: function(center, clampZoom){\n        var scale = this._map.getZoomScale(this._map.getZoom(),clampZoom),\n  \t\t    translate = center.multiplyBy(scale)\n  \t\t        .subtract(this._map._getNewPixelOrigin(center, this._map.getZoom())).round();\n\n        if (any3d) {\n          L.setTransform(this._layers[clampZoom], translate, scale);\n        } else {\n          L.setPosition(this._layers[clampZoom], translate);\n        }\n      },\n\n      _getZoomBounds: function(container, nativeZoom){\n        if (!container) return null;\n        let nMin = 100,nMax=0, features = container.getElementsByTagName('map-feature'),meta,projection;\n        for(let i =0;i<features.length;i++){\n          let lZoom = +features[i].getAttribute('zoom');\n          if(!features[i].getAttribute('zoom'))lZoom = nativeZoom;\n          nMax = Math.max(nMax, lZoom);\n          nMin = Math.min(nMin, lZoom);\n        }\n        try{\n          projection = M.metaContentToObject(container.querySelector('map-meta[name=projection]').getAttribute('content')).content;\n          meta = M.metaContentToObject(container.querySelector('map-meta[name=zoom]').getAttribute('content'));\n        } catch(error){\n          return {\n            minZoom:0,\n            maxZoom: M[projection || FALLBACK_PROJECTION].options.resolutions.length - 1,\n            minNativeZoom:nMin,\n            maxNativeZoom:nMax\n          };\n        }\n        return {\n          minZoom:+meta.min ,\n          maxZoom:+meta.max ,\n          minNativeZoom:nMin,\n          maxNativeZoom:nMax\n        };\n      },\n\n      addData: function (mapml, nativeCS, nativeZoom) {\n        var features = mapml.nodeType === Node.DOCUMENT_NODE || mapml.nodeName === \"LAYER-\" ? mapml.getElementsByTagName(\"map-feature\") : null,\n            i, len, feature;\n\n        var linkedStylesheets = mapml.nodeType === Node.DOCUMENT_NODE ? mapml.querySelector(\"map-link[rel=stylesheet],map-style\") : null;\n        if (linkedStylesheets) {\n          var base = mapml.querySelector('map-base') && mapml.querySelector('map-base').hasAttribute('href') ? \n              new URL(mapml.querySelector('map-base').getAttribute('href')).href : \n              mapml.URL;\n          M.parseStylesheetAsHTML(mapml,base,this._container);\n        }\n        if (features) {\n         for (i = 0, len = features.length; i < len; i++) {\n          // Only add this if geometry is set and not null\n          feature = features[i];\n          var geometriesExist = feature.getElementsByTagName(\"map-geometry\").length && feature.getElementsByTagName(\"map-coordinates\").length;\n          if (geometriesExist) {\n           this.addData(feature, nativeCS, nativeZoom);\n          }\n         }\n         return this; //if templated this runs\n        }\n\n        //if its a mapml with no more links this runs\n        var options = this.options;\n\n        if (options.filter && !options.filter(mapml)) { return; }\n        \n        if (mapml.classList.length) {\n          options.className = mapml.classList.value;\n        }\n        let zoom = mapml.getAttribute(\"zoom\") || nativeZoom, title = mapml.querySelector(\"map-featurecaption\");\n        title = title ? title.innerHTML : \"Feature\";\n\n        if(mapml.querySelector(\"map-properties\")) {\n          options.properties = document.createElement('div');\n          options.properties.classList.add(\"mapml-popup-content\");\n          options.properties.insertAdjacentHTML('afterbegin', mapml.querySelector(\"map-properties\").innerHTML);\n        }\n\n        let layer = this.geometryToLayer(mapml, options, nativeCS, +zoom, title);\n        if (layer) {\n          // if the layer is being used as a query handler output, it will have\n          // a color option set.  Otherwise, copy classes from the feature\n          if (!layer.options.color && mapml.hasAttribute('class')) {\n            layer.options.className = mapml.getAttribute('class');\n          }\n          layer.defaultOptions = layer.options;\n          this.resetStyle(layer);\n\n          if (options.onEachFeature) {\n            layer.bindTooltip(title, { interactive:true, sticky: true, });\n          }\n          if(this._staticFeature){\n            let featureZoom = mapml.getAttribute('zoom') || nativeZoom;\n            if(featureZoom in this._features){\n              this._features[featureZoom].push(layer);\n            } else {\n              this._features[featureZoom]=[layer];\n            }\n            return;\n          } else {\n            return this.addLayer(layer);\n          }\n        }\n      },\n          \n      resetStyle: function (layer) {\n        var style = this.options.style;\n        if (style) {\n         // reset any custom styles\n         L.Util.extend(layer.options, layer.defaultOptions);\n         this._setLayerStyle(layer, style);\n        }\n      },\n\n      setStyle: function (style) {\n        this.eachLayer(function (layer) {\n          this._setLayerStyle(layer, style);\n        }, this);\n      },\n\n      _setLayerStyle: function (layer, style) {\n        if (typeof style === 'function') {\n          style = style(layer.feature);\n        }\n        if (layer.setStyle) {\n          layer.setStyle(style);\n        }\n      },\n      _removeCSS: function(){\n        let toDelete = this._container.querySelectorAll(\"link[rel=stylesheet],style\");\n        for(let i = 0; i < toDelete.length;i++){\n          this._container.removeChild(toDelete[i]);\n        }\n      },\n    geometryToLayer: function (mapml, vectorOptions, nativeCS, zoom, title) {\n      let geometry = mapml.tagName.toUpperCase() === 'MAP-FEATURE' ? mapml.getElementsByTagName('map-geometry')[0] : mapml,\n          cs = geometry?.getAttribute(\"cs\") || nativeCS, group = [], svgGroup = L.SVG.create('g'), copyOptions = Object.assign({}, vectorOptions);\n      if (geometry) {\n        for(let geo of geometry.querySelectorAll('map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint')){\n          group.push(M.feature(geo, Object.assign(copyOptions,\n            { nativeCS: cs,\n              nativeZoom: zoom,\n              projection: this.options.projection,\n              featureID: mapml.id,\n              group: svgGroup,\n              wrappers: this._getGeometryParents(geo.parentElement),\n              featureLayer: this,\n              _leafletLayer: this.options._leafletLayer,\n            })));\n        }\n        let groupOptions = {group:svgGroup, featureID: mapml.id, accessibleTitle: title, onEachFeature: vectorOptions.onEachFeature, properties: vectorOptions.properties, _leafletLayer: this.options._leafletLayer,},\n          collections = geometry.querySelector('map-multipolygon') || geometry.querySelector('map-geometrycollection');\n          if(collections) groupOptions.wrappers = this._getGeometryParents(collections.parentElement);\n\n        return M.featureGroup(group, groupOptions);\n      }\n    },\n\n    _getGeometryParents: function(subType, elems = []){\n      if(subType && subType.tagName.toUpperCase() !== \"MAP-GEOMETRY\"){\n        if(subType.tagName.toUpperCase() === \"MAP-MULTIPOLYGON\" || subType.tagName.toUpperCase() === \"MAP-GEOMETRYCOLLECTION\")\n          return this._getGeometryParents(subType.parentElement, elems);\n        return this._getGeometryParents(subType.parentElement, elems.concat([subType]));\n      } else {\n        return elems;\n      }\n    },\n  });\n  var mapMlFeatures = function (mapml, options) {\n  \treturn new MapMLFeatures(mapml, options);\n  };\n\n  var TemplatedTileLayer = L.TileLayer.extend({\n      // a TemplateTileLayer is similar to a L.TileLayer except its templates are\n      // defined by the <map-extent><template/></map-extent>\n      // content found in the MapML document.  As such, the client map does not\n      // 'revisit' the server for more MapML content, it simply fills the map extent\n      // with tiles for which it generates requests on demand (as the user pans/zooms/resizes\n      // the map)\n      initialize: function(template, options) {\n        // _setUpTileTemplateVars needs options.crs, not available unless we set\n        // options first...\n        let inputData = M.extractInputBounds(template);\n        this.zoomBounds = inputData.zoomBounds;\n        this.extentBounds=inputData.bounds;\n        this.isVisible = true;\n        L.extend(options, this.zoomBounds);\n        options.tms = template.tms;\n        delete options.opacity;\n        L.setOptions(this, options);\n        this._setUpTileTemplateVars(template);\n\n        if (template.tile.subdomains) {\n          L.setOptions(this, L.extend(this.options, {subdomains: template.tile.subdomains}));\n        }\n        this._template = template;\n        this._initContainer();\n        // call the parent constructor with the template tref value, per the \n        // Leaflet tutorial: http://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n        L.TileLayer.prototype.initialize.call(this, template.template, L.extend(options, {pane: this._container}));\n      },\n      onAdd : function(){\n        this._map._addZoomLimit(this);\n        L.TileLayer.prototype.onAdd.call(this,this._map);\n        this._handleMoveEnd();\n      },\n\n      getEvents: function(){\n        let events = L.TileLayer.prototype.getEvents.call(this,this._map);\n        this._parentOnMoveEnd = events.moveend;\n        events.moveend = this._handleMoveEnd;\n        return events;\n      },\n\n      _initContainer: function () {\n        if (this._container) { return; }\n\n        this._container = L.DomUtil.create('div', 'leaflet-layer', this.options.pane);\n        L.DomUtil.addClass(this._container,'mapml-templated-tile-container');\n        this._updateZIndex();\n      },\n      _handleMoveEnd : function(e){\n        let mapZoom = this._map.getZoom();\n        let mapBounds = M.pixelToPCRSBounds(this._map.getPixelBounds(),mapZoom,this._map.options.projection);\n        this.isVisible = mapZoom <= this.options.maxZoom && mapZoom >= this.options.minZoom && \n                          this.extentBounds.overlaps(mapBounds);\n          if(!(this.isVisible))return;\n        this._parentOnMoveEnd();\n      },\n      createTile: function (coords) {\n        let tileGroup = document.createElement(\"DIV\"),\n            tileSize = this.getTileSize();\n        L.DomUtil.addClass(tileGroup, \"mapml-tile-group\");\n        L.DomUtil.addClass(tileGroup, \"leaflet-tile\");\n\n        this._template.linkEl.dispatchEvent(new CustomEvent('tileloadstart', {\n          detail:{\n            x:coords.x,\n            y:coords.y,\n            zoom:coords.z,\n            appendTile: (elem)=>{tileGroup.appendChild(elem);},\n          },\n        }));\n\n        if (this._template.type.startsWith('image/')) {\n          let tile = L.TileLayer.prototype.createTile.call(this, coords, function(){});\n          tile.width = tileSize.x;\n          tile.height = tileSize.y;\n          tileGroup.appendChild(tile);\n        } else if(!this._url.includes(BLANK_TT_TREF)) {\n          // tiles of type=\"text/mapml\" will have to fetch content while creating\n          // the tile here, unless there can be a callback associated to the element\n          // that will render the content in the alread-placed tile\n          // var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n          this._fetchTile(coords, tileGroup);\n        }\n        return tileGroup;\n      },\n      _mapmlTileReady: function(tile) {\n          L.DomUtil.addClass(tile,'leaflet-tile-loaded');\n      },\n      // instead of being child of a pane, the TemplatedTileLayers are 'owned' by the group,\n      // and so are DOM children of the group, not the pane element (the MapMLLayer is\n      // a child of the overlay pane and always has a set of sub-layers)\n      getPane: function() {\n        return this.options.pane;\n      },\n      _fetchTile:  function (coords, tile) {\n         fetch(this.getTileUrl(coords),{redirect: 'follow'}).then(\n            function(response) {\n              if (response.status >= 200 && response.status < 300) {\n                return Promise.resolve(response);\n              } else {\n                console.log('Looks like there was a problem. Status Code: ' + response.status);\n                return Promise.reject(response);\n              }\n            }).then(function(response) {\n              return response.text();\n            }).then(text => {\n              var parser = new DOMParser();\n                  return parser.parseFromString(text, \"application/xml\");\n            }).then(mapml => {\n              this._createFeatures(mapml, coords, tile);\n              this._mapmlTileReady(tile);\n            }).catch(err => {console.log(\"Error Creating Tile\");});\n      },\n\n      _createFeatures: function(markup, coords, tile){\n        let stylesheets = markup.querySelector('map-link[rel=stylesheet],map-style');\n        if (stylesheets) {\n          let base = markup.querySelector('map-base') && markup.querySelector('map-base').hasAttribute('href') ?\n            new URL(markup.querySelector('map-base').getAttribute('href')).href :\n            markup.URL;\n          M.parseStylesheetAsHTML(markup,base,tile);\n        }\n\n        let svg = L.SVG.create('svg'), g = L.SVG.create('g'), tileSize = this._map.options.crs.options.crs.tile.bounds.max.x,\n            xOffset = coords.x * tileSize, yOffset = coords.y * tileSize;\n\n        let tileFeatures = M.mapMlFeatures(markup, {\n          projection: this._map.options.projection,\n          static: false,\n          interactive: false,\n        });\n\n        for(let groupID in tileFeatures._layers){\n          for(let featureID in tileFeatures._layers[groupID]._layers){\n            let layer = tileFeatures._layers[groupID]._layers[featureID];\n            M.FeatureRenderer.prototype._initPath(layer, false);\n            layer._project(this._map, L.point([xOffset, yOffset]), coords.z);\n            M.FeatureRenderer.prototype._addPath(layer, g, false);\n            M.FeatureRenderer.prototype._updateFeature(layer);\n          }\n        }\n        svg.setAttribute('width', tileSize.toString());\n        svg.setAttribute('height', tileSize.toString());\n        svg.appendChild(g);\n        tile.appendChild(svg);\n      },\n\n      getTileUrl: function (coords) {\n          if (coords.z >= this._template.tilematrix.bounds.length || \n                  !this._template.tilematrix.bounds[coords.z].contains(coords)) {\n            return '';\n          }\n          var obj = {};\n          obj[this._template.tilematrix.col.name] = coords.x;\n          obj[this._template.tilematrix.row.name] = coords.y;\n          obj[this._template.zoom.name] = this._getZoomForUrl();\n          obj[this._template.pcrs.easting.left] = this._tileMatrixToPCRSPosition(coords, 'top-left').x;\n          obj[this._template.pcrs.easting.right] = this._tileMatrixToPCRSPosition(coords, 'top-right').x;\n          obj[this._template.pcrs.northing.top] = this._tileMatrixToPCRSPosition(coords, 'top-left').y;\n          obj[this._template.pcrs.northing.bottom] = this._tileMatrixToPCRSPosition(coords, 'bottom-left').y;\n          obj[this._template.tile.server] = this._getSubdomain(coords);\n          for (var v in this._template.tile) {\n              if ([\"row\",\"col\",\"zoom\",\"left\",\"right\",\"top\",\"bottom\"].indexOf(v) < 0) {\n                  obj[v] = this._template.tile[v];\n              }\n          }\n          if (this._map && !this._map.options.crs.infinite) {\n            let invertedY = this._globalTileRange.max.y - coords.y;\n            if (this.options.tms) {\n              obj[this._template.tilematrix.row.name] = invertedY;\n            }\n            //obj[`-${this._template.tilematrix.row.name}`] = invertedY; //leaflet has this but I dont see a use in storing row and -row as it doesnt follow that pattern\n          }\n          obj.r = this.options.detectRetina && L.Browser.retina && this.options.maxZoom > 0 ? '@2x' : '';\n          return L.Util.template(this._url, obj);\n      },\n      _tileMatrixToPCRSPosition: function (coords, pos) {\n  // this is a tile:\n  // \n  //   top-left         top-center           top-right\n  //      +------------------+------------------+\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      + center-left    center               + center-right\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      +------------------+------------------+\n  //   bottom-left     bottom-center      bottom-right\n\n    var map = this._map,\n        crs = map.options.crs,\n        tileSize = this.getTileSize(),\n\n        nwPoint = coords.scaleBy(tileSize),\n        sePoint = nwPoint.add(tileSize),\n        centrePoint = nwPoint.add(Math.floor(tileSize / 2)),\n\n        nw = crs.transformation.untransform(nwPoint,crs.scale(coords.z)),\n        se = crs.transformation.untransform(sePoint,crs.scale(coords.z)),\n        cen = crs.transformation.untransform(centrePoint, crs.scale(coords.z)),\n        result = null;\n\n        switch (pos) {\n          case('top-left'):\n            result = nw;\n            break;\n          case('bottom-left'):\n            result = new L.Point(nw.x,se.y);\n            break;\n          case('center-left'):\n            result = new L.Point(nw.x,cen.y);\n            break;\n          case('top-right'):\n            result = new L.Point(se.x,nw.y);\n            break;\n          case('bottom-right'):\n            result = se;\n            break;\n          case('center-right'):\n            result = new L.Point(se.x,cen.y);\n            break;\n          case('top-center'):\n            result = new L.Point(cen.x,nw.y);\n            break;\n          case('bottom-center'):\n            result = new L.Point(cen.x,se.y);\n            break;\n          case('center'):\n            result = cen;\n            break;\n        }\n        return result;\n      },\n      _setUpTileTemplateVars: function(template) {\n        // process the inputs associated to template and create an object named\n        // tile with member properties as follows:\n        // {row: 'rowvarname', \n        //  col: 'colvarname', \n        //  left: 'leftvarname', \n        //  right: 'rightvarname', \n        //  top: 'topvarname', \n        //  bottom: 'bottomvarname'}\n        template.tile = {};\n        var inputs = template.values,\n            crs = this.options.crs.options,\n            zoom, east, north, row, col;\n        \n        for (var i=0;i<template.values.length;i++) {\n          var type = inputs[i].getAttribute(\"type\"), \n              units = inputs[i].getAttribute(\"units\"), \n              axis = inputs[i].getAttribute(\"axis\"), \n              name = inputs[i].getAttribute(\"name\"), \n              position = inputs[i].getAttribute(\"position\"),\n              shard = (type === \"hidden\" && inputs[i].hasAttribute(\"shard\")),\n              select = (inputs[i].tagName.toLowerCase() === \"map-select\"),\n              value = inputs[i].getAttribute(\"value\"),\n              min = inputs[i].getAttribute(\"min\"),\n              max = inputs[i].getAttribute(\"max\");\n          if (type === \"location\" && units === \"tilematrix\") {\n            switch (axis) {\n              case(\"column\"):\n                col = {\n                  name: name,\n                  min: crs.crs.tilematrix.horizontal.min,\n                  max: crs.crs.tilematrix.horizontal.max(crs.resolutions.length-1)\n                };\n                if (!isNaN(Number.parseFloat(min))) {\n                  col.min = Number.parseFloat(min);\n                }\n                if (!isNaN(Number.parseFloat(max))) {\n                  col.max = Number.parseFloat(max);\n                }\n                break;\n              case(\"row\"):\n                row = {\n                  name: name,\n                  min: crs.crs.tilematrix.vertical.min,\n                  max:  crs.crs.tilematrix.vertical.max(crs.resolutions.length-1)\n                };\n                if (!isNaN(Number.parseFloat(min))) {\n                  row.min = Number.parseFloat(min);\n                }\n                if (!isNaN(Number.parseFloat(max))) {\n                  row.max = Number.parseFloat(max);\n                }\n                break;\n              case('longitude'):\n              case(\"easting\"):\n                if (!east) {\n                  east = {\n                    min: crs.crs.pcrs.horizontal.min,\n                    max: crs.crs.pcrs.horizontal.max\n                  };\n                }\n                if (!isNaN(Number.parseFloat(min))) {\n                  east.min = Number.parseFloat(min);\n                }\n                if (!isNaN(Number.parseFloat(max))) {\n                  east.max = Number.parseFloat(max);\n                }\n                if (position) {\n                  if (position.match(/.*?-left/i)) {\n                    east.left = name;\n                  } else if (position.match(/.*?-right/i)) {\n                    east.right = name;\n                  }\n                }\n                break;\n              case('latitude'):\n              case(\"northing\"):\n                if (!north) {\n                  north = {\n                    min: crs.crs.pcrs.vertical.min,\n                    max: crs.crs.pcrs.vertical.max\n                  };\n                }\n                if (!isNaN(Number.parseFloat(min))) {\n                  north.min = Number.parseFloat(min);\n                }\n                if (!isNaN(Number.parseFloat(max))) {\n                  north.max = Number.parseFloat(max);\n                }\n                if (position) {\n                  if (position.match(/top-.*?/i)) {\n                    north.top = name;\n                  } else if (position.match(/bottom-.*?/i)) {\n                    north.bottom = name;\n                  }\n                } \n                break;\n                // unsuportted axis value\n            }\n          } else if (type && type.toLowerCase() === \"zoom\") {\n            //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n             zoom = {\n               name: name,\n               min: 0, \n               max: crs.resolutions.length,\n               value: crs.resolutions.length \n             };\n             if (!isNaN(Number.parseInt(value,10)) && \n                     Number.parseInt(value,10) >= zoom.min && \n                     Number.parseInt(value,10) <= zoom.max) {\n               zoom.value = Number.parseInt(value,10);\n             } else {\n               zoom.value = zoom.max;\n             }\n             if (!isNaN(Number.parseInt(min,10)) && \n                     Number.parseInt(min,10) >= zoom.min && \n                     Number.parseInt(min,10) <= zoom.max) {\n               zoom.min = Number.parseInt(min,10);\n             }\n             if (!isNaN(Number.parseInt(max,10)) && \n                     Number.parseInt(max,10) >= zoom.min && \n                     Number.parseInt(max,10) <= zoom.max) {\n               zoom.max = Number.parseInt(max,10);\n             }\n             template.zoom = zoom;\n          } else if (shard) {\n            template.tile.server = name;\n            template.tile.subdomains = inputs[i].servers.slice();\n          } else if (select) {\n              /*jshint -W104 */\n            const parsedselect = inputs[i].htmlselect;\n            template.tile[name] = function() {\n                return parsedselect.value;\n            };\n          } else {\n             // needs to be a const otherwise it gets overwritten\n            /*jshint -W104 */\n            const input = inputs[i];\n            template.tile[name] = function () {\n                return input.getAttribute(\"value\");\n            };\n          }\n        }\n        var transformation = this.options.crs.transformation,\n            tileSize = this.options.crs.options.crs.tile.bounds.max.x,\n            scale = L.bind(this.options.crs.scale, this.options.crs),\n        pcrs2tilematrix = function(c,zoom) {\n          return transformation.transform(c, scale(zoom)).divideBy(tileSize).floor();\n        };\n        if (east && north) {\n          \n          template.pcrs = {};\n          template.pcrs.bounds = L.bounds([east.min,north.min],[east.max,north.max]);\n          template.pcrs.easting = east;\n          template.pcrs.northing = north;\n          \n        } else if ( col && row && !isNaN(zoom.value)) {\n            \n            // convert the tile bounds at this zoom to a pcrs bounds, then \n            // go through the zoom min/max and create a tile-based bounds\n            // at each zoom that applies to the col/row values that constrain what tiles\n            // will be requested so that we don't generate too many 404s\n            if (!template.pcrs) {\n              template.pcrs = {};\n              template.pcrs.easting = '';\n              template.pcrs.northing = '';\n            }\n            \n            template.pcrs.bounds =  M.boundsToPCRSBounds(\n                        L.bounds(L.point([col.min,row.min]),\n                        L.point([col.max,row.max])),\n                        zoom.value, this.options.crs, M.axisToCS(\"column\"));\n            \n            template.tilematrix = {};\n            template.tilematrix.col = col;\n            template.tilematrix.row = row;\n\n        } else {\n          console.log('Unable to determine bounds for tile template: ' + template.template);\n        }\n        \n        if (!template.tilematrix) {\n          template.tilematrix = {};\n          template.tilematrix.col = {};\n          template.tilematrix.row = {};\n        }\n        template.tilematrix.bounds = [];\n        var pcrsBounds = template.pcrs.bounds;\n        // the template should _always_ have a zoom, because we force it to\n        // by first processing the extent to determine the zoom and if none, adding\n        // one and second by copying that zoom into the set of template variable inputs\n        // even if it is not referenced by one of the template's variable references\n        var zmin = template.zoom?template.zoom.min:0,\n            zmax = template.zoom?template.zoom.max:crs.resolutions.length;\n        for (var z=0; z <= zmax; z++) {\n          template.tilematrix.bounds[z] = (z >= zmin ?\n              L.bounds(pcrs2tilematrix(pcrsBounds.min,z),\n                pcrs2tilematrix(pcrsBounds.max,z)) :\n                        L.bounds(L.point([-1,-1]),L.point([-1,-1])));\n        }\n      },\n      _clampZoom: function (zoom) {\n          let clamp = L.GridLayer.prototype._clampZoom.call(this, zoom);\n          if(this._template.step > this.zoomBounds.maxNativeZoom) this._template.step = this.zoomBounds.maxNativeZoom;\n\n          if(zoom !== clamp){\n              zoom = clamp;\n          } else {\n              if(zoom % this._template.step !== 0){\n                  zoom = Math.floor(zoom / this._template.step) * this._template.step;\n              }\n          }\n          return zoom;\n      },\n  });\n  var templatedTileLayer = function(template, options) {\n    return new TemplatedTileLayer(template, options);\n  };\n\n  var TemplatedLayer = L.Layer.extend({\n    initialize: function(templates, options) {\n      this._templates =  templates;\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n      this._container.style.opacity = this.options.opacity;\n      L.DomUtil.addClass(this._container,'mapml-templatedlayer-container');\n\n      for (var i=0;i<templates.length;i++) {\n        if (templates[i].rel === 'tile') {\n            this.setZIndex(options.extentZIndex);\n            this._templates[i].layer = M.templatedTileLayer(templates[i], \n              L.Util.extend(options, {errorTileUrl: \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\", zIndex: options.extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'image') {\n            this.setZIndex(options.extentZIndex);\n            this._templates[i].layer = M.templatedImageLayer(templates[i], L.Util.extend(options, {zIndex: options.extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'features') {\n            this.setZIndex(options.extentZIndex);\n            this._templates[i].layer = M.templatedFeaturesLayer(templates[i], L.Util.extend(options, {zIndex: options.extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'query') {\n            // add template to array of queryies to be added to map and processed\n            // on click/tap events\n            this.hasSetBoundsHandler = true;\n            if (!this._queries) {\n              this._queries = [];\n            }\n            let inputData = M.extractInputBounds(templates[i]);\n            templates[i].extentBounds = inputData.bounds;\n            templates[i].zoomBounds = inputData.zoomBounds;\n            this._queries.push(L.extend(templates[i], this._setupQueryVars(templates[i])));\n        }\n      }\n    },\n    getEvents: function() {\n        return {\n            zoomstart: this._onZoomStart\n        };\n    },\n    redraw: function() {\n      this.closePopup();\n      for (var i=0;i<this._templates.length;i++) {\n        if (this._templates[i].rel === 'tile' || this._templates[i].rel === 'image' || this._templates[i].rel === 'features') {\n            this._templates[i].layer.redraw();\n        }\n      }\n    },\n    _onZoomStart: function() {\n        this.closePopup();\n    },\n\n    _setupQueryVars: function(template) {\n        // process the inputs associated to template and create an object named\n        // query with member properties as follows:\n        // {width: 'widthvarname', \n        //  height: 'heightvarname', \n        //  left: 'leftvarname', \n        //  right: 'rightvarname', \n        //  top: 'topvarname', \n        //  bottom: 'bottomvarname'\n        //  i: 'ivarname'\n        //  j: 'jvarname'}\n        //  x: 'xvarname' x being the tcrs x axis\n        //  y: 'yvarname' y being the tcrs y axis\n        //  z: 'zvarname' zoom\n        //  title: link title\n\n        var queryVarNames = {query:{}},\n            inputs = template.values;\n        \n        for (var i=0;i<template.values.length;i++) {\n          var type = inputs[i].getAttribute(\"type\"), \n              units = inputs[i].getAttribute(\"units\"), \n              axis = inputs[i].getAttribute(\"axis\"), \n              name = inputs[i].getAttribute(\"name\"), \n              position = inputs[i].getAttribute(\"position\"),\n              rel = inputs[i].getAttribute(\"rel\"),\n              select = (inputs[i].tagName.toLowerCase() === \"map-select\");\n          if (type === \"width\") {\n                queryVarNames.query.width = name;\n          } else if ( type === \"height\") {\n                queryVarNames.query.height = name;\n          } else if (type === \"location\") { \n            switch (axis) {\n              case('x'):\n              case('y'):\n              case(\"column\"): \n              case(\"row\"):\n                queryVarNames.query[axis] = name;\n                break;\n              case ('longitude'):\n              case ('easting'):\n                if (position) {\n                    if (position.match(/.*?-left/i)) {\n                      if (rel === \"pixel\") {\n                        queryVarNames.query.pixelleft = name;\n                      } else if (rel === \"tile\") {\n                        queryVarNames.query.tileleft = name;\n                      } else {\n                        queryVarNames.query.mapleft = name;\n                      }\n                    } else if (position.match(/.*?-right/i)) {\n                      if (rel === \"pixel\") {\n                        queryVarNames.query.pixelright = name;\n                      } else if (rel === \"tile\") {\n                        queryVarNames.query.tileright = name;\n                      } else {\n                        queryVarNames.query.mapright = name;\n                      }\n                    }\n                } else {\n                    queryVarNames.query[axis] = name;\n                }\n                break;\n              case ('latitude'):\n              case ('northing'):\n                if (position) {\n                    if (position.match(/top-.*?/i)) {\n                      if (rel === \"pixel\") {\n                        queryVarNames.query.pixeltop = name;\n                      } else if (rel === \"tile\") {\n                        queryVarNames.query.tiletop = name;\n                      } else {\n                        queryVarNames.query.maptop = name;\n                      }\n                    } else if (position.match(/bottom-.*?/i)) {\n                      if (rel === \"pixel\") {\n                        queryVarNames.query.pixelbottom = name;\n                      } else if (rel === \"tile\") {\n                        queryVarNames.query.tilebottom = name;\n                      } else {\n                        queryVarNames.query.mapbottom = name;\n                      }\n                    }\n                } else {\n                  queryVarNames.query[axis] = name;\n                }\n                break;\n              case('i'):\n                if (units === \"tile\") {\n                  queryVarNames.query.tilei = name;\n                } else {\n                  queryVarNames.query.mapi = name;\n                }\n                break;\n              case('j'):\n                if (units === \"tile\") {\n                  queryVarNames.query.tilej = name;\n                } else {\n                  queryVarNames.query.mapj = name;\n                }\n                break;\n                // unsuportted axis value\n            }\n          } else if (type === \"zoom\") {\n            //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n             queryVarNames.query.zoom = name;\n          } else if (select) {\n              /*jshint -W104 */\n            const parsedselect = inputs[i].htmlselect;\n            queryVarNames.query[name] = function() {\n                return parsedselect.value;\n            };\n          } else {\n              /*jshint -W104 */\n              const input = inputs[i];\n             queryVarNames.query[name] = function () {\n                return input.getAttribute(\"value\");\n             };\n          }\n        }\n        queryVarNames.query.title = template.title;\n        return queryVarNames;\n    },\n    reset: function (templates, extentZIndex) {\n      if (!templates) {return;}\n      if (!this._map) {return;}\n      var addToMap = this._map && this._map.hasLayer(this),\n          old_templates = this._templates;\n      delete this._queries;\n      this._map.off('click', null, this);\n\n      this._templates = templates;\n      for (var i=0;i<templates.length;i++) {\n        if (templates[i].rel === 'tile') {\n            this._templates[i].layer = M.templatedTileLayer(templates[i],\n              L.Util.extend(this.options, {errorTileUrl: \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\", zIndex: extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'image') {\n            this._templates[i].layer = M.templatedImageLayer(templates[i], L.Util.extend(this.options, {zIndex: extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'features') {\n            this._templates[i].layer = M.templatedFeaturesLayer(templates[i], L.Util.extend(this.options, {zIndex: extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'query') {\n            if (!this._queries) {\n              this._queries = [];\n            }\n            this._queries.push(L.extend(templates[i], this._setupQueryVars(templates[i])));\n        }\n        if (addToMap) {\n          this.onAdd(this._map);\n        }\n      }\n      for (i=0;i<old_templates.length;i++) {\n        if (this._map.hasLayer(old_templates[i].layer)) {\n          this._map.removeLayer(old_templates[i].layer);\n        }\n      }\n    },\n    onAdd: function (map) {\n      for (var i=0;i<this._templates.length;i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.addLayer(this._templates[i].layer);\n        }\n      }\n    },\n    //addTo: function(map) {\n      //for(let i = 0; i < this._templates.length; i++){\n    //    this._templates[0].layer.addTo(map);\n      //}\n    //},\n    setZIndex: function (zIndex) {\n        this.options.zIndex = zIndex;\n        this._updateZIndex();\n\n        return this;\n    },\n    _updateZIndex: function () {\n        if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n            this._container.style.zIndex = this.options.zIndex;\n        }\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      for (var i=0;i<this._templates.length;i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.removeLayer(this._templates[i].layer);\n        }\n      }\n    },\n\n    _previousFeature: function(e){\n      if(this._count + -1 >= 0){\n        this._count--;\n        this._map.fire(\"featurepagination\", {i: this._count, popup: this});\n      }\n    },\n    \n    _nextFeature: function(e){\n      if(this._count + 1 < this._source._totalFeatureCount){\n        this._count++;\n        this._map.fire(\"featurepagination\", {i: this._count, popup: this});\n      }\n    },\n\n    changeOpacity: function(opacity){\n      this._container.style.opacity = opacity;\n    },\n\n  });\n  var templatedLayer = function(templates, options) {\n    // templates is an array of template objects\n    // a template object contains the template, plus associated <input> elements\n    // which need to be processed just prior to creating a url from the template \n    // with the values of the inputs\n    return new TemplatedLayer(templates, options);\n  };\n\n  var TemplatedFeaturesLayer =  L.Layer.extend({\n    // this and M.ImageLayer could be merged or inherit from a common parent\n      initialize: function(template, options) {\n        let inputData = M.extractInputBounds(template);\n        this.zoomBounds = inputData.zoomBounds;\n        this.extentBounds=inputData.bounds;\n        this.isVisible = true;\n        this._template = template;\n        this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n        L.extend(options, this.zoomBounds);\n        L.DomUtil.addClass(this._container, 'mapml-features-container');\n        delete options.opacity;\n        L.setOptions(this, L.extend(options,this._setUpFeaturesTemplateVars(template)));\n      },\n      getEvents: function () {\n          var events = {\n              moveend: this._onMoveEnd\n          };\n          return events;\n      },\n      onAdd: function () {\n        this._map._addZoomLimit(this);\n        var opacity = this.options.opacity || 1,\n            container = this._container,\n            map = this._map;\n        if (!this._features) {\n          this._features = M.mapMlFeatures( null, {\n            // pass the vector layer a renderer of its own, otherwise leaflet\n            // puts everything into the overlayPane\n            renderer: M.featureRenderer(),\n            // pass the vector layer the container for the parent into which\n            // it will append its own container for rendering into\n            pane: container,\n            opacity: opacity,\n            projection:map.options.projection,\n            static: true,\n            onEachFeature: function(properties, geometry) {\n              // need to parse as HTML to preserve semantics and styles\n              var c = document.createElement('div');\n              c.classList.add(\"mapml-popup-content\");\n              c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n              geometry.bindPopup(c, {autoClose: false, minWidth: 108});\n            }\n          });\n        }\n\n        map.fire('moveend');  // TODO: replace with moveend handler for layer and not entire map\n      },\n      redraw: function() {\n          this._onMoveEnd();\n      },\n\n      _removeCSS: function () {\n          let toDelete = this._container.querySelectorAll(\"link[rel=stylesheet],style\");\n          for(let i = 0; i < toDelete.length;i++){\n              let parent = toDelete[i].parentNode;\n              parent.removeChild(toDelete[i]);\n          }\n      },\n\n      _onMoveEnd: function() {\n        let history = this._map.options.mapEl._history;\n        let current = history[history.length - 1];\n        let previous = history[history.length - 2] ?? current;\n        let step = this._template.step;\n        let mapZoom = this._map.getZoom();\n        let steppedZoom = mapZoom;\n        //If zooming out from one step interval into a lower one or panning, set the stepped zoom\n        if (((step !== \"1\") && ((mapZoom + 1) % step === 0) && current.zoom === previous.zoom - 1) ||\n            (current.zoom === previous.zoom) ||\n            (Math.floor(mapZoom / step) * step !== Math.floor(previous.zoom / step) * step)) {\n            steppedZoom = Math.floor(mapZoom / step) * step;\n        }\n        //No request needed if in a step interval (unless panning)\n        else if(mapZoom % this._template.step !== 0) return;\n\n        let scaleBounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n        let url = this._getfeaturesUrl(steppedZoom, scaleBounds);\n        //No request needed if the current template url is the same as the url to request\n        if(url === this._url) return;\n\n        let mapBounds = M.pixelToPCRSBounds(this._map.getPixelBounds(),mapZoom,this._map.options.projection);\n        this.isVisible = mapZoom <= this.zoomBounds.maxZoom && mapZoom >= this.zoomBounds.minZoom && \n                          this.extentBounds.overlaps(mapBounds);\n        \n        this._features.clearLayers();\n        this._removeCSS();\n        //Leave the layers cleared if the layer is not visible\n        if(!(this.isVisible) && steppedZoom === mapZoom){\n          this._url = \"\";\n          return;\n        }\n\n        // TODO add preference with a bit less weight than that for text/mapml; 0.8 for application/geo+json; 0.6\n        var mapml, headers = new Headers({'Accept': 'text/mapml;q=0.9,application/geo+json;q=0.8'}),\n            parser = new DOMParser(),\n            features = this._features,\n            map = this._map,\n            context = this,\n            MAX_PAGES = 10,\n          _pullFeatureFeed = function (url, limit) {\n            return (fetch (url,{redirect: 'follow',headers: headers})\n                    .then( function (response) {return response.text();})\n                    .then( function (text) {\n                      //TODO wrap this puppy in a try/catch/finally to parse application/geo+json if necessary\n                mapml = parser.parseFromString(text,\"application/xml\");\n                var base = (new URL(mapml.querySelector('map-base') ? mapml.querySelector('map-base').getAttribute('href') : url)).href;\n                url = mapml.querySelector('map-link[rel=next]')? mapml.querySelector('map-link[rel=next]').getAttribute('href') : null;\n                url =  url ? (new URL(url, base)).href: null;\n                // TODO if the xml parser barfed but the response is application/geo+json, use the parent addData method\n              let nativeZoom = mapml.querySelector(\"map-meta[name=zoom]\") &&\n                                +M.metaContentToObject(mapml.querySelector(\"map-meta[name=zoom]\").getAttribute(\"content\")).value || 0;\n              let nativeCS = mapml.querySelector(\"map-meta[name=cs]\") &&\n                                M.metaContentToObject(mapml.querySelector(\"map-meta[name=cs]\").getAttribute(\"content\")).content || \"GCRS\";\n              features.addData(mapml, nativeCS, nativeZoom);\n              if (url && --limit) {\n                return _pullFeatureFeed(url, limit);\n              }\n            }));\n          };\n\n        this._url = url;\n        _pullFeatureFeed(url, MAX_PAGES)\n          .then(function() { \n            map.addLayer(features);\n            //Fires event for feature index overlay\n            map.fire(\"templatedfeatureslayeradd\");\n            M.TemplatedFeaturesLayer.prototype._updateTabIndex(context);\n          })\n          .catch(function (error) { console.log(error);});\n      },\n      setZIndex: function (zIndex) {\n          this.options.zIndex = zIndex;\n          this._updateZIndex();\n          return this;\n      },\n      _updateTabIndex: function(context){\n        let c = context || this;\n        for(let layerNum in c._features._layers){\n          let layer = c._features._layers[layerNum];\n          if(layer._path){\n            if(layer._path.getAttribute(\"d\") !== \"M0 0\"){\n              layer._path.setAttribute(\"tabindex\", 0);\n            } else {\n              layer._path.removeAttribute(\"tabindex\");\n            }\n            if(layer._path.childElementCount === 0) {\n              let title = document.createElement(\"title\");\n              title.innerText = \"Feature\";\n              layer._path.appendChild(title);\n            }\n          }\n        }\n      },\n      _updateZIndex: function () {\n          if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n              this._container.style.zIndex = this.options.zIndex;\n          }\n      },\n      onRemove: function () {\n        this._map.removeLayer(this._features);\n      },\n      _getfeaturesUrl: function(zoom, bounds) {\n          if(zoom === undefined) zoom = this._map.getZoom();\n          if(bounds === undefined) bounds = this._map.getPixelBounds();\n          var obj = {};\n          if (this.options.feature.zoom) {\n            obj[this.options.feature.zoom] = zoom;\n          }\n          if (this.options.feature.width) {\n            obj[this.options.feature.width] = this._map.getSize().x;\n          }\n          if (this.options.feature.height) {\n            obj[this.options.feature.height] = this._map.getSize().y;\n          }\n          if (this.options.feature.bottom) {\n            obj[this.options.feature.bottom] = this._TCRSToPCRS(bounds.max, zoom).y;\n          }\n          if (this.options.feature.left) {\n            obj[this.options.feature.left] = this._TCRSToPCRS(bounds.min, zoom).x;\n          }\n          if (this.options.feature.top) {\n            obj[this.options.feature.top] = this._TCRSToPCRS(bounds.min, zoom).y;\n          }\n          if (this.options.feature.right) {\n            obj[this.options.feature.right] = this._TCRSToPCRS(bounds.max, zoom).x;\n          }\n          // hidden and other variables that may be associated\n          for (var v in this.options.feature) {\n              if ([\"width\",\"height\",\"left\",\"right\",\"top\",\"bottom\",\"zoom\"].indexOf(v) < 0) {\n                  obj[v] = this.options.feature[v];\n                }\n          }\n          return L.Util.template(this._template.template, obj);\n      },\n      _TCRSToPCRS: function(coords, zoom) {\n        // TCRS pixel point to Projected CRS point (in meters, presumably)\n        var map = this._map,\n            crs = map.options.crs,\n            loc = crs.transformation.untransform(coords,crs.scale(zoom));\n            return loc;\n      },\n      _setUpFeaturesTemplateVars: function(template) {\n        // process the inputs and create an object named \"extent\"\n        // with member properties as follows:\n        // {width: {name: 'widthvarname'}, // value supplied by map if necessary\n        //  height: {name: 'heightvarname'}, // value supplied by map if necessary\n        //  left: {name: 'leftvarname', axis: 'leftaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n        //  right: {name: 'rightvarname', axis: 'rightaxisname'}, // axis name (coordinate system of) drives the value supplied by the map\n        //  top: {name: 'topvarname', axis: 'topaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n        //  bottom: {name: 'bottomvarname', axis: 'bottomaxisname'} // axis name drives (coordinate system of) the value supplied by the map\n        //  zoom: {name: 'zoomvarname'}\n        //  hidden: [{name: name, value: value}]}\n\n        var featuresVarNames = {feature:{}},\n            inputs = template.values;\n        featuresVarNames.feature.hidden = [];\n        for (var i=0;i<inputs.length;i++) {\n          // this can be removed when the spec removes the deprecated inputs...\n          var type = inputs[i].getAttribute(\"type\"), \n              units = inputs[i].getAttribute(\"units\"), \n              axis = inputs[i].getAttribute(\"axis\"), \n              name = inputs[i].getAttribute(\"name\"), \n              position = inputs[i].getAttribute(\"position\"),\n              value = inputs[i].getAttribute(\"value\"),\n              select = (inputs[i].tagName.toLowerCase() === \"map-select\");\n          if (type === \"width\") {\n                featuresVarNames.feature.width = name;\n          } else if ( type === \"height\") {\n                featuresVarNames.feature.height = name;\n          } else if (type === \"zoom\") {\n                featuresVarNames.feature.zoom = name;\n          } else if (type === \"location\" && (units === \"pcrs\" || units ===\"gcrs\") ) {\n            //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting\">\n            switch (axis) {\n              case ('x'):\n              case ('longitude'):\n              case ('easting'):\n                if (position) {\n                    if (position.match(/.*?-left/i)) {\n                      featuresVarNames.feature.left = name;\n                    } else if (position.match(/.*?-right/i)) {\n                      featuresVarNames.feature.right = name;\n                    }\n                }\n                break;\n              case ('y'):\n              case ('latitude'):\n              case ('northing'):\n                if (position) {\n                  if (position.match(/top-.*?/i)) {\n                    featuresVarNames.feature.top = name;\n                  } else if (position.match(/bottom-.*?/i)) {\n                    featuresVarNames.feature.bottom = name;\n                  }\n                }\n                break;\n            }\n           } else if (select) {\n              /*jshint -W104 */\n            const parsedselect = inputs[i].htmlselect;\n            featuresVarNames.feature[name] = function() {\n                return parsedselect.value;\n            };\n           // projection is deprecated, make it hidden\n          } else {\n              /*jshint -W104 */\n              const input = inputs[i];\n              featuresVarNames.feature[name] = function() {\n                  return input.getAttribute(\"value\");\n              };\n          }\n        }\n        return featuresVarNames;\n      }\n  });\n  var templatedFeaturesLayer = function(template, options) {\n      return new TemplatedFeaturesLayer(template, options);\n  };\n\n  var TemplatedImageLayer =  L.Layer.extend({\n      initialize: function(template, options) {\n          this._template = template;\n          this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n          L.DomUtil.addClass(this._container, 'mapml-image-container');\n          let inputData = M.extractInputBounds(template);\n          this.zoomBounds = inputData.zoomBounds;\n          this.extentBounds=inputData.bounds;\n          this.isVisible = true;\n          delete options.opacity;\n          L.extend(options, this.zoomBounds);\n          L.setOptions(this, L.extend(options,this._setUpExtentTemplateVars(template)));\n      },\n      getEvents: function () {\n          var events = {\n              moveend: this._onMoveEnd\n          };\n          return events;\n      },\n      onAdd: function () {\n          this._map._addZoomLimit(this);  //used to set the zoom limit of the map\n          this.setZIndex(this.options.zIndex);\n          this._onAdd();\n      },\n      redraw: function() {\n          this._onMoveEnd();\n      },\n\n      _clearLayer: function(){\n        let containerImages = this._container.querySelectorAll('img');\n        for(let i = 0; i< containerImages.length;i++){\n          this._container.removeChild(containerImages[i]);\n        }\n      },\n\n      _addImage: function (bounds, zoom, loc) {\n          let map = this._map;\n          let overlayToRemove = this._imageOverlay;\n          let src = this.getImageUrl(bounds, zoom);\n          let size = map.getSize();\n          this._imageOverlay = M.imageOverlay(src, loc, size, 0, this._container);\n          this._imageOverlay._step = this._template.step;\n          this._imageOverlay.addTo(map);\n          if (overlayToRemove) {\n              this._imageOverlay._overlayToRemove = overlayToRemove._url;\n              this._imageOverlay.on('load error', function () {map.removeLayer(overlayToRemove);});\n          }\n      },\n\n      _scaleImage: function (bounds, zoom) {\n          let obj = this;\n          setTimeout(function () {\n              let step = obj._template.step;\n              let steppedZoom = Math.floor(zoom / step) * step;\n              let scale = obj._map.getZoomScale(zoom, steppedZoom);\n              let translate = bounds.min.multiplyBy(scale)\n                  .subtract(obj._map._getNewPixelOrigin(obj._map.getCenter(), zoom)).round();\n              L.DomUtil.setTransform(obj._imageOverlay._image, translate, scale);\n          });\n      },\n\n      _onAdd: function () {\n          let zoom = this._map.getZoom();\n          let steppedZoom = zoom;\n          let step = this._template.step;\n\n          if (zoom % step !== 0) steppedZoom = Math.floor(zoom / step) * step;\n          let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n          this._addImage(bounds, steppedZoom, L.point(0,0));\n          this._pixelOrigins = {};\n          this._pixelOrigins[steppedZoom] = bounds.min;\n          if(zoom !== steppedZoom) {\n              this._scaleImage(bounds, zoom);\n          }\n      },\n\n      _onMoveEnd: function(e) {\n          let mapZoom = this._map.getZoom();\n          let history = this._map.options.mapEl._history;\n          let current = history[history.length - 1];\n          let previous = history[history.length - 2];\n          if(!previous) previous = current;\n          let step = this._template.step;\n          let steppedZoom =   Math.floor(mapZoom / step) * step;\n          let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n          //Zooming from one step increment into a lower one\n          if((step !== \"1\") && ((mapZoom + 1) % step === 0) &&\n              current.zoom === previous.zoom - 1){\n              this._addImage(bounds, steppedZoom, L.point(0,0));\n              this._scaleImage(bounds, mapZoom);\n          //Zooming or panning within a step increment\n          } else if (e && mapZoom % step !== 0) {\n              this._imageOverlay._overlayToRemove = this._imageOverlay._url;\n              if (current.zoom !== previous.zoom) {\n                  //Zoomed from within one step increment into another\n                  if(steppedZoom !== Math.floor(previous.zoom / step) * step){\n                      this._addImage(bounds, steppedZoom, L.point(0,0));\n                      this._pixelOrigins[steppedZoom] = bounds.min;\n                  }\n                  this._scaleImage(bounds, mapZoom);\n              } else {\n                  let pixelOrigin = this._pixelOrigins[steppedZoom];\n                  let loc = bounds.min.subtract(pixelOrigin);\n                  if(this.getImageUrl(bounds, steppedZoom) === this._imageOverlay._url) return;\n                  this._addImage(bounds, steppedZoom, loc);\n                  this._scaleImage(bounds, mapZoom);\n              }\n          } else {\n              let mapBounds = M.pixelToPCRSBounds(this._map.getPixelBounds(),mapZoom,this._map.options.projection);\n              this.isVisible = mapZoom <= this.zoomBounds.maxZoom && mapZoom >= this.zoomBounds.minZoom &&\n              this.extentBounds.overlaps(mapBounds);\n              if(!(this.isVisible)){\n                  this._clearLayer();\n                  return;\n              }\n              var map = this._map, loc = map.getPixelBounds().min.subtract(map.getPixelOrigin());\n              this._addImage(map.getPixelBounds(), mapZoom, loc);\n              this._pixelOrigins[mapZoom] = map.getPixelOrigin();\n          }\n      },\n      setZIndex: function (zIndex) {\n          this.options.zIndex = zIndex;\n          this._updateZIndex();\n\n          return this;\n      },\n      _updateZIndex: function () {\n          if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n              this._container.style.zIndex = this.options.zIndex;\n          }\n      },\n      onRemove: function (map) {\n        this._clearLayer();\n        map._removeZoomLimit(this);\n        this._container = null;\n      },\n      getImageUrl: function(pixelBounds, zoom) {\n          var obj = {};\n          obj[this.options.extent.width] = this._map.getSize().x;\n          obj[this.options.extent.height] = this._map.getSize().y;\n          obj[this.options.extent.bottom] = this._TCRSToPCRS(pixelBounds.max, zoom).y;\n          obj[this.options.extent.left] = this._TCRSToPCRS(pixelBounds.min, zoom).x;\n          obj[this.options.extent.top] = this._TCRSToPCRS(pixelBounds.min, zoom).y;\n          obj[this.options.extent.right] = this._TCRSToPCRS(pixelBounds.max, zoom).x;\n          // hidden and other variables that may be associated\n          for (var v in this.options.extent) {\n              if ([\"width\",\"height\",\"left\",\"right\",\"top\",\"bottom\"].indexOf(v) < 0) {\n                  obj[v] = this.options.extent[v];\n                }\n          }\n          return L.Util.template(this._template.template, obj);\n      },\n      _TCRSToPCRS: function(coords, zoom) {\n        // TCRS pixel point to Projected CRS point (in meters, presumably)\n        var map = this._map,\n            crs = map.options.crs,\n            loc = crs.transformation.untransform(coords,crs.scale(zoom));\n            return loc;\n      },\n      _setUpExtentTemplateVars: function(template) {\n        // process the inputs associated to template and create an object named\n        // extent with member properties as follows:\n        // {width: 'widthvarname', \n        //  height: 'heightvarname', \n        //  left: 'leftvarname', \n        //  right: 'rightvarname', \n        //  top: 'topvarname', \n        //  bottom: 'bottomvarname'}\n\n        var extentVarNames = {extent:{}},\n            inputs = template.values;\n        \n        for (var i=0;i<template.values.length;i++) {\n          var type = inputs[i].getAttribute(\"type\"), \n              units = inputs[i].getAttribute(\"units\"), \n              axis = inputs[i].getAttribute(\"axis\"), \n              name = inputs[i].getAttribute(\"name\"), \n              position = inputs[i].getAttribute(\"position\"),\n              select = (inputs[i].tagName.toLowerCase() === \"map-select\");\n          if (type === \"width\") {\n                extentVarNames.extent.width = name;\n          } else if ( type === \"height\") {\n                extentVarNames.extent.height = name;\n          } else if (type === \"location\" && (units === \"pcrs\" || units ===\"gcrs\") ) {\n            //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n            switch (axis) {\n              case ('longitude'):\n              case ('easting'):\n                if (position) {\n                    if (position.match(/.*?-left/i)) {\n                      extentVarNames.extent.left = name;\n                    } else if (position.match(/.*?-right/i)) {\n                      extentVarNames.extent.right = name;\n                    }\n                }\n                break;\n              case ('latitude'):\n              case ('northing'):\n                if (position) {\n                  if (position.match(/top-.*?/i)) {\n                    extentVarNames.extent.top = name;\n                  } else if (position.match(/bottom-.*?/i)) {\n                    extentVarNames.extent.bottom = name;\n                  }\n                }\n                break;\n            }\n          } else if (select) {\n              /*jshint -W104 */\n            const parsedselect = inputs[i].htmlselect;\n            extentVarNames.extent[name] = function() {\n                return parsedselect.value;\n            };\n          } else {\n              /*jshint -W104 */\n              const input = inputs[i];\n              extentVarNames.extent[name] = function() {\n                  return input.getAttribute(\"value\");\n              };\n          }\n        }\n        return extentVarNames;\n      },\n  });\n  var templatedImageLayer = function(template, options) {\n      return new TemplatedImageLayer(template, options);\n  };\n\n  var ImageOverlay = L.ImageOverlay.extend({\n  \tinitialize: function (url, location, size, angle, container, options) { // (String, Point, Point, Number, Element, Object)\n                  this._container = container;\n  \t\tthis._url = url;\n                  // instead of calculating where the image goes, put it at 0,0\n  \t\t//this._location = L.point(location);\n                  // the location for WMS requests will be the upper left hand\n                  // corner of the map.  When the map is initialized, that is 0,0,\n                  // but as the user pans, of course the\n  \t\tthis._location = location;\n                  this._size = L.point(size);\n                  this._angle = angle;\n\n  \t\tL.setOptions(this, options);\n  \t},\n          getEvents: function() {\n  \t\tvar events = {\n  \t\t\tviewreset: this._reset\n  \t\t};\n\n  \t\tif (this._zoomAnimated && this._step <= 1) {\n  \t\t\tevents.zoomanim = this._animateZoom;\n  \t\t}\n\n  \t\treturn events;\n          },\n  \tonAdd: function () {\n                  this.on({ \n                    load: this._onImageLoad\n                    });\n\n  \t\tif (!this._image) {\n                      this._initImage();\n  \t\t}\n\n  \t\tif (this.options.interactive) {\n  \t\t\tL.DomUtil.addClass(this._image, 'leaflet-interactive');\n  \t\t\tthis.addInteractiveTarget(this._image);\n  \t\t}\n\n  \t\tthis._container.appendChild(this._image);\n  \t\tthis._reset();\n  \t},\n  \tonRemove: function () {\n  \t\tL.DomUtil.remove(this._image);\n  \t\tif (this.options.interactive) {\n  \t\t\tthis.removeInteractiveTarget(this._image);\n  \t\t}\n  \t},\n          _onImageLoad: function () {\n              if (!this._image) { return; }\n              this._image.loaded =  +new Date();\n              this._updateOpacity();\n          },\n  \t_animateZoom: function (e) {\n  \t\tvar scale = this._map.getZoomScale(e.zoom),\n  \t\t    translate = this._map.getPixelOrigin().add(this._location).multiplyBy(scale)\n  \t\t        .subtract(this._map._getNewPixelOrigin(e.center, e.zoom)).round();\n\n  \t\tif (L.Browser.any3d) {\n  \t\t\tL.DomUtil.setTransform(this._image, translate, scale);\n  \t\t} else {\n  \t\t\tL.DomUtil.setPosition(this._image, translate);\n  \t\t}\n  \t},\n      _reset: function (e) {\n  \t\tvar image = this._image,\n  \t\t    location = this._location,\n                      size = this._size;\n  \t\t// TBD use the angle to establish the image rotation in CSS\n\n  \t\tif(e && this._step > 1 &&\n  \t\t\t(this._overlayToRemove === undefined || this._url === this._overlayToRemove)) {\n  \t\t\treturn;\n  \t\t}\n  \t\tL.DomUtil.setPosition(image, location);\n\n  \t\timage.style.width  = size.x + 'px';\n  \t\timage.style.height = size.y + 'px';\n      },\n  \t_updateOpacity: function () {\n  \t\tif (!this._map) { return; }\n\n  \t\t//L.DomUtil.setOpacity(this._image, this.options.opacity);\n\n  \t\tvar now = +new Date(),\n  \t\t    nextFrame = false;\n\n                  var image = this._image;\n\n                  var fade = Math.min(1, (now - image.loaded) / 200);\n\n                  L.DomUtil.setOpacity(image, fade);\n                  if (fade < 1) {\n                          nextFrame = true;\n                  } \n  \t\tif (nextFrame) {\n  \t\t\tL.Util.cancelAnimFrame(this._fadeFrame);\n  \t\t\tthis._fadeFrame = L.Util.requestAnimFrame(this._updateOpacity, this);\n  \t\t}\n                  L.DomUtil.addClass(image, 'leaflet-image-loaded');\n  \t}\n          \n  });\n  var imageOverlay = function (url, location, size, angle, container, options) {\n          return new ImageOverlay(url, location, size, angle, container, options);\n  };\n\n  var MapMLLayer = L.Layer.extend({\n      // zIndex has to be set, for the case where the layer is added to the\n      // map before the layercontrol is used to control it (where autoZindex is used)\n      // e.g. in the raw MapML-Leaflet-Client index.html page.\n      options: {\n          maxNext: 10,\n          zIndex: 0,\n          maxZoom: 25\n      },\n      // initialize is executed before the layer is added to a map\n      initialize: function (href, content, options) {\n          // in the custom element, the attribute is actually 'src'\n          // the _href version is the URL received from layer-@src\n          var mapml;\n          if (href) {\n              this._href = href;\n          }\n          if (content) {\n            this._layerEl = content;\n            mapml = content.querySelector('map-feature,map-tile,map-extent') ? true : false;\n            if (!href && mapml) {\n                this._content = content;\n            }\n          }\n          L.setOptions(this, options);\n          this._container = L.DomUtil.create('div', 'leaflet-layer');\n          L.DomUtil.addClass(this._container,'mapml-layer');\n          this._imageContainer = L.DomUtil.create('div', 'leaflet-layer', this._container);\n          L.DomUtil.addClass(this._imageContainer,'mapml-image-container');\n          \n          // this layer 'owns' a mapmlTileLayer, which is a subclass of L.GridLayer\n          // it 'passes' what tiles to load via the content of this._mapmlTileContainer\n          this._mapmlTileContainer = L.DomUtil.create('div', 'mapml-tile-container', this._container);\n          // hit the service to determine what its extent might be\n          // OR use the extent of the content provided\n\n          if (!mapml && content && content.hasAttribute('label')) this._title = content.getAttribute('label');\n          this._initialize(mapml ? content : null);\n          \n          // a default extent can't be correctly set without the map to provide\n          // its bounds , projection, zoom range etc, so if that stuff's not\n          // established by metadata in the content, we should use map properties\n          // to set the extent, but the map won't be available until the <layer>\n          // element is attached to the <map> element, wait for that to happen.\n          this.on('attached', this._validateExtent, this );\n          // weirdness.  options is actually undefined here, despite the hardcoded\n          // options above. If you use this.options, you see the options defined\n          // above.  Not going to change this, but failing to understand ATM.\n          // may revisit some time.\n          this.validProjection = true; \n          \n          // _mapmlLayerItem is set to the root element representing this layer\n          // in the layer control, iff the layer is not 'hidden' \n          this._mapmlLayerItem = {};\n      },\n      setZIndex: function (zIndex) {\n          this.options.zIndex = zIndex;\n          this._updateZIndex();\n\n          return this;\n      },\n      _updateZIndex: function () {\n          if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n              this._container.style.zIndex = this.options.zIndex;\n          }\n      },\n      // remove all the extents before removing the layer from the map\n      _removeExtents: function(map){\n        if(this._extent._mapExtents){\n          for(let i = 0; i < this._extent._mapExtents.length; i++){\n            if(this._extent._mapExtents[i].templatedLayer){\n              map.removeLayer(this._extent._mapExtents[i].templatedLayer);\n            }\n          }\n        }\n        if (this._extent._queries) {\n          delete this._extent._queries;\n        }\n      },\n      _changeOpacity: function(e) {\n        if (e && e.target && e.target.value >=0 && e.target.value <= 1.0) {\n          this.changeOpacity(e.target.value);\n        }\n      },\n      changeOpacity: function(opacity) {\n          this._container.style.opacity = opacity;\n          if(this.opacityEl) this.opacityEl.value = opacity;\n      },\n      _changeExtentOpacity: function(e){\n        if(e && e.target && e.target.value >=0 && e.target.value <= 1.0){\n          this.templatedLayer.changeOpacity(e.target.value);\n          this._templateVars.opacity = e.target.value;\n        }\n      },\n      _changeExtent: function(e, extentEl) {\n          if(e.target.checked){\n            extentEl.checked = true;\n            if(this._layerEl.checked){\n                extentEl.templatedLayer = M.templatedLayer(extentEl._templateVars, \n                  { pane: this._container,\n                    opacity: extentEl._templateVars.opacity,\n                    _leafletLayer: this,\n                    crs: extentEl.crs,\n                    extentZIndex: extentEl.extentZIndex\n                  }).addTo(this._map);\n                  extentEl.templatedLayer.setZIndex();\n                  this._setLayerElExtent();  \n              }       \n          } else {\n              L.DomEvent.stopPropagation(e);\n              extentEl.checked = false;\n              if(this._layerEl.checked) this._map.removeLayer(extentEl.templatedLayer);\n              this._setLayerElExtent();\n          }\n      },\n\n      onAdd: function (map) {\n          if((this._extent || this._extent_mapExtents) && !this._validProjection(map)){\n            this.validProjection = false;\n            return;\n          }\n          this._map = map;\n          if(this._content){\n            if (!this._mapmlvectors) {\n              this._mapmlvectors = M.mapMlFeatures(this._content, {\n                // pass the vector layer a renderer of its own, otherwise leaflet\n                // puts everything into the overlayPane\n                renderer: M.featureRenderer(),\n                // pass the vector layer the container for the parent into which\n                // it will append its own container for rendering into\n                pane: this._container,\n                opacity: this.options.opacity,\n                projection:map.options.projection,\n                // each owned child layer gets a reference to the root layer\n                _leafletLayer: this,\n                static: true,\n                onEachFeature: function(properties, geometry) {\n                  // need to parse as HTML to preserve semantics and styles\n                  if (properties) {\n                    var c = document.createElement('div');\n                    c.classList.add(\"mapml-popup-content\");\n                    c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                    geometry.bindPopup(c, {autoClose: false, minWidth: 165});\n                  }\n                }\n              });\n            }\n            this._setLayerElExtent();\n            map.addLayer(this._mapmlvectors);\n          } else {\n            this.once('extentload', function() {\n              if(!this._validProjection(map)){\n                this.validProjection = false;\n                return;\n              }\n              if (!this._mapmlvectors) {\n                this._mapmlvectors = M.mapMlFeatures(this._content, {\n                    // pass the vector layer a renderer of its own, otherwise leaflet\n                    // puts everything into the overlayPane\n                    renderer: M.featureRenderer(),\n                    // pass the vector layer the container for the parent into which\n                    // it will append its own container for rendering into\n                    pane: this._container,\n                    opacity: this.options.opacity,\n                    projection:map.options.projection,\n                    // each owned child layer gets a reference to the root layer\n                    _leafletLayer: this,\n                    static: true,\n                    onEachFeature: function(properties, geometry) {\n                      // need to parse as HTML to preserve semantics and styles\n                      if (properties) {\n                        var c = document.createElement('div');\n                        c.classList.add(\"mapml-popup-content\");\n                        c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                        geometry.bindPopup(c, {autoClose: false, minWidth: 165});\n                      }\n                    }\n                  }).addTo(map);\n              }\n              this._setLayerElExtent();\n            },this);\n          }\n          \n          \n          \n          if (!this._imageLayer) {\n              this._imageLayer = L.layerGroup();\n          }\n          map.addLayer(this._imageLayer);\n          // the layer._imageContainer property contains an element in which\n          // content will be maintained\n          \n          //only add the layer if there are tiles to be rendered\n          if((!this._staticTileLayer || this._staticTileLayer._container === null) && \n            this._mapmlTileContainer.getElementsByTagName(\"map-tiles\").length > 0)\n          {\n            this._staticTileLayer = M.mapMLStaticTileLayer({\n              pane:this._container,\n              _leafletLayer: this,\n              className:\"mapml-static-tile-layer\",\n              tileContainer:this._mapmlTileContainer,\n              maxZoomBound:map.options.crs.options.resolutions.length - 1,\n              tileSize: map.options.crs.options.crs.tile.bounds.max.x,\n            });\n            map.addLayer(this._staticTileLayer);\n            this._setLayerElExtent();\n          }\n          \n          const createAndAdd = createAndAddTemplatedLayers.bind(this);\n          // if the extent has been initialized and received, update the map,\n          if (this._extent && this._extent._mapExtents && this._extent._mapExtents[0]._templateVars) {\n            createAndAdd();\n          } else { // wait for extent to be loaded\n            this.once('extentload', function() {\n                if(!this._validProjection(map)){\n                  this.validProjection = false;\n                  return;\n                }\n                createAndAdd();\n              }, this);\n          }\n          this.setZIndex(this.options.zIndex);\n          this.getPane().appendChild(this._container);\n          setTimeout(() => {\n            map.fire('checkdisabled');\n          }, 0);\n          map.on(\"popupopen\", this._attachSkipButtons, this);\n          \n          function createAndAddTemplatedLayers() {\n            if(this._extent && this._extent._mapExtents){\n              for(let i = 0; i < this._extent._mapExtents.length; i++){\n                if (this._extent._mapExtents[i]._templateVars && this._extent._mapExtents[i].checked) {\n                  if(!this._extent._mapExtents[i].extentZIndex) this._extent._mapExtents[i].extentZIndex = i;\n                  this._templatedLayer = M.templatedLayer(this._extent._mapExtents[i]._templateVars, \n                    { pane: this._container,\n                      opacity: this._extent._mapExtents[i]._templateVars.opacity,\n                      _leafletLayer: this,\n                      crs: this._extent.crs,\n                      extentZIndex: this._extent._mapExtents[i].extentZIndex,\n                      }).addTo(map);   \n                      this._extent._mapExtents[i].templatedLayer = this._templatedLayer;\n                      if(this._templatedLayer._queries){\n                        if(!this._extent._queries) this._extent._queries = [];\n                        this._extent._queries = this._extent._queries.concat(this._templatedLayer._queries);\n                      }\n                }\n               }\n              this._setLayerElExtent();\n            }\n          }\n      },\n\n\n      _validProjection : function(map){\n        let noLayer = false;\n        if(this._extent && this._extent._mapExtents){\n          for(let i = 0; i < this._extent._mapExtents.length; i++){\n            if(this._extent._mapExtents[i]._templateVars){\n              for(let template of this._extent._mapExtents[i]._templateVars)\n                if(!template.projectionMatch && template.projection !== map.options.projection) {\n                  noLayer = true; // if there's a single template where projections don't match, set noLayer to true\n                  break;\n                } \n              }\n        }\n      }\n        return !(noLayer || this.getProjection() !== map.options.projection.toUpperCase());\n      },\n\n      //sets the <layer-> elements .bounds property \n      _setLayerElExtent: function(){\n        let bounds, zoomMax, zoomMin, maxNativeZoom, minNativeZoom,\n            zoomBounds = {minZoom: 0, maxZoom: 0, maxNativeZoom: 0, minNativeZoom: 0};\n        let layerTypes = [\"_staticTileLayer\",\"_imageLayer\",\"_mapmlvectors\",\"_templatedLayer\"];\n        layerTypes.forEach((type) =>{\n          if(this[type]){\n            if(type === \"_templatedLayer\"){\n              for(let i = 0; i < this._extent._mapExtents.length; i++){\n                for(let j = 0; j < this._extent._mapExtents[i]._templateVars.length; j++){\n                  let inputData = M.extractInputBounds(this._extent._mapExtents[i]._templateVars[j]);\n                  this._extent._mapExtents[i]._templateVars[j].tempExtentBounds = inputData.bounds;\n                  this._extent._mapExtents[i]._templateVars[j].extentZoomBounds = inputData.zoomBounds;\n                }\n              }\n              for(let i = 0; i < this._extent._mapExtents.length; i++){\n                if(this._extent._mapExtents[i].checked){\n                  for(let j = 0; j < this._extent._mapExtents[i]._templateVars.length; j++){\n                    if(!bounds){\n                      bounds = this._extent._mapExtents[i]._templateVars[j].tempExtentBounds;\n                      zoomMax = this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.maxZoom;\n                      zoomMin = this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.minZoom;\n                      maxNativeZoom = this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.maxNativeZoom;\n                      minNativeZoom = this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.minNativeZoom;\n                    } else {\n                      bounds.extend(this._extent._mapExtents[i]._templateVars[j].tempExtentBounds.min);\n                      bounds.extend(this._extent._mapExtents[i]._templateVars[j].tempExtentBounds.max);\n                      zoomMax = Math.max(zoomMax, this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.maxZoom);\n                      zoomMin = Math.min(zoomMin, this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.minZoom);\n                      maxNativeZoom = Math.max(maxNativeZoom, this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.maxNativeZoom);\n                      minNativeZoom = Math.min(minNativeZoom, this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.minNativeZoom);\n                    }\n                  }\n                }\n              }\n              zoomBounds.minZoom = zoomMin;\n              zoomBounds.maxZoom = zoomMax;\n              zoomBounds.minNativeZoom = minNativeZoom;\n              zoomBounds.maxNativeZoom = maxNativeZoom;\n              this._extent.zoomBounds = zoomBounds;\n              this._extent.layerBounds = bounds;\n              // assign each template the layer and zoom bounds\n              for(let i = 0; i < this._extent._mapExtents.length; i++){\n                this._extent._mapExtents[i].templatedLayer.layerBounds = bounds;\n                this._extent._mapExtents[i].templatedLayer.zoomBounds = zoomBounds;\n              }\n            } else {\n              if(this[type].layerBounds){\n                if(!bounds){\n                  bounds = this[type].layerBounds;\n                  zoomBounds = this[type].zoomBounds;\n                } else {\n                  bounds.extend(this[type].layerBounds.min);\n                  bounds.extend(this[type].layerBounds.max);\n                }\n              } \n            }\n          }\n        });\n        if(bounds){\n          //assigns the formatted extent object to .extent and spreads the zoom ranges to .extent also\n          this._layerEl.extent = (Object.assign(\n                                    M.convertAndFormatPCRS(bounds,this._map),\n                                    {zoom:zoomBounds}));\n        }\n      },\n\n      addTo: function (map) {\n          map.addLayer(this);\n          return this;\n      },\n      getEvents: function () {\n          return {zoomanim: this._onZoomAnim};\n      },\n      redraw: function() {\n        // for now, only redraw templated layers.\n          if (this._extent._mapExtents) {\n            for(let i = 0; i < this._extent._mapExtents.length; i++){\n              if(this._extent._mapExtents[i].templatedLayer){\n                this._extent._mapExtents[i].templatedLayer.redraw();\n              }\n            }\n          }\n      },\n      _onZoomAnim: function(e) {\n        // get the min and max zooms from all extents\n        var toZoom = e.zoom,\n            zoom = (this._extent && this._extent._mapExtents) ? this._extent._mapExtents[0].querySelector(\"map-input[type=zoom]\") : null,\n            min = zoom && zoom.hasAttribute(\"min\") ? parseInt(zoom.getAttribute(\"min\")) : this._map.getMinZoom(),\n            max =  zoom && zoom.hasAttribute(\"max\") ? parseInt(zoom.getAttribute(\"max\")) : this._map.getMaxZoom();\n        if(zoom){\n          for(let i = 1; i < this._extent._mapExtents.length; i++){\n            zoom = this._extent._mapExtents[i].querySelector(\"map-input[type=zoom]\");\n            if(zoom && zoom.hasAttribute(\"min\")) { min = Math.min(parseInt(zoom.getAttribute(\"min\")), min); }\n            if(zoom && zoom.hasAttribute(\"max\")){ max = Math.max(parseInt(zoom.getAttribute(\"max\")), max); }\n          }\n        }\n        var canZoom = (toZoom < min && this._extent.zoomout) || (toZoom > max && this._extent.zoomin);\n        if (!(min <= toZoom && toZoom <= max)){\n          if (this._extent.zoomin && toZoom > max) {\n            // this._href is the 'original' url from which this layer came\n            // since we are following a zoom link we will be getting a new\n            // layer almost, resetting child content as appropriate\n            this._href = this._extent.zoomin;\n            this._layerEl.src = this._extent.zoomin;\n            // this.href is the \"public\" property. When a dynamic layer is\n            // accessed, this value changes with every new extent received\n            this.href = this._extent.zoomin;\n            this._layerEl.src = this._extent.zoomin;\n          } else if (this._extent.zoomout && toZoom < min) {\n            this._href = this._extent.zoomout;\n            this.href = this._extent.zoomout;\n            this._layerEl.src = this._extent.zoomout;\n          }\n        }\n        if (this._templatedLayer && canZoom ) ;\n      },\n      onRemove: function (map) {\n          L.DomUtil.remove(this._container);\n          if(this._staticTileLayer) map.removeLayer(this._staticTileLayer);\n          if(this._mapmlvectors) map.removeLayer(this._mapmlvectors);\n          if(this._imageLayer) map.removeLayer(this._imageLayer);\n          if (this._extent && this._extent._mapExtents) this._removeExtents(map);\n\n          map.fire(\"checkdisabled\");\n          map.off(\"popupopen\", this._attachSkipButtons);\n      },\n      getAttribution: function () {\n          return this.options.attribution;\n      },\n\n      getLayerExtentHTML: function (labelName, i) {\n        var extent = L.DomUtil.create('fieldset', 'mapml-layer-extent'),\n          extentProperties = L.DomUtil.create('div', 'mapml-layer-item-properties', extent),\n          extentSettings = L.DomUtil.create('div', 'mapml-layer-item-settings', extent),\n          extentLabel = L.DomUtil.create('label', 'mapml-layer-item-toggle', extentProperties),\n          input = L.DomUtil.create('input'),\n          svgExtentControlIcon = L.SVG.create('svg'),\n          extentControlPath1 = L.SVG.create('path'),\n          extentControlPath2 = L.SVG.create('path'),\n          extentNameIcon = L.DomUtil.create('span'),\n          extentItemControls = L.DomUtil.create('div', 'mapml-layer-item-controls', extentProperties),\n          opacityControl = L.DomUtil.create('details', 'mapml-layer-item-opacity', extentSettings),\n          extentOpacitySummary = L.DomUtil.create('summary', '', opacityControl),\n          mapEl = this._layerEl.parentNode,\n          layerEl = this._layerEl,\n          opacity = L.DomUtil.create('input', '', opacityControl);\n          extentSettings.hidden = true;\n          extent.setAttribute(\"aria-grabbed\", \"false\");\n          if(!labelName){ // if a label attribute is not present, set it to hidden in layer control\n            extent.setAttribute(\"hidden\", \"\");\n            this._extent._mapExtents[i].hidden = true;\n          }\n\n          // append the svg paths\n          svgExtentControlIcon.setAttribute('viewBox', '0 0 24 24');\n          svgExtentControlIcon.setAttribute('height', '22');\n          svgExtentControlIcon.setAttribute('width', '22');\n          extentControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n          extentControlPath1.setAttribute('fill', 'none');\n          extentControlPath2.setAttribute('d', 'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z');\n          svgExtentControlIcon.appendChild(extentControlPath1);\n          svgExtentControlIcon.appendChild(extentControlPath2);\n\n          let removeExtentButton = L.DomUtil.create('button', 'mapml-layer-item-remove-control', extentItemControls);\n          removeExtentButton.type = 'button';\n          removeExtentButton.title = 'Remove Sub Layer';\n          removeExtentButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n          removeExtentButton.classList.add('mapml-button');\n          L.DomEvent.on(removeExtentButton, 'click', L.DomEvent.stop);\n          L.DomEvent.on(removeExtentButton, 'click', (e)=>{\n            let allRemoved = true;\n            e.target.checked = false;\n            this._extent._mapExtents[i].removed = true;\n            this._extent._mapExtents[i].checked = false;\n            if(this._layerEl.checked) this._changeExtent(e, this._extent._mapExtents[i]);\n            this._extent._mapExtents[i].extentAnatomy.parentNode.removeChild(this._extent._mapExtents[i].extentAnatomy);\n            for(let j = 0; j < this._extent._mapExtents.length; j++){\n              if(!this._extent._mapExtents[j].removed) allRemoved = false;\n            }\n            if(allRemoved) this._layerItemSettingsHTML.removeChild(this._extentGroupAnatomy); \n          }, this);\n\n          let extentsettingsButton = L.DomUtil.create('button', 'mapml-layer-item-settings-control', extentItemControls);\n          extentsettingsButton.type = 'button';\n          extentsettingsButton.title = 'Extent Settings';\n          extentsettingsButton.setAttribute('aria-expanded', false);\n          extentsettingsButton.classList.add('mapml-button');\n          L.DomEvent.on(extentsettingsButton, 'click', (e)=>{\n            if(extentSettings.hidden === true){\n              extentsettingsButton.setAttribute('aria-expanded', true);\n              extentSettings.hidden = false;\n            } else {\n              extentsettingsButton.setAttribute('aria-expanded', false);\n              extentSettings.hidden = true;\n            }\n          }, this);\n\n          extentNameIcon.setAttribute('aria-hidden', true);\n          extentLabel.appendChild(input);\n          extentsettingsButton.appendChild(extentNameIcon);\n          extentNameIcon.appendChild(svgExtentControlIcon);\n          extentOpacitySummary.innerText = 'Opacity';\n          extentOpacitySummary.id = 'mapml-layer-item-opacity-' + L.stamp(extentOpacitySummary);\n          opacity.setAttribute('type','range');\n          opacity.setAttribute('min', '0');\n          opacity.setAttribute('max','1.0');\n          opacity.setAttribute('value', this._extent._mapExtents[i]._templateVars.opacity || '1.0');\n          opacity.setAttribute('step','0.1');\n          opacity.setAttribute('aria-labelledby', 'mapml-layer-item-opacity-' + L.stamp(extentOpacitySummary));\n          this._extent._mapExtents[i]._templateVars.opacity = this._extent._mapExtents[i]._templateVars.opacity || '1.0';\n          L.DomEvent.on(opacity, 'change', this._changeExtentOpacity, this._extent._mapExtents[i]);\n\n          var extentItemNameSpan = L.DomUtil.create('span', 'mapml-layer-item-name', extentLabel);\n          input.defaultChecked = this._extent._mapExtents[i] ? true: false;\n          this._extent._mapExtents[i].checked = input.defaultChecked;\n          input.type = 'checkbox';\n          extentItemNameSpan.innerHTML = labelName;\n          L.DomEvent.on(input, 'change', (e)=>{\n            this._changeExtent(e, this._extent._mapExtents[i]);\n          });\n          extentItemNameSpan.id = 'mapml-extent-item-name-{' + L.stamp(extentItemNameSpan) + '}';\n          extent.setAttribute('aria-labelledby', extentItemNameSpan.id);\n          extentItemNameSpan.extent = this._extent._mapExtents[i];\n\n          extent.onmousedown = (downEvent) => {\n            if(downEvent.target.tagName.toLowerCase() === \"input\" || downEvent.target.tagName.toLowerCase() === \"select\") return;\n            downEvent.preventDefault();\n            downEvent.stopPropagation();\n\n            let control = extent,\n                controls = extent.parentNode,\n                moving = false, yPos = downEvent.clientY;\n\n                document.body.onmousemove = (moveEvent) => {\n                  moveEvent.preventDefault();\n      \n                  // Fixes flickering by only moving element when there is enough space\n                  let offset = moveEvent.clientY - yPos;\n                  moving = Math.abs(offset) > 5 || moving;\n                  if( (controls && !moving) || (controls && controls.childElementCount <= 1) || \n                      controls.getBoundingClientRect().top > control.getBoundingClientRect().bottom || \n                      controls.getBoundingClientRect().bottom < control.getBoundingClientRect().top){\n                        return;\n                      }\n                  \n                  controls.classList.add(\"mapml-draggable\");\n                  control.style.transform = \"translateY(\"+ offset +\"px)\";\n                  control.style.pointerEvents = \"none\";\n      \n                  let x = moveEvent.clientX, y = moveEvent.clientY,\n                      root = mapEl.tagName === \"MAPML-VIEWER\" ? mapEl.shadowRoot : mapEl.querySelector(\".mapml-web-map\").shadowRoot,\n                      elementAt = root.elementFromPoint(x, y),\n                      swapControl = !elementAt || !elementAt.closest(\"fieldset\") ? control : elementAt.closest(\"fieldset\");\n            \n                  swapControl =  Math.abs(offset) <= swapControl.offsetHeight ? control : swapControl;\n                  \n                  control.setAttribute(\"aria-grabbed\", 'true');\n                  control.setAttribute(\"aria-dropeffect\", \"move\");\n                  if(swapControl && controls === swapControl.parentNode){\n                    swapControl = swapControl !== control.nextSibling? swapControl : swapControl.nextSibling;\n                    if(control !== swapControl){ \n                      yPos = moveEvent.clientY;\n                      control.style.transform = null;\n                    }\n                    controls.insertBefore(control, swapControl);\n                  }\n                };\n\n                document.body.onmouseup = () => {\n                  control.setAttribute(\"aria-grabbed\", \"false\");\n                  control.removeAttribute(\"aria-dropeffect\");\n                  control.style.pointerEvents = null;\n                  control.style.transform = null;\n                  let controlsElems = controls.children,\n                      zIndex = 0;\n                  for(let c of controlsElems){\n                    let extentEl = c.querySelector(\"span\").extent;\n                    \n                    extentEl.setAttribute(\"data-moving\",\"\");\n                    layerEl.insertAdjacentElement(\"beforeend\", extentEl);\n                    extentEl.removeAttribute(\"data-moving\");\n      \n                    extentEl.extentZIndex = zIndex;\n                    extentEl.templatedLayer.setZIndex(zIndex);\n                    zIndex++;\n                  }\n                  controls.classList.remove(\"mapml-draggable\");\n                  document.body.onmousemove = document.body.onmouseup = null;\n                };\n\n                \n          };\n\n          return extent;\n      },\n\n      getLayerUserControlsHTML: function () {\n        var fieldset = L.DomUtil.create('fieldset', 'mapml-layer-item'),\n          input = L.DomUtil.create('input'),\n          layerItemName = L.DomUtil.create('span', 'mapml-layer-item-name'),\n          settingsButtonNameIcon = L.DomUtil.create('span'),\n          layerItemProperty = L.DomUtil.create('div', 'mapml-layer-item-properties', fieldset),\n          layerItemSettings = L.DomUtil.create('div', 'mapml-layer-item-settings', fieldset),\n          itemToggleLabel = L.DomUtil.create('label', 'mapml-layer-item-toggle', layerItemProperty),\n          layerItemControls = L.DomUtil.create('div', 'mapml-layer-item-controls', layerItemProperty),\n          opacityControl = L.DomUtil.create('details', 'mapml-layer-item-opacity mapml-control-layers', layerItemSettings),\n          opacity = L.DomUtil.create('input'),\n          opacityControlSummary = L.DomUtil.create('summary'),\n          svgSettingsControlIcon = L.SVG.create('svg'),\n          settingsControlPath1 = L.SVG.create('path'),\n          settingsControlPath2 = L.SVG.create('path'),\n          extentsFieldset = L.DomUtil.create('fieldset', 'mapml-layer-grouped-extents'),\n          mapEl = this._layerEl.parentNode;\n          this.opacityEl = opacity;\n          this._mapmlLayerItem = fieldset;\n\n          // append the paths in svg for the remove layer and toggle icons\n          svgSettingsControlIcon.setAttribute('viewBox', '0 0 24 24');\n          svgSettingsControlIcon.setAttribute('height', '22');\n          svgSettingsControlIcon.setAttribute('width', '22');\n          settingsControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n          settingsControlPath1.setAttribute('fill', 'none');\n          settingsControlPath2.setAttribute('d', 'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z');\n          svgSettingsControlIcon.appendChild(settingsControlPath1);\n          svgSettingsControlIcon.appendChild(settingsControlPath2);\n          \n          layerItemSettings.hidden = true;\n          settingsButtonNameIcon.setAttribute('aria-hidden', true);\n          \n          let removeControlButton = L.DomUtil.create('button', 'mapml-layer-item-remove-control', layerItemControls);\n          removeControlButton.type = 'button';\n          removeControlButton.title = 'Remove Layer';\n          removeControlButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n          removeControlButton.classList.add('mapml-button');\n          //L.DomEvent.disableClickPropagation(removeControlButton);\n          L.DomEvent.on(removeControlButton, 'click', L.DomEvent.stop);\n          L.DomEvent.on(removeControlButton, 'click', (e)=>{\n            let fieldset = 0, elem, root;\n            root = mapEl.tagName === \"MAPML-VIEWER\" ? mapEl.shadowRoot : mapEl.querySelector(\".mapml-web-map\").shadowRoot;\n            if(e.target.closest(\"fieldset\").nextElementSibling && !e.target.closest(\"fieldset\").nextElementSibling.disbaled){\n              elem = e.target.closest(\"fieldset\").previousElementSibling;\n              while(elem){\n                fieldset += 2; // find the next layer menu item\n                elem = elem.previousElementSibling;\n              }\n            } else {\n              // focus on the link\n              elem = \"link\";\n            }\n            mapEl.removeChild(e.target.closest(\"fieldset\").querySelector(\"span\").layer._layerEl);\n            elem = elem ? root.querySelector(\".leaflet-control-attribution\").firstElementChild: elem = root.querySelectorAll('input')[fieldset];\n            elem.focus();\n          }, this);\n\n          let itemSettingControlButton = L.DomUtil.create('button', 'mapml-layer-item-settings-control', layerItemControls);\n          itemSettingControlButton.type = 'button';\n          itemSettingControlButton.title = 'Layer Settings';\n          itemSettingControlButton.setAttribute('aria-expanded', false);\n          itemSettingControlButton.classList.add('mapml-button');\n          L.DomEvent.on(itemSettingControlButton, 'click', (e)=>{\n            if(layerItemSettings.hidden === true){\n              itemSettingControlButton.setAttribute('aria-expanded', true);\n              layerItemSettings.hidden = false;\n            } else {\n              itemSettingControlButton.setAttribute('aria-expanded', false);\n              layerItemSettings.hidden = true;\n            }\n          }, this);\n\n          input.defaultChecked = this._map ? true: false;\n          input.type = 'checkbox';\n          layerItemName.layer = this;\n\n          if (this._legendUrl) {\n            var legendLink = document.createElement('a');\n            legendLink.text = ' ' + this._title;\n            legendLink.href = this._legendUrl;\n            legendLink.target = '_blank';\n            legendLink.draggable = false;\n            layerItemName.appendChild(legendLink);\n          } else {\n            layerItemName.innerHTML = this._title;\n          }\n          layerItemName.id = 'mapml-layer-item-name-{' + L.stamp(layerItemName) + '}';\n          opacityControlSummary.innerText = 'Opacity';\n          opacityControlSummary.id = 'mapml-layer-item-opacity-' + L.stamp(opacityControlSummary);\n          opacityControl.appendChild(opacityControlSummary);\n          opacityControl.appendChild(opacity);\n          opacity.setAttribute('type','range');\n          opacity.setAttribute('min', '0');\n          opacity.setAttribute('max','1.0');\n          opacity.setAttribute('value', this._container.style.opacity || '1.0');\n          opacity.setAttribute('step','0.1');\n          opacity.setAttribute('aria-labelledby', opacityControlSummary.id);\n          opacity.value = this._container.style.opacity || '1.0';\n\n          fieldset.setAttribute(\"aria-grabbed\", \"false\");\n          fieldset.setAttribute('aria-labelledby', layerItemName.id);\n\n          fieldset.onmousedown = (downEvent) => {\n            if(downEvent.target.tagName.toLowerCase() === \"input\" || downEvent.target.tagName.toLowerCase() === \"select\") return;\n            downEvent.preventDefault();\n            let control = fieldset,\n                controls = fieldset.parentNode,\n                moving = false, yPos = downEvent.clientY;\n\n            document.body.onmousemove = (moveEvent) => {\n              moveEvent.preventDefault();\n\n              // Fixes flickering by only moving element when there is enough space\n              let offset = moveEvent.clientY - yPos;\n              moving = Math.abs(offset) > 5 || moving;\n              if( (controls && !moving) || (controls && controls.childElementCount <= 1) || \n                  controls.getBoundingClientRect().top > control.getBoundingClientRect().bottom || \n                  controls.getBoundingClientRect().bottom < control.getBoundingClientRect().top){\n                    return;\n                  }\n              \n              controls.classList.add(\"mapml-draggable\");\n              control.style.transform = \"translateY(\"+ offset +\"px)\";\n              control.style.pointerEvents = \"none\";\n\n              let x = moveEvent.clientX, y = moveEvent.clientY,\n                  root = mapEl.tagName === \"MAPML-VIEWER\" ? mapEl.shadowRoot : mapEl.querySelector(\".mapml-web-map\").shadowRoot,\n                  elementAt = root.elementFromPoint(x, y),\n                  swapControl = !elementAt || !elementAt.closest(\"fieldset\") ? control : elementAt.closest(\"fieldset\");\n        \n              swapControl =  Math.abs(offset) <= swapControl.offsetHeight ? control : swapControl;\n              \n              control.setAttribute(\"aria-grabbed\", 'true');\n              control.setAttribute(\"aria-dropeffect\", \"move\");\n              if(swapControl && controls === swapControl.parentNode){\n                swapControl = swapControl !== control.nextSibling? swapControl : swapControl.nextSibling;\n                if(control !== swapControl){ \n                  yPos = moveEvent.clientY;\n                  control.style.transform = null;\n                }\n                controls.insertBefore(control, swapControl);\n              }\n            };\n\n            document.body.onmouseup = () => {\n              control.setAttribute(\"aria-grabbed\", \"false\");\n              control.removeAttribute(\"aria-dropeffect\");\n              control.style.pointerEvents = null;\n              control.style.transform = null;\n              let controlsElems = controls.children,\n                  zIndex = 1;\n              for(let c of controlsElems){\n                let layerEl = c.querySelector(\"span\").layer._layerEl;\n                \n                layerEl.setAttribute(\"data-moving\",\"\");\n                mapEl.insertAdjacentElement(\"beforeend\", layerEl);\n                layerEl.removeAttribute(\"data-moving\");\n\n                \n                layerEl._layer.setZIndex(zIndex);\n                zIndex++;\n              }\n              controls.classList.remove(\"mapml-draggable\");\n              document.body.onmousemove = document.body.onmouseup = null;\n            };\n          };\n\n          L.DomEvent.on(opacity,'change', this._changeOpacity, this);\n\n          itemToggleLabel.appendChild(input);\n          itemToggleLabel.appendChild(layerItemName);\n          itemSettingControlButton.appendChild(settingsButtonNameIcon);\n          settingsButtonNameIcon.appendChild(svgSettingsControlIcon);\n\n          if (this._styles) {\n            layerItemSettings.appendChild(this._styles);\n          }\n\n          if (this._userInputs) {\n            var frag = document.createDocumentFragment();\n            var templates = this._extent._templateVars;\n            if (templates) {\n              for (var i=0;i<templates.length;i++) {\n                var template = templates[i];\n                for (var j=0;j<template.values.length;j++) {\n                  var mapmlInput = template.values[j],\n                      id = '#'+mapmlInput.getAttribute('id');\n                  // don't add it again if it is referenced > once\n                  if (mapmlInput.tagName.toLowerCase() === 'map-select' && !frag.querySelector(id)) {\n                    // generate a <details><summary></summary><select...></details>\n                    var selectdetails = L.DomUtil.create('details', 'mapml-layer-item-time mapml-control-layers', frag),\n                        selectsummary = L.DomUtil.create('summary'),\n                        selectSummaryLabel = L.DomUtil.create('label');\n                        selectSummaryLabel.innerText = mapmlInput.getAttribute('name');\n                        selectSummaryLabel.setAttribute('for', mapmlInput.getAttribute('id'));\n                        selectsummary.appendChild(selectSummaryLabel);\n                        selectdetails.appendChild(selectsummary);\n                        selectdetails.appendChild(mapmlInput.htmlselect);\n                  }\n                }\n              }\n            }\n            layerItemSettings.appendChild(frag);\n          }\n\n          // if there are extents, add them to the layer control\n          if(this._extent && this._extent._mapExtents) {\n            var allHidden = true;\n            this._layerItemSettingsHTML = layerItemSettings;\n            this._extentGroupAnatomy = extentsFieldset;\n            extentsFieldset.setAttribute('aria-label', 'Sublayers');\n            for(let j=0; j < this._extent._mapExtents.length; j++) {\n              extentsFieldset.appendChild(this._extent._mapExtents[j].extentAnatomy);\n              if(!this._extent._mapExtents[j].hidden) allHidden = false;\n            }\n            if(!allHidden) layerItemSettings.appendChild(extentsFieldset);\n          }\n\n          return this._mapmlLayerItem;\n      },\n      _initialize: function(content) {\n          if (!this._href && !content) {return;}\n          var layer = this;\n          // the this._href (comes from layer@src) should take precedence over \n          // content of the <layer> element, but if no this._href / src is provided\n          // but there *is* child content of the <layer> element (which is copied/\n          // referred to by this._content), we should use that content.\n          if (this._href) {\n              var xhr = new XMLHttpRequest();\n  //            xhr.withCredentials = true;\n              _get(this._href, _processInitialExtent);\n          } else if (content) {\n              // may not set this._extent if it can't be done from the content\n              // (eg a single point) and there's no map to provide a default yet\n              _processInitialExtent.call(this, content);\n          }\n          function _get(url, fCallback  ) {\n              xhr.onreadystatechange = function () { \n                if(this.readyState === this.DONE) {\n                  if (this.status === 400 || \n                      this.status === 404 || \n                      this.status === 500 || \n                      this.status === 406) {\n                      layer.error = true;\n                      layer.fire('extentload', layer, true);\n                      xhr.abort();\n                  }\n                }};\n              xhr.onload = fCallback;\n              xhr.onerror = function () { \n                layer.error = true;\n                layer.fire('extentload', layer, true);\n              };\n              xhr.open(\"GET\", url);\n              xhr.setRequestHeader(\"Accept\",M.mime);\n              xhr.overrideMimeType(\"text/xml\");\n              xhr.send();\n          }\n          function transcribe(element) {\n              var select = document.createElement(\"select\");\n              var elementAttrNames = element.getAttributeNames();\n\n              for(let i = 0; i < elementAttrNames.length; i++){\n                  select.setAttribute(elementAttrNames[i], element.getAttribute(elementAttrNames[i]));\n              }\n\n              var options = element.children;\n\n              for(let i = 0; i < options.length; i++){\n                  var option = document.createElement(\"option\");\n                  var optionAttrNames = options[i].getAttributeNames();\n\n                  for (let j = 0; j < optionAttrNames.length; j++){\n                      option.setAttribute(optionAttrNames[j], options[i].getAttribute(optionAttrNames[j]));\n                  }\n\n                  option.innerHTML = options[i].innerHTML;\n                  select.appendChild(option);\n              }\n              return select;\n          }\n\n          function _initTemplateVars(serverExtent, metaExtent, projection, mapml, base, projectionMatch){\n            var templateVars = [];\n            // set up the URL template and associated inputs (which yield variable values when processed)\n            var tlist = serverExtent.querySelectorAll('map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]'),\n                varNamesRe = (new RegExp('(?:\\{)(.*?)(?:\\})','g')),\n                zoomInput = serverExtent.querySelector('map-input[type=\"zoom\" i]'),\n                includesZoom = false, extentFallback = {};\n\n            extentFallback.zoom = 0;\n            if (metaExtent){\n              let content = M.metaContentToObject(metaExtent.getAttribute(\"content\")), cs;\n              \n              extentFallback.zoom = content.zoom || extentFallback.zoom;\n\n              let metaKeys = Object.keys(content);\n              for(let i =0;i<metaKeys.length;i++){\n                if(!metaKeys[i].includes(\"zoom\")){\n                  cs = M.axisToCS(metaKeys[i].split(\"-\")[2]);\n                  break;\n                }\n              }\n              let axes = M.csToAxes(cs);\n              extentFallback.bounds = M.boundsToPCRSBounds(\n                L.bounds(L.point(+content[`top-left-${axes[0]}`],+content[`top-left-${axes[1]}`]),\n                L.point(+content[`bottom-right-${axes[0]}`],+content[`bottom-right-${axes[1]}`])),\n                extentFallback.zoom, projection, cs);\n              \n            } else {\n              extentFallback.bounds = M[projection].options.crs.pcrs.bounds;\n            }\n              \n            for (var i=0;i< tlist.length;i++) {\n              var t = tlist[i], template = t.getAttribute('tref'); \n              if(!template){\n                template = BLANK_TT_TREF;\n                let blankInputs = mapml.querySelectorAll('map-input');\n                for (let i of blankInputs){\n                  template += `{${i.getAttribute(\"name\")}}`;\n                }\n              }\n              \n              var v,\n                  title = t.hasAttribute('title') ? t.getAttribute('title') : 'Query this layer',\n                  vcount=template.match(varNamesRe),\n                  trel = (!t.hasAttribute('rel') || t.getAttribute('rel').toLowerCase() === 'tile') ? 'tile' : t.getAttribute('rel').toLowerCase(),\n                  ttype = (!t.hasAttribute('type')? 'image/*':t.getAttribute('type').toLowerCase()),\n                  inputs = [],\n                  tms = t && t.hasAttribute(\"tms\");\n                  var zoomBounds = mapml.querySelector('map-meta[name=zoom]')?\n                                    M.metaContentToObject(mapml.querySelector('map-meta[name=zoom]').getAttribute('content')):\n                                    undefined;\n              while ((v = varNamesRe.exec(template)) !== null) {\n                var varName = v[1],\n                    inp = serverExtent.querySelector('map-input[name='+varName+'],map-select[name='+varName+']');\n                if (inp) {\n\n                  if ((inp.hasAttribute(\"type\") && inp.getAttribute(\"type\")===\"location\") && \n                      (!inp.hasAttribute(\"min\" )) && \n                      (inp.hasAttribute(\"axis\") && ![\"i\",\"j\"].includes(inp.getAttribute(\"axis\").toLowerCase()))){\n                    zoomInput.setAttribute(\"value\", extentFallback.zoom);\n                    \n                    let axis = inp.getAttribute(\"axis\"), \n                        axisBounds = M.convertPCRSBounds(extentFallback.bounds, extentFallback.zoom, projection, M.axisToCS(axis));\n                    inp.setAttribute(\"min\", axisBounds.min[M.axisToXY(axis)]);\n                    inp.setAttribute(\"max\", axisBounds.max[M.axisToXY(axis)]);\n                  }\n\n                  inputs.push(inp);\n                  includesZoom = includesZoom || inp.hasAttribute(\"type\") && inp.getAttribute(\"type\").toLowerCase() === \"zoom\";\n                  if (inp.hasAttribute('shard')) {\n                    var id = inp.getAttribute('list');\n                    inp.servers = [];\n                    var servers = serverExtent.querySelectorAll('map-datalist#'+id + ' > map-option');\n                    if (servers.length === 0 && inp.hasAttribute('value')) {\n                      servers = inp.getAttribute('value').split('');\n                    }\n                    for (var s=0;s < servers.length;s++) {\n                      if (servers[s].getAttribute) {\n                        inp.servers.push(servers[s].getAttribute('value'));\n                      } else {\n                        inp.servers.push(servers[s]);\n                      }\n                    }\n                  } else if (inp.tagName.toLowerCase() === 'map-select') {\n                    // use a throwaway div to parse the input from MapML into HTML\n                    var div =document.createElement(\"div\");\n                    div.insertAdjacentHTML(\"afterbegin\",inp.outerHTML);\n                    // parse\n                    inp.htmlselect = div.querySelector(\"map-select\");\n                    inp.htmlselect = transcribe(inp.htmlselect);\n\n                    // this goes into the layer control, so add a listener\n                    L.DomEvent.on(inp.htmlselect, 'change', layer.redraw, layer);\n                    if (!layer._userInputs) {\n                      layer._userInputs = [];\n                    }\n                    layer._userInputs.push(inp.htmlselect);\n                  }\n                  // TODO: if this is an input@type=location \n                  // get the TCRS min,max attribute values at the identified zoom level \n                  // save this information as properties of the serverExtent,\n                  // perhaps as a bounds object so that it can be easily used\n                  // later by the layer control to determine when to enable\n                  // disable the layer for drawing.\n                } else {\n                  console.log('input with name='+varName+' not found for template variable of same name');\n                  // no match found, template won't be used\n                  break;\n                }\n              }\n              if (template && vcount.length === inputs.length || template === BLANK_TT_TREF) {\n                if (trel === 'query') {\n                  layer.queryable = true;\n                }\n                if(!includesZoom && zoomInput) {\n                  inputs.push(zoomInput);\n                }\n                let step = zoomInput ? zoomInput.getAttribute(\"step\") : 1;\n                if(!step || step === \"0\" || isNaN(step)) step = 1;\n                // template has a matching input for every variable reference {varref}\n                templateVars.push({\n                  template:decodeURI(new URL(template, base)), \n                  linkEl: t,\n                  title:title, \n                  rel: trel, \n                  type: ttype, \n                  values: inputs, \n                  zoomBounds:zoomBounds,\n                  extentPCRSFallback: {bounds: extentFallback.bounds}, \n                  projectionMatch: projectionMatch,\n                  projection:serverExtent.getAttribute(\"units\") || FALLBACK_PROJECTION,\n                  tms:tms,\n                  step:step,\n                });\n              }\n            }\n            return templateVars;\n          }\n\n          function _processInitialExtent(content) {\n            //TODO: include inline extents\n              var mapml = this.responseXML || content;\n              if(mapml.querySelector && mapml.querySelector('map-feature'))layer._content = mapml;\n              if(!this.responseXML && this.responseText) mapml = new DOMParser().parseFromString(this.responseText,'text/xml');\n              if (this.readyState === this.DONE && mapml.querySelector && !mapml.querySelector(\"parsererror\")) {\n                  var serverExtent = mapml.querySelectorAll('map-extent'), projection, projectionMatch, serverMeta;\n                      \n                  \n                  if(!serverExtent.length){\n                    serverMeta = mapml.querySelector('map-meta[name=projection]');\n                  }\n\n                  // check whether all map-extent elements have the same units\n                  if(serverExtent.length >= 1){\n                    for(let i = 0; i < serverExtent.length; i++){\n                      if (serverExtent[i].tagName.toLowerCase() === \"map-extent\" && serverExtent[i].hasAttribute('units')){\n                        projection = serverExtent[i].getAttribute(\"units\");\n                      }\n                      projectionMatch = projection && projection === layer.options.mapprojection;\n                      if(!projectionMatch){\n                        break;\n                      }\n                    }\n                  } else if(serverMeta){\n                    if (serverMeta.tagName.toLowerCase() === \"map-meta\" && serverMeta.hasAttribute('content')) {\n                      projection = M.metaContentToObject(serverMeta.getAttribute('content')).content;\n                      projectionMatch = projection && projection === layer.options.mapprojection;\n                    }\n                  }  \n                  \n                  var metaExtent = mapml.querySelector('map-meta[name=extent]'),\n                      selectedAlternate = !projectionMatch && mapml.querySelector('map-head map-link[rel=alternate][projection='+layer.options.mapprojection+']'),\n                      \n                      base = \n        (new URL(mapml.querySelector('map-base') ? mapml.querySelector('map-base').getAttribute('href') : mapml.baseURI || this.responseURL, this.responseURL)).href;\n                  \n                  if (!projectionMatch && selectedAlternate && selectedAlternate.hasAttribute('href')) {\n                       \n                      layer.fire('changeprojection', {href:  (new URL(selectedAlternate.getAttribute('href'), base)).href}, false);\n                      return;\n                  } else if (!projectionMatch && layer._map && layer._map.options.mapEl.querySelectorAll(\"layer-\").length === 1){\n                    layer._map.options.mapEl.projection = projection;\n                    return;\n                  } else if (!serverMeta){\n                    layer._extent = {};\n                    if(projectionMatch){\n                      layer._extent.crs = M[projection];\n                    }\n                    layer._extent._mapExtents = []; // stores all the map-extent elements in the layer\n                    layer._extent._templateVars = []; // stores all template variables coming from all extents\n                    for(let j = 0; j < serverExtent.length; j++){\n                      if (serverExtent[j].querySelector('map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]') &&\n                          serverExtent[j].hasAttribute(\"units\")) {\n                            layer._extent._mapExtents.push(serverExtent[j]);\n                            projectionMatch = projectionMatch || selectedAlternate;\n                            let templateVars = _initTemplateVars.call(layer, serverExtent[j], metaExtent, projection, mapml, base, projectionMatch);\n                            layer._extent._mapExtents[j]._templateVars = templateVars;\n                            layer._extent._templateVars = layer._extent._templateVars.concat(templateVars);\n                          } \n                        }     \n                  } else {\n                    layer._extent = serverMeta;\n                  }  \n                  layer._parseLicenseAndLegend(mapml, layer, projection);\n\n                  var zoomin = mapml.querySelector('map-link[rel=zoomin]'),\n                      zoomout = mapml.querySelector('map-link[rel=zoomout]');\n                  delete layer._extent.zoomin;\n                  delete layer._extent.zoomout;\n                  if (zoomin) {\n                    layer._extent.zoomin = (new URL(zoomin.getAttribute('href'), base)).href;\n                  }\n                  if (zoomout) {\n                    layer._extent.zoomout = (new URL(zoomout.getAttribute('href'), base)).href;\n                  }\n                  if (layer._extent._mapExtents) {\n                    for(let i = 0; i < layer._extent._mapExtents.length; i++){\n                      if(layer._extent._mapExtents[i].templatedLayer){\n                        layer._extent._mapExtents[i].templatedLayer.reset(layer._extent._mapExtents[i]._templateVars, layer._extent._mapExtents[i].extentZIndex);\n                      }\n                    }\n                    \n                  }\n                  if (mapml.querySelector('map-tile')) {\n                    var tiles = document.createElement(\"map-tiles\"),\n                      zoom = mapml.querySelector('map-meta[name=zoom][content]') || mapml.querySelector('map-input[type=zoom][value]');\n                    tiles.setAttribute(\"zoom\", zoom && zoom.getAttribute('content') || zoom && zoom.getAttribute('value') || \"0\");\n                    var newTiles = mapml.getElementsByTagName('map-tile');\n                    for (var nt=0;nt<newTiles.length;nt++) {\n                        tiles.appendChild(document.importNode(newTiles[nt], true));\n                    }\n                    layer._mapmlTileContainer.appendChild(tiles);\n                  }\n                  M.parseStylesheetAsHTML(mapml, base, layer._container);\n\n                  // add multiple extents\n                  if(layer._extent._mapExtents){\n                    for(let j = 0; j < layer._extent._mapExtents.length; j++){\n                      var labelName = layer._extent._mapExtents[j].getAttribute('label');\n                      var extentElement = layer.getLayerExtentHTML(labelName, j);\n                      layer._extent._mapExtents[j].extentAnatomy = extentElement;\n                    }\n                  }\n\n                  var styleLinks = mapml.querySelectorAll('map-link[rel=style],map-link[rel=\"self style\"],map-link[rel=\"style self\"]');\n                  if (styleLinks.length > 1) {\n                    var stylesControl = document.createElement('details'),\n                    stylesControlSummary = document.createElement('summary');\n                    stylesControlSummary.innerText = 'Style';\n                    stylesControl.appendChild(stylesControlSummary);\n                    var changeStyle = function (e) {\n                        layer.fire('changestyle', {src: e.target.getAttribute(\"data-href\")}, false);\n                    };\n\n                    for (var j=0;j<styleLinks.length;j++) {\n                      var styleOption = document.createElement('div'),\n                      styleOptionInput = styleOption.appendChild(document.createElement('input'));\n                      styleOptionInput.setAttribute(\"type\", \"radio\");\n                      styleOptionInput.setAttribute(\"id\", \"rad-\"+L.stamp(styleOptionInput));\n                      styleOptionInput.setAttribute(\"name\", \"styles-\"+this._title);\n                      styleOptionInput.setAttribute(\"value\", styleLinks[j].getAttribute('title'));\n                      styleOptionInput.setAttribute(\"data-href\", new URL(styleLinks[j].getAttribute('href'),base).href);\n                      var styleOptionLabel = styleOption.appendChild(document.createElement('label'));\n                      styleOptionLabel.setAttribute(\"for\", \"rad-\"+L.stamp(styleOptionInput));\n                      styleOptionLabel.innerText = styleLinks[j].getAttribute('title');\n                      if (styleLinks[j].getAttribute(\"rel\") === \"style self\" || styleLinks[j].getAttribute(\"rel\") === \"self style\") {\n                        styleOptionInput.checked = true;\n                      }\n                      stylesControl.appendChild(styleOption);\n                      L.DomUtil.addClass(stylesControl,'mapml-layer-item-style mapml-control-layers');\n                      L.DomEvent.on(styleOptionInput,'click', changeStyle, layer);\n                    }\n                    layer._styles = stylesControl;\n                  }\n                  \n                  if (mapml.querySelector('map-title')) {\n                    layer._title = mapml.querySelector('map-title').textContent.trim();\n                  } else if (mapml instanceof Element && mapml.hasAttribute('label')) {\n                    layer._title = mapml.getAttribute('label').trim();\n                  }\n                  if (layer._map) {\n                      layer._validateExtent();\n                      // if the layer is checked in the layer control, force the addition\n                      // of the attribution just received\n                      if (layer._map.hasLayer(layer)) {\n                          layer._map.attributionControl.addAttribution(layer.getAttribution());\n                      }\n                      //layer._map.fire('moveend', layer);\n                  }\n              } else {\n                  layer.error = true;\n              }\n              layer.fire('extentload', layer, false);\n              layer._layerEl.dispatchEvent(new CustomEvent('extentload', {detail: layer,}));\n          }\n      },\n      _validateExtent: function () {\n        // TODO: change so that the _extent bounds are set based on inputs\n        if(!this._extent || !this._map){\n          return;\n        }\n        var serverExtent = this._extent._mapExtents ? this._extent._mapExtents : [this._extent], lp;\n          \n          // loop through the map-extent elements and assign each one its crs\n          for(let i = 0; i < serverExtent.length; i++){\n            if (!serverExtent[i].querySelector) {\n              return;\n            }\n          if (serverExtent[i].querySelector('[type=zoom][min=\"\"], [type=zoom][max=\"\"]')) {\n              var zoom = serverExtent[i].querySelector('[type=zoom]');\n              zoom.setAttribute('min',this._map.getMinZoom());\n              zoom.setAttribute('max',this._map.getMaxZoom());\n          }\n            lp = serverExtent[i].hasAttribute(\"units\") ? serverExtent[i].getAttribute(\"units\") : null;\n            if (lp && M[lp]) {\n              if(this._extent._mapExtents) this._extent._mapExtents[i].crs = M[lp];\n              else this._extent.crs = M[lp];\n            } else {\n              if(this._extent._mapExtents) this._extent._mapExtents[i].crs = M.OSMTILE;\n              else this._extent.crs = M.OSMTILE;\n            }\n          }\n      },\n      // a layer must share a projection with the map so that all the layers can\n      // be overlayed in one coordinate space.  WGS84 is a 'wildcard', sort of.\n      getProjection: function () {\n        if(!this._extent) { return; }\n        let extent = this._extent._mapExtents ? this._extent._mapExtents[0] : this._extent; // the projections for each extent eould be the same (as) validated in _validProjection, so can use mapExtents[0]\n        if(!extent) return FALLBACK_PROJECTION;\n        switch (extent.tagName.toUpperCase()) {\n          case \"MAP-EXTENT\":\n            if(extent.hasAttribute('units'))\n              return extent.getAttribute('units').toUpperCase();\n            break;\n          case \"MAP-INPUT\":\n            if(extent.hasAttribute('value'))\n              return extent.getAttribute('value').toUpperCase();\n            break;\n          case \"MAP-META\":\n            if(extent.hasAttribute('content'))\n              return M.metaContentToObject(extent.getAttribute('content')).content.toUpperCase(); \n            break;\n          default:\n            return FALLBACK_PROJECTION; \n        }\n        return FALLBACK_PROJECTION;\n      },\n      _parseLicenseAndLegend: function (xml, layer) {\n          var licenseLink =  xml.querySelector('map-link[rel=license]'), licenseTitle, licenseUrl, attText;\n          if (licenseLink) {\n              licenseTitle = licenseLink.getAttribute('title');\n              licenseUrl = licenseLink.getAttribute('href');\n              attText = '<a href=\"' + licenseUrl + '\" title=\"'+licenseTitle+'\">'+licenseTitle+'</a>';\n          }\n          L.setOptions(layer,{attribution:attText});\n          var legendLink = xml.querySelector('map-link[rel=legend]');\n          if (legendLink) {\n            layer._legendUrl = legendLink.getAttribute('href');\n          }\n      },\n      getQueryTemplates: function(pcrsClick) {\n          if (this._extent && this._extent._queries) {\n            var templates = [];\n            // only return queries that are in bounds\n            if (this._layerEl.checked && !this._layerEl.hidden && this._mapmlLayerItem) {\n              let layerAndExtents = this._mapmlLayerItem.querySelectorAll(\".mapml-layer-item-name\");\n              for(let i = 0; i < layerAndExtents.length; i++){\n                if (layerAndExtents[i].extent || this._extent._mapExtents.length === 1) { // the layer won't have an .extent property, this is kind of a hack\n                  let extent = layerAndExtents[i].extent || this._extent._mapExtents[0];\n                  for (let j = 0; j < extent._templateVars.length; j++) {\n                    if (extent.checked) {\n                      let template = extent._templateVars[j];\n                      // for each template in the extent, see if it corresponds to one in the this._extent._queries array\n                      for (let k = 0; k < this._extent._queries.length; k++) {\n                        let queryTemplate = this._extent._queries[k];\n                        if (template === queryTemplate && queryTemplate.extentBounds.contains(pcrsClick)) {\n                          templates.push(queryTemplate);\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              return templates;\n            }\n          }\n      },\n      _attachSkipButtons: function(e){\n        let popup = e.popup, map = e.target, layer, group,\n            content = popup._container.getElementsByClassName(\"mapml-popup-content\")[0];\n\n        popup._container.setAttribute(\"role\", \"dialog\");\n        content.setAttribute(\"tabindex\", \"-1\");\n        // https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/467#issuecomment-844307818\n        content.setAttribute(\"role\", \"document\");\n        popup._count = 0; // used for feature pagination\n\n        if(popup._source._eventParents){ // check if the popup is for a feature or query\n          layer = popup._source._eventParents[Object.keys(popup._source._eventParents)[0]]; // get first parent of feature, there should only be one\n          group = popup._source.group;\n        } else {\n          layer = popup._source._templatedLayer;\n        }\n\n        if(popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')){\n          L.DomUtil.remove(popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]'));\n          L.DomUtil.remove(popup._container.querySelector('hr'));\n        }\n        //add when popopen event happens instead\n        let div = L.DomUtil.create(\"nav\", \"mapml-focus-buttons\");\n\n        // creates |< button, focuses map\n        let mapFocusButton = L.DomUtil.create(\"button\", \"mapml-popup-button\", div);\n        mapFocusButton.type = \"button\";\n        mapFocusButton.title = \"Focus Map\";\n        mapFocusButton.innerHTML = \"<span aria-hidden='true'>|&#10094;</span>\";\n        L.DomEvent.on(mapFocusButton, 'click', (e)=>{\n          L.DomEvent.stop(e);\n          map.featureIndex._sortIndex();\n          map.closePopup();\n          map._container.focus();\n        }, popup);\n\n        // creates < button, focuses previous feature, if none exists focuses the current feature\n        let previousButton = L.DomUtil.create(\"button\", \"mapml-popup-button\", div);\n        previousButton.type = \"button\";\n        previousButton.title = \"Previous Feature\";\n        previousButton.innerHTML = \"<span aria-hidden='true'>&#10094;</span>\";\n        L.DomEvent.on(previousButton, 'click', layer._previousFeature, popup);\n\n        // static feature counter that 1/1\n        let featureCount = L.DomUtil.create(\"p\", \"mapml-feature-count\", div),\n            totalFeatures = this._totalFeatureCount ? this._totalFeatureCount : 1;\n        featureCount.innerText = (popup._count + 1)+\"/\"+totalFeatures;\n\n        // creates > button, focuses next feature, if none exists focuses the current feature\n        let nextButton = L.DomUtil.create(\"button\", \"mapml-popup-button\", div);\n        nextButton.type = \"button\";\n        nextButton.title = \"Next Feature\";\n        nextButton.innerHTML = \"<span aria-hidden='true'>&#10095;</span>\";\n        L.DomEvent.on(nextButton, 'click', layer._nextFeature, popup);\n        \n        // creates >| button, focuses map controls\n        let controlFocusButton = L.DomUtil.create(\"button\", \"mapml-popup-button\", div);\n        controlFocusButton.type = \"button\";\n        controlFocusButton.title = \"Focus Controls\";\n        controlFocusButton.innerHTML = \"<span aria-hidden='true'>&#10095;|</span>\";\n        L.DomEvent.on(controlFocusButton, 'click', (e) => {\n          map.featureIndex._sortIndex();\n          map.featureIndex.currentIndex = map.featureIndex.inBoundFeatures.length - 1;\n          map.featureIndex.inBoundFeatures[0].path.setAttribute(\"tabindex\", -1);\n          map.featureIndex.inBoundFeatures[map.featureIndex.currentIndex].path.setAttribute(\"tabindex\", 0);\n          L.DomEvent.stop(e);\n          map.closePopup();\n          map._controlContainer.querySelector(\"A\").focus();\n        }, popup);\n    \n        let divider = L.DomUtil.create(\"hr\");\n\n        popup._navigationBar = div;\n        popup._content.appendChild(divider);\n        popup._content.appendChild(div);\n        \n        content.focus();\n\n        if(group && !M.options.featureIndexOverlayOption) {\n          // e.target = this._map\n          // Looks for keydown, more specifically tab and shift tab\n          group.setAttribute(\"aria-expanded\", \"true\");\n          map.on(\"keydown\", focusFeature);\n        } else {\n          map.on(\"keydown\", focusMap);\n        }\n        // When popup is open, what gets focused with tab needs to be done using JS as the DOM order is not in an accessibility friendly manner\n        function focusFeature(focusEvent){\n          let path = focusEvent.originalEvent.path || focusEvent.originalEvent.composedPath();\n          let isTab = focusEvent.originalEvent.keyCode === 9,\n              shiftPressed = focusEvent.originalEvent.shiftKey;\n          if((path[0].classList.contains(\"leaflet-popup-close-button\") && isTab && !shiftPressed) || focusEvent.originalEvent.keyCode === 27){\n            setTimeout(() => {\n              L.DomEvent.stop(focusEvent);\n              map.closePopup(popup);\n              group.focus();\n            }, 0);\n          } else if ((path[0].title===\"Focus Map\" || path[0].classList.contains(\"mapml-popup-content\")) && isTab && shiftPressed){\n            setTimeout(() => { //timeout needed so focus of the feature is done even after the keypressup event occurs\n              L.DomEvent.stop(focusEvent);\n              map.closePopup(popup);\n              group.focus();\n            }, 0);\n          }\n        }\n\n        function focusMap(focusEvent){\n          let path = focusEvent.originalEvent.path || focusEvent.originalEvent.composedPath();\n          let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n\n          if((focusEvent.originalEvent.keyCode === 13 && path[0].classList.contains(\"leaflet-popup-close-button\")) || focusEvent.originalEvent.keyCode === 27 ){\n            L.DomEvent.stopPropagation(focusEvent);\n            map.closePopup(popup);\n            map._container.focus();\n            if(focusEvent.originalEvent.keyCode !== 27)map._popupClosed = true;\n          } else if (isTab && path[0].classList.contains(\"leaflet-popup-close-button\")){\n            map.closePopup(popup);\n          } else if ((path[0].title===\"Focus Map\" || path[0].classList.contains(\"mapml-popup-content\")) && isTab && shiftPressed){\n            map.closePopup(popup);\n            setTimeout(() => { //timeout needed so focus of the feature is done even after the keypressup event occurs\n              L.DomEvent.stop(focusEvent);\n              map._container.focus();\n            }, 0);\n          }\n        }\n\n        // if popup closes then the focusFeature handler can be removed\n        map.on(\"popupclose\", removeHandlers);\n        function removeHandlers(removeEvent){\n          if (removeEvent.popup === popup){\n            map.off(\"keydown\", focusFeature);\n            map.off(\"keydown\", focusMap);\n            map.off('popupclose', removeHandlers);\n            if(group) group.setAttribute(\"aria-expanded\", \"false\");\n          }\n        }\n      },\n  });\n  var mapMLLayer = function (url, node, options) {\n    if (!url && !node) return null;\n  \treturn new MapMLLayer(url, node, options);\n  };\n\n  var DebugOverlay = L.Layer.extend({\n\n    onAdd: function (map) {\n\n      let mapSize = map.getSize();\n\n      //conditionally show container for debug panel/banner only when the map has enough space for it\n      if (mapSize.x > 400 || mapSize.y > 300) {\n        this._container = L.DomUtil.create(\"table\", \"mapml-debug\", map._container);\n\n        this._panel = debugPanel({\n          className: \"mapml-debug-panel\",\n          pane: this._container,\n        });\n        map.addLayer(this._panel);\n\n      }\n\n      this._grid = debugGrid({\n        className: \"mapml-debug-grid\",\n        pane: map._panes.mapPane,\n        zIndex: 400,\n        tileSize: map.options.crs.options.crs.tile.bounds.max.x,\n      });\n      map.addLayer(this._grid);\n\n      this._vectors = debugVectors({\n        className: \"mapml-debug-vectors\",\n        pane: map._panes.mapPane,\n        toolPane: this._container,\n      });\n      map.addLayer(this._vectors);\n    },\n\n    onRemove: function (map) {\n      map.removeLayer(this._grid);\n      map.removeLayer(this._vectors);\n      if (this._panel) {  //conditionally remove the panel, as it's not always added\n        map.removeLayer(this._panel);\n        L.DomUtil.remove(this._container);\n      }\n    },\n\n  });\n\n  var debugOverlay = function () {\n    return new DebugOverlay();\n  };\n\n  var DebugPanel = L.Layer.extend({\n\n    initialize: function (options) {\n      L.setOptions(this, options);\n    },\n\n    onAdd: function (map) {\n\n      this._title = L.DomUtil.create(\"caption\", \"mapml-debug-banner\", this.options.pane);\n      this._title.innerHTML = \"Debug mode\";\n\n      map.debug = {};\n      map.debug._infoContainer = this._debugContainer = L.DomUtil.create(\"tbody\", \"mapml-debug-panel\", this.options.pane);\n\n      let infoContainer = map.debug._infoContainer;\n\n      map.debug._tileCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._tileMatrixCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._mapCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._tcrsCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._pcrsCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._gcrsCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n\n      this._map.on(\"mousemove\", this._updateCoords);\n\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._title);\n      if (this._debugContainer) {\n        L.DomUtil.remove(this._debugContainer);\n        this._map.off(\"mousemove\", this._updateCoords);\n      }\n    },\n    _updateCoords: function (e) {\n      if (this.contextMenu._visible) return;\n      let mapEl = this.options.mapEl,\n        point = mapEl._map.project(e.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointI = point.x % tileSize, pointJ = point.y % tileSize;\n\n      if (pointI < 0) pointI += tileSize;\n      if (pointJ < 0) pointJ += tileSize;\n\n      this.debug._tileCoord.innerHTML = `\n      <th scope=\"row\">tile: </th>\n      <td>i: ${Math.trunc(pointI)}, </td>\n      <td>j: ${Math.trunc(pointJ)}</td>\n      `;\n      this.debug._mapCoord.innerHTML = `\n      <th scope=\"row\">map: </th>\n      <td>i: ${Math.trunc(e.containerPoint.x)}, </td>\n      <td>j: ${Math.trunc(e.containerPoint.y)}</td>\n      `;\n      this.debug._gcrsCoord.innerHTML = `\n      <th scope=\"row\">gcrs: </th>\n      <td>lon: ${e.latlng.lng.toFixed(6)}, </td>\n      <td>lat: ${e.latlng.lat.toFixed(6)}</td>\n      `;\n      this.debug._tcrsCoord.innerHTML = `\n      <th scope=\"row\">tcrs: </th>\n      <td>x: ${Math.trunc(point.x)}, </td>\n      <td>y: ${Math.trunc(point.y)}</td>\n      `;\n      this.debug._tileMatrixCoord.innerHTML = `\n      <th scope=\"row\">tilematrix: </th>\n      <td>column: ${Math.trunc(point.x / tileSize)}, </td>\n      <td>row: ${Math.trunc(point.y / tileSize)}</td>\n      `;\n      this.debug._pcrsCoord.innerHTML = `\n      <th scope=\"row\">pcrs: </th>\n      <td>easting: ${pcrs.x.toFixed(2)}, </td>\n      <td>northing: ${pcrs.y.toFixed(2)}</td>\n      `;\n    },\n\n  });\n\n  var debugPanel = function (options) {\n    return new DebugPanel(options);\n  };\n\n  var DebugGrid = L.GridLayer.extend({\n\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.GridLayer.prototype.initialize.call(this, this._map);\n    },\n\n    createTile: function (coords) {\n      let tile = L.DomUtil.create(\"div\", \"mapml-debug-tile\");\n      tile.setAttribute(\"col\", coords.x);\n      tile.setAttribute(\"row\", coords.y);\n      tile.setAttribute(\"zoom\", coords.z);\n      tile.innerHTML = [`col: ${coords.x}`, `row: ${coords.y}`, `zoom: ${coords.z}`].join(', ');\n\n      tile.style.outline = '1px dashed red';\n      return tile;\n    },\n  });\n\n  var debugGrid = function (options) {\n    return new DebugGrid(options);\n  };\n\n  var DebugVectors = L.LayerGroup.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.LayerGroup.prototype.initialize.call(this, this._map, options);\n    },\n    onAdd: function (map) {\n      map.on('overlayremove', this._mapLayerUpdate, this);\n      map.on('overlayadd', this._mapLayerUpdate, this);\n      let center = map.options.crs.transformation.transform(L.point(0, 0), map.options.crs.scale(0));\n      this._centerVector = L.circle(map.options.crs.pointToLatLng(center, 0), { radius: 250 });\n      this._centerVector.bindTooltip(\"Projection Center\");\n\n      this._addBounds(map);\n    },\n    onRemove: function (map) {\n      this.clearLayers();\n    },\n\n    _addBounds: function (map) {\n      let id = Object.keys(map._layers),\n        layers = map._layers,\n        colors = [\"#FF5733\", \"#8DFF33\", \"#3397FF\", \"#E433FF\", \"#F3FF33\"],\n        j = 0;\n\n      this.addLayer(this._centerVector);\n\n      for (let i of id) {\n        if (layers[i].layerBounds || layers[i].extentBounds) {\n          let boundsArray;\n          if(layers[i].layerBounds){\n            boundsArray = [\n              layers[i].layerBounds.min,\n              L.point(layers[i].layerBounds.max.x, layers[i].layerBounds.min.y),\n              layers[i].layerBounds.max,\n              L.point(layers[i].layerBounds.min.x, layers[i].layerBounds.max.y)\n            ];\n          } else {\n            boundsArray = [\n              layers[i].extentBounds.min,\n              L.point(layers[i].extentBounds.max.x, layers[i].extentBounds.min.y),\n              layers[i].extentBounds.max,\n              L.point(layers[i].extentBounds.min.x, layers[i].extentBounds.max.y)\n            ];\n          }        \n          let boundsRect = projectedExtent(boundsArray, {\n            color: colors[j % colors.length],\n            weight: 2,\n            opacity: 1,\n            fillOpacity: 0.01,\n            fill: true,\n          });\n          if (layers[i].options._leafletLayer)\n            boundsRect.bindTooltip(layers[i].options._leafletLayer._title, { sticky: true });\n          this.addLayer(boundsRect);\n          j++;\n        }\n      }\n\n      if(map.totalLayerBounds){\n        let totalBoundsArray = [\n          map.totalLayerBounds.min,\n          L.point(map.totalLayerBounds.max.x, map.totalLayerBounds.min.y),\n          map.totalLayerBounds.max,\n          L.point(map.totalLayerBounds.min.x, map.totalLayerBounds.max.y)\n        ];\n\n        let totalBounds = projectedExtent(\n            totalBoundsArray,\n            {color: \"#808080\", weight: 5, opacity: 0.5, fill: false});\n        this.addLayer(totalBounds);\n      }\n    },\n\n    _mapLayerUpdate: function (e) {\n      this.clearLayers();\n      this._addBounds(e.target);\n    },\n  });\n\n  var debugVectors = function (options) {\n    return new DebugVectors(options);\n  };\n\n\n  var ProjectedExtent = L.Path.extend({\n    options: {\n      className: \"mapml-debug-extent\",\n    },\n    initialize: function (locations, options) {\n      //locations passed in as pcrs coordinates\n      this._locations = locations;\n      L.setOptions(this, options);\n    },\n\n    _project: function () {\n      this._rings = [];\n      let scale = this._map.options.crs.scale(this._map.getZoom()),\n        map = this._map;\n      for (let i = 0; i < this._locations.length; i++) {\n        let point = map.options.crs.transformation.transform(this._locations[i], scale);\n        //substract the pixel origin from the pixel coordinates to get the location relative to map viewport\n        this._rings.push(L.point(point.x, point.y)._subtract(map.getPixelOrigin()));\n      }\n      //leaflet SVG renderer looks for and array of arrays to build polygons,\n      //in this case it only deals with a rectangle so one closed array or points\n      this._parts = [this._rings];\n    },\n\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updatePoly(this, true); //passing true creates a closed path i.e. a rectangle\n    },\n\n  });\n\n  var projectedExtent = function (locations, options) {\n    return new ProjectedExtent(locations, options);\n  };\n\n  var QueryHandler = L.Handler.extend({\n      addHooks: function() {\n          // get a reference to the actual <map> element, so we can \n          // use its layers property to iterate the layers from top down\n          // evaluating if they are 'on the map' (enabled)\n          L.setOptions(this, {mapEl: this._map.options.mapEl});\n          L.DomEvent.on(this._map, 'click', this._queryTopLayer, this);\n          L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n      },\n      removeHooks: function() {\n          L.DomEvent.off(this._map, 'click', this._queryTopLayer, this);\n          L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n      },\n      _getTopQueryableLayer: function() {\n          var layers = this.options.mapEl.layers;\n          // work backwards in document order (top down)\n          for (var l=layers.length-1;l>=0;l--) {\n            var mapmlLayer = layers[l]._layer;\n            if (layers[l].checked && mapmlLayer.queryable) {\n                return mapmlLayer;\n            }\n          }\n      },\n      _queryTopLayerAtMapCenter: function (event) {\n        setTimeout(() => {\n          if (this._map.isFocused && !this._map._popupClosed && (event.originalEvent.key === \" \" || +event.originalEvent.keyCode === 13)) {\n            this._map.fire('click', { \n                latlng: this._map.getCenter(),\n                layerPoint: this._map.latLngToLayerPoint(this._map.getCenter()),\n                containerPoint: this._map.latLngToContainerPoint(this._map.getCenter())\n            });\n          } else {\n            delete this._map._popupClosed;\n          }\n        }, 0);\n      },\n      _queryTopLayer: function(event) {\n          var layer = this._getTopQueryableLayer();\n          if (layer) {\n              if(layer._mapmlFeatures) delete layer._mapmlFeatures;\n              this._query(event, layer);\n          }\n      },\n      _query(e, layer) {\n        var zoom = e.target.getZoom(),\n            map = this._map,\n            crs = layer._extent.crs, // the crs for each extent would be the same\n            tileSize = map.options.crs.options.crs.tile.bounds.max.x,\n            container = layer._container,\n            popupOptions = {autoClose: false, autoPan: true, maxHeight: (map.getSize().y * 0.5) - 50},\n            tcrs2pcrs = function (c) {\n              return crs.transformation.untransform(c,crs.scale(zoom));\n            },\n            tcrs2gcrs = function (c) {\n              return crs.unproject(crs.transformation.untransform(c,crs.scale(zoom)),zoom);\n            };\n        var tcrsClickLoc = crs.latLngToPoint(e.latlng, zoom),\n            tileMatrixClickLoc = tcrsClickLoc.divideBy(tileSize).floor(),\n            tileBounds = new L.Bounds(tcrsClickLoc.divideBy(tileSize).floor().multiplyBy(tileSize), \n            tcrsClickLoc.divideBy(tileSize).ceil().multiplyBy(tileSize));\n\n        let point = this._map.project(e.latlng),\n            scale = this._map.options.crs.scale(this._map.getZoom()),\n            pcrsClick = this._map.options.crs.transformation.untransform(point,scale);\n        let templates = layer.getQueryTemplates(pcrsClick);\n\n        var fetchFeatures = function(template, obj, lastOne) {\n          const parser = new DOMParser();\n          fetch(L.Util.template(template.template, obj), { redirect: 'follow' })\n            .then((response) => {\n              if (response.status >= 200 && response.status < 300) {\n                return response.text().then( text => {\n                  return {\n                    contenttype: response.headers.get(\"Content-Type\"),\n                    text: text\n                  };\n                });\n              } else {\n                throw new Error(response.status);\n              }\n        }).then((response) => {\n          if(!layer._mapmlFeatures) layer._mapmlFeatures = [];\n          if (response.contenttype.startsWith(\"text/mapml\")) {\n            // the mapmldoc could have <map-meta> elements that are important, perhaps\n            // also, the mapmldoc can have many features\n            let mapmldoc = parser.parseFromString(response.text, \"application/xml\"),\n                features = Array.prototype.slice.call(mapmldoc.querySelectorAll(\"map-feature\"));\n            if(features.length) layer._mapmlFeatures = layer._mapmlFeatures.concat(features);\n          } else {\n            // synthesize a single feature from text or html content\n            let geom = \"<map-geometry cs='gcrs'>\"+e.latlng.lng+\" \"+e.latlng.lat+\"</map-geometry>\",\n                feature = parser.parseFromString(\"<map-feature><map-properties>\"+\n                  response.text+\"</map-properties>\"+geom+\"</map-feature>\", \"text/html\").querySelector(\"map-feature\");\n            layer._mapmlFeatures.push(feature);\n          }\n          if(lastOne) return displayFeaturesPopup(layer._mapmlFeatures, e.latlng);\n        }).catch((err) => {\n          console.log('Looks like there was a problem. Status: ' + err.message);\n        });\n      };\n\n      for(let i = 0; i < templates.length; i++){\n\n        var obj = {},\n            template = templates[i];\n   \n        // all of the following are locations that might be used in a query, I think.\n        obj[template.query.tilei] = tcrsClickLoc.x.toFixed() - (tileMatrixClickLoc.x * tileSize);\n        obj[template.query.tilej] = tcrsClickLoc.y.toFixed() - (tileMatrixClickLoc.y * tileSize);\n        \n        // this forces the click to the centre of the map extent in the layer crs\n        obj[template.query.mapi] = (map.getSize().divideBy(2)).x.toFixed();\n        obj[template.query.mapj] = (map.getSize().divideBy(2)).y.toFixed();\n        \n        obj[template.query.pixelleft] = crs.pointToLatLng(tcrsClickLoc, zoom).lng;\n        obj[template.query.pixeltop] = crs.pointToLatLng(tcrsClickLoc, zoom).lat;\n        obj[template.query.pixelright] = crs.pointToLatLng(tcrsClickLoc.add([1,1]), zoom).lng;\n        obj[template.query.pixelbottom] = crs.pointToLatLng(tcrsClickLoc.add([1,1]), zoom).lat;\n        \n        obj[template.query.column] = tileMatrixClickLoc.x;\n        obj[template.query.row] = tileMatrixClickLoc.y;\n        obj[template.query.x] = tcrsClickLoc.x.toFixed();\n        obj[template.query.y] = tcrsClickLoc.y.toFixed();\n        \n        // whereas the layerPoint is calculated relative to the origin plus / minus any\n        // pan movements so is equal to containerPoint at first before any pans, but\n        // changes as the map pans. \n        obj[template.query.easting] =  tcrs2pcrs(tcrsClickLoc).x;\n        obj[template.query.northing] = tcrs2pcrs(tcrsClickLoc).y;\n        obj[template.query.longitude] =  tcrs2gcrs(tcrsClickLoc).lng;\n        obj[template.query.latitude] = tcrs2gcrs(tcrsClickLoc).lat;\n        obj[template.query.zoom] = zoom;\n        obj[template.query.width] = map.getSize().x;\n        obj[template.query.height] = map.getSize().y;\n        // assumes the click is at the centre of the map, per template.query.mapi, mapj above\n        obj[template.query.mapbottom] = tcrs2pcrs(tcrsClickLoc.add(map.getSize().divideBy(2))).y;\n        obj[template.query.mapleft] = tcrs2pcrs(tcrsClickLoc.subtract(map.getSize().divideBy(2))).x;\n        obj[template.query.maptop] = tcrs2pcrs(tcrsClickLoc.subtract(map.getSize().divideBy(2))).y;\n        obj[template.query.mapright] = tcrs2pcrs(tcrsClickLoc.add(map.getSize().divideBy(2))).x;\n        \n        obj[template.query.tilebottom] = tcrs2pcrs(tileBounds.max).y;\n        obj[template.query.tileleft] = tcrs2pcrs(tileBounds.min).x;\n        obj[template.query.tiletop] = tcrs2pcrs(tileBounds.min).y;\n        obj[template.query.tileright] = tcrs2pcrs(tileBounds.max).x;\n        // add hidden or other variables that may be present into the values to\n        // be processed by L.Util.template below.\n        for (var v in template.query) {\n            if ([\"mapi\",\"mapj\",\"tilei\",\"tilej\",\"row\",\"col\",\"x\",\"y\",\"easting\",\"northing\",\"longitude\",\"latitude\",\"width\",\"height\",\"zoom\",\"mapleft\",\"mapright\",\",maptop\",\"mapbottom\",\"tileleft\",\"tileright\",\"tiletop\",\"tilebottom\",\"pixeltop\",\"pixelbottom\",\"pixelleft\",\"pixelright\"].indexOf(v) < 0) {\n                obj[v] = template.query[v];\n            }\n        }\n\n        if(template.extentBounds.contains(pcrsClick)){\n          let lastOne = (i === (templates.length - 1)) ? true: false;\n          fetchFeatures(template, obj, lastOne);\n        }\n      }\n        function displayFeaturesPopup(features, loc) {\n\n          let f = M.mapMlFeatures(features, {\n              // pass the vector layer a renderer of its own, otherwise leaflet\n              // puts everything into the overlayPane\n              renderer: M.featureRenderer(),\n              // pass the vector layer the container for the parent into which\n              // it will append its own container for rendering into\n              pane: container,\n              //color: 'yellow',\n              // instead of unprojecting and then projecting and scaling,\n              // a much smarter approach would be to scale at the current\n              // zoom\n              projection: map.options.projection,\n              _leafletLayer: layer,\n              query: true,\n              static:true,\n          });\n          f.addTo(map);\n\n          let div = L.DomUtil.create(\"div\", \"mapml-popup-content\"),\n              c = L.DomUtil.create(\"iframe\");\n          c.style = \"border: none\";\n          c.srcdoc = features[0].querySelector('map-feature map-properties').innerHTML;\n          c.setAttribute(\"sandbox\",\"allow-same-origin allow-forms\");\n          div.appendChild(c);\n          // passing a latlng to the popup is necessary for when there is no\n          // geometry / null geometry\n          layer._totalFeatureCount = features.length;\n          layer.bindPopup(div, popupOptions).openPopup(loc);\n          layer.on('popupclose', function() {\n              map.removeLayer(f);\n          });\n          f.showPaginationFeature({i: 0, popup: layer._popup});\n\n        }\n      }\n  });\n\n  /*\n  MIT License related to portions of M.ContextMenu \n  Copyright (c) 2017 adam.ratcliffe@gmail.com\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the Software), \n  to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \n  and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  */\n  var ContextMenu = L.Handler.extend({\n    _touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',\n\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n\n      //setting the items in the context menu and their callback functions\n      this._items = [\n        {\n          text: M.options.locale.cmBack + \" (<kbd>B</kbd>)\",\n          callback:this._goBack,\n        },\n        {\n          text: M.options.locale.cmForward + \" (<kbd>F</kbd>)\",\n          callback:this._goForward,\n        },\n        {\n          text: M.options.locale.cmReload + \" (<kbd>R</kbd>)\",\n          callback:this._reload,\n        },\n        {\n          spacer:\"-\",\n        },\n        {\n          text: M.options.locale.cmToggleControls + \" (<kbd>T</kbd>)\",\n          callback:this._toggleControls,\n        },\n        {\n          text: M.options.locale.cmCopyCoords + \" (<kbd>C</kbd>)<span></span>\",\n          callback:this._copyCoords,\n          hideOnSelect:false,\n          popup:true,\n          submenu:[\n            {\n              text:\"tile\",\n              callback:this._copyTile,\n            },\n            {\n              text:\"tilematrix\",\n              callback:this._copyTileMatrix,\n            },\n            {\n              spacer:\"-\",\n            },\n            {\n              text:\"map\",\n              callback:this._copyMap,\n            },\n            {\n              spacer:\"-\",\n            },\n            {\n              text:\"tcrs\",\n              callback:this._copyTCRS,\n            },\n            {\n              text:\"pcrs\",\n              callback:this._copyPCRS,\n            },\n            {\n              text:\"gcrs\",\n              callback:this._copyGCRS,\n            },\n            {\n              spacer:\"-\",\n            },\n            {\n              text: M.options.locale.cmCopyAll,\n              callback:this._copyAllCoords,\n            }\n          ]\n        },\n        {\n          text: M.options.locale.cmToggleDebug + \" (<kbd>D</kbd>)\",\n          callback:this._toggleDebug,\n        },\n        {\n          text: M.options.locale.cmCopyMapML + \" (<kbd>M</kbd>)\",\n          callback:this._copyMapML,\n        },\n        {\n          text: M.options.locale.cmPasteLayer + \" (<kbd>P</kbd>)\",\n          callback:this._pasteLayer,\n        },\n        {\n          text: M.options.locale.cmViewSource + \" (<kbd>V</kbd>)\",\n          callback:this._viewSource,\n        },\n      ];\n\n      this._layerItems = [\n        {\n          text: M.options.locale.lmZoomToLayer + \" (<kbd>Z</kbd>)\",\n          callback:this._zoomToLayer\n        },\n        {\n          text: M.options.locale.lmCopyExtent + \" (<kbd>C</kbd>)\",\n          callback:this._copyLayerExtent\n        },\n        {\n          text: M.options.locale.lmCopyLayer + \" (<kbd>L</kbd>)\",\n          callback:this._copyLayer\n        },\n      ];\n      this._mapMenuVisible = false;\n      this._keyboardEvent = false;\n\n      this._container = L.DomUtil.create(\"div\", \"mapml-contextmenu\", map._container);\n      this._container.setAttribute('hidden', '');\n      \n      for (let i = 0; i < 6; i++) {\n        this._items[i].el = this._createItem(this._container, this._items[i]);\n      }\n\n      this._coordMenu = L.DomUtil.create(\"div\", \"mapml-contextmenu mapml-submenu\", this._container);\n      this._coordMenu.id = \"mapml-copy-submenu\";\n      this._coordMenu.setAttribute('hidden', '');\n\n      this._clickEvent = null;\n\n      for(let i =0;i<this._items[5].submenu.length;i++){\n        this._createItem(this._coordMenu,this._items[5].submenu[i],i);\n      }\n\n      this._items[6].el = this._createItem(this._container, this._items[6]);\n      this._items[7].el = this._createItem(this._container, this._items[7]);\n      this._items[8].el = this._createItem(this._container, this._items[8]);\n      this._items[9].el = this._createItem(this._container, this._items[9]);\n\n      this._layerMenu = L.DomUtil.create(\"div\", \"mapml-contextmenu mapml-layer-menu\", map._container);\n      this._layerMenu.setAttribute('hidden', '');\n      for (let i = 0; i < this._layerItems.length; i++) {\n        this._createItem(this._layerMenu, this._layerItems[i]);\n      }\n\n      L.DomEvent\n        .on(this._container, 'click', L.DomEvent.stop)\n        .on(this._container, 'mousedown', L.DomEvent.stop)\n        .on(this._container, 'dblclick', L.DomEvent.stop)\n        .on(this._container, 'contextmenu', L.DomEvent.stop)\n        .on(this._layerMenu, 'click', L.DomEvent.stop)\n        .on(this._layerMenu, 'mousedown', L.DomEvent.stop)\n        .on(this._layerMenu, 'dblclick', L.DomEvent.stop)\n        .on(this._layerMenu, 'contextmenu', L.DomEvent.stop);\n    },\n\n    addHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent\n        .on(container, 'mouseleave', this._hide, this)\n        .on(document, 'keydown', this._onKeyDown, this);\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.on({\n        contextmenu: this._show,\n        mousedown: this._hide,\n        zoomstart: this._hide\n      }, this);\n    },\n\n    removeHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent\n        .off(container, 'mouseleave', this._hide, this)\n        .off(document, 'keydown', this._onKeyDown, this);\n\n      if (L.Browser.touch) {\n        L.DomEvent.off(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.off({\n        contextmenu: this._show,\n        mousedown: this._hide,\n        zoomstart: this._hide\n      }, this);\n    },\n\n    _copyLayerExtent: function (e) {\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n          layerElem = context._layerClicked.layer._layerEl,\n          tL = layerElem.extent.topLeft.pcrs,\n          bR = layerElem.extent.bottomRight.pcrs;\n\n      let data = `<map-meta name=\"extent\" content=\"top-left-easting=${tL.horizontal}, top-left-northing=${tL.vertical}, bottom-right-easting=${bR.horizontal}, bottom-right-northing=${bR.vertical}\"></map-meta>`;\n      context._copyData(data);\n    },\n\n    _zoomToLayer: function (e) {\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu;\n      context._layerClicked.layer._layerEl.focus();\n    },\n\n    _copyLayer: function (e) {\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        layerElem = context._layerClicked.layer._layerEl;\n      context._copyData(layerElem.outerHTML);\n    },\n\n    _goForward: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.forward();\n    },\n\n    _goBack: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.back();\n    },\n\n    _reload: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.reload();\n    },\n\n    _toggleControls: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl._toggleControls();\n    },\n\n    _copyMapML: function(e){\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      context._copyData(mapEl.outerHTML.replace(/<div class=\"mapml-web-map\">.*?<\\/div>|<style>\\[is=\"web-map\"].*?<\\/style>|<style>mapml-viewer.*?<\\/style>/gm, \"\"));\n    },\n\n    // Add support for pasting GeoJSON in the future\n    _pasteLayer: function(e){\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      navigator.clipboard\n        .readText()\n        .then(\n            (layer) => {\n              layer = layer.replace(/(<!--.*?-->)|(<!--[\\S\\s]+?-->)|(<!--[\\S\\s]*?$)/g, '').trim();\n              if ((layer.slice(0,7) === \"<layer-\") && (layer.slice(-9) === \"</layer->\")) {\n                mapEl.insertAdjacentHTML(\"beforeend\", layer);\n              } else {\n                try {\n                  mapEl.geojson2mapml(JSON.parse(layer));\n                } catch {\n                  console.log(\"Invalid Paste!\");\n                }\n              }\n          }\n        );\n    },\n\n    _viewSource: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.viewSource();\n    },\n\n    _toggleDebug: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.toggleDebug();\n    },\n\n    _copyCoords: function(e){\n      let directory = this.contextMenu?this.contextMenu:this;\n      directory._showCoordMenu(e);\n    },\n\n    _copyData: function(data){\n      const el = document.createElement('textarea');\n      el.value = data;\n      document.body.appendChild(el);\n      el.select();\n      document.execCommand('copy');\n      document.body.removeChild(el);\n    },\n\n    _copyGCRS: function(e){\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent;\n      this.contextMenu._copyData(`z:${mapEl.zoom}, lon :${click.latlng.lng.toFixed(6)}, lat:${click.latlng.lat.toFixed(6)}`);\n    },\n\n    _copyTCRS: function(e){\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          point = mapEl._map.project(click.latlng);\n      this.contextMenu._copyData(`z:${mapEl.zoom}, x:${point.x}, y:${point.y}`);\n    },\n\n    _copyTileMatrix: function(e){\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          point = mapEl._map.project(click.latlng),\n          tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x;\n      this.contextMenu._copyData(`z:${mapEl.zoom}, column:${Math.trunc(point.x/tileSize)}, row:${Math.trunc(point.y/tileSize)}`);\n    },\n\n    _copyPCRS: function(e){\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          point = mapEl._map.project(click.latlng),\n          scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n          pcrs = mapEl._map.options.crs.transformation.untransform(point,scale);\n      this.contextMenu._copyData(`z:${mapEl.zoom}, easting:${pcrs.x.toFixed(2)}, northing:${pcrs.y.toFixed(2)}`);\n    },\n\n    _copyTile: function(e){\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          point = mapEl._map.options.crs.project(click.latlng),\n          tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n          pointX = point.x % tileSize, pointY = point.y % tileSize;\n      if(pointX < 0) pointX+= tileSize;\n      if(pointY < 0) pointY+= tileSize;\n\n      this.contextMenu._copyData(`z:${mapEl.zoom}, i:${Math.trunc(pointX)}, j:${Math.trunc(pointY)}`);\n    },\n\n    _copyMap: function(e){\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent;\n      this.contextMenu._copyData(`z:${mapEl.zoom}, i:${Math.trunc(click.containerPoint.x)}, j:${Math.trunc(click.containerPoint.y)}`);\n    },\n\n    _copyAllCoords: function(e){\n      let mapEl = this.options.mapEl,\n      click = this.contextMenu._clickEvent,\n      point = mapEl._map.project(click.latlng),\n      tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n      pointX = point.x % tileSize, pointY = point.y % tileSize,\n      scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n      pcrs = mapEl._map.options.crs.transformation.untransform(point,scale);\n      let allData = `z:${mapEl.zoom}\\n`;\n      allData += `tile: i:${Math.trunc(pointX)}, j:${Math.trunc(pointY)}\\n`;\n      allData += `tilematrix: column:${Math.trunc(point.x/tileSize)}, row:${Math.trunc(point.y/tileSize)}\\n`;\n      allData += `map: i:${Math.trunc(click.containerPoint.x)}, j:${Math.trunc(click.containerPoint.y)}\\n`;\n      allData += `tcrs: x:${Math.trunc(point.x)}, y:${Math.trunc(point.y)}\\n`;\n      allData += `pcrs: easting:${pcrs.x.toFixed(2)}, northing:${pcrs.y.toFixed(2)}\\n`;\n      allData += `gcrs: lon :${click.latlng.lng.toFixed(6)}, lat:${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(allData);\n    },\n\n    _createItem: function (container, options, index) {\n      if (options.spacer) {\n        return this._createSeparator(container, index);\n      }\n\n      var itemCls = 'mapml-contextmenu-item',\n          el = this._insertElementAt('button', itemCls, container, index),\n          callback = this._createEventHandler(el, options.callback, options.context, options.hideOnSelect),\n          html = '';\n\n      el.innerHTML = html + options.text;\n      el.setAttribute(\"type\", \"button\");\n      el.classList.add(\"mapml-button\");\n      if(options.popup){\n        el.setAttribute(\"aria-haspopup\", \"true\");\n        el.setAttribute(\"aria-expanded\", \"false\");\n        el.setAttribute(\"aria-controls\", \"mapml-copy-submenu\");\n      }\n\n      L.DomEvent\n        .on(el, 'mouseover', this._onItemMouseOver, this)\n        .on(el, 'mouseout', this._onItemMouseOut, this)\n        .on(el, 'mousedown', L.DomEvent.stopPropagation)\n        .on(el, 'click', callback);\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(el, this._touchstart, L.DomEvent.stopPropagation);\n      }\n\n      // Devices without a mouse fire \"mouseover\" on tap, but never mouseout\"\n      if (!L.Browser.pointer) {\n        L.DomEvent.on(el, 'click', this._onItemMouseOut, this);\n      }\n\n      return {\n        id: L.Util.stamp(el),\n        el: el,\n        callback: callback\n      };\n    },\n\n    _createSeparator: function (container, index) {\n      let el = this._insertElementAt('div', 'mapml-contextmenu-separator', container, index);\n\n      return {\n        id: L.Util.stamp(el),\n        el: el\n      };\n    },\n\n    _createEventHandler: function (el, func, context, hideOnSelect) {\n      let parent = this;\n\n      hideOnSelect = (hideOnSelect !== undefined) ? hideOnSelect : true;\n\n      return function (e) {\n        let map = parent._map,\n          containerPoint = parent._showLocation.containerPoint,\n          layerPoint = map.containerPointToLayerPoint(containerPoint),\n          latlng = map.layerPointToLatLng(layerPoint),\n          relatedTarget = parent._showLocation.relatedTarget,\n          data = {\n            containerPoint: containerPoint,\n            layerPoint: layerPoint,\n            latlng: latlng,\n            relatedTarget: relatedTarget\n          };\n\n        if (hideOnSelect) {\n          parent._hide();\n        }\n\n        if (func) {\n          func.call(context || map, data);\n        }\n\n        parent._map.fire('contextmenu.select', {\n          contextmenu: parent,\n          el: el\n        });\n      };\n    },\n\n    _insertElementAt: function (tagName, className, container, index) {\n        let refEl,\n            el = document.createElement(tagName);\n\n        el.className = className;\n\n        if (index !== undefined) {\n            refEl = container.children[index];\n        }\n\n        if (refEl) {\n            container.insertBefore(el, refEl);\n        } else {\n            container.appendChild(el);\n        }\n\n        return el;\n    },\n\n    _show: function (e) {\n      if(this._mapMenuVisible) this._hide();\n      this._clickEvent = e;\n      let elem = e.originalEvent.target;\n      if(elem.closest(\"fieldset\")){\n        elem = elem.closest(\"fieldset\");\n        elem = (elem.className === \"mapml-layer-extent\") ? elem.closest(\"fieldset\").parentNode.parentNode.parentNode.querySelector(\"span\") : elem.querySelector(\"span\");\n        if(!elem.layer.validProjection) return;\n        this._layerClicked = elem;\n        this._showAtPoint(e.containerPoint, e, this._layerMenu);\n      } else if(elem.classList.contains(\"leaflet-container\") || elem.classList.contains(\"mapml-debug-extent\") ||\n        elem.tagName === \"path\") {\n        this._layerClicked = undefined;\n        this._showAtPoint(e.containerPoint, e, this._container);\n      }\n      if(e.originalEvent.button === 0 || e.originalEvent.button === -1){\n        this._keyboardEvent = true;\n        if(this._layerClicked){\n          let activeEl = document.activeElement;\n          this._elementInFocus = activeEl.shadowRoot.activeElement;\n          this._layerMenuTabs = 1;\n          this._layerMenu.firstChild.focus();\n        } else {\n          this._container.firstChild.focus();\n        }\n\n      }\n    },\n\n    _showAtPoint: function (pt, data, container) {\n        if (this._items.length) {\n            let event = L.extend(data || {}, {contextmenu: this});\n\n            this._showLocation = {\n                containerPoint: pt\n            };\n\n            if (data && data.relatedTarget){\n                this._showLocation.relatedTarget = data.relatedTarget;\n            }\n\n            this._setPosition(pt,container);\n\n            if (!this._mapMenuVisible) {\n              container.removeAttribute('hidden');\n                this._mapMenuVisible = true;\n            }\n\n            this._map.fire('contextmenu.show', event);\n        }\n    },\n\n    _hide: function () {\n        if (this._mapMenuVisible) {\n            this._mapMenuVisible = false;\n            this._container.setAttribute('hidden', '');\n            this._coordMenu.setAttribute('hidden', '');\n            this._layerMenu.setAttribute('hidden', '');\n            this._map.fire('contextmenu.hide', {contextmenu: this});\n            setTimeout(() => this._map._container.focus(), 0);\n        }\n    },\n\n    _setPosition: function (pt, container) {\n        let mapSize = this._map.getSize(),\n            containerSize = this._getElementSize(container),\n            anchor;\n\n        if (this._map.options.contextmenuAnchor) {\n            anchor = L.point(this._map.options.contextmenuAnchor);\n            pt = pt.add(anchor);\n        }\n\n        container._leaflet_pos = pt;\n\n        if (pt.x + containerSize.x > mapSize.x) {\n            container.style.left = 'auto';\n            container.style.right = Math.min(Math.max(mapSize.x - pt.x, 0), mapSize.x - containerSize.x - 1) + 'px';\n        } else {\n            container.style.left = Math.max(pt.x, 0) + 'px';\n            container.style.right = 'auto';\n        }\n\n        if (pt.y + containerSize.y > mapSize.y) {\n            container.style.top = 'auto';\n            container.style.bottom = Math.min(Math.max(mapSize.y - pt.y, 0), mapSize.y - containerSize.y - 1) + 'px';\n        } else {\n            container.style.top = Math.max(pt.y, 0) + 'px';\n            container.style.bottom = 'auto';\n        }\n    },\n\n    _getElementSize: function (el) {\n        let size = this._size;\n\n        if (!size || this._sizeChanged) {\n            size = {};\n\n            el.style.left = '-999999px';\n            el.style.right = 'auto';\n\n            size.x = el.offsetWidth;\n            size.y = el.offsetHeight;\n\n            el.style.left = 'auto';\n\n            this._sizeChanged = false;\n        }\n\n        return size;\n    },\n\n     // once tab is clicked on the layer menu, change the focus back to the layer control\n     _focusOnLayerControl: function(){\n      this._mapMenuVisible = false;\n      delete this._layerMenuTabs;\n      this._layerMenu.setAttribute('hidden', '');\n      if(this._elementInFocus){\n        this._elementInFocus.focus();\n      } else {\n        this._layerClicked.parentElement.firstChild.focus();\n      }\n      delete this._elementInFocus;\n    },\n\n    _onKeyDown: function (e) {\n      if(!this._mapMenuVisible) return;\n\n      let key = e.keyCode;\n      let path = e.path || e.composedPath();\n\n      if(key === 13)\n        e.preventDefault();\n      // keep track of where the focus is on the layer menu and when the layer menu is tabbed out of, focus on layer control\n      if(this._layerMenuTabs && (key === 9 || key === 27)){\n        if(e.shiftKey){\n          this._layerMenuTabs -= 1;\n        } else {\n          this._layerMenuTabs += 1;\n        }\n        if(this._layerMenuTabs === 0 || this._layerMenuTabs === 4 || key === 27){\n          L.DomEvent.stop(e);\n          this._focusOnLayerControl();\n        } \n      } else if(key !== 16 && key!== 9 && !(!this._layerClicked && key === 67) && path[0].innerText !== (M.options.locale.cmCopyCoords + \" (C)\")){\n        this._hide();\n      }\n      switch(key){\n        case 13:  //ENTER KEY\n        case 32:  //SPACE KEY\n          if(this._map._container.parentNode.activeElement.parentNode.classList.contains(\"mapml-contextmenu\"))\n            this._map._container.parentNode.activeElement.click();\n          break;\n        case 66: //B KEY\n          this._goBack(e);\n          break;\n        case 67: //C KEY\n          if(this._layerClicked){\n            this._copyLayerExtent(e);\n          } else {\n            this._copyCoords({\n              latlng:this._map.getCenter()\n            });\n          }\n          break;\n        case 68: //D KEY\n          this._toggleDebug(e);\n          break;\n        case 77: //M KEY\n          this._copyMapML(e);\n          break;\n        case 70: //F KEY\n          this._goForward(e);\n          break;\n        case 76: //L KEY\n          if(this._layerClicked)\n            this._copyLayer(e);\n          break;\n        case 80: //P KEY\n          this._pasteLayer(e);\n          break;\n        case 82: //R KEY\n          this._reload(e);\n          break;\n        case 84: //T KEY\n          this._toggleControls(e);\n          break;\n        case 86: //V KEY\n          this._viewSource(e);\n          break;\n        case 90: //Z KEY\n          if(this._layerClicked)\n            this._zoomToLayer(e);\n          break;\n      }\n    },\n\n    _showCoordMenu: function(e){\n      let mapSize = this._map.getSize(),\n          click = this._clickEvent,\n          menu = this._coordMenu,\n          copyEl = this._items[5].el.el;\n\n      copyEl.setAttribute(\"aria-expanded\",\"true\");\n      menu.removeAttribute('hidden');\n\n      if (click.containerPoint.x + 160 + 80 > mapSize.x) {\n        menu.style.left = 'auto';\n        menu.style.right = 160 + 'px';\n      } else {\n        menu.style.left = 160 + 'px';\n        menu.style.right = 'auto';\n      }\n\n      if (click.containerPoint.y + 160 > mapSize.y) {\n        menu.style.top = 'auto';\n        menu.style.bottom = 20 + 'px';\n      } else {\n        menu.style.top = 100 + 'px';\n        menu.style.bottom = 'auto';\n      }\n      if(this._keyboardEvent)menu.firstChild.focus();\n    },\n\n    _hideCoordMenu: function(e){\n      if(e.srcElement.parentElement.classList.contains(\"mapml-submenu\") ||\n          e.srcElement.innerText === (M.options.locale.cmCopyCoords + \" (C)\"))return;\n      let menu = this._coordMenu, copyEl = this._items[5].el.el;\n      copyEl.setAttribute(\"aria-expanded\",\"false\");\n      menu.setAttribute('hidden', '');\n    },\n\n    _onItemMouseOver: function (e) {\n      L.DomUtil.addClass(e.target || e.srcElement, 'over');\n      if(e.srcElement.innerText === (M.options.locale.cmCopyCoords + \" (C)\")) this._showCoordMenu(e);\n    },\n\n    _onItemMouseOut: function (e) {\n      L.DomUtil.removeClass(e.target || e.srcElement, 'over');\n      this._hideCoordMenu(e);\n    }\n  });\n\n  var Util = {\n    convertAndFormatPCRS : function(pcrsBounds, map){\n      if(!pcrsBounds || !map) return {};\n\n      let tcrsTopLeft = [], tcrsBottomRight = [],\n          tileMatrixTopLeft = [], tileMatrixBottomRight = [],\n          tileSize = map.options.crs.options.crs.tile.bounds.max.y;\n\n      for(let i = 0;i<map.options.crs.options.resolutions.length;i++){\n        let scale = map.options.crs.scale(i),\n            minConverted = map.options.crs.transformation.transform(pcrsBounds.min,scale),\n            maxConverted = map.options.crs.transformation.transform(pcrsBounds.max,scale);\n            \n        tcrsTopLeft.push({\n          horizontal: minConverted.x,\n          vertical:maxConverted.y,\n        });\n        tcrsBottomRight.push({\n          horizontal: maxConverted.x,\n          vertical: minConverted.y,\n        });\n\n        //converts the tcrs values from earlier to tilematrix\n        tileMatrixTopLeft.push({\n          horizontal: tcrsTopLeft[i].horizontal / tileSize,\n          vertical:tcrsTopLeft[i].vertical / tileSize,\n        });\n        tileMatrixBottomRight.push({\n          horizontal: tcrsBottomRight[i].horizontal / tileSize,\n          vertical: tcrsBottomRight[i].vertical / tileSize,\n        });\n      }\n      \n      //converts the gcrs, I believe it can take any number values from -inf to +inf\n      let unprojectedMin = map.options.crs.unproject(pcrsBounds.min),\n          unprojectedMax = map.options.crs.unproject(pcrsBounds.max);\n\n      let gcrs = {\n        topLeft:{\n          horizontal: unprojectedMin.lng,\n          vertical:unprojectedMax.lat,\n        },\n        bottomRight:{\n          horizontal: unprojectedMax.lng,\n          vertical: unprojectedMin.lat,\n        },\n      };\n\n      //formats known pcrs bounds to correct format\n      let pcrs = {\n        topLeft:{\n          horizontal:pcrsBounds.min.x,\n          vertical:pcrsBounds.max.y,\n        },\n        bottomRight:{\n          horizontal:pcrsBounds.max.x,\n          vertical:pcrsBounds.min.y,\n        },\n      };\n\n      //formats all extent data\n      return {\n        topLeft:{\n          tcrs:tcrsTopLeft,\n          tilematrix:tileMatrixTopLeft,\n          gcrs:gcrs.topLeft,\n          pcrs:pcrs.topLeft,\n        },\n        bottomRight:{\n          tcrs:tcrsBottomRight,\n          tilematrix:tileMatrixBottomRight,\n          gcrs:gcrs.bottomRight,\n          pcrs:pcrs.bottomRight,\n        },\n        projection:map.options.projection\n      };\n    },\n    extractInputBounds: function(template){\n      if(!template) return undefined;\n\n      //sets variables with their respective fallback values incase content is missing from the template\n      let inputs = template.values, projection = template.projection || FALLBACK_PROJECTION, value = 0, boundsUnit = FALLBACK_CS;\n      let bounds = this[projection].options.crs.tilematrix.bounds(0), \n          defaultMinZoom = 0, defaultMaxZoom = this[projection].options.resolutions.length - 1,\n          nativeMinZoom = defaultMinZoom, nativeMaxZoom = defaultMaxZoom;\n      let locInputs = false, numberOfAxes = 0;\n      for(let i=0;i<inputs.length;i++){\n        switch(inputs[i].getAttribute(\"type\")){\n          case \"zoom\":\n            nativeMinZoom = +(inputs[i].hasAttribute(\"min\") && !isNaN(+inputs[i].getAttribute(\"min\")) ? inputs[i].getAttribute(\"min\") : defaultMinZoom);\n            nativeMaxZoom = +(inputs[i].hasAttribute(\"max\") && !isNaN(+inputs[i].getAttribute(\"max\")) ? inputs[i].getAttribute(\"max\") : defaultMaxZoom);\n            value = +inputs[i].getAttribute(\"value\");\n          break;\n          case \"location\":\n            if(!inputs[i].getAttribute(\"max\") || !inputs[i].getAttribute(\"min\")) continue;\n            let max = +inputs[i].getAttribute(\"max\"),min = +inputs[i].getAttribute(\"min\");\n            switch(inputs[i].getAttribute(\"axis\").toLowerCase()){\n              case \"x\":\n              case \"longitude\":\n              case \"column\":\n              case \"easting\":\n                boundsUnit = M.axisToCS(inputs[i].getAttribute(\"axis\").toLowerCase());\n                bounds.min.x = min;\n                bounds.max.x = max;\n                numberOfAxes++;\n              break;\n              case \"y\":\n              case \"latitude\":\n              case \"row\":\n              case \"northing\":\n                boundsUnit = M.axisToCS(inputs[i].getAttribute(\"axis\").toLowerCase());\n                bounds.min.y = min;\n                bounds.max.y = max;\n                numberOfAxes++;\n              break;\n            }\n          break;\n        }\n      }\n      if (numberOfAxes >= 2) {\n        locInputs = true;\n      }\n      // min/maxZoom are copied from <meta name=zoom content=\"min=n,max=m>, are *display* range for content\n      // min/maxNativeZoom are received from <input type=zoom min=... max=...>, describe *server* content availability\n      let zoomBounds = {\n        minZoom: template.zoomBounds?.min && !isNaN(+template.zoomBounds.min) ? +template.zoomBounds.min : defaultMinZoom,\n        maxZoom: template.zoomBounds?.max && !isNaN(+template.zoomBounds.max) ? +template.zoomBounds.max : defaultMaxZoom,\n        minNativeZoom: nativeMinZoom,\n        maxNativeZoom: nativeMaxZoom\n      };\n      if(!locInputs && template.extentPCRSFallback && template.extentPCRSFallback.bounds) {\n        bounds = template.extentPCRSFallback.bounds;\n      } else if (locInputs) {\n        bounds = this.boundsToPCRSBounds(bounds,value,projection,boundsUnit);\n      } else {\n        bounds = this[projection].options.crs.pcrs.bounds;\n      }\n      return {\n        zoomBounds: zoomBounds,\n        bounds: bounds\n      };\n    },\n\n    axisToCS : function(axis){\n      try{\n        switch(axis.toLowerCase()){\n          case \"row\":\n          case \"column\":\n            return \"TILEMATRIX\";\n          case \"i\":\n          case \"j\":\n            return [\"MAP\",\"TILE\"];\n          case \"x\":\n          case \"y\":\n            return \"TCRS\";\n          case \"latitude\":\n          case \"longitude\":\n            return \"GCRS\";\n          case \"northing\":\n          case \"easting\":\n            return \"PCRS\";\n          default:\n            return FALLBACK_CS;\n        }\n      } catch (e) {return undefined;}\n    },\n\n    //takes a given cs and retuns the axes, first horizontal then vertical\n    csToAxes: function(cs){\n      try{\n        switch(cs.toLowerCase()){\n          case \"tilematrix\":\n            return [\"column\", \"row\"];\n          case \"map\":\n          case \"tile\":\n            return [\"i\", \"j\"];\n          case \"tcrs\":\n            return [\"x\", \"y\"];\n          case \"gcrs\":\n            return [\"longitude\", \"latitude\"];\n          case \"pcrs\":\n            return [\"easting\", \"northing\"];\n        }\n      } catch (e) {return undefined;}\n    },\n\n    axisToXY: function(axis){\n      try{\n        switch(axis.toLowerCase()){\n          case \"i\":\n          case \"column\":\n          case \"longitude\":\n          case \"x\":\n          case \"easting\":\n            return \"x\";\n          case \"row\":\n          case \"j\":\n          case \"latitude\":\n          case \"y\":\n          case \"northing\":\n            return \"y\";\n\n          default:\n            return undefined;\n        }\n      } catch (e) {return undefined;}\n    },\n\n    convertPCRSBounds: function(pcrsBounds, zoom, projection, cs){\n      if(!pcrsBounds || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !projection || !cs) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      switch (cs.toUpperCase()) {\n        case \"PCRS\":\n          return pcrsBounds;\n        case \"TCRS\":\n        case \"TILEMATRIX\":\n          let minPixel = projection.transformation.transform(pcrsBounds.min, projection.scale(+zoom)),\n              maxPixel = projection.transformation.transform(pcrsBounds.max, projection.scale(+zoom));\n          if (cs.toUpperCase() === \"TCRS\") return L.bounds(minPixel, maxPixel);\n          let tileSize = projection.options.crs.tile.bounds.max.x;\n          return L.bounds(L.point(minPixel.x / tileSize, minPixel.y / tileSize), L.point(maxPixel.x / tileSize,maxPixel.y / tileSize)); \n        case \"GCRS\":\n          let minGCRS = projection.unproject(pcrsBounds.min),\n              maxGCRS = projection.unproject(pcrsBounds.max);\n          return L.bounds(L.point(minGCRS.lng, minGCRS.lat), L.point(maxGCRS.lng, maxGCRS.lat)); \n        default:\n          return undefined;\n      }\n    },\n\n    pointToPCRSPoint: function(point, zoom, projection, cs){\n      if(!point || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !cs || !projection) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      let tileSize = projection.options.crs.tile.bounds.max.x;\n      switch(cs.toUpperCase()){\n        case \"TILEMATRIX\":\n          return M.pixelToPCRSPoint(L.point(point.x*tileSize,point.y*tileSize),zoom,projection);\n        case \"PCRS\":\n          return point;\n        case \"TCRS\" :\n          return M.pixelToPCRSPoint(point,zoom,projection);\n        case \"GCRS\":\n          return projection.project(L.latLng(point.y,point.x));\n        default:\n          return undefined;\n      }\n    },\n\n    pixelToPCRSPoint: function(point, zoom, projection){\n      if(!point || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !projection) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      return projection.transformation.untransform(point,projection.scale(zoom));\n    },\n\n    boundsToPCRSBounds: function(bounds, zoom, projection, cs){\n      if(!bounds || !bounds.max || !bounds.min || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !projection || !cs) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      return L.bounds(M.pointToPCRSPoint(bounds.min, zoom, projection, cs), M.pointToPCRSPoint(bounds.max, zoom, projection, cs));\n    },\n\n    //L.bounds have fixed point positions, where min is always topleft, max is always bottom right, and the values are always sorted by leaflet\n    //important to consider when working with pcrs where the origin is not topleft but rather bottomleft, could lead to confusion\n    pixelToPCRSBounds : function(bounds, zoom, projection){\n      if(!bounds || !bounds.max || !bounds.min || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !projection) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      return L.bounds(M.pixelToPCRSPoint(bounds.min, zoom, projection), M.pixelToPCRSPoint(bounds.max, zoom, projection));\n    },\n    //meta content is the content attribute of meta\n    // input \"max=5,min=4\" => [[max,5][min,5]]\n    metaContentToObject: function(input){\n      if(!input || input instanceof Object)return {};\n      let content = input.split(/\\s+/).join(\"\");\n      let contentArray = {};\n      let stringSplit = content.split(',');\n\n      for(let i=0;i<stringSplit.length;i++){\n        let prop = stringSplit[i].split(\"=\");\n        if(prop.length === 2) contentArray[prop[0]]=prop[1];\n      }\n      if(contentArray !== \"\" && stringSplit[0].split(\"=\").length ===1)contentArray.content = stringSplit[0];\n      return contentArray;\n    },\n    coordsToArray: function(containerPoints) {\n      // returns an array of arrays of coordinate pairs coordsToArray(\"1,2,3,4\") -> [[1,2],[3,4]]\n      for (var i=1, pairs = [], coords = containerPoints.split(\",\");i<coords.length;i+=2) {\n        pairs.push([parseInt(coords[i-1]),parseInt(coords[i])]);\n      }\n      return pairs;\n    },\n    parseStylesheetAsHTML: function(mapml, base, container) {\n        if (!(container instanceof Element) || !mapml || !mapml.querySelector('map-link[rel=stylesheet],map-style')) return;\n\n        if(base instanceof Element) {\n          base = base.getAttribute('href')?base.getAttribute('href'):document.URL;\n        } else if (!base || base===\"\" || base instanceof Object) {\n          return;\n        }\n\n        var ss = [];\n        var stylesheets = mapml.querySelectorAll('map-link[rel=stylesheet],map-style');\n        for (var i=0;i<stylesheets.length;i++) {\n          if (stylesheets[i].nodeName.toUpperCase() === \"MAP-LINK\" ) {\n            var href = stylesheets[i].hasAttribute('href') ? new URL(stylesheets[i].getAttribute('href'),base).href: null;\n            if (href) {\n              if (!container.querySelector(\"link[href='\"+href+\"']\")) {\n                var linkElm = document.createElement(\"link\");\n                linkElm.setAttribute(\"href\", href);\n                linkElm.setAttribute(\"rel\", \"stylesheet\");\n                ss.push(linkElm);\n              }\n            }  \n          } else { // <map-style>\n              var styleElm = document.createElement('style');\n              styleElm.textContent = stylesheets[i].textContent;\n              ss.push(styleElm);\n          }\n        }\n        // insert <link> or <style> elements after the begining  of the container\n        // element, in document order as copied from original mapml document\n        // note the code below assumes hrefs have been resolved and elements\n        // re-parsed from xml and serialized as html elements ready for insertion\n        for (var s=ss.length-1;s >= 0;s--) {\n          container.insertAdjacentElement('afterbegin',ss[s]);\n        }\n    },\n\n    splitCoordinate: function(element, index, array) {\n      var a = [];\n      element.split(/\\s+/gim).forEach(M.parseNumber,a);\n      this.push(a);\n    },\n\n    parseNumber : function(element, index, array){\n      this.push(parseFloat(element));\n    },\n\n    handleLink: function (link, leafletLayer) {\n      let zoomTo, justPan = false, layer, map = leafletLayer._map, opacity;\n      if(link.type === \"text/html\" && link.target !== \"_blank\"){  // all other target values other than blank behave as _top\n        link.target = \"_top\";\n      } else if (link.type !== \"text/html\" && link.url.includes(\"#\")){\n        let hash = link.url.split(\"#\"), loc = hash[1].split(\",\");\n        zoomTo = {z: loc[0] || 0, lng: loc[1] || 0, lat: loc[2] || 0};\n        justPan = !hash[0]; // if the first half of the array is an empty string then the link is just for panning\n        if([\"/\", \".\",\"#\"].includes(link.url[0])) link.target = \"_self\";\n      }\n      if(!justPan) {\n        let newLayer = false;\n        layer = document.createElement('layer-');\n        layer.setAttribute('src', link.url);\n        layer.setAttribute('checked', '');\n        switch (link.target) {\n          case \"_blank\":\n            if (link.type === \"text/html\") {\n              window.open(link.url);\n            } else {\n              map.options.mapEl.appendChild(layer);\n              newLayer = true;\n            }\n            break;\n          case \"_parent\":\n            for (let l of map.options.mapEl.querySelectorAll(\"layer-\"))\n              if (l._layer !== leafletLayer) map.options.mapEl.removeChild(l);\n            map.options.mapEl.appendChild(layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            newLayer = true;\n            break;\n          case \"_top\":\n            window.location.href = link.url;\n            break;\n          default:\n            opacity = leafletLayer._layerEl.opacity;\n            leafletLayer._layerEl.insertAdjacentElement('beforebegin', layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            newLayer = true;\n        }\n        if(!link.inPlace && newLayer) L.DomEvent.on(layer,'extentload', function focusOnLoad(e) {\n          if(newLayer && [\"_parent\", \"_self\"].includes(link.target) && layer.parentElement.querySelectorAll(\"layer-\").length === 1)\n            layer.parentElement.projection = layer._layer.getProjection();\n          if(layer.extent){\n            if(zoomTo) layer.parentElement.zoomTo(+zoomTo.lat, +zoomTo.lng, +zoomTo.z);\n            else layer.focus();\n            L.DomEvent.off(layer, 'extentload', focusOnLoad);\n          }\n\n          if(opacity) layer.opacity = opacity;\n          map.getContainer().focus();\n        });\n      } else if (zoomTo && !link.inPlace && justPan){\n        leafletLayer._map.options.mapEl.zoomTo(+zoomTo.lat, +zoomTo.lng, +zoomTo.z);\n        if(opacity) layer.opacity = opacity;\n      }\n    },\n\n    gcrsToTileMatrix: function (mapEl) {\n      let point = mapEl._map.project(mapEl._map.getCenter());\n      let tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.y;\n      let column = Math.trunc(point.x / tileSize);\n      let row = Math.trunc(point.y / tileSize);\n      return [column, row];\n    },\n\n    // Takes GeoJSON Properties to return an HTML table, helper function\n    //    for geojson2mapml\n    // properties2Table: geojson -> HTML Table\n    properties2Table: function (json) {\n      let table = document.createElement('table');\n\n      // Creating a Table Header\n      let thead = table.createTHead();\n      let row = thead.insertRow();\n      let th1 = document.createElement(\"th\");\n      let th2 = document.createElement(\"th\");\n      th1.appendChild(document.createTextNode(\"Property name\"));\n      th2.appendChild(document.createTextNode(\"Property value\"));\n      th1.setAttribute(\"role\", \"columnheader\");\n      th2.setAttribute(\"role\", \"columnheader\");\n      th1.setAttribute(\"scope\", \"col\");\n      th2.setAttribute(\"scope\", \"col\");\n      row.appendChild(th1);\n      row.appendChild(th2);\n\n      // Creating table body and populating it from the JSON\n      let tbody = table.createTBody();\n      for (let key in json) {\n          if (json.hasOwnProperty(key)) {\n              let row = tbody.insertRow();\n              let th = document.createElement(\"th\");\n              let td = document.createElement(\"td\");\n              th.appendChild(document.createTextNode(key));\n              td.appendChild(document.createTextNode(json[key]));\n              th.setAttribute(\"scope\", \"row\");\n              td.setAttribute(\"itemprop\", key);\n              row.appendChild(th);\n              row.appendChild(td);\n          }\n      }\n      return table;\n    },\n\n    // Takes bbox array and a x,y coordinate to possibly update the extent, returns extent\n    //    for geojson2mapml\n    // updateExtent: [min x, min y, max x, max y], x, y -> [min x, min y, max x, max y]\n    updateExtent: function (bboxExtent, x, y) {\n      if (bboxExtent === {}) {\n        return bboxExtent;\n      }\n      bboxExtent[0] = Math.min(x, bboxExtent[0]);\n      bboxExtent[1] = Math.min(y, bboxExtent[1]);\n      bboxExtent[2] = Math.max(x, bboxExtent[2]);\n      bboxExtent[3] = Math.max(y, bboxExtent[3]);\n      return bboxExtent;\n    },\n\n    // Takes a GeoJSON geojson and an options Object which returns a <layer-> Element\n    // The options object can contain the following:\n    //      label            - String, contains the layer name, if included overrides the default label mapping\n    //      projection       - String, contains the projection of the layer (OSMTILE, WGS84, CBMTILE, APSTILE), defaults to   OSMTILE\n    //      caption          - Function | String, function accepts one argument being the feature object which produces the   featurecaption string OR a string that is the name of the property that will be mapped to featurecaption\n    //      properties       - Function | String | HTMLElement, a function which maps the geojson feature to an HTMLElement   or a string that will be parsed as an HTMLElement or an HTMLElement\n    //      geometryFunction - Function, A function you supply that can add classes, hyperlinks and spans to the created  <map-geometry> element, default would be the plain map-geometry element\n    // geojson2mapml: geojson Object <layer-> [min x, min y, max x, max y] -> <layer->\n    geojson2mapml: function (json, options = {}, layer = null, bboxExtent={}) {\n      let defaults = {\n          label: null,\n          projection: \"OSMTILE\",\n          caption: null,\n          properties: null,\n          geometryFunction: null\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      // If string json is received\n      if (typeof json === \"string\") {\n          json = JSON.parse(json);\n      }\n      let geometryType = [\"POINT\", \"LINESTRING\", \"POLYGON\", \"MULTIPOINT\", \"MULTILINESTRING\", \"MULTIPOLYGON\", \"GEOMETRYCOLLECTION\"];\n      let jsonType = json.type.toUpperCase();\n      let out = \"\";\n      let setExtent = false;\n\n      // HTML parser\n      let parser = new DOMParser();\n\n      // initializing layer\n      if (layer === null) {\n          if (!json.bbox) {\n            setExtent = true;\n          }\n          // creating an empty mapml layer\n          let xmlStringLayer = \"<layer- label='' checked><map-meta name='projection' content='\" + options.projection + \"'></map-meta><map-meta name='cs' content='gcrs'></map-meta></layer->\";\n          layer = parser.parseFromString(xmlStringLayer, \"text/html\");\n          //console.log(layer)\n          if (options.label !== null) {\n              layer.querySelector(\"layer-\").setAttribute(\"label\", options.label);\n          } else if (json.name) {\n              layer.querySelector(\"layer-\").setAttribute(\"label\", json.name);\n          } else if (json.title) {\n              layer.querySelector(\"layer-\").setAttribute(\"label\", json.title);\n          } else {\n              layer.querySelector(\"layer-\").setAttribute(\"label\", M.options.locale.dfLayer);\n          }\n      }\n      let point = \"<map-point></map-point>\";\n      point = parser.parseFromString(point, \"text/html\");\n\n      let multiPoint = \"<map-multipoint><map-coordinates></map-coordinates></map-multipoint>\";\n      multiPoint = parser.parseFromString(multiPoint, \"text/html\");\n\n      let linestring = \"<map-linestring><map-coordinates></map-coordinates></map-linestring>\";\n      linestring = parser.parseFromString(linestring, \"text/html\");\n\n      let multilinestring = \"<map-multilinestring></map-multilinestring>\";\n      multilinestring = parser.parseFromString(multilinestring, \"text/html\");\n\n      let polygon = \"<map-polygon></map-polygon>\";\n      polygon = parser.parseFromString(polygon, \"text/html\");\n\n      let multiPolygon = \"<map-multipolygon></map-multipolygon>\";\n      multiPolygon = parser.parseFromString(multiPolygon, \"text/html\");\n\n      let geometrycollection = \"<map-geometrycollection></map-geometrycollection>\";\n      geometrycollection = parser.parseFromString(geometrycollection, \"text/html\");\n\n      let feature = \"<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>\";\n      feature = parser.parseFromString(feature, \"text/html\");\n\n      // Template to add coordinates to Geometries\n      let coords = \"<map-coordinates></map-coordinates>\";\n      coords = parser.parseFromString(coords, \"text/html\");\n      \n      //console.log(layer);\n      if (jsonType === \"FEATURECOLLECTION\") {\n          \n          // Setting bbox if it exists\n          if (json.bbox) {\n              layer.querySelector(\"layer-\").insertAdjacentHTML(\"afterbegin\", \"<map-meta name='extent' content='top-left-longitude=\" + json.bbox[0] + \", top-left-latitude=\" + json.bbox[1] + \", bottom-right-longitude=\" + json.bbox[2] + \",bottom-right-latitude=\" + json.bbox[3] + \"'></map-meta>\");\n          } else {\n            bboxExtent = [Infinity, Infinity, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY];\n          }\n\n          let features = json.features;\n          //console.log(\"Features length - \" + features.length);\n          for (let l=0;l<features.length;l++) {\n              M.geojson2mapml(features[l], options, layer, bboxExtent);\n          }\n      } else if (jsonType === \"FEATURE\") {\n\n          let clone_feature = feature.cloneNode(true);\n          let curr_feature = clone_feature.querySelector('map-feature');\n\n          // Setting featurecaption\n          let featureCaption = layer.querySelector(\"layer-\").getAttribute('label');\n          if (typeof options.caption === \"function\") {\n              featureCaption = options.caption(json);\n          } else if (typeof options.caption === \"string\") {\n              featureCaption = json.properties[options.caption];\n              // if property does not exist\n              if (featureCaption === undefined) {\n                  featureCaption = options.caption;\n              }\n          } else if (json.id) { // when no caption option available try setting id as featurecaption\n            featureCaption = json.id;\n          } \n          curr_feature.querySelector(\"map-featurecaption\").innerHTML = featureCaption;\n\n          // Setting Properties\n          let p;\n          // if properties function is passed\n          if (typeof options.properties === \"function\") {\n              p = options.properties(json);\n              // if function output is not an element, ignore the properties.\n              if (!(p instanceof Element)) {\n                  p = false;\n                  console.error(\"options.properties function returns a string instead of an HTMLElement.\");\n              }\n          } else if (typeof options.properties === \"string\") { // if properties string is passed\n              curr_feature.querySelector('map-properties').insertAdjacentHTML(\"beforeend\", options.properties);\n              p = false;\n          } else if (options.properties instanceof HTMLElement) { // if an HTMLElement is passed - NOT TESTED\n              p = options.properties;\n          } else { // If no properties function, string or HTMLElement is passed\n              p = M.properties2Table(json.properties);\n          }\n          \n          if (p) {\n              curr_feature.querySelector('map-properties').appendChild(p);\n          }\n\n          // Setting map-geometry\n          let g = M.geojson2mapml(json.geometry, options, layer, bboxExtent);\n          if (typeof options.geometryFunction === \"function\") {\n              curr_feature.querySelector('map-geometry').appendChild(options.geometryFunction(g, json));\n          } else {\n              curr_feature.querySelector('map-geometry').appendChild(g);\n          }\n          \n          // Appending feature to layer\n          layer.querySelector('layer-').appendChild(curr_feature);\n          \n      } else if (geometryType.includes(jsonType)) {\n          //console.log(\"Geometry Type - \" + jsonType);\n          switch(jsonType){\n              case \"POINT\":\n                  bboxExtent = M.updateExtent(bboxExtent, json.coordinates[0], json.coordinates[1]);\n                  out = json.coordinates[0] + \" \" + json.coordinates[1];\n                  \n                  // Create Point element\n                  let clone_point = point.cloneNode(true);\n                  clone_point = clone_point.querySelector('map-point');\n\n                  // Create map-coords to add to the polygon\n                  let clone_coords = coords.cloneNode(true);\n                  clone_coords = clone_coords.querySelector(\"map-coordinates\");\n\n                  clone_coords.innerHTML = out;\n\n                  clone_point.appendChild(clone_coords);\n                  //console.log(clone_point);\n                  return clone_point;\n\n              case \"LINESTRING\":\n                  let clone_linestring = linestring.cloneNode(true);\n                  let linestring_coordindates = clone_linestring.querySelector(\"map-coordinates\");\n                  \n                  out = \"\";\n\n                  for (let x=0;x<json.coordinates.length;x++) {\n                      bboxExtent = M.updateExtent(bboxExtent, json.coordinates[x][0], json.coordinates[x][1]);\n                      out = out + json.coordinates[x][0] + \" \" + json.coordinates[x][1] + \" \";\n                  }\n\n                  linestring_coordindates.innerHTML = out;\n                  //console.log(clone_linestring.querySelector('map-linestring'));\n                  return (clone_linestring.querySelector('map-linestring'));\n\n              case \"POLYGON\":\n                  let clone_polygon = polygon.cloneNode(true);\n                  clone_polygon = clone_polygon.querySelector(\"map-polygon\");\n                  \n                  // Going over each coordinates\n                  for (let y=0;y<json.coordinates.length;y++) {\n                      let out = \"\";\n                      let clone_coords = coords.cloneNode(true);\n                      clone_coords = clone_coords.querySelector(\"map-coordinates\");\n\n                      // Going over coordinates for the polygon\n                      for (let x=0;x<json.coordinates[y].length;x++) {\n                          bboxExtent = M.updateExtent(bboxExtent, json.coordinates[y][x][0], json.coordinates[y][x][1]);\n                          out = out + json.coordinates[y][x][0] + \" \" + json.coordinates[y][x][1] + \" \";\n                      }\n\n                      // Create map-coordinates element and append it to clone_polygon\n                      clone_coords.innerHTML = out;\n\n                      clone_polygon.appendChild(clone_coords);\n                  }\n                  //console.log(clone_polygon);\n                  return clone_polygon;\n\n              case \"MULTIPOINT\":\n                  out = \"\";\n                  // Create multipoint element\n                  let clone_multipoint = multiPoint.cloneNode(true);\n                  clone_multipoint = clone_multipoint.querySelector('map-multipoint');\n\n                  for (let i=0;i<json.coordinates.length;i++) {\n                      bboxExtent = M.updateExtent(bboxExtent, json.coordinates[i][0], json.coordinates[i][1]);\n                      out = out + json.coordinates[i][0] + \" \" + json.coordinates[i][1] + \" \";\n                  }\n                  clone_multipoint.querySelector('map-coordinates').innerHTML = out;\n                  return clone_multipoint;\n\n              case \"MULTILINESTRING\":\n                  let clone_multilinestring = multilinestring.cloneNode(true);\n                  clone_multilinestring = clone_multilinestring.querySelector(\"map-multilinestring\");\n\n                  for(let i=0;i<json.coordinates.length;i++) {\n                      let out = \"\";\n                      let clone_coords = coords.cloneNode(true);\n                      clone_coords = clone_coords.querySelector(\"map-coordinates\");\n                      for(let y=0;y<json.coordinates[i].length;y++) {\n                          bboxExtent = M.updateExtent(bboxExtent, json.coordinates[i][y][0], json.coordinates[i][y][1]);\n                          out = out + json.coordinates[i][y][0] + \" \" + json.coordinates[i][y][1] + \" \";\n                      }\n                      clone_coords.innerHTML = out;\n                      clone_multilinestring.appendChild(clone_coords);\n                  }\n                  return clone_multilinestring;\n\n              case \"MULTIPOLYGON\":\n                  let m = multiPolygon.cloneNode(true);\n                  m = m.querySelector('map-multiPolygon');\n\n                  // Going over each Polygon\n                  for (let i=0;i<json.coordinates.length;i++) {\n                      let clone_polygon = polygon.cloneNode(true);\n                      clone_polygon = clone_polygon.querySelector(\"map-polygon\");\n                      \n                      // Going over each coordinates\n                      for (let y=0;y<json.coordinates[i].length;y++) {\n                          let out = \"\";\n                          let clone_coords = coords.cloneNode(true);\n                          clone_coords = clone_coords.querySelector(\"map-coordinates\");\n\n                          // Going over coordinates for the polygon\n                          for (let x=0;x<json.coordinates[i][y].length;x++) {\n                              bboxExtent = M.updateExtent(bboxExtent, json.coordinates[i][y][x][0], json.coordinates[i][y][x][1]);\n                              out = out + json.coordinates[i][y][x][0] + \" \" + json.coordinates[i][y][x][1] + \" \";\n                          }\n\n                          // Create map-coordinates element and append it to clone_polygon\n                          clone_coords.innerHTML = out;\n\n                          clone_polygon.appendChild(clone_coords);\n                      }\n                      m.appendChild(clone_polygon);\n                  }\n                  return m;\n              case \"GEOMETRYCOLLECTION\": // ---------------------------------------------------------------------------\n                  let g = geometrycollection.cloneNode(true);\n                  g = g.querySelector('map-geometrycollection');\n                  //console.log(json.geometries);\n                  for (let i=0;i<json.geometries.length;i++) {\n                      let fg = M.geojson2mapml(json.geometries[i], options, layer, bboxExtent);\n                      g.appendChild(fg);\n                  }\n                  return g;\n          }\n      }\n      //Add default bbox\n      if (setExtent){\n        layer.querySelector(\"layer-\").insertAdjacentHTML(\"afterbegin\", \"<map-meta name='extent' content='top-left-longitude=\" + bboxExtent[0] + \", top-left-latitude=\" + bboxExtent[1] + \", bottom-right-longitude=\" + bboxExtent[2] + \",bottom-right-latitude=\" + bboxExtent[3] + \"'></map-meta>\");\n      }\n      return layer.querySelector('layer-');\n    },\n\n    // Takes an array of length n to return an array of arrays with length 2, helper function\n    //    for mapml2geojson\n    // breakArray: arr(float) -> arr(arr(float, float))\n    breakArray: function (arr) {\n      let size = 2; \n      let arrayOfArrays = [];\n      // removing anything other than numbers, ., - (used to remove <map-span> tags)\n      arr = arr.filter(x => !(/[^\\d.-]/g.test(x))).filter(x => x);\n      for (let i=0; i<arr.length; i+=size) {\n          arrayOfArrays.push((arr.slice(i,i+size)).map(Number));\n      }\n      return arrayOfArrays;\n    },\n\n    // Takes an HTML Table to return geojson properties, helper function\n    //    for mapml2geojson\n    // table2properties: HTML Table -> geojson\n    table2properties: function (table) {\n      // removing thead, if it exists\n      let head = table.querySelector(\"thead\");\n      if (head !== null) {\n          table.querySelector(\"thead\").remove();\n      }\n      let json = {};\n      table.querySelectorAll('tr').forEach((tr) => {\n          let tableData = tr.querySelectorAll('th, td');\n          json[tableData[0].innerHTML] = tableData[1].innerHTML;\n      });\n      return json;\n    },\n\n    // Converts a geometry element to geojson, helper function\n    //    for mapml2geojson\n    // geometry2geojson: (child of <map-geometry>), Proj4, Proj4, Bool -> geojson\n    geometry2geojson: function (el, source, dest, transform) {\n      let elem = el.nodeName;\n      let j = {};\n      let coord;\n\n      switch(elem.toUpperCase()) {\n          case \"MAP-POINT\":\n              j.type = \"Point\";\n              if (transform) {\n                  let pointConv = proj4.transform(source, dest, ((el.querySelector('map-coordinates').innerHTML.split(/ [<>\\ ]/g)).map(Number)) );\n                  j.coordinates = [pointConv.x, pointConv.y];\n              } else {\n                  j.coordinates = (el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g)).map(Number);\n              }\n              break;\n          case \"MAP-LINESTRING\":\n              j.type = \"LineString\";\n              coord = el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g);\n              coord = M.breakArray(coord);\n              if (transform) {\n                  coord = M.pcrsToGcrs(coord, source, dest);\n              }\n              j.coordinates = coord;\n              break;\n          case \"MAP-POLYGON\":\n              j.type = \"Polygon\";\n              j.coordinates = [];\n              let x = 0;\n              el.querySelectorAll('map-coordinates').forEach((coord) => {\n                  coord = coord.innerHTML.split(/[<>\\ ]/g);\n                  coord = M.breakArray(coord);\n                  if (transform) {\n                      coord = M.pcrsToGcrs(coord, source, dest);\n                  }\n                  j.coordinates[x] = coord;\n                  x++;\n              });\n              break;\n          case \"MAP-MULTIPOINT\":\n              j.type = \"MultiPoint\";\n              coord = M.breakArray(el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g));\n              if (transform) {\n                  coord = M.pcrsToGcrs(coord, source, dest);\n              }\n              j.coordinates = coord;\n              break;\n          case \"MAP-MULTILINESTRING\":\n              j.type = \"MultiLineString\";\n              j.coordinates = [];\n              let i = 0;\n              el.querySelectorAll('map-coordinates').forEach((coord) => {\n                  coord = coord.innerHTML.split(/[<>\\ ]/g);\n                  coord = M.breakArray(coord);\n                  if (transform) {\n                      coord = M.pcrsToGcrs(coord, source, dest);\n                  }\n                  j.coordinates[i] = coord;\n                  i++;\n              });\n              break;\n          case \"MAP-MULTIPOLYGON\":\n              j.type = \"MultiPolygon\";\n              j.coordinates = [];\n              let p = 0;\n              el.querySelectorAll('map-polygon').forEach((poly) => {\n                  let y = 0;\n                  j.coordinates.push([]);\n                  poly.querySelectorAll('map-coordinates').forEach((coord) => {\n                      coord = coord.innerHTML.split(/[<>\\ ]/g);\n                      coord = M.breakArray(coord);\n                      if (transform) {\n                          coord = M.pcrsToGcrs(coord, source, dest);\n                      }\n                      j.coordinates[p].push([]);\n                      j.coordinates[p][y] = coord;\n                      y++;\n                  });\n                  p++;\n              });\n              break;\n      }\n      return j;\n    },\n\n    // pcrsToGcrs: arrof([x,y]) Proj4, Proj4 -> arrof[x,y]\n    pcrsToGcrs: function (arr, source, dest) {\n      let newArr = [];\n      for (let i=0; i<arr.length; i++) {\n          let conv = proj4.transform(source, dest, arr[i]);\n          conv = [conv.x, conv.y];\n          newArr.push(conv);\n      }\n      return newArr;\n    },\n\n    // Takes an <layer-> element and returns a geojson feature collection object \n    // The options object can contain the following:\n    //      propertyFunction   - function(<map-properties>), A function that maps the features' <map-properties> element to   a GeoJSON \"properties\" member.\n    //      transform          - Bool, Transform coordinates to gcrs values, defaults to True\n    // mapml2geojson: <layer-> Object -> GeoJSON\n    mapml2geojson: function (element, options = {}) {\n        let defaults = {\n            propertyFunction: null,\n            transform: true\n        };\n        // assign default values for undefined options\n        options = Object.assign({}, defaults, options);\n\n        let json = {};\n        json.type = \"FeatureCollection\";\n        json.title = element.getAttribute('label');\n        json.features = [];\n\n        // Transforming Coordinates to gcrs if transformation = true and coordinate is not (EPSG:3857 or EPSG:4326)\n        let source = null;\n        let dest = null;\n        if (options.transform) {\n            source = new proj4.Proj(element.parentElement._map.options.crs.code);\n            dest = new proj4.Proj('EPSG:4326');\n            if (element.parentElement._map.options.crs.code === \"EPSG:3857\" || element.parentElement._map.options.crs.code  === \"EPSG:4326\") {\n                options.transform = false;\n            }   \n        }\n\n        // Setting all meta settings, if any\n        let metas = element.querySelectorAll(\"map-meta\");\n        metas.forEach((meta) => {\n            let name = meta.getAttribute('name');\n            if (name === \"extent\") {\n                let content = meta.getAttribute('content');\n                let arr = content.split(\",\");\n                let ex = {};\n                for (let i=0; i<arr.length; i++) {\n                    let s = arr[i].split(\"=\");\n                    s[0] = s[0].trim(); // removing whitespace\n                    s[1] = parseFloat(s[1]);\n                    ex[s[0]] = s[1];\n                }\n                json.bbox = [ex['top-left-longitude'], ex['top-left-latitude'], ex['bottom-right-longitude'], ex  ['bottom-right-latitude']];\n            }\n        });\n\n        // Iterating over each feature\n        let features = element.querySelectorAll(\"map-feature\");\n        let num = 0;\n\n        // Going over each feature in the layer\n        features.forEach((feature) => {\n            //console.log(feature);\n\n            json.features[num] = {\"type\": \"Feature\"};\n            json.features[num].geometry = {};\n            json.features[num].properties = {};\n\n            // setting properties when function presented\n            if (typeof options.propertyFunction === \"function\") {\n                let properties = options.propertyFunction(feature.querySelector(\"map-properties\"));\n                json.features[num].properties = properties;\n            } else if (feature.querySelector(\"map-properties\").querySelector('table') !== null) { \n                // setting properties when table presented\n                let properties = M.table2properties(feature.querySelector(\"map-properties\").querySelector('table'));\n                json.features[num].properties = properties;\n            } else {\n                // when no table present, strip any possible html tags to only get text\n                json.features[num].properties = {prop0: (feature.querySelector(\"map-properties\").innerHTML).replace( /(<([^>]+)>)/ig, '')};\n            }\n\n            let geom = feature.querySelector(\"map-geometry\");\n            let elem = geom.children[0].nodeName;\n\n            // Adding Geometry\n            if (elem.toUpperCase() !== \"MAP-GEOMETRYCOLLECTION\"){\n                json.features[num].geometry = M.geometry2geojson(geom.children[0], source, dest, options.transform);\n            } else {\n                json.features[num].geometry.type = \"GeometryCollection\";\n                json.features[num].geometry.geometries = [];\n\n                let geoms = geom.querySelector('map-geometrycollection').children;\n                Array.from(geoms).forEach((g) => {\n                    g = M.geometry2geojson(g, source, dest, options.transform);\n                    json.features[num].geometry.geometries.push(g);\n                });\n            }\n            //going to next feature\n            num++;\n        });\n\n        return json;\n    }\n  };\n\n  var ReloadButton = L.Control.extend({\n    options: {\n      position: 'topleft',\n    },\n\n    onAdd: function (map) {\n      let container = L.DomUtil.create(\"div\", \"mapml-reload-button leaflet-bar\");\n\n      let link = L.DomUtil.create(\"button\", \"mapml-reload-button\", container);\n      link.innerHTML = \"<span aria-hidden='true'>&#x021BA</span>\";\n      link.title = M.options.locale.cmReload;\n      link.setAttribute(\"type\", \"button\");\n      link.classList.add(\"mapml-button\");\n      link.setAttribute('aria-label', \"Reload\");\n\n      L.DomEvent.disableClickPropagation(link);\n      L.DomEvent.on(link, 'click', L.DomEvent.stop);\n      L.DomEvent.on(link, 'click', this._goReload, this);\n\n      this._reloadButton = link;\n\n      this._updateDisabled();\n      map.on('moveend', this._updateDisabled, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('moveend', this._updateDisabled, this);\n    },\n\n    disable: function () {\n      this._disabled = true;\n      this._updateDisabled();\n      return this;\n    },\n\n    enable: function () {\n      this._disabled = false;\n      this._updateDisabled();\n      return this;\n    },\n\n    _goReload: function (e) {\n      if (!this._disabled && this._map.options.mapEl._history.length > 1) {\n        this._map.options.mapEl.reload();\n      }\n    },\n\n    _updateDisabled: function () {\n      setTimeout(() => {\n        L.DomUtil.removeClass(this._reloadButton, \"leaflet-disabled\");\n        this._reloadButton.setAttribute(\"aria-disabled\", \"false\");\n\n        if (this._map && (this._disabled || this._map.options.mapEl._history.length <= 1)) {\n          L.DomUtil.addClass(this._reloadButton, \"leaflet-disabled\");\n          this._reloadButton.setAttribute(\"aria-disabled\", \"true\");\n        }\n      }, 0);\n    }\n  });\n\n  var reloadButton = function (options) {\n    return new ReloadButton(options);\n  };\n\n  var FullscreenButton = L.Control.extend({\n          options: {\n              position: 'topleft',\n              title: {\n                  'false': 'View fullscreen',\n                  'true': 'Exit fullscreen'\n              }\n          },\n\n          onAdd: function (map) {\n              var container = L.DomUtil.create('div', 'leaflet-control-fullscreen leaflet-bar leaflet-control');\n\n              this.link = L.DomUtil.create('a', 'leaflet-control-fullscreen-button leaflet-bar-part', container);\n              this.link.href = '#';\n              this.link.setAttribute('role', 'button');\n\n              this._map = map;\n              this._map.on('fullscreenchange', this._toggleTitle, this);\n              this._toggleTitle();\n\n              L.DomEvent.on(this.link, 'click', this._click, this);\n\n              return container;\n          },\n\n          onRemove: function (map) {\n              map.off('fullscreenchange', this._toggleTitle, this);\n          },\n\n          _click: function (e) {\n              L.DomEvent.stopPropagation(e);\n              L.DomEvent.preventDefault(e);\n              this._map.toggleFullscreen(this.options);\n          },\n\n          _toggleTitle: function() {\n              this.link.title = this.options.title[this._map.isFullscreen()];\n          }\n      });\n\n      L.Map.include({\n          isFullscreen: function () {\n              return this._isFullscreen || false;\n          },\n\n          toggleFullscreen: function (options) {\n              // the <map> element can't contain a shadow root, so we used a child <div>\n              // <mapml-viewer> can contain a shadow root, so return it directly\n              var mapEl = this.getContainer().getRootNode().host,\n                  container = mapEl.nodeName === \"DIV\" ? mapEl.parentElement : mapEl;\n              if (this.isFullscreen()) {\n                  if (options && options.pseudoFullscreen) {\n                      this._disablePseudoFullscreen(container);\n                  } else if (document.exitFullscreen) {\n                      document.exitFullscreen();\n                  } else if (document.mozCancelFullScreen) {\n                      document.mozCancelFullScreen();\n                  } else if (document.webkitCancelFullScreen) {\n                      document.webkitCancelFullScreen();\n                  } else if (document.msExitFullscreen) {\n                      document.msExitFullscreen();\n                  } else {\n                      this._disablePseudoFullscreen(container);\n                  }\n              } else {\n                  if (options && options.pseudoFullscreen) {\n                      this._enablePseudoFullscreen(container);\n                  } else if (container.requestFullscreen) {\n                      container.requestFullscreen();\n                  } else if (container.mozRequestFullScreen) {\n                      container.mozRequestFullScreen();\n                  } else if (container.webkitRequestFullscreen) {\n                      container.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n                  } else if (container.msRequestFullscreen) {\n                      container.msRequestFullscreen();\n                  } else {\n                      this._enablePseudoFullscreen(container);\n                  }\n              }\n\n          },\n\n          _enablePseudoFullscreen: function (container) {\n              L.DomUtil.addClass(container, 'leaflet-pseudo-fullscreen');\n              this._setFullscreen(true);\n              this.fire('fullscreenchange');\n          },\n\n          _disablePseudoFullscreen: function (container) {\n              L.DomUtil.removeClass(container, 'leaflet-pseudo-fullscreen');\n              this._setFullscreen(false);\n              this.fire('fullscreenchange');\n          },\n\n          _setFullscreen: function(fullscreen) {\n              this._isFullscreen = fullscreen;\n              var container = this.getContainer().getRootNode().host;\n              if (fullscreen) {\n                  L.DomUtil.addClass(container, 'mapml-fullscreen-on');\n              } else {\n                  L.DomUtil.removeClass(container, 'mapml-fullscreen-on');\n              }\n              this.invalidateSize();\n          },\n\n          _onFullscreenChange: function (e) {\n              var fullscreenElement =\n                  document.fullscreenElement ||\n                  document.mozFullScreenElement ||\n                  document.webkitFullscreenElement ||\n                  document.msFullscreenElement,\n                  mapEl = this.getContainer().getRootNode().host,\n                  container = mapEl.nodeName === \"DIV\" ? mapEl.parentElement : mapEl;\n              \n\n              if (fullscreenElement === container && !this._isFullscreen) {\n                  this._setFullscreen(true);\n                  this.fire('fullscreenchange');\n              } else if (fullscreenElement !== container && this._isFullscreen) {\n                  this._setFullscreen(false);\n                  this.fire('fullscreenchange');\n              }\n          }\n      });\n\n      L.Map.mergeOptions({\n          fullscreenControl: false\n      });\n\n      L.Map.addInitHook(function () {\n          if (this.options.fullscreenControl) {\n              this.fullscreenControl = new FullscreenButton(this.options.fullscreenControl);\n              this.addControl(this.fullscreenControl);\n          }\n\n          var fullscreenchange;\n\n          if ('onfullscreenchange' in document) {\n              fullscreenchange = 'fullscreenchange';\n          } else if ('onmozfullscreenchange' in document) {\n              fullscreenchange = 'mozfullscreenchange';\n          } else if ('onwebkitfullscreenchange' in document) {\n              fullscreenchange = 'webkitfullscreenchange';\n          } else if ('onmsfullscreenchange' in document) {\n              fullscreenchange = 'MSFullscreenChange';\n          }\n\n          if (fullscreenchange) {\n              var onFullscreenChange = L.bind(this._onFullscreenChange, this);\n\n              this.whenReady(function () {\n                  L.DomEvent.on(document, fullscreenchange, onFullscreenChange);\n              });\n\n              this.on('unload', function () {\n                  L.DomEvent.off(document, fullscreenchange, onFullscreenChange);\n              });\n          }\n      });\n\n      var fullscreenButton = function (options) {\n          return new FullscreenButton(options);\n      };\n\n  var attributionControl = function (map) {\n      map._attributionControl = map._map.attributionControl.setPrefix(`<button onclick=\"this.closest(\\'.leaflet-container\\').querySelector(\\'.shortcuts-dialog\\').showModal()\" class=\"shortcuts-button mapml-button\">${M.options.locale.kbdShortcuts}</button> | <a href=\"https://www.w3.org/community/maps4html/\" title=\"W3C Maps for HTML Community Group\">Maps4HTML</a> | <img src=\"data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTIiIGhlaWdodD0iOCI+PHBhdGggZmlsbD0iIzRDN0JFMSIgZD0iTTAgMGgxMnY0SDB6Ii8+PHBhdGggZmlsbD0iI0ZGRDUwMCIgZD0iTTAgNGgxMnYzSDB6Ii8+PHBhdGggZmlsbD0iI0UwQkMwMCIgZD0iTTAgN2gxMnYxSDB6Ii8+PC9zdmc+\" style=\"padding-right: 0.3em;\" alt=\"Slava Ukraini\"> <a href=\"https://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>`);\n\n      let dialog = document.createElement(\"dialog\");\n      dialog.setAttribute(\"class\", \"shortcuts-dialog\");\n      dialog.setAttribute(\"autofocus\", \"\");\n      dialog.onclick = function (e) {\n          e.stopPropagation();\n      };\n      dialog.innerHTML = `<b>${M.options.locale.kbdShortcuts} </b><button aria-label=\"Close\" onclick='this.parentElement.close()'>X</button>` +\n          `<ul><b>${M.options.locale.kbdMovement}</b><li><kbd>&#8593</kbd> ${M.options.locale.kbdPanUp}</li><li><kbd>&#8595</kbd> ${M.options.locale.kbdPanDown}</li><li><kbd>&#8592</kbd> ${M.options.locale.kbdPanLeft}</li><li><kbd>&#8594</kbd> ${M.options.locale.kbdPanRight}</li><li><kbd>+</kbd> ${M.options.locale.btnZoomIn}</li><li><kbd>-</kbd> ${M.options.locale.btnZoomOut}</li><li><kbd>shift</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 3x ${M.options.locale.kbdPanIncrement}</li><li><kbd>ctrl</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 0.2x ${M.options.locale.kbdPanIncrement}</li><li><kbd>shift</kbd> + <kbd>+/-</kbd> ${M.options.locale.kbdZoom}</li></ul>` +\n          `<ul><b>${M.options.locale.kbdFeature}</b><li><kbd>&#8592/&#8593</kbd> ${M.options.locale.kbdPrevFeature}</li><li><kbd>&#8594/&#8595</kbd> ${M.options.locale.kbdNextFeature}</li></ul>`;\n      map._container.appendChild(dialog);\n\n      map._attributionControl.getContainer().setAttribute(\"role\",\"group\");\n      map._attributionControl.getContainer().setAttribute(\"aria-label\",\"Map data attribution\");\n  };\n\n  var Crosshair = L.Layer.extend({\n    onAdd: function (map) {\n\n      // SVG crosshair design from https://github.com/xguaita/Leaflet.MapCenterCoord/blob/master/src/icons/MapCenterCoordIcon1.svg?short_path=81a5c76\n      // Optimized with SVGOMG: https://jakearchibald.github.io/svgomg/\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><g stroke=\"#fff\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"50.028\" cy=\"50.219\" r=\"3.923\" stroke-width=\"2\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z\"/><path stroke-width=\"3\" d=\"M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z\" color=\"currentColor\" overflow=\"visible\"/></g></svg>`;\n\n      this._container = L.DomUtil.create(\"div\", \"mapml-crosshair\", map._container);\n      this._container.innerHTML = svgInnerHTML;\n      map.isFocused = false;\n      this._isQueryable = false;\n\n      map.on(\"layerchange layeradd layerremove overlayremove\", this._toggleEvents, this);\n      map.on(\"popupopen\", this._isMapFocused, this);\n      L.DomEvent.on(map._container, \"keydown keyup mousedown\", this._isMapFocused, this);\n\n      this._addOrRemoveCrosshair();\n    },\n\n    onRemove: function (map) {\n      map.off(\"layerchange layeradd layerremove overlayremove\", this._toggleEvents);\n      map.off(\"popupopen\", this._isMapFocused);\n      L.DomEvent.off(map._container, \"keydown keyup mousedown\", this._isMapFocused);\n    },\n\n    _toggleEvents: function () {\n      if (this._hasQueryableLayer()) {\n        this._map.on(\"viewreset move moveend\", this._addOrRemoveCrosshair, this);\n      } else {\n        this._map.off(\"viewreset move moveend\", this._addOrRemoveCrosshair, this);\n      }\n      this._addOrRemoveCrosshair();\n    },\n\n    _addOrRemoveCrosshair: function (e) {\n      if (this._hasQueryableLayer()) {\n        this._container.removeAttribute(\"hidden\");\n      } else {\n        this._container.setAttribute(\"hidden\", \"\");\n      }\n    },\n\n    _addOrRemoveMapOutline: function (e) {\n      let mapContainer = this._map._container;\n      if (this._map.isFocused && !this._outline) {\n        this._outline = L.DomUtil.create(\"div\", \"mapml-outline\", mapContainer);\n      } else if (!this._map.isFocused && this._outline) {\n        L.DomUtil.remove(this._outline);\n        delete this._outline;\n      }\n    },\n\n    _hasQueryableLayer: function () {\n      let layers = this._map.options.mapEl.layers;\n      if (this._map.isFocused) {\n        for (let layer of layers) {\n          if (layer.checked && layer._layer.queryable) {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    // TODO: should be merged with the 'mapfocused' event emitted by mapml-viewer and map, not trivial\n    _isMapFocused: function (e) {\n      //set this._map.isFocused = true if arrow buttons are used\n      if(!this._map._container.parentNode.activeElement){\n        this._map.isFocused = false;\n        return;\n      }\n      let isLeafletContainer = this._map._container.parentNode.activeElement.classList.contains(\"leaflet-container\");\n      if (isLeafletContainer && [\"keydown\"].includes(e.type) && (e.shiftKey && e.keyCode === 9)) {\n        this._map.isFocused = false;\n      } else this._map.isFocused = isLeafletContainer && [\"keyup\", \"keydown\"].includes(e.type);\n\n      if(this._map.isFocused) this._map.fire(\"mapkeyboardfocused\");\n      this._addOrRemoveMapOutline();\n      this._addOrRemoveCrosshair();\n    },\n\n  });\n\n\n  var crosshair = function (options) {\n    return new Crosshair(options);\n  };\n\n  /**\n   * M.Feature is a extension of L.Path that understands mapml feature markup\n   * It converts the markup to the following structure (abstract enough to encompass all feature types) for example:\n   *  this._outlinePath = HTMLElement;\n   *  this._parts = [\n   *    {\n   *      path: HTMLElement,\n   *      rings:[\n   *        {points:[{x:1,y:1}, ...]},\n   *        ...\n   *      ],\n   *      subrings:[\n   *        {points:[{x:2, y:2}, ...], cls:\"Span Class Name\", path: HTMLElement,},\n   *        ...\n   *      ],\n   *      cls:\"className\",\n   *    },\n   *    ...\n   *  ];\n   */\n  var Feature = L.Path.extend({\n\n    /**\n     * Initializes the M.Feature\n     * @param {HTMLElement} markup - The markup representation of the feature\n     * @param {Object} options - The options of the feature\n     */\n    initialize: function (markup, options) {\n      this.type = markup.tagName.toUpperCase();\n\n      if(this.type === \"MAP-POINT\" || this.type === \"MAP-MULTIPOINT\") options.fillOpacity = 1;\n\n      if(options.wrappers.length > 0)\n        options = Object.assign(this._convertWrappers(options.wrappers), options);\n      L.setOptions(this, options);\n\n      this.group = this.options.group;\n      this.options.interactive = this.options.link || (this.options.properties && this.options.onEachFeature);\n\n      this._parts = [];\n      this._markup = markup;\n      this.options.zoom = markup.getAttribute('zoom') || this.options.nativeZoom;\n\n      this._convertMarkup();\n\n      if(markup.querySelector('map-span') || markup.querySelector('map-a')){\n        this._generateOutlinePoints();\n      }\n\n      this.isClosed = this._isClosed();\n    },\n\n    /**\n     * Attaches link handler to the sub parts' paths\n     * @param {SVGElement} elem - The element to add listeners to, either path or g elements\n     * @param {Object} link - The link object that contains the url, type and target data\n     * @param leafletLayer\n     */\n    attachLinkHandler: function (elem, link, leafletLayer) {\n      let dragStart, container = document.createElement('div'), p = document.createElement('p'), hovered = false;\n      container.classList.add('mapml-link-preview');\n      container.appendChild(p);\n      elem.classList.add('map-a');\n      if (link.visited) elem.classList.add(\"map-a-visited\");\n      L.DomEvent.on(elem, 'mousedown', e => dragStart = {x:e.clientX, y:e.clientY}, this);\n      L.DomEvent.on(elem, \"mouseup\", (e) => {\n        if (e.button !== 0) return; // don't trigger when button isn't left click\n        let onTop = true, nextLayer = this.options._leafletLayer._layerEl.nextElementSibling;\n        while(nextLayer && onTop){\n          if(nextLayer.tagName && nextLayer.tagName.toUpperCase() === \"LAYER-\")\n            onTop = !(nextLayer.checked && nextLayer._layer.queryable);\n          nextLayer = nextLayer.nextElementSibling;\n        }\n        if(onTop && dragStart) {\n          L.DomEvent.stop(e);\n          let dist = Math.sqrt(Math.pow(dragStart.x - e.clientX, 2) + Math.pow(dragStart.y - e.clientY, 2));\n          if (dist <= 5){\n            link.visited = true;\n            elem.setAttribute(\"stroke\", \"#6c00a2\");\n            elem.classList.add(\"map-a-visited\");\n            M.handleLink(link, leafletLayer);\n          }\n        }\n      }, this);\n      L.DomEvent.on(elem, \"keypress\", (e) => {\n        L.DomEvent.stop(e);\n        if(e.keyCode === 13 || e.keyCode === 32) {\n          link.visited = true;\n          elem.setAttribute(\"stroke\", \"#6c00a2\");\n          elem.classList.add(\"map-a-visited\");\n          M.handleLink(link, leafletLayer);\n        }\n      }, this);\n      L.DomEvent.on(elem, 'mouseenter keyup', (e) => {\n        if(e.target !== e.currentTarget) return;\n        hovered = true;\n        let resolver = document.createElement('a'), mapWidth = this._map.getContainer().clientWidth;\n        resolver.href = link.url;\n        p.innerHTML = resolver.href;\n\n        this._map.getContainer().appendChild(container);\n\n        while(p.clientWidth > mapWidth/2){\n          p.innerHTML = p.innerHTML.substring(0, p.innerHTML.length - 5) + \"...\";\n        }\n        setTimeout(()=>{\n          if(hovered) p.innerHTML = resolver.href;\n        }, 1000);\n      }, this);\n      L.DomEvent.on(elem, 'mouseout keydown mousedown', (e) => {\n        if(e.target !== e.currentTarget || !container.parentElement) return;\n        hovered = false;\n        this._map.getContainer().removeChild(container);\n      }, this);\n      L.DomEvent.on(leafletLayer._map.getContainer(),'mouseout mouseenter click', (e) => { //adds a lot of event handlers\n        if(!container.parentElement) return;\n        hovered = false;\n        this._map.getContainer().removeChild(container);\n      }, this);\n    },\n\n    /**\n     * Updates internal structure of the feature to the new map state, the structure can be found in this._parts\n     * @param {L.Map} addedMap - The map that the feature is part of, can be left blank in the case of static features\n     * @param {L.Point} tileOrigin - The tile origin for the feature, if blank then it takes the maps pixel origin in the function\n     * @param {int} zoomingTo - The zoom the map is animating to, if left blank then it takes the map zoom, its provided because in templated tiles zoom is delayed\n     * @private\n     */\n    _project: function (addedMap, tileOrigin = undefined, zoomingTo = undefined) {\n      let map = addedMap || this._map, origin = tileOrigin || map.getPixelOrigin(), zoom = zoomingTo === undefined ? map.getZoom() : zoomingTo;\n      for (let p of this._parts) {\n        p.pixelRings = this._convertRing(p.rings, map, origin, zoom);\n        for (let subP of p.subrings) {\n          subP.pixelSubrings = this._convertRing([subP], map, origin, zoom);\n        }\n      }\n      if (!this._outline) return;\n      this.pixelOutline = [];\n      for (let o of this._outline) {\n        this.pixelOutline = this.pixelOutline.concat(this._convertRing(o, map, origin, zoom));\n      }\n    },\n\n    /**\n     * Converts the PCRS points to pixel points that can be used to create the SVG\n     * @param {L.Point[][]} r - Is the rings of a feature, either the mainParts, subParts or outline\n     * @param {L.Map} map - The map that the feature is part of\n     * @param {L.Point} origin - The origin used to calculate the pixel points\n     * @param {int} zoom - The current zoom level of the map\n     * @returns {L.Point[][]}\n     * @private\n     */\n    _convertRing: function (r, map, origin, zoom) {\n      // TODO: Implement Ramer-Douglas-Peucer Algo for simplifying points\n      let scale = map.options.crs.scale(zoom), parts = [];\n      for (let sub of r) {\n        let interm = [];\n        for (let p of sub.points) {\n          let conv = map.options.crs.transformation.transform(p, scale);\n          interm.push(L.point(conv.x, conv.y)._subtract(origin).round());\n        }\n        parts.push(interm);\n      }\n      return parts;\n    },\n\n    /**\n     * Updates the features\n     * @private\n     */\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updateFeature(this);\n    },\n\n    /**\n     * Converts the map-spans, a and divs around a geometry subtype into options for the feature\n     * @param {HTMLElement[]} elems - The current zoom level of the map\n     * @private\n     */\n    _convertWrappers: function (elems) {\n      if(!elems || elems.length === 0) return;\n      let classList = '', output = {};\n      for(let elem of elems){\n        if(elem.tagName.toUpperCase() !== \"MAP-A\" && elem.className){\n          classList +=`${elem.className} `;\n        } else if(!output.link && elem.getAttribute(\"href\")) {\n          let link = {};\n          link.url = elem.getAttribute(\"href\");\n          if(elem.hasAttribute(\"target\")) link.target = elem.getAttribute(\"target\");\n          if(elem.hasAttribute(\"type\")) link.type = elem.getAttribute(\"type\");\n          if(elem.hasAttribute(\"inplace\")) link.inPlace = true;\n          output.link = link;\n        }\n      }\n      output.className = `${classList} ${this.options.className}`.trim();\n      return output;\n    },\n\n    /**\n     * Converts this._markup to the internal structure of features\n     * @private\n     */\n    _convertMarkup: function () {\n      if (!this._markup) return;\n\n      let attr = this._markup.attributes;\n      this.featureAttributes = {};\n      if(this.options.link && this._markup.parentElement.tagName.toUpperCase() === \"MAP-A\" && this._markup.parentElement.parentElement.tagName.toUpperCase() !== \"MAP-GEOMETRY\")\n        this.featureAttributes.tabindex = \"0\";\n      for(let i = 0; i < attr.length; i++){\n        this.featureAttributes[attr[i].name] = attr[i].value;\n      }\n\n      let first = true;\n      for (let c of this._markup.querySelectorAll('map-coordinates')) {              //loops through the coordinates of the child\n        let ring = [], subRings = [];\n        this._coordinateToArrays(c, ring, subRings, this.options.className);              //creates an array of pcrs points for the main ring and the subparts\n        if (!first && this.type === \"MAP-POLYGON\") {\n          this._parts[0].rings.push(ring[0]);\n          if (subRings.length > 0)\n            this._parts[0].subrings = this._parts[0].subrings.concat(subRings);\n        } else if (this.type === \"MAP-MULTIPOINT\") {\n          for (let point of ring[0].points.concat(subRings)) {\n            this._parts.push({ rings: [{ points: [point] }], subrings: [], cls:`${point.cls || \"\"} ${this.options.className || \"\"}`.trim() });\n          }\n        } else {\n          this._parts.push({ rings: ring, subrings: subRings, cls: `${this.featureAttributes.class || \"\"} ${this.options.className || \"\"}`.trim() });\n        }\n        first = false;\n      }\n    },\n\n    /**\n     * Generates the feature outline, subtracting the map-spans to generate those separately\n     * @private\n     */\n    _generateOutlinePoints: function () {\n      if (this.type === \"MAP-MULTIPOINT\" || this.type === \"MAP-POINT\" || this.type === \"MAP-LINESTRING\" || this.type === \"MAP-MULTILINESTRING\") return;\n\n      this._outline = [];\n      for (let coords of this._markup.querySelectorAll('map-coordinates')) {\n        let nodes = coords.childNodes, cur = 0, tempDiv = document.createElement('div'), nodeLength = nodes.length;\n        for(let i = 0; i < nodes.length; i++){\n          if(nodes[i].textContent.trim().length === 0){\n            nodes[i].remove();\n          }\n        }\n        for (let n of nodes) {\n          let line = [];\n          if (!n.tagName) {  //no tagName means it's text content\n            let c = '', ind = (((cur - 1)%nodes.length) + nodes.length) % nodes.length; // this equation turns Javascript's % to how it behaves in C for example\n            if (nodes[ind].tagName) {\n              let prev = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${prev[prev.length - 2]} ${prev[prev.length - 1]} `;\n            }\n            c += n.textContent;\n            ind = (((cur + 1)%nodes.length) + nodes.length) % nodes.length; // this is equivalent to C/C++'s (cur + 1) % nodes.length\n            if (nodes[ind].tagName) {\n              let next = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${next[0]} ${next[1]} `;\n            }\n            tempDiv.innerHTML = c;\n            this._coordinateToArrays(tempDiv, line, [], true, this.featureAttributes.class || this.options.className);\n            this._outline.push(line);\n          }\n          cur++;\n        }\n      }\n    },\n\n    /**\n     * Converts map-coordinates element to an object representing the parts and subParts\n     * @param {HTMLElement} coords - A single map-coordinates element\n     * @param {Object[]} main - An empty array representing the main parts\n     * @param {Object[]} subParts - An empty array representing the sub parts\n     * @param {boolean} isFirst - A true | false representing if the current HTML element is the parent map-coordinates element or not\n     * @param {string} cls - The class of the coordinate/span\n     * @param parents\n     * @private\n     */\n    _coordinateToArrays: function (coords, main, subParts, isFirst = true, cls = undefined, parents = []) {\n      for (let span of coords.children) {\n        this._coordinateToArrays(span, main, subParts, false, span.getAttribute(\"class\"), parents.concat([span]));\n      }\n      let noSpan = coords.textContent.replace(/(<([^>]+)>)/ig, ''),\n          pairs = noSpan.match(/(\\S+\\s+\\S+)/gim), local = [], bounds;\n      for (let p of pairs) {\n        let numPair = [];\n        p.split(/\\s+/gim).forEach(M.parseNumber, numPair);\n        let point = M.pointToPCRSPoint(L.point(numPair), this.options.zoom, this.options.projection, this.options.nativeCS);\n        local.push(point);\n        bounds = bounds ? bounds.extend(point) : L.bounds(point, point);\n      }\n      if (this._bounds) {\n        this._bounds.extend(bounds.min);\n        this._bounds.extend(bounds.max);\n      } else {\n        this._bounds = bounds;\n      }\n      if (isFirst) {\n        main.push({ points: local });\n      } else {\n        let attrMap = {}, attr = coords.attributes, wrapperAttr = this._convertWrappers(parents);\n        if(wrapperAttr.link) attrMap.tabindex = \"0\";\n        for(let i = 0; i < attr.length; i++){\n          if(attr[i].name === \"class\") continue;\n          attrMap[attr[i].name] = attr[i].value;\n        }\n        subParts.unshift({\n          points: local,\n          center: bounds.getCenter(),\n          cls: `${cls || \"\"} ${wrapperAttr.className || \"\"}`.trim(),\n          attr: attrMap,\n          link: wrapperAttr.link,\n          linkTarget: wrapperAttr.linkTarget,\n          linkType: wrapperAttr.linkType});\n      }\n    },\n\n    /**\n     * Returns if the feature is closed or open, useful when styling\n     * @returns {boolean}\n     * @private\n     */\n    _isClosed: function () {\n      switch (this.type) {\n        case 'MAP-POLYGON':\n        case 'MAP-MULTIPOLYGON':\n        case 'MAP-POINT':\n        case 'MAP-MULTIPOINT':\n          return true;\n        case 'MAP-LINESTRING':\n        case 'MAP-MULTILINESTRING':\n          return false;\n        default:\n          return false;\n      }\n    },\n\n    /**\n     * Returns the center of the entire feature\n     * @returns {L.Point}\n     */\n    getCenter: function () {\n      if (!this._bounds) return null;\n      return this._map.options.crs.unproject(this._bounds.getCenter());\n    },\n\n    getPCRSCenter: function () {\n      return this._bounds.getCenter();\n    },\n  });\n\n  /**\n   *\n   * @param {HTMLElement} markup - The markup of the feature\n   * @param {Object} options - Options of the feature\n   * @returns {M.Feature}\n   */\n  var feature = function (markup, options) {\n    return new Feature(markup, options);\n  };\n\n  /**\n   * Returns a new Feature Renderer\n   * @param {Object} options - Options for the renderer\n   * @returns {*}\n   */\n  var FeatureRenderer = L.SVG.extend({\n    /**\n     * Override method of same name from L.SVG, use the this._container property\n     * to set up the role=\"none presentation\" on featureGroupu container,\n     * per this recommendation: \n     * https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/471#issuecomment-845192246\n     * @private overrides ancestor method so that we have a _container to work with\n     */\n    _initContainer: function () {\n      // call the method we're overriding, per https://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      // note you have to pass 'this' as the first arg\n      L.SVG.prototype._initContainer.call(this);\n      // knowing that the previous method call creates the this._container, we\n      // access it and set the role=\"none presetation\" which suppresses the \n      // announcement of \"Graphic\" on each feature focus.\n      this._container.setAttribute('role', 'none presentation');\n    },\n    \n    /**\n     * Creates all the appropriate path elements for a M.Feature\n     * @param {M.Feature} layer - The M.Feature that needs paths generated\n     * @param {boolean} stampLayer - Whether or not a layer should be stamped and stored in the renderer layers\n     * @private\n     */\n    _initPath: function (layer, stampLayer = true) {\n\n      if(layer._outline) {\n        let outlinePath = L.SVG.create('path');\n        if (layer.options.className) L.DomUtil.addClass(outlinePath, layer.featureAttributes.class || layer.options.className);\n        L.DomUtil.addClass(outlinePath, 'mapml-feature-outline');\n        outlinePath.style.fill = \"none\";\n        layer.outlinePath = outlinePath;\n      }\n\n      //creates the main parts and sub parts paths\n      for (let p of layer._parts) {\n        if (p.rings){\n          this._createPath(p, layer.options.className, layer.featureAttributes['aria-label'], layer.options.interactive, layer.featureAttributes);\n          if(layer.outlinePath) p.path.style.stroke = \"none\";\n        }\n        if (p.subrings) {\n          for (let r of p.subrings) {\n            this._createPath(r, layer.options.className, r.attr['aria-label'], (r.link !== undefined), r.attr);\n          }\n        }\n        this._updateStyle(layer);\n      }\n      if(stampLayer){\n        let stamp = L.stamp(layer);\n        this._layers[stamp] = layer;\n      }\n    },\n\n    /**\n     * Creates paths for either mainParts, subParts or outline of a feature\n     * @param {Object} ring - The ring the current path is being generated for\n     * @param {string} title - The accessible aria-label of a path\n     * @param {string} cls - The class of the path\n     * @param {boolean} interactive - The boolean representing whether a feature is interactive or not\n     * @param {Object} attr - Attributes map\n     * @private\n     */\n    _createPath: function (ring, cls, title, interactive = false, attr = undefined) {\n      let p = L.SVG.create('path');\n      ring.path = p;\n      if(!attr) {\n        if (title) p.setAttribute('aria-label', title);\n      } else {\n        for(let [name, value] of Object.entries(attr)){\n          if(name === \"id\" || name === \"tabindex\") continue;\n          p.setAttribute(name, value);\n        }\n      }\n      if (ring.cls || cls) {\n        L.DomUtil.addClass(p, ring.cls || cls);\n      }\n      if (interactive) {\n        L.DomUtil.addClass(p, 'leaflet-interactive');\n      }\n    },\n\n    /**\n     * Adds all the paths needed for a feature\n     * @param {M.Feature} layer - The feature that needs it's paths added\n     * @param {HTMLElement} container - The location the paths need to be added to\n     * @param {boolean} interactive - Whether a feature is interactive or not\n     * @private\n     */\n    _addPath: function (layer, container = undefined, interactive = true) {\n      if (!this._rootGroup && !container) { this._initContainer(); }\n      let c = container || this._rootGroup, outlineAdded = false;\n      if(interactive) {\n        layer.addInteractiveTarget(layer.group);\n      }\n      for (let p of layer._parts) {\n        if (p.path)\n          layer.group.appendChild(p.path);\n        if (interactive){\n          if(layer.options.link) layer.attachLinkHandler(p.path, layer.options.link, layer.options._leafletLayer);\n          layer.addInteractiveTarget(p.path);\n        }\n\n        if(!outlineAdded && layer.pixelOutline) {\n          layer.group.appendChild(layer.outlinePath);\n          outlineAdded = true;\n        }\n\n        for (let subP of p.subrings) {\n          if (subP.path) {\n            if (subP.link){\n              layer.attachLinkHandler(subP.path, subP.link, layer.options._leafletLayer);\n              layer.addInteractiveTarget(subP.path);\n            }\n            layer.group.appendChild(subP.path);\n          }\n        }\n      }\n      c.appendChild(layer.group);\n    },\n\n    /**\n     * Removes all the paths related to a feature\n     * @param {M.Feature} layer - The feature who's paths need to be removed\n     * @private\n     */\n    _removePath: function (layer) {\n      for (let p of layer._parts) {\n        if (p.path) {\n          layer.removeInteractiveTarget(p.path);\n          L.DomUtil.remove(p.path);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path)\n            L.DomUtil.remove(subP.path);\n        }\n      }\n      if(layer.outlinePath) L.DomUtil.remove(layer.outlinePath);\n      layer.removeInteractiveTarget(layer.group);\n      L.DomUtil.remove(layer.group);\n      delete this._layers[L.stamp(layer)];\n    },\n\n    /**\n     * Updates the d attribute of all paths of a feature\n     * @param {M.Feature} layer - The Feature that needs updating\n     * @private\n     */\n    _updateFeature: function (layer) {\n      if (layer.pixelOutline) this._setPath(layer.outlinePath, this.geometryToPath(layer.pixelOutline, false));\n      for (let p of layer._parts) {\n        this._setPath(p.path, this.geometryToPath(p.pixelRings, layer.isClosed));\n        for (let subP of p.subrings) {\n          this._setPath(subP.path, this.geometryToPath(subP.pixelSubrings, false));\n        }\n      }\n    },\n\n    /**\n     * Generates the marker d attribute for a given point\n     * @param {L.Point} p - The point of the marker\n     * @returns {string}\n     * @private\n     */\n    _pointToMarker: function (p) {\n      return `M${p.x} ${p.y} L${p.x - 12.5} ${p.y - 30} C${p.x - 12.5} ${p.y - 50}, ${p.x + 12.5} ${p.y - 50}, ${p.x + 12.5} ${p.y - 30} L${p.x} ${p.y}z`;\n    },\n\n    /**\n     * Updates the styles of all paths of a feature\n     * @param {M.Feature} layer - The feature that needs styles updated\n     * @private\n     */\n    _updateStyle: function (layer) {\n      this._updatePathStyle(layer.outlinePath, layer, false, true);\n      for (let p of layer._parts) {\n        if (p.path) {\n          this._updatePathStyle(p.path, layer, true);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path)\n            this._updatePathStyle(subP.path, layer);\n        }\n      }\n    },\n\n    /**\n     * Updates the style of a single path\n     * @param {HTMLElement} path - The path that needs updating\n     * @param {M.Feature} layer - The feature layer\n     * @param {boolean} isMain - Whether it's the main parts or not\n     * @param {boolean} isOutline - Whether a path is an outline or not\n     * @private\n     */\n    _updatePathStyle: function (path, layer, isMain = false, isOutline = false) {\n      if (!path || !layer) { return; }\n      let options = layer.options, isClosed = layer.isClosed;\n      if ((options.stroke && (!isClosed || isOutline)) || (isMain && !layer.outlinePath)) {\n        path.setAttribute('stroke', options.color);\n        path.setAttribute('stroke-opacity', options.opacity);\n        path.setAttribute('stroke-width', options.weight);\n        path.setAttribute('stroke-linecap', options.lineCap);\n        path.setAttribute('stroke-linejoin', options.lineJoin);\n\n        if (options.dashArray) {\n          path.setAttribute('stroke-dasharray', options.dashArray);\n        } else {\n          path.removeAttribute('stroke-dasharray');\n        }\n\n        if (options.dashOffset) {\n          path.setAttribute('stroke-dashoffset', options.dashOffset);\n        } else {\n          path.removeAttribute('stroke-dashoffset');\n        }\n\n        if (options.link){\n          path.setAttribute(\"stroke\", options.link.visited?\"#6c00a2\":\"#0000EE\");\n          path.setAttribute(\"stroke-opacity\", \"1\");\n          path.setAttribute(\"stroke-width\", \"1px\");\n          path.setAttribute(\"stroke-dasharray\", \"none\");\n        }\n      } else {\n        path.setAttribute('stroke', 'none');\n      }\n\n      if(isClosed && !isOutline) {\n        if (!options.fill) {\n          path.setAttribute('fill', options.fillColor || options.color);\n          path.setAttribute('fill-opacity', options.fillOpacity);\n          path.setAttribute('fill-rule', options.fillRule || 'evenodd');\n        } else {\n          path.setAttribute('fill', options.color);\n        }\n      } else {\n        path.setAttribute('fill', 'none');\n      }\n    },\n\n    /**\n     * Sets the d attribute of a path\n     * @param {HTMLElement} path - The path that is being updated\n     * @param {string} def - The new d attribute of the path\n     * @private\n     */\n    _setPath: function (path, def) {\n      path.setAttribute('d', def);\n    },\n\n    /**\n     * Generates the d string of a feature part\n     * @param {L.Point[]} rings - The points making up a given part of a feature\n     * @param {boolean} closed - Whether a feature is closed or not\n     * @returns {string}\n     */\n    geometryToPath: function (rings, closed) {\n      let str = '', i, j, len, len2, points, p;\n\n      for (i = 0, len = rings.length; i < len; i++) {\n        points = rings[i];\n        if (points.length === 1) {\n          return this._pointToMarker(points[0]);\n        }\n        for (j = 0, len2 = points.length; j < len2; j++) {\n          p = points[j];\n          str += (j ? 'L' : 'M') + p.x + ' ' + p.y;\n        }\n        str += closed ? 'z' : '';\n      }\n      return str || 'M0 0';\n    },\n  });\n\n  /**\n   * Returns new M.FeatureRenderer\n   * @param {Object} options - Options for the renderer\n   * @returns {M.FeatureRenderer}\n   */\n  var featureRenderer = function (options) {\n    return new FeatureRenderer(options);\n  };\n\n  var FeatureGroup = L.FeatureGroup.extend({\n\n    /**\n     * Initialize the feature group\n     * @param {M.Feature[]} layers\n     * @param {Object} options\n     */\n    initialize: function (layers, options) {\n      if(options.wrappers && options.wrappers.length > 0)\n        options = Object.assign(M.Feature.prototype._convertWrappers(options.wrappers), options);\n\n      L.LayerGroup.prototype.initialize.call(this, layers, options);\n\n      if((this.options.onEachFeature && this.options.properties) || this.options.link) {\n        L.DomUtil.addClass(this.options.group, \"leaflet-interactive\");\n        L.DomEvent.on(this.options.group, \"keyup keydown mousedown\", this._handleFocus, this);\n        let firstLayer = layers[Object.keys(layers)[0]];\n        if(layers.length === 1 && firstLayer.options.link) this.options.link = firstLayer.options.link;\n        if(this.options.link){\n          M.Feature.prototype.attachLinkHandler.call(this, this.options.group, this.options.link, this.options._leafletLayer);\n          this.options.group.setAttribute('role', 'link');\n        } else {\n          this.options.group.setAttribute(\"aria-expanded\", \"false\");\n          this.options.group.setAttribute('role', 'button');\n          this.options.onEachFeature(this.options.properties, this);\n          this.off(\"click\", this._openPopup);\n        }\n      }\n\n      this.options.group.setAttribute('aria-label', this.options.accessibleTitle);\n      if(this.options.featureID) this.options.group.setAttribute(\"data-fid\", this.options.featureID);\n    },\n\n    onAdd: function (map) {\n      L.LayerGroup.prototype.onAdd.call(this, map);\n      this.updateInteraction();\n    },\n\n    updateInteraction: function () {\n      let map = this._map || this.options._leafletLayer._map;\n      if((this.options.onEachFeature && this.options.properties) || this.options.link)\n        map.featureIndex.addToIndex(this, this.getPCRSCenter(), this.options.group);\n\n      for (let layerID in this._layers) {\n        let layer = this._layers[layerID];\n        for(let part of layer._parts){\n          if(layer.featureAttributes && layer.featureAttributes.tabindex)\n            map.featureIndex.addToIndex(layer, layer.getPCRSCenter(), part.path);\n          for(let subPart of part.subrings) {\n            if(subPart.attr && subPart.attr.tabindex) map.featureIndex.addToIndex(layer, subPart.center, subPart.path);\n          }\n        }\n      }\n    },\n\n    /**\n     * Handler for focus events\n     * @param {L.DOMEvent} e - Event that occurred\n     * @private\n     */\n    _handleFocus: function(e) {\n      if(([9, 16, 27, 37, 38, 39, 40].includes(e.keyCode)) && e.type === \"keydown\"){\n        let index = this._map.featureIndex.currentIndex;\n        // Down/right arrow keys replicate tabbing through the feature index\n        // Up/left arrow keys replicate shift-tabbing through the feature index\n        if(e.keyCode === 37 || e.keyCode === 38) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\"tabindex\", -1);\n          if(index === 0) {\n            this._map.featureIndex.inBoundFeatures[this._map.featureIndex.inBoundFeatures.length - 1].path.focus();\n            this._map.featureIndex.currentIndex = this._map.featureIndex.inBoundFeatures.length - 1;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index - 1].path.focus();\n            this._map.featureIndex.currentIndex--;\n          }\n        } else if (e.keyCode === 39 || e.keyCode === 40) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\"tabindex\", -1);\n          if(index === this._map.featureIndex.inBoundFeatures.length - 1) {\n            this._map.featureIndex.inBoundFeatures[0].path.focus();\n            this._map.featureIndex.currentIndex = 0;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index + 1].path.focus();\n            this._map.featureIndex.currentIndex++;\n          }\n        } else if(e.keyCode === 27){\n          let shadowRoot = this._map.options.mapEl.shadowRoot ? this._map.options.mapEl.shadowRoot :\n              this._map.options.mapEl.querySelector(\".mapml-web-map\").shadowRoot;\n          if(shadowRoot.activeElement.nodeName !== \"g\") return;\n          this._map._container.focus();\n        } else if (e.keyCode === 9) {\n          let obj = this;\n          setTimeout(function () {\n            obj._map.featureIndex.inBoundFeatures[0].path.setAttribute(\"tabindex\", 0);\n          }, 0);\n        }\n      } else if (!([9, 16, 13, 27, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55].includes(e.keyCode))){\n        this._map.featureIndex.currentIndex = 0;\n        this._map.featureIndex.inBoundFeatures[0].path.focus();\n      }\n\n      if(e.target.tagName.toUpperCase() !== \"G\") return;\n      if(([9, 13, 16, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55].includes(e.keyCode)) && e.type === \"keyup\") {\n        this.openTooltip();\n      } else if (e.keyCode === 13 || e.keyCode === 32){\n        this.closeTooltip();\n        if(!this.options.link && this.options.onEachFeature){\n          L.DomEvent.stop(e);\n          this.openPopup();\n        }\n      } else {\n        this.closeTooltip();\n      }\n    },\n\n    /**\n     * Add a M.Feature to the M.FeatureGroup\n     * @param layer\n     */\n    addLayer: function (layer) {\n      if(!layer.options.link && layer.options.interactive) {\n        this.options.onEachFeature(this.options.properties, layer);\n      }\n      L.FeatureGroup.prototype.addLayer.call(this, layer);\n    },\n\n    /**\n     * Focuses the previous function in the sequence on previous button press\n     * @param e\n     * @private\n     */\n    _previousFeature: function(e){\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.max(this._map.featureIndex.currentIndex - 1, 0);\n      let prevFocus = this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];\n      prevFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    /**\n     * Focuses next feature in sequence\n     * @param e\n     * @private\n     */\n    _nextFeature: function(e){\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.min(this._map.featureIndex.currentIndex + 1, this._map.featureIndex.inBoundFeatures.length - 1);\n      let nextFocus = this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];\n      nextFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    getPCRSCenter: function () {\n      let bounds;\n      for(let l in this._layers){\n        let layer = this._layers[l];\n        if (!bounds) {\n          bounds = L.bounds(layer.getPCRSCenter(), layer.getPCRSCenter());\n        } else {\n          bounds.extend(layer.getPCRSCenter());\n        }\n      }\n      return bounds.getCenter();\n    },\n  });\n\n  /**\n   * Returns new M.FeatureGroup\n   * @param {M.Feature[]} layers - Layers belonging to feature group\n   * @param {Object} options - Options for the feature group\n   * @returns {M.FeatureGroup}\n   */\n  var featureGroup = function (layers, options) {\n    return new FeatureGroup(layers, options);\n  };\n\n  var AnnounceMovement = L.Handler.extend({\n      addHooks: function () {\n          this._map.on({\n              layeradd: this.totalBounds,\n              layerremove: this.totalBounds,\n          });\n\n          this._map.options.mapEl.addEventListener('moveend', this.announceBounds);\n          this._map.dragging._draggable.addEventListener('dragstart', this.dragged);\n          this._map.options.mapEl.addEventListener('mapfocused', this.focusAnnouncement);\n      },\n      removeHooks: function () {\n          this._map.off({\n              layeradd: this.totalBounds,\n              layerremove: this.totalBounds,\n          });\n\n          this._map.options.mapEl.removeEventListener('moveend', this.announceBounds);\n          this._map.dragging._draggable.removeEventListener('dragstart', this.dragged);\n          this._map.options.mapEl.removeEventListener('mapfocused', this.focusAnnouncement);\n      },\n\n       focusAnnouncement: function () {\n           let mapEl = this;\n           setTimeout(function (){\n               let el = mapEl.querySelector(\".mapml-web-map\") ? mapEl.querySelector(\".mapml-web-map\").shadowRoot.querySelector(\".leaflet-container\") :\n                   mapEl.shadowRoot.querySelector(\".leaflet-container\");\n\n               let mapZoom = mapEl._map.getZoom();\n               let location = M.gcrsToTileMatrix(mapEl);\n               let standard = M.options.locale.amZoom + \" \" + mapZoom + \" \" + M.options.locale.amColumn + \" \" + location[0] + \" \" + M.options.locale.amRow + \" \" + location[1];\n\n               if(mapZoom === mapEl._map._layersMaxZoom){\n                   standard = M.options.locale.amMaxZoom + \" \" + standard;\n               }\n               else if(mapZoom === mapEl._map._layersMinZoom){\n                   standard = M.options.locale.amMinZoom + \" \" + standard;\n               }\n\n               el.setAttribute(\"aria-roledescription\", \"region \" + standard);\n               setTimeout(function () {\n                   el.removeAttribute(\"aria-roledescription\");\n               }, 2000);\n           }, 0);\n       },\n\n      announceBounds: function () {\n          if(this._traversalCall > 0){\n              return;\n          }\n          let mapZoom = this._map.getZoom();\n          let mapBounds = M.pixelToPCRSBounds(this._map.getPixelBounds(),mapZoom,this._map.options.projection);\n\n          let visible = true;\n          if(this._map.totalLayerBounds){\n              visible = mapZoom <= this._map._layersMaxZoom && mapZoom >= this._map._layersMinZoom &&\n                  this._map.totalLayerBounds.overlaps(mapBounds);\n          }\n\n          let output = this.querySelector(\".mapml-web-map\") ? this.querySelector(\".mapml-web-map\").shadowRoot.querySelector(\".mapml-screen-reader-output\") :\n              this.shadowRoot.querySelector(\".mapml-screen-reader-output\");\n\n          //GCRS to TileMatrix\n          let location = M.gcrsToTileMatrix(this);\n          let standard = M.options.locale.amZoom + \" \" + mapZoom + \" \" + M.options.locale.amColumn + \" \" + location[0] + \" \" + M.options.locale.amRow + \" \" + location[1];\n\n          if(!visible){\n              let outOfBoundsPos = this._history[this._historyIndex];\n              let inBoundsPos = this._history[this._historyIndex - 1];\n              this.back();\n              this._history.pop();\n\n              if(outOfBoundsPos.zoom !== inBoundsPos.zoom){\n                  output.innerText = M.options.locale.amZoomedOut;\n              }\n              else if(this._map.dragging._draggable.wasDragged){\n                  output.innerText = M.options.locale.amDraggedOut;\n              }\n              else if(outOfBoundsPos.x > inBoundsPos.x){\n                  output.innerText = M.options.locale.amEastBound;\n              }\n              else if(outOfBoundsPos.x < inBoundsPos.x){\n                  output.innerText = M.options.locale.amWestBound;\n              }\n              else if(outOfBoundsPos.y < inBoundsPos.y){\n                  output.innerText = M.options.locale.amNorthBound;\n              }\n              else if(outOfBoundsPos.y > inBoundsPos.y){\n                  output.innerText = M.options.locale.amSouthBound;\n              }\n\n          }\n          else {\n              let prevZoom = this._history[this._historyIndex - 1] ? this._history[this._historyIndex - 1].zoom : this._history[this._historyIndex].zoom;\n              if(mapZoom === this._map._layersMaxZoom && mapZoom !== prevZoom){\n                  output.innerText = M.options.locale.amMaxZoom + \" \" + standard;\n              }\n              else if(mapZoom === this._map._layersMinZoom && mapZoom !== prevZoom){\n                  output.innerText = M.options.locale.amMinZoom + \" \" + standard;\n              }\n              else {\n                  output.innerText = standard;\n              }\n          }\n          this._map.dragging._draggable.wasDragged = false;\n      },\n\n      totalBounds: function () {\n          let layers = Object.keys(this._layers);\n          let bounds = L.bounds();\n\n          layers.forEach(i => {\n              if(this._layers[i].layerBounds){\n                  if(!bounds){\n                      let point = this._layers[i].layerBounds.getCenter();\n                      bounds = L.bounds(point, point);\n                  }\n                  bounds.extend(this._layers[i].layerBounds.min);\n                  bounds.extend(this._layers[i].layerBounds.max);\n              }\n          });\n\n          this.totalLayerBounds = bounds;\n      },\n\n      dragged: function () {\n          this.wasDragged = true;\n      }\n\n  });\n\n  var FeatureIndex = L.Handler.extend({\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.inBoundFeatures = [];\n      this.outBoundFeatures = [];\n      this.currentIndex = 0;\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection);\n    },\n\n    addHooks: function () {\n      this._map.on(\"mapkeyboardfocused\", this._updateMapBounds, this);\n      this._map.on('mapkeyboardfocused', this._sortIndex, this);\n    },\n\n    removeHooks: function () {\n      this._map.off(\"mapkeyboardfocused\", this._updateMapBounds);\n      this._map.off('mapkeyboardfocused', this._sortIndex);\n    },\n\n    /**\n     * Adds a svg element to the index of tabbable features, it also keeps track of the layer it's associated + center\n     * @param layer - the layer object the feature is associated with\n     * @param lc - the layer center\n     * @param path - the svg element that needs to be focused, can be a path or g\n     */\n    addToIndex: function (layer, lc, path) {\n      let mc = this._mapPCRSBounds.getCenter();\n      let dist = Math.sqrt(Math.pow(lc.x - mc.x, 2) + Math.pow(lc.y - mc.y, 2));\n      let index = this._mapPCRSBounds.contains(lc) ? this.inBoundFeatures : this.outBoundFeatures;\n\n      let elem = {path: path, layer: layer, center: lc, dist: dist};\n      path.setAttribute(\"tabindex\", -1);\n\n      index.push(elem);\n\n      // TODO: this insertion loop has potential to be improved slightly\n      for (let i = index.length - 1; i > 0 && index[i].dist < index[i-1].dist; i--) {\n        let tmp = index[i];\n        index[i] = index[i-1];\n        index[i-1] = tmp;\n      }\n\n      if (this._mapPCRSBounds.contains(lc))\n        this.inBoundFeatures = index;\n      else\n        this.outBoundFeatures = index;\n    },\n\n    /**\n     * Removes features that are no longer on the map, also moves features to the respective array depending\n     * on whether the feature is in the maps viewport or not\n     */\n    cleanIndex: function() {\n      this.currentIndex = 0;\n      this.inBoundFeatures = this.inBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute(\"tabindex\", -1);\n        if (elem.layer._map && !inbound) {\n          this.outBoundFeatures.push(elem);\n        }\n        return elem.layer._map && inbound;\n      });\n      this.outBoundFeatures = this.outBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute(\"tabindex\", -1);\n        if (elem.layer._map && inbound) {\n          this.inBoundFeatures.push(elem);\n        }\n        return elem.layer._map && !inbound;\n      });\n    },\n\n    /**\n     * Sorts the index of features in the map's viewport based on distance from center\n     * @private\n     */\n    _sortIndex: function() {\n      this.cleanIndex();\n      if(this.inBoundFeatures.length === 0) return;\n\n      let mc = this._mapPCRSBounds.getCenter();\n\n      this.inBoundFeatures.sort(function(a, b) {\n        let ac = a.center;\n        let bc = b.center;\n        a.dist = Math.sqrt(Math.pow(ac.x - mc.x, 2) + Math.pow(ac.y - mc.y, 2));\n        b.dist = Math.sqrt(Math.pow(bc.x - mc.x, 2) + Math.pow(bc.y - mc.y, 2));\n        return a.dist - b.dist;\n      });\n      this.inBoundFeatures[0].path.setAttribute(\"tabindex\", 0);\n    },\n\n    /**\n     * Event handler for 'mapfocused' event to update the map's bounds in terms of PCRS\n     * @param e - the event object\n     * @private\n     */\n    _updateMapBounds: function (e) {\n      // TODO: map's PCRS bounds is used in other parts of the viewer, can be moved out to the map object directly\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        this._map.getZoom(),\n        this._map.options.projection);\n    },\n  });\n\n  var Options = {\n    featureIndexOverlayOption: false,\n    announceMovement: false,\n    locale: {\n      cmBack: \"Back\",\n      cmForward: \"Forward\",\n      cmReload: \"Reload\",\n      cmToggleControls: \"Toggle Controls\",\n      cmCopyCoords: \"Copy Coordinates\",\n      cmToggleDebug: \"Toggle Debug Mode\",\n      cmCopyMapML: \"Copy MapML\",\n      cmPasteLayer: \"Paste\",\n      cmViewSource: \"View Map Source\",\n      cmCopyAll: \"All\",\n      lmZoomToLayer: \"Zoom To Layer\",\n      lmCopyExtent: \"Copy Extent\",\n      lmCopyLayer: \"Copy Layer\",\n      lcOpacity: \"Opacity\",\n      btnZoomIn: \"Zoom in\",\n      btnZoomOut: \"Zoom out\",\n      btnFullScreen: \"View fullscreen\",\n      amZoom: \"zoom level\",\n      amColumn: \"column\",\n      amRow: \"row\",\n      amMaxZoom: \"At maximum zoom level, zoom in disabled\",\n      amMinZoom: \"At minimum zoom level, zoom out disabled\",\n      amZoomedOut: \"Zoomed out of bounds, returning to\",\n      amDraggedOut: \"Dragged out of bounds, returning to\",\n      amEastBound: \"Reached east bound, panning east disabled\",\n      amWestBound: \"Reached west bound, panning west disabled\",\n      amNorthBound: \"Reached north bound, panning north disabled\",\n      amSouthBound: \"Reached south bound, panning south disabled\",\n      kbdShortcuts: \"Keyboard shortcuts\",\n      kbdMovement: \"Movement keys\",\n      kbdFeature: \"Feature navigation keys\",\n      kbdPanUp: \"Pan up\",\n      kbdPanDown: \"Pan down\",\n      kbdPanLeft: \"Pan left\",\n      kbdPanRight: \"Pan right\",\n      kbdPanIncrement: \"pan increment\",\n      kbdZoom: \"Zoom in/out 3 levels\",\n      kbdPrevFeature: \"Previous feature\",\n      kbdNextFeature: \"Next feature\",\n      dfLayer: \"Layer\",\n    }\n  };\n\n  L.Map.Keyboard.include({\n      _onKeyDown: function (e) {\n\n          if (e.altKey || e.metaKey) { return; }\n\n          let zoomIn = {\n              187: 187,\n              107: 107,\n              61: 61,\n              171: 171\n          };\n\n          let zoomOut = {\n              189: 189,\n              109: 109,\n              54: 54,\n              173: 173\n          };\n\n          var key = e.keyCode,\n              map = this._map,\n              offset;\n\n          if (key in this._panKeys) {\n              if (!map._panAnim || !map._panAnim._inProgress) {\n                  offset = this._panKeys[key];\n                  if (e.shiftKey) {\n                      offset = L.point(offset).multiplyBy(3);\n                  }\n                  if (e.ctrlKey) {\n                      offset = L.point(offset).divideBy(5);\n                  }\n\n                  map.panBy(offset);\n\n                  if (map.options.maxBounds) {\n                      map.panInsideBounds(map.options.maxBounds);\n                  }\n              }\n          } else if (key in this._zoomKeys) {\n              if((key in zoomIn && map._layersMaxZoom !== map.getZoom()) || (key in zoomOut && map._layersMinZoom !== map.getZoom()))\n                  map.setZoom(map.getZoom() + (e.shiftKey ? 3 : 1) * this._zoomKeys[key]);\n\n          } else if (key === 27 && map._popup && map._popup.options.closeOnEscapeKey) {\n              map.closePopup();\n\n          } else {\n              return;\n          }\n\n          L.DomEvent.stop(e);\n      }\n  });\n\n  var FeatureIndexOverlay = L.Layer.extend({\n      onAdd: function (map) {\n          let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><path fill=\"none\" stroke=\"#000\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M0 0h100v100H0z\" color=\"#000\" overflow=\"visible\"/></svg>`;\n\n          this._container = L.DomUtil.create(\"div\", \"mapml-feature-index-box\", map._container);\n          this._container.innerHTML = svgInnerHTML;\n\n          this._output = L.DomUtil.create(\"output\", \"mapml-feature-index\", map._container);\n          this._output.setAttribute(\"role\", \"status\");\n          this._output.setAttribute(\"aria-live\", \"polite\");\n          this._output.setAttribute(\"aria-atomic\", \"true\");\n          this._body = L.DomUtil.create(\"span\", \"mapml-feature-index-content\", this._output);\n          this._body.index = 0;\n          this._output.initialFocus = false;\n          map.on(\"layerchange layeradd layerremove overlayremove\", this._toggleEvents, this);\n          map.on('moveend focus templatedfeatureslayeradd', this._checkOverlap, this);\n          map.on(\"keydown\", this._onKeyDown, this);\n          this._addOrRemoveFeatureIndex();\n      },\n\n      _calculateReticleBounds: function () {\n          let bounds = this._map.getPixelBounds();\n          let center = bounds.getCenter();\n          let wRatio = Math.abs(bounds.min.x - bounds.max.x) / (this._map.options.mapEl.width);\n          let hRatio = Math.abs(bounds.min.y - bounds.max.y) / (this._map.options.mapEl.height);\n\n          let reticleDimension = (getComputedStyle(this._container).width).replace(/[^\\d.]/g,'');\n          if((getComputedStyle(this._container).width).slice(-1) === \"%\") {\n              reticleDimension = reticleDimension * this._map.options.mapEl.width / 100;\n          }\n          let w = wRatio * reticleDimension / 2;\n          let h = hRatio * reticleDimension / 2;\n          let minPoint = L.point(center.x - w, center.y + h);\n          let maxPoint = L.point(center.x + w, center.y - h);\n          let b = L.bounds(minPoint, maxPoint);\n          return M.pixelToPCRSBounds(b,this._map.getZoom(),this._map.options.projection);\n      },\n\n      _checkOverlap: function (e) {\n          if(e.type === \"focus\") this._output.initialFocus = true;\n          if(!this._output.initialFocus) return;\n          if(this._output.popupClosed) {\n              this._output.popupClosed = false;\n              return;\n          }\n\n          this._map.fire(\"mapkeyboardfocused\");\n\n          let featureIndexBounds = this._calculateReticleBounds();\n          let features = this._map.featureIndex.inBoundFeatures;\n          let index = 1;\n          let keys = Object.keys(features);\n          let body = this._body;\n\n          body.innerHTML = \"\";\n          body.index = 0;\n\n          body.allFeatures = [];\n          keys.forEach(i => {\n              let layer = features[i].layer;\n              let layers = features[i].layer._layers;\n              let bounds = L.bounds();\n\n              if(layers) {\n                  let keys = Object.keys(layers);\n                  keys.forEach(j => {\n                      if(!bounds) bounds = L.bounds(layer._layers[j]._bounds.min, layer._layers[j]._bounds.max);\n                      bounds.extend(layer._layers[j]._bounds.min);\n                      bounds.extend(layer._layers[j]._bounds.max);\n                  });\n              } else if(layer._bounds){\n                  bounds = L.bounds(layer._bounds.min, layer._bounds.max);\n              }\n\n              if(featureIndexBounds.overlaps(bounds)){\n                  let label = features[i].path.getAttribute(\"aria-label\");\n\n                  if (index < 8){\n                      body.appendChild(this._updateOutput(label, index, index));\n                  }\n                  if (index % 7 === 0 || index === 1) {\n                      body.allFeatures.push([]);\n                  }\n                  body.allFeatures[Math.floor((index - 1) / 7)].push({label, index, layer});\n                  if (body.allFeatures[1] && body.allFeatures[1].length === 1){\n                      body.appendChild(this._updateOutput(\"More results\", 0, 9));\n                  }\n                  index += 1;\n              }\n          });\n          this._addToggleKeys();\n      },\n\n      _updateOutput: function (label, index, key) {\n          let span = document.createElement(\"span\");\n          span.setAttribute(\"data-index\", index);\n          //\", \" adds a brief auditory pause when a screen reader is reading through the feature index\n          //also prevents names with numbers + key from being combined when read\n          span.innerHTML =  `<kbd>${key}</kbd>` + \" \" + label + \"<span>, </span>\";\n          return span;\n      },\n\n      _addToggleKeys: function () {\n          let allFeatures = this._body.allFeatures;\n          for(let i = 0; i < allFeatures.length; i++){\n              if(allFeatures[i].length === 0) return;\n              if(allFeatures[i - 1]){\n                  let label = \"Previous results\";\n                  allFeatures[i].push({label});\n              }\n\n              if(allFeatures[i + 1] && allFeatures[i + 1].length > 0){\n                  let label = \"More results\";\n                  allFeatures[i].push({label});\n              }\n          }\n      },\n\n      _onKeyDown: function (e){\n          let body = this._body;\n          let key = e.originalEvent.keyCode;\n          if (key >= 49 && key <= 55){\n              if(!body.allFeatures[body.index]) return;\n              let feature = body.allFeatures[body.index][key - 49];\n              if (!feature) return;\n              let layer = feature.layer;\n              if (layer) {\n                  this._map.featureIndex.currentIndex = feature.index - 1;\n                  if (layer._popup){\n                      this._map.closePopup();\n                      layer.openPopup();\n                  }\n                  else layer.options.group.focus();\n              }\n          } else if(key === 56){\n              this._newContent(body, -1);\n          } else if(key === 57){\n              this._newContent(body, 1);\n          }\n      },\n\n      _newContent: function (body, direction) {\n          let index = body.firstChild.getAttribute(\"data-index\");\n          let newContent = body.allFeatures[Math.floor(((index - 1) / 7) + direction)];\n          if(newContent && newContent.length > 0){\n              body.innerHTML = \"\";\n              body.index += direction;\n              for(let i = 0; i < newContent.length; i++){\n                  let feature = newContent[i];\n                  let index = feature.index ? feature.index : 0;\n                  let key = i + 1;\n                  if (feature.label === \"More results\") key = 9;\n                  if (feature.label === \"Previous results\") key = 8;\n                  body.appendChild(this._updateOutput(feature.label, index, key));\n              }\n          }\n      },\n\n      _toggleEvents: function (){\n          this._map.on(\"viewreset move moveend focus blur popupclose\", this._addOrRemoveFeatureIndex, this);\n\n      },\n\n      _addOrRemoveFeatureIndex: function (e) {\n          let features = this._body.allFeatures ? this._body.allFeatures.length : 0;\n          //Toggle aria-hidden attribute so screen reader rereads the feature index on focus\n          if (!this._output.initialFocus) {\n              this._output.setAttribute(\"aria-hidden\", \"true\");\n          } else if(this._output.hasAttribute(\"aria-hidden\")){\n              let obj = this;\n              setTimeout(function () {\n                  obj._output.removeAttribute(\"aria-hidden\");\n              }, 100);\n          }\n\n          if(e && e.type === \"popupclose\") {\n              this._output.setAttribute(\"aria-hidden\", \"true\");\n              this._output.popupClosed = true;\n          } else if (e && e.type === \"focus\") {\n              this._container.removeAttribute(\"hidden\");\n              if (features !== 0) this._output.classList.remove(\"mapml-screen-reader-output\");\n          } else if (e && e.originalEvent && e.originalEvent.type === 'pointermove') {\n              this._container.setAttribute(\"hidden\", \"\");\n              this._output.classList.add(\"mapml-screen-reader-output\");\n          } else if (e && e.target._popup) {\n              this._container.setAttribute(\"hidden\", \"\");\n          } else if (e && e.type === \"blur\") {\n              this._container.setAttribute(\"hidden\", \"\");\n              this._output.classList.add(\"mapml-screen-reader-output\");\n              this._output.initialFocus = false;\n              this._addOrRemoveFeatureIndex();\n          } else if (this._map.isFocused && e) {\n              this._container.removeAttribute(\"hidden\");\n              if (features !== 0) {\n                  this._output.classList.remove(\"mapml-screen-reader-output\");\n              } else {\n                  this._output.classList.add(\"mapml-screen-reader-output\");\n              }\n          } else {\n              this._container.setAttribute(\"hidden\", \"\");\n              this._output.classList.add(\"mapml-screen-reader-output\");\n          }\n\n      },\n\n  });\n\n  var featureIndexOverlay = function (options) {\n      return new FeatureIndexOverlay(options);\n  };\n\n  /* \n   * Copyright 2015-2016 Canada Centre for Mapping and Earth Observation, \n   * Earth Sciences Sector, Natural Resources Canada.\n   * \n   * License\n   * \n   * By obtaining and/or copying this work, you (the licensee) agree that you have \n   * read, understood, and will comply with the following terms and conditions.\n   * \n   * Permission to copy, modify, and distribute this work, with or without \n   * modification, for any purpose and without fee or royalty is hereby granted, \n   * provided that you include the following on ALL copies of the work or portions \n   * thereof, including modifications:\n   * \n   * The full text of this NOTICE in a location viewable to users of the \n   * redistributed or derivative work.\n   * \n   * Any pre-existing intellectual property disclaimers, notices, or terms and \n   * conditions. If none exist, the W3C Software and Document Short Notice should \n   * be included.\n   * \n   * Notice of any changes or modifications, through a copyright statement on the \n   * new code or document such as \"This software or document includes material \n   * copied from or derived from [title and URI of the W3C document]. \n   * Copyright  [YEAR] W3C (MIT, ERCIM, Keio, Beihang).\"\n   * \n   * Disclaimers\n   * \n   * THIS WORK IS PROVIDED \"AS IS,\" AND COPYRIGHT HOLDERS MAKE NO REPRESENTATIONS \n   * OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF \n   * MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE \n   * SOFTWARE OR DOCUMENT WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, \n   * TRADEMARKS OR OTHER RIGHTS.\n   * COPYRIGHT HOLDERS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR \n   * CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SOFTWARE OR DOCUMENT.\n   * \n   * The name and trademarks of copyright holders may NOT be used in advertising or \n   * publicity pertaining to the work without specific, written prior permission. \n   * Title to copyright in this work will at all times remain with copyright holders.\n   */\n\n  /* global L, Node */\n  (function (window, document, undefined$1) {\n    \n  var M = {};\n  window.M = M;\n\n  (function () {\n    M.detectImagePath = function (container) {\n      // this relies on the CSS style leaflet-default-icon-path containing a \n      // relative url() that leads to a valid icon file.  Since that depends on\n      // how all of this stuff is deployed (i.e. custom element or as leaflet-plugin)\n      // also, because we're using 'shady DOM' api, the container must be \n      // a shady dom container, because the custom element tags it with added\n      // style-scope ... and related classes.\n     var el = L.DomUtil.create('div',  'leaflet-default-icon-path', container);\n     var path = L.DomUtil.getStyle(el, 'background-image') ||\n                L.DomUtil.getStyle(el, 'backgroundImage');\t// IE8\n\n     container.removeChild(el);\n\n     if (path === null || path.indexOf('url') !== 0) {\n      path = '';\n     } else {\n      path = path.replace(/^url\\([\"']?/, '').replace(/marker-icon\\.png[\"']?\\)$/, '');\n     }\n\n     return path;\n    };\n    M.mime = \"text/mapml\";\n\n    let mapOptions = window.document.head.querySelector(\"map-options\");\n    M.options = Options;\n    if (mapOptions) M.options = Object.assign(M.options, JSON.parse(mapOptions.innerHTML));\n\n    // see https://leafletjs.com/reference-1.5.0.html#crs-l-crs-base\n    // \"new classes can't inherit from (L.CRS), and methods can't be added \n    // to (L.CRS.anything) with the include function\n    // so we'll use the options property as a way to integrate needed \n    // properties and methods...\n    M.WGS84 = new L.Proj.CRS('EPSG:4326','+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ', {\n      origin: [-180,+90],\n      bounds: L.bounds([[-180,-90],[180,90]]),\n      resolutions: [\n        0.703125,\n        0.3515625,\n        0.17578125,\n        0.087890625,\n        0.0439453125,\n        0.02197265625,\n        0.010986328125,\n        0.0054931640625,\n        0.00274658203125,\n        0.001373291015625,\n        0.0006866455078125,\n        0.0003433227539062,\n        0.0001716613769531,\n        0.0000858306884766,\n        0.0000429153442383,\n        0.0000214576721191,\n        0.0000107288360596,\n        0.0000053644180298,\n        0.0000026822090149,\n        0.0000013411045074,\n        0.0000006705522537,\n        0.0000003352761269\n      ],\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (M.WGS84.options.bounds.getSize().x / M.WGS84.options.resolutions[zoom]).toFixed()\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (M.WGS84.options.bounds.getSize().y / M.WGS84.options.resolutions[zoom]).toFixed()\n          },\n          bounds: zoom => L.bounds([M.WGS84.options.crs.tcrs.horizontal.min,\n                            M.WGS84.options.crs.tcrs.vertical.min],\n                           [M.WGS84.options.crs.tcrs.horizontal.max(zoom),\n                            M.WGS84.options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"longitude\",\n            get min() {return M.WGS84.options.crs.gcrs.horizontal.min;},\n            get max() {return M.WGS84.options.crs.gcrs.horizontal.max;}\n          }, \n          vertical: {\n            name: \"latitude\", \n            get min() {return M.WGS84.options.crs.gcrs.vertical.min;},\n            get max() {return M.WGS84.options.crs.gcrs.vertical.max;}\n          },\n          get bounds() {return M.WGS84.options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: -180.0,\n            max: 180.0\n          }, \n          vertical: {\n            name: \"latitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: -90.0,\n            max: 90.0\n          },\n          get bounds() {return L.latLngBounds(\n                [M.WGS84.options.crs.gcrs.vertical.min,M.WGS84.options.crs.gcrs.horizontal.min],\n                [M.WGS84.options.crs.gcrs.vertical.max,M.WGS84.options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: 256\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: 256\n          },\n          get bounds() {return L.bounds(\n                    [M.WGS84.options.crs.tile.horizontal.min,M.WGS84.options.crs.tile.vertical.min],\n                    [M.WGS84.options.crs.tile.horizontal.max,M.WGS84.options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (M.WGS84.options.crs.tcrs.horizontal.max(zoom) / M.WGS84.options.crs.tile.bounds.getSize().x).toFixed()\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (M.WGS84.options.crs.tcrs.vertical.max(zoom) / M.WGS84.options.crs.tile.bounds.getSize().y).toFixed()\n          },\n          bounds: zoom => L.bounds(\n                   [M.WGS84.options.crs.tilematrix.horizontal.min,\n                    M.WGS84.options.crs.tilematrix.vertical.min],\n                   [M.WGS84.options.crs.tilematrix.horizontal.max(zoom),\n                    M.WGS84.options.crs.tilematrix.vertical.max(zoom)])\n        }\n      }\n    });\n    M.CBMTILE = new L.Proj.CRS('EPSG:3978',\n    '+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs', {\n      origin: [-34655800, 39310000],\n      bounds: L.bounds([[-34655800,-39000000],[10000000,39310000]]),\n      resolutions: [\n        38364.660062653464, \n        22489.62831258996, \n        13229.193125052918, \n        7937.5158750317505, \n        4630.2175937685215, \n        2645.8386250105837,\n        1587.5031750063501,\n        926.0435187537042, \n        529.1677250021168, \n        317.50063500127004, \n        185.20870375074085, \n        111.12522225044451, \n        66.1459656252646, \n        38.36466006265346, \n        22.48962831258996,\n        13.229193125052918,\n        7.9375158750317505, \n        4.6302175937685215,\n        2.6458386250105836,\n        1.5875031750063502,\n        0.92604351875370428,\n        0.52916772500211673,\n        0.31750063500127002,\n        0.18520870375074083,\n        0.11112522225044451,\n        0.066145965625264591\n      ],\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (M.CBMTILE.options.bounds.getSize().x / M.CBMTILE.options.resolutions[zoom]).toFixed()\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (M.CBMTILE.options.bounds.getSize().y / M.CBMTILE.options.resolutions[zoom]).toFixed()\n          },\n          bounds: zoom => L.bounds([M.CBMTILE.options.crs.tcrs.horizontal.min,\n                            M.CBMTILE.options.crs.tcrs.vertical.min],\n                           [M.CBMTILE.options.crs.tcrs.horizontal.max(zoom),\n                            M.CBMTILE.options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"easting\",\n            get min() {return M.CBMTILE.options.bounds.min.x;},\n            get max() {return M.CBMTILE.options.bounds.max.x;}\n          }, \n          vertical: {\n            name: \"northing\", \n            get min() {return M.CBMTILE.options.bounds.min.y;},\n            get max() {return M.CBMTILE.options.bounds.max.y;}\n          },\n          get bounds() {return M.CBMTILE.options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: -141.01,\n            max: -47.74\n          }, \n          vertical: {\n            name: \"latitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: 40.04,\n            max: 86.46\n          },\n          get bounds() {return L.latLngBounds(\n                [M.CBMTILE.options.crs.gcrs.vertical.min,M.CBMTILE.options.crs.gcrs.horizontal.min],\n                [M.CBMTILE.options.crs.gcrs.vertical.max,M.CBMTILE.options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: 256\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: 256\n          },\n          get bounds() {return L.bounds(\n                    [M.CBMTILE.options.crs.tile.horizontal.min,M.CBMTILE.options.crs.tile.vertical.min],\n                    [M.CBMTILE.options.crs.tile.horizontal.max,M.CBMTILE.options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (M.CBMTILE.options.crs.tcrs.horizontal.max(zoom) / M.CBMTILE.options.crs.tile.bounds.getSize().x).toFixed()\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (M.CBMTILE.options.crs.tcrs.vertical.max(zoom) / M.CBMTILE.options.crs.tile.bounds.getSize().y).toFixed()\n          },\n          bounds: zoom => L.bounds([0,0],\n                   [M.CBMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tilematrix.vertical.max(zoom)])\n        }\n      }\n    });\n    M.APSTILE = new L.Proj.CRS('EPSG:5936',\n    '+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs', {\n      origin: [-2.8567784109255E7, 3.2567784109255E7],\n      bounds: L.bounds([[-28567784.109254867,-28567784.109254755],[32567784.109255023,32567784.10925506]]),\n      resolutions: [\n        238810.813354,\n        119405.406677,\n        59702.7033384999,\n        29851.3516692501,\n        14925.675834625,\n        7462.83791731252,\n        3731.41895865639,\n        1865.70947932806,\n        932.854739664032,\n        466.427369832148,\n        233.213684916074,\n        116.606842458037,\n        58.3034212288862,\n        29.1517106145754,\n        14.5758553072877,\n        7.28792765351156,\n        3.64396382688807,\n        1.82198191331174,\n        0.910990956788164,\n        0.45549547826179\n      ],\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (M.APSTILE.options.bounds.getSize().x / M.APSTILE.options.resolutions[zoom]).toFixed()\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (M.APSTILE.options.bounds.getSize().y / M.APSTILE.options.resolutions[zoom]).toFixed()\n          },\n          bounds: zoom => L.bounds([M.APSTILE.options.crs.tcrs.horizontal.min,\n                            M.APSTILE.options.crs.tcrs.vertical.min],\n                           [M.APSTILE.options.crs.tcrs.horizontal.max(zoom),\n                            M.APSTILE.options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"easting\",\n            get min() {return M.APSTILE.options.bounds.min.x;},\n            get max() {return M.APSTILE.options.bounds.max.x;}\n          }, \n          vertical: {\n            name: \"northing\", \n            get min() {return M.APSTILE.options.bounds.min.y;},\n            get max() {return M.APSTILE.options.bounds.max.y;}\n          },\n          get bounds() {return M.APSTILE.options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: -180.0,\n            max: 180.0\n          }, \n          vertical: {\n            name: \"latitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: 60.0,\n            max: 90.0\n          },\n          get bounds() {return L.latLngBounds(\n                    [M.APSTILE.options.crs.gcrs.vertical.min,M.APSTILE.options.crs.gcrs.horizontal.min],\n                    [M.APSTILE.options.crs.gcrs.vertical.max,M.APSTILE.options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: 256\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: 256\n          },\n          get bounds() {return L.bounds(\n                    [M.APSTILE.options.crs.tile.horizontal.min,M.APSTILE.options.crs.tile.vertical.min],\n                    [M.APSTILE.options.crs.tile.horizontal.max,M.APSTILE.options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (M.APSTILE.options.crs.tcrs.horizontal.max(zoom) / M.APSTILE.options.crs.tile.bounds.getSize().x).toFixed()\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (M.APSTILE.options.crs.tcrs.vertical.max(zoom) / M.APSTILE.options.crs.tile.bounds.getSize().y).toFixed()\n          },\n          bounds: zoom => L.bounds([0,0],\n                   [M.APSTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tilematrix.vertical.max(zoom)])\n        }\n      }\n    });\n    M.OSMTILE = L.CRS.EPSG3857;\n    L.setOptions(M.OSMTILE, {\n      origin: [-20037508.342787, 20037508.342787],\n      bounds: L.bounds([[-20037508.342787, -20037508.342787],[20037508.342787, 20037508.342787]]),\n      resolutions: [\n        156543.0339,\n        78271.51695,\n        39135.758475,\n        19567.8792375,\n        9783.93961875,\n        4891.969809375,\n        2445.9849046875,\n        1222.9924523438,\n        611.49622617188,\n        305.74811308594,\n        152.87405654297,\n        76.437028271484,\n        38.218514135742,\n        19.109257067871,\n        9.5546285339355,\n        4.7773142669678,\n        2.3886571334839,\n        1.1943285667419,\n        0.59716428337097,\n        0.29858214168549,\n        0.14929107084274,\n        0.074645535421371,\n        0.03732276771068573,\n        0.018661383855342865,\n        0.009330691927671432495\n      ],\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (M.OSMTILE.options.bounds.getSize().x / M.OSMTILE.options.resolutions[zoom]).toFixed()\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (M.OSMTILE.options.bounds.getSize().y / M.OSMTILE.options.resolutions[zoom]).toFixed()\n          },\n          bounds: zoom => L.bounds([M.OSMTILE.options.crs.tcrs.horizontal.min,\n                            M.OSMTILE.options.crs.tcrs.vertical.min],\n                           [M.OSMTILE.options.crs.tcrs.horizontal.max(zoom),\n                            M.OSMTILE.options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"easting\",\n            get min() {return M.OSMTILE.options.bounds.min.x;},\n            get max() {return M.OSMTILE.options.bounds.max.x;}\n          }, \n          vertical: {\n            name: \"northing\", \n            get min() {return M.OSMTILE.options.bounds.min.y;},\n            get max() {return M.OSMTILE.options.bounds.max.y;}\n          },\n          get bounds() {return M.OSMTILE.options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            get min() {return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lng;},\n            get max() {return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lng;}\n          }, \n          vertical: {\n            name: \"latitude\",\n            get min() {return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lat;},\n            get max() {return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lat;}\n          },\n          get bounds() {return L.latLngBounds(\n                [M.OSMTILE.options.crs.gcrs.vertical.min,M.OSMTILE.options.crs.gcrs.horizontal.min],\n                [M.OSMTILE.options.crs.gcrs.vertical.max,M.OSMTILE.options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: 256\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: 256\n          },\n          get bounds() {return L.bounds(\n                    [M.OSMTILE.options.crs.tile.horizontal.min,M.OSMTILE.options.crs.tile.vertical.min],\n                    [M.OSMTILE.options.crs.tile.horizontal.max,M.OSMTILE.options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (M.OSMTILE.options.crs.tcrs.horizontal.max(zoom) / M.OSMTILE.options.crs.tile.bounds.getSize().x).toFixed()\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (M.OSMTILE.options.crs.tcrs.vertical.max(zoom) / M.OSMTILE.options.crs.tile.bounds.getSize().y).toFixed()\n          },\n          bounds: zoom => L.bounds([0,0],\n                   [M.OSMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.OSMTILE.options.crs.tilematrix.vertical.max(zoom)])\n        }\n      }\n    });\n  }());\n\n  M.handleLink = Util.handleLink;\n  M.convertPCRSBounds = Util.convertPCRSBounds;\n  M.axisToXY = Util.axisToXY;\n  M.csToAxes = Util.csToAxes;\n  M.convertAndFormatPCRS = Util.convertAndFormatPCRS;\n  M.axisToCS = Util.axisToCS;\n  M.parseNumber = Util.parseNumber;\n  M.extractInputBounds = Util.extractInputBounds;\n  M.splitCoordinate = Util.splitCoordinate;\n  M.boundsToPCRSBounds = Util.boundsToPCRSBounds;\n  M.pixelToPCRSBounds = Util.pixelToPCRSBounds;\n  M.metaContentToObject = Util.metaContentToObject;\n  M.coordsToArray = Util.coordsToArray;\n  M.parseStylesheetAsHTML = Util.parseStylesheetAsHTML;\n  M.pointToPCRSPoint = Util.pointToPCRSPoint;\n  M.pixelToPCRSPoint = Util.pixelToPCRSPoint;\n  M.gcrsToTileMatrix = Util.gcrsToTileMatrix;\n  M.properties2Table = Util.properties2Table;\n  M.updateExtent = Util.updateExtent;\n  M.geojson2mapml = Util.geojson2mapml;\n  M.breakArray = Util.breakArray;\n  M.table2properties = Util.table2properties;\n  M.geometry2geojson = Util.geometry2geojson;\n  M.pcrsToGcrs = Util.pcrsToGcrs;\n  M.mapml2geojson = Util.mapml2geojson;\n\n  M.QueryHandler = QueryHandler;\n  M.ContextMenu = ContextMenu;\n  M.AnnounceMovement = AnnounceMovement;\n  M.FeatureIndex = FeatureIndex;\n\n  // see https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\n  L.Map.addInitHook('addHandler', 'query', M.QueryHandler);\n  L.Map.addInitHook('addHandler', 'contextMenu', M.ContextMenu);\n  L.Map.addInitHook('addHandler', 'announceMovement', M.AnnounceMovement);\n  L.Map.addInitHook('addHandler', 'featureIndex', M.FeatureIndex);\n\n  M.MapMLLayer = MapMLLayer;\n  M.mapMLLayer = mapMLLayer;\n\n  M.ImageOverlay = ImageOverlay;\n  M.imageOverlay = imageOverlay;\n\n  M.TemplatedImageLayer = TemplatedImageLayer;\n  M.templatedImageLayer = templatedImageLayer;\n\n  M.TemplatedFeaturesLayer = TemplatedFeaturesLayer;\n  M.templatedFeaturesLayer = templatedFeaturesLayer;\n\n  M.TemplatedLayer = TemplatedLayer;\n  M.templatedLayer = templatedLayer;\n\n  M.TemplatedTileLayer = TemplatedTileLayer;\n  M.templatedTileLayer = templatedTileLayer;\n\n  M.MapMLFeatures = MapMLFeatures;\n  M.mapMlFeatures = mapMlFeatures;\n\n  M.MapMLLayerControl = MapMLLayerControl;\n  M.mapMlLayerControl = mapMlLayerControl;\n\n  M.ReloadButton = ReloadButton;\n  M.reloadButton = reloadButton;\n\n  M.FullscreenButton = FullscreenButton;\n  M.fullscreenButton = fullscreenButton;\n\n  M.attributionControl = attributionControl;\n\n  M.MapMLStaticTileLayer = MapMLStaticTileLayer;\n  M.mapMLStaticTileLayer = mapMLStaticTileLayer;\n\n  M.DebugOverlay = DebugOverlay;\n  M.debugOverlay = debugOverlay;\n\n  M.Crosshair = Crosshair;\n  M.crosshair = crosshair;\n\n  M.FeatureIndexOverlay = FeatureIndexOverlay;\n  M.featureIndexOverlay = featureIndexOverlay;\n\n  M.Feature = Feature;\n  M.feature = feature;\n\n  M.FeatureRenderer = FeatureRenderer;\n  M.featureRenderer = featureRenderer;\n\n  M.FeatureGroup = FeatureGroup;\n  M.featureGroup = featureGroup;\n\n  }(window));\n\n}());\n"],"names":["mapMLStaticTileLayer","options","MapMLStaticTileLayer","mapMlLayerControl","layers","MapMLLayerControl","L","GridLayer","extend","initialize","this","zoomBounds","_getZoomBounds","tileContainer","maxZoomBound","setOptions","_groups","_groupTiles","getElementsByTagName","onAdd","_bounds","_getLayerBounds","_map","projection","layerBounds","Object","keys","let","key","min","max","prototype","call","_handleMoveEnd","getEvents","events","_parentOnMoveEnd","moveend","move","e","mapZoom","getZoom","zoomLevel","maxNativeZoom","minNativeZoom","isVisible","maxZoom","minZoom","overlaps","M","pixelToPCRSBounds","getPixelBounds","_isValidTile","coords","_tileCoordsToKey","createTile","tileGroup","tileElem","document","createElement","tileSize","getTileSize","setAttribute","x","y","z","i","length","tile","width","height","alt","src","appendChild","tileGroups","crs","bounds","sCoords","split","pixelCoords","point","pixelBounds","zoom","container","meta","metaContentToObject","getAttribute","tiles","nativeZoom","value","lZoom","Math","tileMap","row","col","tileCode","push","Control","Layers","autoZIndex","sortLayers","sortFunction","layerA","layerB","zIndex","overlays","_layerControlInputs","_layers","_lastZIndex","_handlingClick","_addLayer","_initLayout","on","_validateInput","DomEvent","mapEl","_container","_focusFirstLayer","_update","_showControls","onRemove","map","off","layer","_onLayerChange","addOrUpdateOverlay","name","alreadyThere","addOverlay","removeAttribute","removeLayer","input","labels","label","checked","_layerEl","disabled","closest","style","fontStyle","_extent","_mapExtents","j","extentAnatomy","getElementsByClassName","elem","className","children","setTimeout","focus","_withinZoomBounds","range","_addItem","obj","layercontrols","getLayerUserControlsHTML","querySelector","layerId","stamp","_onInputClick","_overlaysList","collapse","target","tagName","relatedTarget","parentElement","contextMenu","_layerMenu","display","DomUtil","removeClass","FALLBACK_PROJECTION","FALLBACK_CS","BLANK_TT_TREF","mapMlFeatures","mapml","MapMLFeatures","templatedTileLayer","template","TemplatedTileLayer","templatedLayer","templates","TemplatedLayer","templatedFeaturesLayer","TemplatedFeaturesLayer","templatedImageLayer","TemplatedImageLayer","imageOverlay","url","location","size","angle","ImageOverlay","mapMLLayer","node","MapMLLayer","debugOverlay","DebugOverlay","reloadButton","ReloadButton","FeatureGroup","native","static","create","pane","addClass","renderer","query","_mapmlFeatures","features","_getNativeVariables","nativeCS","cs","_features","_staticFeature","addData","_resetFeatures","_clampZoom","_leafletLayer","_addZoomLimit","showPaginationFeature","remove","featureIndex","cleanIndex","zoomend","_handleZoomEnd","feature","clearLayers","popup","_navigationBar","innerText","_totalFeatureCount","_content","srcdoc","innerHTML","content","withinZoom","_removeCSS","clampZoom","toUpperCase","metaKeys","includes","axisToCS","axes","csToAxes","boundsToPCRSBounds","error","tilematrix","k","addLayer","undefined","_setZoomTransform","center","scale","getZoomScale","translate","multiplyBy","subtract","_getNewPixelOrigin","round","any3d","setTransform","setPosition","nMin","nMax","resolutions","len","nodeType","Node","DOCUMENT_NODE","nodeName","base","hasAttribute","URL","href","parseStylesheetAsHTML","filter","classList","title","properties","add","insertAdjacentHTML","geometryToLayer","color","defaultOptions","resetStyle","onEachFeature","bindTooltip","interactive","sticky","featureZoom","Util","_setLayerStyle","setStyle","eachLayer","toDelete","querySelectorAll","removeChild","vectorOptions","geometry","group","svgGroup","SVG","copyOptions","assign","geo","featureID","id","wrappers","_getGeometryParents","featureLayer","groupOptions","accessibleTitle","collections","featureGroup","subType","elems","concat","TileLayer","inputData","extractInputBounds","extentBounds","tms","opacity","_setUpTileTemplateVars","subdomains","_template","_initContainer","_updateZIndex","mapBounds","linkEl","dispatchEvent","CustomEvent","detail","appendTile","type","startsWith","_url","_fetchTile","_mapmlTileReady","getPane","fetch","getTileUrl","redirect","then","response","status","Promise","resolve","console","log","reject","text","DOMParser","parseFromString","_createFeatures","catch","err","markup","svg","g","xOffset","yOffset","groupID","tileFeatures","FeatureRenderer","_initPath","_project","_addPath","_updateFeature","toString","contains","v","_getZoomForUrl","pcrs","easting","left","_tileMatrixToPCRSPosition","right","northing","top","bottom","server","_getSubdomain","indexOf","infinite","invertedY","_globalTileRange","r","detectRetina","Browser","retina","pos","nwPoint","scaleBy","sePoint","centrePoint","floor","nw","transformation","untransform","se","cen","result","Point","east","north","inputs","values","units","axis","position","shard","select","toLowerCase","horizontal","isNaN","Number","parseFloat","vertical","match","parseInt","servers","slice","parsedselect","htmlselect","pcrs2tilematrix","c","transform","divideBy","bind","pcrsBounds","zmin","zmax","clamp","step","Layer","_templates","rel","setZIndex","extentZIndex","errorTileUrl","hasSetBoundsHandler","_queries","_setupQueryVars","zoomstart","_onZoomStart","redraw","closePopup","queryVarNames","pixelleft","tileleft","mapleft","pixelright","tileright","mapright","pixeltop","tiletop","maptop","pixelbottom","tilebottom","mapbottom","tilei","mapi","tilej","mapj","reset","addToMap","hasLayer","old_templates","_previousFeature","_count","fire","_nextFeature","_source","changeOpacity","_setUpFeaturesTemplateVars","_onMoveEnd","featureRenderer","bindPopup","autoClose","minWidth","parent","parentNode","history","_history","current","previous","steppedZoom","headers","parser","context","_pullFeatureFeed","scaleBounds","getCenter","_getfeaturesUrl","Headers","Accept","limit","_updateTabIndex","layerNum","_path","childElementCount","getSize","_TCRSToPCRS","featuresVarNames","hidden","_setUpExtentTemplateVars","_onAdd","_clearLayer","containerImages","_addImage","loc","overlayToRemove","_imageOverlay","getImageUrl","_step","addTo","_overlayToRemove","_scaleImage","_image","_pixelOrigins","pixelOrigin","getPixelOrigin","_removeZoomLimit","extent","extentVarNames","_location","_size","_angle","viewreset","_reset","_zoomAnimated","zoomanim","_animateZoom","load","_onImageLoad","_initImage","addInteractiveTarget","removeInteractiveTarget","loaded","Date","_updateOpacity","image","nextFrame","fade","now","setOpacity","cancelAnimFrame","_fadeFrame","requestAnimFrame","maxNext","_href","_imageContainer","_mapmlTileContainer","_title","_initialize","_validateExtent","validProjection","_mapmlLayerItem","_removeExtents","_changeOpacity","opacityEl","_changeExtentOpacity","_templateVars","_changeExtent","extentEl","_setLayerElExtent","stopPropagation","_extent_mapExtents","_validProjection","_mapmlvectors","once","_imageLayer","layerGroup","_staticTileLayer","createAndAdd","_templatedLayer","_attachSkipButtons","noLayer","projectionMatch","getProjection","zoomMax","zoomMin","forEach","tempExtentBounds","extentZoomBounds","convertAndFormatPCRS","_onZoomAnim","toZoom","getMinZoom","getMaxZoom","zoomout","zoomin","getAttribution","attribution","getLayerExtentHTML","labelName","extentProperties","extentSettings","extentLabel","svgExtentControlIcon","extentControlPath1","extentControlPath2","extentNameIcon","extentItemControls","opacityControl","extentOpacitySummary","layerEl","removeExtentButton","stop","allRemoved","removed","_layerItemSettingsHTML","_extentGroupAnatomy","extentsettingsButton","extentItemNameSpan","defaultChecked","onmousedown","downEvent","preventDefault","control","controls","moving","yPos","clientY","body","onmousemove","moveEvent","offset","abs","getBoundingClientRect","pointerEvents","clientX","root","shadowRoot","elementAt","elementFromPoint","swapControl","offsetHeight","nextSibling","insertBefore","onmouseup","controlsElems","insertAdjacentElement","fieldset","layerItemName","settingsButtonNameIcon","layerItemProperty","layerItemSettings","itemToggleLabel","layerItemControls","opacityControlSummary","svgSettingsControlIcon","settingsControlPath1","settingsControlPath2","extentsFieldset","removeControlButton","nextElementSibling","disbaled","previousElementSibling","firstElementChild","itemSettingControlButton","_legendUrl","legendLink","draggable","_layer","_styles","_userInputs","frag","createDocumentFragment","selectdetails","selectsummary","mapmlInput","selectSummaryLabel","allHidden","xhr","fCallback","_initTemplateVars","serverExtent","metaExtent","templateVars","tlist","varNamesRe","RegExp","zoomInput","includesZoom","extentFallback","t","vcount","trel","ttype","exec","varName","inp","axisBounds","convertPCRSBounds","axisToXY","s","div","outerHTML","element","elementAttrNames","getAttributeNames","option","optionAttrNames","transcribe","queryable","decodeURI","extentPCRSFallback","_processInitialExtent","responseXML","responseText","readyState","DONE","serverMeta","mapprojection","selectedAlternate","baseURI","responseURL","_parseLicenseAndLegend","newTiles","nt","importNode","extentElement","styleLinks","stylesControl","stylesControlSummary","changeStyle","styleOption","styleOptionInput","styleOptionLabel","textContent","trim","Element","attributionControl","addAttribution","XMLHttpRequest","onreadystatechange","abort","onload","onerror","open","setRequestHeader","mime","overrideMimeType","send","lp","OSMTILE","xml","attText","licenseLink","licenseTitle","getQueryTemplates","pcrsClick","layerAndExtents","queryTemplate","_eventParents","mapFocusButton","_sortIndex","previousButton","featureCount","totalFeatures","nextButton","controlFocusButton","currentIndex","inBoundFeatures","path","_controlContainer","divider","focusFeature","focusEvent","originalEvent","composedPath","isTab","keyCode","shiftPressed","shiftKey","focusMap","_popupClosed","featureIndexOverlayOption","removeHandlers","removeEvent","mapSize","_panel","debugPanel","_grid","debugGrid","_panes","mapPane","_vectors","debugVectors","toolPane","DebugPanel","debug","_infoContainer","_debugContainer","infoContainer","_tileCoord","_tileMatrixCoord","_mapCoord","_tcrsCoord","_pcrsCoord","_gcrsCoord","_updateCoords","_visible","project","latlng","pointI","pointJ","trunc","containerPoint","lng","toFixed","lat","DebugGrid","join","outline","DebugVectors","LayerGroup","_mapLayerUpdate","_centerVector","circle","pointToLatLng","radius","_addBounds","colors","boundsArray","boundsRect","projectedExtent","weight","fillOpacity","fill","totalLayerBounds","totalBoundsArray","totalBounds","ProjectedExtent","Path","locations","_locations","_rings","_subtract","_parts","_renderer","_updatePoly","QueryHandler","Handler","addHooks","_queryTopLayer","_queryTopLayerAtMapCenter","removeHooks","_getTopQueryableLayer","l","mapmlLayer","event","isFocused","layerPoint","latLngToLayerPoint","latLngToContainerPoint","_query","tcrs2pcrs","tcrs2gcrs","unproject","fetchFeatures","lastOne","contenttype","get","Error","mapmldoc","Array","geom","f","popupOptions","openPopup","_popup","displayFeaturesPopup","message","autoPan","maxHeight","tcrsClickLoc","latLngToPoint","tileMatrixClickLoc","tileBounds","Bounds","ceil","column","longitude","latitude","ContextMenu","_touchstart","msPointer","pointer","_items","locale","cmBack","callback","_goBack","cmForward","_goForward","cmReload","_reload","spacer","cmToggleControls","_toggleControls","cmCopyCoords","_copyCoords","hideOnSelect","submenu","_copyTile","_copyTileMatrix","_copyMap","_copyTCRS","_copyPCRS","_copyGCRS","cmCopyAll","_copyAllCoords","cmToggleDebug","_toggleDebug","cmCopyMapML","_copyMapML","cmPasteLayer","_pasteLayer","cmViewSource","_viewSource","_layerItems","lmZoomToLayer","_zoomToLayer","lmCopyExtent","_copyLayerExtent","lmCopyLayer","_copyLayer","_mapMenuVisible","_keyboardEvent","el","_createItem","_coordMenu","_clickEvent","getContainer","_hide","_onKeyDown","touch","contextmenu","_show","mousedown","KeyboardEvent","layerElem","_layerClicked","tL","topLeft","bR","bottomRight","data","_copyData","forward","back","reload","replace","navigator","clipboard","readText","geojson2mapml","JSON","parse","viewSource","toggleDebug","directory","_showCoordMenu","execCommand","click","pointX","pointY","allData","index","_createSeparator","_insertElementAt","_createEventHandler","_onItemMouseOver","_onItemMouseOut","func","_showLocation","containerPointToLayerPoint","layerPointToLatLng","refEl","_showAtPoint","button","activeEl","activeElement","_elementInFocus","_layerMenuTabs","firstChild","pt","_setPosition","anchor","containerSize","_getElementSize","contextmenuAnchor","_leaflet_pos","_sizeChanged","offsetWidth","_focusOnLayerControl","menu","copyEl","_hideCoordMenu","srcElement","tcrsTopLeft","tcrsBottomRight","tileMatrixTopLeft","tileMatrixBottomRight","minConverted","maxConverted","unprojectedMin","unprojectedMax","gcrs","tcrs","boundsUnit","defaultMaxZoom","nativeMinZoom","nativeMaxZoom","locInputs","numberOfAxes","isFinite","minPixel","maxPixel","minGCRS","maxGCRS","pixelToPCRSPoint","latLng","pointToPCRSPoint","contentArray","stringSplit","prop","containerPoints","pairs","styleElm","ss","stylesheets","linkElm","array","a","parseNumber","link","leafletLayer","zoomTo","justPan","hash","inPlace","newLayer","window","focusOnLoad","json","table","thead","createTHead","insertRow","th1","th2","createTextNode","tbody","createTBody","hasOwnProperty","th","td","bboxExtent","caption","geometryFunction","jsonType","out","setExtent","bbox","xmlStringLayer","dfLayer","multiPoint","linestring","multilinestring","polygon","multiPolygon","geometrycollection","Infinity","NEGATIVE_INFINITY","clone_feature","cloneNode","curr_feature","featureCaption","p","HTMLElement","properties2Table","updateExtent","coordinates","clone_point","clone_coords","clone_linestring","linestring_coordindates","clone_polygon","clone_multipoint","clone_multilinestring","m","geometries","fg","arr","arrayOfArrays","test","tableData","tr","source","dest","coord","pointConv","proj4","breakArray","pcrsToGcrs","poly","newArr","conv","propertyFunction","Proj","code","metas","ex","num","table2properties","prop0","geometry2geojson","geoms","from","disableClickPropagation","_goReload","_reloadButton","_updateDisabled","disable","_disabled","enable","FullscreenButton","false","true","_toggleTitle","_click","toggleFullscreen","isFullscreen","Map","include","_isFullscreen","getRootNode","host","pseudoFullscreen","_disablePseudoFullscreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","_enablePseudoFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","ALLOW_KEYBOARD_INPUT","msRequestFullscreen","_setFullscreen","fullscreen","invalidateSize","_onFullscreenChange","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","mergeOptions","fullscreenControl","addInitHook","fullscreenchange","onFullscreenChange","addControl","whenReady","fullscreenButton","_attributionControl","setPrefix","kbdShortcuts","dialog","onclick","kbdMovement","kbdPanUp","kbdPanDown","kbdPanLeft","kbdPanRight","btnZoomIn","btnZoomOut","kbdPanIncrement","kbdZoom","kbdFeature","kbdPrevFeature","kbdNextFeature","crosshair","Crosshair","Feature","_isQueryable","_toggleEvents","_isMapFocused","_addOrRemoveCrosshair","_hasQueryableLayer","_addOrRemoveMapOutline","mapContainer","_outline","isLeafletContainer","_convertWrappers","_markup","_convertMarkup","_generateOutlinePoints","isClosed","_isClosed","attachLinkHandler","dragStart","hovered","visited","onTop","nextLayer","sqrt","pow","handleLink","currentTarget","resolver","mapWidth","clientWidth","substring","addedMap","tileOrigin","zoomingTo","origin","pixelRings","_convertRing","rings","subP","subrings","pixelSubrings","pixelOutline","o","parts","sub","interm","points","output","attr","attributes","featureAttributes","tabindex","first","ring","subRings","_coordinateToArrays","cls","class","nodes","childNodes","cur","tempDiv","n","prev","line","ind","next","main","subParts","isFirst","parents","span","noSpan","local","numPair","attrMap","wrapperAttr","unshift","linkTarget","linkType","getPCRSCenter","stampLayer","outlinePath","_createPath","stroke","_updateStyle","entries","_rootGroup","outlineAdded","_removePath","_setPath","geometryToPath","_pointToMarker","_updatePathStyle","isMain","isOutline","lineCap","lineJoin","dashArray","dashOffset","fillColor","fillRule","def","closed","str","len2","_handleFocus","firstLayer","_openPopup","updateInteraction","layerID","addToIndex","part","subPart","openTooltip","closeTooltip","prevFocus","nextFocus","AnnounceMovement","layeradd","layerremove","addEventListener","announceBounds","dragging","_draggable","dragged","focusAnnouncement","removeEventListener","gcrsToTileMatrix","standard","amZoom","amColumn","amRow","_layersMaxZoom","amMaxZoom","_layersMinZoom","amMinZoom","_traversalCall","visible","outOfBoundsPos","prevZoom","_historyIndex","inBoundsPos","pop","amZoomedOut","wasDragged","amDraggedOut","amEastBound","amWestBound","amNorthBound","amSouthBound","FeatureIndex","outBoundFeatures","_mapPCRSBounds","_updateMapBounds","lc","mc","dist","tmp","inbound","sort","b","ac","bc","Options","announceMovement","lcOpacity","btnFullScreen","Keyboard","altKey","metaKey","_panKeys","_panAnim","_inProgress","ctrlKey","panBy","maxBounds","panInsideBounds","_zoomKeys","187","107","61","171","189","109","54","173","setZoom","closeOnEscapeKey","featureIndexOverlay","FeatureIndexOverlay","_output","_body","initialFocus","_checkOverlap","_addOrRemoveFeatureIndex","_calculateReticleBounds","wRatio","hRatio","reticleDimension","getComputedStyle","w","h","minPoint","maxPoint","popupClosed","featureIndexBounds","allFeatures","_updateOutput","_addToggleKeys","_newContent","direction","newContent","detectImagePath","getStyle","mapOptions","head","WGS84","CRS","latLngBounds","CBMTILE","APSTILE","EPSG3857","splitCoordinate","coordsToArray","mapml2geojson"],"mappings":"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"}