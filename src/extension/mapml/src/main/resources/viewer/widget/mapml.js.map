{"version":3,"file":"mapml.js","sources":["mapml.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  var StaticTileLayer = L.GridLayer.extend({\n\n    initialize: function (options) {\n      this.zoomBounds = this._getZoomBounds(options.tileContainer,options.maxZoomBound);\n      L.extend(options, this.zoomBounds);\n      L.setOptions(this, options);\n      this._groups = this._groupTiles(this.options.tileContainer.getElementsByTagName('map-tile'));\n    },\n\n    onAdd: function(){\n      this._bounds = this._getLayerBounds(this._groups,this._map.options.projection); //stores meter values of bounds\n      this.layerBounds = this._bounds[Object.keys(this._bounds)[0]];\n      for(let key of Object.keys(this._bounds)){\n        this.layerBounds.extend(this._bounds[key].min);\n        this.layerBounds.extend(this._bounds[key].max);\n      }\n      L.GridLayer.prototype.onAdd.call(this,this._map);\n      this._handleMoveEnd();\n    },\n    \n    getEvents: function(){\n      let events = L.GridLayer.prototype.getEvents.call(this,this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      events.move = ()=>{}; //needed to prevent moveend from running\n      return events;\n    },\n\n\n    //sets the bounds flag of the layer and calls default moveEnd if within bounds\n    //its the zoom level is between the nativeZoom and zoom then it uses the nativeZoom value to get the bound its checking\n    _handleMoveEnd : function(e){\n      let mapZoom = this._map.getZoom();\n      let zoomLevel = mapZoom;\n      zoomLevel = zoomLevel > this.options.maxNativeZoom? this.options.maxNativeZoom: zoomLevel;\n      zoomLevel = zoomLevel < this.options.minNativeZoom? this.options.minNativeZoom: zoomLevel;\n      this.isVisible = mapZoom <= this.zoomBounds.maxZoom && mapZoom >= this.zoomBounds.minZoom && \n                        this._bounds[zoomLevel] && this._bounds[zoomLevel]\n                        .overlaps(M.pixelToPCRSBounds(\n                          this._map.getPixelBounds(),\n                          this._map.getZoom(),\n                          this._map.options.projection));\n      if(!(this.isVisible))return; //onMoveEnd still gets fired even when layer is out of bounds??, most likely need to overrride _onMoveEnd\n      this._parentOnMoveEnd();\n    },\n\n    _isValidTile(coords) {\n      return this._groups[this._tileCoordsToKey(coords)];\n    },\n\n    createTile: function (coords) {\n      let tileGroup = this._groups[this._tileCoordsToKey(coords)] || [],\n          tileElem = document.createElement('map-tile'), tileSize = this.getTileSize();\n      tileElem.setAttribute(\"col\",coords.x);\n      tileElem.setAttribute(\"row\",coords.y);\n      tileElem.setAttribute(\"zoom\",coords.z);\n      \n      for(let i = 0;i<tileGroup.length;i++){\n        let tile= document.createElement('img');\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tile.alt = '';\n        tile.setAttribute(\"role\",\"presentation\");\n        tile.src = tileGroup[i].src;\n        tileElem.appendChild(tile);\n      }\n      return tileElem;\n    },\n\n    _getLayerBounds: function(tileGroups, projection){\n      let layerBounds = {}, tileSize = M[projection].options.crs.tile.bounds.max.x;\n      for(let tile in tileGroups){\n        let sCoords = tile.split(\":\"), pixelCoords = {};\n        pixelCoords.x = +sCoords[0] * tileSize;\n        pixelCoords.y = +sCoords[1] * tileSize;\n        pixelCoords.z = +sCoords[2]; //+String same as parseInt(String)\n        if(sCoords[2] in layerBounds){\n\n          layerBounds[sCoords[2]].extend(L.point(pixelCoords.x ,pixelCoords.y ));\n          layerBounds[sCoords[2]].extend(L.point(((pixelCoords.x+tileSize) ),((pixelCoords.y+tileSize) )));\n        } else {\n          layerBounds[sCoords[2]] = L.bounds(\n                                      L.point(pixelCoords.x ,pixelCoords.y ),\n                                      L.point(((pixelCoords.x+tileSize) ),((pixelCoords.y+tileSize) )));\n        }\n      }\n      // TODO: optimize by removing 2nd loop, add util function to convert point in pixels to point in pcrs, use that instead then this loop\n      // won't be needed\n      for(let pixelBounds in layerBounds){\n        let zoom = +pixelBounds;\n        layerBounds[pixelBounds] = M.pixelToPCRSBounds(layerBounds[pixelBounds],zoom,projection);\n      }\n\n      return layerBounds;\n    },\n\n    _getZoomBounds: function(container, maxZoomBound){\n      if(!container) return null;\n      let meta = M._metaContentToObject(container.getElementsByTagName('map-tiles')[0].getAttribute('zoom')),\n          zoom = {},tiles = container.getElementsByTagName(\"map-tile\");\n      zoom.nativeZoom = +meta.value || 0;\n      zoom.maxNativeZoom = 0;\n      zoom.minNativeZoom = maxZoomBound;\n      for (let i=0;i<tiles.length;i++) {\n        let lZoom = +tiles[i].getAttribute('zoom');\n        if(!tiles[i].getAttribute('zoom')) lZoom = zoom.nativeZoom;\n        zoom.minNativeZoom = Math.min(zoom.minNativeZoom, lZoom);\n        zoom.maxNativeZoom = Math.max(zoom.maxNativeZoom, lZoom);\n      }\n\n      //hard coded to only natively zoom out 2 levels, any more and too many tiles are going to be loaded in at one time\n      //lagging the users computer\n      zoom.minZoom = zoom.minNativeZoom - 2 <= 0? 0: zoom.minNativeZoom - 2;\n      zoom.maxZoom = maxZoomBound;\n      if(meta.min)zoom.minZoom = +meta.min < (zoom.minNativeZoom - 2)?(zoom.minNativeZoom - 2):+meta.min;\n      if(meta.max)zoom.maxZoom = +meta.max;\n      return zoom;\n    },\n\n    _groupTiles: function (tiles) {\n      let tileMap = {};\n      for (let i=0;i<tiles.length;i++) {\n        let tile = {};\n        tile.row = +tiles[i].getAttribute('row');\n        tile.col = +tiles[i].getAttribute('col');\n        tile.zoom = +tiles[i].getAttribute('zoom') || this.options.nativeZoom;\n        tile.src = tiles[i].getAttribute('src');\n        let tileCode = tile.col+\":\"+tile.row+\":\"+tile.zoom;\n        if(tileCode in tileMap){\n          tileMap[tileCode].push(tile);\n        } else {\n          tileMap[tileCode]=[tile];\n        }\n      }\n      return tileMap;\n    },\n  });\n\n  var staticTileLayer = function(options) {\n    return new StaticTileLayer(options);\n  };\n\n  var LayerControl = L.Control.Layers.extend({\n      /* removes 'base' layers as a concept */\n      options: {\n        autoZIndex: false,\n        sortLayers: true,\n        sortFunction: function (layerA, layerB) {\n          return layerA.options.zIndex < layerB.options.zIndex ? -1 : (layerA.options.zIndex > layerB.options.zIndex ? 1 : 0);\n        }\n      },\n      initialize: function (overlays, options) {\n          L.setOptions(this, options);\n          \n          // the _layers array contains objects like {layer: layer, name: \"name\", overlay: true}\n          // the array index is the id of the layer returned by L.stamp(layer) which I guess is a unique hash\n          this._layerControlInputs = [];\n          this._layers = [];\n          this._lastZIndex = 0;\n          this._handlingClick = false;\n\n          for (var i in overlays) {\n              this._addLayer(overlays[i], i, true);\n          }\n      },\n      onAdd: function () {\n          this._initLayout();\n          this._map.on('validate', this._validateInput, this);\n          L.DomEvent.on(this.options.mapEl, \"layerchange\", this._validateInput, this);\n          // Adding event on layer control button\n          L.DomEvent.on(this._container.getElementsByTagName(\"a\")[0], 'keydown', this._focusFirstLayer, this._container);\n          L.DomEvent.on(this._container, 'contextmenu', this._preventDefaultContextMenu, this);\n          this._update();\n          //this._validateExtents();\n          if(this._layers.length < 1 && !this._map._showControls){\n            this._container.setAttribute(\"hidden\",\"\");\n          } else {\n            this._map._showControls = true;\n          }\n          return this._container;\n      },\n      onRemove: function (map) {\n          map.off('validate', this._validateInput, this);\n          L.DomEvent.off(this._container.getElementsByTagName(\"a\")[0], 'keydown', this._focusFirstLayer, this._container);\n          // remove layer-registerd event handlers so that if the control is not\n          // on the map it does not generate layer events\n          for (var i = 0; i < this._layers.length; i++) {\n            this._layers[i].layer.off('add remove', this._onLayerChange, this);\n            this._layers[i].layer.off('extentload', this._validateInput, this);\n          }\n      },\n      addOrUpdateOverlay: function (layer, name) {\n        var alreadyThere = false;\n        for (var i=0;i<this._layers.length;i++) {\n          if (this._layers[i].layer === layer) {\n            alreadyThere = true;\n            this._layers[i].name = name;\n            // replace the controls with updated controls if necessary.\n            break;\n          }\n        }\n        if (!alreadyThere) {\n          this.addOverlay(layer, name);\n        }\n        if(this._layers.length > 0){\n          this._container.removeAttribute(\"hidden\");\n          this._map._showControls = true;\n        }\n        return (this._map) ? this._update() : this;\n      },\n      removeLayer: function (layer) {\n        L.Control.Layers.prototype.removeLayer.call(this, layer);\n        if(this._layers.length === 0){\n          this._container.setAttribute(\"hidden\", \"\");\n        }\n      },\n      _validateInput: function (e) {\n        for (let i = 0; i < this._layers.length; i++) {\n          if(!this._layers[i].input.labels[0])continue;\n          let label = this._layers[i].input.labels[0].getElementsByTagName(\"span\"),\n              input = this._layers[i].input.labels[0].getElementsByTagName(\"input\");\n          input[0].checked = this._layers[i].layer._layerEl.checked;\n          if(this._layers[i].layer._layerEl.disabled && this._layers[i].layer._layerEl.checked){\n            input[0].closest(\"fieldset\").disabled = true;\n            label[0].style.fontStyle = \"italic\";\n          } else {\n            input[0].closest(\"fieldset\").disabled = false;\n            label[0].style.fontStyle = \"normal\";\n          }\n          // check if an extent is disabled and disable it\n          if(this._layers[i].layer._extent && this._layers[i].layer._extent._mapExtents){\n            for(let j = 0; j < this._layers[i].layer._extent._mapExtents.length; j++){\n              let input = this._layers[i].layer._extent._mapExtents[j].extentAnatomy,\n                  label = input.getElementsByClassName(\"mapml-layer-item-name\")[0];\n              if(this._layers[i].layer._extent._mapExtents[j].disabled && this._layers[i].layer._extent._mapExtents[j].checked){\n                label.style.fontStyle = \"italic\";\n                input.disabled = true;\n              } else {\n                label.style.fontStyle = \"normal\";\n                input.disabled = false;\n              }\n            }\n          }\n        }\n\n      },\n\n      // focus the first layer in the layer control when enter is pressed\n      _focusFirstLayer: function(e){\n        if (e.key === 'Enter' && this.className === 'leaflet-control-layers leaflet-control leaflet-control-layers-expanded') {\n          var elem = this.children[1].children[2].children[0].children[0].children[0].children[0];\n          if(elem) setTimeout(() => elem.focus(), 0);\n        }\n      },\n      \n      _withinZoomBounds: function(zoom, range) {\n          return range.min <= zoom && zoom <= range.max;\n      },\n      _addItem: function (obj) {\n        var layercontrols  =  obj.layer.getLayerUserControlsHTML();\n        // the input is required by Leaflet...\n        obj.input = layercontrols.querySelector('input.leaflet-control-layers-selector');\n\n        this._layerControlInputs.push(obj.input);\n      \t\tobj.input.layerId = L.stamp(obj.layer);\n\n        L.DomEvent.on(obj.input, 'click', this._onInputClick, this);\n        // this is necessary because when there are several layers in the\n        // layer control, the response to the last one can be a long time\n        // after the info is first displayed, so we have to go back and\n        // verify the layer element is not disabled and can have an enabled input.\n        obj.layer.on('extentload', this._validateInput, this);\n        this._overlaysList.appendChild(layercontrols);\n        return layercontrols;\n      },\n\n      //overrides collapse and conditionally collapses the panel\n      collapse: function(e){\n        if (\n          e.target.tagName === \"SELECT\" ||\n          e.relatedTarget &&\n          e.relatedTarget.parentElement &&\n          (\n            e.relatedTarget.className === \"mapml-contextmenu mapml-layer-menu\" ||\n            e.relatedTarget.parentElement.className === \"mapml-contextmenu mapml-layer-menu\"\n          ) ||\n          (this._map && this._map.contextMenu._layerMenu.style.display === \"block\")\n        ) return this;\n\n        L.DomUtil.removeClass(this._container, 'leaflet-control-layers-expanded');\n        if (e.originalEvent?.pointerType === 'touch') {\n          this._container._isExpanded = false;\n        }\n  \t\t  return this;\n      },\n      _preventDefaultContextMenu: function (e) {\n        let latlng = this._map.mouseEventToLatLng(e);\n        let containerPoint = this._map.mouseEventToContainerPoint(e);\n        e.preventDefault();\n        // for touch devices, when the layer control is not expanded,\n        // the layer context menu should not show on map\n        if (!this._container._isExpanded && e.pointerType === 'touch') {\n          this._container._isExpanded = true;\n          return;\n        }\n        this._map.fire('contextmenu', \n          { originalEvent: e,\n            containerPoint: containerPoint, \n            latlng: latlng });\n      }\n  });\n  var layerControl = function (layers, options) {\n  \treturn new LayerControl(layers, options);\n  };\n\n  const FALLBACK_PROJECTION = \"OSMTILE\";\n  const FALLBACK_CS = \"TILEMATRIX\";\n  const BLANK_TT_TREF = \"mapmltemplatedtileplaceholder\";\n\n  var FeatureLayer = L.FeatureGroup.extend({\n    /*\n     * M.MapML turns any MapML feature data into a Leaflet layer. Based on L.GeoJSON.\n     */\n      initialize: function (mapml, options) {\n        /*\n          mapml:\n          1. for query: an array of map-feature elements that it fetches\n          2. for static templated feature: null\n          3. for non-templated feature: layer- (with no src) or mapml file (with src)\n        */\n        L.setOptions(this, options);\n        if(this.options.static) {\n          this._container = L.DomUtil.create('div', 'leaflet-layer', this.options.pane);\n          // must have leaflet-pane class because of new/changed rule in leaflet.css\n          // info: https://github.com/Leaflet/Leaflet/pull/4597\n          L.DomUtil.addClass(this._container, 'leaflet-pane mapml-vector-container');\n          L.setOptions(this.options.renderer, {pane: this._container});\n        }\n\n        this._layers = {};\n        if(this.options.query){\n          this._mapmlFeatures = mapml.features ? mapml.features: mapml;\n          this.isVisible = true;\n          let native = this._getNativeVariables(mapml);\n          this.options.nativeZoom = native.zoom;\n          this.options.nativeCS = native.cs;\n        }\n        if (mapml && !this.options.query) {\n          let native = this._getNativeVariables(mapml);\n          //needed to check if the feature is static or not, since this method is used by templated also\n          if(!mapml.querySelector('map-extent') && mapml.querySelector('map-feature') && this.options.static){\n            this._features = {};\n            this._staticFeature = true;\n            this.isVisible = true; //placeholder for when this actually gets updated in the future\n            this.zoomBounds = this._getZoomBounds(mapml, native.zoom);\n            this.layerBounds = this._getLayerBounds(mapml);\n            L.extend(this.options, this.zoomBounds);\n          }\n          this.addData(mapml, native.cs, native.zoom);\n          if(this._staticFeature){\n            this._resetFeatures();\n            this.options._leafletLayer._map._addZoomLimit(this);\n          }\n        }\n      },\n\n      onAdd: function(map){\n        L.FeatureGroup.prototype.onAdd.call(this, map);\n        if(this._mapmlFeatures)map.on(\"featurepagination\", this.showPaginationFeature, this);\n      },\n\n      onRemove: function(map){\n        if(this._mapmlFeatures){\n          map.off(\"featurepagination\", this.showPaginationFeature, this);\n          delete this._mapmlFeatures;\n          L.DomUtil.remove(this._container);\n        }\n        L.FeatureGroup.prototype.onRemove.call(this, map);\n        this._map.featureIndex.cleanIndex();\n      },\n\n      getEvents: function(){\n        if(this._staticFeature){\n          return {\n            'moveend':this._handleMoveEnd,\n            'zoomend' : this._handleZoomEnd,\n          };\n        }\n        return {\n        };\n      },\n\n      // for query\n      showPaginationFeature: function(e){\n        if(this.options.query && this._mapmlFeatures[e.i]){\n          let feature = this._mapmlFeatures[e.i];\n          // remove the prev / next one <map-feature> from shadow if there is any\n          feature._extentEl.shadowRoot.firstChild?.remove();\n          this.clearLayers();\n          feature._featureGroup = this.addData(feature, this.options.nativeCS, this.options.nativeZoom);\n          feature._extentEl.shadowRoot.appendChild(feature);\n          e.popup._navigationBar.querySelector(\"p\").innerText = (e.i + 1) + \"/\" + this.options._leafletLayer._totalFeatureCount;\n          e.popup._content.querySelector(\"iframe\").setAttribute(\"sandbox\", \"allow-same-origin allow-forms\");\n          e.popup._content.querySelector(\"iframe\").srcdoc = feature.querySelector(\"map-properties\").innerHTML;\n          // \"zoom to here\" link need to be re-set for every pagination\n          this._map.fire(\"attachZoomLink\", {i:e.i, currFeature: feature});\n          this._map.once(\"popupclose\", function (e) {\n            this.shadowRoot.innerHTML = '';\n          }, feature._extentEl);\n        }\n      },\n\n      _getNativeVariables: function(mapml){\n        let nativeZoom = (mapml.querySelector && mapml.querySelector(\"map-meta[name=zoom]\") &&\n            +M._metaContentToObject(mapml.querySelector(\"map-meta[name=zoom]\").getAttribute(\"content\")).value) || 0;\n        let nativeCS = (mapml.querySelector && mapml.querySelector(\"map-meta[name=cs]\") &&\n            M._metaContentToObject(mapml.querySelector(\"map-meta[name=cs]\").getAttribute(\"content\")).content) || \"PCRS\";\n        return {zoom:nativeZoom, cs: nativeCS};\n      },\n\n      _handleMoveEnd : function(){\n        let mapZoom = this._map.getZoom(),\n            withinZoom = mapZoom <= this.zoomBounds.maxZoom && mapZoom >= this.zoomBounds.minZoom;   \n        this.isVisible = withinZoom && this._layers && this.layerBounds && \n                          this.layerBounds.overlaps(\n                            M.pixelToPCRSBounds(\n                              this._map.getPixelBounds(),\n                              mapZoom,this._map.options.projection));\n        this._removeCSS();\n      },\n\n      _handleZoomEnd: function(e){\n        let mapZoom = this._map.getZoom();\n        if(mapZoom > this.zoomBounds.maxZoom || mapZoom < this.zoomBounds.minZoom){\n          this.clearLayers();\n          return;\n        }\n        this._resetFeatures();\n      },\n\n      //sets default if any are missing, better to only replace ones that are missing\n      _getLayerBounds : function(container) {\n        if (!container) return null;\n        let cs = FALLBACK_CS,\n            projection = container.querySelector('map-meta[name=projection]') &&\n                      M._metaContentToObject(\n                        container.querySelector('map-meta[name=projection]').getAttribute('content'))\n                        .content.toUpperCase() || FALLBACK_PROJECTION;\n        try{\n\n          let meta = container.querySelector('map-meta[name=extent]') &&\n                      M._metaContentToObject(\n                        container.querySelector('map-meta[name=extent]').getAttribute('content'));\n\n          let zoom = meta.zoom || 0;\n          \n          let metaKeys = Object.keys(meta);\n          for(let i =0;i<metaKeys.length;i++){\n            if(!metaKeys[i].includes(\"zoom\")){\n              cs = M.axisToCS(metaKeys[i].split(\"-\")[2]);\n              break;\n            }\n          }\n          let axes = M.csToAxes(cs);\n          return M.boundsToPCRSBounds(\n                  L.bounds(L.point(+meta[`top-left-${axes[0]}`],+meta[`top-left-${axes[1]}`]),\n                  L.point(+meta[`bottom-right-${axes[0]}`],+meta[`bottom-right-${axes[1]}`])),\n                  zoom,projection,cs);\n        } catch (error){\n          //if error then by default set the layer to osm and bounds to the entire map view\n          return M.boundsToPCRSBounds(M[projection].options.crs.tilematrix.bounds(0),0,projection, cs);\n        }\n      },\n\n      _resetFeatures : function () {\n        this.clearLayers();\n        // since features are removed and re-added by zoom level, need to clean the feature index before re-adding\n        if(this._map) this._map.featureIndex.cleanIndex();\n        let map = this._map || this.options._leafletLayer._map;\n        if(this._features) {\n          for (let zoom in this._features) {\n            for(let k =0;k < this._features[zoom].length;k++){\n              let feature = this._features[zoom][k],\n                  checkRender = feature._checkRender(map.getZoom(), this.zoomBounds.minZoom, this.zoomBounds.maxZoom);\n              if (checkRender) {\n                this.addLayer(feature);\n              }\n            }\n          }\n        }\n      },\n\n      _setZoomTransform: function(center, clampZoom){\n        var scale = this._map.getZoomScale(this._map.getZoom(),clampZoom),\n  \t\t    translate = center.multiplyBy(scale)\n  \t\t        .subtract(this._map._getNewPixelOrigin(center, this._map.getZoom())).round();\n\n        if (any3d) {\n          L.setTransform(this._layers[clampZoom], translate, scale);\n        } else {\n          L.setPosition(this._layers[clampZoom], translate);\n        }\n      },\n\n      _getZoomBounds: function(container, nativeZoom){\n        if (!container) return null;\n        let nMin = 100,nMax=0, features = container.querySelectorAll('map-feature'),meta,projection;\n        for(let i =0;i<features.length;i++){\n          let lZoom = +features[i].getAttribute('zoom');\n          if(!features[i].getAttribute('zoom'))lZoom = nativeZoom;\n          nMax = Math.max(nMax, lZoom);\n          nMin = Math.min(nMin, lZoom);\n        }\n        try{\n          projection = M._metaContentToObject(container.querySelector('map-meta[name=projection]').getAttribute('content')).content;\n          meta = M._metaContentToObject(container.querySelector('map-meta[name=zoom]').getAttribute('content'));\n        } catch(error){\n          return {\n            minZoom:0,\n            maxZoom: M[projection || FALLBACK_PROJECTION].options.resolutions.length - 1,\n            minNativeZoom:nMin,\n            maxNativeZoom:nMax\n          };\n        }\n        return {\n          minZoom:+meta.min ,\n          maxZoom:+meta.max ,\n          minNativeZoom:nMin,\n          maxNativeZoom:nMax\n        };\n      },\n\n      addData: function (mapml, nativeCS, nativeZoom) {\n        var features = mapml.nodeType === Node.DOCUMENT_NODE || mapml.nodeName === \"LAYER-\" ? mapml.getElementsByTagName(\"map-feature\") : null,\n            i, len, feature;\n\n        var linkedStylesheets = mapml.nodeType === Node.DOCUMENT_NODE ? mapml.querySelector(\"map-link[rel=stylesheet],map-style\") : null;\n        if (linkedStylesheets) {\n          var base = mapml.querySelector('map-base') && mapml.querySelector('map-base').hasAttribute('href') ? \n              new URL(mapml.querySelector('map-base').getAttribute('href')).href : \n              mapml.URL;\n          M._parseStylesheetAsHTML(mapml,base,this._container);\n        }\n        if (features) {\n         for (i = 0, len = features.length; i < len; i++) {\n          // Only add this if geometry is set and not null\n          feature = features[i];\n          var geometriesExist = feature.getElementsByTagName(\"map-geometry\").length && feature.getElementsByTagName(\"map-coordinates\").length;\n          if (geometriesExist) {\n            if (mapml.nodeType === Node.DOCUMENT_NODE) {\n             // if the <map-feature> element has migrated from mapml file, \n             // the featureGroup object should bind with the **CLONED** map-feature element in DOM instead of the feature in mapml\n            if (!feature._DOMnode) feature._DOMnode = feature.cloneNode(true);\n            feature._DOMnode._featureGroup = this.addData(feature._DOMnode, nativeCS, nativeZoom);\n           } else {\n            feature._featureGroup = this.addData(feature, nativeCS, nativeZoom);\n           }\n          }\n         }\n         return this; //if templated this runs\n        }\n\n        //if its a mapml with no more links this runs\n        var options = this.options;\n\n        if (options.filter && !options.filter(mapml)) { return; }\n        \n        if (mapml.classList.length) {\n          options.className = mapml.classList.value;\n        }\n        let zoom = mapml.getAttribute(\"zoom\") || nativeZoom, title = mapml.querySelector(\"map-featurecaption\");\n        title = title ? title.innerHTML : \"Feature\";\n\n        if(mapml.querySelector(\"map-properties\")) {\n          options.properties = document.createElement('div');\n          options.properties.classList.add(\"mapml-popup-content\");\n          options.properties.insertAdjacentHTML('afterbegin', mapml.querySelector(\"map-properties\").innerHTML);\n        }\n\n        let layer = this.geometryToLayer(mapml, options, nativeCS, +zoom, title);\n        if (layer) {\n          // if the layer is being used as a query handler output, it will have\n          // a color option set.  Otherwise, copy classes from the feature\n          if (!layer.options.color && mapml.hasAttribute('class')) {\n            layer.options.className = mapml.getAttribute('class');\n          }\n          layer.defaultOptions = layer.options;\n          this.resetStyle(layer);\n\n          if (options.onEachFeature) {\n            layer.bindTooltip(title, { interactive:true, sticky: true, });\n          }\n          if (this._staticFeature){\n            let featureZoom = mapml.getAttribute('zoom') || nativeZoom;\n            if(featureZoom in this._features){\n              this._features[featureZoom].push(layer);\n            } else {\n              this._features[featureZoom]=[layer];\n            }\n          } else {\n            this.addLayer(layer);\n          }\n          if (mapml.tagName.toUpperCase() === \"MAP-FEATURE\") {\n            mapml._groupEl = layer.options.group;\n          }\n          return layer;\n        }\n      },\n          \n      resetStyle: function (layer) {\n        var style = this.options.style;\n        if (style) {\n         // reset any custom styles\n         L.Util.extend(layer.options, layer.defaultOptions);\n         this._setLayerStyle(layer, style);\n        }\n      },\n\n      setStyle: function (style) {\n        this.eachLayer(function (layer) {\n          this._setLayerStyle(layer, style);\n        }, this);\n      },\n\n      _setLayerStyle: function (layer, style) {\n        if (typeof style === 'function') {\n          style = style(layer.feature);\n        }\n        if (layer.setStyle) {\n          layer.setStyle(style);\n        }\n      },\n      _removeCSS: function(){\n        let toDelete = this._container.querySelectorAll(\"link[rel=stylesheet],style\");\n        for(let i = 0; i < toDelete.length;i++){\n          this._container.removeChild(toDelete[i]);\n        }\n      },\n    geometryToLayer: function (mapml, vectorOptions, nativeCS, zoom, title) {\n      let geometry = mapml.tagName.toUpperCase() === 'MAP-FEATURE' ? mapml.getElementsByTagName('map-geometry')[0] : mapml,\n          cs = geometry?.getAttribute(\"cs\") || nativeCS, group = [], svgGroup = L.SVG.create('g'), copyOptions = Object.assign({}, vectorOptions);\n      if (geometry) {\n        for(let geo of geometry.querySelectorAll('map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint')){\n          group.push(M.feature(geo, Object.assign(copyOptions,\n            { nativeCS: cs,\n              nativeZoom: zoom,\n              projection: this.options.projection,\n              featureID: mapml.id,\n              group: svgGroup,\n              wrappers: this._getGeometryParents(geo.parentElement),\n              featureLayer: this,\n              _leafletLayer: this.options._leafletLayer,\n            })));\n        }\n        let groupOptions = {group:svgGroup, mapmlFeature: mapml, featureID: mapml.id, accessibleTitle: title, onEachFeature: vectorOptions.onEachFeature, properties: vectorOptions.properties, _leafletLayer: this.options._leafletLayer,},\n          collections = geometry.querySelector('map-multipolygon') || geometry.querySelector('map-geometrycollection');\n          if(collections) groupOptions.wrappers = this._getGeometryParents(collections.parentElement);\n        return M.featureGroup(group, groupOptions);\n      }\n    },\n\n    _getGeometryParents: function(subType, elems = []){\n      if(subType && subType.tagName.toUpperCase() !== \"MAP-GEOMETRY\"){\n        if(subType.tagName.toUpperCase() === \"MAP-MULTIPOLYGON\" || subType.tagName.toUpperCase() === \"MAP-GEOMETRYCOLLECTION\")\n          return this._getGeometryParents(subType.parentElement, elems);\n        return this._getGeometryParents(subType.parentElement, elems.concat([subType]));\n      } else {\n        return elems;\n      }\n    },\n  });\n  var featureLayer = function (mapml, options) {\n  \treturn new FeatureLayer(mapml, options);\n  };\n\n  var TemplatedTileLayer = L.TileLayer.extend({\n      // a TemplateTileLayer is similar to a L.TileLayer except its templates are\n      // defined by the <map-extent><template/></map-extent>\n      // content found in the MapML document.  As such, the client map does not\n      // 'revisit' the server for more MapML content, it simply fills the map extent\n      // with tiles for which it generates requests on demand (as the user pans/zooms/resizes\n      // the map)\n      initialize: function(template, options) {\n        // _setUpTileTemplateVars needs options.crs, not available unless we set\n        // options first...\n        let inputData = M._extractInputBounds(template);\n        this.zoomBounds = inputData.zoomBounds;\n        this.extentBounds=inputData.bounds;\n        this.isVisible = true;\n        L.extend(options, this.zoomBounds);\n        options.tms = template.tms;\n        delete options.opacity;\n        L.setOptions(this, options);\n        this._setUpTileTemplateVars(template);\n\n        this._template = template;\n        this._initContainer();\n        // call the parent constructor with the template tref value, per the \n        // Leaflet tutorial: http://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n        L.TileLayer.prototype.initialize.call(this, template.template, L.extend(options, {pane: this._container}));\n      },\n      onAdd : function(){\n        this._map._addZoomLimit(this);\n        L.TileLayer.prototype.onAdd.call(this,this._map);\n        this._handleMoveEnd();\n      },\n\n      getEvents: function(){\n        let events = L.TileLayer.prototype.getEvents.call(this,this._map);\n        this._parentOnMoveEnd = events.moveend;\n        events.moveend = this._handleMoveEnd;\n        return events;\n      },\n\n      _initContainer: function () {\n        if (this._container) { return; }\n\n        this._container = L.DomUtil.create('div', 'leaflet-layer', this.options.pane);\n        L.DomUtil.addClass(this._container,'mapml-templated-tile-container');\n        this._updateZIndex();\n      },\n      _handleMoveEnd : function(e){\n        let mapZoom = this._map.getZoom();\n        let mapBounds = M.pixelToPCRSBounds(this._map.getPixelBounds(),mapZoom,this._map.options.projection);\n        this.isVisible = mapZoom <= this.options.maxZoom && mapZoom >= this.options.minZoom && \n                          this.extentBounds.overlaps(mapBounds);\n          if(!(this.isVisible))return;\n        this._parentOnMoveEnd();\n      },\n      createTile: function (coords) {\n        let tileGroup = document.createElement(\"DIV\"),\n            tileSize = this.getTileSize();\n        L.DomUtil.addClass(tileGroup, \"mapml-tile-group\");\n        L.DomUtil.addClass(tileGroup, \"leaflet-tile\");\n\n        this._template.linkEl.dispatchEvent(new CustomEvent('tileloadstart', {\n          detail:{\n            x:coords.x,\n            y:coords.y,\n            zoom:coords.z,\n            appendTile: (elem)=>{tileGroup.appendChild(elem);},\n          },\n        }));\n\n        if (this._template.type.startsWith('image/')) {\n          let tile = L.TileLayer.prototype.createTile.call(this, coords, function(){});\n          tile.width = tileSize.x;\n          tile.height = tileSize.y;\n          tileGroup.appendChild(tile);\n        } else if(!this._url.includes(BLANK_TT_TREF)) {\n          // tiles of type=\"text/mapml\" will have to fetch content while creating\n          // the tile here, unless there can be a callback associated to the element\n          // that will render the content in the alread-placed tile\n          // var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n          this._fetchTile(coords, tileGroup);\n        }\n        return tileGroup;\n      },\n      _mapmlTileReady: function(tile) {\n          L.DomUtil.addClass(tile,'leaflet-tile-loaded');\n      },\n      // instead of being child of a pane, the TemplatedTileLayers are 'owned' by the group,\n      // and so are DOM children of the group, not the pane element (the MapMLLayer is\n      // a child of the overlay pane and always has a set of sub-layers)\n      getPane: function() {\n        return this.options.pane;\n      },\n      _fetchTile:  function (coords, tile) {\n         fetch(this.getTileUrl(coords),{redirect: 'follow'}).then(\n            function(response) {\n              if (response.status >= 200 && response.status < 300) {\n                return Promise.resolve(response);\n              } else {\n                console.log('Looks like there was a problem. Status Code: ' + response.status);\n                return Promise.reject(response);\n              }\n            }).then(function(response) {\n              return response.text();\n            }).then(text => {\n              var parser = new DOMParser();\n                  return parser.parseFromString(text, \"application/xml\");\n            }).then(mapml => {\n              this._createFeatures(mapml, coords, tile);\n              this._mapmlTileReady(tile);\n            }).catch(err => {console.log(\"Error Creating Tile\");});\n      },\n\n      _createFeatures: function(markup, coords, tile){\n        let stylesheets = markup.querySelector('map-link[rel=stylesheet],map-style');\n        if (stylesheets) {\n          let base = markup.querySelector('map-base') && markup.querySelector('map-base').hasAttribute('href') ?\n            new URL(markup.querySelector('map-base').getAttribute('href')).href :\n            markup.URL;\n          M._parseStylesheetAsHTML(markup,base,tile);\n        }\n\n        let svg = L.SVG.create('svg'), g = L.SVG.create('g'), tileSize = this._map.options.crs.options.crs.tile.bounds.max.x,\n            xOffset = coords.x * tileSize, yOffset = coords.y * tileSize;\n\n        let tileFeatures = M.featureLayer(markup, {\n          projection: this._map.options.projection,\n          static: false,\n          interactive: false,\n        });\n\n        for(let groupID in tileFeatures._layers){\n          for(let featureID in tileFeatures._layers[groupID]._layers){\n            let layer = tileFeatures._layers[groupID]._layers[featureID];\n            M.FeatureRenderer.prototype._initPath(layer, false);\n            layer._project(this._map, L.point([xOffset, yOffset]), coords.z);\n            M.FeatureRenderer.prototype._addPath(layer, g, false);\n            M.FeatureRenderer.prototype._updateFeature(layer);\n          }\n        }\n        svg.setAttribute('width', tileSize.toString());\n        svg.setAttribute('height', tileSize.toString());\n        svg.appendChild(g);\n        tile.appendChild(svg);\n      },\n\n      getTileUrl: function (coords) {\n          if (coords.z >= this._template.tilematrix.bounds.length || \n                  !this._template.tilematrix.bounds[coords.z].contains(coords)) {\n            return '';\n          }\n          var obj = {},\n              linkEl = this._template.linkEl,\n              zoomInput = linkEl.zoomInput;\n          obj[this._template.tilematrix.col.name] = coords.x;\n          obj[this._template.tilematrix.row.name] = coords.y;\n          if (zoomInput && (linkEl.hasAttribute('tref') && \n              linkEl.getAttribute('tref').includes(`{${zoomInput.getAttribute('name')}}`))) {\n            obj[this._template.zoom.name] = this._getZoomForUrl();\n          }\n          obj[this._template.pcrs.easting.left] = this._tileMatrixToPCRSPosition(coords, 'top-left').x;\n          obj[this._template.pcrs.easting.right] = this._tileMatrixToPCRSPosition(coords, 'top-right').x;\n          obj[this._template.pcrs.northing.top] = this._tileMatrixToPCRSPosition(coords, 'top-left').y;\n          obj[this._template.pcrs.northing.bottom] = this._tileMatrixToPCRSPosition(coords, 'bottom-left').y;\n          for (var v in this._template.tile) {\n              if ([\"row\",\"col\",\"zoom\",\"left\",\"right\",\"top\",\"bottom\"].indexOf(v) < 0) {\n                  obj[v] = this._template.tile[v];\n              }\n          }\n          if (this._map && !this._map.options.crs.infinite) {\n            let invertedY = this._globalTileRange.max.y - coords.y;\n            if (this.options.tms) {\n              obj[this._template.tilematrix.row.name] = invertedY;\n            }\n            //obj[`-${this._template.tilematrix.row.name}`] = invertedY; //leaflet has this but I dont see a use in storing row and -row as it doesnt follow that pattern\n          }\n          obj.r = this.options.detectRetina && L.Browser.retina && this.options.maxZoom > 0 ? '@2x' : '';\n          return L.Util.template(this._url, obj);\n      },\n      _tileMatrixToPCRSPosition: function (coords, pos) {\n  // this is a tile:\n  // \n  //   top-left         top-center           top-right\n  //      +------------------+------------------+\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      + center-left    center               + center-right\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      |                  |                  |\n  //      +------------------+------------------+\n  //   bottom-left     bottom-center      bottom-right\n\n    var map = this._map,\n        crs = map.options.crs,\n        tileSize = this.getTileSize(),\n\n        nwPoint = coords.scaleBy(tileSize),\n        sePoint = nwPoint.add(tileSize),\n        centrePoint = nwPoint.add(Math.floor(tileSize / 2)),\n\n        nw = crs.transformation.untransform(nwPoint,crs.scale(coords.z)),\n        se = crs.transformation.untransform(sePoint,crs.scale(coords.z)),\n        cen = crs.transformation.untransform(centrePoint, crs.scale(coords.z)),\n        result = null;\n\n        switch (pos) {\n          case('top-left'):\n            result = nw;\n            break;\n          case('bottom-left'):\n            result = new L.Point(nw.x,se.y);\n            break;\n          case('center-left'):\n            result = new L.Point(nw.x,cen.y);\n            break;\n          case('top-right'):\n            result = new L.Point(se.x,nw.y);\n            break;\n          case('bottom-right'):\n            result = se;\n            break;\n          case('center-right'):\n            result = new L.Point(se.x,cen.y);\n            break;\n          case('top-center'):\n            result = new L.Point(cen.x,nw.y);\n            break;\n          case('bottom-center'):\n            result = new L.Point(cen.x,se.y);\n            break;\n          case('center'):\n            result = cen;\n            break;\n        }\n        return result;\n      },\n      _setUpTileTemplateVars: function(template) {\n        // process the inputs associated to template and create an object named\n        // tile with member properties as follows:\n        // {row: 'rowvarname', \n        //  col: 'colvarname', \n        //  left: 'leftvarname', \n        //  right: 'rightvarname', \n        //  top: 'topvarname', \n        //  bottom: 'bottomvarname'}\n        template.tile = {};\n        var inputs = template.values,\n            crs = this.options.crs.options,\n            zoom, east, north, row, col;\n        \n        for (var i=0;i<template.values.length;i++) {\n          var type = inputs[i].getAttribute(\"type\"), \n              units = inputs[i].getAttribute(\"units\"), \n              axis = inputs[i].getAttribute(\"axis\"), \n              name = inputs[i].getAttribute(\"name\"), \n              position = inputs[i].getAttribute(\"position\"),\n              select = (inputs[i].tagName.toLowerCase() === \"map-select\"),\n              value = inputs[i].getAttribute(\"value\"),\n              min = inputs[i].getAttribute(\"min\"),\n              max = inputs[i].getAttribute(\"max\");\n          if (type === \"location\" && units === \"tilematrix\") {\n            switch (axis) {\n              case(\"column\"):\n                col = {\n                  name: name,\n                  min: crs.crs.tilematrix.horizontal.min,\n                  max: crs.crs.tilematrix.horizontal.max(crs.resolutions.length-1)\n                };\n                if (!isNaN(Number.parseFloat(min))) {\n                  col.min = Number.parseFloat(min);\n                }\n                if (!isNaN(Number.parseFloat(max))) {\n                  col.max = Number.parseFloat(max);\n                }\n                break;\n              case(\"row\"):\n                row = {\n                  name: name,\n                  min: crs.crs.tilematrix.vertical.min,\n                  max:  crs.crs.tilematrix.vertical.max(crs.resolutions.length-1)\n                };\n                if (!isNaN(Number.parseFloat(min))) {\n                  row.min = Number.parseFloat(min);\n                }\n                if (!isNaN(Number.parseFloat(max))) {\n                  row.max = Number.parseFloat(max);\n                }\n                break;\n              case('longitude'):\n              case(\"easting\"):\n                if (!east) {\n                  east = {\n                    min: crs.crs.pcrs.horizontal.min,\n                    max: crs.crs.pcrs.horizontal.max\n                  };\n                }\n                if (!isNaN(Number.parseFloat(min))) {\n                  east.min = Number.parseFloat(min);\n                }\n                if (!isNaN(Number.parseFloat(max))) {\n                  east.max = Number.parseFloat(max);\n                }\n                if (position) {\n                  if (position.match(/.*?-left/i)) {\n                    east.left = name;\n                  } else if (position.match(/.*?-right/i)) {\n                    east.right = name;\n                  }\n                }\n                break;\n              case('latitude'):\n              case(\"northing\"):\n                if (!north) {\n                  north = {\n                    min: crs.crs.pcrs.vertical.min,\n                    max: crs.crs.pcrs.vertical.max\n                  };\n                }\n                if (!isNaN(Number.parseFloat(min))) {\n                  north.min = Number.parseFloat(min);\n                }\n                if (!isNaN(Number.parseFloat(max))) {\n                  north.max = Number.parseFloat(max);\n                }\n                if (position) {\n                  if (position.match(/top-.*?/i)) {\n                    north.top = name;\n                  } else if (position.match(/bottom-.*?/i)) {\n                    north.bottom = name;\n                  }\n                } \n                break;\n                // unsuportted axis value\n            }\n          } else if (type && type.toLowerCase() === \"zoom\") {\n            //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n             zoom = {\n               name: name,\n               min: 0, \n               max: crs.resolutions.length,\n               value: crs.resolutions.length \n             };\n             if (!isNaN(Number.parseInt(value,10)) && \n                     Number.parseInt(value,10) >= zoom.min && \n                     Number.parseInt(value,10) <= zoom.max) {\n               zoom.value = Number.parseInt(value,10);\n             } else {\n               zoom.value = zoom.max;\n             }\n             if (!isNaN(Number.parseInt(min,10)) && \n                     Number.parseInt(min,10) >= zoom.min && \n                     Number.parseInt(min,10) <= zoom.max) {\n               zoom.min = Number.parseInt(min,10);\n             }\n             if (!isNaN(Number.parseInt(max,10)) && \n                     Number.parseInt(max,10) >= zoom.min && \n                     Number.parseInt(max,10) <= zoom.max) {\n               zoom.max = Number.parseInt(max,10);\n             }\n             template.zoom = zoom;\n          } else if (select) {\n              /*jshint -W104 */\n            const parsedselect = inputs[i].htmlselect;\n            template.tile[name] = function() {\n                return parsedselect.value;\n            };\n          } else {\n             // needs to be a const otherwise it gets overwritten\n            /*jshint -W104 */\n            const input = inputs[i];\n            template.tile[name] = function () {\n                return input.getAttribute(\"value\");\n            };\n          }\n        }\n        var transformation = this.options.crs.transformation,\n            tileSize = this.options.crs.options.crs.tile.bounds.max.x,\n            scale = L.bind(this.options.crs.scale, this.options.crs),\n        pcrs2tilematrix = function(c,zoom) {\n          return transformation.transform(c, scale(zoom)).divideBy(tileSize).floor();\n        };\n        if (east && north) {\n          \n          template.pcrs = {};\n          template.pcrs.bounds = L.bounds([east.min,north.min],[east.max,north.max]);\n          template.pcrs.easting = east;\n          template.pcrs.northing = north;\n          \n        } else if ( col && row && !isNaN(zoom.value)) {\n            \n            // convert the tile bounds at this zoom to a pcrs bounds, then \n            // go through the zoom min/max and create a tile-based bounds\n            // at each zoom that applies to the col/row values that constrain what tiles\n            // will be requested so that we don't generate too many 404s\n            if (!template.pcrs) {\n              template.pcrs = {};\n              template.pcrs.easting = '';\n              template.pcrs.northing = '';\n            }\n            \n            template.pcrs.bounds =  M.boundsToPCRSBounds(\n                        L.bounds(L.point([col.min,row.min]),\n                        L.point([col.max,row.max])),\n                        zoom.value, this.options.crs, M.axisToCS(\"column\"));\n            \n            template.tilematrix = {};\n            template.tilematrix.col = col;\n            template.tilematrix.row = row;\n\n        } else {\n          console.log('Unable to determine bounds for tile template: ' + template.template);\n        }\n        \n        if (!template.tilematrix) {\n          template.tilematrix = {};\n          template.tilematrix.col = {};\n          template.tilematrix.row = {};\n        }\n        template.tilematrix.bounds = [];\n        var pcrsBounds = template.pcrs.bounds;\n        // the template should _always_ have a zoom, because we force it to\n        // by first processing the extent to determine the zoom and if none, adding\n        // one and second by copying that zoom into the set of template variable inputs\n        // even if it is not referenced by one of the template's variable references\n        var zmin = template.zoom?template.zoom.min:0,\n            zmax = template.zoom?template.zoom.max:crs.resolutions.length;\n        for (var z=0; z <= zmax; z++) {\n          template.tilematrix.bounds[z] = (z >= zmin ?\n              L.bounds(pcrs2tilematrix(pcrsBounds.min,z),\n                pcrs2tilematrix(pcrsBounds.max,z)) :\n                        L.bounds(L.point([-1,-1]),L.point([-1,-1])));\n        }\n      },\n      _clampZoom: function (zoom) {\n          let clamp = L.GridLayer.prototype._clampZoom.call(this, zoom);\n          if(this._template.step > this.zoomBounds.maxNativeZoom) this._template.step = this.zoomBounds.maxNativeZoom;\n\n          if(zoom !== clamp){\n              zoom = clamp;\n          } else {\n              if(zoom % this._template.step !== 0){\n                  zoom = Math.floor(zoom / this._template.step) * this._template.step;\n              }\n          }\n          return zoom;\n      },\n  });\n  var templatedTileLayer = function(template, options) {\n    return new TemplatedTileLayer(template, options);\n  };\n\n  var TemplatedLayer = L.Layer.extend({\n    initialize: function(templates, options) {\n      this._templates =  templates;\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n      this._container.style.opacity = this.options.opacity;\n      L.DomUtil.addClass(this._container,'mapml-templatedlayer-container');\n\n      for (var i=0;i<templates.length;i++) {\n        if (templates[i].rel === 'tile') {\n            this.setZIndex(options.extentZIndex);\n            this._templates[i].layer = M.templatedTileLayer(templates[i], \n              L.Util.extend(options, {errorTileUrl: \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\", zIndex: options.extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'image') {\n            this.setZIndex(options.extentZIndex);\n            this._templates[i].layer = M.templatedImageLayer(templates[i], L.Util.extend(options, {zIndex: options.extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'features') {\n            this.setZIndex(options.extentZIndex);\n            this._templates[i].layer = M.templatedFeaturesLayer(templates[i], L.Util.extend(options, {zIndex: options.extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'query') {\n            // add template to array of queryies to be added to map and processed\n            // on click/tap events\n            this.hasSetBoundsHandler = true;\n            if (!this._queries) {\n              this._queries = [];\n            }\n            let inputData = M._extractInputBounds(templates[i]);\n            templates[i].extentBounds = inputData.bounds;\n            templates[i].zoomBounds = inputData.zoomBounds;\n            templates[i]._extentEl = this.options.extentEl;\n            this._queries.push(L.extend(templates[i], this._setupQueryVars(templates[i])));\n        }\n      }\n    },\n    getEvents: function() {\n        return {\n            zoomstart: this._onZoomStart\n        };\n    },\n    redraw: function() {\n      this.closePopup();\n      for (var i=0;i<this._templates.length;i++) {\n        if (this._templates[i].rel === 'tile' || this._templates[i].rel === 'image' || this._templates[i].rel === 'features') {\n            this._templates[i].layer.redraw();\n        }\n      }\n    },\n    _onZoomStart: function() {\n        this.closePopup();\n    },\n\n    _setupQueryVars: function(template) {\n        // process the inputs associated to template and create an object named\n        // query with member properties as follows:\n        // {width: 'widthvarname', \n        //  height: 'heightvarname', \n        //  left: 'leftvarname', \n        //  right: 'rightvarname', \n        //  top: 'topvarname', \n        //  bottom: 'bottomvarname'\n        //  i: 'ivarname'\n        //  j: 'jvarname'}\n        //  x: 'xvarname' x being the tcrs x axis\n        //  y: 'yvarname' y being the tcrs y axis\n        //  z: 'zvarname' zoom\n        //  title: link title\n\n        var queryVarNames = {query:{}},\n            inputs = template.values;\n        \n        for (var i=0;i<template.values.length;i++) {\n          var type = inputs[i].getAttribute(\"type\"), \n              units = inputs[i].getAttribute(\"units\"), \n              axis = inputs[i].getAttribute(\"axis\"), \n              name = inputs[i].getAttribute(\"name\"), \n              position = inputs[i].getAttribute(\"position\"),\n              rel = inputs[i].getAttribute(\"rel\"),\n              select = (inputs[i].tagName.toLowerCase() === \"map-select\");\n          if (type === \"width\") {\n                queryVarNames.query.width = name;\n          } else if ( type === \"height\") {\n                queryVarNames.query.height = name;\n          } else if (type === \"location\") { \n            switch (axis) {\n              case('x'):\n              case('y'):\n              case(\"column\"): \n              case(\"row\"):\n                queryVarNames.query[axis] = name;\n                break;\n              case ('longitude'):\n              case ('easting'):\n                if (position) {\n                    if (position.match(/.*?-left/i)) {\n                      if (rel === \"pixel\") {\n                        queryVarNames.query.pixelleft = name;\n                      } else if (rel === \"tile\") {\n                        queryVarNames.query.tileleft = name;\n                      } else {\n                        queryVarNames.query.mapleft = name;\n                      }\n                    } else if (position.match(/.*?-right/i)) {\n                      if (rel === \"pixel\") {\n                        queryVarNames.query.pixelright = name;\n                      } else if (rel === \"tile\") {\n                        queryVarNames.query.tileright = name;\n                      } else {\n                        queryVarNames.query.mapright = name;\n                      }\n                    }\n                } else {\n                    queryVarNames.query[axis] = name;\n                }\n                break;\n              case ('latitude'):\n              case ('northing'):\n                if (position) {\n                    if (position.match(/top-.*?/i)) {\n                      if (rel === \"pixel\") {\n                        queryVarNames.query.pixeltop = name;\n                      } else if (rel === \"tile\") {\n                        queryVarNames.query.tiletop = name;\n                      } else {\n                        queryVarNames.query.maptop = name;\n                      }\n                    } else if (position.match(/bottom-.*?/i)) {\n                      if (rel === \"pixel\") {\n                        queryVarNames.query.pixelbottom = name;\n                      } else if (rel === \"tile\") {\n                        queryVarNames.query.tilebottom = name;\n                      } else {\n                        queryVarNames.query.mapbottom = name;\n                      }\n                    }\n                } else {\n                  queryVarNames.query[axis] = name;\n                }\n                break;\n              case('i'):\n                if (units === \"tile\") {\n                  queryVarNames.query.tilei = name;\n                } else {\n                  queryVarNames.query.mapi = name;\n                }\n                break;\n              case('j'):\n                if (units === \"tile\") {\n                  queryVarNames.query.tilej = name;\n                } else {\n                  queryVarNames.query.mapj = name;\n                }\n                break;\n                // unsuportted axis value\n            }\n          } else if (type === \"zoom\") {\n            //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n             queryVarNames.query.zoom = name;\n          } else if (select) {\n              /*jshint -W104 */\n            const parsedselect = inputs[i].htmlselect;\n            queryVarNames.query[name] = function() {\n                return parsedselect.value;\n            };\n          } else {\n              /*jshint -W104 */\n              const input = inputs[i];\n             queryVarNames.query[name] = function () {\n                return input.getAttribute(\"value\");\n             };\n          }\n        }\n        queryVarNames.query.title = template.title;\n        return queryVarNames;\n    },\n    reset: function (templates, extentZIndex) {\n      if (!templates) {return;}\n      if (!this._map) {return;}\n      var addToMap = this._map && this._map.hasLayer(this),\n          old_templates = this._templates;\n      delete this._queries;\n      this._map.off('click', null, this);\n\n      this._templates = templates;\n      for (var i=0;i<templates.length;i++) {\n        if (templates[i].rel === 'tile') {\n            this._templates[i].layer = M.templatedTileLayer(templates[i],\n              L.Util.extend(this.options, {errorTileUrl: \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\", zIndex: extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'image') {\n            this._templates[i].layer = M.templatedImageLayer(templates[i], L.Util.extend(this.options, {zIndex: extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'features') {\n            this._templates[i].layer = M.templatedFeaturesLayer(templates[i], L.Util.extend(this.options, {zIndex: extentZIndex, pane: this._container}));\n        } else if (templates[i].rel === 'query') {\n            if (!this._queries) {\n              this._queries = [];\n            }\n            this._queries.push(L.extend(templates[i], this._setupQueryVars(templates[i])));\n        }\n        if (addToMap) {\n          this.onAdd(this._map);\n        }\n      }\n      for (i=0;i<old_templates.length;i++) {\n        if (this._map.hasLayer(old_templates[i].layer)) {\n          this._map.removeLayer(old_templates[i].layer);\n        }\n      }\n    },\n    onAdd: function (map) {\n      for (var i=0;i<this._templates.length;i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.addLayer(this._templates[i].layer);\n        }\n      }\n    },\n    //addTo: function(map) {\n      //for(let i = 0; i < this._templates.length; i++){\n    //    this._templates[0].layer.addTo(map);\n      //}\n    //},\n    setZIndex: function (zIndex) {\n        this.options.zIndex = zIndex;\n        this._updateZIndex();\n\n        return this;\n    },\n    _updateZIndex: function () {\n        if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n            this._container.style.zIndex = this.options.zIndex;\n        }\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      for (var i=0;i<this._templates.length;i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.removeLayer(this._templates[i].layer);\n        }\n      }\n    },\n\n    _previousFeature: function(e){\n      if(this._count + -1 >= 0){\n        this._count--;\n        this._map.fire(\"featurepagination\", {i: this._count, popup: this});\n      }\n    },\n    \n    _nextFeature: function(e){\n      if(this._count + 1 < this._source._totalFeatureCount){\n        this._count++;\n        this._map.fire(\"featurepagination\", {i: this._count, popup: this});\n      }\n    },\n\n    changeOpacity: function(opacity){\n      this._container.style.opacity = opacity;\n    },\n\n  });\n  var templatedLayer = function(templates, options) {\n    // templates is an array of template objects\n    // a template object contains the template, plus associated <input> elements\n    // which need to be processed just prior to creating a url from the template \n    // with the values of the inputs\n    return new TemplatedLayer(templates, options);\n  };\n\n  var TemplatedFeaturesLayer =  L.Layer.extend({\n    // this and M.ImageLayer could be merged or inherit from a common parent\n      initialize: function(template, options) {\n        let inputData = M._extractInputBounds(template);\n        this.zoomBounds = inputData.zoomBounds;\n        this.extentBounds=inputData.bounds;\n        this.isVisible = true;\n        this._template = template;\n        this._extentEl = options.extentEl;\n        this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n        L.extend(options, this.zoomBounds);\n        L.DomUtil.addClass(this._container, 'mapml-features-container');\n        delete options.opacity;\n        L.setOptions(this, L.extend(options,this._setUpFeaturesTemplateVars(template)));\n      },\n      getEvents: function () {\n          var events = {\n              moveend: this._onMoveEnd\n          };\n          return events;\n      },\n      onAdd: function () {\n        this._map._addZoomLimit(this);\n        var opacity = this.options.opacity || 1,\n            container = this._container,\n            map = this._map;\n        if (!this._features) {\n          this._features = M.featureLayer( null, {\n            // pass the vector layer a renderer of its own, otherwise leaflet\n            // puts everything into the overlayPane\n            renderer: M.featureRenderer(),\n            // pass the vector layer the container for the parent into which\n            // it will append its own container for rendering into\n            pane: container,\n            opacity: opacity,\n            projection:map.options.projection,\n            static: true,\n            onEachFeature: function(properties, geometry) {\n              // need to parse as HTML to preserve semantics and styles\n              var c = document.createElement('div');\n              c.classList.add(\"mapml-popup-content\");\n              c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n              geometry.bindPopup(c, {autoClose: false, minWidth: 108});\n            }\n          });\n        }\n\n        map.fire('moveend');  // TODO: replace with moveend handler for layer and not entire map\n      },\n      redraw: function() {\n          this._onMoveEnd();\n      },\n\n      _removeCSS: function () {\n          let toDelete = this._container.querySelectorAll(\"link[rel=stylesheet],style\");\n          for(let i = 0; i < toDelete.length;i++){\n              let parent = toDelete[i].parentNode;\n              parent.removeChild(toDelete[i]);\n          }\n      },\n\n      _onMoveEnd: function() {\n        let history = this._map.options.mapEl._history;\n        let current = history[history.length - 1];\n        let previous = history[history.length - 2] ?? current;\n        let step = this._template.step;\n        let mapZoom = this._map.getZoom();\n        let steppedZoom = mapZoom;\n        //If zooming out from one step interval into a lower one or panning, set the stepped zoom\n        if (((step !== \"1\") && ((mapZoom + 1) % step === 0) && current.zoom === previous.zoom - 1) ||\n            (current.zoom === previous.zoom) ||\n            (Math.floor(mapZoom / step) * step !== Math.floor(previous.zoom / step) * step)) {\n            steppedZoom = Math.floor(mapZoom / step) * step;\n        }\n        //No request needed if in a step interval (unless panning)\n        else if(mapZoom % this._template.step !== 0) return;\n\n        let scaleBounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n        let url = this._getfeaturesUrl(steppedZoom, scaleBounds);\n        //No request needed if the current template url is the same as the url to request\n        if(url === this._url) return;\n\n        let mapBounds = M.pixelToPCRSBounds(this._map.getPixelBounds(),mapZoom,this._map.options.projection);\n        this.isVisible = mapZoom <= this.zoomBounds.maxZoom && mapZoom >= this.zoomBounds.minZoom && \n                          this.extentBounds.overlaps(mapBounds);\n        \n        this._features.clearLayers();\n        // shadow may has not yet attached to <map-extent> for the first-time rendering\n        if (this._extentEl.shadowRoot) {\n          this._extentEl.shadowRoot.innerHTML = \"\";\n        }\n        this._removeCSS();\n        //Leave the layers cleared if the layer is not visible\n        if(!(this.isVisible) && steppedZoom === mapZoom){\n          this._url = \"\";\n          return;\n        }\n\n        // TODO add preference with a bit less weight than that for text/mapml; 0.8 for application/geo+json; 0.6\n        var mapml, headers = new Headers({'Accept': 'text/mapml;q=0.9,application/geo+json;q=0.8'}),\n            parser = new DOMParser(),\n            features = this._features,\n            extentEl = this._extentEl,\n            map = this._map,\n            context = this,\n            MAX_PAGES = 10,\n          _pullFeatureFeed = function (url, limit) {\n            return (fetch (url,{redirect: 'follow',headers: headers})\n                    .then( function (response) {return response.text();})\n                    .then( function (text) {\n                      //TODO wrap this puppy in a try/catch/finally to parse application/geo+json if necessary\n                mapml = parser.parseFromString(text,\"application/xml\");\n                var base = (new URL(mapml.querySelector('map-base') ? mapml.querySelector('map-base').getAttribute('href') : url)).href;\n                url = mapml.querySelector('map-link[rel=next]')? mapml.querySelector('map-link[rel=next]').getAttribute('href') : null;\n                url =  url ? (new URL(url, base)).href: null;\n                // TODO if the xml parser barfed but the response is application/geo+json, use the parent addData method\n              let nativeZoom = extentEl._nativeZoom = mapml.querySelector(\"map-meta[name=zoom]\") &&\n                                +M._metaContentToObject(mapml.querySelector(\"map-meta[name=zoom]\").getAttribute(\"content\")).value || 0;\n              let nativeCS = extentEl._nativeCS = mapml.querySelector(\"map-meta[name=cs]\") &&\n                                M._metaContentToObject(mapml.querySelector(\"map-meta[name=cs]\").getAttribute(\"content\")).content || \"PCRS\";\n              features.addData(mapml, nativeCS, nativeZoom);\n              // \"migrate\" to extent's shadow\n              // make a clone, prevent the elements from being removed from mapml file\n              // same as _attachToLayer() in MapMLLayer.js\n              for (let el of mapml.querySelector('map-body').children) {\n                extentEl.shadowRoot.append(el._DOMnode);\n                el._DOMnode._extentEl = extentEl;\n              }\n              if (url && --limit) {\n                return _pullFeatureFeed(url, limit);\n              }\n            }));\n          };\n        this._url = url;\n        _pullFeatureFeed(url, MAX_PAGES)\n          .then(function() { \n            map.addLayer(features);\n            //Fires event for feature index overlay\n            map.fire(\"templatedfeatureslayeradd\");\n            M.TemplatedFeaturesLayer.prototype._updateTabIndex(context);\n          })\n          .catch(function (error) { console.log(error);});\n      },\n      setZIndex: function (zIndex) {\n          this.options.zIndex = zIndex;\n          this._updateZIndex();\n          return this;\n      },\n      _updateTabIndex: function(context){\n        let c = context || this;\n        for(let layerNum in c._features._layers){\n          let layer = c._features._layers[layerNum];\n          if(layer._path){\n            if(layer._path.getAttribute(\"d\") !== \"M0 0\"){\n              layer._path.setAttribute(\"tabindex\", 0);\n            } else {\n              layer._path.removeAttribute(\"tabindex\");\n            }\n            if(layer._path.childElementCount === 0) {\n              let title = document.createElement(\"title\");\n              title.innerText = \"Feature\";\n              layer._path.appendChild(title);\n            }\n          }\n        }\n      },\n      _updateZIndex: function () {\n          if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n              this._container.style.zIndex = this.options.zIndex;\n          }\n      },\n      onRemove: function () {\n        this._map.removeLayer(this._features);\n      },\n      _getfeaturesUrl: function(zoom, bounds) {\n          if(zoom === undefined) zoom = this._map.getZoom();\n          if(bounds === undefined) bounds = this._map.getPixelBounds();\n          var obj = {};\n          if (this.options.feature.zoom) {\n            obj[this.options.feature.zoom] = zoom;\n          }\n          if (this.options.feature.width) {\n            obj[this.options.feature.width] = this._map.getSize().x;\n          }\n          if (this.options.feature.height) {\n            obj[this.options.feature.height] = this._map.getSize().y;\n          }\n          if (this.options.feature.bottom) {\n            obj[this.options.feature.bottom] = this._TCRSToPCRS(bounds.max, zoom).y;\n          }\n          if (this.options.feature.left) {\n            obj[this.options.feature.left] = this._TCRSToPCRS(bounds.min, zoom).x;\n          }\n          if (this.options.feature.top) {\n            obj[this.options.feature.top] = this._TCRSToPCRS(bounds.min, zoom).y;\n          }\n          if (this.options.feature.right) {\n            obj[this.options.feature.right] = this._TCRSToPCRS(bounds.max, zoom).x;\n          }\n          // hidden and other variables that may be associated\n          for (var v in this.options.feature) {\n              if ([\"width\",\"height\",\"left\",\"right\",\"top\",\"bottom\",\"zoom\"].indexOf(v) < 0) {\n                  obj[v] = this.options.feature[v];\n                }\n          }\n          return L.Util.template(this._template.template, obj);\n      },\n      _TCRSToPCRS: function(coords, zoom) {\n        // TCRS pixel point to Projected CRS point (in meters, presumably)\n        var map = this._map,\n            crs = map.options.crs,\n            loc = crs.transformation.untransform(coords,crs.scale(zoom));\n            return loc;\n      },\n      _setUpFeaturesTemplateVars: function(template) {\n        // process the inputs and create an object named \"extent\"\n        // with member properties as follows:\n        // {width: {name: 'widthvarname'}, // value supplied by map if necessary\n        //  height: {name: 'heightvarname'}, // value supplied by map if necessary\n        //  left: {name: 'leftvarname', axis: 'leftaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n        //  right: {name: 'rightvarname', axis: 'rightaxisname'}, // axis name (coordinate system of) drives the value supplied by the map\n        //  top: {name: 'topvarname', axis: 'topaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n        //  bottom: {name: 'bottomvarname', axis: 'bottomaxisname'} // axis name drives (coordinate system of) the value supplied by the map\n        //  zoom: {name: 'zoomvarname'}\n        //  hidden: [{name: name, value: value}]}\n\n        var featuresVarNames = {feature:{}},\n            inputs = template.values;\n        featuresVarNames.feature.hidden = [];\n        for (var i=0;i<inputs.length;i++) {\n          // this can be removed when the spec removes the deprecated inputs...\n          var type = inputs[i].getAttribute(\"type\"), \n              units = inputs[i].getAttribute(\"units\"), \n              axis = inputs[i].getAttribute(\"axis\"), \n              name = inputs[i].getAttribute(\"name\"), \n              position = inputs[i].getAttribute(\"position\"),\n              value = inputs[i].getAttribute(\"value\"),\n              select = (inputs[i].tagName.toLowerCase() === \"map-select\");\n          if (type === \"width\") {\n                featuresVarNames.feature.width = name;\n          } else if ( type === \"height\") {\n                featuresVarNames.feature.height = name;\n          } else if (type === \"zoom\") {\n                featuresVarNames.feature.zoom = name;\n          } else if (type === \"location\" && (units === \"pcrs\" || units ===\"gcrs\") ) {\n            //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting\">\n            switch (axis) {\n              case ('x'):\n              case ('longitude'):\n              case ('easting'):\n                if (position) {\n                    if (position.match(/.*?-left/i)) {\n                      featuresVarNames.feature.left = name;\n                    } else if (position.match(/.*?-right/i)) {\n                      featuresVarNames.feature.right = name;\n                    }\n                }\n                break;\n              case ('y'):\n              case ('latitude'):\n              case ('northing'):\n                if (position) {\n                  if (position.match(/top-.*?/i)) {\n                    featuresVarNames.feature.top = name;\n                  } else if (position.match(/bottom-.*?/i)) {\n                    featuresVarNames.feature.bottom = name;\n                  }\n                }\n                break;\n            }\n           } else if (select) {\n              /*jshint -W104 */\n            const parsedselect = inputs[i].htmlselect;\n            featuresVarNames.feature[name] = function() {\n                return parsedselect.value;\n            };\n           // projection is deprecated, make it hidden\n          } else {\n              /*jshint -W104 */\n              const input = inputs[i];\n              featuresVarNames.feature[name] = function() {\n                  return input.getAttribute(\"value\");\n              };\n          }\n        }\n        return featuresVarNames;\n      }\n  });\n  var templatedFeaturesLayer = function(template, options) {\n      return new TemplatedFeaturesLayer(template, options);\n  };\n\n  var TemplatedImageLayer =  L.Layer.extend({\n      initialize: function(template, options) {\n          this._template = template;\n          this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n          L.DomUtil.addClass(this._container, 'mapml-image-container');\n          let inputData = M._extractInputBounds(template);\n          this.zoomBounds = inputData.zoomBounds;\n          this.extentBounds=inputData.bounds;\n          this.isVisible = true;\n          delete options.opacity;\n          L.extend(options, this.zoomBounds);\n          L.setOptions(this, L.extend(options,this._setUpExtentTemplateVars(template)));\n      },\n      getEvents: function () {\n          var events = {\n              moveend: this._onMoveEnd,\n              zoomstart: this._clearLayer\n          };\n          return events;\n      },\n      onAdd: function () {\n          this._map._addZoomLimit(this);  //used to set the zoom limit of the map\n          this.setZIndex(this.options.zIndex);\n          this._onAdd();\n      },\n      redraw: function() {\n          this._onMoveEnd();\n      },\n\n      _clearLayer: function(){\n        let containerImages = this._container.querySelectorAll('img');\n        for(let i = 0; i< containerImages.length;i++){\n          this._container.removeChild(containerImages[i]);\n        }\n      },\n\n      _addImage: function (bounds, zoom, loc) {\n          let map = this._map;\n          let overlayToRemove = this._imageLayer;\n          let src = this.getImageUrl(bounds, zoom);\n          let size = map.getSize();\n          this._imageOverlay = M.imageLayer(src, loc, size, 0, this._container);\n          this._imageOverlay._step = this._template.step;\n          this._imageOverlay.addTo(map);\n          if (overlayToRemove) {\n              this._imageOverlay._overlayToRemove = overlayToRemove._url;\n              this._imageOverlay.on('load error', function () {map.removeLayer(overlayToRemove);});\n          }\n      },\n\n      _scaleImage: function (bounds, zoom) {\n          let obj = this;\n          setTimeout(function () {\n              let step = obj._template.step;\n              let steppedZoom = Math.floor(zoom / step) * step;\n              let scale = obj._map.getZoomScale(zoom, steppedZoom);\n              let translate = bounds.min.multiplyBy(scale)\n                  .subtract(obj._map._getNewPixelOrigin(obj._map.getCenter(), zoom)).round();\n              L.DomUtil.setTransform(obj._imageOverlay._image, translate, scale);\n          });\n      },\n\n      _onAdd: function () {\n          let zoom = this._map.getZoom();\n          let steppedZoom = zoom;\n          let step = this._template.step;\n\n          if (zoom % step !== 0) steppedZoom = Math.floor(zoom / step) * step;\n          let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n          this._pixelOrigins = {};\n          this._pixelOrigins[steppedZoom] = bounds.min;\n          // if the map is panned before the new image layer is added,\n          // the location that the layer should be added to is no longer (0,0) but need to be calculated\n          let loc = this._map.getPixelBounds().min.subtract(this._map.getPixelOrigin());\n          this._addImage(bounds, steppedZoom, loc);\n          if(zoom !== steppedZoom) {\n              this._scaleImage(bounds, zoom);\n          }\n      },\n\n      _onMoveEnd: function(e) {\n          let mapZoom = this._map.getZoom();\n          let history = this._map.options.mapEl._history;\n          let current = history[history.length - 1];\n          let previous = history[history.length - 2];\n          if(!previous) previous = current;\n          let step = this._template.step;\n          let steppedZoom = Math.floor(mapZoom / step) * step;\n          let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n          //Zooming from one step increment into a lower one\n          if((step !== \"1\") && ((mapZoom + 1) % step === 0) &&\n              current.zoom === previous.zoom - 1){\n              this._addImage(bounds, steppedZoom, L.point(0,0));\n              this._scaleImage(bounds, mapZoom);\n          //Zooming or panning within a step increment\n          } else if (e && mapZoom % step !== 0) {\n              this._imageOverlay._overlayToRemove = this._imageOverlay._url;\n              if (current.zoom !== previous.zoom) {\n                  //Zoomed from within one step increment into another\n                  this._addImage(bounds, steppedZoom, L.point(0,0));\n                  this._pixelOrigins[steppedZoom] = bounds.min;\n                  this._scaleImage(bounds, mapZoom);\n              } else {\n                  // Panning within a step increment\n                  let pixelOrigin = this._pixelOrigins[steppedZoom];\n                  let loc = bounds.min.subtract(pixelOrigin);\n                  if(this.getImageUrl(bounds, steppedZoom) === this._imageOverlay._url) return;\n                  this._addImage(bounds, steppedZoom, loc);\n                  this._scaleImage(bounds, mapZoom);\n              }\n          // Zooming from one step decrement into a higher one\n          // OR panning when mapZoom % step === 0\n          } else {\n              let mapBounds = M.pixelToPCRSBounds(this._map.getPixelBounds(),mapZoom,this._map.options.projection);\n              this.isVisible = mapZoom <= this.zoomBounds.maxZoom && mapZoom >= this.zoomBounds.minZoom &&\n              this.extentBounds.overlaps(mapBounds);\n              if(!(this.isVisible)){\n                  this._clearLayer();\n                  return;\n              }\n              var map = this._map, loc = map.getPixelBounds().min.subtract(map.getPixelOrigin());\n              this._addImage(map.getPixelBounds(), mapZoom, loc);\n              this._pixelOrigins[mapZoom] = map.getPixelOrigin();\n          }\n      },\n      setZIndex: function (zIndex) {\n          this.options.zIndex = zIndex;\n          this._updateZIndex();\n\n          return this;\n      },\n      _updateZIndex: function () {\n          if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n              this._container.style.zIndex = this.options.zIndex;\n          }\n      },\n      onRemove: function (map) {\n        this._clearLayer();\n        map._removeZoomLimit(this);\n        this._container = null;\n      },\n      getImageUrl: function(pixelBounds, zoom) {\n          var obj = {};\n          obj[this.options.extent.width] = this._map.getSize().x;\n          obj[this.options.extent.height] = this._map.getSize().y;\n          obj[this.options.extent.bottom] = this._TCRSToPCRS(pixelBounds.max, zoom).y;\n          obj[this.options.extent.left] = this._TCRSToPCRS(pixelBounds.min, zoom).x;\n          obj[this.options.extent.top] = this._TCRSToPCRS(pixelBounds.min, zoom).y;\n          obj[this.options.extent.right] = this._TCRSToPCRS(pixelBounds.max, zoom).x;\n          // hidden and other variables that may be associated\n          for (var v in this.options.extent) {\n              if ([\"width\",\"height\",\"left\",\"right\",\"top\",\"bottom\"].indexOf(v) < 0) {\n                  obj[v] = this.options.extent[v];\n                }\n          }\n          return L.Util.template(this._template.template, obj);\n      },\n      _TCRSToPCRS: function(coords, zoom) {\n        // TCRS pixel point to Projected CRS point (in meters, presumably)\n        var map = this._map,\n            crs = map.options.crs,\n            loc = crs.transformation.untransform(coords,crs.scale(zoom));\n            return loc;\n      },\n      _setUpExtentTemplateVars: function(template) {\n        // process the inputs associated to template and create an object named\n        // extent with member properties as follows:\n        // {width: 'widthvarname', \n        //  height: 'heightvarname', \n        //  left: 'leftvarname', \n        //  right: 'rightvarname', \n        //  top: 'topvarname', \n        //  bottom: 'bottomvarname'}\n\n        var extentVarNames = {extent:{}},\n            inputs = template.values;\n        \n        for (var i=0;i<template.values.length;i++) {\n          var type = inputs[i].getAttribute(\"type\"), \n              units = inputs[i].getAttribute(\"units\"), \n              axis = inputs[i].getAttribute(\"axis\"), \n              name = inputs[i].getAttribute(\"name\"), \n              position = inputs[i].getAttribute(\"position\"),\n              select = (inputs[i].tagName.toLowerCase() === \"map-select\");\n          if (type === \"width\") {\n                extentVarNames.extent.width = name;\n          } else if ( type === \"height\") {\n                extentVarNames.extent.height = name;\n          } else if (type === \"location\" && (units === \"pcrs\" || units ===\"gcrs\") ) {\n            //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n            switch (axis) {\n              case ('longitude'):\n              case ('easting'):\n                if (position) {\n                    if (position.match(/.*?-left/i)) {\n                      extentVarNames.extent.left = name;\n                    } else if (position.match(/.*?-right/i)) {\n                      extentVarNames.extent.right = name;\n                    }\n                }\n                break;\n              case ('latitude'):\n              case ('northing'):\n                if (position) {\n                  if (position.match(/top-.*?/i)) {\n                    extentVarNames.extent.top = name;\n                  } else if (position.match(/bottom-.*?/i)) {\n                    extentVarNames.extent.bottom = name;\n                  }\n                }\n                break;\n            }\n          } else if (select) {\n              /*jshint -W104 */\n            const parsedselect = inputs[i].htmlselect;\n            extentVarNames.extent[name] = function() {\n                return parsedselect.value;\n            };\n          } else {\n              /*jshint -W104 */\n              const input = inputs[i];\n              extentVarNames.extent[name] = function() {\n                  return input.getAttribute(\"value\");\n              };\n          }\n        }\n        return extentVarNames;\n      }\n  });\n  var templatedImageLayer = function(template, options) {\n      return new TemplatedImageLayer(template, options);\n  };\n\n  var ImageLayer = L.ImageOverlay.extend({\n  \tinitialize: function (url, location, size, angle, container, options) { // (String, Point, Point, Number, Element, Object)\n                  this._container = container;\n  \t\tthis._url = url;\n                  // instead of calculating where the image goes, put it at 0,0\n  \t\t//this._location = L.point(location);\n                  // the location for WMS requests will be the upper left hand\n                  // corner of the map.  When the map is initialized, that is 0,0,\n                  // but as the user pans, of course the\n  \t\tthis._location = location;\n                  this._size = L.point(size);\n                  this._angle = angle;\n\n  \t\tL.setOptions(this, options);\n  \t},\n          getEvents: function() {\n  \t\tvar events = {\n  \t\t\tviewreset: this._reset\n  \t\t};\n\n  \t\tif (this._zoomAnimated && this._step <= 1) {\n  \t\t\tevents.zoomanim = this._animateZoom;\n  \t\t}\n\n  \t\treturn events;\n          },\n  \tonAdd: function () {\n                  this.on({ \n                    load: this._onImageLoad\n                    });\n\n  \t\tif (!this._image) {\n                      this._initImage();\n  \t\t}\n\n  \t\tif (this.options.interactive) {\n  \t\t\tL.DomUtil.addClass(this._image, 'leaflet-interactive');\n  \t\t\tthis.addInteractiveTarget(this._image);\n  \t\t}\n\n  \t\tthis._container.appendChild(this._image);\n  \t\tthis._reset();\n  \t},\n  \tonRemove: function () {\n  \t\tL.DomUtil.remove(this._image);\n  \t\tif (this.options.interactive) {\n  \t\t\tthis.removeInteractiveTarget(this._image);\n  \t\t}\n  \t},\n          _onImageLoad: function () {\n              if (!this._image) { return; }\n              this._image.loaded =  +new Date();\n              this._updateOpacity();\n          },\n  \t_animateZoom: function (e) {\n  \t\tvar scale = this._map.getZoomScale(e.zoom),\n  \t\t    translate = this._map.getPixelOrigin().add(this._location).multiplyBy(scale)\n  \t\t        .subtract(this._map._getNewPixelOrigin(e.center, e.zoom)).round();\n\n  \t\tif (L.Browser.any3d) {\n  \t\t\tL.DomUtil.setTransform(this._image, translate, scale);\n  \t\t} else {\n  \t\t\tL.DomUtil.setPosition(this._image, translate);\n  \t\t}\n  \t},\n      _reset: function (e) {\n  \t\tvar image = this._image,\n  \t\t    location = this._location,\n                      size = this._size;\n  \t\t// TBD use the angle to establish the image rotation in CSS\n\n  \t\tif(e && this._step > 1 &&\n  \t\t\t(this._overlayToRemove === undefined || this._url === this._overlayToRemove)) {\n  \t\t\treturn;\n  \t\t}\n  \t\tL.DomUtil.setPosition(image, location);\n\n  \t\timage.style.width  = size.x + 'px';\n  \t\timage.style.height = size.y + 'px';\n      },\n  \t_updateOpacity: function () {\n  \t\tif (!this._map) { return; }\n\n  \t\t//L.DomUtil.setOpacity(this._image, this.options.opacity);\n\n  \t\tvar now = +new Date(),\n  \t\t    nextFrame = false;\n\n                  var image = this._image;\n\n                  var fade = Math.min(1, (now - image.loaded) / 200);\n\n                  L.DomUtil.setOpacity(image, fade);\n                  if (fade < 1) {\n                          nextFrame = true;\n                  } \n  \t\tif (nextFrame) {\n  \t\t\tL.Util.cancelAnimFrame(this._fadeFrame);\n  \t\t\tthis._fadeFrame = L.Util.requestAnimFrame(this._updateOpacity, this);\n  \t\t}\n                  L.DomUtil.addClass(image, 'leaflet-image-loaded');\n  \t}\n          \n  });\n  var imageLayer = function (url, location, size, angle, container, options) {\n          return new ImageLayer(url, location, size, angle, container, options);\n  };\n\n  var MapMLLayer = L.Layer.extend({\n      // zIndex has to be set, for the case where the layer is added to the\n      // map before the layercontrol is used to control it (where autoZindex is used)\n      // e.g. in the raw MapML-Leaflet-Client index.html page.\n      options: {\n          maxNext: 10,\n          zIndex: 0,\n          maxZoom: 25,\n          opacity: '1.0'\n      },\n      // initialize is executed before the layer is added to a map\n      initialize: function (href, content, options) {\n          // in the custom element, the attribute is actually 'src'\n          // the _href version is the URL received from layer-@src\n          var mapml;\n          if (href) {\n              this._href = href;\n          }\n          if (content) {\n            this._layerEl = content;\n            mapml = content.querySelector('map-feature,map-tile,map-extent') ? true : false;\n            if (!href && mapml) {\n                this._content = content;\n            }\n          }\n          L.setOptions(this, options);\n          this._container = L.DomUtil.create('div', 'leaflet-layer');\n          this.changeOpacity(this.options.opacity);\n          L.DomUtil.addClass(this._container,'mapml-layer');\n          this._imageContainer = L.DomUtil.create('div', 'leaflet-layer', this._container);\n          L.DomUtil.addClass(this._imageContainer,'mapml-image-container');\n          \n          // this layer 'owns' a mapmlTileLayer, which is a subclass of L.GridLayer\n          // it 'passes' what tiles to load via the content of this._mapmlTileContainer\n          this._mapmlTileContainer = L.DomUtil.create('div', 'mapml-tile-container', this._container);\n          // hit the service to determine what its extent might be\n          // OR use the extent of the content provided\n\n          if (!mapml && content && content.hasAttribute('label')) this._title = content.getAttribute('label');\n          this._initialize(mapml ? content : null);\n          \n          // a default extent can't be correctly set without the map to provide\n          // its bounds , projection, zoom range etc, so if that stuff's not\n          // established by metadata in the content, we should use map properties\n          // to set the extent, but the map won't be available until the <layer>\n          // element is attached to the <map> element, wait for that to happen.\n          this.on('attached', this._validateExtent, this );\n          // weirdness.  options is actually undefined here, despite the hardcoded\n          // options above. If you use this.options, you see the options defined\n          // above.  Not going to change this, but failing to understand ATM.\n          // may revisit some time.\n          this.validProjection = true; \n          \n          // _mapmlLayerItem is set to the root element representing this layer\n          // in the layer control, iff the layer is not 'hidden' \n          this._mapmlLayerItem = {};\n      },\n      setZIndex: function (zIndex) {\n          this.options.zIndex = zIndex;\n          this._updateZIndex();\n\n          return this;\n      },\n      getHref: function () {\n        return this._href ?? \"\";\n      },\n      _updateZIndex: function () {\n          if (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n              this._container.style.zIndex = this.options.zIndex;\n          }\n      },\n      // remove all the extents before removing the layer from the map\n      _removeExtents: function(map){\n        if(this._extent._mapExtents){\n          for(let i = 0; i < this._extent._mapExtents.length; i++){\n            if(this._extent._mapExtents[i].templatedLayer){\n              map.removeLayer(this._extent._mapExtents[i].templatedLayer);\n            }\n          }\n        }\n        if (this._extent._queries) {\n          delete this._extent._queries;\n        }\n      },\n      _changeOpacity: function(e) {\n        if (e && e.target && e.target.value >=0 && e.target.value <= 1.0) {\n          this.changeOpacity(e.target.value);\n        }\n      },\n      changeOpacity: function(opacity) {\n          this._container.style.opacity = opacity;\n          if(this.opacityEl) this.opacityEl.value = opacity;\n      },\n      _changeExtentOpacity: function(e){\n        if(e && e.target && e.target.value >=0 && e.target.value <= 1.0){\n          this.templatedLayer.changeOpacity(e.target.value);\n          this._templateVars.opacity = e.target.value;\n        }\n      },\n      _changeExtent: function(e, extentEl) {\n          if(e.target.checked){\n            extentEl.checked = true;\n            if(this._layerEl.checked){\n                extentEl.templatedLayer = M.templatedLayer(extentEl._templateVars, \n                  { pane: this._container,\n                    opacity: extentEl._templateVars.opacity,\n                    _leafletLayer: this,\n                    crs: extentEl.crs,\n                    extentZIndex: extentEl.extentZIndex,\n                    extentEl: extentEl._DOMnode || extentEl\n                  }).addTo(this._map);\n                  extentEl.templatedLayer.setZIndex();\n                  this._setLayerElExtent();  \n              }       \n          } else {\n              L.DomEvent.stopPropagation(e);\n              extentEl.checked = false;\n              if(this._layerEl.checked) this._map.removeLayer(extentEl.templatedLayer);\n              this._setLayerElExtent();\n          }\n      },\n\n      onAdd: function (map) {\n          if (this._extent && !this._validProjection(map)) {\n            this.validProjection = false;\n            return;\n          }\n          this._map = map;\n          if(this._content){\n            if (!this._mapmlvectors) {\n              this._mapmlvectors = M.featureLayer(this._content, {\n                // pass the vector layer a renderer of its own, otherwise leaflet\n                // puts everything into the overlayPane\n                renderer: M.featureRenderer(),\n                // pass the vector layer the container for the parent into which\n                // it will append its own container for rendering into\n                pane: this._container,\n                opacity: this.options.opacity,\n                projection:map.options.projection,\n                // each owned child layer gets a reference to the root layer\n                _leafletLayer: this,\n                static: true,\n                onEachFeature: function(properties, geometry) {\n                  // need to parse as HTML to preserve semantics and styles\n                  if (properties) {\n                    var c = document.createElement('div');\n                    c.classList.add(\"mapml-popup-content\");\n                    c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                    geometry.bindPopup(c, {autoClose: false, minWidth: 165});\n                  }\n                }\n              });\n            }\n            this._setLayerElExtent();\n            map.addLayer(this._mapmlvectors);\n          } else {\n            this.once('extentload', function() {\n              if(!this._validProjection(map)){\n                this.validProjection = false;\n                return;\n              }\n              if (!this._mapmlvectors) {\n                this._mapmlvectors = M.featureLayer(this._content, {\n                  // pass the vector layer a renderer of its own, otherwise leaflet\n                  // puts everything into the overlayPane\n                    renderer: M.featureRenderer(),\n                    // pass the vector layer the container for the parent into which\n                    // it will append its own container for rendering into\n                    pane: this._container,\n                    opacity: this.options.opacity,\n                    projection:map.options.projection,\n                    // each owned child layer gets a reference to the root layer\n                    _leafletLayer: this,\n                    static: true,\n                    onEachFeature: function(properties, geometry) {\n                      // need to parse as HTML to preserve semantics and styles\n                      if (properties) {\n                        var c = document.createElement('div');\n                        c.classList.add(\"mapml-popup-content\");\n                        c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                        geometry.bindPopup(c, {autoClose: false, minWidth: 165});\n                      }\n                    },\n                  }).addTo(map);\n                }\n                this._setLayerElExtent();\n              },this);\n          }\n          \n          \n          \n          if (!this._imageLayer) {\n              this._imageLayer = L.layerGroup();\n          }\n          map.addLayer(this._imageLayer);\n          // the layer._imageContainer property contains an element in which\n          // content will be maintained\n          \n          //only add the layer if there are tiles to be rendered\n          if((!this._staticTileLayer || this._staticTileLayer._container === null) && \n            this._mapmlTileContainer.getElementsByTagName(\"map-tiles\").length > 0)\n          {\n            this._staticTileLayer = M.staticTileLayer({\n              pane:this._container,\n              _leafletLayer: this,\n              className:\"mapml-static-tile-layer\",\n              tileContainer:this._mapmlTileContainer,\n              maxZoomBound:map.options.crs.options.resolutions.length - 1,\n              tileSize: map.options.crs.options.crs.tile.bounds.max.x,\n            });\n            map.addLayer(this._staticTileLayer);\n            this._setLayerElExtent();\n          }\n          \n          const createAndAdd = createAndAddTemplatedLayers.bind(this);\n          // if the extent has been initialized and received, update the map,\n          if (this._extent && this._extent._mapExtents && this._extent._mapExtents[0]._templateVars) {\n            createAndAdd();\n          } else { // wait for extent to be loaded\n            this.once('extentload', function() {\n                if(!this._validProjection(map)){\n                  this.validProjection = false;\n                  return;\n                }\n                createAndAdd();\n              }, this);\n          }\n\n          this.setZIndex(this.options.zIndex);\n          this.getPane().appendChild(this._container);\n          setTimeout(() => {\n            map.fire('checkdisabled');\n          }, 0);\n          map.on(\"popupopen\", this._attachSkipButtons, this);\n\n          function createAndAddTemplatedLayers() {\n            if(this._extent && this._extent._mapExtents){\n              for(let i = 0; i < this._extent._mapExtents.length; i++){\n                if (this._extent._mapExtents[i]._templateVars && this._extent._mapExtents[i].checked) {\n                  if(!this._extent._mapExtents[i].extentZIndex) this._extent._mapExtents[i].extentZIndex = i;\n                  this._templatedLayer = M.templatedLayer(this._extent._mapExtents[i]._templateVars, \n                    { pane: this._container,\n                      opacity: this._extent._mapExtents[i]._templateVars.opacity,\n                      _leafletLayer: this,\n                      crs: this._extent.crs,\n                      extentZIndex: this._extent._mapExtents[i].extentZIndex,\n                      // when a <map-extent> migrates from a remote mapml file and attaches to the shadow of <layer- >\n                      // this._extent._mapExtents[i] refers to the <map-extent> in remote mapml\n                      extentEl: this._extent._mapExtents[i]._DOMnode || this._extent._mapExtents[i],\n                      }).addTo(map);   \n                      this._extent._mapExtents[i].templatedLayer = this._templatedLayer;\n                      if(this._templatedLayer._queries){\n                        if(!this._extent._queries) this._extent._queries = [];\n                        this._extent._queries = this._extent._queries.concat(this._templatedLayer._queries);\n                      }\n                }\n                if (this._extent._mapExtents[i].hasAttribute('opacity')) {\n                  let opacity = this._extent._mapExtents[i].getAttribute('opacity');\n                  this._extent._mapExtents[i].templatedLayer.changeOpacity(opacity);\n                }\n               }\n              this._setLayerElExtent();\n            }\n          }\n      },\n\n      _validProjection : function(map){\n        let noLayer = false;\n        if(this._extent && this._extent._mapExtents){\n          for(let i = 0; i < this._extent._mapExtents.length; i++){\n            if(this._extent._mapExtents[i]._templateVars){\n              for(let template of this._extent._mapExtents[i]._templateVars)\n                if(!template.projectionMatch && template.projection !== map.options.projection) {\n                  noLayer = true; // if there's a single template where projections don't match, set noLayer to true\n                  break;\n                } \n              }\n        }\n      }\n        return !(noLayer || this.getProjection() !== map.options.projection.toUpperCase());\n      },\n\n      //sets the <layer-> elements .bounds property \n      _setLayerElExtent: function(){\n        let bounds, zoomMax, zoomMin, maxNativeZoom, minNativeZoom,\n            zoomBounds = {minZoom: 0, maxZoom: 0, maxNativeZoom: 0, minNativeZoom: 0};\n        let layerTypes = [\"_staticTileLayer\",\"_imageLayer\",\"_mapmlvectors\",\"_templatedLayer\"];\n        layerTypes.forEach((type) =>{\n          if(this[type]){\n            if(type === \"_templatedLayer\"){\n              for(let i = 0; i < this._extent._mapExtents.length; i++){\n                for(let j = 0; j < this._extent._mapExtents[i]._templateVars.length; j++){\n                  let inputData = M._extractInputBounds(this._extent._mapExtents[i]._templateVars[j]);\n                  this._extent._mapExtents[i]._templateVars[j].tempExtentBounds = inputData.bounds;\n                  this._extent._mapExtents[i]._templateVars[j].extentZoomBounds = inputData.zoomBounds;\n                }\n              }\n              for(let i = 0; i < this._extent._mapExtents.length; i++){\n                if(this._extent._mapExtents[i].checked){\n                  for(let j = 0; j < this._extent._mapExtents[i]._templateVars.length; j++){\n                    if(!bounds){\n                      bounds = this._extent._mapExtents[i]._templateVars[j].tempExtentBounds;\n                      zoomMax = this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.maxZoom;\n                      zoomMin = this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.minZoom;\n                      maxNativeZoom = this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.maxNativeZoom;\n                      minNativeZoom = this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.minNativeZoom;\n                    } else {\n                      bounds.extend(this._extent._mapExtents[i]._templateVars[j].tempExtentBounds.min);\n                      bounds.extend(this._extent._mapExtents[i]._templateVars[j].tempExtentBounds.max);\n                      zoomMax = Math.max(zoomMax, this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.maxZoom);\n                      zoomMin = Math.min(zoomMin, this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.minZoom);\n                      maxNativeZoom = Math.max(maxNativeZoom, this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.maxNativeZoom);\n                      minNativeZoom = Math.min(minNativeZoom, this._extent._mapExtents[i]._templateVars[j].extentZoomBounds.minNativeZoom);\n                    }\n                  }\n                }\n              }\n              zoomBounds.minZoom = zoomMin;\n              zoomBounds.maxZoom = zoomMax;\n              zoomBounds.minNativeZoom = minNativeZoom;\n              zoomBounds.maxNativeZoom = maxNativeZoom;\n              this._extent.zoomBounds = zoomBounds;\n              this._extent.layerBounds = bounds;\n              // assign each template the layer and zoom bounds\n              for(let i = 0; i < this._extent._mapExtents.length; i++){\n                this._extent._mapExtents[i].templatedLayer.layerBounds = bounds;\n                this._extent._mapExtents[i].templatedLayer.zoomBounds = zoomBounds;\n              }\n            } else {\n              if(this[type].layerBounds){\n                if(!bounds){\n                  bounds = this[type].layerBounds;\n                  zoomBounds = this[type].zoomBounds;\n                } else {\n                  bounds.extend(this[type].layerBounds.min);\n                  bounds.extend(this[type].layerBounds.max);\n                }\n              } \n            }\n          }\n        });\n        if(bounds){\n          //assigns the formatted extent object to .extent and spreads the zoom ranges to .extent also\n          this._layerEl.extent = (Object.assign(\n                                    M._convertAndFormatPCRS(bounds,this._map),\n                                    {zoom:zoomBounds}));\n        }\n      },\n\n      addTo: function (map) {\n          map.addLayer(this);\n          return this;\n      },\n      getEvents: function () {\n          return {zoomanim: this._onZoomAnim};\n      },\n      redraw: function() {\n        // for now, only redraw templated layers.\n          if (this._extent._mapExtents) {\n            for(let i = 0; i < this._extent._mapExtents.length; i++){\n              if(this._extent._mapExtents[i].templatedLayer){\n                this._extent._mapExtents[i].templatedLayer.redraw();\n              }\n            }\n          }\n      },\n      _onZoomAnim: function(e) {\n        // this callback will be invoked AFTER <layer- > has been removed\n        // but due to the characteristic of JavaScript, the context (this pointer) can still be used\n        // the easiest way to solve this:\n        if (!this._map) {return;}\n        // get the min and max zooms from all extents\n        var toZoom = e.zoom,\n            zoom = (this._extent && this._extent._mapExtents) ? this._extent._mapExtents[0].querySelector(\"map-input[type=zoom]\") : null,\n            min = zoom && zoom.hasAttribute(\"min\") ? parseInt(zoom.getAttribute(\"min\")) : this._map.getMinZoom(),\n            max =  zoom && zoom.hasAttribute(\"max\") ? parseInt(zoom.getAttribute(\"max\")) : this._map.getMaxZoom();\n        if(zoom){\n          for(let i = 1; i < this._extent._mapExtents.length; i++){\n            zoom = this._extent._mapExtents[i].querySelector(\"map-input[type=zoom]\");\n            if(zoom && zoom.hasAttribute(\"min\")) { min = Math.min(parseInt(zoom.getAttribute(\"min\")), min); }\n            if(zoom && zoom.hasAttribute(\"max\")){ max = Math.max(parseInt(zoom.getAttribute(\"max\")), max); }\n          }\n        }\n        var canZoom = (toZoom < min && this._extent.zoomout) || (toZoom > max && this._extent.zoomin);\n        if (!(min <= toZoom && toZoom <= max)){\n          if (this._extent.zoomin && toZoom > max) {\n            // this._href is the 'original' url from which this layer came\n            // since we are following a zoom link we will be getting a new\n            // layer almost, resetting child content as appropriate\n            this._href = this._extent.zoomin;\n            this._layerEl.src = this._extent.zoomin;\n            // this.href is the \"public\" property. When a dynamic layer is\n            // accessed, this value changes with every new extent received\n            this.href = this._extent.zoomin;\n            this._layerEl.src = this._extent.zoomin;\n          } else if (this._extent.zoomout && toZoom < min) {\n            this._href = this._extent.zoomout;\n            this.href = this._extent.zoomout;\n            this._layerEl.src = this._extent.zoomout;\n          }\n        }\n        if (this._templatedLayer && canZoom ) ;\n      },\n      onRemove: function (map) {\n          L.DomUtil.remove(this._container);\n          if(this._staticTileLayer) map.removeLayer(this._staticTileLayer);\n          if(this._mapmlvectors) map.removeLayer(this._mapmlvectors);\n          if(this._imageLayer) map.removeLayer(this._imageLayer);\n          if (this._extent && this._extent._mapExtents) this._removeExtents(map);\n\n          map.fire(\"checkdisabled\");\n          map.off(\"popupopen\", this._attachSkipButtons);\n\n      },\n      getAttribution: function () {\n          return this.options.attribution;\n      },\n\n      getLayerExtentHTML: function (labelName, i) {\n        var extent = L.DomUtil.create('fieldset', 'mapml-layer-extent'),\n          extentProperties = L.DomUtil.create('div', 'mapml-layer-item-properties', extent),\n          extentSettings = L.DomUtil.create('div', 'mapml-layer-item-settings', extent),\n          extentLabel = L.DomUtil.create('label', 'mapml-layer-item-toggle', extentProperties),\n          input = L.DomUtil.create('input'),\n          svgExtentControlIcon = L.SVG.create('svg'),\n          extentControlPath1 = L.SVG.create('path'),\n          extentControlPath2 = L.SVG.create('path'),\n          extentNameIcon = L.DomUtil.create('span'),\n          extentItemControls = L.DomUtil.create('div', 'mapml-layer-item-controls', extentProperties),\n          opacityControl = L.DomUtil.create('details', 'mapml-layer-item-opacity', extentSettings),\n          extentOpacitySummary = L.DomUtil.create('summary', '', opacityControl),\n          mapEl = this._layerEl.parentNode,\n          layerEl = this._layerEl,\n          opacity = L.DomUtil.create('input', '', opacityControl);\n          extentSettings.hidden = true;\n          extent.setAttribute(\"aria-grabbed\", \"false\");\n          if(!labelName){ // if a label attribute is not present, set it to hidden in layer control\n            extent.setAttribute(\"hidden\", \"\");\n            this._extent._mapExtents[i].hidden = true;\n          }\n\n          // append the svg paths\n          svgExtentControlIcon.setAttribute('viewBox', '0 0 24 24');\n          svgExtentControlIcon.setAttribute('height', '22');\n          svgExtentControlIcon.setAttribute('width', '22');\n          extentControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n          extentControlPath1.setAttribute('fill', 'none');\n          extentControlPath2.setAttribute('d', 'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z');\n          svgExtentControlIcon.appendChild(extentControlPath1);\n          svgExtentControlIcon.appendChild(extentControlPath2);\n\n          let removeExtentButton = L.DomUtil.create('button', 'mapml-layer-item-remove-control', extentItemControls);\n          removeExtentButton.type = 'button';\n          removeExtentButton.title = 'Remove Sub Layer';\n          removeExtentButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n          removeExtentButton.classList.add('mapml-button');\n          L.DomEvent.on(removeExtentButton, 'click', L.DomEvent.stop);\n          L.DomEvent.on(removeExtentButton, 'click', (e)=>{\n            let allRemoved = true;\n            e.target.checked = false;\n            this._extent._mapExtents[i].removed = true;\n            this._extent._mapExtents[i].checked = false;\n            if(this._layerEl.checked) this._changeExtent(e, this._extent._mapExtents[i]);\n            this._extent._mapExtents[i].extentAnatomy.parentNode.removeChild(this._extent._mapExtents[i].extentAnatomy);\n            for(let j = 0; j < this._extent._mapExtents.length; j++){\n              if(!this._extent._mapExtents[j].removed) allRemoved = false;\n            }\n            if(allRemoved) this._layerItemSettingsHTML.removeChild(this._extentGroupAnatomy); \n          }, this);\n\n          let extentsettingsButton = L.DomUtil.create('button', 'mapml-layer-item-settings-control', extentItemControls);\n          extentsettingsButton.type = 'button';\n          extentsettingsButton.title = 'Extent Settings';\n          extentsettingsButton.setAttribute('aria-expanded', false);\n          extentsettingsButton.classList.add('mapml-button');\n          L.DomEvent.on(extentsettingsButton, 'click', (e)=>{\n            if(extentSettings.hidden === true){\n              extentsettingsButton.setAttribute('aria-expanded', true);\n              extentSettings.hidden = false;\n            } else {\n              extentsettingsButton.setAttribute('aria-expanded', false);\n              extentSettings.hidden = true;\n            }\n          }, this);\n\n          extentNameIcon.setAttribute('aria-hidden', true);\n          extentLabel.appendChild(input);\n          extentsettingsButton.appendChild(extentNameIcon);\n          extentNameIcon.appendChild(svgExtentControlIcon);\n          extentOpacitySummary.innerText = 'Opacity';\n          extentOpacitySummary.id = 'mapml-layer-item-opacity-' + L.stamp(extentOpacitySummary);\n          opacity.setAttribute('type','range');\n          opacity.setAttribute('min', '0');\n          opacity.setAttribute('max','1.0');\n          opacity.setAttribute('step','0.1');\n          opacity.setAttribute('aria-labelledby', 'mapml-layer-item-opacity-' + L.stamp(extentOpacitySummary));\n          let opacityValue = this._extent._mapExtents[i].hasAttribute(\"opacity\") ? this._extent._mapExtents[i].getAttribute(\"opacity\"):'1.0';\n          this._extent._mapExtents[i]._templateVars.opacity = opacityValue;\n          opacity.setAttribute('value', opacityValue);\n          opacity.value = opacityValue;\n          L.DomEvent.on(opacity, 'change', this._changeExtentOpacity, this._extent._mapExtents[i]);\n\n          var extentItemNameSpan = L.DomUtil.create('span', 'mapml-layer-item-name', extentLabel);\n          input.defaultChecked = this._extent._mapExtents[i] ? true: false;\n          this._extent._mapExtents[i].checked = input.defaultChecked;\n          input.type = 'checkbox';\n          extentItemNameSpan.innerHTML = labelName;\n          L.DomEvent.on(input, 'change', (e)=>{\n            this._changeExtent(e, this._extent._mapExtents[i]);\n          });\n          extentItemNameSpan.id = 'mapml-extent-item-name-{' + L.stamp(extentItemNameSpan) + '}';\n          extent.setAttribute('aria-labelledby', extentItemNameSpan.id);\n          extentItemNameSpan.extent = this._extent._mapExtents[i];\n\n          extent.ontouchstart = extent.onmousedown = (downEvent) => {\n            if((downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n                downEvent.target.tagName.toLowerCase() !== 'input') ||\n                downEvent.target.tagName.toLowerCase() === 'label') {          \n              downEvent.stopPropagation();\n              downEvent = downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n\n              let control = extent,\n                  controls = extent.parentNode,\n                  moving = false, yPos = downEvent.clientY;\n\n              document.body.ontouchmove = document.body.onmousemove = (moveEvent) => {\n                moveEvent.preventDefault();\n                moveEvent = moveEvent instanceof TouchEvent ? moveEvent.touches[0] : moveEvent;\n    \n                // Fixes flickering by only moving element when there is enough space\n                let offset = moveEvent.clientY - yPos;\n                moving = Math.abs(offset) > 5 || moving;\n                if( (controls && !moving) || (controls && controls.childElementCount <= 1) || \n                    controls.getBoundingClientRect().top > control.getBoundingClientRect().bottom || \n                    controls.getBoundingClientRect().bottom < control.getBoundingClientRect().top){\n                      return;\n                }\n                \n                controls.classList.add(\"mapml-draggable\");\n                control.style.transform = \"translateY(\"+ offset +\"px)\";\n                control.style.pointerEvents = \"none\";\n    \n                let x = moveEvent.clientX, y = moveEvent.clientY,\n                    root = mapEl.tagName === \"MAPML-VIEWER\" ? mapEl.shadowRoot : mapEl.querySelector(\".mapml-web-map\").shadowRoot,\n                    elementAt = root.elementFromPoint(x, y),\n                    swapControl = !elementAt || !elementAt.closest(\"fieldset\") ? control : elementAt.closest(\"fieldset\");\n          \n                swapControl =  Math.abs(offset) <= swapControl.offsetHeight ? control : swapControl;\n                \n                control.setAttribute(\"aria-grabbed\", 'true');\n                control.setAttribute(\"aria-dropeffect\", \"move\");\n                if(swapControl && controls === swapControl.parentNode){\n                  swapControl = swapControl !== control.nextSibling? swapControl : swapControl.nextSibling;\n                  if(control !== swapControl){ \n                    yPos = moveEvent.clientY;\n                    control.style.transform = null;\n                  }\n                  controls.insertBefore(control, swapControl);\n                }\n              };\n\n              document.body.ontouchend = document.body.onmouseup = () => {\n                control.setAttribute(\"aria-grabbed\", \"false\");\n                control.removeAttribute(\"aria-dropeffect\");\n                control.style.pointerEvents = null;\n                control.style.transform = null;\n                let controlsElems = controls.children,\n                    zIndex = 0;\n                for(let c of controlsElems){\n                  let extentEl = c.querySelector(\"span\").extent;\n                  \n                  extentEl.setAttribute(\"data-moving\",\"\");\n                  layerEl.insertAdjacentElement(\"beforeend\", extentEl);\n                  extentEl.removeAttribute(\"data-moving\");\n    \n                  extentEl.extentZIndex = zIndex;\n                  extentEl.templatedLayer.setZIndex(zIndex);\n                  zIndex++;\n                }\n                controls.classList.remove(\"mapml-draggable\");\n                document.body.ontouchmove = document.body.onmousemove = document.body.ontouchend = document.body.onmouseup = null;\n              };\n            }\n          };\n          return extent;\n      },\n\n      getLayerUserControlsHTML: function () {\n        var fieldset = L.DomUtil.create('fieldset', 'mapml-layer-item'),\n          input = L.DomUtil.create('input'),\n          layerItemName = L.DomUtil.create('span', 'mapml-layer-item-name'),\n          settingsButtonNameIcon = L.DomUtil.create('span'),\n          layerItemProperty = L.DomUtil.create('div', 'mapml-layer-item-properties', fieldset),\n          layerItemSettings = L.DomUtil.create('div', 'mapml-layer-item-settings', fieldset),\n          itemToggleLabel = L.DomUtil.create('label', 'mapml-layer-item-toggle', layerItemProperty),\n          layerItemControls = L.DomUtil.create('div', 'mapml-layer-item-controls', layerItemProperty),\n          opacityControl = L.DomUtil.create('details', 'mapml-layer-item-opacity mapml-control-layers', layerItemSettings),\n          opacity = L.DomUtil.create('input'),\n          opacityControlSummary = L.DomUtil.create('summary'),\n          svgSettingsControlIcon = L.SVG.create('svg'),\n          settingsControlPath1 = L.SVG.create('path'),\n          settingsControlPath2 = L.SVG.create('path'),\n          extentsFieldset = L.DomUtil.create('fieldset', 'mapml-layer-grouped-extents'),\n          mapEl = this._layerEl.parentNode;\n          this.opacityEl = opacity;\n          this._mapmlLayerItem = fieldset;\n\n          // append the paths in svg for the remove layer and toggle icons\n          svgSettingsControlIcon.setAttribute('viewBox', '0 0 24 24');\n          svgSettingsControlIcon.setAttribute('height', '22');\n          svgSettingsControlIcon.setAttribute('width', '22');\n          svgSettingsControlIcon.setAttribute('fill', 'currentColor');\n          settingsControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n          settingsControlPath1.setAttribute('fill', 'none');\n          settingsControlPath2.setAttribute('d', 'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z');\n          svgSettingsControlIcon.appendChild(settingsControlPath1);\n          svgSettingsControlIcon.appendChild(settingsControlPath2);\n          \n          layerItemSettings.hidden = true;\n          settingsButtonNameIcon.setAttribute('aria-hidden', true);\n          \n          let removeControlButton = L.DomUtil.create('button', 'mapml-layer-item-remove-control', layerItemControls);\n          removeControlButton.type = 'button';\n          removeControlButton.title = 'Remove Layer';\n          removeControlButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n          removeControlButton.classList.add('mapml-button');\n          //L.DomEvent.disableClickPropagation(removeControlButton);\n          L.DomEvent.on(removeControlButton, 'click', L.DomEvent.stop);\n          L.DomEvent.on(removeControlButton, 'click', (e)=>{\n            let fieldset = 0, elem, root;\n            root = mapEl.tagName === \"MAPML-VIEWER\" ? mapEl.shadowRoot : mapEl.querySelector(\".mapml-web-map\").shadowRoot;\n            if(e.target.closest(\"fieldset\").nextElementSibling && !e.target.closest(\"fieldset\").nextElementSibling.disbaled){\n              elem = e.target.closest(\"fieldset\").previousElementSibling;\n              while(elem){\n                fieldset += 2; // find the next layer menu item\n                elem = elem.previousElementSibling;\n              }\n            } else {\n              // focus on the link\n              elem = \"link\";\n            }\n            mapEl.removeChild(e.target.closest(\"fieldset\").querySelector(\"span\").layer._layerEl);\n            elem = elem ? root.querySelector(\".leaflet-control-attribution\").firstElementChild: elem = root.querySelectorAll('input')[fieldset];\n            elem.focus();\n          }, this);\n\n          let itemSettingControlButton = L.DomUtil.create('button', 'mapml-layer-item-settings-control', layerItemControls);\n          itemSettingControlButton.type = 'button';\n          itemSettingControlButton.title = 'Layer Settings';\n          itemSettingControlButton.setAttribute('aria-expanded', false);\n          itemSettingControlButton.classList.add('mapml-button');\n          L.DomEvent.on(itemSettingControlButton, 'click', (e)=>{\n            let layerControl = this._layerEl._layerControl._container;\n            if(!layerControl._isExpanded && e.pointerType === 'touch') {\n              layerControl._isExpanded = true;\n              return;\n            }\n            if(layerItemSettings.hidden === true){\n              itemSettingControlButton.setAttribute('aria-expanded', true);\n              layerItemSettings.hidden = false;\n            } else {\n              itemSettingControlButton.setAttribute('aria-expanded', false);\n              layerItemSettings.hidden = true;\n            }\n          }, this);\n\n          input.defaultChecked = this._map ? true: false;\n          input.type = 'checkbox';\n          input.setAttribute('class','leaflet-control-layers-selector');\n          layerItemName.layer = this;\n\n          if (this._legendUrl) {\n            var legendLink = document.createElement('a');\n            legendLink.text = ' ' + this._title;\n            legendLink.href = this._legendUrl;\n            legendLink.target = '_blank';\n            legendLink.draggable = false;\n            layerItemName.appendChild(legendLink);\n          } else {\n            layerItemName.innerHTML = this._title;\n          }\n          layerItemName.id = 'mapml-layer-item-name-{' + L.stamp(layerItemName) + '}';\n          opacityControlSummary.innerText = 'Opacity';\n          opacityControlSummary.id = 'mapml-layer-item-opacity-' + L.stamp(opacityControlSummary);\n          opacityControl.appendChild(opacityControlSummary);\n          opacityControl.appendChild(opacity);\n          opacity.setAttribute('type','range');\n          opacity.setAttribute('min', '0');\n          opacity.setAttribute('max','1.0');\n          opacity.setAttribute('value', this._container.style.opacity || '1.0');\n          opacity.setAttribute('step','0.1');\n          opacity.setAttribute('aria-labelledby', opacityControlSummary.id);\n          opacity.value = this._container.style.opacity || '1.0';\n\n          fieldset.setAttribute(\"aria-grabbed\", \"false\");\n          fieldset.setAttribute('aria-labelledby', layerItemName.id);\n\n          fieldset.ontouchstart = fieldset.onmousedown = (downEvent) => {\n            if((downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n                downEvent.target.tagName.toLowerCase() !== 'input') ||\n                downEvent.target.tagName.toLowerCase() === 'label') {\n              downEvent = downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n              let control = fieldset,\n                  controls = fieldset.parentNode,\n                  moving = false, yPos = downEvent.clientY;\n\n              document.body.ontouchmove = document.body.onmousemove = (moveEvent) => {\n                moveEvent.preventDefault();\n                moveEvent = moveEvent instanceof TouchEvent ? moveEvent.touches[0] : moveEvent;\n\n                // Fixes flickering by only moving element when there is enough space\n                let offset = moveEvent.clientY - yPos;\n                moving = Math.abs(offset) > 5 || moving;\n                if( (controls && !moving) || (controls && controls.childElementCount <= 1) || \n                    controls.getBoundingClientRect().top > control.getBoundingClientRect().bottom || \n                    controls.getBoundingClientRect().bottom < control.getBoundingClientRect().top){\n                      return;\n                }\n                \n                controls.classList.add(\"mapml-draggable\");\n                control.style.transform = \"translateY(\"+ offset +\"px)\";\n                control.style.pointerEvents = \"none\";\n\n                let x = moveEvent.clientX, y = moveEvent.clientY,\n                    root = mapEl.tagName === \"MAPML-VIEWER\" ? mapEl.shadowRoot : mapEl.querySelector(\".mapml-web-map\").shadowRoot,\n                    elementAt = root.elementFromPoint(x, y),\n                    swapControl = !elementAt || !elementAt.closest(\"fieldset\") ? control : elementAt.closest(\"fieldset\");\n          \n                swapControl =  Math.abs(offset) <= swapControl.offsetHeight ? control : swapControl;\n                \n                control.setAttribute(\"aria-grabbed\", 'true');\n                control.setAttribute(\"aria-dropeffect\", \"move\");\n                if(swapControl && controls === swapControl.parentNode){\n                  swapControl = swapControl !== control.nextSibling? swapControl : swapControl.nextSibling;\n                  if(control !== swapControl){ \n                    yPos = moveEvent.clientY;\n                    control.style.transform = null;\n                  }\n                  controls.insertBefore(control, swapControl);\n                }\n              };\n\n              document.body.ontouchend = document.body.onmouseup = () => {\n                control.setAttribute(\"aria-grabbed\", \"false\");\n                control.removeAttribute(\"aria-dropeffect\");\n                control.style.pointerEvents = null;\n                control.style.transform = null;\n                let controlsElems = controls.children,\n                    zIndex = 1;\n                for(let c of controlsElems){\n                  let layerEl = c.querySelector(\"span\").layer._layerEl;\n                  \n                  layerEl.setAttribute(\"data-moving\",\"\");\n                  mapEl.insertAdjacentElement(\"beforeend\", layerEl);\n                  layerEl.removeAttribute(\"data-moving\");\n\n                  \n                  layerEl._layer.setZIndex(zIndex);\n                  zIndex++;\n                }\n                controls.classList.remove(\"mapml-draggable\");\n                document.body.ontouchmove = document.body.onmousemove = document.body.onmouseup = null;\n              };\n            }\n          };\n\n          L.DomEvent.on(opacity,'change', this._changeOpacity, this);\n\n          itemToggleLabel.appendChild(input);\n          itemToggleLabel.appendChild(layerItemName);\n          itemSettingControlButton.appendChild(settingsButtonNameIcon);\n          settingsButtonNameIcon.appendChild(svgSettingsControlIcon);\n\n          if (this._styles) {\n            layerItemSettings.appendChild(this._styles);\n          }\n\n          if (this._userInputs) {\n            var frag = document.createDocumentFragment();\n            var templates = this._extent._templateVars;\n            if (templates) {\n              for (var i=0;i<templates.length;i++) {\n                var template = templates[i];\n                for (var j=0;j<template.values.length;j++) {\n                  var mapmlInput = template.values[j],\n                      id = '#'+mapmlInput.getAttribute('id');\n                  // don't add it again if it is referenced > once\n                  if (mapmlInput.tagName.toLowerCase() === 'map-select' && !frag.querySelector(id)) {\n                    // generate a <details><summary></summary><select...></details>\n                    var selectdetails = L.DomUtil.create('details', 'mapml-layer-item-time mapml-control-layers', frag),\n                        selectsummary = L.DomUtil.create('summary'),\n                        selectSummaryLabel = L.DomUtil.create('label');\n                        selectSummaryLabel.innerText = mapmlInput.getAttribute('name');\n                        selectSummaryLabel.setAttribute('for', mapmlInput.getAttribute('id'));\n                        selectsummary.appendChild(selectSummaryLabel);\n                        selectdetails.appendChild(selectsummary);\n                        selectdetails.appendChild(mapmlInput.htmlselect);\n                  }\n                }\n              }\n            }\n            layerItemSettings.appendChild(frag);\n          }\n\n          // if there are extents, add them to the layer control\n          if(this._extent && this._extent._mapExtents) {\n            var allHidden = true;\n            this._layerItemSettingsHTML = layerItemSettings;\n            this._extentGroupAnatomy = extentsFieldset;\n            extentsFieldset.setAttribute('aria-label', 'Sublayers');\n            for(let j=0; j < this._extent._mapExtents.length; j++) {\n              extentsFieldset.appendChild(this._extent._mapExtents[j].extentAnatomy);\n              if(!this._extent._mapExtents[j].hidden) allHidden = false;\n            }\n            if(!allHidden) layerItemSettings.appendChild(extentsFieldset);\n          }\n\n          return this._mapmlLayerItem;\n      },\n      _initialize: function(content) {\n          if (!this._href && !content) {return;}\n          var layer = this;\n          // the this._href (comes from layer@src) should take precedence over \n          // content of the <layer> element, but if no this._href / src is provided\n          // but there *is* child content of the <layer> element (which is copied/\n          // referred to by this._content), we should use that content.\n          if (this._href) {\n              var xhr = new XMLHttpRequest();\n  //            xhr.withCredentials = true;\n              _get(this._href, _processInitialExtent);\n          } else if (content) {\n              // may not set this._extent if it can't be done from the content\n              // (eg a single point) and there's no map to provide a default yet\n              _processInitialExtent.call(this, content);\n          }\n          function _get(url, fCallback  ) {\n              xhr.onreadystatechange = function () { \n                if(this.readyState === this.DONE) {\n                  if (this.status === 400 || \n                      this.status === 404 || \n                      this.status === 500 || \n                      this.status === 406) {\n                      layer.error = true;\n                      layer.fire('extentload', layer, true);\n                      xhr.abort();\n                  }\n                }};\n              xhr.onload = fCallback;\n              xhr.onerror = function () { \n                layer.error = true;\n                layer.fire('extentload', layer, true);\n              };\n              xhr.open(\"GET\", url);\n              xhr.setRequestHeader(\"Accept\",M.mime);\n              xhr.overrideMimeType(\"text/xml\");\n              xhr.send();\n          }\n          function transcribe(element) {\n              var select = document.createElement(\"select\");\n              var elementAttrNames = element.getAttributeNames();\n\n              for(let i = 0; i < elementAttrNames.length; i++){\n                  select.setAttribute(elementAttrNames[i], element.getAttribute(elementAttrNames[i]));\n              }\n\n              var options = element.children;\n\n              for(let i = 0; i < options.length; i++){\n                  var option = document.createElement(\"option\");\n                  var optionAttrNames = options[i].getAttributeNames();\n\n                  for (let j = 0; j < optionAttrNames.length; j++){\n                      option.setAttribute(optionAttrNames[j], options[i].getAttribute(optionAttrNames[j]));\n                  }\n\n                  option.innerHTML = options[i].innerHTML;\n                  select.appendChild(option);\n              }\n              return select;\n          }\n\n          function _initTemplateVars(serverExtent, metaExtent, projection, mapml, base, projectionMatch){\n            var templateVars = [];\n            // set up the URL template and associated inputs (which yield variable values when processed)\n            var tlist = serverExtent.querySelectorAll('map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]'),\n                varNamesRe = (new RegExp('(?:\\{)(.*?)(?:\\})','g')),\n                zoomInput = serverExtent.querySelector('map-input[type=\"zoom\" i]'),\n                includesZoom = false, extentFallback = {};\n\n            extentFallback.zoom = 0;\n            if (metaExtent){\n              let content = M._metaContentToObject(metaExtent.getAttribute(\"content\")), cs;\n              \n              extentFallback.zoom = content.zoom || extentFallback.zoom;\n\n              let metaKeys = Object.keys(content);\n              for(let i =0;i<metaKeys.length;i++){\n                if(!metaKeys[i].includes(\"zoom\")){\n                  cs = M.axisToCS(metaKeys[i].split(\"-\")[2]);\n                  break;\n                }\n              }\n              let axes = M.csToAxes(cs);\n              extentFallback.bounds = M.boundsToPCRSBounds(\n                L.bounds(L.point(+content[`top-left-${axes[0]}`],+content[`top-left-${axes[1]}`]),\n                L.point(+content[`bottom-right-${axes[0]}`],+content[`bottom-right-${axes[1]}`])),\n                extentFallback.zoom, projection, cs);\n              \n            } else {\n              extentFallback.bounds = M[projection].options.crs.pcrs.bounds;\n            }\n              \n            for (var i=0;i< tlist.length;i++) {\n              var t = tlist[i], template = t.getAttribute('tref');\n              t.zoomInput = zoomInput;\n              if(!template){\n                template = BLANK_TT_TREF;\n                let blankInputs = mapml.querySelectorAll('map-input');\n                for (let i of blankInputs){\n                  template += `{${i.getAttribute(\"name\")}}`;\n                }\n              }\n              \n              var v,\n                  title = t.hasAttribute('title') ? t.getAttribute('title') : 'Query this layer',\n                  vcount=template.match(varNamesRe),\n                  trel = (!t.hasAttribute('rel') || t.getAttribute('rel').toLowerCase() === 'tile') ? 'tile' : t.getAttribute('rel').toLowerCase(),\n                  ttype = (!t.hasAttribute('type')? 'image/*':t.getAttribute('type').toLowerCase()),\n                  inputs = [],\n                  tms = t && t.hasAttribute(\"tms\");\n                  var zoomBounds = mapml.querySelector('map-meta[name=zoom]')?\n                                    M._metaContentToObject(mapml.querySelector('map-meta[name=zoom]').getAttribute('content')):\n                                    undefined;\n              while ((v = varNamesRe.exec(template)) !== null) {\n                var varName = v[1],\n                    inp = serverExtent.querySelector('map-input[name='+varName+'],map-select[name='+varName+']');\n                if (inp) {\n                  \n                  if ((inp.hasAttribute(\"type\") && inp.getAttribute(\"type\")===\"location\") && \n                      (!inp.hasAttribute(\"min\") || !inp.hasAttribute(\"max\")) && \n                      (inp.hasAttribute(\"axis\") && ![\"i\",\"j\"].includes(inp.getAttribute(\"axis\").toLowerCase()))){\n                    if (zoomInput && template.includes(`{${zoomInput.getAttribute('name')}}`)) {\n                      zoomInput.setAttribute(\"value\", extentFallback.zoom);\n                    }\n                    let axis = inp.getAttribute(\"axis\"), \n                        axisBounds = M.convertPCRSBounds(extentFallback.bounds, extentFallback.zoom, projection, M.axisToCS(axis));\n                    inp.setAttribute(\"min\", axisBounds.min[M.axisToXY(axis)]);\n                    inp.setAttribute(\"max\", axisBounds.max[M.axisToXY(axis)]);\n                  }\n\n                  inputs.push(inp);\n                  includesZoom = includesZoom || inp.hasAttribute(\"type\") && inp.getAttribute(\"type\").toLowerCase() === \"zoom\";\n                  if (inp.tagName.toLowerCase() === 'map-select') {\n                    // use a throwaway div to parse the input from MapML into HTML\n                    var div =document.createElement(\"div\");\n                    div.insertAdjacentHTML(\"afterbegin\",inp.outerHTML);\n                    // parse\n                    inp.htmlselect = div.querySelector(\"map-select\");\n                    inp.htmlselect = transcribe(inp.htmlselect);\n\n                    // this goes into the layer control, so add a listener\n                    L.DomEvent.on(inp.htmlselect, 'change', layer.redraw, layer);\n                    if (!layer._userInputs) {\n                      layer._userInputs = [];\n                    }\n                    layer._userInputs.push(inp.htmlselect);\n                  }\n                  // TODO: if this is an input@type=location \n                  // get the TCRS min,max attribute values at the identified zoom level \n                  // save this information as properties of the serverExtent,\n                  // perhaps as a bounds object so that it can be easily used\n                  // later by the layer control to determine when to enable\n                  // disable the layer for drawing.\n                } else {\n                  console.log('input with name='+varName+' not found for template variable of same name');\n                  // no match found, template won't be used\n                  break;\n                }\n              }\n              if (template && vcount.length === inputs.length || template === BLANK_TT_TREF) {\n                if (trel === 'query') {\n                  layer.queryable = true;\n                }\n                if(!includesZoom && zoomInput) {\n                  inputs.push(zoomInput);\n                }\n                let step = zoomInput ? zoomInput.getAttribute(\"step\") : 1;\n                if(!step || step === \"0\" || isNaN(step)) step = 1;\n                // template has a matching input for every variable reference {varref}\n                templateVars.push({\n                  template:decodeURI(new URL(template, base)), \n                  linkEl: t,\n                  title:title, \n                  rel: trel, \n                  type: ttype, \n                  values: inputs, \n                  zoomBounds:zoomBounds,\n                  extentPCRSFallback: {bounds: extentFallback.bounds}, \n                  projectionMatch: projectionMatch,\n                  projection:serverExtent.getAttribute(\"units\") || FALLBACK_PROJECTION,\n                  tms:tms,\n                  step:step,\n                });\n              }\n            }\n            return templateVars;\n          }\n\n          function _processInitialExtent(content) {\n            //TODO: include inline extents\n              var mapml = this.responseXML || content;\n              if(mapml.querySelector && mapml.querySelector('map-feature'))layer._content = mapml;\n              if(!this.responseXML && this.responseText) mapml = new DOMParser().parseFromString(this.responseText,'text/xml');\n              if (this.readyState === this.DONE && mapml.querySelector && !mapml.querySelector(\"parsererror\")) {\n                  var serverExtent = mapml.querySelectorAll('map-extent'), projection, projectionMatch, serverMeta;\n                      \n                  \n                  if(!serverExtent.length){\n                    serverMeta = mapml.querySelector('map-meta[name=projection]');\n                  }\n\n                  // check whether all map-extent elements have the same units\n                  if(serverExtent.length >= 1){\n                    for(let i = 0; i < serverExtent.length; i++){\n                      if (serverExtent[i].tagName.toLowerCase() === \"map-extent\" && serverExtent[i].hasAttribute('units')){\n                        projection = serverExtent[i].getAttribute(\"units\");\n                      }\n                      projectionMatch = projection && projection === layer.options.mapprojection;\n                      if(!projectionMatch){\n                        break;\n                      }\n                    }\n                  } else if(serverMeta){\n                    if (serverMeta.tagName.toLowerCase() === \"map-meta\" && serverMeta.hasAttribute('content')) {\n                      projection = M._metaContentToObject(serverMeta.getAttribute('content')).content;\n                      projectionMatch = projection && projection === layer.options.mapprojection;\n                    }\n                  }  \n                  \n                  var metaExtent = mapml.querySelector('map-meta[name=extent]'),\n                      selectedAlternate = !projectionMatch && mapml.querySelector('map-head map-link[rel=alternate][projection='+layer.options.mapprojection+']'),\n                      \n                      base = \n        (new URL(mapml.querySelector('map-base') ? mapml.querySelector('map-base').getAttribute('href') : mapml.baseURI || this.responseURL, this.responseURL)).href;\n                  \n                  if (!projectionMatch && selectedAlternate && selectedAlternate.hasAttribute('href')) {\n                       \n                      layer.fire('changeprojection', {href:  (new URL(selectedAlternate.getAttribute('href'), base)).href}, false);\n                      return;\n                  } else if (!projectionMatch && layer._map && layer._map.options.mapEl.querySelectorAll(\"layer-\").length === 1){\n                    layer._map.options.mapEl.projection = projection;\n                    return;\n                  } else if (!serverMeta){\n                    layer._extent = {};\n                    if(projectionMatch){\n                      layer._extent.crs = M[projection];\n                    }\n                    layer._extent._mapExtents = []; // stores all the map-extent elements in the layer\n                    layer._extent._templateVars = []; // stores all template variables coming from all extents\n                    for(let j = 0; j < serverExtent.length; j++){\n                      if (serverExtent[j].querySelector('map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]') &&\n                          serverExtent[j].hasAttribute(\"units\")) {\n                            layer._extent._mapExtents.push(serverExtent[j]);\n                            projectionMatch = projectionMatch || selectedAlternate;\n                            let templateVars = _initTemplateVars.call(layer, serverExtent[j], metaExtent, projection, mapml, base, projectionMatch);\n                            layer._extent._mapExtents[j]._templateVars = templateVars;\n                            layer._extent._templateVars = layer._extent._templateVars.concat(templateVars);\n                          } \n                        }     \n                  } else {\n                    layer._extent = serverMeta;\n                  }  \n                  layer._parseLicenseAndLegend(mapml, layer, projection);\n\n                  var zoomin = mapml.querySelector('map-link[rel=zoomin]'),\n                      zoomout = mapml.querySelector('map-link[rel=zoomout]');\n                  delete layer._extent.zoomin;\n                  delete layer._extent.zoomout;\n                  if (zoomin) {\n                    layer._extent.zoomin = (new URL(zoomin.getAttribute('href'), base)).href;\n                  }\n                  if (zoomout) {\n                    layer._extent.zoomout = (new URL(zoomout.getAttribute('href'), base)).href;\n                  }\n                  if (layer._extent._mapExtents) {\n                    for(let i = 0; i < layer._extent._mapExtents.length; i++){\n                      if(layer._extent._mapExtents[i].templatedLayer){\n                        layer._extent._mapExtents[i].templatedLayer.reset(layer._extent._mapExtents[i]._templateVars, layer._extent._mapExtents[i].extentZIndex);\n                      }\n                    }\n                    \n                  }\n                  if (mapml.querySelector('map-tile')) {\n                    var tiles = document.createElement(\"map-tiles\"),\n                      zoom = mapml.querySelector('map-meta[name=zoom][content]') || mapml.querySelector('map-input[type=zoom][value]');\n                    tiles.setAttribute(\"zoom\", zoom && zoom.getAttribute('content') || zoom && zoom.getAttribute('value') || \"0\");\n                    var newTiles = mapml.getElementsByTagName('map-tile');\n                    for (var nt=0;nt<newTiles.length;nt++) {\n                        tiles.appendChild(document.importNode(newTiles[nt], true));\n                    }\n                    layer._mapmlTileContainer.appendChild(tiles);\n                  }\n                  M._parseStylesheetAsHTML(mapml, base, layer._container);\n\n                  // add multiple extents\n                  if(layer._extent._mapExtents){\n                    for(let j = 0; j < layer._extent._mapExtents.length; j++){\n                      var labelName = layer._extent._mapExtents[j].getAttribute('label');\n                      var extentElement = layer.getLayerExtentHTML(labelName, j);\n                      layer._extent._mapExtents[j].extentAnatomy = extentElement;\n                    }\n                  }\n\n                  var styleLinks = mapml.querySelectorAll('map-link[rel=style],map-link[rel=\"self style\"],map-link[rel=\"style self\"]');\n                  if (styleLinks.length > 1) {\n                    var stylesControl = document.createElement('details'),\n                    stylesControlSummary = document.createElement('summary');\n                    stylesControlSummary.innerText = 'Style';\n                    stylesControl.appendChild(stylesControlSummary);\n                    var changeStyle = function (e) {\n                        layer.fire('changestyle', {src: e.target.getAttribute(\"data-href\")}, false);\n                    };\n\n                    for (var j=0;j<styleLinks.length;j++) {\n                      var styleOption = document.createElement('div'),\n                      styleOptionInput = styleOption.appendChild(document.createElement('input'));\n                      styleOptionInput.setAttribute(\"type\", \"radio\");\n                      styleOptionInput.setAttribute(\"id\", \"rad-\"+L.stamp(styleOptionInput));\n                      styleOptionInput.setAttribute(\"name\", \"styles-\"+this._title);\n                      styleOptionInput.setAttribute(\"value\", styleLinks[j].getAttribute('title'));\n                      styleOptionInput.setAttribute(\"data-href\", new URL(styleLinks[j].getAttribute('href'),base).href);\n                      var styleOptionLabel = styleOption.appendChild(document.createElement('label'));\n                      styleOptionLabel.setAttribute(\"for\", \"rad-\"+L.stamp(styleOptionInput));\n                      styleOptionLabel.innerText = styleLinks[j].getAttribute('title');\n                      if (styleLinks[j].getAttribute(\"rel\") === \"style self\" || styleLinks[j].getAttribute(\"rel\") === \"self style\") {\n                        styleOptionInput.checked = true;\n                      }\n                      stylesControl.appendChild(styleOption);\n                      L.DomUtil.addClass(stylesControl,'mapml-layer-item-style mapml-control-layers');\n                      L.DomEvent.on(styleOptionInput,'click', changeStyle, layer);\n                    }\n                    layer._styles = stylesControl;\n                  }\n                  \n                  if (mapml.querySelector('map-title')) {\n                    layer._title = mapml.querySelector('map-title').textContent.trim();\n                  } else if (mapml instanceof Element && mapml.hasAttribute('label')) {\n                    layer._title = mapml.getAttribute('label').trim();\n                  }\n                  if (layer._map) {\n                      layer._validateExtent();\n                      // if the layer is checked in the layer control, force the addition\n                      // of the attribution just received\n                      if (layer._map.hasLayer(layer)) {\n                          layer._map.attributionControl.addAttribution(layer.getAttribution());\n                      }\n                      //layer._map.fire('moveend', layer);\n                  }\n              } else {\n                  layer.error = true;\n              }\n              if (this.responseXML) {\n                _attachToLayer.call(layer);\n              }\n              layer.fire('extentload', layer, false);\n              // update controls if needed based on mapml-viewer controls/controlslist attribute\n              if (layer._layerEl.parentElement) {\n                // if layer does not have a parent Element, do not need to set Controls\n                layer._layerEl.parentElement._toggleControls();\n              }\n              layer._layerEl.dispatchEvent(new CustomEvent('extentload', {detail: layer,}));\n            }\n\n            function _attachToLayer() {\n              let mapml = xhr.responseXML,\n                  shadowRoot = this._layerEl.shadowRoot;\n              if (mapml) {\n                let elements = mapml.children[0].children[1].children;\n                if (elements) {\n                  let baseURL = mapml.children[0].children[0].querySelector('map-base')?.getAttribute('href');\n                  for (let el of elements) {\n                    // if not clone, the elements will be **REMOVED** from mapml file and re-attached to the layer's shadow root\n                    // which makes the this._content (mapml file) changed and thus affects the later generation process of this._mapmlvectors\n                    let node = el.cloneNode(true);\n                    el._DOMnode = node;\n                    // resolve relative url\n                    if (node.nodeName === 'map-link') {\n                      let url = node.getAttribute('href') || node.getAttribute('tref');\n                      // if relative\n                      if (url && (url.indexOf('http://') === 0 || url.indexOf('https://') === 0)) {\n                        let resolvedURL = baseURL + url;\n                        if (node.hasAttribute('href')) {\n                          node.setAttribute('href', resolvedURL);\n                        } else {\n                          node.setAttribute('tref', resolvedURL);\n                        }\n                      }   \n                    }\n                    shadowRoot.appendChild(node);\n                  }\n                }\n              }\n            }\n      },\n      _validateExtent: function () {\n        // TODO: change so that the _extent bounds are set based on inputs\n        if(!this._extent || !this._map){\n          return;\n        }\n        var serverExtent = this._extent._mapExtents ? this._extent._mapExtents : [this._extent], lp;\n          \n          // loop through the map-extent elements and assign each one its crs\n          for(let i = 0; i < serverExtent.length; i++){\n            if (!serverExtent[i].querySelector) {\n              return;\n            }\n          if (serverExtent[i].querySelector('[type=zoom][min=\"\"], [type=zoom][max=\"\"]')) {\n              var zoom = serverExtent[i].querySelector('[type=zoom]');\n              zoom.setAttribute('min',this._map.getMinZoom());\n              zoom.setAttribute('max',this._map.getMaxZoom());\n          }\n            lp = serverExtent[i].hasAttribute(\"units\") ? serverExtent[i].getAttribute(\"units\") : null;\n            if (lp && M[lp]) {\n              if(this._extent._mapExtents) this._extent._mapExtents[i].crs = M[lp];\n              else this._extent.crs = M[lp];\n            } else {\n              if(this._extent._mapExtents) this._extent._mapExtents[i].crs = M.OSMTILE;\n              else this._extent.crs = M.OSMTILE;\n            }\n          }\n      },\n      // a layer must share a projection with the map so that all the layers can\n      // be overlayed in one coordinate space.  WGS84 is a 'wildcard', sort of.\n      getProjection: function () {\n        if(!this._extent) { return; }\n        let extent = this._extent._mapExtents ? this._extent._mapExtents[0] : this._extent; // the projections for each extent eould be the same (as) validated in _validProjection, so can use mapExtents[0]\n        if(!extent) return FALLBACK_PROJECTION;\n        switch (extent.tagName.toUpperCase()) {\n          case \"MAP-EXTENT\":\n            if(extent.hasAttribute('units'))\n              return extent.getAttribute('units').toUpperCase();\n            break;\n          case \"MAP-INPUT\":\n            if(extent.hasAttribute('value'))\n              return extent.getAttribute('value').toUpperCase();\n            break;\n          case \"MAP-META\":\n            if(extent.hasAttribute('content'))\n              return M._metaContentToObject(extent.getAttribute('content')).content.toUpperCase(); \n            break;\n          default:\n            return FALLBACK_PROJECTION; \n        }\n        return FALLBACK_PROJECTION;\n      },\n      _parseLicenseAndLegend: function (xml, layer) {\n          var licenseLink =  xml.querySelector('map-link[rel=license]'), licenseTitle, licenseUrl, attText;\n          if (licenseLink) {\n              licenseTitle = licenseLink.getAttribute('title');\n              licenseUrl = licenseLink.getAttribute('href');\n              attText = '<a href=\"' + licenseUrl + '\" title=\"'+licenseTitle+'\">'+licenseTitle+'</a>';\n          }\n          L.setOptions(layer,{attribution:attText});\n          var legendLink = xml.querySelector('map-link[rel=legend]');\n          if (legendLink) {\n            layer._legendUrl = legendLink.getAttribute('href');\n          }\n      },\n      getQueryTemplates: function(pcrsClick) {\n          if (this._extent && this._extent._queries) {\n            var templates = [];\n            // only return queries that are in bounds\n            if (this._layerEl.checked && !this._layerEl.hidden && this._mapmlLayerItem) {\n              let layerAndExtents = this._mapmlLayerItem.querySelectorAll(\".mapml-layer-item-name\");\n              for(let i = 0; i < layerAndExtents.length; i++){\n                if (layerAndExtents[i].extent || this._extent._mapExtents.length === 1) { // the layer won't have an .extent property, this is kind of a hack\n                  let extent = layerAndExtents[i].extent || this._extent._mapExtents[0];\n                  for (let j = 0; j < extent._templateVars.length; j++) {\n                    if (extent.checked) {\n                      let template = extent._templateVars[j];\n                      // for each template in the extent, see if it corresponds to one in the this._extent._queries array\n                      for (let k = 0; k < this._extent._queries.length; k++) {\n                        let queryTemplate = this._extent._queries[k];\n                        if (template === queryTemplate && queryTemplate.extentBounds.contains(pcrsClick)) {\n                          templates.push(queryTemplate);\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              return templates;\n            }\n          }\n      },\n      _attachSkipButtons: function(e){\n        let popup = e.popup, map = e.target, layer, group,\n            content = popup._container.getElementsByClassName(\"mapml-popup-content\")[0];\n\n        popup._container.setAttribute(\"role\", \"dialog\");\n        content.setAttribute(\"tabindex\", \"-1\");\n        // https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/467#issuecomment-844307818\n        content.setAttribute(\"role\", \"document\");\n        popup._count = 0; // used for feature pagination\n\n        if(popup._source._eventParents){ // check if the popup is for a feature or query\n          layer = popup._source._eventParents[Object.keys(popup._source._eventParents)[0]]; // get first parent of feature, there should only be one\n          group = popup._source.group;\n          // if the popup is for a static / templated feature, the \"zoom to here\" link can be attached once the popup opens\n          attachZoomLink.call(popup);\n        } else {\n          layer = popup._source._templatedLayer;\n          // if the popup is for a query, the \"zoom to here\" link should be re-attached every time new pagination features are displayed\n          map.on(\"attachZoomLink\", attachZoomLink, popup);\n        }\n\n        if(popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')){\n          L.DomUtil.remove(popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]'));\n          L.DomUtil.remove(popup._container.querySelector('hr'));\n        }\n        //add when popopen event happens instead\n        let div = L.DomUtil.create(\"nav\", \"mapml-focus-buttons\");\n\n        // creates |< button, focuses map\n        let mapFocusButton = L.DomUtil.create(\"button\", \"mapml-popup-button\", div);\n        mapFocusButton.type = \"button\";\n        mapFocusButton.title = \"Focus Map\";\n        mapFocusButton.innerHTML = \"<span aria-hidden='true'>|&#10094;</span>\";\n        L.DomEvent.on(mapFocusButton, 'click', (e)=>{\n          L.DomEvent.stop(e);\n          map.featureIndex._sortIndex();\n          map.closePopup();\n          map._container.focus();\n        }, popup);\n\n        // creates < button, focuses previous feature, if none exists focuses the current feature\n        let previousButton = L.DomUtil.create(\"button\", \"mapml-popup-button\", div);\n        previousButton.type = \"button\";\n        previousButton.title = \"Previous Feature\";\n        previousButton.innerHTML = \"<span aria-hidden='true'>&#10094;</span>\";\n        L.DomEvent.on(previousButton, 'click', layer._previousFeature, popup);\n\n        // static feature counter that 1/1\n        let featureCount = L.DomUtil.create(\"p\", \"mapml-feature-count\", div),\n            totalFeatures = this._totalFeatureCount ? this._totalFeatureCount : 1;\n        featureCount.innerText = (popup._count + 1)+\"/\"+totalFeatures;\n\n        // creates > button, focuses next feature, if none exists focuses the current feature\n        let nextButton = L.DomUtil.create(\"button\", \"mapml-popup-button\", div);\n        nextButton.type = \"button\";\n        nextButton.title = \"Next Feature\";\n        nextButton.innerHTML = \"<span aria-hidden='true'>&#10095;</span>\";\n        L.DomEvent.on(nextButton, 'click', layer._nextFeature, popup);\n        \n        // creates >| button, focuses map controls\n        let controlFocusButton = L.DomUtil.create(\"button\", \"mapml-popup-button\", div);\n        controlFocusButton.type = \"button\";\n        controlFocusButton.title = \"Focus Controls\";\n        controlFocusButton.innerHTML = \"<span aria-hidden='true'>&#10095;|</span>\";\n        L.DomEvent.on(controlFocusButton, 'click', (e) => {\n          map.featureIndex._sortIndex();\n          map.featureIndex.currentIndex = map.featureIndex.inBoundFeatures.length - 1;\n          map.featureIndex.inBoundFeatures[0].path.setAttribute(\"tabindex\", -1);\n          map.featureIndex.inBoundFeatures[map.featureIndex.currentIndex].path.setAttribute(\"tabindex\", 0);\n          L.DomEvent.stop(e);\n          map.closePopup();\n          map._controlContainer.querySelector(\"A:not([hidden])\").focus();\n        }, popup);\n    \n        let divider = L.DomUtil.create(\"hr\", \"mapml-popup-divider\");\n\n        popup._navigationBar = div;\n        popup._content.appendChild(divider);\n        popup._content.appendChild(div);\n        \n        content.focus();\n\n        if(group && !M.options.featureIndexOverlayOption) {\n          // e.target = this._map\n          // Looks for keydown, more specifically tab and shift tab\n          group.setAttribute(\"aria-expanded\", \"true\");\n          map.on(\"keydown\", focusFeature);\n        } else {\n          map.on(\"keydown\", focusMap);\n        }\n        // When popup is open, what gets focused with tab needs to be done using JS as the DOM order is not in an accessibility friendly manner\n        function focusFeature(focusEvent){\n          let path = focusEvent.originalEvent.path || focusEvent.originalEvent.composedPath();\n          let isTab = focusEvent.originalEvent.keyCode === 9,\n              shiftPressed = focusEvent.originalEvent.shiftKey;\n          if ((path[0].classList.contains(\"leaflet-popup-close-button\") && isTab && !shiftPressed) || \n            focusEvent.originalEvent.keyCode === 27 || \n            path[0].classList.contains(\"leaflet-popup-close-button\") && focusEvent.originalEvent.keyCode === 13){\n            setTimeout(() => {\n              map.closePopup(popup);\n              group.focus();\n              L.DomEvent.stop(focusEvent);\n            }, 0);\n          } else if (path[0].classList.contains(\"mapml-popup-content\") && isTab && shiftPressed){\n            setTimeout(() => { //timeout needed so focus of the feature is done even after the keypressup event occurs\n              map.closePopup(popup);\n              group.focus();\n              L.DomEvent.stop(focusEvent);\n            }, 0);\n          } else if (path[0] === popup._content.querySelector('a') && isTab && shiftPressed) {\n            setTimeout(() => {\n              map.closePopup(popup);\n              group.focus();\n              L.DomEvent.stop(focusEvent);\n            }, 0);\n          }\n        }\n\n        function focusMap(focusEvent){\n          let path = focusEvent.originalEvent.path || focusEvent.originalEvent.composedPath();\n          let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n\n          if((focusEvent.originalEvent.keyCode === 13 && path[0].classList.contains(\"leaflet-popup-close-button\")) || focusEvent.originalEvent.keyCode === 27 ){\n            L.DomEvent.stopPropagation(focusEvent);\n            map.closePopup(popup);\n            map._container.focus();\n            if(focusEvent.originalEvent.keyCode !== 27)map._popupClosed = true;\n          } else if (isTab && path[0].classList.contains(\"leaflet-popup-close-button\")){\n            map.closePopup(popup);\n          } else if (path[0].classList.contains(\"mapml-popup-content\") && isTab && shiftPressed){\n            map.closePopup(popup);\n            setTimeout(() => { //timeout needed so focus of the feature is done even after the keypressup event occurs\n              L.DomEvent.stop(focusEvent);\n              map._container.focus();\n            }, 0);\n          } else if (path[0] === popup._content.querySelector('a') && isTab && shiftPressed) {\n            map.closePopup(popup);\n            setTimeout(() => {\n              L.DomEvent.stop(focusEvent);\n              map._container.focus();\n            }, 0);\n          }\n        }\n\n        function attachZoomLink (e) {\n          // this === popup\n          let content = this._content,\n              featureEl = e ? e.currFeature : this._source._groupLayer._featureEl;\n          if (content.querySelector('a.mapml-zoom-link')) {\n            content.querySelector('a.mapml-zoom-link').remove();\n          }\n          if (!featureEl.querySelector('map-geometry')) return;\n          let tL = featureEl.extent.topLeft.gcrs,\n              bR = featureEl.extent.bottomRight.gcrs,\n              center = L.latLngBounds(L.latLng(tL.horizontal, tL.vertical), L.latLng(bR.horizontal, bR.vertical)).getCenter(true);\n          let zoomLink = document.createElement('a');\n          zoomLink.href = `#${featureEl.getMaxZoom()},${center.lng},${center.lat}`;\n          zoomLink.innerHTML = `${M.options.locale.popupZoom}`;\n          zoomLink.className = \"mapml-zoom-link\";\n          zoomLink.onclick = zoomLink.onkeydown = function (e) {\n            if (!(e instanceof MouseEvent) && e.keyCode !== 13) return;\n            e.preventDefault();\n            featureEl.zoomTo();\n          };\n          content.insertBefore(zoomLink, content.querySelector('hr.mapml-popup-divider'));\n        }\n\n        // if popup closes then the focusFeature handler can be removed\n        map.on(\"popupclose\", removeHandlers);\n        function removeHandlers(removeEvent){\n          if (removeEvent.popup === popup){\n            map.off(\"keydown\", focusFeature);\n            map.off(\"keydown\", focusMap);\n            map.off(\"popupopen\", attachZoomLink);\n            map.off('popupclose', removeHandlers);\n            if(group) group.setAttribute(\"aria-expanded\", \"false\");\n          }\n        }\n      },\n  });\n  var mapMLLayer = function (url, node, options) {\n    if (!url && !node) return null;\n  \treturn new MapMLLayer(url, node, options);\n  };\n\n  var DebugOverlay = L.Layer.extend({\n\n    onAdd: function (map) {\n\n      let mapSize = map.getSize();\n\n      //conditionally show container for debug panel/banner only when the map has enough space for it\n      if (mapSize.x > 400 || mapSize.y > 300) {\n        this._container = L.DomUtil.create(\"table\", \"mapml-debug\", map._container);\n\n        this._panel = debugPanel({\n          className: \"mapml-debug-panel\",\n          pane: this._container,\n        });\n        map.addLayer(this._panel);\n\n      }\n\n      this._grid = debugGrid({\n        className: \"mapml-debug-grid\",\n        pane: map._panes.mapPane,\n        zIndex: 400,\n        tileSize: map.options.crs.options.crs.tile.bounds.max.x,\n      });\n      map.addLayer(this._grid);\n\n      this._vectors = debugVectors({\n        className: \"mapml-debug-vectors\",\n        pane: map._panes.mapPane,\n        toolPane: this._container,\n      });\n      map.addLayer(this._vectors);\n    },\n\n    onRemove: function (map) {\n      map.removeLayer(this._grid);\n      map.removeLayer(this._vectors);\n      if (this._panel) {  //conditionally remove the panel, as it's not always added\n        map.removeLayer(this._panel);\n        L.DomUtil.remove(this._container);\n      }\n    },\n\n  });\n\n  var debugOverlay = function () {\n    return new DebugOverlay();\n  };\n\n  var DebugPanel = L.Layer.extend({\n\n    initialize: function (options) {\n      L.setOptions(this, options);\n    },\n\n    onAdd: function (map) {\n\n      this._title = L.DomUtil.create(\"caption\", \"mapml-debug-banner\", this.options.pane);\n      this._title.innerHTML = \"Debug mode\";\n\n      map.debug = {};\n      map.debug._infoContainer = this._debugContainer = L.DomUtil.create(\"tbody\", \"mapml-debug-panel\", this.options.pane);\n\n      let infoContainer = map.debug._infoContainer;\n\n      map.debug._tileCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._tileMatrixCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._mapCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._tcrsCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._pcrsCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n      map.debug._gcrsCoord = L.DomUtil.create(\"tr\", \"mapml-debug-coordinates\", infoContainer);\n\n      this._map.on(\"mousemove\", this._updateCoords);\n\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._title);\n      if (this._debugContainer) {\n        L.DomUtil.remove(this._debugContainer);\n        this._map.off(\"mousemove\", this._updateCoords);\n      }\n    },\n    _updateCoords: function (e) {\n      if (this.contextMenu._visible) return;\n      let mapEl = this.options.mapEl,\n        point = mapEl._map.project(e.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointI = point.x % tileSize, pointJ = point.y % tileSize;\n\n      if (pointI < 0) pointI += tileSize;\n      if (pointJ < 0) pointJ += tileSize;\n\n      this.debug._tileCoord.innerHTML = `\n      <th scope=\"row\">tile: </th>\n      <td>i: ${Math.trunc(pointI)}, </td>\n      <td>j: ${Math.trunc(pointJ)}</td>\n      `;\n      this.debug._mapCoord.innerHTML = `\n      <th scope=\"row\">map: </th>\n      <td>i: ${Math.trunc(e.containerPoint.x)}, </td>\n      <td>j: ${Math.trunc(e.containerPoint.y)}</td>\n      `;\n      this.debug._gcrsCoord.innerHTML = `\n      <th scope=\"row\">gcrs: </th>\n      <td>lon: ${e.latlng.lng.toFixed(6)}, </td>\n      <td>lat: ${e.latlng.lat.toFixed(6)}</td>\n      `;\n      this.debug._tcrsCoord.innerHTML = `\n      <th scope=\"row\">tcrs: </th>\n      <td>x: ${Math.trunc(point.x)}, </td>\n      <td>y: ${Math.trunc(point.y)}</td>\n      `;\n      this.debug._tileMatrixCoord.innerHTML = `\n      <th scope=\"row\">tilematrix: </th>\n      <td>column: ${Math.trunc(point.x / tileSize)}, </td>\n      <td>row: ${Math.trunc(point.y / tileSize)}</td>\n      `;\n      this.debug._pcrsCoord.innerHTML = `\n      <th scope=\"row\">pcrs: </th>\n      <td>easting: ${pcrs.x.toFixed(2)}, </td>\n      <td>northing: ${pcrs.y.toFixed(2)}</td>\n      `;\n    },\n\n  });\n\n  var debugPanel = function (options) {\n    return new DebugPanel(options);\n  };\n\n  var DebugGrid = L.GridLayer.extend({\n\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.GridLayer.prototype.initialize.call(this, this._map);\n    },\n\n    createTile: function (coords) {\n      let tile = L.DomUtil.create(\"div\", \"mapml-debug-tile\");\n      tile.setAttribute(\"col\", coords.x);\n      tile.setAttribute(\"row\", coords.y);\n      tile.setAttribute(\"zoom\", coords.z);\n      tile.innerHTML = [`col: ${coords.x}`, `row: ${coords.y}`, `zoom: ${coords.z}`].join(', ');\n\n      tile.style.outline = '1px dashed red';\n      return tile;\n    },\n  });\n\n  var debugGrid = function (options) {\n    return new DebugGrid(options);\n  };\n\n  var DebugVectors = L.LayerGroup.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.LayerGroup.prototype.initialize.call(this, this._map, options);\n    },\n    onAdd: function (map) {\n      map.on('overlayremove', this._mapLayerUpdate, this);\n      map.on('overlayadd', this._mapLayerUpdate, this);\n      let center = map.options.crs.transformation.transform(L.point(0, 0), map.options.crs.scale(0));\n      this._centerVector = L.circle(map.options.crs.pointToLatLng(center, 0), { radius: 250 });\n      this._centerVector.bindTooltip(\"Projection Center\");\n\n      this._addBounds(map);\n    },\n    onRemove: function (map) {\n      this.clearLayers();\n    },\n\n    _addBounds: function (map) {\n      let id = Object.keys(map._layers),\n        layers = map._layers,\n        colors = [\"#FF5733\", \"#8DFF33\", \"#3397FF\", \"#E433FF\", \"#F3FF33\"],\n        j = 0;\n\n      this.addLayer(this._centerVector);\n\n      for (let i of id) {\n        if (layers[i].layerBounds || layers[i].extentBounds) {\n          let boundsArray;\n          if(layers[i].layerBounds){\n            boundsArray = [\n              layers[i].layerBounds.min,\n              L.point(layers[i].layerBounds.max.x, layers[i].layerBounds.min.y),\n              layers[i].layerBounds.max,\n              L.point(layers[i].layerBounds.min.x, layers[i].layerBounds.max.y)\n            ];\n          } else {\n            boundsArray = [\n              layers[i].extentBounds.min,\n              L.point(layers[i].extentBounds.max.x, layers[i].extentBounds.min.y),\n              layers[i].extentBounds.max,\n              L.point(layers[i].extentBounds.min.x, layers[i].extentBounds.max.y)\n            ];\n          }        \n          let boundsRect = projectedExtent(boundsArray, {\n            color: colors[j % colors.length],\n            weight: 2,\n            opacity: 1,\n            fillOpacity: 0.01,\n            fill: true,\n          });\n          if (layers[i].options._leafletLayer)\n            boundsRect.bindTooltip(layers[i].options._leafletLayer._title, { sticky: true });\n          this.addLayer(boundsRect);\n          j++;\n        }\n      }\n\n      if(map.totalLayerBounds){\n        let totalBoundsArray = [\n          map.totalLayerBounds.min,\n          L.point(map.totalLayerBounds.max.x, map.totalLayerBounds.min.y),\n          map.totalLayerBounds.max,\n          L.point(map.totalLayerBounds.min.x, map.totalLayerBounds.max.y)\n        ];\n\n        let totalBounds = projectedExtent(\n            totalBoundsArray,\n            {color: \"#808080\", weight: 5, opacity: 0.5, fill: false});\n        this.addLayer(totalBounds);\n      }\n    },\n\n    _mapLayerUpdate: function (e) {\n      this.clearLayers();\n      this._addBounds(e.target);\n    },\n  });\n\n  var debugVectors = function (options) {\n    return new DebugVectors(options);\n  };\n\n\n  var ProjectedExtent = L.Path.extend({\n    \n    getCenter: function (round) {\n      let crs = this._map.options.crs;\n      return crs.unproject(L.bounds(this._locations).getCenter());\n    \n    },\n\n    options: {\n      className: \"mapml-debug-extent\",\n    },\n    initialize: function (locations, options) {\n      //locations passed in as pcrs coordinates\n      this._locations = locations;\n      L.setOptions(this, options);\n    },\n\n    _project: function () {\n      this._rings = [];\n      let scale = this._map.options.crs.scale(this._map.getZoom()),\n        map = this._map;\n      for (let i = 0; i < this._locations.length; i++) {\n        let point = map.options.crs.transformation.transform(this._locations[i], scale);\n        //substract the pixel origin from the pixel coordinates to get the location relative to map viewport\n        this._rings.push(L.point(point.x, point.y)._subtract(map.getPixelOrigin()));\n      }\n      //leaflet SVG renderer looks for and array of arrays to build polygons,\n      //in this case it only deals with a rectangle so one closed array or points\n      this._parts = [this._rings];\n    },\n\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updatePoly(this, true); //passing true creates a closed path i.e. a rectangle\n    },\n\n  });\n\n  var projectedExtent = function (locations, options) {\n    return new ProjectedExtent(locations, options);\n  };\n\n  var QueryHandler = L.Handler.extend({\n      addHooks: function() {\n          // get a reference to the actual <map> element, so we can \n          // use its layers property to iterate the layers from top down\n          // evaluating if they are 'on the map' (enabled)\n          L.setOptions(this, {mapEl: this._map.options.mapEl});\n          L.DomEvent.on(this._map, 'click', this._queryTopLayer, this);\n          L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n      },\n      removeHooks: function() {\n          L.DomEvent.off(this._map, 'click', this._queryTopLayer, this);\n          L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n      },\n      _getTopQueryableLayer: function() {\n          var layers = this.options.mapEl.layers;\n          // work backwards in document order (top down)\n          for (var l=layers.length-1;l>=0;l--) {\n            var mapmlLayer = layers[l]._layer;\n            if (layers[l].checked && mapmlLayer.queryable) {\n                return mapmlLayer;\n            }\n          }\n      },\n      _queryTopLayerAtMapCenter: function (event) {\n        setTimeout(() => {\n          if (this._map.isFocused && !this._map._popupClosed && (event.originalEvent.key === \" \" || +event.originalEvent.keyCode === 13)) {\n            this._map.fire('click', { \n                latlng: this._map.getCenter(),\n                layerPoint: this._map.latLngToLayerPoint(this._map.getCenter()),\n                containerPoint: this._map.latLngToContainerPoint(this._map.getCenter())\n            });\n          } else {\n            delete this._map._popupClosed;\n          }\n        }, 0);\n      },\n      _queryTopLayer: function(event) {\n          var layer = this._getTopQueryableLayer();\n          if (layer) {\n              if(layer._mapmlFeatures) delete layer._mapmlFeatures;\n              this._query(event, layer);\n          }\n      },\n      _query(e, layer) {\n        var zoom = e.target.getZoom(),\n            map = this._map,\n            crs = layer._extent.crs, // the crs for each extent would be the same\n            tileSize = map.options.crs.options.crs.tile.bounds.max.x,\n            container = layer._container,\n            popupOptions = {autoClose: false, autoPan: true, maxHeight: (map.getSize().y * 0.5) - 50},\n            tcrs2pcrs = function (c) {\n              return crs.transformation.untransform(c,crs.scale(zoom));\n            },\n            tcrs2gcrs = function (c) {\n              return crs.unproject(crs.transformation.untransform(c,crs.scale(zoom)),zoom);\n            };\n        var tcrsClickLoc = crs.latLngToPoint(e.latlng, zoom),\n            tileMatrixClickLoc = tcrsClickLoc.divideBy(tileSize).floor(),\n            tileBounds = new L.Bounds(tcrsClickLoc.divideBy(tileSize).floor().multiplyBy(tileSize), \n            tcrsClickLoc.divideBy(tileSize).ceil().multiplyBy(tileSize));\n\n        let point = this._map.project(e.latlng),\n            scale = this._map.options.crs.scale(this._map.getZoom()),\n            pcrsClick = this._map.options.crs.transformation.untransform(point,scale);\n        let templates = layer.getQueryTemplates(pcrsClick);\n\n        var fetchFeatures = function(template, obj, lastOne) {\n          const parser = new DOMParser();\n          fetch(L.Util.template(template.template, obj), { redirect: 'follow' })\n            .then((response) => {\n              if (response.status >= 200 && response.status < 300) {\n                return response.text().then( text => {\n                  return {\n                    contenttype: response.headers.get(\"Content-Type\"),\n                    text: text\n                  };\n                });\n              } else {\n                throw new Error(response.status);\n              }\n        }).then((response) => {\n          if(!layer._mapmlFeatures) layer._mapmlFeatures = [];\n          if (response.contenttype.startsWith(\"text/mapml\")) {\n            // the mapmldoc could have <map-meta> elements that are important, perhaps\n            // also, the mapmldoc can have many features\n            let mapmldoc = parser.parseFromString(response.text, \"application/xml\"),\n                features = Array.prototype.slice.call(mapmldoc.querySelectorAll(\"map-feature\"));\n            if(features.length) layer._mapmlFeatures = layer._mapmlFeatures.concat(features);\n          } else {\n            // synthesize a single feature from text or html content\n            let geom = \"<map-geometry cs='gcrs'><map-point><map-coordinates>\"+e.latlng.lng+\" \"+e.latlng.lat+\"</map-coordinates></map-point></map-geometry>\",\n                feature = parser.parseFromString(\"<map-feature><map-properties>\"+\n                  response.text+\"</map-properties>\"+geom+\"</map-feature>\", \"text/html\").querySelector(\"map-feature\");\n            layer._mapmlFeatures.push(feature);\n          }\n          if(lastOne) {\n            // create connection between queried <map-feature> and its parent <map-extent>\n            for (let feature of layer._mapmlFeatures) {\n              feature._extentEl = template._extentEl;\n            }\n            displayFeaturesPopup(layer._mapmlFeatures, e.latlng);\n          }\n        }).catch((err) => {\n          console.log('Looks like there was a problem. Status: ' + err.message);\n        });\n      };\n\n      for(let i = 0; i < templates.length; i++){\n\n        var obj = {},\n            template = templates[i];\n   \n        // all of the following are locations that might be used in a query, I think.\n        obj[template.query.tilei] = tcrsClickLoc.x.toFixed() - (tileMatrixClickLoc.x * tileSize);\n        obj[template.query.tilej] = tcrsClickLoc.y.toFixed() - (tileMatrixClickLoc.y * tileSize);\n        \n        // this forces the click to the centre of the map extent in the layer crs\n        obj[template.query.mapi] = (map.getSize().divideBy(2)).x.toFixed();\n        obj[template.query.mapj] = (map.getSize().divideBy(2)).y.toFixed();\n        \n        obj[template.query.pixelleft] = crs.pointToLatLng(tcrsClickLoc, zoom).lng;\n        obj[template.query.pixeltop] = crs.pointToLatLng(tcrsClickLoc, zoom).lat;\n        obj[template.query.pixelright] = crs.pointToLatLng(tcrsClickLoc.add([1,1]), zoom).lng;\n        obj[template.query.pixelbottom] = crs.pointToLatLng(tcrsClickLoc.add([1,1]), zoom).lat;\n        \n        obj[template.query.column] = tileMatrixClickLoc.x;\n        obj[template.query.row] = tileMatrixClickLoc.y;\n        obj[template.query.x] = tcrsClickLoc.x.toFixed();\n        obj[template.query.y] = tcrsClickLoc.y.toFixed();\n        \n        // whereas the layerPoint is calculated relative to the origin plus / minus any\n        // pan movements so is equal to containerPoint at first before any pans, but\n        // changes as the map pans. \n        obj[template.query.easting] =  tcrs2pcrs(tcrsClickLoc).x;\n        obj[template.query.northing] = tcrs2pcrs(tcrsClickLoc).y;\n        obj[template.query.longitude] =  tcrs2gcrs(tcrsClickLoc).lng;\n        obj[template.query.latitude] = tcrs2gcrs(tcrsClickLoc).lat;\n        obj[template.query.zoom] = zoom;\n        obj[template.query.width] = map.getSize().x;\n        obj[template.query.height] = map.getSize().y;\n        // assumes the click is at the centre of the map, per template.query.mapi, mapj above\n        obj[template.query.mapbottom] = tcrs2pcrs(tcrsClickLoc.add(map.getSize().divideBy(2))).y;\n        obj[template.query.mapleft] = tcrs2pcrs(tcrsClickLoc.subtract(map.getSize().divideBy(2))).x;\n        obj[template.query.maptop] = tcrs2pcrs(tcrsClickLoc.subtract(map.getSize().divideBy(2))).y;\n        obj[template.query.mapright] = tcrs2pcrs(tcrsClickLoc.add(map.getSize().divideBy(2))).x;\n        \n        obj[template.query.tilebottom] = tcrs2pcrs(tileBounds.max).y;\n        obj[template.query.tileleft] = tcrs2pcrs(tileBounds.min).x;\n        obj[template.query.tiletop] = tcrs2pcrs(tileBounds.min).y;\n        obj[template.query.tileright] = tcrs2pcrs(tileBounds.max).x;\n        // add hidden or other variables that may be present into the values to\n        // be processed by L.Util.template below.\n        for (var v in template.query) {\n            if ([\"mapi\",\"mapj\",\"tilei\",\"tilej\",\"row\",\"col\",\"x\",\"y\",\"easting\",\"northing\",\"longitude\",\"latitude\",\"width\",\"height\",\"zoom\",\"mapleft\",\"mapright\",\",maptop\",\"mapbottom\",\"tileleft\",\"tileright\",\"tiletop\",\"tilebottom\",\"pixeltop\",\"pixelbottom\",\"pixelleft\",\"pixelright\"].indexOf(v) < 0) {\n                obj[v] = template.query[v];\n            }\n        }\n\n        if(template.extentBounds.contains(pcrsClick)){\n          let lastOne = (i === (templates.length - 1)) ? true: false;\n          fetchFeatures(template, obj, lastOne);\n        }\n      }\n        function displayFeaturesPopup(features, loc) {\n\n          let f = M.featureLayer(features, {\n              // pass the vector layer a renderer of its own, otherwise leaflet\n              // puts everything into the overlayPane\n              renderer: M.featureRenderer(),\n              // pass the vector layer the container for the parent into which\n              // it will append its own container for rendering into\n              pane: container,\n              //color: 'yellow',\n              // instead of unprojecting and then projecting and scaling,\n              // a much smarter approach would be to scale at the current\n              // zoom\n              projection: map.options.projection,\n              _leafletLayer: layer,\n              query: true,\n              static:true,\n          });\n          f.addTo(map);\n\n          let div = L.DomUtil.create(\"div\", \"mapml-popup-content\"),\n              c = L.DomUtil.create(\"iframe\");\n          c.style = \"border: none\";\n          c.srcdoc = features[0].querySelector('map-feature map-properties').innerHTML;\n          c.setAttribute(\"sandbox\",\"allow-same-origin allow-forms\");\n          div.appendChild(c);\n          // passing a latlng to the popup is necessary for when there is no\n          // geometry / null geometry\n          layer._totalFeatureCount = features.length;\n          layer.bindPopup(div, popupOptions).openPopup(loc);\n          layer.on('popupclose', function() {\n              map.removeLayer(f);\n          });\n          f.showPaginationFeature({i: 0, popup: layer._popup});\n\n        }\n      }\n  });\n\n  /*\n  MIT License related to portions of M.ContextMenu \n  Copyright (c) 2017 adam.ratcliffe@gmail.com\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the Software), \n  to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \n  and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  */\n  /* global M */\n\n  var ContextMenu = L.Handler.extend({\n    _touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',\n\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.activeIndex = 0; //current fous index on menu\n      this.excludedIndices = [4, 7]; //menu indexes that are --------\n      this.isRunned = false; //variable for tracking edge case\n      //setting the items in the context menu and their callback functions\n      this._items = [\n        {\n          text: M.options.locale.cmBack + \" (<kbd>Alt+Left Arrow</kbd>)\",\n          callback:this._goBack\n        },\n        {\n          text: M.options.locale.cmForward + \" (<kbd>Alt+Right Arrow</kbd>)\",\n          callback:this._goForward\n        },\n        {\n          text: M.options.locale.cmReload + \" (<kbd>Ctrl+R</kbd>)\",\n          callback:this._reload\n        },\n        {\n          text: M.options.locale.btnFullScreen + \" (<kbd>F</kbd>)\",\n          callback:this._toggleFullScreen\n        },\n        {\n          spacer:\"-\"\n        },\n        {\n          text: M.options.locale.cmCopyCoords + \" (<kbd>C</kbd>)<span></span>\",\n          callback:this._copyCoords,\n          hideOnSelect:false,\n          popup:true,\n          submenu:[\n            {\n              text: M.options.locale.cmCopyMapML,\n              callback:this._copyMapML\n            },\n            {\n              text: M.options.locale.cmCopyExtent,\n              callback:this._copyExtent\n            },\n            {\n              text: M.options.locale.cmCopyLocation,\n              callback:this._copyLocation\n            }\n          ]\n        },\n        {\n          text: M.options.locale.cmPasteLayer + \" (<kbd>P</kbd>)\",\n          callback:this._paste\n        },\n        {\n          spacer:\"-\"\n        },\n        {\n          text: M.options.locale.cmToggleControls + \" (<kbd>T</kbd>)\",\n          callback:this._toggleControls\n        },      {\n          text: M.options.locale.cmToggleDebug + \" (<kbd>D</kbd>)\",\n          callback:this._toggleDebug\n        },\n        {\n          text: M.options.locale.cmViewSource + \" (<kbd>V</kbd>)\",\n          callback:this._viewSource\n        }\n      ];\n\n      // setting the default cs for copying location and extent\n      // should be public as they are used in tests\n      this.defExtCS = M.options.defaultExtCoor;\n      this.defLocCS = M.options.defaultLocCoor;\n      this._layerItems = [\n        {\n          text: M.options.locale.lmZoomToLayer + \" (<kbd>Z</kbd>)\",\n          callback:this._zoomToLayer\n        },\n        {\n          text: M.options.locale.lmCopyLayer + \" (<kbd>L</kbd>)\",\n          callback:this._copyLayer\n        }\n      ];\n      this._mapMenuVisible = false;\n      this._keyboardEvent = false;\n\n      this._container = L.DomUtil.create(\"div\", \"mapml-contextmenu\", map._container);\n      this._container.setAttribute('hidden', '');\n      \n      for (let i = 0; i < 6; i++) {\n        this._items[i].el = this._createItem(this._container, this._items[i]);\n      }\n      \n      this._coordMenu = L.DomUtil.create(\"div\", \"mapml-contextmenu mapml-submenu\", this._container);\n      this._coordMenu.id = \"mapml-copy-submenu\";\n      this._coordMenu.setAttribute('hidden', '');\n      \n      this._clickEvent = null;\n      \n      for(let i =0;i<this._items[5].submenu.length;i++){\n        this._createItem(this._coordMenu,this._items[5].submenu[i],i);\n      }\n      \n      this._items[6].el = this._createItem(this._container, this._items[6]);\n      this._items[7].el = this._createItem(this._container, this._items[7]);\n      this._items[8].el = this._createItem(this._container, this._items[8]);\n      this._items[9].el = this._createItem(this._container, this._items[9]);\n      this._items[10].el = this._createItem(this._container, this._items[10]);\n      \n      this._layerMenu = L.DomUtil.create(\"div\", \"mapml-contextmenu mapml-layer-menu\", map._container);\n      this._layerMenu.setAttribute('hidden', '');\n      for (let i = 0; i < this._layerItems.length; i++) {\n        this._createItem(this._layerMenu, this._layerItems[i]);\n      }\n\n      L.DomEvent\n        .on(this._container, 'click', L.DomEvent.stop)\n        .on(this._container, 'mousedown', L.DomEvent.stop)\n        .on(this._container, 'dblclick', L.DomEvent.stop)\n        .on(this._container, 'contextmenu', L.DomEvent.stop)\n        .on(this._layerMenu, 'click', L.DomEvent.stop)\n        .on(this._layerMenu, 'mousedown', L.DomEvent.stop)\n        .on(this._layerMenu, 'dblclick', L.DomEvent.stop)\n        .on(this._layerMenu, 'contextmenu', L.DomEvent.stop);\n        \n      this.t = document.createElement('template');\n      this.t.innerHTML = \n       `<map-feature zoom=\"\">\n        <map-featurecaption></map-featurecaption>\n        <map-properties>\n            <h2></h2>\n            <div style=\"text-align:center\"></div>\n        </map-properties>\n        <map-geometry cs=\"\">\n          <map-point>\n            <map-coordinates></map-coordinates>\n          </map-point>\n        </map-geometry>\n      </map-feature>`;\n    },\n\n    addHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent\n        .on(container, 'mouseleave', this._hide, this)\n        .on(document, 'keydown', this._onKeyDown, this);\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.on({\n        contextmenu: this._show,\n        mousedown: this._hide,\n        zoomstart: this._hide\n      }, this);\n    },\n\n    removeHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent\n        .off(container, 'mouseleave', this._hide, this)\n        .off(document, 'keydown', this._onKeyDown, this);\n\n      if (L.Browser.touch) {\n        L.DomEvent.off(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.off({\n        contextmenu: this._show,\n        mousedown: this._hide,\n        zoomstart: this._hide\n      }, this);\n    },\n\n    _updateCS: function () {\n      if (this.defExtCS !== M.options.defaultExtCoor || this.defLocCS !== M.options.defaultLocCoor) {\n        this.defExtCS = M.options.defaultExtCoor;\n        this.defLocCS = M.options.defaultLocCoor;\n      }\n    },\n\n    _copyExtent: function (e) {\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n          coord = context.defExtCS? context.defExtCS.toLowerCase() : 'pcrs',\n          tL = e instanceof KeyboardEvent? this.extent.topLeft[coord] : this.options.mapEl.extent.topLeft[coord],\n          bR = e instanceof KeyboardEvent? this.extent.bottomRight[coord] : this.options.mapEl.extent.bottomRight[coord],\n          data = \"\";\n      switch(coord) {\n        case 'MapML':\n        default: \n          if (coord === 'pcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-easting=${Math.round(tL.horizontal)}, top-left-northing=${Math.round(tL.vertical)}, bottom-right-easting=${Math.round(bR.horizontal)}, bottom-right-northing=${Math.round(bR.vertical)}\"></map-meta>`;\n          } else if (coord === 'gcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-longitude=${tL.horizontal}, top-left-latitude=${tL.vertical}, bottom-right-longitude=${bR.horizontal}, bottom-right-latitude=${bR.vertical}\"></map-meta>`;\n          } else if (coord === 'tcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-x=${tL[0].horizontal}, top-left-y=${tL[0].vertical}, bottom-right-x=${bR[bR.length - 1].horizontal}, bottom-right-y=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else if (coord === 'tilematrix') {          \n            data = `<map-meta name=\"extent\" content=\"top-left-column=${tL[0].horizontal}, top-left-row=${tL[0].vertical}, bottom-right-column=${bR[bR.length - 1].horizontal}, bottom-right-row=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else {\n            console.log('not support');\n          }\n          break;\n      }\n      context._copyData(data);\n    },\n\n    _zoomToLayer: function (e) {\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu;\n      context._layerClicked.layer._layerEl.zoomTo();\n    },\n\n    _copyLayer: function (e) {\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        layerElem = context._layerClicked.layer._layerEl;\n      context._copyData(layerElem.getOuterHTML());\n    },\n\n    _goForward: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.forward();\n    },\n\n    _goBack: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.back();\n    },\n\n    _reload: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.reload();\n    },\n\n    _toggleFullScreen: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl._toggleFullScreen();\n    },\n\n    _toggleControls: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      if (mapEl.controls) {\n        mapEl.controls = false;\n      } else {\n        mapEl.controls = true;\n      }\n    },\n\n    _copyMapML: function(e){\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      context._copyData(mapEl.outerHTML.replace(/<div class=\"mapml-web-map\">.*?<\\/div>|<style>\\[is=\"web-map\"].*?<\\/style>|<style>mapml-viewer.*?<\\/style>/gm, \"\"));\n    },\n\n    // Add support for pasting GeoJSON in the future\n    _paste: function(e){\n      let context = e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      navigator.clipboard\n        .readText()\n        .then(\n            (layer) => {\n              M._pasteLayer(mapEl, layer);\n          }\n        );\n    },\n\n    _viewSource: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.viewSource();\n    },\n\n    _toggleDebug: function(e){\n      let mapEl = e instanceof KeyboardEvent?this._map.options.mapEl:this.options.mapEl;\n      mapEl.toggleDebug();\n    },\n\n    _copyCoords: function(e){\n      let directory = this.contextMenu?this.contextMenu:this;\n      directory._showCoordMenu(e);\n    },\n\n    _copyData: function(data){\n      const el = document.createElement('textarea');\n      el.value = data;\n      document.body.appendChild(el);\n      el.select();\n      document.execCommand('copy');\n      document.body.removeChild(el);\n    },\n\n    _copyLocation: function(e){\n      const menu = this.contextMenu;\n      switch(menu.defLocCS.toLowerCase()) {\n        case 'tile': menu._copyTile.call(this, e); break;\n        case 'tilematrix': menu._copyTileMatrix.call(this, e); break;\n        case 'map': menu._copyMap.call(this, e); break;\n        case 'tcrs': menu._copyTCRS.call(this, e); break;\n        case 'pcrs': menu._copyPCRS.call(this, e); break;\n        case 'gcrs': \n        default: \n          menu._copyGCRS.call(this, e);\n          break;\n      }\n    },\n\n    _copyGCRS: function(e) {\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          projection = mapEl.projection,\n          feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n          caption =  feature.querySelector('map-featurecaption'),\n          h2 = feature.querySelector('h2'),\n          div = feature.querySelector('div'),\n          geom = feature.querySelector('map-geometry'),\n          coords = feature.querySelector('map-coordinates');\n     \n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs','gcrs');\n      caption.textContent = `Copied ${projection} gcrs location`;\n      h2.textContent = `Copied ${projection} gcrs location`;\n      div.textContent = `${click.latlng.lng.toFixed(6)} ${click.latlng.lat.toFixed(6)}`;\n      coords.textContent = `${click.latlng.lng.toFixed(6)} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTCRS: function(e) {\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          point = mapEl._map.project(click.latlng),\n          pt = {x:point.x.toFixed(),y:point.y.toFixed()},\n          projection = mapEl.projection,\n          feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n          caption =  feature.querySelector('map-featurecaption'),\n          h2 = feature.querySelector('h2'),\n          div = feature.querySelector('div'),\n          geom = feature.querySelector('map-geometry'),\n          coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs','tcrs');\n      caption.textContent = `Copied ${projection} tcrs location`;\n      h2.textContent = `Copied ${projection} tcrs location`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${pt.x} ${pt.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTileMatrix: function(e) {\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          point = mapEl._map.project(click.latlng),\n          tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n          projection = mapEl.projection,        \n          feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n          caption =  feature.querySelector('map-featurecaption'),\n          h2 = feature.querySelector('h2'),\n          div = feature.querySelector('div'),\n          geom = feature.querySelector('map-geometry'),\n          coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs','gcrs');\n      caption.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      div.textContent = `${Math.trunc(point.x/tileSize)} ${Math.trunc(point.y/tileSize)}`;\n      coords.textContent = `${click.latlng.lng.toFixed(6)} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyPCRS: function(e) {\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          point = mapEl._map.project(click.latlng),\n          scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n          pcrs = mapEl._map.options.crs.transformation.untransform(point,scale).round(),\n          projection = mapEl.projection,\n          feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n          caption =  feature.querySelector('map-featurecaption'),\n          h2 = feature.querySelector('h2'),\n          div = feature.querySelector('div'),\n          geom = feature.querySelector('map-geometry'),\n          coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs','pcrs');\n      caption.textContent = `Copied ${projection} pcrs location`;\n      h2.textContent = `Copied ${projection} pcrs location`;\n      div.textContent = `${pcrs.x} ${pcrs.y}`;\n      coords.textContent = `${pcrs.x} ${pcrs.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTile: function(e) {\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          // the _map.project method returns pixels, while the _map.crs.project \n          // method returns meters, confusingly:\n          // https://leafletjs.com/reference.html#map-project\n          // https://leafletjs.com/reference.html#crs-project\n          point = mapEl._map.project(click.latlng),\n          tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n          pointX = point.x % tileSize, pointY = point.y % tileSize,\n          pt = L.point(pointX,pointY).trunc(),\n          projection = mapEl.projection,\n          feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n          caption =  feature.querySelector('map-featurecaption'),\n          h2 = feature.querySelector('h2'),\n          div = feature.querySelector('div'),\n          geom = feature.querySelector('map-geometry'),\n          coords = feature.querySelector('map-coordinates');\n\n      if(pt.x < 0) pt.x += tileSize;\n      if(pt.y < 0) pt.y += tileSize; \n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs','gcrs');\n      caption.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(6)} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyMap: function(e){\n      let mapEl = this.options.mapEl,\n          click = this.contextMenu._clickEvent,\n          mapPt = click.containerPoint.trunc(),\n          projection = mapEl.projection,\n          feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n          caption =  feature.querySelector('map-featurecaption'),\n          h2 = feature.querySelector('h2'),\n          div = feature.querySelector('div'),\n          geom = feature.querySelector('map-geometry'),\n          coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs','gcrs');\n      caption.textContent = `Copied ${projection} map location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} map location (not implemented yet)`;\n      div.textContent = `${mapPt.x} ${mapPt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(6)} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyAllCoords: function(e){\n      let mapEl = this.options.mapEl,\n      click = this.contextMenu._clickEvent,\n      point = mapEl._map.project(click.latlng),\n      tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n      pointX = point.x % tileSize, pointY = point.y % tileSize,\n      scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n      pcrs = mapEl._map.options.crs.transformation.untransform(point,scale);\n      let allData = `z:${mapEl.zoom}\\n`;\n      allData += `tile: i:${Math.trunc(pointX)}, j:${Math.trunc(pointY)}\\n`;\n      allData += `tilematrix: column:${Math.trunc(point.x/tileSize)}, row:${Math.trunc(point.y/tileSize)}\\n`;\n      allData += `map: i:${Math.trunc(click.containerPoint.x)}, j:${Math.trunc(click.containerPoint.y)}\\n`;\n      allData += `tcrs: x:${Math.trunc(point.x)}, y:${Math.trunc(point.y)}\\n`;\n      allData += `pcrs: easting:${pcrs.x.toFixed(2)}, northing:${pcrs.y.toFixed(2)}\\n`;\n      allData += `gcrs: lon :${click.latlng.lng.toFixed(6)}, lat:${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(allData);\n    },\n\n    _createItem: function (container, options, index) {\n      if (options.spacer) {\n        return this._createSeparator(container, index);\n      }\n\n      var itemCls = 'mapml-contextmenu-item',\n          el = this._insertElementAt('button', itemCls, container, index),\n          callback = this._createEventHandler(el, options.callback, options.context, options.hideOnSelect),\n          html = '';\n\n      el.innerHTML = html + options.text;\n      el.setAttribute(\"type\", \"button\");\n      el.classList.add(\"mapml-button\");\n      if(options.popup){\n        el.setAttribute(\"aria-haspopup\", \"true\");\n        el.setAttribute(\"aria-expanded\", \"false\");\n        el.setAttribute(\"aria-controls\", \"mapml-copy-submenu\");\n      }\n\n      L.DomEvent\n        .on(el, 'mouseover', this._onItemMouseOver, this)\n        .on(el, 'mouseout', this._onItemMouseOut, this)\n        .on(el, 'mousedown', L.DomEvent.stopPropagation)\n        .on(el, 'click', callback);\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(el, this._touchstart, L.DomEvent.stopPropagation);\n      }\n\n      // Devices without a mouse fire \"mouseover\" on tap, but never mouseout\"\n      if (!L.Browser.pointer) {\n        L.DomEvent.on(el, 'click', this._onItemMouseOut, this);\n      }\n\n      return {\n        id: L.Util.stamp(el),\n        el: el,\n        callback: callback\n      };\n    },\n\n    _createSeparator: function (container, index) {\n      let el = this._insertElementAt('div', 'mapml-contextmenu-separator', container, index);\n\n      return {\n        id: L.Util.stamp(el),\n        el: el\n      };\n    },\n\n    _createEventHandler: function (el, func, context, hideOnSelect) {\n      let parent = this;\n\n      hideOnSelect = (hideOnSelect !== undefined) ? hideOnSelect : true;\n\n      return function (e) {\n        let map = parent._map,\n          containerPoint = parent._showLocation.containerPoint,\n          layerPoint = map.containerPointToLayerPoint(containerPoint),\n          latlng = map.layerPointToLatLng(layerPoint),\n          relatedTarget = parent._showLocation.relatedTarget,\n          data = {\n            containerPoint: containerPoint,\n            layerPoint: layerPoint,\n            latlng: latlng,\n            relatedTarget: relatedTarget\n          };\n\n        if (hideOnSelect) {\n          parent._hide();\n        }\n\n        if (func) {\n          func.call(context || map, data);\n        }\n\n        parent._map.fire('contextmenu.select', {\n          contextmenu: parent,\n          el: el\n        });\n      };\n    },\n\n    _insertElementAt: function (tagName, className, container, index) {\n        let refEl,\n            el = document.createElement(tagName);\n\n        el.className = className;\n\n        if (index !== undefined) {\n            refEl = container.children[index];\n        }\n\n        if (refEl) {\n            container.insertBefore(el, refEl);\n        } else {\n            container.appendChild(el);\n        }\n\n        return el;\n    },\n\n    _show: function (e) {\n      if(this._mapMenuVisible) this._hide();\n      this._clickEvent = e;\n      let elem = e.originalEvent.target;\n      if(elem.closest(\"fieldset\")){\n        elem = elem.closest(\"fieldset\");\n        elem = (elem.className === \"mapml-layer-extent\") ? \n                elem.closest(\"fieldset\").parentNode.parentNode.parentNode.querySelector(\"span\") : \n                elem.querySelector(\"span\");\n        if(!elem.layer.validProjection) return;\n        this._layerClicked = elem;\n        this._layerMenu.removeAttribute('hidden');\n        this._showAtPoint(e.containerPoint, e, this._layerMenu);\n      } else if(elem.classList.contains(\"leaflet-container\") || elem.classList.contains(\"mapml-debug-extent\") ||\n      elem.tagName === \"path\") {\n        let layerList = this._map.options.mapEl.layers;\n        this._layerClicked = Array.from(layerList).find(el => el.checked);\n        // the 'hidden' attribute must be removed before any attempt to get the size of container\n        this._container.removeAttribute('hidden');\n        this._showAtPoint(e.containerPoint, e, this._container);\n        this._updateCS();\n      }\n      if(e.originalEvent.button === 0 || e.originalEvent.button === -1){\n        this._keyboardEvent = true;\n        if(this._layerClicked.className.includes('mapml-layer-item')){\n          let activeEl = document.activeElement;\n          this._elementInFocus = activeEl.shadowRoot.activeElement;\n          this._layerMenuTabs = 1;\n          this._layerMenu.firstChild.focus();\n        } else {\n          this._container.querySelectorAll(\"button:not([disabled])\")[0].focus();\n        }\n\n      }\n    },\n\n    _showAtPoint: function (pt, data, container) {\n        if (this._items.length) {\n            let event = L.extend(data || {}, {contextmenu: this});\n\n            this._showLocation = {\n                containerPoint: pt\n            };\n\n            if (data && data.relatedTarget){\n                this._showLocation.relatedTarget = data.relatedTarget;\n            }\n\n            this._setPosition(pt,container);\n\n            if (!this._mapMenuVisible) {\n              container.removeAttribute('hidden');\n                this._mapMenuVisible = true;\n            }\n\n            this._map.fire('contextmenu.show', event);\n        }\n    },\n\n    _hide: function () {\n        if (this._mapMenuVisible) {\n            this._mapMenuVisible = false;\n            this._container.setAttribute('hidden', '');\n            this._coordMenu.setAttribute('hidden', '');\n            this._layerMenu.setAttribute('hidden', '');\n            this._map.fire('contextmenu.hide', {contextmenu: this});\n            setTimeout(() => this._map._container.focus(), 0);\n            this.activeIndex = 0;\n            this.isRunned = false;\n        }\n    },\n\n    _setPosition: function (pt, container) {\n        let mapSize = this._map.getSize(),\n            containerSize = this._getElementSize(container),\n            anchor;\n\n        if (this._map.options.contextmenuAnchor) {\n            anchor = L.point(this._map.options.contextmenuAnchor);\n            pt = pt.add(anchor);\n        }\n\n        container._leaflet_pos = pt;\n\n        if (pt.x + containerSize.x > mapSize.x) {\n            container.style.left = 'auto';\n            container.style.right = Math.min(Math.max(mapSize.x - pt.x, 0), mapSize.x - containerSize.x - 1) + 'px';\n        } else {\n            container.style.left = Math.max(pt.x, 0) + 'px';\n            container.style.right = 'auto';\n        }\n\n        if (pt.y + containerSize.y > mapSize.y) {\n            container.style.top = 'auto';\n            container.style.bottom = Math.min(Math.max(mapSize.y - pt.y, 0), mapSize.y - containerSize.y - 1) + 'px';\n        } else {\n            container.style.top = Math.max(pt.y, 0) + 'px';\n            container.style.bottom = 'auto';\n        }\n    },\n\n    _getElementSize: function (el) {\n        let size = this._size;\n\n        if (!size || this._sizeChanged) {\n            size = {};\n\n            el.style.left = '-999999px';\n            el.style.right = 'auto';\n\n            size.x = el.offsetWidth;\n            size.y = el.offsetHeight;\n\n            el.style.left = 'auto';\n\n            this._sizeChanged = false;\n        }\n\n        return size;\n    },\n\n     // once tab is clicked on the layer menu, change the focus back to the layer control\n     _focusOnLayerControl: function(){\n      this._mapMenuVisible = false;\n      delete this._layerMenuTabs;\n      this._layerMenu.setAttribute('hidden', '');\n      if(this._elementInFocus){\n        this._elementInFocus.focus();\n      } else {\n        this._layerClicked.parentElement.firstChild.focus();\n      }\n      delete this._elementInFocus;\n    },\n\n    _setActiveItem: function(index) {\n      if (document.activeElement.shadowRoot === null && this.noActiveEl === true){\n        //bug fix when theres no active element\n        this.noActiveEl = false;\n        //setting this._items[9] is just for preventing some diabled index, it will be override by later code.\n        this._items[9].el.el.focus();\n      }\n      if (document.activeElement.shadowRoot.activeElement.innerHTML === this._items[index].el.el.innerHTML){\n        //edge case where pressing shift f10 focuses the first element on contextmenu (if already focused, have to press arrow twice to go down)\n        let next = index + 1;\n        while (this._items[next].el.el.disabled) {\n          next++;\n          if (next >= this._items.length) {\n            next = 0;\n          }\n        }\n        this._setActiveItem(next);\n      } else {\n        if (this.excludedIndices.includes(index)) {\n          // find the next or previous non-excluded item\n          let nextIndex = index + 1;\n          let prevIndex = index - 1;\n          while (this.excludedIndices.includes(nextIndex) || this._items[nextIndex].el.el.disabled) {\n            nextIndex++;\n            if (nextIndex >= this._items.length) {\n              nextIndex = 0;\n            }\n          }\n          while (this.excludedIndices.includes(prevIndex) || this._items[prevIndex].el.el.disabled) {\n            prevIndex--;\n            if (prevIndex < 0) {\n              prevIndex = this._items.length - 1;\n            }\n          }\n          // set the active item to the next or previous non-excluded item\n          if (this.activeIndex < index) {\n            this._setActiveItem(nextIndex);\n          } else {\n            this._setActiveItem(prevIndex);\n          }\n        } else {\n          // set the focus item\n          this._items[index].el.el.focus();\n          this.activeIndex = index;\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      if(!this._mapMenuVisible) return;\n\n      let key = e.keyCode;\n      let path = e.path || e.composedPath();\n\n      if(key === 13)\n        e.preventDefault();\n      // keep track of where the focus is on the layer menu and when the layer menu is tabbed out of, focus on layer control\n      if(this._layerMenuTabs && (key === 9 || key === 27)){\n        if(e.shiftKey){\n          this._layerMenuTabs -= 1;\n        } else {\n          this._layerMenuTabs += 1;\n        }\n        if(this._layerMenuTabs === 0 || this._layerMenuTabs === 3 || key === 27){\n          L.DomEvent.stop(e);\n          this._focusOnLayerControl();\n        }\n      } else if (key === 38) { //up arrow\n        if (!this._coordMenu.hasAttribute('hidden') && \n          (document.activeElement.shadowRoot === null || //null happens when the focus is on submenu and when mouse hovers on main menu, submenu disappears\n          document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[0].innerHTML)) { //\"map\" on submenu\n          this._coordMenu.children[2].focus();\n        } else if (!this._coordMenu.hasAttribute('hidden') && \n          document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[1].innerHTML) { //\"extent\" on submenu\n          this._coordMenu.children[0].focus();\n        } else if (!this._coordMenu.hasAttribute('hidden') && \n          document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[2].innerHTML) { //\"Location\" on submenu\n          this._coordMenu.children[1].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden') && \n          document.activeElement.shadowRoot.activeElement.innerHTML === this._layerMenu.children[0].innerHTML) { //\"zoom to layer\" on layermenu\n          this._layerMenu.children[1].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[0].focus();\n        } else {\n          if (this.activeIndex > 0) {\n            let prevIndex = this.activeIndex - 1;\n            while (this._items[prevIndex].el.el.disabled) {\n              prevIndex--;\n              if (prevIndex < 0) {\n                prevIndex = this._items.length - 1;\n              }\n            }\n            this._setActiveItem(prevIndex);\n          } else {\n            this._setActiveItem(this._items.length - 1);\n          }\n        }\n      } else if (key === 40) { //down arrow\n        if (!this._coordMenu.hasAttribute('hidden') && \n          (document.activeElement.shadowRoot === null ||\n          document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[2].innerHTML)) { //\"map\" on submenu\n          this._coordMenu.children[0].focus();\n        } else if (!this._coordMenu.hasAttribute('hidden') && \n          document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[1].innerHTML) { //\"extent\" on submenu\n          this._coordMenu.children[2].focus();\n        } else if (!this._coordMenu.hasAttribute('hidden') && \n          document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[0].innerHTML) { //\"Location\" on submenu\n          this._coordMenu.children[1].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden') && \n          document.activeElement.shadowRoot.activeElement.innerHTML === this._layerMenu.children[0].innerHTML){ //\"zoom to layer\" on layermenu\n          this._layerMenu.children[1].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')){\n          this._layerMenu.children[0].focus();  \n        } else {\n          if (this.activeIndex < this._items.length - 1) {\n            //edge case at index 0\n            if (!this.isRunned && this.activeIndex === 0 && !this._items[this.activeIndex].el.el.disabled){\n              this._setActiveItem(0);\n              this.isRunned = true;\n            } else { //edge case over\n              let nextIndex = this.activeIndex + 1;\n              while (this._items[nextIndex].el.el.disabled) {\n                nextIndex++;\n                if (nextIndex >= this._items.length) {\n                  nextIndex = 0;\n                }\n              }\n              this._setActiveItem(nextIndex);\n            }\n          } else {\n            let nextIndex = 0;\n            while (this._items[nextIndex].el.el.disabled) {\n              nextIndex++;\n              if (nextIndex >= this._items.length) {\n                nextIndex = 0;\n              }\n            }\n            this._setActiveItem(nextIndex);\n          }\n        }\n      } else if (key === 39) { //right arrow\n        if (document.activeElement.shadowRoot !== null && \n            document.activeElement.shadowRoot.activeElement.innerHTML === \n            this._items[5].el.el.innerHTML && //'copy'\n          this._coordMenu.hasAttribute('hidden')){\n          this._showCoordMenu();\n          this._coordMenu.children[0].focus();\n        } else if (document.activeElement.shadowRoot.activeElement.innerHTML === this._items[5].el.el.innerHTML && \n          !this._coordMenu.hasAttribute('hidden')) {\n          this._coordMenu.children[0].focus();\n        }\n      } else if (key === 37) { //left arrow\n        if (!this._coordMenu.hasAttribute('hidden') && \n            document.activeElement.shadowRoot !== null) {\n          if (document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[0].innerHTML ||\n          document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[1].innerHTML || \n          document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[2].innerHTML){\n            this._coordMenu.setAttribute('hidden','');\n            this._setActiveItem(5);\n          }\n        }\n      } else if (key === 27) { //esc key\n        if (document.activeElement.shadowRoot === null) {\n          this._hide();\n        } else {\n          if (!this._coordMenu.hasAttribute('hidden')) {\n            if (document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[0].innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[1].innerHTML || \n            document.activeElement.shadowRoot.activeElement.innerHTML === this._coordMenu.children[2].innerHTML){\n              this._coordMenu.setAttribute('hidden','');\n              this._setActiveItem(5);\n            }\n          } else {\n            this._hide();\n          }\n        }\n      } else if(key !== 16 && key!== 9 && \n                !(!(this._layerClicked.className.includes('mapml-layer-item')) && key === 67) && \n                (path[0].innerText !== (M.options.locale.cmCopyCoords + \" (C)\"))){\n        this._hide();\n      }\n      switch(key){\n        case 13:  //ENTER KEY\n          if(document.activeElement.shadowRoot.activeElement.innerHTML === this._items[5].el.el.innerHTML){\n            this._copyCoords({\n              latlng:this._map.getCenter()\n            });\n            this._coordMenu.firstChild.focus();\n          } else {\n            if(this._map._container.parentNode.activeElement.parentNode.classList.contains(\"mapml-contextmenu\"))\n              this._map._container.parentNode.activeElement.click();\n          }\n          break;\n        case 32:  //SPACE KEY\n          if(this._map._container.parentNode.activeElement.parentNode.classList.contains(\"mapml-contextmenu\"))\n            this._map._container.parentNode.activeElement.click();\n          break;\n        case 67: //C KEY\n          this._copyCoords({\n            latlng:this._map.getCenter()\n          });\n          this._coordMenu.firstChild.focus();\n          break;\n        case 68: //D KEY\n          this._toggleDebug(e);\n          break;\n        case 77: //M KEY\n          this._copyMapML(e);\n          break;\n        case 76: //L KEY\n          if(this._layerClicked.className.includes('mapml-layer-item'))\n            this._copyLayer(e);\n          break;\n        case 70: //F KEY\n          this._toggleFullScreen(e);\n          break;\n        case 80: //P KEY\n          this._paste(e);\n          break;\n        case 84: //T KEY\n          this._toggleControls(e);\n          break;\n        case 86: //V KEY\n          this._viewSource(e);\n          break;\n        case 90: //Z KEY\n          if(this._layerClicked.className.includes('mapml-layer-item'))\n            this._zoomToLayer(e);\n          break;\n      }\n    },\n\n    _showCoordMenu: function(e){\n      let mapSize = this._map.getSize(),\n          click = this._clickEvent,\n          menu = this._coordMenu,\n          copyEl = this._items[5].el.el;\n\n      copyEl.setAttribute(\"aria-expanded\",\"true\");\n      menu.removeAttribute('hidden');\n\n      const menuWidth = this._container.offsetWidth,\n            menuHeight = this._container.offsetHeight,\n            submenuWidth = menu.offsetWidth;\n      if (click.containerPoint.x + menuWidth + submenuWidth > mapSize.x) {\n        menu.style.left = 'auto';\n        menu.style.right = menuWidth + 'px';\n      } else {\n        menu.style.left = menuWidth + 'px';\n        menu.style.right = 'auto';\n      }\n\n      menu.style.top = 100 - 22 + 'px';\n      menu.style.bottom = 'auto';\n    },\n\n    _hideCoordMenu: function(e){\n      if(!e.relatedTarget || !e.relatedTarget.parentElement || \n          e.relatedTarget.parentElement.classList.contains(\"mapml-submenu\") ||\n          e.relatedTarget.classList.contains(\"mapml-submenu\"))return;\n      let menu = this._coordMenu, copyEl = this._items[4].el.el;\n      copyEl.setAttribute(\"aria-expanded\",\"false\");\n      menu.setAttribute('hidden', '');\n      this.noActiveEl = true; //variable to keep track of no focus element on contextmenu, bug fix for arrow key navigation\n    },\n\n    _onItemMouseOver: function (e) {\n      L.DomUtil.addClass(e.target || e.srcElement, 'over');\n      if(e.srcElement.innerText === (M.options.locale.cmCopyCoords + \" (C)\")) this._showCoordMenu(e);\n    },\n\n    _onItemMouseOut: function (e) {\n      L.DomUtil.removeClass(e.target || e.srcElement, 'over');\n      this._hideCoordMenu(e);\n    },\n\n    toggleContextMenuItem: function (options,state) {\n      options = options.toUpperCase(); \n      if (state === \"disabled\") {\n        if (options === \"CONTROLS\") {\n          this._items[8].el.el.disabled = true;\n        } else if (options === \"BACK\") {\n          this._items[0].el.el.disabled = true;\n        } else if (options === \"FORWARD\") {\n          this._items[1].el.el.disabled = true;\n        } else if (options === \"RELOAD\") {\n          this._items[2].el.el.disabled = true;\n        }\n      } else if(state === \"enabled\") {\n        if (options === \"CONTROLS\") {\n          this._items[8].el.el.disabled = false;\n        } else if (options === \"BACK\") {\n          this._items[0].el.el.disabled = false;\n        } else if (options === \"FORWARD\") {\n          this._items[1].el.el.disabled = false;\n        } else if (options === \"RELOAD\") {\n          this._items[2].el.el.disabled = false;\n        }\n      }\n    },\n    \n    setViewFullScreenInnerHTML: function (options) {\n      if (options === 'view') {\n        this._map.contextMenu._items[3].el.el.innerHTML = M.options.locale.btnFullScreen + \" (<kbd>F</kbd>)\";\n      }\n      else if (options === 'exit') {\n        this._map.contextMenu._items[3].el.el.innerHTML = M.options.locale.btnExitFullScreen + \" (<kbd>F</kbd>)\";\n      }\n    }\n  });\n\n  var Util = {\n    // _convertAndFormatPCRS returns the converted CRS and formatted pcrsBounds in gcrs, pcrs, tcrs, and tilematrix. Used for setting extent for the map and layer (map.extent, layer.extent).\n    // _convertAndFormatPCRS: L.Bounds, _map -> {...}\n    _convertAndFormatPCRS : function(pcrsBounds, map){\n      if(!pcrsBounds || !map) return {};\n\n      let tcrsTopLeft = [], tcrsBottomRight = [],\n          tileMatrixTopLeft = [], tileMatrixBottomRight = [],\n          tileSize = map.options.crs.options.crs.tile.bounds.max.y;\n\n      for(let i = 0;i<map.options.crs.options.resolutions.length;i++){\n        let scale = map.options.crs.scale(i),\n            minConverted = map.options.crs.transformation.transform(pcrsBounds.min,scale),\n            maxConverted = map.options.crs.transformation.transform(pcrsBounds.max,scale);\n            \n        tcrsTopLeft.push({\n          horizontal: minConverted.x,\n          vertical:maxConverted.y,\n        });\n        tcrsBottomRight.push({\n          horizontal: maxConverted.x,\n          vertical: minConverted.y,\n        });\n\n        //converts the tcrs values from earlier to tilematrix\n        tileMatrixTopLeft.push({\n          horizontal: tcrsTopLeft[i].horizontal / tileSize,\n          vertical:tcrsTopLeft[i].vertical / tileSize,\n        });\n        tileMatrixBottomRight.push({\n          horizontal: tcrsBottomRight[i].horizontal / tileSize,\n          vertical: tcrsBottomRight[i].vertical / tileSize,\n        });\n      }\n      \n      //converts the gcrs, I believe it can take any number values from -inf to +inf\n      let unprojectedMin = map.options.crs.unproject(pcrsBounds.min),\n          unprojectedMax = map.options.crs.unproject(pcrsBounds.max);\n\n      let gcrs = {\n        topLeft:{\n          horizontal: unprojectedMin.lng,\n          vertical:unprojectedMax.lat,\n        },\n        bottomRight:{\n          horizontal: unprojectedMax.lng,\n          vertical: unprojectedMin.lat,\n        },\n      };\n\n      //formats known pcrs bounds to correct format\n      let pcrs = {\n        topLeft:{\n          horizontal:pcrsBounds.min.x,\n          vertical:pcrsBounds.max.y,\n        },\n        bottomRight:{\n          horizontal:pcrsBounds.max.x,\n          vertical:pcrsBounds.min.y,\n        },\n      };\n\n      //formats all extent data\n      return {\n        topLeft:{\n          tcrs:tcrsTopLeft,\n          tilematrix:tileMatrixTopLeft,\n          gcrs:gcrs.topLeft,\n          pcrs:pcrs.topLeft,\n        },\n        bottomRight:{\n          tcrs:tcrsBottomRight,\n          tilematrix:tileMatrixBottomRight,\n          gcrs:gcrs.bottomRight,\n          pcrs:pcrs.bottomRight,\n        },\n        projection:map.options.projection\n      };\n    },\n\n    // _extractInputBounds extracts and returns Input Bounds from the provided template\n    // _extractInputBounds: Object -> {zoomBounds: ..., bounds: ...}\n    _extractInputBounds: function(template){\n      if(!template) return undefined;\n\n      //sets variables with their respective fallback values incase content is missing from the template\n      let inputs = template.values, projection = template.projection || FALLBACK_PROJECTION, value = 0, boundsUnit = FALLBACK_CS;\n      let bounds = this[projection].options.crs.tilematrix.bounds(0), \n          defaultMinZoom = 0, defaultMaxZoom = this[projection].options.resolutions.length - 1,\n          nativeMinZoom = defaultMinZoom, nativeMaxZoom = defaultMaxZoom;\n      let locInputs = false, numberOfAxes = 0;\n      for(let i=0;i<inputs.length;i++){\n        switch(inputs[i].getAttribute(\"type\")){\n          case \"zoom\":\n            nativeMinZoom = +(inputs[i].hasAttribute(\"min\") && !isNaN(+inputs[i].getAttribute(\"min\")) ? inputs[i].getAttribute(\"min\") : defaultMinZoom);\n            nativeMaxZoom = +(inputs[i].hasAttribute(\"max\") && !isNaN(+inputs[i].getAttribute(\"max\")) ? inputs[i].getAttribute(\"max\") : defaultMaxZoom);\n            value = +inputs[i].getAttribute(\"value\");\n          break;\n          case \"location\":\n            if(!inputs[i].getAttribute(\"max\") || !inputs[i].getAttribute(\"min\")) continue;\n            let max = +inputs[i].getAttribute(\"max\"),min = +inputs[i].getAttribute(\"min\");\n            switch(inputs[i].getAttribute(\"axis\").toLowerCase()){\n              case \"x\":\n              case \"longitude\":\n              case \"column\":\n              case \"easting\":\n                boundsUnit = M.axisToCS(inputs[i].getAttribute(\"axis\").toLowerCase());\n                bounds.min.x = min;\n                bounds.max.x = max;\n                numberOfAxes++;\n              break;\n              case \"y\":\n              case \"latitude\":\n              case \"row\":\n              case \"northing\":\n                boundsUnit = M.axisToCS(inputs[i].getAttribute(\"axis\").toLowerCase());\n                bounds.min.y = min;\n                bounds.max.y = max;\n                numberOfAxes++;\n              break;\n            }\n          break;\n        }\n      }\n      if (numberOfAxes >= 2) {\n        locInputs = true;\n      }\n      // min/maxZoom are copied from <meta name=zoom content=\"min=n,max=m>, are *display* range for content\n      // min/maxNativeZoom are received from <input type=zoom min=... max=...>, describe *server* content availability\n      let zoomBounds = {\n        minZoom: template.zoomBounds?.min && !isNaN(+template.zoomBounds.min) ? +template.zoomBounds.min : defaultMinZoom,\n        maxZoom: template.zoomBounds?.max && !isNaN(+template.zoomBounds.max) ? +template.zoomBounds.max : defaultMaxZoom,\n        minNativeZoom: nativeMinZoom,\n        maxNativeZoom: nativeMaxZoom\n      };\n      if(!locInputs && template.extentPCRSFallback && template.extentPCRSFallback.bounds) {\n        bounds = template.extentPCRSFallback.bounds;\n      } else if (locInputs) {\n        bounds = this.boundsToPCRSBounds(bounds,value,projection,boundsUnit);\n      } else {\n        bounds = this[projection].options.crs.pcrs.bounds;\n      }\n      return {\n        zoomBounds: zoomBounds,\n        bounds: bounds\n      };\n    },\n\n    // axisToCS returns the CRS when given the axis:\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToCS: (Axis String) -> (CRS String)\n    axisToCS : function(axis){\n      try{\n        switch(axis.toLowerCase()){\n          case \"row\":\n          case \"column\":\n            return \"TILEMATRIX\";\n          case \"i\":\n          case \"j\":\n            return [\"MAP\",\"TILE\"];\n          case \"x\":\n          case \"y\":\n            return \"TCRS\";\n          case \"latitude\":\n          case \"longitude\":\n            return \"GCRS\";\n          case \"northing\":\n          case \"easting\":\n            return \"PCRS\";\n          default:\n            return FALLBACK_CS;\n        }\n      } catch (e) {return undefined;}\n    },\n\n    // csToAxes takes a given cs and retuns the axes, first horizontal then vertical\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // csToAxes: (CRS String) -> [(horizontal axis String), (Vertical axis String)]\n    csToAxes: function(cs){\n      try{\n        switch(cs.toLowerCase()){\n          case \"tilematrix\":\n            return [\"column\", \"row\"];\n          case \"map\":\n          case \"tile\":\n            return [\"i\", \"j\"];\n          case \"tcrs\":\n            return [\"x\", \"y\"];\n          case \"gcrs\":\n            return [\"longitude\", \"latitude\"];\n          case \"pcrs\":\n            return [\"easting\", \"northing\"];\n        }\n      } catch (e) {return undefined;}\n    },\n\n    // axisToXY takes horizontal axis and returns 'x', or takes vertical axis and returns 'y'\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToXY: (Axis String) -> 'x' or 'y'\n    axisToXY: function(axis){\n      try{\n        switch(axis.toLowerCase()){\n          case \"i\":\n          case \"column\":\n          case \"longitude\":\n          case \"x\":\n          case \"easting\":\n            return \"x\";\n          case \"row\":\n          case \"j\":\n          case \"latitude\":\n          case \"y\":\n          case \"northing\":\n            return \"y\";\n\n          default:\n            return undefined;\n        }\n      } catch (e) {return undefined;}\n    },\n    \n    // convertPCRSBounds converts pcrsBounds to the given cs Bounds.\n    // convertPCRSBounds: L.Bounds, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.Bounds\n    convertPCRSBounds: function(pcrsBounds, zoom, projection, cs){\n      if(!pcrsBounds || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !projection || !cs) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      switch (cs.toUpperCase()) {\n        case \"PCRS\":\n          return pcrsBounds;\n        case \"TCRS\":\n        case \"TILEMATRIX\":\n          let minPixel = projection.transformation.transform(pcrsBounds.min, projection.scale(+zoom)),\n              maxPixel = projection.transformation.transform(pcrsBounds.max, projection.scale(+zoom));\n          if (cs.toUpperCase() === \"TCRS\") return L.bounds(minPixel, maxPixel);\n          let tileSize = projection.options.crs.tile.bounds.max.x;\n          return L.bounds(L.point(minPixel.x / tileSize, minPixel.y / tileSize), L.point(maxPixel.x / tileSize,maxPixel.y / tileSize)); \n        case \"GCRS\":\n          let minGCRS = projection.unproject(pcrsBounds.min),\n              maxGCRS = projection.unproject(pcrsBounds.max);\n          return L.bounds(L.point(minGCRS.lng, minGCRS.lat), L.point(maxGCRS.lng, maxGCRS.lat)); \n        default:\n          return undefined;\n      }\n    },\n\n    // pointToPCRSPoint takes a point, with a projection and cs and converts it to a pcrs L.point/L.latLng\n    //pointToPCRSPoint: L.Point, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.point|L.latLng\n    pointToPCRSPoint: function(point, zoom, projection, cs){\n      if(!point || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !cs || !projection) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      let tileSize = projection.options.crs.tile.bounds.max.x;\n      switch(cs.toUpperCase()){\n        case \"TILEMATRIX\":\n          return M.pixelToPCRSPoint(L.point(point.x*tileSize,point.y*tileSize),zoom,projection);\n        case \"PCRS\":\n          return point;\n        case \"TCRS\" :\n          return M.pixelToPCRSPoint(point,zoom,projection);\n        case \"GCRS\":\n          return projection.project(L.latLng(point.y,point.x));\n        default:\n          return undefined;\n      }\n    },\n\n    // pixelToPCRSPoint takes a pixel L.point, the zoom and projection and returns a L.point in pcrs\n    // pixelToPCRSPoint: L.Point, Int, L.CRS|Str -> L.point\n    pixelToPCRSPoint: function(point, zoom, projection){\n      if(!point || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !projection) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      return projection.transformation.untransform(point,projection.scale(zoom));\n    },\n\n    // boundsToPCRSBounds converts bounds with projection and cs to PCRS bounds\n    // boundsToPCRSBounds: L.bounds, Int, L.CRS|Str, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.bounds\n    boundsToPCRSBounds: function(bounds, zoom, projection, cs){\n      if(!bounds || !bounds.max || !bounds.min || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !projection || !cs) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      return L.bounds(M.pointToPCRSPoint(bounds.min, zoom, projection, cs), M.pointToPCRSPoint(bounds.max, zoom, projection, cs));\n    },\n\n    //L.bounds have fixed point positions, where min is always topleft, max is always bottom right, and the values are always sorted by leaflet\n    //important to consider when working with pcrs where the origin is not topleft but rather bottomleft, could lead to confusion\n    pixelToPCRSBounds : function(bounds, zoom, projection){\n      if(!bounds || !bounds.max || !bounds.min || (!zoom && zoom !== 0) || !Number.isFinite(+zoom) || !projection) return undefined;\n      projection = (typeof projection === \"string\") ? M[projection] : projection;\n      return L.bounds(M.pixelToPCRSPoint(bounds.min, zoom, projection), M.pixelToPCRSPoint(bounds.max, zoom, projection));\n    },\n\n    //meta content is the content attribute of meta\n    // input \"max=5,min=4\" => [[max,5][min,5]]\n    _metaContentToObject: function(input){\n      if(!input || input instanceof Object)return {};\n      let content = input.split(/\\s+/).join(\"\");\n      let contentArray = {};\n      let stringSplit = content.split(',');\n\n      for(let i=0;i<stringSplit.length;i++){\n        let prop = stringSplit[i].split(\"=\");\n        if(prop.length === 2) contentArray[prop[0]]=prop[1];\n      }\n      if(contentArray !== \"\" && stringSplit[0].split(\"=\").length ===1)contentArray.content = stringSplit[0];\n      return contentArray;\n    },\n\n    // _coordsToArray returns an array of arrays of coordinate pairs \n    // _coordsToArray: (\"1,2,3,4\") -> [[1,2],[3,4]]\n    _coordsToArray: function(containerPoints) {\n      for (var i=1, pairs = [], coords = containerPoints.split(\",\");i<coords.length;i+=2) {\n        pairs.push([parseInt(coords[i-1]),parseInt(coords[i])]);\n      }\n      return pairs;\n    },\n\n    // _parseStylesheetAsHTML parses map-link and map-style from mapml and inserts them to the container as HTML\n    _parseStylesheetAsHTML: function(mapml, base, container) {\n        if (!(container instanceof Element) || !mapml || !mapml.querySelector('map-link[rel=stylesheet],map-style')) return;\n\n        if(base instanceof Element) {\n          base = base.getAttribute('href')?base.getAttribute('href'):document.URL;\n        } else if (!base || base===\"\" || base instanceof Object) {\n          return;\n        }\n\n        var ss = [];\n        var stylesheets = mapml.querySelectorAll('map-link[rel=stylesheet],map-style');\n        for (var i=0;i<stylesheets.length;i++) {\n          if (stylesheets[i].nodeName.toUpperCase() === \"MAP-LINK\" ) {\n            var href = stylesheets[i].hasAttribute('href') ? new URL(stylesheets[i].getAttribute('href'),base).href: null;\n            if (href) {\n              if (!container.querySelector(\"link[href='\"+href+\"']\")) {\n                var linkElm = document.createElement(\"link\");\n                linkElm.setAttribute(\"href\", href);\n                linkElm.setAttribute(\"rel\", \"stylesheet\");\n                ss.push(linkElm);\n              }\n            }  \n          } else { // <map-style>\n              var styleElm = document.createElement('style');\n              styleElm.textContent = stylesheets[i].textContent;\n              ss.push(styleElm);\n          }\n        }\n        // insert <link> or <style> elements after the begining  of the container\n        // element, in document order as copied from original mapml document\n        // note the code below assumes hrefs have been resolved and elements\n        // re-parsed from xml and serialized as html elements ready for insertion\n        for (var s=ss.length-1;s >= 0;s--) {\n          container.insertAdjacentElement('afterbegin',ss[s]);\n        }\n    },\n\n    // _splitCoordinate splits string coordinates to an array as floating point numbers \n    _splitCoordinate: function(element, index, array) {\n      var a = [];\n      element.split(/\\s+/gim).forEach(M._parseNumber,a);\n      this.push(a);\n    },\n\n    // _parseNumber parses a string as a floating point number, helper function for _splitCoordinate\n    _parseNumber : function(element, index, array){\n      this.push(parseFloat(element));\n    },\n\n    // _handleLink handles map-a links, when clicked on a map-a link\n    _handleLink: function (link, leafletLayer) {\n      let zoomTo, justPan = false, layer, map = leafletLayer._map, opacity;\n      if(link.type === \"text/html\" && link.target !== \"_blank\"){  // all other target values other than blank behave as _top\n        link.target = \"_top\";\n      } else if (link.type !== \"text/html\" && link.url.includes(\"#\")){\n        let hash = link.url.split(\"#\"), loc = hash[1].split(\",\");\n        zoomTo = {z: loc[0] || 0, lng: loc[1] || 0, lat: loc[2] || 0};\n        justPan = !hash[0]; // if the first half of the array is an empty string then the link is just for panning\n        if([\"/\", \".\",\"#\"].includes(link.url[0])) link.target = \"_self\";\n      }\n      if(!justPan) {\n        let newLayer = false;\n        layer = document.createElement('layer-');\n        layer.setAttribute('src', link.url);\n        layer.setAttribute('checked', '');\n        switch (link.target) {\n          case \"_blank\":\n            if (link.type === \"text/html\") {\n              window.open(link.url);\n            } else {\n              map.options.mapEl.appendChild(layer);\n              newLayer = true;\n            }\n            break;\n          case \"_parent\":\n            for (let l of map.options.mapEl.querySelectorAll(\"layer-\"))\n              if (l._layer !== leafletLayer) map.options.mapEl.removeChild(l);\n            map.options.mapEl.appendChild(layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            newLayer = true;\n            break;\n          case \"_top\":\n            window.location.href = link.url;\n            break;\n          default:\n            opacity = leafletLayer._layerEl.opacity;\n            leafletLayer._layerEl.insertAdjacentElement('beforebegin', layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            newLayer = true;\n        }\n        if(!link.inPlace && newLayer) L.DomEvent.on(layer,'extentload', function focusOnLoad(e) {\n          if(newLayer && [\"_parent\", \"_self\"].includes(link.target) && layer.parentElement.querySelectorAll(\"layer-\").length === 1)\n            layer.parentElement.projection = layer._layer.getProjection();\n          if(layer.extent){\n            if(zoomTo) layer.parentElement.zoomTo(+zoomTo.lat, +zoomTo.lng, +zoomTo.z);\n            else layer.zoomTo();\n            L.DomEvent.off(layer, 'extentload', focusOnLoad);\n          }\n\n          if(opacity) layer.opacity = opacity;\n          map.getContainer().focus();\n        });\n      } else if (zoomTo && !link.inPlace && justPan){\n        leafletLayer._map.options.mapEl.zoomTo(+zoomTo.lat, +zoomTo.lng, +zoomTo.z);\n        if(opacity) layer.opacity = opacity;\n      }\n    },\n    \n    // _gcrsToTileMatrix returns the [column, row] of the tiles at map center. Used for Announce movement for screen readers\n    // _gcrsToTileMatrix: map/mapml-viewer -> [column, row]\n    _gcrsToTileMatrix: function (mapEl) {\n      let point = mapEl._map.project(mapEl._map.getCenter());\n      let tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.y;\n      let column = Math.trunc(point.x / tileSize);\n      let row = Math.trunc(point.y / tileSize);\n      return [column, row];\n    },\n\n    // Pastes text to a mapml-viewer/map element(mapEl), text can be a mapml link, geojson, or a layer-\n    //    used for pasting layers through ctrl+v, drag/drop, and pasting through the contextmenu\n    // _pasteLayer: HTMLElement Str -> None\n    // Effects: append a layer- element to mapEl, if it is valid\n    _pasteLayer: function (mapEl, text) {\n      try {\n        new URL(text);\n        // create a new <layer-> child of the <mapml-viewer> element\n        let l = '<layer- src=\"' + text + '\" label=\"' + M.options.locale.dfLayer + '\" checked=\"\"></layer->';\n        mapEl.insertAdjacentHTML(\"beforeend\", l);\n        mapEl.lastChild.addEventListener(\"error\", function () {\n          if (mapEl) {\n            // should invoke lifecyle callbacks automatically by removing it from DOM\n            mapEl.removeChild(mapEl.lastChild);\n          }\n          // garbage collect it\n          l = null;\n        });\n      } catch (err) {\n        text = text.replace(/(<!--.*?-->)|(<!--[\\S\\s]+?-->)|(<!--[\\S\\s]*?$)/g, '').trim();\n        if ((text.slice(0,7) === \"<layer-\") && (text.slice(-9) === \"</layer->\")) {\n          mapEl.insertAdjacentHTML(\"beforeend\", text);\n        } else if (text.slice(0,12) === \"<map-feature\" && text.slice(-14) === \"</map-feature>\") {\n          let layer = `<layer- label=\"${M.options.locale.dfPastedLayer}\" checked>\n                       <map-meta name='projection' content='${mapEl.projection}'></map-meta>`+text+\n                      \"</layer->\";\n          mapEl.insertAdjacentHTML(\"beforeend\", layer);\n        } else {\n          try {\n            mapEl.geojson2mapml(JSON.parse(text));\n          } catch {\n            console.log(\"Invalid Input!\");\n          }}\n      }\n    },\n\n    // Takes GeoJSON Properties to return an HTML table, helper function\n    //    for geojson2mapml\n    // _properties2Table: geojsonPropertiesOBJ -> HTML Table\n    _properties2Table: function (json) {\n      let table = document.createElement('table');\n\n      // Creating a Table Header\n      let thead = table.createTHead();\n      let row = thead.insertRow();\n      let th1 = document.createElement(\"th\");\n      let th2 = document.createElement(\"th\");\n      th1.appendChild(document.createTextNode(\"Property name\"));\n      th2.appendChild(document.createTextNode(\"Property value\"));\n      th1.setAttribute(\"role\", \"columnheader\");\n      th2.setAttribute(\"role\", \"columnheader\");\n      th1.setAttribute(\"scope\", \"col\");\n      th2.setAttribute(\"scope\", \"col\");\n      row.appendChild(th1);\n      row.appendChild(th2);\n\n      // Creating table body and populating it from the JSON\n      let tbody = table.createTBody();\n      for (let key in json) {\n          if (json.hasOwnProperty(key)) {\n              let row = tbody.insertRow();\n              let th = document.createElement(\"th\");\n              let td = document.createElement(\"td\");\n              th.appendChild(document.createTextNode(key));\n              td.appendChild(document.createTextNode(json[key]));\n              th.setAttribute(\"scope\", \"row\");\n              td.setAttribute(\"itemprop\", key);\n              row.appendChild(th);\n              row.appendChild(td);\n          }\n      }\n      return table;\n    },\n\n    // Takes bbox array and a x,y coordinate to possibly update the extent, returns extent\n    //    for geojson2mapml\n    // _updateExtent: [min x, min y, max x, max y], x, y -> [min x, min y, max x, max y]\n    _updateExtent: function (bboxExtent, x, y) {\n      if (bboxExtent === {}) {\n        return bboxExtent;\n      }\n      bboxExtent[0] = Math.min(x, bboxExtent[0]);\n      bboxExtent[1] = Math.min(y, bboxExtent[1]);\n      bboxExtent[2] = Math.max(x, bboxExtent[2]);\n      bboxExtent[3] = Math.max(y, bboxExtent[3]);\n      return bboxExtent;\n    },\n\n    // Takes a GeoJSON geojson and an options Object which returns a <layer-> Element\n    // The options object can contain the following:\n    //      label            - String, contains the layer name, if included overrides the default label mapping\n    //      projection       - String, contains the projection of the layer (OSMTILE, WGS84, CBMTILE, APSTILE), defaults to   OSMTILE\n    //      caption          - Function | String, function accepts one argument being the feature object which produces the   featurecaption string OR a string that is the name of the property that will be mapped to featurecaption\n    //      properties       - Function | String | HTMLElement, a function which maps the geojson feature to an HTMLElement   or a string that will be parsed as an HTMLElement or an HTMLElement\n    //      geometryFunction - Function, A function you supply that can add classes, hyperlinks and spans to the created  <map-geometry> element, default would be the plain map-geometry element\n    // geojson2mapml: geojson Object <layer-> [min x, min y, max x, max y] -> <layer->\n    geojson2mapml: function (json, options = {}, layer = null, bboxExtent={}) {\n      let defaults = {\n          label: null,\n          projection: \"OSMTILE\",\n          caption: null,\n          properties: null,\n          geometryFunction: null\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      // If string json is received\n      if (typeof json === \"string\") {\n          json = JSON.parse(json);\n      }\n      let geometryType = [\"POINT\", \"LINESTRING\", \"POLYGON\", \"MULTIPOINT\", \"MULTILINESTRING\", \"MULTIPOLYGON\", \"GEOMETRYCOLLECTION\"];\n      let jsonType = json.type.toUpperCase();\n      let out = \"\";\n      let setExtent = false;\n\n      // HTML parser\n      let parser = new DOMParser();\n\n      // initializing layer\n      if (layer === null) {\n          if (!json.bbox) {\n            setExtent = true;\n          }\n          // creating an empty mapml layer\n          let xmlStringLayer = \"<layer- label='' checked><map-meta name='projection' content='\" + options.projection + \"'></map-meta><map-meta name='cs' content='gcrs'></map-meta></layer->\";\n          layer = parser.parseFromString(xmlStringLayer, \"text/html\");\n          //console.log(layer)\n          if (options.label !== null) {\n              layer.querySelector(\"layer-\").setAttribute(\"label\", options.label);\n          } else if (json.name) {\n              layer.querySelector(\"layer-\").setAttribute(\"label\", json.name);\n          } else if (json.title) {\n              layer.querySelector(\"layer-\").setAttribute(\"label\", json.title);\n          } else {\n              layer.querySelector(\"layer-\").setAttribute(\"label\", M.options.locale.dfLayer);\n          }\n      }\n      let point = \"<map-point></map-point>\";\n      point = parser.parseFromString(point, \"text/html\");\n\n      let multiPoint = \"<map-multipoint><map-coordinates></map-coordinates></map-multipoint>\";\n      multiPoint = parser.parseFromString(multiPoint, \"text/html\");\n\n      let linestring = \"<map-linestring><map-coordinates></map-coordinates></map-linestring>\";\n      linestring = parser.parseFromString(linestring, \"text/html\");\n\n      let multilinestring = \"<map-multilinestring></map-multilinestring>\";\n      multilinestring = parser.parseFromString(multilinestring, \"text/html\");\n\n      let polygon = \"<map-polygon></map-polygon>\";\n      polygon = parser.parseFromString(polygon, \"text/html\");\n\n      let multiPolygon = \"<map-multipolygon></map-multipolygon>\";\n      multiPolygon = parser.parseFromString(multiPolygon, \"text/html\");\n\n      let geometrycollection = \"<map-geometrycollection></map-geometrycollection>\";\n      geometrycollection = parser.parseFromString(geometrycollection, \"text/html\");\n\n      let feature = \"<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>\";\n      feature = parser.parseFromString(feature, \"text/html\");\n\n      // Template to add coordinates to Geometries\n      let coords = \"<map-coordinates></map-coordinates>\";\n      coords = parser.parseFromString(coords, \"text/html\");\n      \n      //console.log(layer);\n      if (jsonType === \"FEATURECOLLECTION\") {\n          \n          // Setting bbox if it exists\n          if (json.bbox) {\n              layer.querySelector(\"layer-\").insertAdjacentHTML(\"afterbegin\", \"<map-meta name='extent' content='top-left-longitude=\" + json.bbox[0] + \", top-left-latitude=\" + json.bbox[1] + \", bottom-right-longitude=\" + json.bbox[2] + \",bottom-right-latitude=\" + json.bbox[3] + \"'></map-meta>\");\n          } else {\n            bboxExtent = [Infinity, Infinity, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY];\n          }\n\n          let features = json.features;\n          //console.log(\"Features length - \" + features.length);\n          for (let l=0;l<features.length;l++) {\n              M.geojson2mapml(features[l], options, layer, bboxExtent);\n          }\n      } else if (jsonType === \"FEATURE\") {\n\n          let clone_feature = feature.cloneNode(true);\n          let curr_feature = clone_feature.querySelector('map-feature');\n\n          // Setting bbox if it exists\n          if (json.bbox) {\n            layer.querySelector(\"layer-\").insertAdjacentHTML(\"afterbegin\", \"<map-meta name='extent' content='top-left-longitude=\" + json.bbox[0] + \", top-left-latitude=\" + json.bbox[1] + \", bottom-right-longitude=\" + json.bbox[2] + \",bottom-right-latitude=\" + json.bbox[3] + \"'></map-meta>\");\n          } else if ((typeof bboxExtent === 'object') && (bboxExtent.length === undefined)) {\n            bboxExtent = [Infinity, Infinity, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY];\n          }\n\n          // Setting featurecaption\n          let featureCaption = layer.querySelector(\"layer-\").getAttribute('label');\n          if (typeof options.caption === \"function\") {\n              featureCaption = options.caption(json);\n          } else if (typeof options.caption === \"string\") {\n              featureCaption = json.properties[options.caption];\n              // if property does not exist\n              if (featureCaption === undefined) {\n                  featureCaption = options.caption;\n              }\n          } else if (json.id) { // when no caption option available try setting id as featurecaption\n            featureCaption = json.id;\n          } \n          curr_feature.querySelector(\"map-featurecaption\").innerHTML = featureCaption;\n\n          // Setting Properties\n          let p;\n          // if properties function is passed\n          if (typeof options.properties === \"function\") {\n              p = options.properties(json);\n              // if function output is not an element, ignore the properties.\n              if (!(p instanceof Element)) {\n                  p = false;\n                  console.error(\"options.properties function returns a string instead of an HTMLElement.\");\n              }\n          } else if (typeof options.properties === \"string\") { // if properties string is passed\n              curr_feature.querySelector('map-properties').insertAdjacentHTML(\"beforeend\", options.properties);\n              p = false;\n          } else if (options.properties instanceof HTMLElement) { // if an HTMLElement is passed - NOT TESTED\n              p = options.properties;\n          } else { // If no properties function, string or HTMLElement is passed\n              p = M._properties2Table(json.properties);\n          }\n          \n          if (p) {\n              curr_feature.querySelector('map-properties').appendChild(p);\n          }\n\n          // Setting map-geometry\n          let g = M.geojson2mapml(json.geometry, options, layer, bboxExtent);\n          if (typeof options.geometryFunction === \"function\") {\n              curr_feature.querySelector('map-geometry').appendChild(options.geometryFunction(g, json));\n          } else {\n              curr_feature.querySelector('map-geometry').appendChild(g);\n          }\n          \n          // Appending feature to layer\n          layer.querySelector('layer-').appendChild(curr_feature);\n          \n      } else if (geometryType.includes(jsonType)) {\n          //console.log(\"Geometry Type - \" + jsonType);\n          switch(jsonType){\n              case \"POINT\":\n                  bboxExtent = M._updateExtent(bboxExtent, json.coordinates[0], json.coordinates[1]);\n                  out = json.coordinates[0] + \" \" + json.coordinates[1];\n                  \n                  // Create Point element\n                  let clone_point = point.cloneNode(true);\n                  clone_point = clone_point.querySelector('map-point');\n\n                  // Create map-coords to add to the polygon\n                  let clone_coords = coords.cloneNode(true);\n                  clone_coords = clone_coords.querySelector(\"map-coordinates\");\n\n                  clone_coords.innerHTML = out;\n\n                  clone_point.appendChild(clone_coords);\n                  //console.log(clone_point);\n                  return clone_point;\n\n              case \"LINESTRING\":\n                  let clone_linestring = linestring.cloneNode(true);\n                  let linestring_coordindates = clone_linestring.querySelector(\"map-coordinates\");\n                  \n                  out = \"\";\n\n                  for (let x=0;x<json.coordinates.length;x++) {\n                      bboxExtent = M._updateExtent(bboxExtent, json.coordinates[x][0], json.coordinates[x][1]);\n                      out = out + json.coordinates[x][0] + \" \" + json.coordinates[x][1] + \" \";\n                  }\n\n                  linestring_coordindates.innerHTML = out;\n                  //console.log(clone_linestring.querySelector('map-linestring'));\n                  return (clone_linestring.querySelector('map-linestring'));\n\n              case \"POLYGON\":\n                  let clone_polygon = polygon.cloneNode(true);\n                  clone_polygon = clone_polygon.querySelector(\"map-polygon\");\n                  \n                  // Going over each coordinates\n                  for (let y=0;y<json.coordinates.length;y++) {\n                      let out = \"\";\n                      let clone_coords = coords.cloneNode(true);\n                      clone_coords = clone_coords.querySelector(\"map-coordinates\");\n\n                      // Going over coordinates for the polygon\n                      for (let x=0;x<json.coordinates[y].length;x++) {\n                          bboxExtent = M._updateExtent(bboxExtent, json.coordinates[y][x][0], json.coordinates[y][x][1]);\n                          out = out + json.coordinates[y][x][0] + \" \" + json.coordinates[y][x][1] + \" \";\n                      }\n\n                      // Create map-coordinates element and append it to clone_polygon\n                      clone_coords.innerHTML = out;\n\n                      clone_polygon.appendChild(clone_coords);\n                  }\n                  //console.log(clone_polygon);\n                  return clone_polygon;\n\n              case \"MULTIPOINT\":\n                  out = \"\";\n                  // Create multipoint element\n                  let clone_multipoint = multiPoint.cloneNode(true);\n                  clone_multipoint = clone_multipoint.querySelector('map-multipoint');\n\n                  for (let i=0;i<json.coordinates.length;i++) {\n                      bboxExtent = M._updateExtent(bboxExtent, json.coordinates[i][0], json.coordinates[i][1]);\n                      out = out + json.coordinates[i][0] + \" \" + json.coordinates[i][1] + \" \";\n                  }\n                  clone_multipoint.querySelector('map-coordinates').innerHTML = out;\n                  return clone_multipoint;\n\n              case \"MULTILINESTRING\":\n                  let clone_multilinestring = multilinestring.cloneNode(true);\n                  clone_multilinestring = clone_multilinestring.querySelector(\"map-multilinestring\");\n\n                  for(let i=0;i<json.coordinates.length;i++) {\n                      let out = \"\";\n                      let clone_coords = coords.cloneNode(true);\n                      clone_coords = clone_coords.querySelector(\"map-coordinates\");\n                      for(let y=0;y<json.coordinates[i].length;y++) {\n                          bboxExtent = M._updateExtent(bboxExtent, json.coordinates[i][y][0], json.coordinates[i][y][1]);\n                          out = out + json.coordinates[i][y][0] + \" \" + json.coordinates[i][y][1] + \" \";\n                      }\n                      clone_coords.innerHTML = out;\n                      clone_multilinestring.appendChild(clone_coords);\n                  }\n                  return clone_multilinestring;\n\n              case \"MULTIPOLYGON\":\n                  let m = multiPolygon.cloneNode(true);\n                  m = m.querySelector('map-multiPolygon');\n\n                  // Going over each Polygon\n                  for (let i=0;i<json.coordinates.length;i++) {\n                      let clone_polygon = polygon.cloneNode(true);\n                      clone_polygon = clone_polygon.querySelector(\"map-polygon\");\n                      \n                      // Going over each coordinates\n                      for (let y=0;y<json.coordinates[i].length;y++) {\n                          let out = \"\";\n                          let clone_coords = coords.cloneNode(true);\n                          clone_coords = clone_coords.querySelector(\"map-coordinates\");\n\n                          // Going over coordinates for the polygon\n                          for (let x=0;x<json.coordinates[i][y].length;x++) {\n                              bboxExtent = M._updateExtent(bboxExtent, json.coordinates[i][y][x][0], json.coordinates[i][y][x][1]);\n                              out = out + json.coordinates[i][y][x][0] + \" \" + json.coordinates[i][y][x][1] + \" \";\n                          }\n\n                          // Create map-coordinates element and append it to clone_polygon\n                          clone_coords.innerHTML = out;\n\n                          clone_polygon.appendChild(clone_coords);\n                      }\n                      m.appendChild(clone_polygon);\n                  }\n                  return m;\n              case \"GEOMETRYCOLLECTION\": // ---------------------------------------------------------------------------\n                  let g = geometrycollection.cloneNode(true);\n                  g = g.querySelector('map-geometrycollection');\n                  //console.log(json.geometries);\n                  for (let i=0;i<json.geometries.length;i++) {\n                      let fg = M.geojson2mapml(json.geometries[i], options, layer, bboxExtent);\n                      g.appendChild(fg);\n                  }\n                  return g;\n          }\n      }\n      //Add default bbox\n      if (setExtent){\n        layer.querySelector(\"layer-\").insertAdjacentHTML(\"afterbegin\", \"<map-meta name='extent' content='top-left-longitude=\" + bboxExtent[0] + \", top-left-latitude=\" + bboxExtent[1] + \", bottom-right-longitude=\" + bboxExtent[2] + \",bottom-right-latitude=\" + bboxExtent[3] + \"'></map-meta>\");\n      }\n      return layer.querySelector('layer-');\n    },\n\n    // Takes an array of length n to return an array of arrays with length 2, helper function\n    //    for mapml2geojson\n    // _breakArray: arr(float) -> arr(arr(float, float))\n    _breakArray: function (arr) {\n      let size = 2; \n      let arrayOfArrays = [];\n      // removing anything other than numbers, ., - (used to remove <map-span> tags)\n      arr = arr.filter(x => !(/[^\\d.-]/g.test(x))).filter(x => x);\n      for (let i=0; i<arr.length; i+=size) {\n          arrayOfArrays.push((arr.slice(i,i+size)).map(Number));\n      }\n      return arrayOfArrays;\n    },\n\n    // Takes an HTML Table to return geojson properties, helper function\n    //    for mapml2geojson\n    // _table2properties: HTML Table -> geojson\n    _table2properties: function (table) {\n      // removing thead, if it exists\n      let head = table.querySelector(\"thead\");\n      if (head !== null) {\n          table.querySelector(\"thead\").remove();\n      }\n      let json = {};\n      table.querySelectorAll('tr').forEach((tr) => {\n          let tableData = tr.querySelectorAll('th, td');\n          json[tableData[0].innerHTML] = tableData[1].innerHTML;\n      });\n      return json;\n    },\n\n    // Converts a geometry element (el) to geojson, helper function\n    //    for mapml2geojson, NOTE - el can not be a map-geometrycollection\n    // _geometry2geojson: (child of <map-geometry>), Proj4, Proj4, Bool -> geojson\n    _geometry2geojson: function (el, source, dest, transform) {\n      // remove map-a, map-span elements if the geometry is wrapped in them\n      while (el.nodeName.toUpperCase() === \"MAP-SPAN\" || \n             el.nodeName.toUpperCase() === \"MAP-A\") {\n              el = el.firstElementChild;\n      }\n      let elem = el.nodeName;\n      let j = {};\n      let coord;\n\n      switch(elem.toUpperCase()) {\n          case \"MAP-POINT\":\n              j.type = \"Point\";\n              if (transform) {\n                  let pointConv = proj4.transform(source, dest, ((el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g)).map(Number)) );\n                  j.coordinates = [pointConv.x, pointConv.y];\n              } else {\n                  j.coordinates = (el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g)).map(Number);\n              }\n              break;\n          case \"MAP-LINESTRING\":\n              j.type = \"LineString\";\n              coord = el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g);\n              coord = M._breakArray(coord);\n              if (transform) {\n                  coord = M._pcrsToGcrs(coord, source, dest);\n              }\n              j.coordinates = coord;\n              break;\n          case \"MAP-POLYGON\":\n              j.type = \"Polygon\";\n              j.coordinates = [];\n              let x = 0;\n              el.querySelectorAll('map-coordinates').forEach((coord) => {\n                  coord = coord.innerHTML.split(/[<>\\ ]/g);\n                  coord = M._breakArray(coord);\n                  if (transform) {\n                      coord = M._pcrsToGcrs(coord, source, dest);\n                  }\n                  j.coordinates[x] = coord;\n                  x++;\n              });\n              break;\n          case \"MAP-MULTIPOINT\":\n              j.type = \"MultiPoint\";\n              coord = M._breakArray(el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g));\n              if (transform) {\n                  coord = M._pcrsToGcrs(coord, source, dest);\n              }\n              j.coordinates = coord;\n              break;\n          case \"MAP-MULTILINESTRING\":\n              j.type = \"MultiLineString\";\n              j.coordinates = [];\n              let i = 0;\n              el.querySelectorAll('map-coordinates').forEach((coord) => {\n                  coord = coord.innerHTML.split(/[<>\\ ]/g);\n                  coord = M._breakArray(coord);\n                  if (transform) {\n                      coord = M._pcrsToGcrs(coord, source, dest);\n                  }\n                  j.coordinates[i] = coord;\n                  i++;\n              });\n              break;\n          case \"MAP-MULTIPOLYGON\":\n              j.type = \"MultiPolygon\";\n              j.coordinates = [];\n              let p = 0;\n              el.querySelectorAll('map-polygon').forEach((poly) => {\n                  let y = 0;\n                  j.coordinates.push([]);\n                  poly.querySelectorAll('map-coordinates').forEach((coord) => {\n                      coord = coord.innerHTML.split(/[<>\\ ]/g);\n                      coord = M._breakArray(coord);\n                      if (transform) {\n                          coord = M._pcrsToGcrs(coord, source, dest);\n                      }\n                      j.coordinates[p].push([]);\n                      j.coordinates[p][y] = coord;\n                      y++;\n                  });\n                  p++;\n              });\n              break;\n      }\n      return j;\n    },\n\n    // _pcrsToGcrs: arrof([x,y]) Proj4, Proj4 -> arrof[x,y]\n    _pcrsToGcrs: function (arr, source, dest) {\n      let newArr = [];\n      for (let i=0; i<arr.length; i++) {\n          let conv = proj4.transform(source, dest, arr[i]);\n          conv = [conv.x, conv.y];\n          newArr.push(conv);\n      }\n      return newArr;\n    },\n\n    // Takes an <layer-> element and returns a geojson feature collection object \n    // The options object can contain the following:\n    //      propertyFunction   - function(<map-properties>), A function that maps the features' <map-properties> element to   a GeoJSON \"properties\" member.\n    //      transform          - Bool, Transform coordinates to gcrs values, defaults to True\n    // mapml2geojson: <layer-> Object -> GeoJSON\n    mapml2geojson: function (element, options = {}) {\n        let defaults = {\n            propertyFunction: null,\n            transform: true\n        };\n        // assign default values for undefined options\n        options = Object.assign({}, defaults, options);\n\n        let json = {};\n        json.type = \"FeatureCollection\";\n        json.title = element.getAttribute('label');\n        json.features = [];\n\n        // Transforming Coordinates to gcrs if transformation = true and coordinate is not (EPSG:3857 or EPSG:4326)\n        let source = null;\n        let dest = null;\n        if (options.transform) {\n            source = new proj4.Proj(element.parentElement._map.options.crs.code);\n            dest = new proj4.Proj('EPSG:4326');\n            if (element.parentElement._map.options.crs.code === \"EPSG:3857\" || element.parentElement._map.options.crs.code  === \"EPSG:4326\") {\n                options.transform = false;\n            }   \n        }\n\n        // Setting all meta settings, if any\n        let metas = element.querySelectorAll(\"map-meta\");\n        metas.forEach((meta) => {\n            let name = meta.getAttribute('name');\n            if (name === \"extent\") {\n                let content = meta.getAttribute('content');\n                let arr = content.split(\",\");\n                let ex = {};\n                for (let i=0; i<arr.length; i++) {\n                    let s = arr[i].split(\"=\");\n                    s[0] = s[0].trim(); // removing whitespace\n                    s[1] = parseFloat(s[1]);\n                    ex[s[0]] = s[1];\n                }\n                json.bbox = [ex['top-left-longitude'], ex['top-left-latitude'], ex['bottom-right-longitude'], ex  ['bottom-right-latitude']];\n            }\n        });\n\n        // Iterating over each feature\n        let features = element.querySelectorAll(\"map-feature\");\n        let num = 0;\n\n        // Going over each feature in the layer\n        features.forEach((feature) => {\n            //console.log(feature);\n\n            json.features[num] = {\"type\": \"Feature\"};\n            json.features[num].geometry = {};\n            json.features[num].properties = {};\n\n            // setting properties when function presented\n            if (!feature.querySelector(\"map-properties\")) {\n              json.features[num].properties = null;\n            } else if (typeof options.propertyFunction === \"function\") {\n                let properties = options.propertyFunction(feature.querySelector(\"map-properties\"));\n                json.features[num].properties = properties;\n            } else if (feature.querySelector(\"map-properties\").querySelector('table') !== null) { \n                // setting properties when table presented\n                let table = (feature.querySelector(\"map-properties\").querySelector('table')).cloneNode(true),\n                    properties = M._table2properties(table);\n                json.features[num].properties = properties;\n            } else {\n                // when no table present, strip any possible html tags to only get text\n                json.features[num].properties = {prop0: (feature.querySelector(\"map-properties\").innerHTML).replace( /(<([^>]+)>)/ig, '')};\n            }\n\n            let geom = feature.querySelector(\"map-geometry\").firstElementChild;\n\n            // remove map-a, map-span elements if the geometry is wrapped in them\n            while (geom.nodeName.toUpperCase() === \"MAP-SPAN\" || \n                   geom.nodeName.toUpperCase() === \"MAP-A\") {\n                    geom = geom.firstElementChild;\n            }\n\n            // Adding Geometry\n            if (geom.nodeName.toUpperCase() !== \"MAP-GEOMETRYCOLLECTION\"){\n                json.features[num].geometry = M._geometry2geojson(geom, source, dest, options.transform);\n            } else {\n                json.features[num].geometry.type = \"GeometryCollection\";\n                json.features[num].geometry.geometries = [];\n\n                let geoms = geom.children;\n                Array.from(geoms).forEach((g) => {\n                  // omit all map-span, map-a that may be present in geometry-collection \n                  let n = g.nodeName.toUpperCase();\n                  if (n === \"MAP-SPAN\" || n === \"MAP-A\") {\n                    g = g.cloneNode(true);\n                    [...g.querySelectorAll(\"map-a, map-span\")].forEach(e => e.replaceWith(...e.children));\n                    Array.from(g.children).forEach((i) => {\n                      i = M._geometry2geojson(i, source, dest, options.transform);\n                      json.features[num].geometry.geometries.push(i);\n                    });\n                  } else {\n                    g = M._geometry2geojson(g, source, dest, options.transform);\n                    json.features[num].geometry.geometries.push(g);\n                  }\n                });\n            }\n            //going to next feature\n            num++;\n        });\n\n        return json;\n    },\n\n    // Takes leaflet bound, leaflet map and min and max zoom limit,\n    // return the maximum zoom level that can show the bound completely\n    // getMaxZoom: L.Bound, L.Map, Number, Number -> Number\n    getMaxZoom: function (bound, map, minZoom, maxZoom) {\n      if(!bound) return;\n\n      let newZoom = map.getZoom(),                                                                                                                                                                 \n          scale = map.options.crs.scale(newZoom),\n          mapCenterTCRS = map.options.crs.transformation.transform(bound.getCenter(true), scale);\n\n      let mapHalf = map.getSize().divideBy(2),\n          mapTlNew = mapCenterTCRS.subtract(mapHalf).round(),\n          mapBrNew = mapCenterTCRS.add(mapHalf).round();\n\n      let mapTlPCRSNew = M.pixelToPCRSPoint(mapTlNew, newZoom, map.options.projection),\n          mapBrPCRSNew = M.pixelToPCRSPoint(mapBrNew, newZoom, map.options.projection);\n\n      let mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew),\n          zOffset = mapPCRS.contains(bound) ? 1 : -1;\n\n      while((zOffset === -1 && !(mapPCRS.contains(bound)) && (newZoom - 1) >= minZoom)  ||\n            (zOffset === 1 && mapPCRS.contains(bound) && (newZoom + 1) <= maxZoom)) {\n        newZoom += zOffset;\n        scale = map.options.crs.scale(newZoom);\n        mapCenterTCRS = map.options.crs.transformation.transform(bound.getCenter(true), scale);\n\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round();\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n        mapTlPCRSNew = M.pixelToPCRSPoint(mapTlNew, newZoom, map.options.projection);\n        mapBrPCRSNew = M.pixelToPCRSPoint(mapBrNew, newZoom, map.options.projection);\n\n        mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew);\n      }\n\n      if(zOffset === 1 && newZoom - 1 >= 0 && !(newZoom === maxZoom && mapPCRS.contains(bound))) newZoom--;\n      return newZoom;\n    }\n  };\n\n  var AttributionButton = L.Control.Attribution.extend({\n  \toptions: {\n  \t\tprefix: '<a href=\"https://www.w3.org/community/maps4html/\">Maps for HTML Community Group</a> | <img src=\"data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTIiIGhlaWdodD0iOCI+PHBhdGggZmlsbD0iIzRDN0JFMSIgZD0iTTAgMGgxMnY0SDB6Ii8+PHBhdGggZmlsbD0iI0ZGRDUwMCIgZD0iTTAgNGgxMnYzSDB6Ii8+PHBhdGggZmlsbD0iI0UwQkMwMCIgZD0iTTAgN2gxMnYxSDB6Ii8+PC9zdmc+\" style=\"padding-right: 0.3em;\" alt=\"Slava Ukraini\"> <a href=\"https://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a> '\n  \t},\n\n  \tonAdd: function (map) {\n  \t\tmap.attributionControl = this;\n  \t\tthis._container = L.DomUtil.create('details', 'leaflet-control-attribution');\n  \t\tL.DomEvent.disableClickPropagation(this._container);\n\n  \t\tfor (var i in map._layers) {\n  \t\t\tif (map._layers[i].getAttribution) {\n  \t\t\t\tthis.addAttribution(map._layers[i].getAttribution());\n  \t\t\t}\n  \t\t}\n\n  \t\tthis._update();\n\n  \t\tmap.on('layeradd', this._addAttribution, this);\n\n  \t\tlet dialog = document.createElement(\"dialog\");\n  \t\tdialog.setAttribute(\"class\", \"shortcuts-dialog\");\n  \t\tdialog.setAttribute(\"autofocus\", \"\");\n  \t\tdialog.onclick = function (e) {\n  \t\t\te.stopPropagation();\n  \t\t};\n  \t\tdialog.innerHTML = `<b>${M.options.locale.kbdShortcuts} </b><button aria-label=\"Close\" onclick='this.parentElement.close()'>X</button>` +\n  \t\t\t`<ul><b>${M.options.locale.kbdMovement}</b><li><kbd>&#8593</kbd> ${M.options.locale.kbdPanUp}</li><li><kbd>&#8595</kbd> ${M.options.locale.kbdPanDown}</li><li><kbd>&#8592</kbd> ${M.options.locale.kbdPanLeft}</li><li><kbd>&#8594</kbd> ${M.options.locale.kbdPanRight}</li><li><kbd>+</kbd> ${M.options.locale.btnZoomIn}</li><li><kbd>-</kbd> ${M.options.locale.btnZoomOut}</li><li><kbd>shift</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 3x ${M.options.locale.kbdPanIncrement}</li><li><kbd>ctrl</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 0.2x ${M.options.locale.kbdPanIncrement}</li><li><kbd>shift</kbd> + <kbd>+/-</kbd> ${M.options.locale.kbdZoom}</li></ul>` +\n  \t\t\t`<ul><b>${M.options.locale.kbdFeature}</b><li><kbd>&#8592/&#8593</kbd> ${M.options.locale.kbdPrevFeature}</li><li><kbd>&#8594/&#8595</kbd> ${M.options.locale.kbdNextFeature}</li></ul>`;\n  \t\tmap._container.appendChild(dialog);\n\n  \t\treturn this._container;\n  \t},\n\n  \t_update: function () {\n  \t\tif (!this._map) { return; }\n\n  \t\tvar attribs = [];\n\n  \t\tfor (var i in this._attributions) {\n  \t\t\tif (this._attributions[i]) {\n  \t\t\t\tattribs.push(i);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar prefixAndAttribs = [];\n\n  \t\tif (this.options.prefix) {\n  \t\t\tprefixAndAttribs.push(this.options.prefix);\n  \t\t}\n  \t\tif (attribs.length) {\n  \t\t\tprefixAndAttribs.push(attribs.join(', '));\n  \t\t}\n  \t\tthis._container.innerHTML = `<summary><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" height=\"30px\" viewBox=\"0 0 24 24\" width=\"30px\" fill=\"currentColor\"><path d=\"M0 0h24v24H0V0z\" fill=\"none\"></path><path d=\"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z\"></path></svg></summary>` + '<div class=\"mapml-attribution-container\">' + `<button onclick=\"this.closest(\\'.leaflet-container\\').querySelector(\\'.shortcuts-dialog\\').showModal()\" class=\"shortcuts-button mapml-button\">${M.options.locale.kbdShortcuts}</button> | ` + prefixAndAttribs.join(' <span aria-hidden=\"true\">|</span> ') + '</div>';\n  \t\tthis._container.setAttribute(\"role\",\"group\");\n  \t\tthis._container.setAttribute(\"aria-label\",`${M.options.locale.btnAttribution}`);\n  \t}\n  });\n\n  L.Map.mergeOptions({\n  \tattributionControl: false,\n  \ttoggleableAttributionControl: true\n  });\n\n  L.Map.addInitHook(function () {\n  \tif (this.options.toggleableAttributionControl) {\n  \t\tnew AttributionButton().addTo(this);\n  \t}\n  });\n\n  var attributionButton = function (options) {\n  \treturn new AttributionButton(options);\n  };\n\n  var ReloadButton = L.Control.extend({\n    options: {\n      position: 'topleft',\n    },\n\n    onAdd: function (map) {\n      let container = L.DomUtil.create(\"div\", \"mapml-reload-button leaflet-bar\");\n\n      let link = L.DomUtil.create(\"button\", \"mapml-reload-button\", container);\n      link.innerHTML = \"<span aria-hidden='true'>&#x021BA</span>\";\n      link.title = M.options.locale.cmReload;\n      link.setAttribute(\"type\", \"button\");\n      link.classList.add(\"mapml-button\");\n      link.setAttribute('aria-label', \"Reload\");\n\n      L.DomEvent.disableClickPropagation(link);\n      L.DomEvent.on(link, 'click', L.DomEvent.stop);\n      L.DomEvent.on(link, 'click', this._goReload, this);\n\n      this._reloadButton = link;\n\n      this._updateDisabled();\n      map.on('moveend', this._updateDisabled, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('moveend', this._updateDisabled, this);\n    },\n\n    disable: function () {\n      this._disabled = true;\n      this._updateDisabled();\n      return this;\n    },\n\n    enable: function () {\n      this._disabled = false;\n      this._updateDisabled();\n      return this;\n    },\n\n    _goReload: function (e) {\n      if (!this._disabled && this._map.options.mapEl._history.length > 1) {\n        this._map.options.mapEl.reload();\n      }\n    },\n\n    _updateDisabled: function () {\n      setTimeout(() => {\n        L.DomUtil.removeClass(this._reloadButton, \"leaflet-disabled\");\n        this._reloadButton.setAttribute(\"aria-disabled\", \"false\");\n\n        if (this._map && (this._disabled || this._map.options.mapEl._history.length <= 1)) {\n          L.DomUtil.addClass(this._reloadButton, \"leaflet-disabled\");\n          this._reloadButton.setAttribute(\"aria-disabled\", \"true\");\n        }\n      }, 0);\n    }\n  });\n\n  var reloadButton = function (options) {\n    return new ReloadButton(options);\n  };\n\n  var ScaleBar = L.Control.Scale.extend({\n      options: {\n        maxWidth: 100,\n        updateWhenIdle: true,\n        position: 'bottomleft'\n      },\n\n      onAdd: function (map) {\n\n        // create output tag for screenreader to read from \n        let outputScale = \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output-scale'></output>\";\n        map._container.insertAdjacentHTML(\"beforeend\", outputScale);\n\n        // initialize _container\n        this._container = L.DomUtil.create('div','mapml-control-scale');\n        let scaleControl = L.Control.Scale.prototype.onAdd.call(this, map);\n        this._container.appendChild(scaleControl);\n        this._container.setAttribute('tabindex',0);\n        this._scaleControl = this;\n\n        // run on load\n        setTimeout(() => {\n          this._updateOutput();\n          this._focusOutput(); \n        }, 0);\n\n        // update whenever map is zoomed or dragged\n        map.on('zoomend moveend', this._updateOutput, this);\n\n        // have screenreader read out everytime the map is focused\n        this._map._container.addEventListener('focus', () => this._focusOutput());\n\n        return this._container;\n      },\n\n      onRemove: function (map) {\n        map.off('zoomend moveend', this._updateOutput, this);\n      },\n\n      getContainer: function () {\n        return this._container;\n      },\n\n      _pixelsToDistance: function (px, units) {\n        let dpi = window.devicePixelRatio * 96; // default dpi\n        if (units === \"metric\") {\n          return px / dpi * 2.54; // inches to cm\n        }\n        return px / dpi;\n      },\n\n      _scaleLength: function (scale) {\n        let scaleLength = scale.getAttribute(\"style\");\n        let finalLength = parseInt(scaleLength.match(/width:\\s*(\\d+)px/)[1]);\n\n        return finalLength;\n\n      },\n\n      _focusOutput: function () {\n        setTimeout(() => {\n          let outputFocus = this._map._container.querySelector('.mapml-screen-reader-output-scale');\n          outputFocus.textContent = \"\";\n          setTimeout(() => {\n            outputFocus.textContent = this._container.getAttribute('aria-label');\n          }, 100);\n        }, 0);\n      },\n\n      _updateOutput: function () {\n        let output = \"\";\n        let scaleLine = this._scaleControl.getContainer().getElementsByClassName('leaflet-control-scale-line')[0];\n\n        if (this.options.metric) {\n          let distance = parseFloat((this._pixelsToDistance(this._scaleLength(scaleLine),\"metric\")).toFixed(1));\n          output = `${distance} centimeters to ${scaleLine.textContent.trim()}`;\n          output = output.replace(/(\\d+)\\s*m\\b/g, \"$1 meters\");\n          output = output.replace(/ km/g, \" kilometers\");\n        } else {\n          let distance = parseFloat((this._pixelsToDistance(this._scaleLength(scaleLine),\"imperial\")).toFixed(1));\n          output = `${distance} inches to ${scaleLine.textContent.trim()}`;\n          output = output.replace(/ft/g, \"feet\");\n          output = output.replace(/mi/g, \"miles\");\n        }\n\n        this._container.setAttribute('aria-label', output);\n        this._map._container.querySelector(\".mapml-screen-reader-output-scale\").textContent = output;\n      }\n    });\n  var scaleBar = function (options) {\n  \treturn new ScaleBar(options);\n  };\n\n  var FullscreenButton = L.Control.extend({\n          options: {\n              position: 'topleft',\n              title: {\n                  'false': 'View Fullscreen',\n                  'true': 'Exit Fullscreen'\n              }\n          },\n\n          onAdd: function (map) {\n              var container = L.DomUtil.create('div', 'leaflet-control-fullscreen leaflet-bar leaflet-control');\n\n              this.link = L.DomUtil.create('a', 'leaflet-control-fullscreen-button leaflet-bar-part', container);\n              this.link.href = '#';\n              this.link.setAttribute('role', 'button');\n\n              this._map = map;\n              this._map.on('fullscreenchange', this._toggleTitle, this);\n              this._toggleTitle();\n\n              L.DomEvent.on(this.link, 'click', this._click, this);\n\n              return container;\n          },\n\n          onRemove: function (map) {\n              map.off('fullscreenchange', this._toggleTitle, this);\n          },\n\n          _click: function (e) {\n              L.DomEvent.stopPropagation(e);\n              L.DomEvent.preventDefault(e);\n              this._map.toggleFullscreen(this.options);\n          },\n\n          _toggleTitle: function() {\n              this.link.title = this.options.title[this._map.isFullscreen()];\n          }\n      });\n\n      L.Map.include({\n          isFullscreen: function () {\n              return this._isFullscreen || false;\n          },\n\n          toggleFullscreen: function (options) {\n              // the <map> element can't contain a shadow root, so we used a child <div>\n              // <mapml-viewer> can contain a shadow root, so return it directly\n              var mapEl = this.getContainer().getRootNode().host,\n                  container = mapEl.nodeName === \"DIV\" ? mapEl.parentElement : mapEl;\n              if (this.isFullscreen()) {\n                  if (options && options.pseudoFullscreen) {\n                      this._disablePseudoFullscreen(container);\n                  } else if (document.exitFullscreen) {\n                      document.exitFullscreen();\n                  } else if (document.mozCancelFullScreen) {\n                      document.mozCancelFullScreen();\n                  } else if (document.webkitCancelFullScreen) {\n                      document.webkitCancelFullScreen();\n                  } else if (document.msExitFullscreen) {\n                      document.msExitFullscreen();\n                  } else {\n                      this._disablePseudoFullscreen(container);\n                  }\n              } else {\n                  if (options && options.pseudoFullscreen) {\n                      this._enablePseudoFullscreen(container);\n                  } else if (container.requestFullscreen) {\n                      container.requestFullscreen();\n                  } else if (container.mozRequestFullScreen) {\n                      container.mozRequestFullScreen();\n                  } else if (container.webkitRequestFullscreen) {\n                      container.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n                  } else if (container.msRequestFullscreen) {\n                      container.msRequestFullscreen();\n                  } else {\n                      this._enablePseudoFullscreen(container);\n                  }\n              }\n\n          },\n\n          _enablePseudoFullscreen: function (container) {\n              L.DomUtil.addClass(container, 'leaflet-pseudo-fullscreen');\n              this._setFullscreen(true);\n              this.fire('fullscreenchange');\n          },\n\n          _disablePseudoFullscreen: function (container) {\n              L.DomUtil.removeClass(container, 'leaflet-pseudo-fullscreen');\n              this._setFullscreen(false);\n              this.fire('fullscreenchange');\n          },\n\n          _setFullscreen: function(fullscreen) {\n              this._isFullscreen = fullscreen;\n              var container = this.getContainer().getRootNode().host;\n              if (fullscreen) {\n                  L.DomUtil.addClass(container, 'mapml-fullscreen-on');\n              } else {\n                  L.DomUtil.removeClass(container, 'mapml-fullscreen-on');\n              }\n              this.invalidateSize();\n          },\n\n          _onFullscreenChange: function (e) {\n              var fullscreenElement =\n                  document.fullscreenElement ||\n                  document.mozFullScreenElement ||\n                  document.webkitFullscreenElement ||\n                  document.msFullscreenElement,\n                  mapEl = this.getContainer().getRootNode().host,\n                  container = mapEl.nodeName === \"DIV\" ? mapEl.parentElement : mapEl;\n              \n\n              if (fullscreenElement === container && !this._isFullscreen) {\n                  this._setFullscreen(true);\n                  this.fire('fullscreenchange');\n              } else if (fullscreenElement !== container && this._isFullscreen) {\n                  this._setFullscreen(false);\n                  this.fire('fullscreenchange');\n              }\n          }\n      });\n\n      L.Map.mergeOptions({\n          fullscreenControl: false\n      });\n\n      L.Map.addInitHook(function () {\n          if (this.options.fullscreenControl) {\n              this.fullscreenControl = new FullscreenButton(this.options.fullscreenControl);\n              this.addControl(this.fullscreenControl);\n          }\n\n          var fullscreenchange;\n\n          if ('onfullscreenchange' in document) {\n              fullscreenchange = 'fullscreenchange';\n          } else if ('onmozfullscreenchange' in document) {\n              fullscreenchange = 'mozfullscreenchange';\n          } else if ('onwebkitfullscreenchange' in document) {\n              fullscreenchange = 'webkitfullscreenchange';\n          } else if ('onmsfullscreenchange' in document) {\n              fullscreenchange = 'MSFullscreenChange';\n          }\n\n          if (fullscreenchange) {\n              var onFullscreenChange = L.bind(this._onFullscreenChange, this);\n\n              this.whenReady(function () {\n                  L.DomEvent.on(document, fullscreenchange, onFullscreenChange);\n              });\n\n              this.on('unload', function () {\n                  L.DomEvent.off(document, fullscreenchange, onFullscreenChange);\n              });\n          }\n      });\n\n      var fullscreenButton = function (options) {\n          return new FullscreenButton(options);\n      };\n\n  var GeolocationButton = L.Control.extend({\n    options: {\n        position: 'bottomright'\n    },\n\n    onAdd: function (map) {\n      this.locateControl = L.control.locate({\n        showPopup: false,\n        strings: {\n          title: M.options.locale.btnLocTrackOff \n        },\n        position: this.options.position,\n        locateOptions: {\n          maxZoom: 16\n        }\n      }).addTo(map);\n\n      var container = this.locateControl._container;\n      var button = this.locateControl;\n      var observer = new MutationObserver(function(mutations) {\n        if (container.classList.contains('active') && container.classList.contains('following')) {\n          container.firstChild.title = M.options.locale.btnLocTrackOn;\n          button._marker.bindTooltip(M.options.locale.btnMyLocTrackOn,{permanent:true});\n        } else if (container.classList.contains('active')) {\n          container.firstChild.title = M.options.locale.btnLocTrackLastKnown;\n          button._marker.bindTooltip(M.options.locale.btnMyLastKnownLocTrackOn);\n        } else {\n          container.firstChild.title = M.options.locale.btnLocTrackOff;\n        }\n      });\n      var observerConfig = { attributes: true, attributeFilter: ['class'] };\n      observer.observe(container, observerConfig);\n      \n      return container;\n    },\n\n    stop: function () {\n      return this.locateControl.stop();\n    }\n  });\n\n  var geolocationButton = function (options) {\n    return new GeolocationButton(options);\n  };\n\n  var Crosshair = L.Layer.extend({\n    onAdd: function (map) {\n\n      // SVG crosshair design from https://github.com/xguaita/Leaflet.MapCenterCoord/blob/master/src/icons/MapCenterCoordIcon1.svg?short_path=81a5c76\n      // Optimized with SVGOMG: https://jakearchibald.github.io/svgomg/\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><g stroke=\"#fff\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"50.028\" cy=\"50.219\" r=\"3.923\" stroke-width=\"2\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z\"/><path stroke-width=\"3\" d=\"M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z\" color=\"currentColor\" overflow=\"visible\"/></g></svg>`;\n\n      this._container = L.DomUtil.create(\"div\", \"mapml-crosshair\", map._container);\n      this._container.innerHTML = svgInnerHTML;\n      map.isFocused = false;\n      this._isQueryable = false;\n\n      map.on(\"layerchange layeradd layerremove overlayremove\", this._toggleEvents, this);\n      map.on(\"popupopen\", this._isMapFocused, this);\n      L.DomEvent.on(map._container, \"keydown keyup mousedown\", this._isMapFocused, this);\n\n      this._addOrRemoveCrosshair();\n    },\n\n    onRemove: function (map) {\n      map.off(\"layerchange layeradd layerremove overlayremove\", this._toggleEvents);\n      map.off(\"popupopen\", this._isMapFocused);\n      L.DomEvent.off(map._container, \"keydown keyup mousedown\", this._isMapFocused);\n    },\n\n    _toggleEvents: function () {\n      if (this._hasQueryableLayer()) {\n        this._map.on(\"viewreset move moveend\", this._addOrRemoveCrosshair, this);\n      } else {\n        this._map.off(\"viewreset move moveend\", this._addOrRemoveCrosshair, this);\n      }\n      this._addOrRemoveCrosshair();\n    },\n\n    _addOrRemoveCrosshair: function (e) {\n      if (this._hasQueryableLayer()) {\n        this._container.removeAttribute(\"hidden\");\n      } else {\n        this._container.setAttribute(\"hidden\", \"\");\n      }\n    },\n\n    _addOrRemoveMapOutline: function (e) {\n      let mapContainer = this._map._container;\n      if (this._map.isFocused && !this._outline) {\n        this._outline = L.DomUtil.create(\"div\", \"mapml-outline\", mapContainer);\n      } else if (!this._map.isFocused && this._outline) {\n        L.DomUtil.remove(this._outline);\n        delete this._outline;\n      }\n    },\n\n    _hasQueryableLayer: function () {\n      let layers = this._map.options.mapEl.layers;\n      if (this._map.isFocused) {\n        for (let layer of layers) {\n          if (layer.checked && layer._layer.queryable) {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    // TODO: should be merged with the 'mapfocused' event emitted by mapml-viewer and map, not trivial\n    _isMapFocused: function (e) {\n      //set this._map.isFocused = true if arrow buttons are used\n      if(!this._map._container.parentNode.activeElement){\n        this._map.isFocused = false;\n        return;\n      }\n      let isLeafletContainer = this._map._container.parentNode.activeElement.classList.contains(\"leaflet-container\");\n      if (isLeafletContainer && [\"keydown\"].includes(e.type) && (e.shiftKey && e.keyCode === 9)) {\n        this._map.isFocused = false;\n      } else this._map.isFocused = isLeafletContainer && [\"keyup\", \"keydown\"].includes(e.type);\n\n      if(this._map.isFocused) this._map.fire(\"mapkeyboardfocused\");\n      this._addOrRemoveMapOutline();\n      this._addOrRemoveCrosshair();\n    },\n\n  });\n\n\n  var crosshair = function (options) {\n    return new Crosshair(options);\n  };\n\n  /**\n   * M.Feature is a extension of L.Path that understands mapml feature markup\n   * It converts the markup to the following structure (abstract enough to encompass all feature types) for example:\n   *  this._outlinePath = HTMLElement;\n   *  this._parts = [\n   *    {\n   *      path: HTMLElement,\n   *      rings:[\n   *        {points:[{x:1,y:1}, ...]},\n   *        ...\n   *      ],\n   *      subrings:[\n   *        {points:[{x:2, y:2}, ...], cls:\"Span Class Name\", path: HTMLElement,},\n   *        ...\n   *      ],\n   *      cls:\"className\",\n   *    },\n   *    ...\n   *  ];\n   */\n  var Feature = L.Path.extend({\n\n    /**\n     * Initializes the M.Feature\n     * @param {HTMLElement} markup - The markup representation of the feature\n     * @param {Object} options - The options of the feature\n     */\n    initialize: function (markup, options) {\n      this.type = markup.tagName.toUpperCase();\n\n      if(this.type === \"MAP-POINT\" || this.type === \"MAP-MULTIPOINT\") options.fillOpacity = 1;\n\n      if(options.wrappers.length > 0)\n        options = Object.assign(this._convertWrappers(options.wrappers), options);\n      L.setOptions(this, options);\n\n      this.group = this.options.group;\n      this.options.interactive = this.options.link || (this.options.properties && this.options.onEachFeature);\n\n      this._parts = [];\n      this._markup = markup;\n      this.options.zoom = markup.getAttribute('zoom') || this.options.nativeZoom;\n\n      this._convertMarkup();\n\n      if(markup.querySelector('map-span') || markup.querySelector('map-a')){\n        this._generateOutlinePoints();\n      }\n\n      this.isClosed = this._isClosed();\n    },\n\n    /**\n     * Attaches link handler to the sub parts' paths\n     * @param {SVGElement} elem - The element to add listeners to, either path or g elements\n     * @param {Object} link - The link object that contains the url, type and target data\n     * @param leafletLayer\n     */\n    attachLinkHandler: function (elem, link, leafletLayer) {\n      let dragStart, container = document.createElement('div'), p = document.createElement('p'), hovered = false;\n      container.classList.add('mapml-link-preview');\n      container.appendChild(p);\n      elem.classList.add('map-a');\n      if (link.visited) elem.classList.add(\"map-a-visited\");\n      elem.mousedown = e => dragStart = {x:e.clientX, y:e.clientY};\n      L.DomEvent.on(elem, 'mousedown', elem.mousedown, this);\n      elem.mouseup = (e) => {\n        if (e.button !== 0) return; // don't trigger when button isn't left click\n        let onTop = true, nextLayer = this.options._leafletLayer._layerEl.nextElementSibling;\n        while(nextLayer && onTop){\n          if(nextLayer.tagName && nextLayer.tagName.toUpperCase() === \"LAYER-\")\n            onTop = !(nextLayer.checked && nextLayer._layer.queryable);\n          nextLayer = nextLayer.nextElementSibling;\n        }\n        if(onTop && dragStart) {\n          //M._handleLink gets called twice, once in the target phase on the path element, then in the bubble phase on the g element\n          //Using stopPropagation leaves the mouse in the mousedown state\n          if(e.eventPhase === Event.BUBBLING_PHASE) return;\n          let dist = Math.sqrt(Math.pow(dragStart.x - e.clientX, 2) + Math.pow(dragStart.y - e.clientY, 2));\n          if (dist <= 5){\n            link.visited = true;\n            elem.setAttribute(\"stroke\", \"#6c00a2\");\n            elem.classList.add(\"map-a-visited\");\n            M._handleLink(link, leafletLayer);\n          }\n        }\n      };\n      L.DomEvent.on(elem, \"mouseup\", elem.mouseup, this);\n      L.DomEvent.on(elem, \"keypress\", (e) => {\n        L.DomEvent.stop(e);\n        if(e.keyCode === 13 || e.keyCode === 32) {\n          link.visited = true;\n          elem.setAttribute(\"stroke\", \"#6c00a2\");\n          elem.classList.add(\"map-a-visited\");\n          M._handleLink(link, leafletLayer);\n        }\n      }, this);\n      L.DomEvent.on(elem, 'mouseenter keyup', (e) => {\n        if(e.target !== e.currentTarget) return;\n        hovered = true;\n        let resolver = document.createElement('a'), mapWidth = this._map.getContainer().clientWidth;\n        resolver.href = link.url;\n        p.innerHTML = resolver.href;\n\n        this._map.getContainer().appendChild(container);\n\n        while(p.clientWidth > mapWidth/2){\n          p.innerHTML = p.innerHTML.substring(0, p.innerHTML.length - 5) + \"...\";\n        }\n        setTimeout(()=>{\n          if(hovered) p.innerHTML = resolver.href;\n        }, 1000);\n      }, this);\n      L.DomEvent.on(elem, 'mouseout keydown mousedown', (e) => {\n        if(e.target !== e.currentTarget || !container.parentElement) return;\n        hovered = false;\n        this._map.getContainer().removeChild(container);\n      }, this);\n      L.DomEvent.on(leafletLayer._map.getContainer(),'mouseout mouseenter click', (e) => { //adds a lot of event handlers\n        if(!container.parentElement) return;\n        hovered = false;\n        this._map.getContainer().removeChild(container);\n      }, this);\n    },\n\n    /**\n     * Updates internal structure of the feature to the new map state, the structure can be found in this._parts\n     * @param {L.Map} addedMap - The map that the feature is part of, can be left blank in the case of static features\n     * @param {L.Point} tileOrigin - The tile origin for the feature, if blank then it takes the maps pixel origin in the function\n     * @param {int} zoomingTo - The zoom the map is animating to, if left blank then it takes the map zoom, its provided because in templated tiles zoom is delayed\n     * @private\n     */\n    _project: function (addedMap, tileOrigin = undefined, zoomingTo = undefined) {\n      let map = addedMap || this._map, origin = tileOrigin || map.getPixelOrigin(), zoom = zoomingTo === undefined ? map.getZoom() : zoomingTo;\n      for (let p of this._parts) {\n        p.pixelRings = this._convertRing(p.rings, map, origin, zoom);\n        for (let subP of p.subrings) {\n          subP.pixelSubrings = this._convertRing([subP], map, origin, zoom);\n        }\n      }\n      if (!this._outline) return;\n      this.pixelOutline = [];\n      for (let o of this._outline) {\n        this.pixelOutline = this.pixelOutline.concat(this._convertRing(o, map, origin, zoom));\n      }\n    },\n\n    /**\n     * Converts the PCRS points to pixel points that can be used to create the SVG\n     * @param {L.Point[][]} r - Is the rings of a feature, either the mainParts, subParts or outline\n     * @param {L.Map} map - The map that the feature is part of\n     * @param {L.Point} origin - The origin used to calculate the pixel points\n     * @param {int} zoom - The current zoom level of the map\n     * @returns {L.Point[][]}\n     * @private\n     */\n    _convertRing: function (r, map, origin, zoom) {\n      // TODO: Implement Ramer-Douglas-Peucer Algo for simplifying points\n      let scale = map.options.crs.scale(zoom), parts = [];\n      for (let sub of r) {\n        let interm = [];\n        for (let p of sub.points) {\n          let conv = map.options.crs.transformation.transform(p, scale);\n          interm.push(L.point(conv.x, conv.y)._subtract(origin).round());\n        }\n        parts.push(interm);\n      }\n      return parts;\n    },\n\n    /**\n     * Updates the features\n     * @private\n     */\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updateFeature(this);\n    },\n\n    /**\n     * Converts the map-spans, a and divs around a geometry subtype into options for the feature\n     * @param {HTMLElement[]} elems - The current zoom level of the map\n     * @private\n     */\n    _convertWrappers: function (elems) {\n      if(!elems || elems.length === 0) return;\n      let classList = '', output = {};\n      for(let elem of elems){\n        if(elem.tagName.toUpperCase() !== \"MAP-A\" && elem.className){\n          classList +=`${elem.className} `;\n        } else if(!output.link && elem.getAttribute(\"href\")) {\n          let link = {};\n          link.url = elem.getAttribute(\"href\");\n          if(elem.hasAttribute(\"target\")) link.target = elem.getAttribute(\"target\");\n          if(elem.hasAttribute(\"type\")) link.type = elem.getAttribute(\"type\");\n          if(elem.hasAttribute(\"inplace\")) link.inPlace = true;\n          output.link = link;\n        }\n      }\n      output.className = `${classList} ${this.options.className}`.trim();\n      return output;\n    },\n\n    /**\n     * Converts this._markup to the internal structure of features\n     * @private\n     */\n    _convertMarkup: function () {\n      if (!this._markup) return;\n\n      let attr = this._markup.attributes;\n      this.featureAttributes = {};\n      if(this.options.link && this._markup.parentElement.tagName.toUpperCase() === \"MAP-A\" && this._markup.parentElement.parentElement.tagName.toUpperCase() !== \"MAP-GEOMETRY\")\n        this.featureAttributes.tabindex = \"0\";\n      for(let i = 0; i < attr.length; i++){\n        this.featureAttributes[attr[i].name] = attr[i].value;\n      }\n\n      let first = true;\n      for (let c of this._markup.querySelectorAll('map-coordinates')) {              //loops through the coordinates of the child\n        let ring = [], subRings = [];\n        this._coordinateToArrays(c, ring, subRings, this.options.className);              //creates an array of pcrs points for the main ring and the subparts\n        if (!first && this.type === \"MAP-POLYGON\") {\n          this._parts[0].rings.push(ring[0]);\n          if (subRings.length > 0)\n            this._parts[0].subrings = this._parts[0].subrings.concat(subRings);\n        } else if (this.type === \"MAP-MULTIPOINT\") {\n          for (let point of ring[0].points.concat(subRings)) {\n            this._parts.push({ rings: [{ points: [point] }], subrings: [], cls:`${point.cls || \"\"} ${this.options.className || \"\"}`.trim() });\n          }\n        } else {\n          this._parts.push({ rings: ring, subrings: subRings, cls: `${this.featureAttributes.class || \"\"} ${this.options.className || \"\"}`.trim() });\n        }\n        first = false;\n      }\n    },\n\n    /**\n     * Generates the feature outline, subtracting the map-spans to generate those separately\n     * @private\n     */\n    _generateOutlinePoints: function () {\n      if (this.type === \"MAP-MULTIPOINT\" || this.type === \"MAP-POINT\" || this.type === \"MAP-LINESTRING\" || this.type === \"MAP-MULTILINESTRING\") return;\n\n      this._outline = [];\n      for (let coords of this._markup.querySelectorAll('map-coordinates')) {\n        let nodes = coords.childNodes, cur = 0, tempDiv = document.createElement('div'), nodeLength = nodes.length;\n        for(let i = 0; i < nodes.length; i++){\n          if(nodes[i].textContent.trim().length === 0){\n            nodes[i].remove();\n          }\n        }\n        for (let n of nodes) {\n          let line = [];\n          if (!n.tagName) {  //no tagName means it's text content\n            let c = '', ind = (((cur - 1)%nodes.length) + nodes.length) % nodes.length; // this equation turns Javascript's % to how it behaves in C for example\n            if (nodes[ind].tagName) {\n              let prev = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${prev[prev.length - 2]} ${prev[prev.length - 1]} `;\n            }\n            c += n.textContent;\n            ind = (((cur + 1)%nodes.length) + nodes.length) % nodes.length; // this is equivalent to C/C++'s (cur + 1) % nodes.length\n            if (nodes[ind].tagName) {\n              let next = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${next[0]} ${next[1]} `;\n            }\n            tempDiv.innerHTML = c;\n            this._coordinateToArrays(tempDiv, line, [], true, this.featureAttributes.class || this.options.className);\n            this._outline.push(line);\n          }\n          cur++;\n        }\n      }\n    },\n\n    /**\n     * Converts map-coordinates element to an object representing the parts and subParts\n     * @param {HTMLElement} coords - A single map-coordinates element\n     * @param {Object[]} main - An empty array representing the main parts\n     * @param {Object[]} subParts - An empty array representing the sub parts\n     * @param {boolean} isFirst - A true | false representing if the current HTML element is the parent map-coordinates element or not\n     * @param {string} cls - The class of the coordinate/span\n     * @param parents\n     * @private\n     */\n    _coordinateToArrays: function (coords, main, subParts, isFirst = true, cls = undefined, parents = []) {\n      for (let span of coords.children) {\n        this._coordinateToArrays(span, main, subParts, false, span.getAttribute(\"class\"), parents.concat([span]));\n      }\n      let noSpan = coords.textContent.replace(/(<([^>]+)>)/ig, ''),\n          pairs = noSpan.match(/(\\S+\\s+\\S+)/gim), local = [], bounds;\n      for (let p of pairs) {\n        let numPair = [];\n        p.split(/\\s+/gim).forEach(M._parseNumber, numPair);\n        let point = M.pointToPCRSPoint(L.point(numPair), this.options.zoom, this.options.projection, this.options.nativeCS);\n        local.push(point);\n        bounds = bounds ? bounds.extend(point) : L.bounds(point, point);\n      }\n      if (this._bounds) {\n        this._bounds.extend(bounds.min);\n        this._bounds.extend(bounds.max);\n      } else {\n        this._bounds = bounds;\n      }\n      if (isFirst) {\n        main.push({ points: local });\n      } else {\n        let attrMap = {}, attr = coords.attributes, wrapperAttr = this._convertWrappers(parents);\n        if(wrapperAttr.link) attrMap.tabindex = \"0\";\n        for(let i = 0; i < attr.length; i++){\n          if(attr[i].name === \"class\") continue;\n          attrMap[attr[i].name] = attr[i].value;\n        }\n        subParts.unshift({\n          points: local,\n          center: bounds.getCenter(),\n          cls: `${cls || \"\"} ${wrapperAttr.className || \"\"}`.trim(),\n          attr: attrMap,\n          link: wrapperAttr.link,\n          linkTarget: wrapperAttr.linkTarget,\n          linkType: wrapperAttr.linkType});\n      }\n    },\n\n    /**\n     * Returns if the feature is closed or open, useful when styling\n     * @returns {boolean}\n     * @private\n     */\n    _isClosed: function () {\n      switch (this.type) {\n        case 'MAP-POLYGON':\n        case 'MAP-MULTIPOLYGON':\n        case 'MAP-POINT':\n        case 'MAP-MULTIPOINT':\n          return true;\n        case 'MAP-LINESTRING':\n        case 'MAP-MULTILINESTRING':\n          return false;\n        default:\n          return false;\n      }\n    },\n\n    /**\n     * Returns the center of the entire feature\n     * @returns {L.Point}\n     */\n    getCenter: function () {\n      if (!this._bounds) return null;\n      return this._map.options.crs.unproject(this._bounds.getCenter());\n    },\n\n    getPCRSCenter: function () {\n      return this._bounds.getCenter();\n    },\n  });\n\n  /**\n   *\n   * @param {HTMLElement} markup - The markup of the feature\n   * @param {Object} options - Options of the feature\n   * @returns {M.Feature}\n   */\n  var feature = function (markup, options) {\n    return new Feature(markup, options);\n  };\n\n  /**\n   * Returns a new Feature Renderer\n   * @param {Object} options - Options for the renderer\n   * @returns {*}\n   */\n  var FeatureRenderer = L.SVG.extend({\n    /**\n     * Override method of same name from L.SVG, use the this._container property\n     * to set up the role=\"none presentation\" on featureGroupu container,\n     * per this recommendation: \n     * https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/471#issuecomment-845192246\n     * @private overrides ancestor method so that we have a _container to work with\n     */\n    _initContainer: function () {\n      // call the method we're overriding, per https://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      // note you have to pass 'this' as the first arg\n      L.SVG.prototype._initContainer.call(this);\n      // knowing that the previous method call creates the this._container, we\n      // access it and set the role=\"none presetation\" which suppresses the \n      // announcement of \"Graphic\" on each feature focus.\n      this._container.setAttribute('role', 'none presentation');\n    },\n    \n    /**\n     * Creates all the appropriate path elements for a M.Feature\n     * @param {M.Feature} layer - The M.Feature that needs paths generated\n     * @param {boolean} stampLayer - Whether or not a layer should be stamped and stored in the renderer layers\n     * @private\n     */\n    _initPath: function (layer, stampLayer = true) {\n\n      if(layer._outline) {\n        let outlinePath = L.SVG.create('path');\n        if (layer.options.className) L.DomUtil.addClass(outlinePath, layer.featureAttributes.class || layer.options.className);\n        L.DomUtil.addClass(outlinePath, 'mapml-feature-outline');\n        outlinePath.style.fill = \"none\";\n        layer.outlinePath = outlinePath;\n      }\n\n      //creates the main parts and sub parts paths\n      for (let p of layer._parts) {\n        if (p.rings){\n          this._createPath(p, layer.options.className, layer.featureAttributes['aria-label'], layer.options.interactive, layer.featureAttributes);\n          if(layer.outlinePath) p.path.style.stroke = \"none\";\n        }\n        if (p.subrings) {\n          for (let r of p.subrings) {\n            this._createPath(r, layer.options.className, r.attr['aria-label'], (r.link !== undefined), r.attr);\n          }\n        }\n        this._updateStyle(layer);\n      }\n      if(stampLayer){\n        let stamp = L.stamp(layer);\n        this._layers[stamp] = layer;\n      }\n    },\n\n    /**\n     * Creates paths for either mainParts, subParts or outline of a feature\n     * @param {Object} ring - The ring the current path is being generated for\n     * @param {string} title - The accessible aria-label of a path\n     * @param {string} cls - The class of the path\n     * @param {boolean} interactive - The boolean representing whether a feature is interactive or not\n     * @param {Object} attr - Attributes map\n     * @private\n     */\n    _createPath: function (ring, cls, title, interactive = false, attr = undefined) {\n      let p = L.SVG.create('path');\n      ring.path = p;\n      if(!attr) {\n        if (title) p.setAttribute('aria-label', title);\n      } else {\n        for(let [name, value] of Object.entries(attr)){\n          if(name === \"id\" || name === \"tabindex\") continue;\n          p.setAttribute(name, value);\n        }\n      }\n      if (ring.cls || cls) {\n        L.DomUtil.addClass(p, ring.cls || cls);\n      }\n      if (interactive) {\n        L.DomUtil.addClass(p, 'leaflet-interactive');\n      }\n    },\n\n    /**\n     * Adds all the paths needed for a feature\n     * @param {M.Feature} layer - The feature that needs it's paths added\n     * @param {HTMLElement} container - The location the paths need to be added to\n     * @param {boolean} interactive - Whether a feature is interactive or not\n     * @private\n     */\n    _addPath: function (layer, container = undefined, interactive = true) {\n      if (!this._rootGroup && !container) { this._initContainer(); }\n      let c = container || this._rootGroup, outlineAdded = false;\n      if(interactive) {\n        layer.addInteractiveTarget(layer.group);\n      }\n      for (let p of layer._parts) {\n        if (p.path)\n          layer.group.appendChild(p.path);\n        if (interactive){\n          if(layer.options.link) layer.attachLinkHandler(p.path, layer.options.link, layer.options._leafletLayer);\n          layer.addInteractiveTarget(p.path);\n        }\n\n        if(!outlineAdded && layer.pixelOutline) {\n          layer.group.appendChild(layer.outlinePath);\n          outlineAdded = true;\n        }\n\n        for (let subP of p.subrings) {\n          if (subP.path) {\n            if (subP.link){\n              layer.attachLinkHandler(subP.path, subP.link, layer.options._leafletLayer);\n              layer.addInteractiveTarget(subP.path);\n            }\n            layer.group.appendChild(subP.path);\n          }\n        }\n      }\n      c.appendChild(layer.group);\n    },\n\n    /**\n     * Removes all the paths related to a feature\n     * @param {M.Feature} layer - The feature who's paths need to be removed\n     * @private\n     */\n    _removePath: function (layer) {\n      for (let p of layer._parts) {\n        if (p.path) {\n          layer.removeInteractiveTarget(p.path);\n          L.DomUtil.remove(p.path);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path)\n            L.DomUtil.remove(subP.path);\n        }\n      }\n      if(layer.outlinePath) L.DomUtil.remove(layer.outlinePath);\n      layer.removeInteractiveTarget(layer.group);\n      L.DomUtil.remove(layer.group);\n      delete this._layers[L.stamp(layer)];\n    },\n\n    /**\n     * Updates the d attribute of all paths of a feature\n     * @param {M.Feature} layer - The Feature that needs updating\n     * @private\n     */\n    _updateFeature: function (layer) {\n      if (layer.pixelOutline) this._setPath(layer.outlinePath, this.geometryToPath(layer.pixelOutline, false));\n      for (let p of layer._parts) {\n        this._setPath(p.path, this.geometryToPath(p.pixelRings, layer.isClosed));\n        for (let subP of p.subrings) {\n          this._setPath(subP.path, this.geometryToPath(subP.pixelSubrings, false));\n        }\n      }\n    },\n\n    /**\n     * Generates the marker d attribute for a given point\n     * @param {L.Point} p - The point of the marker\n     * @returns {string}\n     * @private\n     */\n    _pointToMarker: function (p) {\n      return `M${p.x} ${p.y} L${p.x - 12.5} ${p.y - 30} C${p.x - 12.5} ${p.y - 50}, ${p.x + 12.5} ${p.y - 50}, ${p.x + 12.5} ${p.y - 30} L${p.x} ${p.y}z`;\n    },\n\n    /**\n     * Updates the styles of all paths of a feature\n     * @param {M.Feature} layer - The feature that needs styles updated\n     * @private\n     */\n    _updateStyle: function (layer) {\n      this._updatePathStyle(layer.outlinePath, layer, false, true);\n      for (let p of layer._parts) {\n        if (p.path) {\n          this._updatePathStyle(p.path, layer, true);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path)\n            this._updatePathStyle(subP.path, layer);\n        }\n      }\n    },\n\n    /**\n     * Updates the style of a single path\n     * @param {HTMLElement} path - The path that needs updating\n     * @param {M.Feature} layer - The feature layer\n     * @param {boolean} isMain - Whether it's the main parts or not\n     * @param {boolean} isOutline - Whether a path is an outline or not\n     * @private\n     */\n    _updatePathStyle: function (path, layer, isMain = false, isOutline = false) {\n      if (!path || !layer) { return; }\n      let options = layer.options, isClosed = layer.isClosed;\n      if ((options.stroke && (!isClosed || isOutline)) || (isMain && !layer.outlinePath)) {\n        path.setAttribute('stroke', options.color);\n        path.setAttribute('stroke-opacity', options.opacity);\n        path.setAttribute('stroke-width', options.weight);\n        path.setAttribute('stroke-linecap', options.lineCap);\n        path.setAttribute('stroke-linejoin', options.lineJoin);\n\n        if (options.dashArray) {\n          path.setAttribute('stroke-dasharray', options.dashArray);\n        } else {\n          path.removeAttribute('stroke-dasharray');\n        }\n\n        if (options.dashOffset) {\n          path.setAttribute('stroke-dashoffset', options.dashOffset);\n        } else {\n          path.removeAttribute('stroke-dashoffset');\n        }\n\n        if (options.link){\n          path.setAttribute(\"stroke\", options.link.visited?\"#6c00a2\":\"#0000EE\");\n          path.setAttribute(\"stroke-opacity\", \"1\");\n          path.setAttribute(\"stroke-width\", \"1px\");\n          path.setAttribute(\"stroke-dasharray\", \"none\");\n        }\n      } else {\n        path.setAttribute('stroke', 'none');\n      }\n\n      if(isClosed && !isOutline) {\n        if (!options.fill) {\n          path.setAttribute('fill', options.fillColor || options.color);\n          path.setAttribute('fill-opacity', options.fillOpacity);\n          path.setAttribute('fill-rule', options.fillRule || 'evenodd');\n        } else {\n          path.setAttribute('fill', options.color);\n        }\n      } else {\n        path.setAttribute('fill', 'none');\n      }\n    },\n\n    /**\n     * Sets the d attribute of a path\n     * @param {HTMLElement} path - The path that is being updated\n     * @param {string} def - The new d attribute of the path\n     * @private\n     */\n    _setPath: function (path, def) {\n      path.setAttribute('d', def);\n    },\n\n    /**\n     * Generates the d string of a feature part\n     * @param {L.Point[]} rings - The points making up a given part of a feature\n     * @param {boolean} closed - Whether a feature is closed or not\n     * @returns {string}\n     */\n    geometryToPath: function (rings, closed) {\n      let str = '', i, j, len, len2, points, p;\n\n      for (i = 0, len = rings.length; i < len; i++) {\n        points = rings[i];\n        if (points.length === 1) {\n          return this._pointToMarker(points[0]);\n        }\n        for (j = 0, len2 = points.length; j < len2; j++) {\n          p = points[j];\n          str += (j ? 'L' : 'M') + p.x + ' ' + p.y;\n        }\n        str += closed ? 'z' : '';\n      }\n      return str || 'M0 0';\n    },\n  });\n\n  /**\n   * Returns new M.FeatureRenderer\n   * @param {Object} options - Options for the renderer\n   * @returns {M.FeatureRenderer}\n   */\n  var featureRenderer = function (options) {\n    return new FeatureRenderer(options);\n  };\n\n  var FeatureGroup = L.FeatureGroup.extend({\n\n    /**\n     * Initialize the feature group\n     * @param {M.Feature[]} layers\n     * @param {Object} options\n     */\n    initialize: function (layers, options) {\n      if(options.wrappers && options.wrappers.length > 0)\n        options = Object.assign(M.Feature.prototype._convertWrappers(options.wrappers), options);\n\n      L.LayerGroup.prototype.initialize.call(this, layers, options);\n      this._featureEl = this.options.mapmlFeature;\n\n      if((this.options.onEachFeature && this.options.properties) || this.options.link) {\n        L.DomUtil.addClass(this.options.group, \"leaflet-interactive\");\n        let firstLayer = layers[Object.keys(layers)[0]];\n        if(layers.length === 1 && firstLayer.options.link) this.options.link = firstLayer.options.link;\n        if(this.options.link){\n          M.Feature.prototype.attachLinkHandler.call(this, this.options.group, this.options.link, this.options._leafletLayer);\n          this.options.group.setAttribute('role', 'link');\n        } else {\n          this.options.group.setAttribute(\"aria-expanded\", \"false\");\n          this.options.group.setAttribute('role', 'button');\n          this.options.onEachFeature(this.options.properties, this);\n          this.off(\"click\", this._openPopup);\n        }\n      }\n      \n      L.DomEvent.on(this.options.group, \"keyup keydown\", this._handleFocus, this);\n      this.options.group.setAttribute('aria-label', this.options.accessibleTitle);\n      if(this.options.featureID) this.options.group.setAttribute(\"data-fid\", this.options.featureID);\n      for (let feature of layers) {\n        feature._groupLayer = this;\n      }\n    },\n\n    onAdd: function (map) {\n      L.LayerGroup.prototype.onAdd.call(this, map);\n      this.updateInteraction();\n    },\n\n    updateInteraction: function () {\n      let map = this._map || this.options._leafletLayer._map;\n      if(this.options.onEachFeature || this.options.link)\n        map.featureIndex.addToIndex(this, this.getPCRSCenter(), this.options.group);\n\n      for (let layerID in this._layers) {\n        let layer = this._layers[layerID];\n        for(let part of layer._parts){\n          if(layer.featureAttributes && layer.featureAttributes.tabindex)\n            map.featureIndex.addToIndex(layer, layer.getPCRSCenter(), part.path);\n          for(let subPart of part.subrings) {\n            if(subPart.attr && subPart.attr.tabindex) map.featureIndex.addToIndex(layer, subPart.center, subPart.path);\n          }\n        }\n      }\n    },\n\n    /**\n     * Check whether the feature group should be rendered at current map zoom level\n     * @param {Number} zoom - current map zoom\n     * @param {Object} vectorMinZoom - the minimum zoom bound of vector layer\n     * @param {Object} vectorMinZoom - the maximum zoom bound of vector layer\n     * @returns {Boolean}\n     * @private\n     */\n    _checkRender: function(zoom, vectorMinZoom, vectorMaxZoom) {\n      let minZoom = this._featureEl.getAttribute('min'),\n          maxZoom = this._featureEl.getAttribute('max');\n      // if the current map zoom falls below/above the zoom bounds of the vector layer\n      if (zoom > vectorMaxZoom || zoom < vectorMinZoom) return false;\n      // if no min and max attribute present\n      if (minZoom === null && maxZoom === null) return true;\n      // if the current map zoom falls below/above the [min, max] range\n      if ((minZoom !== null && zoom < +minZoom) || (maxZoom !== null && zoom > +maxZoom)) {\n        return false;\n      }\n      return true;\n    },\n\n    /**\n     * Handler for focus events\n     * @param {L.DOMEvent} e - Event that occurred\n     * @private\n     */\n    _handleFocus: function(e) {\n      // tab, shift, cr, esc, up, left, down, right, \n      if(([9, 16, 27, 37, 38, 39, 40].includes(e.keyCode)) && e.type === \"keydown\"){\n        let index = this._map.featureIndex.currentIndex;\n        // Down/right arrow keys replicate tabbing through the feature index\n        // Up/left arrow keys replicate shift-tabbing through the feature index\n        if(e.keyCode === 37 || e.keyCode === 38) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\"tabindex\", -1);\n          if(index === 0) {\n            this._map.featureIndex.inBoundFeatures[this._map.featureIndex.inBoundFeatures.length - 1].path.focus();\n            this._map.featureIndex.currentIndex = this._map.featureIndex.inBoundFeatures.length - 1;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index - 1].path.focus();\n            this._map.featureIndex.currentIndex--;\n          }\n        } else if (e.keyCode === 39 || e.keyCode === 40) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\"tabindex\", -1);\n          if(index === this._map.featureIndex.inBoundFeatures.length - 1) {\n            this._map.featureIndex.inBoundFeatures[0].path.focus();\n            this._map.featureIndex.currentIndex = 0;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index + 1].path.focus();\n            this._map.featureIndex.currentIndex++;\n          }\n        } else if(e.keyCode === 27){\n          let shadowRoot = this._map.options.mapEl.shadowRoot ? this._map.options.mapEl.shadowRoot :\n              this._map.options.mapEl.querySelector(\".mapml-web-map\").shadowRoot;\n          if(shadowRoot.activeElement.nodeName !== \"g\") return;\n          this._map._container.focus();\n        } else if (e.keyCode === 9) {\n          let obj = this;\n          setTimeout(function () {\n            obj._map.featureIndex.inBoundFeatures[0].path.setAttribute(\"tabindex\", 0);\n          }, 0);\n        }\n        // tab, shift, cr, esc, right, left, up, down, \n        // 1, 2, 3, 4, 5, 6, 7 (featureIndexOverlay available index items \n        // [8, 9] being allocated to next, previous menu items).\n      } else if (!([9, 16, 13, 27, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55].includes(e.keyCode))){\n        this._map.featureIndex.currentIndex = 0;\n        this._map.featureIndex.inBoundFeatures[0].path.focus();\n      }\n    \n      // 27 added so that the tooltip opens when dismissing popup with 'esc' key\n      if(e.target.tagName.toUpperCase() !== \"G\") return;\n      if(([9, 13, 16, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55, 27].includes(e.keyCode)) && e.type === \"keyup\") {\n        this.openTooltip();\n      } else if (e.keyCode === 13 || e.keyCode === 32){\n        this.closeTooltip();\n        if(!this.options.link && this.options.onEachFeature){\n          L.DomEvent.stop(e);\n          this.openPopup();\n        }\n      } else {\n        this.closeTooltip();\n      }\n    },\n\n    /**\n     * Add a M.Feature to the M.FeatureGroup\n     * @param layer\n     */\n    addLayer: function (layer) {\n      if(!layer.options.link && layer.options.interactive) {\n        this.options.onEachFeature(this.options.properties, layer);\n      }\n      L.FeatureGroup.prototype.addLayer.call(this, layer);\n    },\n\n    /**\n     * Focuses the previous function in the sequence on previous button press\n     * @param e\n     * @private\n     */\n    _previousFeature: function(e){\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.max(this._map.featureIndex.currentIndex - 1, 0);\n      let prevFocus = this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];\n      prevFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    /**\n     * Focuses next feature in sequence\n     * @param e\n     * @private\n     */\n    _nextFeature: function(e){\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.min(this._map.featureIndex.currentIndex + 1, this._map.featureIndex.inBoundFeatures.length - 1);\n      let nextFocus = this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];\n      nextFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    getPCRSCenter: function () {\n      let bounds;\n      for(let l in this._layers){\n        let layer = this._layers[l];\n        if (!bounds) {\n          bounds = L.bounds(layer.getPCRSCenter(), layer.getPCRSCenter());\n        } else {\n          bounds.extend(layer.getPCRSCenter());\n        }\n      }\n      return bounds.getCenter();\n    },\n  });\n\n  /**\n   * Returns new M.FeatureGroup\n   * @param {M.Feature[]} layers - Layers belonging to feature group\n   * @param {Object} options - Options for the feature group\n   * @returns {M.FeatureGroup}\n   */\n  var featureGroup = function (layers, options) {\n    return new FeatureGroup(layers, options);\n  };\n\n  var AnnounceMovement = L.Handler.extend({\n      addHooks: function () {\n          this._map.on({\n              layeradd: this.totalBounds,\n              layerremove: this.totalBounds,\n          });\n\n          this._map.options.mapEl.addEventListener('moveend', this.announceBounds);\n          this._map.dragging._draggable.addEventListener('dragstart', this.dragged);\n          this._map.options.mapEl.addEventListener('mapfocused', this.focusAnnouncement);\n      },\n      removeHooks: function () {\n          this._map.off({\n              layeradd: this.totalBounds,\n              layerremove: this.totalBounds,\n          });\n\n          this._map.options.mapEl.removeEventListener('moveend', this.announceBounds);\n          this._map.dragging._draggable.removeEventListener('dragstart', this.dragged);\n          this._map.options.mapEl.removeEventListener('mapfocused', this.focusAnnouncement);\n      },\n\n      focusAnnouncement: function () {\n           let mapEl = this;\n           setTimeout(function (){\n               let el = mapEl.querySelector(\".mapml-web-map\") ? mapEl.querySelector(\".mapml-web-map\").shadowRoot.querySelector(\".leaflet-container\") :\n                   mapEl.shadowRoot.querySelector(\".leaflet-container\");\n\n               let mapZoom = mapEl._map.getZoom();\n               let location = M._gcrsToTileMatrix(mapEl);\n               let standard = M.options.locale.amZoom + \" \" + mapZoom; \n               \n               if(mapZoom === mapEl._map._layersMaxZoom){\n                   standard = M.options.locale.amMaxZoom + \" \" + standard;\n               }\n               else if(mapZoom === mapEl._map._layersMinZoom){\n                   standard = M.options.locale.amMinZoom + \" \" + standard;\n               }\n\n               el.setAttribute(\"aria-roledescription\", \"region \" + standard);\n               setTimeout(function () {\n                   el.removeAttribute(\"aria-roledescription\");\n               }, 2000);\n           }, 0);\n       },\n\n      announceBounds: function () {\n          if(this._traversalCall > 0){\n              return;\n          }\n          let mapZoom = this._map.getZoom();\n          let mapBounds = M.pixelToPCRSBounds(this._map.getPixelBounds(),mapZoom,this._map.options.projection);\n\n          let visible = true;\n          if(this._map.totalLayerBounds){\n              visible = mapZoom <= this._map._layersMaxZoom && mapZoom >= this._map._layersMinZoom &&\n                  this._map.totalLayerBounds.overlaps(mapBounds);\n          }\n\n          let output = this.querySelector(\".mapml-web-map\") ? this.querySelector(\".mapml-web-map\").shadowRoot.querySelector(\".mapml-screen-reader-output\") :\n              this.shadowRoot.querySelector(\".mapml-screen-reader-output\");\n\n          //GCRS to TileMatrix\n          let location = M._gcrsToTileMatrix(this);\n          let standard = M.options.locale.amZoom + \" \" + mapZoom;\n\n          if(!visible){\n              let outOfBoundsPos = this._history[this._historyIndex];\n              let inBoundsPos = this._history[this._historyIndex - 1];\n              this.back();\n              this._history.pop();\n\n              if(outOfBoundsPos.zoom !== inBoundsPos.zoom){\n                  output.innerText = M.options.locale.amZoomedOut;\n              }\n              else if(this._map.dragging._draggable.wasDragged){\n                  output.innerText = M.options.locale.amDraggedOut;\n              }\n              else if(outOfBoundsPos.x > inBoundsPos.x){\n                  output.innerText = M.options.locale.amEastBound;\n              }\n              else if(outOfBoundsPos.x < inBoundsPos.x){\n                  output.innerText = M.options.locale.amWestBound;\n              }\n              else if(outOfBoundsPos.y < inBoundsPos.y){\n                  output.innerText = M.options.locale.amNorthBound;\n              }\n              else if(outOfBoundsPos.y > inBoundsPos.y){\n                  output.innerText = M.options.locale.amSouthBound;\n              }\n\n          }\n          else {\n              let prevZoom = this._history[this._historyIndex - 1] ? this._history[this._historyIndex - 1].zoom : this._history[this._historyIndex].zoom;\n              if(mapZoom === this._map._layersMaxZoom && mapZoom !== prevZoom){\n                  output.innerText = M.options.locale.amMaxZoom + \" \" + standard;\n              }\n              else if(mapZoom === this._map._layersMinZoom && mapZoom !== prevZoom){\n                  output.innerText = M.options.locale.amMinZoom + \" \" + standard;\n              }\n              else {\n                  output.innerText = standard;\n              }\n          }\n          this._map.dragging._draggable.wasDragged = false;\n      },\n\n      totalBounds: function () {\n          let layers = Object.keys(this._layers);\n          let bounds = L.bounds();\n\n          layers.forEach(i => {\n              if(this._layers[i].layerBounds){\n                  if(!bounds){\n                      let point = this._layers[i].layerBounds.getCenter();\n                      bounds = L.bounds(point, point);\n                  }\n                  bounds.extend(this._layers[i].layerBounds.min);\n                  bounds.extend(this._layers[i].layerBounds.max);\n              }\n          });\n\n          this.totalLayerBounds = bounds;\n      },\n\n      dragged: function () {\n          this.wasDragged = true;\n      }\n\n  });\n\n  var FeatureIndex = L.Handler.extend({\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.inBoundFeatures = [];\n      this.outBoundFeatures = [];\n      this.currentIndex = 0;\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection);\n    },\n\n    addHooks: function () {\n      this._map.on(\"mapkeyboardfocused\", this._updateMapBounds, this);\n      this._map.on('mapkeyboardfocused', this._sortIndex, this);\n    },\n\n    removeHooks: function () {\n      this._map.off(\"mapkeyboardfocused\", this._updateMapBounds);\n      this._map.off('mapkeyboardfocused', this._sortIndex);\n    },\n\n    /**\n     * Adds a svg element to the index of tabbable features, it also keeps track of the layer it's associated + center\n     * @param layer - the layer object the feature is associated with\n     * @param lc - the layer center\n     * @param path - the svg element that needs to be focused, can be a path or g\n     */\n    addToIndex: function (layer, lc, path) {\n      let mc = this._mapPCRSBounds.getCenter();\n      let dist = Math.sqrt(Math.pow(lc.x - mc.x, 2) + Math.pow(lc.y - mc.y, 2));\n      let index = this._mapPCRSBounds.contains(lc) ? this.inBoundFeatures : this.outBoundFeatures;\n\n      let elem = {path: path, layer: layer, center: lc, dist: dist};\n      path.setAttribute(\"tabindex\", -1);\n\n      index.push(elem);\n\n      // TODO: this insertion loop has potential to be improved slightly\n      for (let i = index.length - 1; i > 0 && index[i].dist < index[i-1].dist; i--) {\n        let tmp = index[i];\n        index[i] = index[i-1];\n        index[i-1] = tmp;\n      }\n\n      if (this._mapPCRSBounds.contains(lc))\n        this.inBoundFeatures = index;\n      else\n        this.outBoundFeatures = index;\n    },\n\n    /**\n     * Removes features that are no longer on the map, also moves features to the respective array depending\n     * on whether the feature is in the maps viewport or not\n     */\n    cleanIndex: function() {\n      this.currentIndex = 0;\n      this.inBoundFeatures = this.inBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute(\"tabindex\", -1);\n        if (elem.layer._map && !inbound) {\n          this.outBoundFeatures.push(elem);\n        }\n        return elem.layer._map && inbound;\n      });\n      this.outBoundFeatures = this.outBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute(\"tabindex\", -1);\n        if (elem.layer._map && inbound) {\n          this.inBoundFeatures.push(elem);\n        }\n        return elem.layer._map && !inbound;\n      });\n    },\n\n    /**\n     * Sorts the index of features in the map's viewport based on distance from center\n     * @private\n     */\n    _sortIndex: function() {\n      this.cleanIndex();\n      if(this.inBoundFeatures.length === 0) return;\n\n      let mc = this._mapPCRSBounds.getCenter();\n\n      this.inBoundFeatures.sort(function(a, b) {\n        let ac = a.center;\n        let bc = b.center;\n        a.dist = Math.sqrt(Math.pow(ac.x - mc.x, 2) + Math.pow(ac.y - mc.y, 2));\n        b.dist = Math.sqrt(Math.pow(bc.x - mc.x, 2) + Math.pow(bc.y - mc.y, 2));\n        return a.dist - b.dist;\n      });\n      this.inBoundFeatures[0].path.setAttribute(\"tabindex\", 0);\n    },\n\n    /**\n     * Event handler for 'mapfocused' event to update the map's bounds in terms of PCRS\n     * @param e - the event object\n     * @private\n     */\n    _updateMapBounds: function (e) {\n      // TODO: map's PCRS bounds is used in other parts of the viewer, can be moved out to the map object directly\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        this._map.getZoom(),\n        this._map.options.projection);\n    },\n  });\n\n  var Options = {\n    featureIndexOverlayOption: false,\n    announceMovement: false,\n    announceScale: {\"metric\": true, \"imperial\": false},\n    defaultExtCoor: 'pcrs',\n    defaultLocCoor: 'gcrs',\n    locale: {\n      cmBack: \"Back\",\n      cmForward: \"Forward\",\n      cmReload: \"Reload\",\n      cmToggleControls: \"Toggle Controls\",\n      cmCopyCoords: \"Copy\",\n      cmCopyMapML: \"Map\",\n      cmCopyExtent: \"Extent\",\n      cmCopyLocation: \"Location\",\n      cmToggleDebug: \"Toggle Debug Mode\",\n      cmPasteLayer: \"Paste\",\n      cmViewSource: \"View Map Source\",\n      lmZoomToLayer: \"Zoom To Layer\",\n      lmCopyLayer: \"Copy Layer\",\n      lcOpacity: \"Opacity\",\n      btnAttribution: \"Map data attribution\",\n      btnZoomIn: \"Zoom in\",\n      btnZoomOut: \"Zoom out\",\n      btnFullScreen: \"View Fullscreen\",\n      btnExitFullScreen: \"Exit Fullscreen\",\n      btnLocTrackOn: \"Show my location - location tracking on\",\n      btnMyLocTrackOn: \"My current location, shown on map\",\n      btnLocTrackOff: \"Show my location - location tracking off\",\n      btnLocTrackLastKnown: \"Show my location - last known location shown\",\n      btnMyLastKnownLocTrackOn: \"My last known location, shown on map\",\n      amZoom: \"zoom level\",\n      amColumn: \"column\",\n      amRow: \"row\",\n      amMaxZoom: \"At maximum zoom level, zoom in disabled\",\n      amMinZoom: \"At minimum zoom level, zoom out disabled\",\n      amZoomedOut: \"Zoomed out of bounds, returning to\",\n      amDraggedOut: \"Dragged out of bounds, returning to\",\n      amEastBound: \"Reached east bound, panning east disabled\",\n      amWestBound: \"Reached west bound, panning west disabled\",\n      amNorthBound: \"Reached north bound, panning north disabled\",\n      amSouthBound: \"Reached south bound, panning south disabled\",\n      kbdShortcuts: \"Keyboard shortcuts\",\n      kbdMovement: \"Movement keys\",\n      kbdFeature: \"Feature navigation keys\",\n      kbdPanUp: \"Pan up\",\n      kbdPanDown: \"Pan down\",\n      kbdPanLeft: \"Pan left\",\n      kbdPanRight: \"Pan right\",\n      kbdPanIncrement: \"pan increment\",\n      kbdZoom: \"Zoom in/out 3 levels\",\n      kbdPrevFeature: \"Previous feature\",\n      kbdNextFeature: \"Next feature\",\n      dfLayer: \"Layer\",\n      popupZoom: \"Zoom to here\",\n      dfPastedLayer: \"Pasted layer\"\n    }\n  };\n\n  L.Map.Keyboard.include({\n      _onKeyDown: function (e) {\n\n          if (e.altKey || e.metaKey) { return; }\n\n          let zoomIn = {\n              187: 187,\n              107: 107,\n              61: 61,\n              171: 171\n          };\n\n          let zoomOut = {\n              189: 189,\n              109: 109,\n              54: 54,\n              173: 173\n          };\n\n          var key = e.keyCode,\n              map = this._map,\n              offset;\n\n          if (key in this._panKeys) {\n              if (!map._panAnim || !map._panAnim._inProgress) {\n                  offset = this._panKeys[key];\n                  if (e.shiftKey) {\n                      offset = L.point(offset).multiplyBy(3);\n                  }\n                  if (e.ctrlKey) {\n                      offset = L.point(offset).divideBy(5);\n                  }\n\n                  map.panBy(offset);\n\n                  if (map.options.maxBounds) {\n                      map.panInsideBounds(map.options.maxBounds);\n                  }\n              }\n          } else if (key in this._zoomKeys) {\n              if((key in zoomIn && map._layersMaxZoom !== map.getZoom()) || (key in zoomOut && map._layersMinZoom !== map.getZoom()))\n                  map.setZoom(map.getZoom() + (e.shiftKey ? 3 : 1) * this._zoomKeys[key]);\n\n          } else if (key === 27 && map._popup && map._popup.options.closeOnEscapeKey) {\n              map.closePopup();\n\n          } else {\n              return;\n          }\n\n          L.DomEvent.stop(e);\n      }\n  });\n\n  var FeatureIndexOverlay = L.Layer.extend({\n      onAdd: function (map) {\n          let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><path fill=\"none\" stroke=\"#000\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M0 0h100v100H0z\" color=\"#000\" overflow=\"visible\"/></svg>`;\n\n          this._container = L.DomUtil.create(\"div\", \"mapml-feature-index-box\", map._container);\n          this._container.innerHTML = svgInnerHTML;\n\n          this._output = L.DomUtil.create(\"output\", \"mapml-feature-index\", map._container);\n          this._output.setAttribute(\"role\", \"status\");\n          this._output.setAttribute(\"aria-live\", \"polite\");\n          this._output.setAttribute(\"aria-atomic\", \"true\");\n          this._body = L.DomUtil.create(\"span\", \"mapml-feature-index-content\", this._output);\n          this._body.index = 0;\n          this._output.initialFocus = false;\n          map.on(\"layerchange layeradd layerremove overlayremove\", this._toggleEvents, this);\n          map.on('moveend focus templatedfeatureslayeradd', this._checkOverlap, this);\n          map.on(\"keydown\", this._onKeyDown, this);\n          this._addOrRemoveFeatureIndex();\n      },\n\n      _calculateReticleBounds: function () {\n          let bounds = this._map.getPixelBounds();\n          let center = bounds.getCenter();\n          let wRatio = Math.abs(bounds.min.x - bounds.max.x) / (this._map.options.mapEl.width);\n          let hRatio = Math.abs(bounds.min.y - bounds.max.y) / (this._map.options.mapEl.height);\n\n          let reticleDimension = (getComputedStyle(this._container).width).replace(/[^\\d.]/g,'');\n          if((getComputedStyle(this._container).width).slice(-1) === \"%\") {\n              reticleDimension = reticleDimension * this._map.options.mapEl.width / 100;\n          }\n          let w = wRatio * reticleDimension / 2;\n          let h = hRatio * reticleDimension / 2;\n          let minPoint = L.point(center.x - w, center.y + h);\n          let maxPoint = L.point(center.x + w, center.y - h);\n          let b = L.bounds(minPoint, maxPoint);\n          return M.pixelToPCRSBounds(b,this._map.getZoom(),this._map.options.projection);\n      },\n\n      _checkOverlap: function (e) {\n          if(e.type === \"focus\") this._output.initialFocus = true;\n          if(!this._output.initialFocus) return;\n          if(this._output.popupClosed) {\n              this._output.popupClosed = false;\n              return;\n          }\n\n          this._map.fire(\"mapkeyboardfocused\");\n\n          let featureIndexBounds = this._calculateReticleBounds();\n          let features = this._map.featureIndex.inBoundFeatures;\n          let index = 1;\n          let keys = Object.keys(features);\n          let body = this._body;\n\n          body.innerHTML = \"\";\n          body.index = 0;\n\n          body.allFeatures = [];\n          keys.forEach(i => {\n              let layer = features[i].layer;\n              let layers = features[i].layer._layers;\n              let bounds = L.bounds();\n\n              if(layers) {\n                  let keys = Object.keys(layers);\n                  keys.forEach(j => {\n                      if(!bounds) bounds = L.bounds(layer._layers[j]._bounds.min, layer._layers[j]._bounds.max);\n                      bounds.extend(layer._layers[j]._bounds.min);\n                      bounds.extend(layer._layers[j]._bounds.max);\n                  });\n              } else if(layer._bounds){\n                  bounds = L.bounds(layer._bounds.min, layer._bounds.max);\n              }\n\n              if(featureIndexBounds.overlaps(bounds)){\n                  let label = features[i].path.getAttribute(\"aria-label\");\n\n                  if (index < 8){\n                      body.appendChild(this._updateOutput(label, index, index));\n                  }\n                  if (index % 7 === 0 || index === 1) {\n                      body.allFeatures.push([]);\n                  }\n                  body.allFeatures[Math.floor((index - 1) / 7)].push({label, index, layer});\n                  if (body.allFeatures[1] && body.allFeatures[1].length === 1){\n                      body.appendChild(this._updateOutput(\"More results\", 0, 9));\n                  }\n                  index += 1;\n              }\n          });\n          this._addToggleKeys();\n      },\n\n      _updateOutput: function (label, index, key) {\n          let span = document.createElement(\"span\");\n          span.setAttribute(\"data-index\", index);\n          //\", \" adds a brief auditory pause when a screen reader is reading through the feature index\n          //also prevents names with numbers + key from being combined when read\n          span.innerHTML =  `<kbd>${key}</kbd>` + \" \" + label + \"<span>, </span>\";\n          return span;\n      },\n\n      _addToggleKeys: function () {\n          let allFeatures = this._body.allFeatures;\n          for(let i = 0; i < allFeatures.length; i++){\n              if(allFeatures[i].length === 0) return;\n              if(allFeatures[i - 1]){\n                  let label = \"Previous results\";\n                  allFeatures[i].push({label});\n              }\n\n              if(allFeatures[i + 1] && allFeatures[i + 1].length > 0){\n                  let label = \"More results\";\n                  allFeatures[i].push({label});\n              }\n          }\n      },\n\n      _onKeyDown: function (e){\n          let body = this._body;\n          let key = e.originalEvent.keyCode;\n          if (key >= 49 && key <= 55){\n              if(!body.allFeatures[body.index]) return;\n              let feature = body.allFeatures[body.index][key - 49];\n              if (!feature) return;\n              let layer = feature.layer;\n              if (layer) {\n                  this._map.featureIndex.currentIndex = feature.index - 1;\n                  if (layer._popup){\n                      this._map.closePopup();\n                      layer.openPopup();\n                  }\n                  else layer.options.group.focus();\n              }\n          } else if(key === 56){\n              this._newContent(body, -1);\n          } else if(key === 57){\n              this._newContent(body, 1);\n          }\n      },\n\n      _newContent: function (body, direction) {\n          let index = body.firstChild.getAttribute(\"data-index\");\n          let newContent = body.allFeatures[Math.floor(((index - 1) / 7) + direction)];\n          if(newContent && newContent.length > 0){\n              body.innerHTML = \"\";\n              body.index += direction;\n              for(let i = 0; i < newContent.length; i++){\n                  let feature = newContent[i];\n                  let index = feature.index ? feature.index : 0;\n                  let key = i + 1;\n                  if (feature.label === \"More results\") key = 9;\n                  if (feature.label === \"Previous results\") key = 8;\n                  body.appendChild(this._updateOutput(feature.label, index, key));\n              }\n          }\n      },\n\n      _toggleEvents: function (){\n          this._map.on(\"viewreset move moveend focus blur popupclose\", this._addOrRemoveFeatureIndex, this);\n\n      },\n\n      _addOrRemoveFeatureIndex: function (e) {\n          let features = this._body.allFeatures ? this._body.allFeatures.length : 0;\n          //Toggle aria-hidden attribute so screen reader rereads the feature index on focus\n          if (!this._output.initialFocus) {\n              this._output.setAttribute(\"aria-hidden\", \"true\");\n          } else if(this._output.hasAttribute(\"aria-hidden\")){\n              let obj = this;\n              setTimeout(function () {\n                  obj._output.removeAttribute(\"aria-hidden\");\n              }, 100);\n          }\n\n          if(e && e.type === \"popupclose\") {\n              this._output.setAttribute(\"aria-hidden\", \"true\");\n              this._output.popupClosed = true;\n          } else if (e && e.type === \"focus\") {\n              this._container.removeAttribute(\"hidden\");\n              if (features !== 0) this._output.classList.remove(\"mapml-screen-reader-output\");\n          } else if (e && e.originalEvent && e.originalEvent.type === 'pointermove') {\n              this._container.setAttribute(\"hidden\", \"\");\n              this._output.classList.add(\"mapml-screen-reader-output\");\n          } else if (e && e.target._popup) {\n              this._container.setAttribute(\"hidden\", \"\");\n          } else if (e && e.type === \"blur\") {\n              this._container.setAttribute(\"hidden\", \"\");\n              this._output.classList.add(\"mapml-screen-reader-output\");\n              this._output.initialFocus = false;\n              this._addOrRemoveFeatureIndex();\n          } else if (this._map.isFocused && e) {\n              this._container.removeAttribute(\"hidden\");\n              if (features !== 0) {\n                  this._output.classList.remove(\"mapml-screen-reader-output\");\n              } else {\n                  this._output.classList.add(\"mapml-screen-reader-output\");\n              }\n          } else {\n              this._container.setAttribute(\"hidden\", \"\");\n              this._output.classList.add(\"mapml-screen-reader-output\");\n          }\n\n      },\n\n  });\n\n  var featureIndexOverlay = function (options) {\n      return new FeatureIndexOverlay(options);\n  };\n\n  /* \n   * Copyright 2015-2016 Canada Centre for Mapping and Earth Observation, \n   * Earth Sciences Sector, Natural Resources Canada.\n   * \n   * License\n   * \n   * By obtaining and/or copying this work, you (the licensee) agree that you have \n   * read, understood, and will comply with the following terms and conditions.\n   * \n   * Permission to copy, modify, and distribute this work, with or without \n   * modification, for any purpose and without fee or royalty is hereby granted, \n   * provided that you include the following on ALL copies of the work or portions \n   * thereof, including modifications:\n   * \n   * The full text of this NOTICE in a location viewable to users of the \n   * redistributed or derivative work.\n   * \n   * Any pre-existing intellectual property disclaimers, notices, or terms and \n   * conditions. If none exist, the W3C Software and Document Short Notice should \n   * be included.\n   * \n   * Notice of any changes or modifications, through a copyright statement on the \n   * new code or document such as \"This software or document includes material \n   * copied from or derived from [title and URI of the W3C document]. \n   * Copyright  [YEAR] W3C (MIT, ERCIM, Keio, Beihang).\"\n   * \n   * Disclaimers\n   * \n   * THIS WORK IS PROVIDED \"AS IS,\" AND COPYRIGHT HOLDERS MAKE NO REPRESENTATIONS \n   * OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF \n   * MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE \n   * SOFTWARE OR DOCUMENT WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, \n   * TRADEMARKS OR OTHER RIGHTS.\n   * COPYRIGHT HOLDERS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR \n   * CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SOFTWARE OR DOCUMENT.\n   * \n   * The name and trademarks of copyright holders may NOT be used in advertising or \n   * publicity pertaining to the work without specific, written prior permission. \n   * Title to copyright in this work will at all times remain with copyright holders.\n   */\n\n  /* global L, Node */\n  (function (window, document, undefined$1) {\n    \n  var M = {};\n  window.M = M;\n\n  (function () {\n    M.detectImagePath = function (container) {\n      // this relies on the CSS style leaflet-default-icon-path containing a \n      // relative url() that leads to a valid icon file.  Since that depends on\n      // how all of this stuff is deployed (i.e. custom element or as leaflet-plugin)\n      // also, because we're using 'shady DOM' api, the container must be \n      // a shady dom container, because the custom element tags it with added\n      // style-scope ... and related classes.\n     var el = L.DomUtil.create('div',  'leaflet-default-icon-path', container);\n     var path = L.DomUtil.getStyle(el, 'background-image') ||\n                L.DomUtil.getStyle(el, 'backgroundImage');\t// IE8\n\n     container.removeChild(el);\n\n     if (path === null || path.indexOf('url') !== 0) {\n      path = '';\n     } else {\n      path = path.replace(/^url\\([\"']?/, '').replace(/marker-icon\\.png[\"']?\\)$/, '');\n     }\n\n     return path;\n    };\n    M.mime = \"text/mapml\";\n\n    let mapOptions = window.document.head.querySelector(\"map-options\");\n    M.options = Options;\n    if (mapOptions) M.options = Object.assign(M.options, JSON.parse(mapOptions.innerHTML));\n\n    // see https://leafletjs.com/reference-1.5.0.html#crs-l-crs-base\n    // \"new classes can't inherit from (L.CRS), and methods can't be added \n    // to (L.CRS.anything) with the include function\n    // so we'll use the options property as a way to integrate needed \n    // properties and methods...\n    M.WGS84 = new L.Proj.CRS('EPSG:4326','+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ', {\n      origin: [-180,+90],\n      bounds: L.bounds([[-180,-90],[180,90]]),\n      resolutions: [\n        0.703125,\n        0.3515625,\n        0.17578125,\n        0.087890625,\n        0.0439453125,\n        0.02197265625,\n        0.010986328125,\n        0.0054931640625,\n        0.00274658203125,\n        0.001373291015625,\n        0.0006866455078125,\n        0.0003433227539062,\n        0.0001716613769531,\n        0.0000858306884766,\n        0.0000429153442383,\n        0.0000214576721191,\n        0.0000107288360596,\n        0.0000053644180298,\n        0.0000026822090149,\n        0.0000013411045074,\n        0.0000006705522537,\n        0.0000003352761269\n      ],\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (Math.round(M.WGS84.options.bounds.getSize().x / M.WGS84.options.resolutions[zoom]))\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (Math.round(M.WGS84.options.bounds.getSize().y / M.WGS84.options.resolutions[zoom]))\n          },\n          bounds: zoom => L.bounds([M.WGS84.options.crs.tcrs.horizontal.min,\n                            M.WGS84.options.crs.tcrs.vertical.min],\n                           [M.WGS84.options.crs.tcrs.horizontal.max(zoom),\n                            M.WGS84.options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"longitude\",\n            get min() {return M.WGS84.options.crs.gcrs.horizontal.min;},\n            get max() {return M.WGS84.options.crs.gcrs.horizontal.max;}\n          }, \n          vertical: {\n            name: \"latitude\", \n            get min() {return M.WGS84.options.crs.gcrs.vertical.min;},\n            get max() {return M.WGS84.options.crs.gcrs.vertical.max;}\n          },\n          get bounds() {return M.WGS84.options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: -180.0,\n            max: 180.0\n          }, \n          vertical: {\n            name: \"latitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: -90.0,\n            max: 90.0\n          },\n          get bounds() {return L.latLngBounds(\n                [M.WGS84.options.crs.gcrs.vertical.min,M.WGS84.options.crs.gcrs.horizontal.min],\n                [M.WGS84.options.crs.gcrs.vertical.max,M.WGS84.options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: 256\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: 256\n          },\n          get bounds() {return L.bounds(\n                    [M.WGS84.options.crs.tile.horizontal.min,M.WGS84.options.crs.tile.vertical.min],\n                    [M.WGS84.options.crs.tile.horizontal.max,M.WGS84.options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (Math.round(M.WGS84.options.crs.tcrs.horizontal.max(zoom) / M.WGS84.options.crs.tile.bounds.getSize().x))\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (Math.round(M.WGS84.options.crs.tcrs.vertical.max(zoom) / M.WGS84.options.crs.tile.bounds.getSize().y))\n          },\n          bounds: zoom => L.bounds(\n                   [M.WGS84.options.crs.tilematrix.horizontal.min,\n                    M.WGS84.options.crs.tilematrix.vertical.min],\n                   [M.WGS84.options.crs.tilematrix.horizontal.max(zoom),\n                    M.WGS84.options.crs.tilematrix.vertical.max(zoom)])\n        }\n      }\n    });\n    M.CBMTILE = new L.Proj.CRS('EPSG:3978',\n    '+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs', {\n      origin: [-34655800, 39310000],\n      bounds: L.bounds([[-34655800,-39000000],[10000000,39310000]]),\n      resolutions: [\n        38364.660062653464, \n        22489.62831258996, \n        13229.193125052918, \n        7937.5158750317505, \n        4630.2175937685215, \n        2645.8386250105837,\n        1587.5031750063501,\n        926.0435187537042, \n        529.1677250021168, \n        317.50063500127004, \n        185.20870375074085, \n        111.12522225044451, \n        66.1459656252646, \n        38.36466006265346, \n        22.48962831258996,\n        13.229193125052918,\n        7.9375158750317505, \n        4.6302175937685215,\n        2.6458386250105836,\n        1.5875031750063502,\n        0.92604351875370428,\n        0.52916772500211673,\n        0.31750063500127002,\n        0.18520870375074083,\n        0.11112522225044451,\n        0.066145965625264591\n      ],\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (Math.round(M.CBMTILE.options.bounds.getSize().x / M.CBMTILE.options.resolutions[zoom]))\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (Math.round(M.CBMTILE.options.bounds.getSize().y / M.CBMTILE.options.resolutions[zoom]))\n          },\n          bounds: zoom => L.bounds([M.CBMTILE.options.crs.tcrs.horizontal.min,\n                            M.CBMTILE.options.crs.tcrs.vertical.min],\n                           [M.CBMTILE.options.crs.tcrs.horizontal.max(zoom),\n                            M.CBMTILE.options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"easting\",\n            get min() {return M.CBMTILE.options.bounds.min.x;},\n            get max() {return M.CBMTILE.options.bounds.max.x;}\n          }, \n          vertical: {\n            name: \"northing\", \n            get min() {return M.CBMTILE.options.bounds.min.y;},\n            get max() {return M.CBMTILE.options.bounds.max.y;}\n          },\n          get bounds() {return M.CBMTILE.options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: -141.01,\n            max: -47.74\n          }, \n          vertical: {\n            name: \"latitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: 40.04,\n            max: 86.46\n          },\n          get bounds() {return L.latLngBounds(\n                [M.CBMTILE.options.crs.gcrs.vertical.min,M.CBMTILE.options.crs.gcrs.horizontal.min],\n                [M.CBMTILE.options.crs.gcrs.vertical.max,M.CBMTILE.options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: 256\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: 256\n          },\n          get bounds() {return L.bounds(\n                    [M.CBMTILE.options.crs.tile.horizontal.min,M.CBMTILE.options.crs.tile.vertical.min],\n                    [M.CBMTILE.options.crs.tile.horizontal.max,M.CBMTILE.options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (Math.round(M.CBMTILE.options.crs.tcrs.horizontal.max(zoom) / M.CBMTILE.options.crs.tile.bounds.getSize().x))\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (Math.round(M.CBMTILE.options.crs.tcrs.vertical.max(zoom) / M.CBMTILE.options.crs.tile.bounds.getSize().y))\n          },\n          bounds: zoom => L.bounds([0,0],\n                   [M.CBMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tilematrix.vertical.max(zoom)])\n        }\n      }\n    });\n    M.APSTILE = new L.Proj.CRS('EPSG:5936',\n    '+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs', {\n      origin: [-2.8567784109255E7, 3.2567784109255E7],\n      bounds: L.bounds([[-28567784.109254867,-28567784.109254755],[32567784.109255023,32567784.10925506]]),\n      resolutions: [\n        238810.813354,\n        119405.406677,\n        59702.7033384999,\n        29851.3516692501,\n        14925.675834625,\n        7462.83791731252,\n        3731.41895865639,\n        1865.70947932806,\n        932.854739664032,\n        466.427369832148,\n        233.213684916074,\n        116.606842458037,\n        58.3034212288862,\n        29.1517106145754,\n        14.5758553072877,\n        7.28792765351156,\n        3.64396382688807,\n        1.82198191331174,\n        0.910990956788164,\n        0.45549547826179\n      ],\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (Math.round(M.APSTILE.options.bounds.getSize().x / M.APSTILE.options.resolutions[zoom]))\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (Math.round(M.APSTILE.options.bounds.getSize().y / M.APSTILE.options.resolutions[zoom]))\n          },\n          bounds: zoom => L.bounds([M.APSTILE.options.crs.tcrs.horizontal.min,\n                            M.APSTILE.options.crs.tcrs.vertical.min],\n                           [M.APSTILE.options.crs.tcrs.horizontal.max(zoom),\n                            M.APSTILE.options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"easting\",\n            get min() {return M.APSTILE.options.bounds.min.x;},\n            get max() {return M.APSTILE.options.bounds.max.x;}\n          }, \n          vertical: {\n            name: \"northing\", \n            get min() {return M.APSTILE.options.bounds.min.y;},\n            get max() {return M.APSTILE.options.bounds.max.y;}\n          },\n          get bounds() {return M.APSTILE.options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: -180.0,\n            max: 180.0\n          }, \n          vertical: {\n            name: \"latitude\",\n            // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n            min: 60.0,\n            max: 90.0\n          },\n          get bounds() {return L.latLngBounds(\n                    [M.APSTILE.options.crs.gcrs.vertical.min,M.APSTILE.options.crs.gcrs.horizontal.min],\n                    [M.APSTILE.options.crs.gcrs.vertical.max,M.APSTILE.options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: 256\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: 256\n          },\n          get bounds() {return L.bounds(\n                    [M.APSTILE.options.crs.tile.horizontal.min,M.APSTILE.options.crs.tile.vertical.min],\n                    [M.APSTILE.options.crs.tile.horizontal.max,M.APSTILE.options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (Math.round(M.APSTILE.options.crs.tcrs.horizontal.max(zoom) / M.APSTILE.options.crs.tile.bounds.getSize().x))\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (Math.round(M.APSTILE.options.crs.tcrs.vertical.max(zoom) / M.APSTILE.options.crs.tile.bounds.getSize().y))\n          },\n          bounds: zoom => L.bounds([0,0],\n                   [M.APSTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tilematrix.vertical.max(zoom)])\n        }\n      }\n    });\n    M.OSMTILE = L.CRS.EPSG3857;\n    L.setOptions(M.OSMTILE, {\n      origin: [-20037508.342787, 20037508.342787],\n      bounds: L.bounds([[-20037508.342787, -20037508.342787],[20037508.342787, 20037508.342787]]),\n      resolutions: [\n        156543.0339,\n        78271.51695,\n        39135.758475,\n        19567.8792375,\n        9783.93961875,\n        4891.969809375,\n        2445.9849046875,\n        1222.9924523438,\n        611.49622617188,\n        305.74811308594,\n        152.87405654297,\n        76.437028271484,\n        38.218514135742,\n        19.109257067871,\n        9.5546285339355,\n        4.7773142669678,\n        2.3886571334839,\n        1.1943285667419,\n        0.59716428337097,\n        0.29858214168549,\n        0.14929107084274,\n        0.074645535421371,\n        0.03732276771068573,\n        0.018661383855342865,\n        0.009330691927671432495\n      ],\n      crs: {\n        tcrs: {\n          horizontal: {\n            name: \"x\",\n            min: 0, \n            max: zoom => (Math.round(M.OSMTILE.options.bounds.getSize().x / M.OSMTILE.options.resolutions[zoom]))\n          },\n          vertical: {\n            name: \"y\",\n            min:0, \n            max: zoom => (Math.round(M.OSMTILE.options.bounds.getSize().y / M.OSMTILE.options.resolutions[zoom]))\n          },\n          bounds: zoom => L.bounds([M.OSMTILE.options.crs.tcrs.horizontal.min,\n                            M.OSMTILE.options.crs.tcrs.vertical.min],\n                           [M.OSMTILE.options.crs.tcrs.horizontal.max(zoom),\n                            M.OSMTILE.options.crs.tcrs.vertical.max(zoom)])\n        },\n        pcrs: {\n          horizontal: {\n            name: \"easting\",\n            get min() {return M.OSMTILE.options.bounds.min.x;},\n            get max() {return M.OSMTILE.options.bounds.max.x;}\n          }, \n          vertical: {\n            name: \"northing\", \n            get min() {return M.OSMTILE.options.bounds.min.y;},\n            get max() {return M.OSMTILE.options.bounds.max.y;}\n          },\n          get bounds() {return M.OSMTILE.options.bounds;}\n        }, \n        gcrs: {\n          horizontal: {\n            name: \"longitude\",\n            get min() {return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lng;},\n            get max() {return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lng;}\n          }, \n          vertical: {\n            name: \"latitude\",\n            get min() {return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lat;},\n            get max() {return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lat;}\n          },\n          get bounds() {return L.latLngBounds(\n                [M.OSMTILE.options.crs.gcrs.vertical.min,M.OSMTILE.options.crs.gcrs.horizontal.min],\n                [M.OSMTILE.options.crs.gcrs.vertical.max,M.OSMTILE.options.crs.gcrs.horizontal.max]);}\n        },\n        map: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: map => map.getSize().x\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: map => map.getSize().y\n          },\n          bounds: map => L.bounds(L.point([0,0]),map.getSize())\n        },\n        tile: {\n          horizontal: {\n            name: \"i\",\n            min: 0,\n            max: 256\n          },\n          vertical: {\n            name: \"j\",\n            min: 0,\n            max: 256\n          },\n          get bounds() {return L.bounds(\n                    [M.OSMTILE.options.crs.tile.horizontal.min,M.OSMTILE.options.crs.tile.vertical.min],\n                    [M.OSMTILE.options.crs.tile.horizontal.max,M.OSMTILE.options.crs.tile.vertical.max]);}\n        },\n        tilematrix: {\n          horizontal: {\n            name: \"column\",\n            min: 0,\n            max: zoom => (Math.round(M.OSMTILE.options.crs.tcrs.horizontal.max(zoom) / M.OSMTILE.options.crs.tile.bounds.getSize().x))\n          },\n          vertical: {\n            name: \"row\",\n            min: 0,\n            max: zoom => (Math.round(M.OSMTILE.options.crs.tcrs.vertical.max(zoom) / M.OSMTILE.options.crs.tile.bounds.getSize().y))\n          },\n          bounds: zoom => L.bounds([0,0],\n                   [M.OSMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.OSMTILE.options.crs.tilematrix.vertical.max(zoom)])\n        }\n      }\n    });\n  }());\n\n  M._handleLink = Util._handleLink;\n  M.convertPCRSBounds = Util.convertPCRSBounds;\n  M.axisToXY = Util.axisToXY;\n  M.csToAxes = Util.csToAxes;\n  M._convertAndFormatPCRS = Util._convertAndFormatPCRS;\n  M.axisToCS = Util.axisToCS;\n  M._parseNumber = Util._parseNumber;\n  M._extractInputBounds = Util._extractInputBounds;\n  M._splitCoordinate = Util._splitCoordinate;\n  M.boundsToPCRSBounds = Util.boundsToPCRSBounds;\n  M.pixelToPCRSBounds = Util.pixelToPCRSBounds;\n  M._metaContentToObject = Util._metaContentToObject;\n  M._coordsToArray = Util._coordsToArray;\n  M._parseStylesheetAsHTML = Util._parseStylesheetAsHTML;\n  M.pointToPCRSPoint = Util.pointToPCRSPoint;\n  M.pixelToPCRSPoint = Util.pixelToPCRSPoint;\n  M._gcrsToTileMatrix = Util._gcrsToTileMatrix;\n  M._pasteLayer = Util._pasteLayer;\n  M._properties2Table = Util._properties2Table;\n  M._updateExtent = Util._updateExtent;\n  M.geojson2mapml = Util.geojson2mapml;\n  M._breakArray = Util._breakArray;\n  M._table2properties = Util._table2properties;\n  M._geometry2geojson = Util._geometry2geojson;\n  M._pcrsToGcrs = Util._pcrsToGcrs;\n  M.mapml2geojson = Util.mapml2geojson;\n  M.getMaxZoom = Util.getMaxZoom;\n\n  M.QueryHandler = QueryHandler;\n  M.ContextMenu = ContextMenu;\n  M.AnnounceMovement = AnnounceMovement;\n  M.FeatureIndex = FeatureIndex;\n\n  // see https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\n  L.Map.addInitHook('addHandler', 'query', M.QueryHandler);\n  L.Map.addInitHook('addHandler', 'contextMenu', M.ContextMenu);\n  L.Map.addInitHook('addHandler', 'announceMovement', M.AnnounceMovement);\n  L.Map.addInitHook('addHandler', 'featureIndex', M.FeatureIndex);\n\n  M.MapMLLayer = MapMLLayer;\n  M.mapMLLayer = mapMLLayer;\n\n  M.ImageLayer = ImageLayer;\n  M.imageLayer = imageLayer;\n\n  M.TemplatedImageLayer = TemplatedImageLayer;\n  M.templatedImageLayer = templatedImageLayer;\n\n  M.TemplatedFeaturesLayer = TemplatedFeaturesLayer;\n  M.templatedFeaturesLayer = templatedFeaturesLayer;\n\n  M.TemplatedLayer = TemplatedLayer;\n  M.templatedLayer = templatedLayer;\n\n  M.TemplatedTileLayer = TemplatedTileLayer;\n  M.templatedTileLayer = templatedTileLayer;\n\n  M.FeatureLayer = FeatureLayer;\n  M.featureLayer = featureLayer;\n\n  M.LayerControl = LayerControl;\n  M.layerControl = layerControl;\n\n  M.AttributionButton = AttributionButton;\n  M.attributionButton = attributionButton;\n\n  M.ReloadButton = ReloadButton;\n  M.reloadButton = reloadButton;\n\n  M.ScaleBar = ScaleBar;\n  M.scaleBar = scaleBar;\n\n  M.FullscreenButton = FullscreenButton;\n  M.fullscreenButton = fullscreenButton;\n\n  M.geolocationButton = geolocationButton;\n\n  M.StaticTileLayer = StaticTileLayer;\n  M.staticTileLayer = staticTileLayer;\n\n  M.DebugOverlay = DebugOverlay;\n  M.debugOverlay = debugOverlay;\n\n  M.Crosshair = Crosshair;\n  M.crosshair = crosshair;\n\n  M.FeatureIndexOverlay = FeatureIndexOverlay;\n  M.featureIndexOverlay = featureIndexOverlay;\n\n  M.Feature = Feature;\n  M.feature = feature;\n\n  M.FeatureRenderer = FeatureRenderer;\n  M.featureRenderer = featureRenderer;\n\n  M.FeatureGroup = FeatureGroup;\n  M.featureGroup = featureGroup;\n\n  }(window));\n\n}());\n"],"names":["staticTileLayer","options","StaticTileLayer","layerControl","layers","LayerControl","L","GridLayer","extend","initialize","this","zoomBounds","_getZoomBounds","tileContainer","maxZoomBound","setOptions","_groups","_groupTiles","getElementsByTagName","onAdd","_bounds","_getLayerBounds","_map","projection","layerBounds","Object","keys","let","key","min","max","prototype","call","_handleMoveEnd","getEvents","events","_parentOnMoveEnd","moveend","move","e","mapZoom","getZoom","zoomLevel","maxNativeZoom","minNativeZoom","isVisible","maxZoom","minZoom","overlaps","M","pixelToPCRSBounds","getPixelBounds","_isValidTile","coords","_tileCoordsToKey","createTile","tileGroup","tileElem","document","createElement","tileSize","getTileSize","setAttribute","x","y","z","i","length","tile","width","height","alt","src","appendChild","tileGroups","crs","bounds","sCoords","split","pixelCoords","point","pixelBounds","zoom","container","meta","_metaContentToObject","getAttribute","tiles","nativeZoom","value","lZoom","Math","tileMap","row","col","tileCode","push","Control","Layers","autoZIndex","sortLayers","sortFunction","layerA","layerB","zIndex","overlays","_layerControlInputs","_layers","_lastZIndex","_handlingClick","_addLayer","_initLayout","on","_validateInput","DomEvent","mapEl","_container","_focusFirstLayer","_preventDefaultContextMenu","_update","_showControls","onRemove","map","off","layer","_onLayerChange","addOrUpdateOverlay","name","alreadyThere","addOverlay","removeAttribute","removeLayer","input","labels","label","checked","_layerEl","disabled","closest","style","fontStyle","_extent","_mapExtents","j","extentAnatomy","getElementsByClassName","elem","className","children","setTimeout","focus","_withinZoomBounds","range","_addItem","obj","layercontrols","getLayerUserControlsHTML","querySelector","layerId","stamp","_onInputClick","_overlaysList","collapse","target","tagName","relatedTarget","parentElement","contextMenu","_layerMenu","display","DomUtil","removeClass","originalEvent","pointerType","_isExpanded","latlng","mouseEventToLatLng","containerPoint","mouseEventToContainerPoint","preventDefault","fire","FALLBACK_PROJECTION","FALLBACK_CS","BLANK_TT_TREF","featureLayer","mapml","FeatureLayer","templatedTileLayer","template","TemplatedTileLayer","templatedLayer","templates","TemplatedLayer","templatedFeaturesLayer","TemplatedFeaturesLayer","templatedImageLayer","TemplatedImageLayer","imageLayer","url","location","size","angle","ImageLayer","mapMLLayer","node","MapMLLayer","debugOverlay","DebugOverlay","FeatureGroup","native","static","create","pane","addClass","renderer","query","_mapmlFeatures","features","_getNativeVariables","nativeCS","cs","_features","_staticFeature","addData","_resetFeatures","_leafletLayer","_addZoomLimit","showPaginationFeature","remove","featureIndex","cleanIndex","zoomend","_handleZoomEnd","feature","_extentEl","shadowRoot","firstChild","clearLayers","_featureGroup","popup","_navigationBar","innerText","_totalFeatureCount","_content","srcdoc","innerHTML","currFeature","once","content","withinZoom","_removeCSS","toUpperCase","metaKeys","includes","axisToCS","axes","csToAxes","boundsToPCRSBounds","error","tilematrix","k","checkRender","_checkRender","addLayer","_setZoomTransform","center","clampZoom","scale","getZoomScale","translate","multiplyBy","subtract","_getNewPixelOrigin","round","any3d","setTransform","setPosition","nMin","nMax","querySelectorAll","resolutions","len","nodeType","Node","DOCUMENT_NODE","nodeName","base","hasAttribute","URL","href","_parseStylesheetAsHTML","_DOMnode","cloneNode","filter","classList","title","properties","add","insertAdjacentHTML","geometryToLayer","color","defaultOptions","resetStyle","onEachFeature","bindTooltip","interactive","sticky","featureZoom","_groupEl","group","Util","_setLayerStyle","setStyle","eachLayer","toDelete","removeChild","vectorOptions","geometry","svgGroup","SVG","copyOptions","assign","geo","featureID","id","wrappers","_getGeometryParents","groupOptions","mapmlFeature","accessibleTitle","collections","featureGroup","subType","elems","concat","TileLayer","inputData","_extractInputBounds","extentBounds","tms","opacity","_setUpTileTemplateVars","_template","_initContainer","_updateZIndex","mapBounds","linkEl","dispatchEvent","CustomEvent","detail","appendTile","type","startsWith","_url","_fetchTile","_mapmlTileReady","getPane","fetch","getTileUrl","redirect","then","response","status","Promise","resolve","console","log","reject","text","DOMParser","parseFromString","_createFeatures","catch","err","markup","svg","g","xOffset","yOffset","groupID","tileFeatures","FeatureRenderer","_initPath","_project","_addPath","_updateFeature","toString","contains","v","zoomInput","_getZoomForUrl","pcrs","easting","left","_tileMatrixToPCRSPosition","right","northing","top","bottom","indexOf","infinite","invertedY","_globalTileRange","r","detectRetina","Browser","retina","pos","nwPoint","scaleBy","sePoint","centrePoint","floor","nw","transformation","untransform","se","cen","result","Point","east","north","inputs","values","units","axis","position","select","toLowerCase","horizontal","isNaN","Number","parseFloat","vertical","match","parseInt","parsedselect","htmlselect","pcrs2tilematrix","c","transform","divideBy","bind","pcrsBounds","zmin","zmax","_clampZoom","clamp","step","Layer","_templates","rel","setZIndex","extentZIndex","errorTileUrl","hasSetBoundsHandler","_queries","extentEl","_setupQueryVars","zoomstart","_onZoomStart","redraw","closePopup","queryVarNames","pixelleft","tileleft","mapleft","pixelright","tileright","mapright","pixeltop","tiletop","maptop","pixelbottom","tilebottom","mapbottom","tilei","mapi","tilej","mapj","reset","addToMap","hasLayer","old_templates","undefined","_previousFeature","_count","_nextFeature","_source","changeOpacity","_setUpFeaturesTemplateVars","_onMoveEnd","featureRenderer","bindPopup","autoClose","minWidth","parent","parentNode","history","_history","current","previous","steppedZoom","headers","parser","context","_pullFeatureFeed","scaleBounds","getCenter","_getfeaturesUrl","Headers","Accept","limit","el","_nativeZoom","_nativeCS","append","_updateTabIndex","layerNum","_path","childElementCount","getSize","_TCRSToPCRS","featuresVarNames","hidden","_setUpExtentTemplateVars","_clearLayer","_onAdd","containerImages","_addImage","loc","overlayToRemove","_imageLayer","getImageUrl","_imageOverlay","_step","addTo","_overlayToRemove","_scaleImage","_image","_pixelOrigins","getPixelOrigin","pixelOrigin","_removeZoomLimit","extent","extentVarNames","ImageOverlay","_location","_size","_angle","viewreset","_reset","_zoomAnimated","zoomanim","_animateZoom","load","_onImageLoad","_initImage","addInteractiveTarget","removeInteractiveTarget","loaded","Date","_updateOpacity","image","nextFrame","fade","now","setOpacity","cancelAnimFrame","_fadeFrame","requestAnimFrame","maxNext","_href","_imageContainer","_mapmlTileContainer","_title","_initialize","_validateExtent","validProjection","_mapmlLayerItem","getHref","_removeExtents","_changeOpacity","opacityEl","_changeExtentOpacity","_templateVars","_changeExtent","_setLayerElExtent","stopPropagation","_validProjection","_mapmlvectors","layerGroup","_staticTileLayer","createAndAdd","_templatedLayer","_attachSkipButtons","noLayer","projectionMatch","getProjection","zoomMax","zoomMin","forEach","tempExtentBounds","extentZoomBounds","_convertAndFormatPCRS","_onZoomAnim","toZoom","getMinZoom","getMaxZoom","zoomout","zoomin","getAttribution","attribution","getLayerExtentHTML","labelName","extentProperties","extentSettings","extentLabel","svgExtentControlIcon","extentControlPath1","extentControlPath2","extentNameIcon","extentItemControls","opacityControl","extentOpacitySummary","layerEl","removeExtentButton","stop","allRemoved","removed","_layerItemSettingsHTML","_extentGroupAnatomy","extentsettingsButton","opacityValue","extentItemNameSpan","defaultChecked","ontouchstart","onmousedown","downEvent","TouchEvent","touches","control","controls","moving","yPos","clientY","body","ontouchmove","onmousemove","moveEvent","offset","abs","getBoundingClientRect","pointerEvents","clientX","root","elementAt","elementFromPoint","swapControl","offsetHeight","nextSibling","insertBefore","ontouchend","onmouseup","controlsElems","insertAdjacentElement","fieldset","layerItemName","settingsButtonNameIcon","layerItemProperty","layerItemSettings","itemToggleLabel","layerItemControls","opacityControlSummary","svgSettingsControlIcon","settingsControlPath1","settingsControlPath2","extentsFieldset","removeControlButton","nextElementSibling","disbaled","previousElementSibling","firstElementChild","itemSettingControlButton","_layerControl","_legendUrl","legendLink","draggable","_layer","_styles","_userInputs","frag","createDocumentFragment","selectdetails","selectsummary","mapmlInput","selectSummaryLabel","allHidden","xhr","fCallback","_initTemplateVars","serverExtent","metaExtent","templateVars","tlist","varNamesRe","RegExp","includesZoom","extentFallback","t","vcount","trel","ttype","exec","div","varName","inp","axisBounds","convertPCRSBounds","axisToXY","outerHTML","element","elementAttrNames","getAttributeNames","option","optionAttrNames","transcribe","queryable","decodeURI","extentPCRSFallback","_processInitialExtent","responseXML","responseText","readyState","DONE","serverMeta","mapprojection","selectedAlternate","baseURI","responseURL","_parseLicenseAndLegend","newTiles","nt","importNode","extentElement","styleLinks","stylesControl","stylesControlSummary","changeStyle","styleOption","styleOptionInput","styleOptionLabel","textContent","trim","Element","attributionControl","addAttribution","elements","resolvedURL","baseURL","_toggleControls","XMLHttpRequest","onreadystatechange","abort","onload","onerror","open","setRequestHeader","mime","overrideMimeType","send","lp","OSMTILE","xml","attText","licenseLink","licenseTitle","getQueryTemplates","pcrsClick","layerAndExtents","queryTemplate","_eventParents","attachZoomLink","mapFocusButton","_sortIndex","previousButton","featureCount","totalFeatures","nextButton","controlFocusButton","currentIndex","inBoundFeatures","path","_controlContainer","divider","focusFeature","focusEvent","composedPath","isTab","keyCode","shiftPressed","shiftKey","focusMap","_popupClosed","featureEl","_groupLayer","_featureEl","tL","topLeft","gcrs","bR","bottomRight","latLngBounds","latLng","zoomLink","lng","lat","locale","popupZoom","onclick","onkeydown","MouseEvent","zoomTo","featureIndexOverlayOption","removeHandlers","removeEvent","mapSize","_panel","debugPanel","_grid","debugGrid","_panes","mapPane","_vectors","debugVectors","toolPane","DebugPanel","debug","_infoContainer","_debugContainer","infoContainer","_tileCoord","_tileMatrixCoord","_mapCoord","_tcrsCoord","_pcrsCoord","_gcrsCoord","_updateCoords","_visible","project","pointI","pointJ","trunc","toFixed","DebugGrid","join","outline","DebugVectors","LayerGroup","_mapLayerUpdate","_centerVector","circle","pointToLatLng","radius","_addBounds","colors","boundsArray","boundsRect","projectedExtent","weight","fillOpacity","fill","totalLayerBounds","totalBoundsArray","totalBounds","ProjectedExtent","Path","unproject","_locations","locations","_rings","_subtract","_parts","_renderer","_updatePoly","QueryHandler","Handler","addHooks","_queryTopLayer","_queryTopLayerAtMapCenter","removeHooks","_getTopQueryableLayer","l","mapmlLayer","event","isFocused","layerPoint","latLngToLayerPoint","latLngToContainerPoint","_query","tcrs2pcrs","tcrs2gcrs","fetchFeatures","lastOne","contenttype","get","Error","mapmldoc","Array","slice","geom","f","popupOptions","openPopup","_popup","displayFeaturesPopup","message","autoPan","maxHeight","tcrsClickLoc","latLngToPoint","tileMatrixClickLoc","tileBounds","Bounds","ceil","column","longitude","latitude","ContextMenu","_touchstart","msPointer","pointer","activeIndex","excludedIndices","isRunned","_items","cmBack","callback","_goBack","cmForward","_goForward","cmReload","_reload","btnFullScreen","_toggleFullScreen","spacer","cmCopyCoords","_copyCoords","hideOnSelect","submenu","cmCopyMapML","_copyMapML","cmCopyExtent","_copyExtent","cmCopyLocation","_copyLocation","cmPasteLayer","_paste","cmToggleControls","cmToggleDebug","_toggleDebug","cmViewSource","_viewSource","defExtCS","defaultExtCoor","defLocCS","defaultLocCoor","_layerItems","lmZoomToLayer","_zoomToLayer","lmCopyLayer","_copyLayer","_mapMenuVisible","_keyboardEvent","_createItem","_coordMenu","_clickEvent","getContainer","_hide","_onKeyDown","touch","contextmenu","_show","mousedown","_updateCS","KeyboardEvent","coord","data","_copyData","_layerClicked","layerElem","getOuterHTML","forward","back","reload","replace","navigator","clipboard","readText","_pasteLayer","viewSource","toggleDebug","directory","_showCoordMenu","execCommand","menu","_copyTile","_copyTileMatrix","_copyMap","_copyTCRS","_copyPCRS","_copyGCRS","click","caption","h2","pt","pointX","pointY","mapPt","_copyAllCoords","allData","index","_createSeparator","_insertElementAt","_createEventHandler","_onItemMouseOver","_onItemMouseOut","func","_showLocation","containerPointToLayerPoint","layerPointToLatLng","refEl","_showAtPoint","layerList","from","find","button","activeEl","activeElement","_elementInFocus","_layerMenuTabs","_setPosition","anchor","containerSize","_getElementSize","contextmenuAnchor","_leaflet_pos","_sizeChanged","offsetWidth","_focusOnLayerControl","_setActiveItem","noActiveEl","next","nextIndex","prevIndex","copyEl","menuWidth","submenuWidth","_hideCoordMenu","srcElement","toggleContextMenuItem","state","setViewFullScreenInnerHTML","btnExitFullScreen","tcrsTopLeft","tcrsBottomRight","tileMatrixTopLeft","tileMatrixBottomRight","minConverted","maxConverted","unprojectedMin","unprojectedMax","tcrs","boundsUnit","defaultMaxZoom","nativeMinZoom","nativeMaxZoom","locInputs","numberOfAxes","isFinite","minPixel","maxPixel","minGCRS","maxGCRS","pixelToPCRSPoint","pointToPCRSPoint","contentArray","stringSplit","prop","containerPoints","pairs","styleElm","ss","stylesheets","linkElm","s","array","a","_parseNumber","link","leafletLayer","justPan","hash","inPlace","newLayer","window","focusOnLoad","dfLayer","lastChild","addEventListener","dfPastedLayer","geojson2mapml","JSON","parse","json","table","thead","createTHead","insertRow","th1","th2","createTextNode","tbody","createTBody","hasOwnProperty","th","td","bboxExtent","geometryFunction","jsonType","out","setExtent","bbox","xmlStringLayer","multiPoint","linestring","multilinestring","polygon","multiPolygon","geometrycollection","Infinity","NEGATIVE_INFINITY","clone_feature","curr_feature","featureCaption","p","HTMLElement","_properties2Table","_updateExtent","coordinates","clone_point","clone_coords","clone_linestring","linestring_coordindates","clone_polygon","clone_multipoint","clone_multilinestring","m","geometries","fg","arr","arrayOfArrays","test","tableData","tr","source","dest","pointConv","proj4","_breakArray","_pcrsToGcrs","poly","newArr","conv","propertyFunction","Proj","code","metas","ex","num","_table2properties","prop0","_geometry2geojson","geoms","n","replaceWith","bound","newZoom","mapCenterTCRS","mapHalf","mapTlNew","mapBrNew","mapTlPCRSNew","mapBrPCRSNew","mapPCRS","zOffset","AttributionButton","Attribution","prefix","disableClickPropagation","_addAttribution","dialog","kbdShortcuts","kbdMovement","kbdPanUp","kbdPanDown","kbdPanLeft","kbdPanRight","btnZoomIn","btnZoomOut","kbdPanIncrement","kbdZoom","kbdFeature","kbdPrevFeature","kbdNextFeature","attribs","_attributions","prefixAndAttribs","btnAttribution","Map","mergeOptions","toggleableAttributionControl","addInitHook","attributionButton","reloadButton","ReloadButton","scaleBar","ScaleBar","_goReload","_reloadButton","_updateDisabled","disable","_disabled","enable","Scale","maxWidth","updateWhenIdle","scaleControl","_scaleControl","_updateOutput","_focusOutput","_pixelsToDistance","px","dpi","devicePixelRatio","_scaleLength","scaleLength","outputFocus","output","scaleLine","distance","metric","FullscreenButton","false","true","_toggleTitle","_click","toggleFullscreen","isFullscreen","include","_isFullscreen","getRootNode","host","pseudoFullscreen","_disablePseudoFullscreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","_enablePseudoFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","ALLOW_KEYBOARD_INPUT","msRequestFullscreen","_setFullscreen","fullscreen","invalidateSize","_onFullscreenChange","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","fullscreenControl","fullscreenchange","onFullscreenChange","addControl","whenReady","fullscreenButton","geolocationButton","GeolocationButton","crosshair","Crosshair","Feature","locateControl","locate","showPopup","strings","btnLocTrackOff","locateOptions","MutationObserver","mutations","btnLocTrackOn","_marker","btnMyLocTrackOn","permanent","btnLocTrackLastKnown","btnMyLastKnownLocTrackOn","observe","attributes","attributeFilter","_isQueryable","_toggleEvents","_isMapFocused","_addOrRemoveCrosshair","_hasQueryableLayer","_addOrRemoveMapOutline","mapContainer","_outline","isLeafletContainer","_convertWrappers","_markup","_convertMarkup","_generateOutlinePoints","isClosed","_isClosed","attachLinkHandler","dragStart","hovered","visited","mouseup","onTop","nextLayer","eventPhase","Event","BUBBLING_PHASE","sqrt","pow","_handleLink","currentTarget","resolver","mapWidth","clientWidth","substring","addedMap","tileOrigin","zoomingTo","origin","pixelRings","_convertRing","rings","subP","subrings","pixelSubrings","pixelOutline","o","parts","sub","interm","points","attr","featureAttributes","tabindex","first","ring","subRings","_coordinateToArrays","cls","class","nodes","childNodes","cur","tempDiv","prev","line","ind","main","subParts","isFirst","parents","span","noSpan","local","numPair","attrMap","wrapperAttr","unshift","linkTarget","linkType","getPCRSCenter","stampLayer","outlinePath","_createPath","stroke","_updateStyle","entries","_rootGroup","outlineAdded","_removePath","_setPath","geometryToPath","_pointToMarker","_updatePathStyle","isMain","isOutline","lineCap","lineJoin","dashArray","dashOffset","fillColor","fillRule","def","closed","str","len2","firstLayer","_openPopup","_handleFocus","updateInteraction","layerID","addToIndex","part","subPart","vectorMinZoom","vectorMaxZoom","openTooltip","closeTooltip","prevFocus","nextFocus","AnnounceMovement","layeradd","layerremove","announceBounds","dragging","_draggable","dragged","focusAnnouncement","removeEventListener","_gcrsToTileMatrix","standard","amZoom","_layersMaxZoom","amMaxZoom","_layersMinZoom","amMinZoom","_traversalCall","visible","outOfBoundsPos","prevZoom","_historyIndex","inBoundsPos","pop","amZoomedOut","wasDragged","amDraggedOut","amEastBound","amWestBound","amNorthBound","amSouthBound","FeatureIndex","outBoundFeatures","_mapPCRSBounds","_updateMapBounds","lc","mc","dist","tmp","inbound","sort","b","ac","bc","Options","announceMovement","announceScale","imperial","lcOpacity","amColumn","amRow","Keyboard","altKey","metaKey","_panKeys","_panAnim","_inProgress","ctrlKey","panBy","maxBounds","panInsideBounds","_zoomKeys","187","107","61","171","189","109","54","173","setZoom","closeOnEscapeKey","featureIndexOverlay","FeatureIndexOverlay","_output","_body","initialFocus","_checkOverlap","_addOrRemoveFeatureIndex","_calculateReticleBounds","wRatio","hRatio","reticleDimension","getComputedStyle","w","h","minPoint","maxPoint","popupClosed","featureIndexBounds","allFeatures","_addToggleKeys","_newContent","direction","newContent","detectImagePath","getStyle","mapOptions","head","WGS84","CRS","CBMTILE","APSTILE","EPSG3857","_splitCoordinate","_coordsToArray","mapml2geojson"],"mappings":";;CAAC,wBA6IuB,SAAlBA,EAA2BC,GAC7B,OAAO,IAAIC,EAAgBD,GA4KV,SAAfE,EAAyBC,EAAQH,GACpC,OAAO,IAAII,EAAaD,EAAQH,GAxTjC,IAAIC,EAAkBI,EAAEC,UAAUC,OAAO,CAEvCC,WAAY,SAAUR,GACpBS,KAAKC,WAAaD,KAAKE,eAAeX,EAAQY,cAAcZ,EAAQa,cACpER,EAAEE,OAAOP,EAASS,KAAKC,YACvBL,EAAES,WAAWL,KAAMT,GACnBS,KAAKM,QAAUN,KAAKO,YAAYP,KAAKT,QAAQY,cAAcK,qBAAqB,cAGlFC,MAAO,WACLT,KAAKU,QAAUV,KAAKW,gBAAgBX,KAAKM,QAAQN,KAAKY,KAAKrB,QAAQsB,YACnEb,KAAKc,YAAcd,KAAKU,QAAQK,OAAOC,KAAKhB,KAAKU,SAAS,IAC1D,IAAIO,IAAIC,KAAOH,OAAOC,KAAKhB,KAAKU,SAC9BV,KAAKc,YAAYhB,OAAOE,KAAKU,QAAQQ,GAAKC,KAC1CnB,KAAKc,YAAYhB,OAAOE,KAAKU,QAAQQ,GAAKE,KAE5CxB,EAAEC,UAAUwB,UAAUZ,MAAMa,KAAKtB,KAAKA,KAAKY,MAC3CZ,KAAKuB,kBAGPC,UAAW,WACTP,IAAIQ,EAAS7B,EAAEC,UAAUwB,UAAUG,UAAUF,KAAKtB,KAAKA,KAAKY,MAI5D,OAHAZ,KAAK0B,iBAAmBD,EAAOE,QAC/BF,EAAOE,QAAU3B,KAAKuB,eACtBE,EAAOG,KAAO,OACPH,GAMTF,eAAiB,SAASM,GACxBZ,IAAIa,EAAU9B,KAAKY,KAAKmB,UACxBd,IAAIe,EAAYF,EAChBE,EAAYA,EAAYhC,KAAKT,QAAQ0C,cAAejC,KAAKT,QAAQ0C,cAAeD,EAChFA,EAAYA,EAAYhC,KAAKT,QAAQ2C,cAAelC,KAAKT,QAAQ2C,cAAeF,EAChFhC,KAAKmC,UAAYL,GAAW9B,KAAKC,WAAWmC,SAAWN,GAAW9B,KAAKC,WAAWoC,SAChErC,KAAKU,QAAQsB,IAAchC,KAAKU,QAAQsB,GACvCM,SAASC,EAAEC,kBACVxC,KAAKY,KAAK6B,iBACVzC,KAAKY,KAAKmB,UACV/B,KAAKY,KAAKrB,QAAQsB,aACjCb,KAAc,WACnBA,KAAK0B,oBAGPgB,aAAaC,GACX,OAAO3C,KAAKM,QAAQN,KAAK4C,iBAAiBD,KAG5CE,WAAY,SAAUF,GACpB1B,IAAI6B,EAAY9C,KAAKM,QAAQN,KAAK4C,iBAAiBD,KAAY,GAC3DI,EAAWC,SAASC,cAAc,YAAaC,EAAWlD,KAAKmD,cACnEJ,EAASK,aAAa,MAAMT,EAAOU,GACnCN,EAASK,aAAa,MAAMT,EAAOW,GACnCP,EAASK,aAAa,OAAOT,EAAOY,GAEpC,IAAItC,IAAIuC,EAAI,EAAEA,EAAEV,EAAUW,OAAOD,IAAI,CACnCvC,IAAIyC,EAAMV,SAASC,cAAc,OACjCS,EAAKC,MAAQT,EAASG,EACtBK,EAAKE,OAASV,EAASI,EACvBI,EAAKG,IAAM,GACXH,EAAKN,aAAa,OAAO,gBACzBM,EAAKI,IAAMhB,EAAUU,GAAGM,IACxBf,EAASgB,YAAYL,GAEvB,OAAOX,GAGTpC,gBAAiB,SAASqD,EAAYnD,GACpCI,IAAIH,EAAc,GAAIoC,EAAWX,EAAE1B,GAAYtB,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EAC3E,IAAIpC,IAAIyC,KAAQM,EAAW,CACzB/C,IAAIkD,EAAUT,EAAKU,MAAM,KAAMC,EAAc,GAC7CA,EAAYhB,GAAKc,EAAQ,GAAKjB,EAC9BmB,EAAYf,GAAKa,EAAQ,GAAKjB,EAC9BmB,EAAYd,GAAKY,EAAQ,GACtBA,EAAQ,KAAMrD,GAEfA,EAAYqD,EAAQ,IAAIrE,OAAOF,EAAE0E,MAAMD,EAAYhB,EAAGgB,EAAYf,IAClExC,EAAYqD,EAAQ,IAAIrE,OAAOF,EAAE0E,MAAQD,EAAYhB,EAAEH,EAAcmB,EAAYf,EAAEJ,KAEnFpC,EAAYqD,EAAQ,IAAMvE,EAAEsE,OACAtE,EAAE0E,MAAMD,EAAYhB,EAAGgB,EAAYf,GACnC1D,EAAE0E,MAAQD,EAAYhB,EAAEH,EAAcmB,EAAYf,EAAEJ,IAKpF,IAAIjC,IAAIsD,KAAezD,EAAY,CACjCG,IAAIuD,GAAQD,EACZzD,EAAYyD,GAAehC,EAAEC,kBAAkB1B,EAAYyD,GAAaC,EAAK3D,GAG/E,OAAOC,GAGTZ,eAAgB,SAASuE,EAAWrE,GAClC,IAAIqE,EAAW,OAAO,KACtBxD,IAAIyD,EAAOnC,EAAEoC,qBAAqBF,EAAUjE,qBAAqB,aAAa,GAAGoE,aAAa,SAC1FJ,EAAO,GAAGK,EAAQJ,EAAUjE,qBAAqB,YACrDgE,EAAKM,YAAcJ,EAAKK,OAAS,EACjCP,EAAKvC,cAAgB,EACrBuC,EAAKtC,cAAgB9B,EACrB,IAAKa,IAAIuC,EAAE,EAAEA,EAAEqB,EAAMpB,OAAOD,IAAK,CAC/BvC,IAAI+D,GAASH,EAAMrB,GAAGoB,aAAa,QAC/BC,EAAMrB,GAAGoB,aAAa,UAASI,EAAQR,EAAKM,YAChDN,EAAKtC,cAAgB+C,KAAK9D,IAAIqD,EAAKtC,cAAe8C,GAClDR,EAAKvC,cAAgBgD,KAAK7D,IAAIoD,EAAKvC,cAAe+C,GASpD,OAJAR,EAAKnC,QAAUmC,EAAKtC,cAAgB,GAAK,EAAG,EAAGsC,EAAKtC,cAAgB,EACpEsC,EAAKpC,QAAUhC,EACZsE,EAAKvD,MAAIqD,EAAKnC,SAAWqC,EAAKvD,IAAOqD,EAAKtC,cAAgB,EAAIsC,EAAKtC,cAAgB,GAAIwC,EAAKvD,KAC5FuD,EAAKtD,MAAIoD,EAAKpC,SAAWsC,EAAKtD,KAC1BoD,GAGTjE,YAAa,SAAUsE,GACrB5D,IAAIiE,EAAU,GACd,IAAKjE,IAAIuC,EAAE,EAAEA,EAAEqB,EAAMpB,OAAOD,IAAK,CAC/BvC,IAAIyC,EAAO,GACXA,EAAKyB,KAAON,EAAMrB,GAAGoB,aAAa,OAClClB,EAAK0B,KAAOP,EAAMrB,GAAGoB,aAAa,OAClClB,EAAKc,MAAQK,EAAMrB,GAAGoB,aAAa,SAAW5E,KAAKT,QAAQuF,WAC3DpB,EAAKI,IAAMe,EAAMrB,GAAGoB,aAAa,OACjC3D,IAAIoE,EAAW3B,EAAK0B,IAAI,IAAI1B,EAAKyB,IAAI,IAAIzB,EAAKc,KAC3Ca,KAAYH,EACbA,EAAQG,GAAUC,KAAK5B,GAEvBwB,EAAQG,GAAU,CAAC3B,GAGvB,OAAOwB,KAQPvF,EAAeC,EAAE2F,QAAQC,OAAO1F,OAAO,CAEvCP,QAAS,CACPkG,YAAY,EACZC,YAAY,EACZC,aAAc,SAAUC,EAAQC,GAC9B,OAAOD,EAAOrG,QAAQuG,OAASD,EAAOtG,QAAQuG,QAAU,EAAKF,EAAOrG,QAAQuG,OAASD,EAAOtG,QAAQuG,OAAS,EAAI,IAGrH/F,WAAY,SAAUgG,EAAUxG,GAU5B,IAAK,IAAIiE,KATT5D,EAAES,WAAWL,KAAMT,GAInBS,KAAKgG,oBAAsB,GAC3BhG,KAAKiG,QAAU,GACfjG,KAAKkG,YAAc,EACnBlG,KAAKmG,gBAAiB,EAERJ,EACV/F,KAAKoG,UAAUL,EAASvC,GAAIA,GAAG,IAGvC/C,MAAO,WAcH,OAbAT,KAAKqG,cACLrG,KAAKY,KAAK0F,GAAG,WAAYtG,KAAKuG,eAAgBvG,MAC9CJ,EAAE4G,SAASF,GAAGtG,KAAKT,QAAQkH,MAAO,cAAezG,KAAKuG,eAAgBvG,MAEtEJ,EAAE4G,SAASF,GAAGtG,KAAK0G,WAAWlG,qBAAqB,KAAK,GAAI,UAAWR,KAAK2G,iBAAkB3G,KAAK0G,YACnG9G,EAAE4G,SAASF,GAAGtG,KAAK0G,WAAY,cAAe1G,KAAK4G,2BAA4B5G,MAC/EA,KAAK6G,UAEF7G,KAAKiG,QAAQxC,OAAS,IAAMzD,KAAKY,KAAKkG,cACvC9G,KAAK0G,WAAWtD,aAAa,SAAS,IAEtCpD,KAAKY,KAAKkG,eAAgB,EAErB9G,KAAK0G,YAEhBK,SAAU,SAAUC,GAChBA,EAAIC,IAAI,WAAYjH,KAAKuG,eAAgBvG,MACzCJ,EAAE4G,SAASS,IAAIjH,KAAK0G,WAAWlG,qBAAqB,KAAK,GAAI,UAAWR,KAAK2G,iBAAkB3G,KAAK0G,YAGpG,IAAK,IAAIlD,EAAI,EAAGA,EAAIxD,KAAKiG,QAAQxC,OAAQD,IACvCxD,KAAKiG,QAAQzC,GAAG0D,MAAMD,IAAI,aAAcjH,KAAKmH,eAAgBnH,MAC7DA,KAAKiG,QAAQzC,GAAG0D,MAAMD,IAAI,aAAcjH,KAAKuG,eAAgBvG,OAGnEoH,mBAAoB,SAAUF,EAAOG,GAEnC,IADA,IAAIC,GAAe,EACV9D,EAAE,EAAEA,EAAExD,KAAKiG,QAAQxC,OAAOD,IACjC,GAAIxD,KAAKiG,QAAQzC,GAAG0D,QAAUA,EAAO,CACnCI,GAAe,EACftH,KAAKiG,QAAQzC,GAAG6D,KAAOA,EAEvB,MAUJ,OAPKC,GACHtH,KAAKuH,WAAWL,EAAOG,GAEA,EAAtBrH,KAAKiG,QAAQxC,SACdzD,KAAK0G,WAAWc,gBAAgB,UAChCxH,KAAKY,KAAKkG,eAAgB,GAEpB9G,KAAS,KAAIA,KAAK6G,UAAY7G,MAExCyH,YAAa,SAAUP,GACrBtH,EAAE2F,QAAQC,OAAOnE,UAAUoG,YAAYnG,KAAKtB,KAAMkH,GACvB,IAAxBlH,KAAKiG,QAAQxC,QACdzD,KAAK0G,WAAWtD,aAAa,SAAU,KAG3CmD,eAAgB,SAAU1E,GACxB,IAAKZ,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKiG,QAAQxC,OAAQD,IACvC,GAAIxD,KAAKiG,QAAQzC,GAAGkE,MAAMC,OAAO,GAAjC,CACA1G,IAAI2G,EAAQ5H,KAAKiG,QAAQzC,GAAGkE,MAAMC,OAAO,GAAGnH,qBAAqB,QAC7DkH,EAAQ1H,KAAKiG,QAAQzC,GAAGkE,MAAMC,OAAO,GAAGnH,qBAAqB,SAUjE,GATAkH,EAAM,GAAGG,QAAU7H,KAAKiG,QAAQzC,GAAG0D,MAAMY,SAASD,QAC/C7H,KAAKiG,QAAQzC,GAAG0D,MAAMY,SAASC,UAAY/H,KAAKiG,QAAQzC,GAAG0D,MAAMY,SAASD,SAC3EH,EAAM,GAAGM,QAAQ,YAAYD,UAAW,EACxCH,EAAM,GAAGK,MAAMC,UAAY,WAE3BR,EAAM,GAAGM,QAAQ,YAAYD,UAAW,EACxCH,EAAM,GAAGK,MAAMC,UAAY,UAG1BlI,KAAKiG,QAAQzC,GAAG0D,MAAMiB,SAAWnI,KAAKiG,QAAQzC,GAAG0D,MAAMiB,QAAQC,YAChE,IAAInH,IAAIoH,EAAI,EAAGA,EAAIrI,KAAKiG,QAAQzC,GAAG0D,MAAMiB,QAAQC,YAAY3E,OAAQ4E,IAAI,CACvEpH,IAAIyG,EAAQ1H,KAAKiG,QAAQzC,GAAG0D,MAAMiB,QAAQC,YAAYC,GAAGC,cACrDV,EAAQF,EAAMa,uBAAuB,yBAAyB,GAC/DvI,KAAKiG,QAAQzC,GAAG0D,MAAMiB,QAAQC,YAAYC,GAAGN,UAAY/H,KAAKiG,QAAQzC,GAAG0D,MAAMiB,QAAQC,YAAYC,GAAGR,SACvGD,EAAMK,MAAMC,UAAY,SACxBR,EAAMK,UAAW,IAEjBH,EAAMK,MAAMC,UAAY,SACxBR,EAAMK,UAAW,MAS3BpB,iBAAkB,SAAS9E,GACzB,IACM2G,EADQ,UAAV3G,EAAEX,KAAsC,2EAAnBlB,KAAKyI,YACxBD,EAAOxI,KAAK0I,SAAS,GAAGA,SAAS,GAAGA,SAAS,GAAGA,SAAS,GAAGA,SAAS,GAAGA,SAAS,KAC5EC,WAAW,IAAMH,EAAKI,QAAS,IAI5CC,kBAAmB,SAASrE,EAAMsE,GAC9B,OAAOA,EAAM3H,KAAOqD,GAAQA,GAAQsE,EAAM1H,KAE9C2H,SAAU,SAAUC,GAClB,IAAIC,EAAkBD,EAAI9B,MAAMgC,2BAchC,OAZAF,EAAItB,MAAQuB,EAAcE,cAAc,yCAExCnJ,KAAKgG,oBAAoBV,KAAK0D,EAAItB,OAClCsB,EAAItB,MAAM0B,QAAUxJ,EAAEyJ,MAAML,EAAI9B,OAEhCtH,EAAE4G,SAASF,GAAG0C,EAAItB,MAAO,QAAS1H,KAAKsJ,cAAetJ,MAKtDgJ,EAAI9B,MAAMZ,GAAG,aAActG,KAAKuG,eAAgBvG,MAChDA,KAAKuJ,cAAcxF,YAAYkF,GACxBA,GAITO,SAAU,SAAS3H,GACjB,MACuB,WAArBA,EAAE4H,OAAOC,SACT7H,EAAE8H,eACF9H,EAAE8H,cAAcC,gBAEgB,uCAA9B/H,EAAE8H,cAAclB,WAC4B,uCAA5C5G,EAAE8H,cAAcC,cAAcnB,YAE/BzI,KAAKY,MAA2D,UAAnDZ,KAAKY,KAAKiJ,YAAYC,WAAW7B,MAAM8B,UAGvDnK,EAAEoK,QAAQC,YAAYjK,KAAK0G,WAAY,mCACF,UAAjC7E,EAAEqI,eAAeC,cACnBnK,KAAK0G,WAAW0D,aAAc,IAJvBpK,MAQX4G,2BAA4B,SAAU/E,GACpCZ,IAAIoJ,EAASrK,KAAKY,KAAK0J,mBAAmBzI,GACtC0I,EAAiBvK,KAAKY,KAAK4J,2BAA2B3I,GAC1DA,EAAE4I,iBAGGzK,KAAK0G,WAAW0D,aAAiC,UAAlBvI,EAAEsI,YAItCnK,KAAKY,KAAK8J,KAAK,cACb,CAAER,cAAerI,EACf0I,eAAgBA,EAChBF,OAAQA,IANVrK,KAAK0G,WAAW0D,aAAc,KAatC,MAAMO,EAAsB,UACtBC,EAAc,aACdC,EAAgB,gCAkWH,SAAfC,EAAyBC,EAAOxL,GACnC,OAAO,IAAIyL,EAAaD,EAAOxL,GA0cP,SAArB0L,EAA8BC,EAAU3L,GAC1C,OAAO,IAAI4L,EAAmBD,EAAU3L,GAqQrB,SAAjB6L,EAA0BC,EAAW9L,GAKvC,OAAO,IAAI+L,EAAeD,EAAW9L,GAmSV,SAAzBgM,EAAkCL,EAAU3L,GAC5C,OAAO,IAAIiM,EAAuBN,EAAU3L,GAwOtB,SAAtBkM,EAA+BP,EAAU3L,GACzC,OAAO,IAAImM,EAAoBR,EAAU3L,GA2G5B,SAAboM,EAAuBC,EAAKC,EAAUC,EAAMC,EAAOtH,EAAWlF,GAC1D,OAAO,IAAIyM,EAAWJ,EAAKC,EAAUC,EAAMC,EAAOtH,EAAWlF,GAu8CpD,SAAb0M,EAAuBL,EAAKM,EAAM3M,GACpC,OAAKqM,GAAQM,EACP,IAAIC,EAAWP,EAAKM,EAAM3M,GADN,KAiDT,SAAf6M,IACF,OAAO,IAAIC,EAzqGb,IAAIrB,EAAepL,EAAE0M,aAAaxM,OAAO,CAIrCC,WAAY,SAAUgL,EAAOxL,GAiB3B,IAQMgN,EAlBN3M,EAAES,WAAWL,KAAMT,GAChBS,KAAKT,QAAQiN,SACdxM,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,gBAAiBzM,KAAKT,QAAQmN,MAGxE9M,EAAEoK,QAAQ2C,SAAS3M,KAAK0G,WAAY,uCACpC9G,EAAES,WAAWL,KAAKT,QAAQqN,SAAU,CAACF,KAAM1M,KAAK0G,cAGlD1G,KAAKiG,QAAU,GACZjG,KAAKT,QAAQsN,QACd7M,KAAK8M,eAAiB/B,EAAMgC,UAA2BhC,EACvD/K,KAAKmC,WAAY,EACboK,EAASvM,KAAKgN,oBAAoBjC,GACtC/K,KAAKT,QAAQuF,WAAayH,EAAO/H,KACjCxE,KAAKT,QAAQ0N,SAAWV,EAAOW,IAE7BnC,IAAU/K,KAAKT,QAAQsN,QACrBN,EAASvM,KAAKgN,oBAAoBjC,IAElCA,EAAM5B,cAAc,eAAiB4B,EAAM5B,cAAc,gBAAkBnJ,KAAKT,QAAQiN,SAC1FxM,KAAKmN,UAAY,GACjBnN,KAAKoN,gBAAiB,EACtBpN,KAAKmC,WAAY,EACjBnC,KAAKC,WAAaD,KAAKE,eAAe6K,EAAOwB,EAAO/H,MACpDxE,KAAKc,YAAcd,KAAKW,gBAAgBoK,GACxCnL,EAAEE,OAAOE,KAAKT,QAASS,KAAKC,aAE9BD,KAAKqN,QAAQtC,EAAOwB,EAAOW,GAAIX,EAAO/H,MACnCxE,KAAKoN,iBACNpN,KAAKsN,iBACLtN,KAAKT,QAAQgO,cAAc3M,KAAK4M,cAAcxN,SAKpDS,MAAO,SAASuG,GACdpH,EAAE0M,aAAajL,UAAUZ,MAAMa,KAAKtB,KAAMgH,GACvChH,KAAK8M,gBAAe9F,EAAIV,GAAG,oBAAqBtG,KAAKyN,sBAAuBzN,OAGjF+G,SAAU,SAASC,GACdhH,KAAK8M,iBACN9F,EAAIC,IAAI,oBAAqBjH,KAAKyN,sBAAuBzN,aAClDA,KAAK8M,eACZlN,EAAEoK,QAAQ0D,OAAO1N,KAAK0G,aAExB9G,EAAE0M,aAAajL,UAAU0F,SAASzF,KAAKtB,KAAMgH,GAC7ChH,KAAKY,KAAK+M,aAAaC,cAGzBpM,UAAW,WACT,OAAGxB,KAAKoN,eACC,CACLzL,QAAU3B,KAAKuB,eACfsM,QAAY7N,KAAK8N,gBAGd,IAKTL,sBAAuB,SAAS5L,GAC9B,GAAG7B,KAAKT,QAAQsN,OAAS7M,KAAK8M,eAAejL,EAAE2B,GAAG,CAChDvC,IAAI8M,EAAU/N,KAAK8M,eAAejL,EAAE2B,GAEpCuK,EAAQC,UAAUC,WAAWC,YAAYR,SACzC1N,KAAKmO,cACLJ,EAAQK,cAAgBpO,KAAKqN,QAAQU,EAAS/N,KAAKT,QAAQ0N,SAAUjN,KAAKT,QAAQuF,YAClFiJ,EAAQC,UAAUC,WAAWlK,YAAYgK,GACzClM,EAAEwM,MAAMC,eAAenF,cAAc,KAAKoF,UAAa1M,EAAE2B,EAAI,EAAK,IAAMxD,KAAKT,QAAQgO,cAAciB,mBACnG3M,EAAEwM,MAAMI,SAAStF,cAAc,UAAU/F,aAAa,UAAW,iCACjEvB,EAAEwM,MAAMI,SAAStF,cAAc,UAAUuF,OAASX,EAAQ5E,cAAc,kBAAkBwF,UAE1F3O,KAAKY,KAAK8J,KAAK,iBAAkB,CAAClH,EAAE3B,EAAE2B,EAAGoL,YAAab,IACtD/N,KAAKY,KAAKiO,KAAK,aAAc,SAAUhN,GACrC7B,KAAKiO,WAAWU,UAAY,IAC3BZ,EAAQC,aAIfhB,oBAAqB,SAASjC,GAK5B,MAAO,CAACvG,KAJUuG,EAAM5B,eAAiB4B,EAAM5B,cAAc,yBACxD5G,EAAEoC,qBAAqBoG,EAAM5B,cAAc,uBAAuBvE,aAAa,YAAYG,OAAU,EAGjFmI,GAFTnC,EAAM5B,eAAiB4B,EAAM5B,cAAc,sBACvD5G,EAAEoC,qBAAqBoG,EAAM5B,cAAc,qBAAqBvE,aAAa,YAAYkK,SAAY,SAI3GvN,eAAiB,WACfN,IAAIa,EAAU9B,KAAKY,KAAKmB,UACpBgN,EAAajN,GAAW9B,KAAKC,WAAWmC,SAAWN,GAAW9B,KAAKC,WAAWoC,QAClFrC,KAAKmC,UAAY4M,GAAc/O,KAAKiG,SAAWjG,KAAKc,aAClCd,KAAKc,YAAYwB,SACfC,EAAEC,kBACAxC,KAAKY,KAAK6B,iBACVX,EAAQ9B,KAAKY,KAAKrB,QAAQsB,aAChDb,KAAKgP,cAGPlB,eAAgB,SAASjM,GACvBZ,IAAIa,EAAU9B,KAAKY,KAAKmB,UACrBD,EAAU9B,KAAKC,WAAWmC,SAAWN,EAAU9B,KAAKC,WAAWoC,QAChErC,KAAKmO,cAGPnO,KAAKsN,kBAIP3M,gBAAkB,SAAS8D,GACzB,IAAKA,EAAW,OAAO,KACvBxD,IAAIiM,EAAKtC,EACL/J,EAAa4D,EAAU0E,cAAc,8BAC3B5G,EAAEoC,qBACAF,EAAU0E,cAAc,6BAA6BvE,aAAa,YACjEkK,QAAQG,eAAiBtE,EAC1C,IAEE1J,IAAIyD,EAAOD,EAAU0E,cAAc,0BACvB5G,EAAEoC,qBACAF,EAAU0E,cAAc,yBAAyBvE,aAAa,YAExEJ,EAAOE,EAAKF,MAAQ,EAExBvD,IAAIiO,EAAWnO,OAAOC,KAAK0D,GAC3B,IAAIzD,IAAIuC,EAAG,EAAEA,EAAE0L,EAASzL,OAAOD,IAC7B,IAAI0L,EAAS1L,GAAG2L,SAAS,QAAQ,CAC/BjC,EAAK3K,EAAE6M,SAASF,EAAS1L,GAAGY,MAAM,KAAK,IACvC,MAGJnD,IAAIoO,EAAO9M,EAAE+M,SAASpC,GACtB,OAAO3K,EAAEgN,mBACD3P,EAAEsE,OAAOtE,EAAE0E,OAAOI,EAAK,YAAY2K,EAAK,KAAO3K,EAAK,YAAY2K,EAAK,KACrEzP,EAAE0E,OAAOI,EAAK,gBAAgB2K,EAAK,KAAO3K,EAAK,gBAAgB2K,EAAK,MACpE7K,EAAK3D,EAAWqM,GACxB,MAAOsC,GAEP,OAAOjN,EAAEgN,mBAAmBhN,EAAE1B,GAAYtB,QAAQ0E,IAAIwL,WAAWvL,OAAO,GAAG,EAAErD,EAAYqM,KAI7FI,eAAiB,WACftN,KAAKmO,cAEFnO,KAAKY,MAAMZ,KAAKY,KAAK+M,aAAaC,aACrC3M,IAAI+F,EAAMhH,KAAKY,MAAQZ,KAAKT,QAAQgO,cAAc3M,KAClD,GAAGZ,KAAKmN,UACN,IAAKlM,IAAIuD,KAAQxE,KAAKmN,UACpB,IAAIlM,IAAIyO,EAAG,EAAEA,EAAI1P,KAAKmN,UAAU3I,GAAMf,OAAOiM,IAAI,CAC/CzO,IAAI8M,EAAU/N,KAAKmN,UAAU3I,GAAMkL,GAC/BC,EAAc5B,EAAQ6B,aAAa5I,EAAIjF,UAAW/B,KAAKC,WAAWoC,QAASrC,KAAKC,WAAWmC,SAC3FuN,GACF3P,KAAK6P,SAAS9B,KAOxB+B,kBAAmB,SAASC,EAAQC,GAClC,IAAIC,EAAQjQ,KAAKY,KAAKsP,aAAalQ,KAAKY,KAAKmB,UAAUiO,GACvDG,EAAYJ,EAAOK,WAAWH,GACzBI,SAASrQ,KAAKY,KAAK0P,mBAAmBP,EAAQ/P,KAAKY,KAAKmB,YAAYwO,QAErEC,MACF5Q,EAAE6Q,aAAazQ,KAAKiG,QAAQ+J,GAAYG,EAAWF,GAEnDrQ,EAAE8Q,YAAY1Q,KAAKiG,QAAQ+J,GAAYG,IAI3CjQ,eAAgB,SAASuE,EAAWK,GAClC,IAAKL,EAAW,OAAO,KACvBxD,IAAI0P,EAAO,IAAIC,EAAK,EAAG7D,EAAWtI,EAAUoM,iBAAiB,eAAenM,EAAK7D,EACjF,IAAII,IAAIuC,EAAG,EAAEA,EAAEuJ,EAAStJ,OAAOD,IAAI,CACjCvC,IAAI+D,GAAS+H,EAASvJ,GAAGoB,aAAa,QAClCmI,EAASvJ,GAAGoB,aAAa,UAAQI,EAAQF,GAC7C8L,EAAO3L,KAAK7D,IAAIwP,EAAM5L,GACtB2L,EAAO1L,KAAK9D,IAAIwP,EAAM3L,GAExB,IACEnE,EAAa0B,EAAEoC,qBAAqBF,EAAU0E,cAAc,6BAA6BvE,aAAa,YAAYkK,QAClHpK,EAAOnC,EAAEoC,qBAAqBF,EAAU0E,cAAc,uBAAuBvE,aAAa,YAC1F,MAAM4K,GACN,MAAO,CACLnN,QAAQ,EACRD,QAASG,EAAE1B,GAAc8J,GAAqBpL,QAAQuR,YAAYrN,OAAS,EAC3EvB,cAAcyO,EACd1O,cAAc2O,GAGlB,MAAO,CACLvO,SAASqC,EAAKvD,IACdiB,SAASsC,EAAKtD,IACdc,cAAcyO,EACd1O,cAAc2O,IAIlBvD,QAAS,SAAUtC,EAAOkC,EAAUnI,GAClC,IACItB,EAAGuN,EAYLhD,EAbEhB,EAAWhC,EAAMiG,WAAaC,KAAKC,eAAoC,WAAnBnG,EAAMoG,SAAwBpG,EAAMvK,qBAAqB,eAAiB,KAUlI,IAPwBuK,EAAMiG,WAAaC,KAAKC,cAAgBnG,EAAM5B,cAAc,sCAAwC,QAEtHiI,EAAOrG,EAAM5B,cAAc,aAAe4B,EAAM5B,cAAc,YAAYkI,aAAa,QACvF,IAAIC,IAAIvG,EAAM5B,cAAc,YAAYvE,aAAa,SAAS2M,KAC9DxG,EAAMuG,IACV/O,EAAEiP,uBAAuBzG,EAAMqG,EAAKpR,KAAK0G,aAEvCqG,EAAU,CACb,IAAKvJ,EAAI,EAAGuN,EAAMhE,EAAStJ,OAAQD,EAAIuN,EAAKvN,KAE3CuK,EAAUhB,EAASvJ,IACWhD,qBAAqB,gBAAgBiD,QAAUsK,EAAQvN,qBAAqB,mBAAmBiD,SAEvHsH,EAAMiG,WAAaC,KAAKC,eAGvBnD,EAAQ0D,WAAU1D,EAAQ0D,SAAW1D,EAAQ2D,WAAU,IAC5D3D,EAAQ0D,SAASrD,cAAgBpO,KAAKqN,QAAQU,EAAQ0D,SAAUxE,EAAUnI,IAE1EiJ,EAAQK,cAAgBpO,KAAKqN,QAAQU,EAASd,EAAUnI,IAI3D,OAAO9E,KAIR,IAAIT,EAAUS,KAAKT,QAEnB,IAAIA,EAAQoS,QAAWpS,EAAQoS,OAAO5G,GAAtC,CAEIA,EAAM6G,UAAUnO,SAClBlE,EAAQkJ,UAAYsC,EAAM6G,UAAU7M,OAEtC9D,IAAIuD,EAAOuG,EAAMnG,aAAa,SAAWE,EAAY+M,EAAQ9G,EAAM5B,cAAc,sBACjF0I,EAAQA,EAAQA,EAAMlD,UAAY,UAE/B5D,EAAM5B,cAAc,oBACrB5J,EAAQuS,WAAa9O,SAASC,cAAc,OAC5C1D,EAAQuS,WAAWF,UAAUG,IAAI,uBACjCxS,EAAQuS,WAAWE,mBAAmB,aAAcjH,EAAM5B,cAAc,kBAAkBwF,YAG5F1N,IAAIiG,EAAQlH,KAAKiS,gBAAgBlH,EAAOxL,EAAS0N,GAAWzI,EAAMqN,GAClE,GAAI3K,EAyBF,OAtBKA,EAAM3H,QAAQ2S,OAASnH,EAAMsG,aAAa,WAC7CnK,EAAM3H,QAAQkJ,UAAYsC,EAAMnG,aAAa,UAE/CsC,EAAMiL,eAAiBjL,EAAM3H,QAC7BS,KAAKoS,WAAWlL,GAEZ3H,EAAQ8S,eACVnL,EAAMoL,YAAYT,EAAO,CAAEU,aAAY,EAAMC,QAAQ,IAEnDxS,KAAKoN,gBACHqF,EAAc1H,EAAMnG,aAAa,SAAWE,KAC9B9E,KAAKmN,UACrBnN,KAAKmN,UAAUsF,GAAanN,KAAK4B,GAEjClH,KAAKmN,UAAUsF,GAAa,CAACvL,GAG/BlH,KAAK6P,SAAS3I,GAEoB,gBAAhC6D,EAAMrB,QAAQuF,gBAChBlE,EAAM2H,SAAWxL,EAAM3H,QAAQoT,OAE1BzL,IAIXkL,WAAY,SAAUlL,GACpB,IAAIe,EAAQjI,KAAKT,QAAQ0I,MACrBA,IAEHrI,EAAEgT,KAAK9S,OAAOoH,EAAM3H,QAAS2H,EAAMiL,gBACnCnS,KAAK6S,eAAe3L,EAAOe,KAI9B6K,SAAU,SAAU7K,GAClBjI,KAAK+S,UAAU,SAAU7L,GACvBlH,KAAK6S,eAAe3L,EAAOe,IAC1BjI,OAGL6S,eAAgB,SAAU3L,EAAOe,GACV,mBAAVA,IACTA,EAAQA,EAAMf,EAAM6G,UAElB7G,EAAM4L,UACR5L,EAAM4L,SAAS7K,IAGnB+G,WAAY,WACV/N,IAAI+R,EAAWhT,KAAK0G,WAAWmK,iBAAiB,8BAChD,IAAI5P,IAAIuC,EAAI,EAAGA,EAAIwP,EAASvP,OAAOD,IACjCxD,KAAK0G,WAAWuM,YAAYD,EAASxP,KAG3CyO,gBAAiB,SAAUlH,EAAOmI,EAAejG,EAAUzI,EAAMqN,GAC/D5Q,IAAIkS,EAA2C,gBAAhCpI,EAAMrB,QAAQuF,cAAkClE,EAAMvK,qBAAqB,gBAAgB,GAAKuK,EAC3GmC,EAAKiG,GAAUvO,aAAa,OAASqI,EAAU0F,EAAQ,GAAIS,EAAWxT,EAAEyT,IAAI5G,OAAO,KAAM6G,EAAcvS,OAAOwS,OAAO,GAAIL,GAC7H,GAAIC,EAAU,CACZ,IAAIlS,IAAIuS,KAAOL,EAAStC,iBAAiB,+EACvC8B,EAAMrN,KAAK/C,EAAEwL,QAAQyF,EAAKzS,OAAOwS,OAAOD,EACtC,CAAErG,SAAUC,EACVpI,WAAYN,EACZ3D,WAAYb,KAAKT,QAAQsB,WACzB4S,UAAW1I,EAAM2I,GACjBf,MAAOS,EACPO,SAAU3T,KAAK4T,oBAAoBJ,EAAI5J,eACvCkB,aAAc9K,KACduN,cAAevN,KAAKT,QAAQgO,kBAGlCtM,IAAI4S,EAAe,CAAClB,MAAMS,EAAUU,aAAc/I,EAAO0I,UAAW1I,EAAM2I,GAAIK,gBAAiBlC,EAAOQ,cAAea,EAAcb,cAAeP,WAAYoB,EAAcpB,WAAYvE,cAAevN,KAAKT,QAAQgO,eAClNyG,EAAcb,EAAShK,cAAc,qBAAuBgK,EAAShK,cAAc,0BAErF,OADK6K,IAAaH,EAAaF,SAAW3T,KAAK4T,oBAAoBI,EAAYpK,gBACxErH,EAAE0R,aAAatB,EAAOkB,KAIjCD,oBAAqB,SAASM,EAASC,EAAQ,IAC7C,OAAGD,GAA6C,iBAAlCA,EAAQxK,QAAQuF,cACS,qBAAlCiF,EAAQxK,QAAQuF,eAA0E,2BAAlCiF,EAAQxK,QAAQuF,cAClEjP,KAAK4T,oBAAoBM,EAAQtK,cAAeuK,GAClDnU,KAAK4T,oBAAoBM,EAAQtK,cAAeuK,EAAMC,OAAO,CAACF,KAE9DC,KAQThJ,EAAqBvL,EAAEyU,UAAUvU,OAAO,CAOxCC,WAAY,SAASmL,EAAU3L,GAG7B0B,IAAIqT,EAAY/R,EAAEgS,oBAAoBrJ,GACtClL,KAAKC,WAAaqU,EAAUrU,WAC5BD,KAAKwU,aAAaF,EAAUpQ,OAC5BlE,KAAKmC,WAAY,EACjBvC,EAAEE,OAAOP,EAASS,KAAKC,YACvBV,EAAQkV,IAAMvJ,EAASuJ,WAChBlV,EAAQmV,QACf9U,EAAES,WAAWL,KAAMT,GACnBS,KAAK2U,uBAAuBzJ,GAE5BlL,KAAK4U,UAAY1J,EACjBlL,KAAK6U,iBAGLjV,EAAEyU,UAAUhT,UAAUtB,WAAWuB,KAAKtB,KAAMkL,EAASA,SAAUtL,EAAEE,OAAOP,EAAS,CAACmN,KAAM1M,KAAK0G,eAE/FjG,MAAQ,WACNT,KAAKY,KAAK4M,cAAcxN,MACxBJ,EAAEyU,UAAUhT,UAAUZ,MAAMa,KAAKtB,KAAKA,KAAKY,MAC3CZ,KAAKuB,kBAGPC,UAAW,WACTP,IAAIQ,EAAS7B,EAAEyU,UAAUhT,UAAUG,UAAUF,KAAKtB,KAAKA,KAAKY,MAG5D,OAFAZ,KAAK0B,iBAAmBD,EAAOE,QAC/BF,EAAOE,QAAU3B,KAAKuB,eACfE,GAGToT,eAAgB,WACV7U,KAAK0G,aAET1G,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,gBAAiBzM,KAAKT,QAAQmN,MACxE9M,EAAEoK,QAAQ2C,SAAS3M,KAAK0G,WAAW,kCACnC1G,KAAK8U,kBAEPvT,eAAiB,SAASM,GACxBZ,IAAIa,EAAU9B,KAAKY,KAAKmB,UACpBgT,EAAYxS,EAAEC,kBAAkBxC,KAAKY,KAAK6B,iBAAiBX,EAAQ9B,KAAKY,KAAKrB,QAAQsB,YACzFb,KAAKmC,UAAYL,GAAW9B,KAAKT,QAAQ6C,SAAWN,GAAW9B,KAAKT,QAAQ8C,SAC1DrC,KAAKwU,aAAalS,SAASyS,GACtC/U,KAAc,WACrBA,KAAK0B,oBAEPmB,WAAY,SAAUF,GACpB1B,IAAI6B,EAAYE,SAASC,cAAc,OACnCC,EAAWlD,KAAKmD,cAapB,GAZAvD,EAAEoK,QAAQ2C,SAAS7J,EAAW,oBAC9BlD,EAAEoK,QAAQ2C,SAAS7J,EAAW,gBAE9B9C,KAAK4U,UAAUI,OAAOC,cAAc,IAAIC,YAAY,gBAAiB,CACnEC,OAAO,CACL9R,EAAEV,EAAOU,EACTC,EAAEX,EAAOW,EACTkB,KAAK7B,EAAOY,EACZ6R,WAAY,IAAStS,EAAUiB,YAAYyE,QAI3CxI,KAAK4U,UAAUS,KAAKC,WAAW,UAAW,CAC5CrU,IAAIyC,EAAO9D,EAAEyU,UAAUhT,UAAUwB,WAAWvB,KAAKtB,KAAM2C,EAAQ,cAC/De,EAAKC,MAAQT,EAASG,EACtBK,EAAKE,OAASV,EAASI,EACvBR,EAAUiB,YAAYL,QACb1D,KAAKuV,KAAKpG,SAAStE,IAK5B7K,KAAKwV,WAAW7S,EAAQG,GAE1B,OAAOA,GAET2S,gBAAiB,SAAS/R,GACtB9D,EAAEoK,QAAQ2C,SAASjJ,EAAK,wBAK5BgS,QAAS,WACP,OAAO1V,KAAKT,QAAQmN,MAEtB8I,WAAa,SAAU7S,EAAQe,GAC5BiS,MAAM3V,KAAK4V,WAAWjT,GAAQ,CAACkT,SAAU,WAAWC,KACjD,SAASC,GACP,OAAuB,KAAnBA,EAASC,QAAiBD,EAASC,OAAS,IACvCC,QAAQC,QAAQH,IAEvBI,QAAQC,IAAI,gDAAkDL,EAASC,QAChEC,QAAQI,OAAON,MAEvBD,KAAK,SAASC,GACf,OAAOA,EAASO,SACfR,KAAKQ,IAEF,OADS,IAAIC,WACCC,gBAAgBF,EAAM,qBACvCR,KAAK/K,IACN/K,KAAKyW,gBAAgB1L,EAAOpI,EAAQe,GACpC1D,KAAKyV,gBAAgB/R,KACpBgT,MAAMC,IAAQR,QAAQC,IAAI,0BAGnCK,gBAAiB,SAASG,EAAQjU,EAAQe,GACxCzC,IAEMmQ,EAFYwF,EAAOzN,cAAc,wCAEjCiI,EAAOwF,EAAOzN,cAAc,aAAeyN,EAAOzN,cAAc,YAAYkI,aAAa,QAC3F,IAAIC,IAAIsF,EAAOzN,cAAc,YAAYvE,aAAa,SAAS2M,KAC/DqF,EAAOtF,IACT/O,EAAEiP,uBAAuBoF,EAAOxF,EAAK1N,IAGvCzC,IAAI4V,EAAMjX,EAAEyT,IAAI5G,OAAO,OAAQqK,EAAIlX,EAAEyT,IAAI5G,OAAO,KAAMvJ,EAAWlD,KAAKY,KAAKrB,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EAC/G0T,EAAUpU,EAAOU,EAAIH,EAAU8T,EAAUrU,EAAOW,EAAIJ,EAExDjC,IAMQgW,EANJC,EAAe3U,EAAEuI,aAAa8L,EAAQ,CACxC/V,WAAYb,KAAKY,KAAKrB,QAAQsB,WAC9B2L,QAAQ,EACR+F,aAAa,IAGf,IAAQ0E,KAAWC,EAAajR,QAC9B,IAAIhF,IAAIwS,KAAayD,EAAajR,QAAQgR,GAAShR,QAAQ,CACzDhF,IAAIiG,EAAQgQ,EAAajR,QAAQgR,GAAShR,QAAQwN,GAClDlR,EAAE4U,gBAAgB9V,UAAU+V,UAAUlQ,GAAO,GAC7CA,EAAMmQ,SAASrX,KAAKY,KAAMhB,EAAE0E,MAAM,CAACyS,EAASC,IAAWrU,EAAOY,GAC9DhB,EAAE4U,gBAAgB9V,UAAUiW,SAASpQ,EAAO4P,GAAG,GAC/CvU,EAAE4U,gBAAgB9V,UAAUkW,eAAerQ,GAG/C2P,EAAIzT,aAAa,QAASF,EAASsU,YACnCX,EAAIzT,aAAa,SAAUF,EAASsU,YACpCX,EAAI9S,YAAY+S,GAChBpT,EAAKK,YAAY8S,IAGnBjB,WAAY,SAAUjT,GAClB,GAAIA,EAAOY,GAAKvD,KAAK4U,UAAUnF,WAAWvL,OAAOT,SACxCzD,KAAK4U,UAAUnF,WAAWvL,OAAOvB,EAAOY,GAAGkU,SAAS9U,GAC3D,MAAO,GAET,IAaS+U,EAbL1O,EAAM,GACNgM,EAAShV,KAAK4U,UAAUI,OACxB2C,EAAY3C,EAAO2C,UAWvB,IAASD,KAVT1O,EAAIhJ,KAAK4U,UAAUnF,WAAWrK,IAAIiC,MAAQ1E,EAAOU,EACjD2F,EAAIhJ,KAAK4U,UAAUnF,WAAWtK,IAAIkC,MAAQ1E,EAAOW,EAC7CqU,GAAc3C,EAAO3D,aAAa,SAClC2D,EAAOpQ,aAAa,QAAQuK,aAAawI,EAAU/S,aAAa,cAClEoE,EAAIhJ,KAAK4U,UAAUpQ,KAAK6C,MAAQrH,KAAK4X,kBAEvC5O,EAAIhJ,KAAK4U,UAAUiD,KAAKC,QAAQC,MAAQ/X,KAAKgY,0BAA0BrV,EAAQ,YAAYU,EAC3F2F,EAAIhJ,KAAK4U,UAAUiD,KAAKC,QAAQG,OAASjY,KAAKgY,0BAA0BrV,EAAQ,aAAaU,EAC7F2F,EAAIhJ,KAAK4U,UAAUiD,KAAKK,SAASC,KAAOnY,KAAKgY,0BAA0BrV,EAAQ,YAAYW,EAC3F0F,EAAIhJ,KAAK4U,UAAUiD,KAAKK,SAASE,QAAUpY,KAAKgY,0BAA0BrV,EAAQ,eAAeW,EACnFtD,KAAK4U,UAAUlR,KACrB,CAAC,MAAM,MAAM,OAAO,OAAO,QAAQ,MAAM,UAAU2U,QAAQX,GAAK,IAChE1O,EAAI0O,GAAK1X,KAAK4U,UAAUlR,KAAKgU,IAWrC,OARI1X,KAAKY,OAASZ,KAAKY,KAAKrB,QAAQ0E,IAAIqU,WAClCC,EAAYvY,KAAKwY,iBAAiBpX,IAAIkC,EAAIX,EAAOW,EACjDtD,KAAKT,QAAQkV,MACfzL,EAAIhJ,KAAK4U,UAAUnF,WAAWtK,IAAIkC,MAAQkR,IAI9CvP,EAAIyP,EAAIzY,KAAKT,QAAQmZ,cAAgB9Y,EAAE+Y,QAAQC,QAAiC,EAAvB5Y,KAAKT,QAAQ6C,QAAc,MAAQ,GACrFxC,EAAEgT,KAAK1H,SAASlL,KAAKuV,KAAMvM,IAEtCgP,0BAA2B,SAAUrV,EAAQkW,GAsB/C,IACI5U,EADMjE,KAAKY,KACDrB,QAAQ0E,IAClBf,EAAWlD,KAAKmD,cAEhB2V,EAAUnW,EAAOoW,QAAQ7V,GACzB8V,EAAUF,EAAQ/G,IAAI7O,GACtB+V,EAAcH,EAAQ/G,IAAI9M,KAAKiU,MAAMhW,EAAW,IAEhDiW,EAAKlV,EAAImV,eAAeC,YAAYP,EAAQ7U,EAAIgM,MAAMtN,EAAOY,IAC7D+V,EAAKrV,EAAImV,eAAeC,YAAYL,EAAQ/U,EAAIgM,MAAMtN,EAAOY,IAC7DgW,EAAMtV,EAAImV,eAAeC,YAAYJ,EAAahV,EAAIgM,MAAMtN,EAAOY,IACnEiW,EAAS,KAET,OAAQX,GACN,IAAI,WACFW,EAASL,EACT,MACF,IAAI,cACFK,EAAS,IAAI5Z,EAAE6Z,MAAMN,EAAG9V,EAAEiW,EAAGhW,GAC7B,MACF,IAAI,cACFkW,EAAS,IAAI5Z,EAAE6Z,MAAMN,EAAG9V,EAAEkW,EAAIjW,GAC9B,MACF,IAAI,YACFkW,EAAS,IAAI5Z,EAAE6Z,MAAMH,EAAGjW,EAAE8V,EAAG7V,GAC7B,MACF,IAAI,eACFkW,EAASF,EACT,MACF,IAAI,eACFE,EAAS,IAAI5Z,EAAE6Z,MAAMH,EAAGjW,EAAEkW,EAAIjW,GAC9B,MACF,IAAI,aACFkW,EAAS,IAAI5Z,EAAE6Z,MAAMF,EAAIlW,EAAE8V,EAAG7V,GAC9B,MACF,IAAI,gBACFkW,EAAS,IAAI5Z,EAAE6Z,MAAMF,EAAIlW,EAAEiW,EAAGhW,GAC9B,MACF,IAAI,SACFkW,EAASD,EAGb,OAAOC,GAET7E,uBAAwB,SAASzJ,GAS/BA,EAASxH,KAAO,GAKhB,IAJA,IAEIc,EAAMkV,EAAMC,EAAOxU,EAAKC,EAFxBwU,EAAS1O,EAAS2O,OAClB5V,EAAMjE,KAAKT,QAAQ0E,IAAI1E,QAGlBiE,EAAE,EAAEA,EAAE0H,EAAS2O,OAAOpW,OAAOD,IAAK,CACzC,IAAI6R,EAAOuE,EAAOpW,GAAGoB,aAAa,QAC9BkV,EAAQF,EAAOpW,GAAGoB,aAAa,SAC/BmV,EAAOH,EAAOpW,GAAGoB,aAAa,QAC9ByC,EAAOuS,EAAOpW,GAAGoB,aAAa,QAC9BoV,EAAWJ,EAAOpW,GAAGoB,aAAa,YAClCqV,EAA8C,eAApCL,EAAOpW,GAAGkG,QAAQwQ,cAC5BnV,EAAQ6U,EAAOpW,GAAGoB,aAAa,SAC/BzD,EAAMyY,EAAOpW,GAAGoB,aAAa,OAC7BxD,EAAMwY,EAAOpW,GAAGoB,aAAa,OACjC,GAAa,aAATyQ,GAAiC,eAAVyE,EACzB,OAAQC,GACN,IAAI,SACF3U,EAAM,CACJiC,KAAMA,EACNlG,IAAK8C,EAAIA,IAAIwL,WAAW0K,WAAWhZ,IACnCC,IAAK6C,EAAIA,IAAIwL,WAAW0K,WAAW/Y,IAAI6C,EAAI6M,YAAYrN,OAAO,IAE3D2W,MAAMC,OAAOC,WAAWnZ,MAC3BiE,EAAIjE,IAAMkZ,OAAOC,WAAWnZ,IAEzBiZ,MAAMC,OAAOC,WAAWlZ,MAC3BgE,EAAIhE,IAAMiZ,OAAOC,WAAWlZ,IAE9B,MACF,IAAI,MACF+D,EAAM,CACJkC,KAAMA,EACNlG,IAAK8C,EAAIA,IAAIwL,WAAW8K,SAASpZ,IACjCC,IAAM6C,EAAIA,IAAIwL,WAAW8K,SAASnZ,IAAI6C,EAAI6M,YAAYrN,OAAO,IAE1D2W,MAAMC,OAAOC,WAAWnZ,MAC3BgE,EAAIhE,IAAMkZ,OAAOC,WAAWnZ,IAEzBiZ,MAAMC,OAAOC,WAAWlZ,MAC3B+D,EAAI/D,IAAMiZ,OAAOC,WAAWlZ,IAE9B,MACF,IAAI,YACJ,IAAI,UAEAsY,EADGA,GACI,CACLvY,IAAK8C,EAAIA,IAAI4T,KAAKsC,WAAWhZ,IAC7BC,IAAK6C,EAAIA,IAAI4T,KAAKsC,WAAW/Y,KAG5BgZ,MAAMC,OAAOC,WAAWnZ,MAC3BuY,EAAKvY,IAAMkZ,OAAOC,WAAWnZ,IAE1BiZ,MAAMC,OAAOC,WAAWlZ,MAC3BsY,EAAKtY,IAAMiZ,OAAOC,WAAWlZ,IAE3B4Y,IACEA,EAASQ,MAAM,aACjBd,EAAK3B,KAAO1Q,EACH2S,EAASQ,MAAM,gBACxBd,EAAKzB,MAAQ5Q,IAGjB,MACF,IAAI,WACJ,IAAI,WAEAsS,EADGA,GACK,CACNxY,IAAK8C,EAAIA,IAAI4T,KAAK0C,SAASpZ,IAC3BC,IAAK6C,EAAIA,IAAI4T,KAAK0C,SAASnZ,KAG1BgZ,MAAMC,OAAOC,WAAWnZ,MAC3BwY,EAAMxY,IAAMkZ,OAAOC,WAAWnZ,IAE3BiZ,MAAMC,OAAOC,WAAWlZ,MAC3BuY,EAAMvY,IAAMiZ,OAAOC,WAAWlZ,IAE5B4Y,IACEA,EAASQ,MAAM,YACjBb,EAAMxB,IAAM9Q,EACH2S,EAASQ,MAAM,iBACxBb,EAAMvB,OAAS/Q,SAMlB,GAAIgO,GAA+B,SAAvBA,EAAK6E,cAErB1V,EAAO,CACL6C,KAAMA,EACNlG,IAAK,EACLC,IAAK6C,EAAI6M,YAAYrN,OACrBsB,MAAOd,EAAI6M,YAAYrN,SAEpB2W,MAAMC,OAAOI,SAAS1V,EAAM,MACzBsV,OAAOI,SAAS1V,EAAM,KAAOP,EAAKrD,KAClCkZ,OAAOI,SAAS1V,EAAM,KAAOP,EAAKpD,IACxCoD,EAAKO,MAAQsV,OAAOI,SAAS1V,EAAM,IAEnCP,EAAKO,MAAQP,EAAKpD,KAEfgZ,MAAMC,OAAOI,SAAStZ,EAAI,MACvBkZ,OAAOI,SAAStZ,EAAI,KAAOqD,EAAKrD,KAChCkZ,OAAOI,SAAStZ,EAAI,KAAOqD,EAAKpD,MACtCoD,EAAKrD,IAAMkZ,OAAOI,SAAStZ,EAAI,MAE5BiZ,MAAMC,OAAOI,SAASrZ,EAAI,MACvBiZ,OAAOI,SAASrZ,EAAI,KAAOoD,EAAKrD,KAChCkZ,OAAOI,SAASrZ,EAAI,KAAOoD,EAAKpD,MACtCoD,EAAKpD,IAAMiZ,OAAOI,SAASrZ,EAAI,KAEjC8J,EAAS1G,KAAOA,OACZ,GAAIyV,EAAQ,CAEjB,MAAMS,EAAed,EAAOpW,GAAGmX,WAC/BzP,EAASxH,KAAK2D,GAAQ,WAClB,OAAOqT,EAAa3V,WAEnB,CAGL,MAAM2C,EAAQkS,EAAOpW,GACrB0H,EAASxH,KAAK2D,GAAQ,WAClB,OAAOK,EAAM9C,aAAa,WAOhB,SAAlBgW,EAA2BC,EAAErW,GAC3B,OAAO4U,EAAe0B,UAAUD,EAAG5K,EAAMzL,IAAOuW,SAAS7X,GAAUgW,QAJrE,IAAIE,EAAiBpZ,KAAKT,QAAQ0E,IAAImV,eAClClW,EAAWlD,KAAKT,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EACxD4M,EAAQrQ,EAAEob,KAAKhb,KAAKT,QAAQ0E,IAAIgM,MAAOjQ,KAAKT,QAAQ0E,KAIpDyV,GAAQC,GAEVzO,EAAS2M,KAAO,GAChB3M,EAAS2M,KAAK3T,OAAStE,EAAEsE,OAAO,CAACwV,EAAKvY,IAAIwY,EAAMxY,KAAK,CAACuY,EAAKtY,IAAIuY,EAAMvY,MACrE8J,EAAS2M,KAAKC,QAAU4B,EACxBxO,EAAS2M,KAAKK,SAAWyB,GAEfvU,GAAOD,IAAQiV,MAAM5V,EAAKO,QAM7BmG,EAAS2M,OACZ3M,EAAS2M,KAAO,GAChB3M,EAAS2M,KAAKC,QAAU,GACxB5M,EAAS2M,KAAKK,SAAW,IAG3BhN,EAAS2M,KAAK3T,OAAU3B,EAAEgN,mBACd3P,EAAEsE,OAAOtE,EAAE0E,MAAM,CAACc,EAAIjE,IAAIgE,EAAIhE,MAC9BvB,EAAE0E,MAAM,CAACc,EAAIhE,IAAI+D,EAAI/D,OACrBoD,EAAKO,MAAO/E,KAAKT,QAAQ0E,IAAK1B,EAAE6M,SAAS,WAErDlE,EAASuE,WAAa,GACtBvE,EAASuE,WAAWrK,IAAMA,EAC1B8F,EAASuE,WAAWtK,IAAMA,GAG5BgR,QAAQC,IAAI,iDAAmDlL,EAASA,UAGrEA,EAASuE,aACZvE,EAASuE,WAAa,GACtBvE,EAASuE,WAAWrK,IAAM,GAC1B8F,EAASuE,WAAWtK,IAAM,IAE5B+F,EAASuE,WAAWvL,OAAS,GAQ7B,IAPA,IAAI+W,EAAa/P,EAAS2M,KAAK3T,OAK3BgX,EAAOhQ,EAAS1G,KAAK0G,EAAS1G,KAAKrD,IAAI,EACvCga,EAAOjQ,EAAS1G,KAAK0G,EAAS1G,KAAKpD,IAAI6C,EAAI6M,YAAYrN,OAClDF,EAAE,EAAGA,GAAK4X,EAAM5X,IACvB2H,EAASuE,WAAWvL,OAAOX,GAAW2X,GAAL3X,EAC7B3D,EAAEsE,OAAO0W,EAAgBK,EAAW9Z,IAAIoC,GACtCqX,EAAgBK,EAAW7Z,IAAImC,IACvB3D,EAAEsE,OAAOtE,EAAE0E,MAAM,EAAE,GAAG,IAAI1E,EAAE0E,MAAM,EAAE,GAAG,MAGzD8W,WAAY,SAAU5W,GAClBvD,IAAIoa,EAAQzb,EAAEC,UAAUwB,UAAU+Z,WAAW9Z,KAAKtB,KAAMwE,GAUxD,OATGxE,KAAK4U,UAAU0G,KAAOtb,KAAKC,WAAWgC,gBAAejC,KAAK4U,UAAU0G,KAAOtb,KAAKC,WAAWgC,eAE3FuC,IAAS6W,EACR7W,EAAO6W,EAEJ7W,EAAOxE,KAAK4U,UAAU0G,MAAS,IAC9B9W,EAAOS,KAAKiU,MAAM1U,EAAOxE,KAAK4U,UAAU0G,MAAQtb,KAAK4U,UAAU0G,MAGhE9W,KAOX8G,EAAiB1L,EAAE2b,MAAMzb,OAAO,CAClCC,WAAY,SAASsL,EAAW9L,GAC9BS,KAAKwb,WAAcnQ,EACnBzL,EAAES,WAAWL,KAAMT,GACnBS,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,gBAAiBlN,EAAQmN,MACnE1M,KAAK0G,WAAWuB,MAAMyM,QAAU1U,KAAKT,QAAQmV,QAC7C9U,EAAEoK,QAAQ2C,SAAS3M,KAAK0G,WAAW,kCAEnC,IAAK,IAkBK4N,EAlBD9Q,EAAE,EAAEA,EAAE6H,EAAU5H,OAAOD,IACL,SAArB6H,EAAU7H,GAAGiY,KACbzb,KAAK0b,UAAUnc,EAAQoc,cACvB3b,KAAKwb,WAAWhY,GAAG0D,MAAQ3E,EAAE0I,mBAAmBI,EAAU7H,GACxD5D,EAAEgT,KAAK9S,OAAOP,EAAS,CAACqc,aAAc,6EAA8E9V,OAAQvG,EAAQoc,aAAcjP,KAAM1M,KAAK0G,eACnI,UAArB2E,EAAU7H,GAAGiY,KACpBzb,KAAK0b,UAAUnc,EAAQoc,cACvB3b,KAAKwb,WAAWhY,GAAG0D,MAAQ3E,EAAEkJ,oBAAoBJ,EAAU7H,GAAI5D,EAAEgT,KAAK9S,OAAOP,EAAS,CAACuG,OAAQvG,EAAQoc,aAAcjP,KAAM1M,KAAK0G,eACpG,aAArB2E,EAAU7H,GAAGiY,KACpBzb,KAAK0b,UAAUnc,EAAQoc,cACvB3b,KAAKwb,WAAWhY,GAAG0D,MAAQ3E,EAAEgJ,uBAAuBF,EAAU7H,GAAI5D,EAAEgT,KAAK9S,OAAOP,EAAS,CAACuG,OAAQvG,EAAQoc,aAAcjP,KAAM1M,KAAK0G,eACvG,UAArB2E,EAAU7H,GAAGiY,MAGpBzb,KAAK6b,qBAAsB,EACtB7b,KAAK8b,WACR9b,KAAK8b,SAAW,IAEdxH,EAAY/R,EAAEgS,oBAAoBlJ,EAAU7H,IAChD6H,EAAU7H,GAAGgR,aAAeF,EAAUpQ,OACtCmH,EAAU7H,GAAGvD,WAAaqU,EAAUrU,WACpCoL,EAAU7H,GAAGwK,UAAYhO,KAAKT,QAAQwc,SACtC/b,KAAK8b,SAASxW,KAAK1F,EAAEE,OAAOuL,EAAU7H,GAAIxD,KAAKgc,gBAAgB3Q,EAAU7H,QAIjFhC,UAAW,WACP,MAAO,CACHya,UAAWjc,KAAKkc,eAGxBC,OAAQ,WACNnc,KAAKoc,aACL,IAAK,IAAI5Y,EAAE,EAAEA,EAAExD,KAAKwb,WAAW/X,OAAOD,IACL,SAA3BxD,KAAKwb,WAAWhY,GAAGiY,KAA6C,UAA3Bzb,KAAKwb,WAAWhY,GAAGiY,KAA8C,aAA3Bzb,KAAKwb,WAAWhY,GAAGiY,KAC9Fzb,KAAKwb,WAAWhY,GAAG0D,MAAMiV,UAIjCD,aAAc,WACVlc,KAAKoc,cAGTJ,gBAAiB,SAAS9Q,GAmBtB,IAHA,IAAImR,EAAgB,CAACxP,MAAM,IACvB+M,EAAS1O,EAAS2O,OAEbrW,EAAE,EAAEA,EAAE0H,EAAS2O,OAAOpW,OAAOD,IAAK,CACzC,IAAI6R,EAAOuE,EAAOpW,GAAGoB,aAAa,QAC9BkV,EAAQF,EAAOpW,GAAGoB,aAAa,SAC/BmV,EAAOH,EAAOpW,GAAGoB,aAAa,QAC9ByC,EAAOuS,EAAOpW,GAAGoB,aAAa,QAC9BoV,EAAWJ,EAAOpW,GAAGoB,aAAa,YAClC6W,EAAM7B,EAAOpW,GAAGoB,aAAa,OAC7BqV,EAA8C,eAApCL,EAAOpW,GAAGkG,QAAQwQ,cAChC,GAAa,UAAT7E,EACEgH,EAAcxP,MAAMlJ,MAAQ0D,OAC3B,GAAc,WAATgO,EACNgH,EAAcxP,MAAMjJ,OAASyD,OAC5B,GAAa,aAATgO,EACT,OAAQ0E,GACN,IAAI,IACJ,IAAI,IACJ,IAAI,SACJ,IAAI,MACFsC,EAAcxP,MAAMkN,GAAQ1S,EAC5B,MACF,IAAK,YACL,IAAK,UACC2S,EACIA,EAASQ,MAAM,aACL,UAARiB,EACFY,EAAcxP,MAAMyP,UAAYjV,EACf,SAARoU,EACTY,EAAcxP,MAAM0P,SAAWlV,EAE/BgV,EAAcxP,MAAM2P,QAAUnV,EAEvB2S,EAASQ,MAAM,gBACZ,UAARiB,EACFY,EAAcxP,MAAM4P,WAAapV,EAChB,SAARoU,EACTY,EAAcxP,MAAM6P,UAAYrV,EAEhCgV,EAAcxP,MAAM8P,SAAWtV,GAInCgV,EAAcxP,MAAMkN,GAAQ1S,EAEhC,MACF,IAAK,WACL,IAAK,WACC2S,EACIA,EAASQ,MAAM,YACL,UAARiB,EACFY,EAAcxP,MAAM+P,SAAWvV,EACd,SAARoU,EACTY,EAAcxP,MAAMgQ,QAAUxV,EAE9BgV,EAAcxP,MAAMiQ,OAASzV,EAEtB2S,EAASQ,MAAM,iBACZ,UAARiB,EACFY,EAAcxP,MAAMkQ,YAAc1V,EACjB,SAARoU,EACTY,EAAcxP,MAAMmQ,WAAa3V,EAEjCgV,EAAcxP,MAAMoQ,UAAY5V,GAItCgV,EAAcxP,MAAMkN,GAAQ1S,EAE9B,MACF,IAAI,IACY,SAAVyS,EACFuC,EAAcxP,MAAMqQ,MAAQ7V,EAE5BgV,EAAcxP,MAAMsQ,KAAO9V,EAE7B,MACF,IAAI,IACY,SAAVyS,EACFuC,EAAcxP,MAAMuQ,MAAQ/V,EAE5BgV,EAAcxP,MAAMwQ,KAAOhW,OAK5B,GAAa,SAATgO,EAERgH,EAAcxP,MAAMrI,KAAO6C,OACvB,GAAI4S,EAAQ,CAEjB,MAAMS,EAAed,EAAOpW,GAAGmX,WAC/B0B,EAAcxP,MAAMxF,GAAQ,WACxB,OAAOqT,EAAa3V,WAEnB,CAEH,MAAM2C,EAAQkS,EAAOpW,GACtB6Y,EAAcxP,MAAMxF,GAAQ,WACzB,OAAOK,EAAM9C,aAAa,WAKlC,OADAyX,EAAcxP,MAAMgF,MAAQ3G,EAAS2G,MAC9BwK,GAEXiB,MAAO,SAAUjS,EAAWsQ,GAC1B,GAAKtQ,GACArL,KAAKY,KAAV,CACA,IAAI2c,EAAWvd,KAAKY,MAAQZ,KAAKY,KAAK4c,SAASxd,MAC3Cyd,EAAgBzd,KAAKwb,kBAClBxb,KAAK8b,SACZ9b,KAAKY,KAAKqG,IAAI,QAAS,KAAMjH,MAE7BA,KAAKwb,WAAanQ,EAClB,IAAK,IAAI7H,EAAE,EAAEA,EAAE6H,EAAU5H,OAAOD,IACL,SAArB6H,EAAU7H,GAAGiY,IACbzb,KAAKwb,WAAWhY,GAAG0D,MAAQ3E,EAAE0I,mBAAmBI,EAAU7H,GACxD5D,EAAEgT,KAAK9S,OAAOE,KAAKT,QAAS,CAACqc,aAAc,6EAA8E9V,OAAQ6V,EAAcjP,KAAM1M,KAAK0G,cAChI,UAArB2E,EAAU7H,GAAGiY,IACpBzb,KAAKwb,WAAWhY,GAAG0D,MAAQ3E,EAAEkJ,oBAAoBJ,EAAU7H,GAAI5D,EAAEgT,KAAK9S,OAAOE,KAAKT,QAAS,CAACuG,OAAQ6V,EAAcjP,KAAM1M,KAAK0G,cACjG,aAArB2E,EAAU7H,GAAGiY,IACpBzb,KAAKwb,WAAWhY,GAAG0D,MAAQ3E,EAAEgJ,uBAAuBF,EAAU7H,GAAI5D,EAAEgT,KAAK9S,OAAOE,KAAKT,QAAS,CAACuG,OAAQ6V,EAAcjP,KAAM1M,KAAK0G,cACpG,UAArB2E,EAAU7H,GAAGiY,MACfzb,KAAK8b,WACR9b,KAAK8b,SAAW,IAElB9b,KAAK8b,SAASxW,KAAK1F,EAAEE,OAAOuL,EAAU7H,GAAIxD,KAAKgc,gBAAgB3Q,EAAU7H,OAEzE+Z,GACFvd,KAAKS,MAAMT,KAAKY,MAGpB,IAAK4C,EAAE,EAAEA,EAAEia,EAAcha,OAAOD,IAC1BxD,KAAKY,KAAK4c,SAASC,EAAcja,GAAG0D,QACtClH,KAAKY,KAAK6G,YAAYgW,EAAcja,GAAG0D,SAI7CzG,MAAO,SAAUuG,GACf,IAAK,IAAIxD,EAAE,EAAEA,EAAExD,KAAKwb,WAAW/X,OAAOD,IACL,UAA3BxD,KAAKwb,WAAWhY,GAAGiY,KACrBzU,EAAI6I,SAAS7P,KAAKwb,WAAWhY,GAAG0D,QAStCwU,UAAW,SAAU5V,GAIjB,OAHA9F,KAAKT,QAAQuG,OAASA,EACtB9F,KAAK8U,gBAEE9U,MAEX8U,cAAe,WACP9U,KAAK0G,iBAAsCgX,IAAxB1d,KAAKT,QAAQuG,QAAgD,OAAxB9F,KAAKT,QAAQuG,SACrE9F,KAAK0G,WAAWuB,MAAMnC,OAAS9F,KAAKT,QAAQuG,SAGpDiB,SAAU,SAAUC,GAClBpH,EAAEoK,QAAQ0D,OAAO1N,KAAK0G,YACtB,IAAK,IAAIlD,EAAE,EAAEA,EAAExD,KAAKwb,WAAW/X,OAAOD,IACL,UAA3BxD,KAAKwb,WAAWhY,GAAGiY,KACrBzU,EAAIS,YAAYzH,KAAKwb,WAAWhY,GAAG0D,QAKzCyW,iBAAkB,SAAS9b,GACF,GAApB7B,KAAK4d,QAAU,IAChB5d,KAAK4d,SACL5d,KAAKY,KAAK8J,KAAK,oBAAqB,CAAClH,EAAGxD,KAAK4d,OAAQvP,MAAOrO,SAIhE6d,aAAc,SAAShc,GAClB7B,KAAK4d,OAAS,EAAI5d,KAAK8d,QAAQtP,qBAChCxO,KAAK4d,SACL5d,KAAKY,KAAK8J,KAAK,oBAAqB,CAAClH,EAAGxD,KAAK4d,OAAQvP,MAAOrO,SAIhE+d,cAAe,SAASrJ,GACtB1U,KAAK0G,WAAWuB,MAAMyM,QAAUA,KAYhClJ,EAA0B5L,EAAE2b,MAAMzb,OAAO,CAEzCC,WAAY,SAASmL,EAAU3L,GAC7B0B,IAAIqT,EAAY/R,EAAEgS,oBAAoBrJ,GACtClL,KAAKC,WAAaqU,EAAUrU,WAC5BD,KAAKwU,aAAaF,EAAUpQ,OAC5BlE,KAAKmC,WAAY,EACjBnC,KAAK4U,UAAY1J,EACjBlL,KAAKgO,UAAYzO,EAAQwc,SACzB/b,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,gBAAiBlN,EAAQmN,MACnE9M,EAAEE,OAAOP,EAASS,KAAKC,YACvBL,EAAEoK,QAAQ2C,SAAS3M,KAAK0G,WAAY,mCAC7BnH,EAAQmV,QACf9U,EAAES,WAAWL,KAAMJ,EAAEE,OAAOP,EAAQS,KAAKge,2BAA2B9S,MAEtE1J,UAAW,WAIP,MAHa,CACTG,QAAS3B,KAAKie,aAItBxd,MAAO,WACLT,KAAKY,KAAK4M,cAAcxN,MACxB,IAAI0U,EAAU1U,KAAKT,QAAQmV,SAAW,EAClCjQ,EAAYzE,KAAK0G,WACjBM,EAAMhH,KAAKY,KACVZ,KAAKmN,YACRnN,KAAKmN,UAAY5K,EAAEuI,aAAc,KAAM,CAGrC8B,SAAUrK,EAAE2b,kBAGZxR,KAAMjI,EACNiQ,QAASA,EACT7T,WAAWmG,EAAIzH,QAAQsB,WACvB2L,QAAQ,EACR6F,cAAe,SAASP,EAAYqB,GAElC,IAAI0H,EAAI7X,SAASC,cAAc,OAC/B4X,EAAEjJ,UAAUG,IAAI,uBAChB8I,EAAE7I,mBAAmB,aAAcF,EAAWnD,WAC9CwE,EAASgL,UAAUtD,EAAG,CAACuD,WAAW,EAAOC,SAAU,UAKzDrX,EAAI0D,KAAK,YAEXyR,OAAQ,WACJnc,KAAKie,cAGTjP,WAAY,WACR/N,IAAI+R,EAAWhT,KAAK0G,WAAWmK,iBAAiB,8BAChD,IAAI5P,IAAIuC,EAAI,EAAGA,EAAIwP,EAASvP,OAAOD,IAAI,CACnCvC,IAAIqd,EAAStL,EAASxP,GAAG+a,WACzBD,EAAOrL,YAAYD,EAASxP,MAIpCya,WAAY,WACVhd,IAAIud,EAAUxe,KAAKY,KAAKrB,QAAQkH,MAAMgY,SAClCC,EAAUF,EAAQA,EAAQ/a,OAAS,GACnCkb,EAAWH,EAAQA,EAAQ/a,OAAS,IAAMib,EAC1CpD,EAAOtb,KAAK4U,UAAU0G,KACtBxZ,EAAU9B,KAAKY,KAAKmB,UACxBd,IAAI2d,EAAc9c,EAElB,GAAe,MAATwZ,IAAmBxZ,EAAU,GAAKwZ,GAAS,GAAMoD,EAAQla,OAASma,EAASna,KAAO,GACnFka,EAAQla,OAASma,EAASna,MAC1BS,KAAKiU,MAAMpX,EAAUwZ,GAAQA,GAASrW,KAAKiU,MAAMyF,EAASna,KAAO8W,GAAQA,EAC1EsD,EAAc3Z,KAAKiU,MAAMpX,EAAUwZ,GAAQA,OAG1C,GAAGxZ,EAAU9B,KAAK4U,UAAU0G,MAAS,EAAG,OAE7Cra,IAsBI8J,EAAO8T,EACPC,EACA/R,EACAgP,EACA/U,EACA+X,EAEFC,EA7BEC,EAAcjf,KAAKY,KAAK6B,eAAezC,KAAKY,KAAKse,YAAaN,GAC9DhT,EAAM5L,KAAKmf,gBAAgBP,EAAaK,GAEzCrT,IAAQ5L,KAAKuV,OAEZR,EAAYxS,EAAEC,kBAAkBxC,KAAKY,KAAK6B,iBAAiBX,EAAQ9B,KAAKY,KAAKrB,QAAQsB,YACzFb,KAAKmC,UAAYL,GAAW9B,KAAKC,WAAWmC,SAAWN,GAAW9B,KAAKC,WAAWoC,SAChErC,KAAKwU,aAAalS,SAASyS,GAE7C/U,KAAKmN,UAAUgB,cAEXnO,KAAKgO,UAAUC,aACjBjO,KAAKgO,UAAUC,WAAWU,UAAY,IAExC3O,KAAKgP,aAEAhP,KAAc,WAAK4e,IAAgB9c,GAM7B+c,EAAU,IAAIO,QAAQ,CAACC,OAAU,gDACxCP,EAAS,IAAIvI,UACbxJ,EAAW/M,KAAKmN,UAChB4O,EAAW/b,KAAKgO,UAChBhH,EAAMhH,KAAKY,KAGboe,EAAmB,SAAUpT,EAAK0T,GAChC,OAAQ3J,MAAO/J,EAAI,CAACiK,SAAU,SAASgJ,QAASA,IACvC/I,KAAM,SAAUC,GAAW,OAAOA,EAASO,SAC3CR,KAAM,SAAUQ,GAErBvL,EAAQ+T,EAAOtI,gBAAgBF,EAAK,mBACpC,IAAIlF,EAAO,IAAKE,IAAIvG,EAAM5B,cAAc,YAAc4B,EAAM5B,cAAc,YAAYvE,aAAa,QAAUgH,GAAM2F,KAEnH3F,GADAA,EAAMb,EAAM5B,cAAc,sBAAuB4B,EAAM5B,cAAc,sBAAsBvE,aAAa,QAAU,MACrG,IAAK0M,IAAI1F,EAAKwF,GAAOG,KAAM,KAE1CtQ,IAQSse,EARLza,EAAaiX,EAASyD,YAAczU,EAAM5B,cAAc,yBACzC5G,EAAEoC,qBAAqBoG,EAAM5B,cAAc,uBAAuBvE,aAAa,YAAYG,OAAS,EACnHkI,EAAW8O,EAAS0D,UAAY1U,EAAM5B,cAAc,sBACtC5G,EAAEoC,qBAAqBoG,EAAM5B,cAAc,qBAAqBvE,aAAa,YAAYkK,SAAW,OACtH/B,EAASM,QAAQtC,EAAOkC,EAAUnI,GAIlC,IAASya,KAAMxU,EAAM5B,cAAc,YAAYT,SAC7CqT,EAAS9N,WAAWyR,OAAOH,EAAG9N,UAC9B8N,EAAG9N,SAASzD,UAAY+N,EAE1B,GAAInQ,KAAS0T,EACX,OAAON,EAAiBpT,EAAK0T,OAzBjCP,EAAU/e,MA6BTuV,KAAO3J,EACZoT,EAAiBpT,EA7BD,IA8BbkK,KAAK,WACJ9O,EAAI6I,SAAS9C,GAEb/F,EAAI0D,KAAK,6BACTnI,EAAEiJ,uBAAuBnK,UAAUse,gBAAgBZ,KAEpDrI,MAAM,SAAUlH,GAAS2G,QAAQC,IAAI5G,MA/CtCxP,KAAKuV,KAAO,KAiDhBmG,UAAW,SAAU5V,GAGjB,OAFA9F,KAAKT,QAAQuG,OAASA,EACtB9F,KAAK8U,gBACE9U,MAEX2f,gBAAiB,SAASZ,GACxB9d,IACQ2e,EADJ/E,EAAIkE,GAAW/e,KACnB,IAAQ4f,KAAY/E,EAAE1N,UAAUlH,QAAQ,CACtChF,IAAIiG,EAAQ2T,EAAE1N,UAAUlH,QAAQ2Z,GAChC,GAAG1Y,EAAM2Y,QAC8B,SAAlC3Y,EAAM2Y,MAAMjb,aAAa,KAC1BsC,EAAM2Y,MAAMzc,aAAa,WAAY,GAErC8D,EAAM2Y,MAAMrY,gBAAgB,YAEO,IAAlCN,EAAM2Y,MAAMC,mBAAyB,CACtC7e,IAAI4Q,EAAQ7O,SAASC,cAAc,SACnC4O,EAAMtD,UAAY,UAClBrH,EAAM2Y,MAAM9b,YAAY8N,MAKhCiD,cAAe,WACP9U,KAAK0G,iBAAsCgX,IAAxB1d,KAAKT,QAAQuG,QAAgD,OAAxB9F,KAAKT,QAAQuG,SACrE9F,KAAK0G,WAAWuB,MAAMnC,OAAS9F,KAAKT,QAAQuG,SAGpDiB,SAAU,WACR/G,KAAKY,KAAK6G,YAAYzH,KAAKmN,YAE7BgS,gBAAiB,SAAS3a,EAAMN,QAChBwZ,IAATlZ,IAAoBA,EAAOxE,KAAKY,KAAKmB,gBAC1B2b,IAAXxZ,IAAsBA,EAASlE,KAAKY,KAAK6B,kBAC5C,IAuBSiV,EAvBL1O,EAAM,GAuBV,IAAS0O,KAtBL1X,KAAKT,QAAQwO,QAAQvJ,OACvBwE,EAAIhJ,KAAKT,QAAQwO,QAAQvJ,MAAQA,GAE/BxE,KAAKT,QAAQwO,QAAQpK,QACvBqF,EAAIhJ,KAAKT,QAAQwO,QAAQpK,OAAS3D,KAAKY,KAAKmf,UAAU1c,GAEpDrD,KAAKT,QAAQwO,QAAQnK,SACvBoF,EAAIhJ,KAAKT,QAAQwO,QAAQnK,QAAU5D,KAAKY,KAAKmf,UAAUzc,GAErDtD,KAAKT,QAAQwO,QAAQqK,SACvBpP,EAAIhJ,KAAKT,QAAQwO,QAAQqK,QAAUpY,KAAKggB,YAAY9b,EAAO9C,IAAKoD,GAAMlB,GAEpEtD,KAAKT,QAAQwO,QAAQgK,OACvB/O,EAAIhJ,KAAKT,QAAQwO,QAAQgK,MAAQ/X,KAAKggB,YAAY9b,EAAO/C,IAAKqD,GAAMnB,GAElErD,KAAKT,QAAQwO,QAAQoK,MACvBnP,EAAIhJ,KAAKT,QAAQwO,QAAQoK,KAAOnY,KAAKggB,YAAY9b,EAAO/C,IAAKqD,GAAMlB,GAEjEtD,KAAKT,QAAQwO,QAAQkK,QACvBjP,EAAIhJ,KAAKT,QAAQwO,QAAQkK,OAASjY,KAAKggB,YAAY9b,EAAO9C,IAAKoD,GAAMnB,GAGzDrD,KAAKT,QAAQwO,QACnB,CAAC,QAAQ,SAAS,OAAO,QAAQ,MAAM,SAAS,QAAQsK,QAAQX,GAAK,IACrE1O,EAAI0O,GAAK1X,KAAKT,QAAQwO,QAAQ2J,IAGtC,OAAO9X,EAAEgT,KAAK1H,SAASlL,KAAK4U,UAAU1J,SAAUlC,IAEpDgX,YAAa,SAASrd,EAAQ6B,GAE5B,IACIP,EADMjE,KAAKY,KACDrB,QAAQ0E,IAElB,OADMA,EAAImV,eAAeC,YAAY1W,EAAOsB,EAAIgM,MAAMzL,KAG5DwZ,2BAA4B,SAAS9S,GAYnC,IAAI+U,EAAmB,CAAClS,QAAQ,IAC5B6L,EAAS1O,EAAS2O,OACtBoG,EAAiBlS,QAAQmS,OAAS,GAClC,IAAK,IAAI1c,EAAE,EAAEA,EAAEoW,EAAOnW,OAAOD,IAAK,CAEhC,IAAI6R,EAAOuE,EAAOpW,GAAGoB,aAAa,QAC9BkV,EAAQF,EAAOpW,GAAGoB,aAAa,SAC/BmV,EAAOH,EAAOpW,GAAGoB,aAAa,QAC9ByC,EAAOuS,EAAOpW,GAAGoB,aAAa,QAC9BoV,EAAWJ,EAAOpW,GAAGoB,aAAa,YAElCqV,GADQL,EAAOpW,GAAGoB,aAAa,SACe,eAApCgV,EAAOpW,GAAGkG,QAAQwQ,eAChC,GAAa,UAAT7E,EACE4K,EAAiBlS,QAAQpK,MAAQ0D,OAChC,GAAc,WAATgO,EACN4K,EAAiBlS,QAAQnK,OAASyD,OACjC,GAAa,SAATgO,EACL4K,EAAiBlS,QAAQvJ,KAAO6C,OAC/B,GAAa,aAATgO,GAAkC,SAAVyE,GAA6B,SAATA,EA0B/C,GAAIG,EAAQ,CAElB,MAAMS,EAAed,EAAOpW,GAAGmX,WAC/BsF,EAAiBlS,QAAQ1G,GAAQ,WAC7B,OAAOqT,EAAa3V,WAGnB,CAEH,MAAM2C,EAAQkS,EAAOpW,GACrByc,EAAiBlS,QAAQ1G,GAAQ,WAC7B,OAAOK,EAAM9C,aAAa,eAnChC,OAAQmV,GACN,IAAK,IACL,IAAK,YACL,IAAK,UACCC,IACIA,EAASQ,MAAM,aACjByF,EAAiBlS,QAAQgK,KAAO1Q,EACvB2S,EAASQ,MAAM,gBACxByF,EAAiBlS,QAAQkK,MAAQ5Q,IAGvC,MACF,IAAK,IACL,IAAK,WACL,IAAK,WACC2S,IACEA,EAASQ,MAAM,YACjByF,EAAiBlS,QAAQoK,IAAM9Q,EACtB2S,EAASQ,MAAM,iBACxByF,EAAiBlS,QAAQqK,OAAS/Q,KAoB9C,OAAO4Y,KAOTvU,EAAuB9L,EAAE2b,MAAMzb,OAAO,CACtCC,WAAY,SAASmL,EAAU3L,GAC3BS,KAAK4U,UAAY1J,EACjBlL,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,gBAAiBlN,EAAQmN,MACnE9M,EAAEoK,QAAQ2C,SAAS3M,KAAK0G,WAAY,yBACpCzF,IAAIqT,EAAY/R,EAAEgS,oBAAoBrJ,GACtClL,KAAKC,WAAaqU,EAAUrU,WAC5BD,KAAKwU,aAAaF,EAAUpQ,OAC5BlE,KAAKmC,WAAY,SACV5C,EAAQmV,QACf9U,EAAEE,OAAOP,EAASS,KAAKC,YACvBL,EAAES,WAAWL,KAAMJ,EAAEE,OAAOP,EAAQS,KAAKmgB,yBAAyBjV,MAEtE1J,UAAW,WAKP,MAJa,CACTG,QAAS3B,KAAKie,WACdhC,UAAWjc,KAAKogB,cAIxB3f,MAAO,WACHT,KAAKY,KAAK4M,cAAcxN,MACxBA,KAAK0b,UAAU1b,KAAKT,QAAQuG,QAC5B9F,KAAKqgB,UAETlE,OAAQ,WACJnc,KAAKie,cAGTmC,YAAa,WACXnf,IAAIqf,EAAkBtgB,KAAK0G,WAAWmK,iBAAiB,OACvD,IAAI5P,IAAIuC,EAAI,EAAGA,EAAG8c,EAAgB7c,OAAOD,IACvCxD,KAAK0G,WAAWuM,YAAYqN,EAAgB9c,KAIhD+c,UAAW,SAAUrc,EAAQM,EAAMgc,GAC/Bvf,IAAI+F,EAAMhH,KAAKY,KACX6f,EAAkBzgB,KAAK0gB,YACvB5c,EAAM9D,KAAK2gB,YAAYzc,EAAQM,GAC/BsH,EAAO9E,EAAI+Y,UACf/f,KAAK4gB,cAAgBre,EAAEoJ,WAAW7H,EAAK0c,EAAK1U,EAAM,EAAG9L,KAAK0G,YAC1D1G,KAAK4gB,cAAcC,MAAQ7gB,KAAK4U,UAAU0G,KAC1Ctb,KAAK4gB,cAAcE,MAAM9Z,GACrByZ,IACAzgB,KAAK4gB,cAAcG,iBAAmBN,EAAgBlL,KACtDvV,KAAK4gB,cAActa,GAAG,aAAc,WAAaU,EAAIS,YAAYgZ,OAIzEO,YAAa,SAAU9c,EAAQM,GAC3BvD,IAAI+H,EAAMhJ,KACV2I,WAAW,WACP1H,IAAIqa,EAAOtS,EAAI4L,UAAU0G,KACrBsD,EAAc3Z,KAAKiU,MAAM1U,EAAO8W,GAAQA,EACxCrL,EAAQjH,EAAIpI,KAAKsP,aAAa1L,EAAMoa,GACpCzO,EAAYjM,EAAO/C,IAAIiP,WAAWH,GACjCI,SAASrH,EAAIpI,KAAK0P,mBAAmBtH,EAAIpI,KAAKse,YAAa1a,IAAO+L,QACvE3Q,EAAEoK,QAAQyG,aAAazH,EAAI4X,cAAcK,OAAQ9Q,EAAWF,MAIpEoQ,OAAQ,WACJpf,IAAIuD,EAAOxE,KAAKY,KAAKmB,UACrBd,IAAI2d,EAAcpa,EAClBvD,IAAIqa,EAAOtb,KAAK4U,UAAU0G,KAEtB9W,EAAO8W,GAAS,IAAGsD,EAAc3Z,KAAKiU,MAAM1U,EAAO8W,GAAQA,GAC/Dra,IAAIiD,EAASlE,KAAKY,KAAK6B,eAAezC,KAAKY,KAAKse,YAAaN,GAC7D5e,KAAKkhB,cAAgB,GACrBlhB,KAAKkhB,cAActC,GAAe1a,EAAO/C,IAGrCqf,EAAMxgB,KAAKY,KAAK6B,iBAAiBtB,IAAIkP,SAASrQ,KAAKY,KAAKugB,kBAC5DnhB,KAAKugB,UAAUrc,EAAQ0a,EAAa4B,GACjChc,IAASoa,GACR5e,KAAKghB,YAAY9c,EAAQM,IAIjCyZ,WAAY,SAASpc,GACjBZ,IAAIa,EAAU9B,KAAKY,KAAKmB,UACpByc,EAAUxe,KAAKY,KAAKrB,QAAQkH,MAAMgY,SAClCC,EAAUF,EAAQA,EAAQ/a,OAAS,GACvCxC,IAAI0d,EAAWH,EAAQA,EAAQ/a,OAAS,GAC1Bkb,EAAVA,GAAqBD,EACzBzd,IAkCQ+F,EAlCJsU,EAAOtb,KAAK4U,UAAU0G,KACtBsD,EAAc3Z,KAAKiU,MAAMpX,EAAUwZ,GAAQA,EAC/Cra,IAAIiD,EAASlE,KAAKY,KAAK6B,eAAezC,KAAKY,KAAKse,YAAaN,GAEhD,MAATtD,IAAmBxZ,EAAU,GAAKwZ,GAAS,GAC3CoD,EAAQla,OAASma,EAASna,KAAO,GACjCxE,KAAKugB,UAAUrc,EAAQ0a,EAAahf,EAAE0E,MAAM,EAAE,IAC9CtE,KAAKghB,YAAY9c,EAAQpC,IAElBD,GAAKC,EAAUwZ,GAAS,GAC/Btb,KAAK4gB,cAAcG,iBAAmB/gB,KAAK4gB,cAAcrL,KACrDmJ,EAAQla,OAASma,EAASna,MAE1BxE,KAAKugB,UAAUrc,EAAQ0a,EAAahf,EAAE0E,MAAM,EAAE,IAC9CtE,KAAKkhB,cAActC,GAAe1a,EAAO/C,IACzCnB,KAAKghB,YAAY9c,EAAQpC,KAGrBsf,EAAcphB,KAAKkhB,cAActC,GACjC4B,EAAMtc,EAAO/C,IAAIkP,SAAS+Q,GAC3BphB,KAAK2gB,YAAYzc,EAAQ0a,KAAiB5e,KAAK4gB,cAAcrL,OAChEvV,KAAKugB,UAAUrc,EAAQ0a,EAAa4B,GACpCxgB,KAAKghB,YAAY9c,EAAQpC,OAKzBiT,EAAYxS,EAAEC,kBAAkBxC,KAAKY,KAAK6B,iBAAiBX,EAAQ9B,KAAKY,KAAKrB,QAAQsB,YACzFb,KAAKmC,UAAYL,GAAW9B,KAAKC,WAAWmC,SAAWN,GAAW9B,KAAKC,WAAWoC,SAClFrC,KAAKwU,aAAalS,SAASyS,GACtB/U,KAAc,WAIEwgB,GAAjBxZ,EAAMhH,KAAKY,MAAgB6B,iBAAiBtB,IAAIkP,SAASrJ,EAAIma,kBACjEnhB,KAAKugB,UAAUvZ,EAAIvE,iBAAkBX,EAAS0e,GAC9CxgB,KAAKkhB,cAAcpf,GAAWkF,EAAIma,kBAL9BnhB,KAAKogB,gBAQjB1E,UAAW,SAAU5V,GAIjB,OAHA9F,KAAKT,QAAQuG,OAASA,EACtB9F,KAAK8U,gBAEE9U,MAEX8U,cAAe,WACP9U,KAAK0G,iBAAsCgX,IAAxB1d,KAAKT,QAAQuG,QAAgD,OAAxB9F,KAAKT,QAAQuG,SACrE9F,KAAK0G,WAAWuB,MAAMnC,OAAS9F,KAAKT,QAAQuG,SAGpDiB,SAAU,SAAUC,GAClBhH,KAAKogB,cACLpZ,EAAIqa,iBAAiBrhB,MACrBA,KAAK0G,WAAa,MAEpBia,YAAa,SAASpc,EAAaC,GAC/B,IAQSkT,EARL1O,EAAM,GAQV,IAAS0O,KAPT1O,EAAIhJ,KAAKT,QAAQ+hB,OAAO3d,OAAS3D,KAAKY,KAAKmf,UAAU1c,EACrD2F,EAAIhJ,KAAKT,QAAQ+hB,OAAO1d,QAAU5D,KAAKY,KAAKmf,UAAUzc,EACtD0F,EAAIhJ,KAAKT,QAAQ+hB,OAAOlJ,QAAUpY,KAAKggB,YAAYzb,EAAYnD,IAAKoD,GAAMlB,EAC1E0F,EAAIhJ,KAAKT,QAAQ+hB,OAAOvJ,MAAQ/X,KAAKggB,YAAYzb,EAAYpD,IAAKqD,GAAMnB,EACxE2F,EAAIhJ,KAAKT,QAAQ+hB,OAAOnJ,KAAOnY,KAAKggB,YAAYzb,EAAYpD,IAAKqD,GAAMlB,EACvE0F,EAAIhJ,KAAKT,QAAQ+hB,OAAOrJ,OAASjY,KAAKggB,YAAYzb,EAAYnD,IAAKoD,GAAMnB,EAE3DrD,KAAKT,QAAQ+hB,OACnB,CAAC,QAAQ,SAAS,OAAO,QAAQ,MAAM,UAAUjJ,QAAQX,GAAK,IAC9D1O,EAAI0O,GAAK1X,KAAKT,QAAQ+hB,OAAO5J,IAGrC,OAAO9X,EAAEgT,KAAK1H,SAASlL,KAAK4U,UAAU1J,SAAUlC,IAEpDgX,YAAa,SAASrd,EAAQ6B,GAE5B,IACIP,EADMjE,KAAKY,KACDrB,QAAQ0E,IAElB,OADMA,EAAImV,eAAeC,YAAY1W,EAAOsB,EAAIgM,MAAMzL,KAG5D2b,yBAA0B,SAASjV,GAajC,IAHA,IAAIqW,EAAiB,CAACD,OAAO,IACzB1H,EAAS1O,EAAS2O,OAEbrW,EAAE,EAAEA,EAAE0H,EAAS2O,OAAOpW,OAAOD,IAAK,CACzC,IAAI6R,EAAOuE,EAAOpW,GAAGoB,aAAa,QAC9BkV,EAAQF,EAAOpW,GAAGoB,aAAa,SAC/BmV,EAAOH,EAAOpW,GAAGoB,aAAa,QAC9ByC,EAAOuS,EAAOpW,GAAGoB,aAAa,QAC9BoV,EAAWJ,EAAOpW,GAAGoB,aAAa,YAClCqV,EAA8C,eAApCL,EAAOpW,GAAGkG,QAAQwQ,cAChC,GAAa,UAAT7E,EACEkM,EAAeD,OAAO3d,MAAQ0D,OAC7B,GAAc,WAATgO,EACNkM,EAAeD,OAAO1d,OAASyD,OAC9B,GAAa,aAATgO,GAAkC,SAAVyE,GAA6B,SAATA,EAwBhD,GAAIG,EAAQ,CAEjB,MAAMS,EAAed,EAAOpW,GAAGmX,WAC/B4G,EAAeD,OAAOja,GAAQ,WAC1B,OAAOqT,EAAa3V,WAEnB,CAEH,MAAM2C,EAAQkS,EAAOpW,GACrB+d,EAAeD,OAAOja,GAAQ,WAC1B,OAAOK,EAAM9C,aAAa,eAhChC,OAAQmV,GACN,IAAK,YACL,IAAK,UACCC,IACIA,EAASQ,MAAM,aACjB+G,EAAeD,OAAOvJ,KAAO1Q,EACpB2S,EAASQ,MAAM,gBACxB+G,EAAeD,OAAOrJ,MAAQ5Q,IAGpC,MACF,IAAK,WACL,IAAK,WACC2S,IACEA,EAASQ,MAAM,YACjB+G,EAAeD,OAAOnJ,IAAM9Q,EACnB2S,EAASQ,MAAM,iBACxB+G,EAAeD,OAAOlJ,OAAS/Q,KAmB3C,OAAOka,KAOTvV,EAAapM,EAAE4hB,aAAa1hB,OAAO,CACtCC,WAAY,SAAU6L,EAAKC,EAAUC,EAAMC,EAAOtH,EAAWlF,GAC9CS,KAAK0G,WAAajC,EAChCzE,KAAKuV,KAAO3J,EAMZ5L,KAAKyhB,UAAY5V,EACH7L,KAAK0hB,MAAQ9hB,EAAE0E,MAAMwH,GACrB9L,KAAK2hB,OAAS5V,EAE5BnM,EAAES,WAAWL,KAAMT,IAEbiC,UAAW,WACjB,IAAIC,EAAS,CACZmgB,UAAW5hB,KAAK6hB,QAOjB,OAJI7hB,KAAK8hB,eAAiB9hB,KAAK6gB,OAAS,IACvCpf,EAAOsgB,SAAW/hB,KAAKgiB,cAGjBvgB,GAERhB,MAAO,WACQT,KAAKsG,GAAG,CACN2b,KAAMjiB,KAAKkiB,eAGtBliB,KAAKihB,QACQjhB,KAAKmiB,aAGnBniB,KAAKT,QAAQgT,cAChB3S,EAAEoK,QAAQ2C,SAAS3M,KAAKihB,OAAQ,uBAChCjhB,KAAKoiB,qBAAqBpiB,KAAKihB,SAGhCjhB,KAAK0G,WAAW3C,YAAY/D,KAAKihB,QACjCjhB,KAAK6hB,UAEN9a,SAAU,WACTnH,EAAEoK,QAAQ0D,OAAO1N,KAAKihB,QAClBjhB,KAAKT,QAAQgT,aAChBvS,KAAKqiB,wBAAwBriB,KAAKihB,SAG7BiB,aAAc,WACLliB,KAAKihB,SACVjhB,KAAKihB,OAAOqB,QAAW,IAAIC,KAC3BviB,KAAKwiB,mBAEhBR,aAAc,SAAUngB,GACvB,IAAIoO,EAAQjQ,KAAKY,KAAKsP,aAAarO,EAAE2C,MACjC2L,EAAYnQ,KAAKY,KAAKugB,iBAAiBpP,IAAI/R,KAAKyhB,WAAWrR,WAAWH,GACjEI,SAASrQ,KAAKY,KAAK0P,mBAAmBzO,EAAEkO,OAAQlO,EAAE2C,OAAO+L,QAE9D3Q,EAAE+Y,QAAQnI,MACb5Q,EAAEoK,QAAQyG,aAAazQ,KAAKihB,OAAQ9Q,EAAWF,GAE/CrQ,EAAEoK,QAAQ0G,YAAY1Q,KAAKihB,OAAQ9Q,IAGlC0R,OAAQ,SAAUhgB,GACpB,IAAI4gB,EAAQziB,KAAKihB,OACbpV,EAAW7L,KAAKyhB,UACF3V,EAAO9L,KAAK0hB,MAG3B7f,GAAkB,EAAb7B,KAAK6gB,aACenD,IAA1B1d,KAAK+gB,kBAAkC/gB,KAAKuV,OAASvV,KAAK+gB,oBAG5DnhB,EAAEoK,QAAQ0G,YAAY+R,EAAO5W,GAE7B4W,EAAMxa,MAAMtE,MAASmI,EAAKzI,EAAI,KAC9Bof,EAAMxa,MAAMrE,OAASkI,EAAKxI,EAAI,OAE/Bkf,eAAgB,WACf,IAKIE,EAEcD,EAEAE,EATb3iB,KAAKY,OAINgiB,GAAO,IAAIL,KACXG,GAAY,EAEED,EAAQziB,KAAKihB,OAEb0B,EAAO1d,KAAK9D,IAAI,GAAIyhB,EAAMH,EAAMH,QAAU,KAE9C1iB,EAAEoK,QAAQ6Y,WAAWJ,EAAOE,IAEpBD,EADJC,EAAO,GACS,EAE9BD,KACH9iB,EAAEgT,KAAKkQ,gBAAgB9iB,KAAK+iB,YAC5B/iB,KAAK+iB,WAAanjB,EAAEgT,KAAKoQ,iBAAiBhjB,KAAKwiB,eAAgBxiB,OAElDJ,EAAEoK,QAAQ2C,SAAS8V,EAAO,4BAQtCtW,EAAavM,EAAE2b,MAAMzb,OAAO,CAI5BP,QAAS,CACL0jB,QAAS,GACTnd,OAAQ,EACR1D,QAAS,GACTsS,QAAS,OAGb3U,WAAY,SAAUwR,EAAMzC,EAASvP,GAGjC,IAAIwL,EACAwG,IACAvR,KAAKkjB,MAAQ3R,GAEbzC,IAEF/D,KADA/K,KAAK8H,SAAWgH,GACA3F,cAAc,oCACzBoI,GAAQxG,IACT/K,KAAKyO,SAAWK,IAGtBlP,EAAES,WAAWL,KAAMT,GACnBS,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,iBAC1CzM,KAAK+d,cAAc/d,KAAKT,QAAQmV,SAChC9U,EAAEoK,QAAQ2C,SAAS3M,KAAK0G,WAAW,eACnC1G,KAAKmjB,gBAAkBvjB,EAAEoK,QAAQyC,OAAO,MAAO,gBAAiBzM,KAAK0G,YACrE9G,EAAEoK,QAAQ2C,SAAS3M,KAAKmjB,gBAAgB,yBAIxCnjB,KAAKojB,oBAAsBxjB,EAAEoK,QAAQyC,OAAO,MAAO,uBAAwBzM,KAAK0G,aAI3EqE,GAAS+D,GAAWA,EAAQuC,aAAa,WAAUrR,KAAKqjB,OAASvU,EAAQlK,aAAa,UAC3F5E,KAAKsjB,YAAYvY,EAAQ+D,EAAU,MAOnC9O,KAAKsG,GAAG,WAAYtG,KAAKujB,gBAAiBvjB,MAK1CA,KAAKwjB,iBAAkB,EAIvBxjB,KAAKyjB,gBAAkB,IAE3B/H,UAAW,SAAU5V,GAIjB,OAHA9F,KAAKT,QAAQuG,OAASA,EACtB9F,KAAK8U,gBAEE9U,MAEX0jB,QAAS,WACP,OAAO1jB,KAAKkjB,OAAS,IAEvBpO,cAAe,WACP9U,KAAK0G,iBAAsCgX,IAAxB1d,KAAKT,QAAQuG,QAAgD,OAAxB9F,KAAKT,QAAQuG,SACrE9F,KAAK0G,WAAWuB,MAAMnC,OAAS9F,KAAKT,QAAQuG,SAIpD6d,eAAgB,SAAS3c,GACvB,GAAGhH,KAAKmI,QAAQC,YACd,IAAInH,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKmI,QAAQC,YAAY3E,OAAQD,IAC/CxD,KAAKmI,QAAQC,YAAY5E,GAAG4H,gBAC7BpE,EAAIS,YAAYzH,KAAKmI,QAAQC,YAAY5E,GAAG4H,gBAI9CpL,KAAKmI,QAAQ2T,iBACR9b,KAAKmI,QAAQ2T,UAGxB8H,eAAgB,SAAS/hB,GACnBA,GAAKA,EAAE4H,QAA2B,GAAjB5H,EAAE4H,OAAO1E,OAAalD,EAAE4H,OAAO1E,OAAS,GAC3D/E,KAAK+d,cAAclc,EAAE4H,OAAO1E,QAGhCgZ,cAAe,SAASrJ,GACpB1U,KAAK0G,WAAWuB,MAAMyM,QAAUA,EAC7B1U,KAAK6jB,YAAW7jB,KAAK6jB,UAAU9e,MAAQ2P,IAE9CoP,qBAAsB,SAASjiB,GAC1BA,GAAKA,EAAE4H,QAA2B,GAAjB5H,EAAE4H,OAAO1E,OAAalD,EAAE4H,OAAO1E,OAAS,IAC1D/E,KAAKoL,eAAe2S,cAAclc,EAAE4H,OAAO1E,OAC3C/E,KAAK+jB,cAAcrP,QAAU7S,EAAE4H,OAAO1E,QAG1Cif,cAAe,SAASniB,EAAGka,GACpBla,EAAE4H,OAAO5B,SACVkU,EAASlU,SAAU,EAChB7H,KAAK8H,SAASD,UACbkU,EAAS3Q,eAAiB7I,EAAE6I,eAAe2Q,EAASgI,cAClD,CAAErX,KAAM1M,KAAK0G,WACXgO,QAASqH,EAASgI,cAAcrP,QAChCnH,cAAevN,KACfiE,IAAK8X,EAAS9X,IACd0X,aAAcI,EAASJ,aACvBI,SAAUA,EAAStK,UAAYsK,IAC9B+E,MAAM9gB,KAAKY,MACdmb,EAAS3Q,eAAesQ,YACxB1b,KAAKikB,uBAGTrkB,EAAE4G,SAAS0d,gBAAgBriB,GAC3Bka,EAASlU,SAAU,EAChB7H,KAAK8H,SAASD,SAAS7H,KAAKY,KAAK6G,YAAYsU,EAAS3Q,gBACzDpL,KAAKikB,sBAIbxjB,MAAO,SAAUuG,GACb,IAAIhH,KAAKmI,SAAYnI,KAAKmkB,iBAAiBnd,GAA3C,CAIAhH,KAAKY,KAAOoG,EACThH,KAAKyO,UACDzO,KAAKokB,gBACRpkB,KAAKokB,cAAgB7hB,EAAEuI,aAAa9K,KAAKyO,SAAU,CAGjD7B,SAAUrK,EAAE2b,kBAGZxR,KAAM1M,KAAK0G,WACXgO,QAAS1U,KAAKT,QAAQmV,QACtB7T,WAAWmG,EAAIzH,QAAQsB,WAEvB0M,cAAevN,KACfwM,QAAQ,EACR6F,cAAe,SAASP,EAAYqB,GAElC,IACM0H,EADF/I,KACE+I,EAAI7X,SAASC,cAAc,QAC7B2O,UAAUG,IAAI,uBAChB8I,EAAE7I,mBAAmB,aAAcF,EAAWnD,WAC9CwE,EAASgL,UAAUtD,EAAG,CAACuD,WAAW,EAAOC,SAAU,WAK3Dre,KAAKikB,oBACLjd,EAAI6I,SAAS7P,KAAKokB,gBAElBpkB,KAAK6O,KAAK,aAAc,WAClB7O,KAAKmkB,iBAAiBnd,IAIrBhH,KAAKokB,gBACRpkB,KAAKokB,cAAgB7hB,EAAEuI,aAAa9K,KAAKyO,SAAU,CAG/C7B,SAAUrK,EAAE2b,kBAGZxR,KAAM1M,KAAK0G,WACXgO,QAAS1U,KAAKT,QAAQmV,QACtB7T,WAAWmG,EAAIzH,QAAQsB,WAEvB0M,cAAevN,KACfwM,QAAQ,EACR6F,cAAe,SAASP,EAAYqB,GAElC,IACM0H,EADF/I,KACE+I,EAAI7X,SAASC,cAAc,QAC7B2O,UAAUG,IAAI,uBAChB8I,EAAE7I,mBAAmB,aAAcF,EAAWnD,WAC9CwE,EAASgL,UAAUtD,EAAG,CAACuD,WAAW,EAAOC,SAAU,UAGtDyC,MAAM9Z,IAEXhH,KAAKikB,qBA3BLjkB,KAAKwjB,iBAAkB,GA4BvBxjB,MAKDA,KAAK0gB,cACN1gB,KAAK0gB,YAAc9gB,EAAEykB,cAEzBrd,EAAI6I,SAAS7P,KAAK0gB,eAKb1gB,KAAKskB,kBAAyD,OAArCtkB,KAAKskB,iBAAiB5d,aACkB,EAApE1G,KAAKojB,oBAAoB5iB,qBAAqB,aAAaiD,SAE3DzD,KAAKskB,iBAAmB/hB,EAAEjD,gBAAgB,CACxCoN,KAAK1M,KAAK0G,WACV6G,cAAevN,KACfyI,UAAU,0BACVtI,cAAcH,KAAKojB,oBACnBhjB,aAAa4G,EAAIzH,QAAQ0E,IAAI1E,QAAQuR,YAAYrN,OAAS,EAC1DP,SAAU8D,EAAIzH,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,IAExD2D,EAAI6I,SAAS7P,KAAKskB,kBAClBtkB,KAAKikB,qBAGP,MAAMM,EAqBN,WACE,GAAGvkB,KAAKmI,SAAWnI,KAAKmI,QAAQC,YAAY,CAC1C,IAAInH,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKmI,QAAQC,YAAY3E,OAAQD,IAAI,CAmBtD,IACMkR,EAnBF1U,KAAKmI,QAAQC,YAAY5E,GAAGugB,eAAiB/jB,KAAKmI,QAAQC,YAAY5E,GAAGqE,UACvE7H,KAAKmI,QAAQC,YAAY5E,GAAGmY,eAAc3b,KAAKmI,QAAQC,YAAY5E,GAAGmY,aAAenY,GACzFxD,KAAKwkB,gBAAkBjiB,EAAE6I,eAAepL,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAClE,CAAErX,KAAM1M,KAAK0G,WACXgO,QAAS1U,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAcrP,QACnDnH,cAAevN,KACfiE,IAAKjE,KAAKmI,QAAQlE,IAClB0X,aAAc3b,KAAKmI,QAAQC,YAAY5E,GAAGmY,aAG1CI,SAAU/b,KAAKmI,QAAQC,YAAY5E,GAAGiO,UAAYzR,KAAKmI,QAAQC,YAAY5E,KACxEsd,MAAM9Z,GACThH,KAAKmI,QAAQC,YAAY5E,GAAG4H,eAAiBpL,KAAKwkB,gBAC/CxkB,KAAKwkB,gBAAgB1I,WAClB9b,KAAKmI,QAAQ2T,WAAU9b,KAAKmI,QAAQ2T,SAAW,IACnD9b,KAAKmI,QAAQ2T,SAAW9b,KAAKmI,QAAQ2T,SAAS1H,OAAOpU,KAAKwkB,gBAAgB1I,YAG9E9b,KAAKmI,QAAQC,YAAY5E,GAAG6N,aAAa,aACvCqD,EAAU1U,KAAKmI,QAAQC,YAAY5E,GAAGoB,aAAa,WACvD5E,KAAKmI,QAAQC,YAAY5E,GAAG4H,eAAe2S,cAAcrJ,IAG7D1U,KAAKikB,sBA/CwCjJ,KAAKhb,MAElDA,KAAKmI,SAAWnI,KAAKmI,QAAQC,aAAepI,KAAKmI,QAAQC,YAAY,GAAG2b,cAC1EQ,IAEAvkB,KAAK6O,KAAK,aAAc,WAChB7O,KAAKmkB,iBAAiBnd,GAI1Bud,IAHEvkB,KAAKwjB,iBAAkB,GAIxBxjB,MAGPA,KAAK0b,UAAU1b,KAAKT,QAAQuG,QAC5B9F,KAAK0V,UAAU3R,YAAY/D,KAAK0G,YAChCiC,WAAW,KACT3B,EAAI0D,KAAK,kBACR,GACH1D,EAAIV,GAAG,YAAatG,KAAKykB,mBAAoBzkB,WA7G3CA,KAAKwjB,iBAAkB,GA8I7BW,iBAAmB,SAASnd,GAC1B/F,IAAIyjB,GAAU,EACd,GAAG1kB,KAAKmI,SAAWnI,KAAKmI,QAAQC,YAC9B,IAAInH,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKmI,QAAQC,YAAY3E,OAAQD,IAClD,GAAGxD,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAC7B,IAAI9iB,IAAIiK,KAAYlL,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAC9C,IAAI7Y,EAASyZ,iBAAmBzZ,EAASrK,aAAemG,EAAIzH,QAAQsB,WAAY,CAC9E6jB,GAAU,EACV,MAKV,QAASA,GAAW1kB,KAAK4kB,kBAAoB5d,EAAIzH,QAAQsB,WAAWoO,gBAItEgV,kBAAmB,WACjBhjB,IAAIiD,EAAQ2gB,EAASC,EAAS7iB,EAAeC,EACzCjC,EAAa,CAACoC,QAAS,EAAGD,QAAS,EAAGH,cAAe,EAAGC,cAAe,GAC1D,CAAC,mBAAmB,cAAc,gBAAgB,mBACxD6iB,QAAQ,IACjB,GAAG/kB,KAAKqV,GACN,GAAY,oBAATA,EAA2B,CAC5B,IAAIpU,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKmI,QAAQC,YAAY3E,OAAQD,IAClD,IAAIvC,IAAIoH,EAAI,EAAGA,EAAIrI,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAActgB,OAAQ4E,IAAI,CACvEpH,IAAIqT,EAAY/R,EAAEgS,oBAAoBvU,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,IAChFrI,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG2c,iBAAmB1Q,EAAUpQ,OAC1ElE,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAmB3Q,EAAUrU,WAG9E,IAAIgB,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKmI,QAAQC,YAAY3E,OAAQD,IAClD,GAAGxD,KAAKmI,QAAQC,YAAY5E,GAAGqE,QAC7B,IAAI5G,IAAIoH,EAAI,EAAGA,EAAIrI,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAActgB,OAAQ4E,IAajEnG,EAZEgC,GAOFA,EAAOpE,OAAOE,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG2c,iBAAiB7jB,KAC5E+C,EAAOpE,OAAOE,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG2c,iBAAiB5jB,KAC5EyjB,EAAU5f,KAAK7D,IAAIyjB,EAAS7kB,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAiB7iB,SAC1F0iB,EAAU7f,KAAK9D,IAAI2jB,EAAS9kB,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAiB5iB,SAC1FJ,EAAgBgD,KAAK7D,IAAIa,EAAejC,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAiBhjB,eACtFgD,KAAK9D,IAAIe,EAAelC,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAiB/iB,iBAXtGgC,EAASlE,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG2c,iBACtDH,EAAU7kB,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAiB7iB,QACxE0iB,EAAU9kB,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAiB5iB,QACxEJ,EAAgBjC,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAiBhjB,cAC9DjC,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAc1b,GAAG4c,iBAAiB/iB,eAYtFjC,EAAWoC,QAAUyiB,EACrB7kB,EAAWmC,QAAUyiB,EACrB5kB,EAAWiC,cAAgBA,EAC3BjC,EAAWgC,cAAgBA,EAC3BjC,KAAKmI,QAAQlI,WAAaA,EAC1BD,KAAKmI,QAAQrH,YAAcoD,EAE3B,IAAIjD,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKmI,QAAQC,YAAY3E,OAAQD,IAClDxD,KAAKmI,QAAQC,YAAY5E,GAAG4H,eAAetK,YAAcoD,EACzDlE,KAAKmI,QAAQC,YAAY5E,GAAG4H,eAAenL,WAAaA,OAGvDD,KAAKqV,GAAMvU,cACRoD,GAIFA,EAAOpE,OAAOE,KAAKqV,GAAMvU,YAAYK,KACrC+C,EAAOpE,OAAOE,KAAKqV,GAAMvU,YAAYM,OAJrC8C,EAASlE,KAAKqV,GAAMvU,YACpBb,EAAaD,KAAKqV,GAAMpV,eAS/BiE,IAEDlE,KAAK8H,SAASwZ,OAAUvgB,OAAOwS,OACLhR,EAAE2iB,sBAAsBhhB,EAAOlE,KAAKY,MACpC,CAAC4D,KAAKvE,MAIpC6gB,MAAO,SAAU9Z,GAEb,OADAA,EAAI6I,SAAS7P,MACNA,MAEXwB,UAAW,WACP,MAAO,CAACugB,SAAU/hB,KAAKmlB,cAE3BhJ,OAAQ,WAEJ,GAAInc,KAAKmI,QAAQC,YACf,IAAInH,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKmI,QAAQC,YAAY3E,OAAQD,IAC/CxD,KAAKmI,QAAQC,YAAY5E,GAAG4H,gBAC7BpL,KAAKmI,QAAQC,YAAY5E,GAAG4H,eAAe+Q,UAKrDgJ,YAAa,SAAStjB,GAIpB,GAAK7B,KAAKY,KAAV,CAEA,IAAIwkB,EAASvjB,EAAE2C,KACXA,EAAQxE,KAAKmI,SAAWnI,KAAKmI,QAAQC,YAAepI,KAAKmI,QAAQC,YAAY,GAAGe,cAAc,wBAA0B,KACxHhI,EAAMqD,GAAQA,EAAK6M,aAAa,OAASoJ,SAASjW,EAAKI,aAAa,QAAU5E,KAAKY,KAAKykB,aACxFjkB,EAAOoD,GAAQA,EAAK6M,aAAa,OAASoJ,SAASjW,EAAKI,aAAa,QAAU5E,KAAKY,KAAK0kB,aAC7F,GAAG9gB,EACD,IAAIvD,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKmI,QAAQC,YAAY3E,OAAQD,KAClDgB,EAAOxE,KAAKmI,QAAQC,YAAY5E,GAAG2F,cAAc,0BACtC3E,EAAK6M,aAAa,SAAUlQ,EAAM8D,KAAK9D,IAAIsZ,SAASjW,EAAKI,aAAa,QAASzD,IACvFqD,GAAQA,EAAK6M,aAAa,SAASjQ,EAAM6D,KAAK7D,IAAIqZ,SAASjW,EAAKI,aAAa,QAASxD,IAG9EgkB,EAASjkB,GAAOnB,KAAKmI,QAAQod,SAAsBnkB,EAATgkB,GAAgBplB,KAAKmI,QAAQqd,OAChFrkB,GAAOikB,GAAUA,GAAUhkB,IAC3BpB,KAAKmI,QAAQqd,QAAmBpkB,EAATgkB,GAIzBplB,KAAKkjB,MAAQljB,KAAKmI,QAAQqd,OAC1BxlB,KAAK8H,SAAShE,IAAM9D,KAAKmI,QAAQqd,OAGjCxlB,KAAKuR,KAAOvR,KAAKmI,QAAQqd,OACzBxlB,KAAK8H,SAAShE,IAAM9D,KAAKmI,QAAQqd,QACxBxlB,KAAKmI,QAAQod,SAAWH,EAASjkB,IAC1CnB,KAAKkjB,MAAQljB,KAAKmI,QAAQod,QAC1BvlB,KAAKuR,KAAOvR,KAAKmI,QAAQod,QACzBvlB,KAAK8H,SAAShE,IAAM9D,KAAKmI,QAAQod,UAGjCvlB,KAAKwkB,kBAEXzd,SAAU,SAAUC,GAChBpH,EAAEoK,QAAQ0D,OAAO1N,KAAK0G,YACnB1G,KAAKskB,kBAAkBtd,EAAIS,YAAYzH,KAAKskB,kBAC5CtkB,KAAKokB,eAAepd,EAAIS,YAAYzH,KAAKokB,eACzCpkB,KAAK0gB,aAAa1Z,EAAIS,YAAYzH,KAAK0gB,aACtC1gB,KAAKmI,SAAWnI,KAAKmI,QAAQC,aAAapI,KAAK2jB,eAAe3c,GAElEA,EAAI0D,KAAK,iBACT1D,EAAIC,IAAI,YAAajH,KAAKykB,qBAG9BgB,eAAgB,WACZ,OAAOzlB,KAAKT,QAAQmmB,aAGxBC,mBAAoB,SAAUC,EAAWpiB,GACvC,IAAI8d,EAAS1hB,EAAEoK,QAAQyC,OAAO,WAAY,sBACxCoZ,EAAmBjmB,EAAEoK,QAAQyC,OAAO,MAAO,8BAA+B6U,GAC1EwE,EAAiBlmB,EAAEoK,QAAQyC,OAAO,MAAO,4BAA6B6U,GACtEyE,EAAcnmB,EAAEoK,QAAQyC,OAAO,QAAS,0BAA2BoZ,GACnEne,EAAQ9H,EAAEoK,QAAQyC,OAAO,SACzBuZ,EAAuBpmB,EAAEyT,IAAI5G,OAAO,OACpCwZ,EAAqBrmB,EAAEyT,IAAI5G,OAAO,QAClCyZ,EAAqBtmB,EAAEyT,IAAI5G,OAAO,QAClC0Z,EAAiBvmB,EAAEoK,QAAQyC,OAAO,QAClC2Z,EAAqBxmB,EAAEoK,QAAQyC,OAAO,MAAO,4BAA6BoZ,GAC1EQ,EAAiBzmB,EAAEoK,QAAQyC,OAAO,UAAW,2BAA4BqZ,GACzEQ,EAAuB1mB,EAAEoK,QAAQyC,OAAO,UAAW,GAAI4Z,GACvD5f,EAAQzG,KAAK8H,SAASyW,WACtBgI,EAAUvmB,KAAK8H,SACf4M,EAAU9U,EAAEoK,QAAQyC,OAAO,QAAS,GAAI4Z,GACxCP,EAAe5F,QAAS,EACxBoB,EAAOle,aAAa,eAAgB,SAChCwiB,IACFtE,EAAOle,aAAa,SAAU,IAC9BpD,KAAKmI,QAAQC,YAAY5E,GAAG0c,QAAS,GAIvC8F,EAAqB5iB,aAAa,UAAW,aAC7C4iB,EAAqB5iB,aAAa,SAAU,MAC5C4iB,EAAqB5iB,aAAa,QAAS,MAC3C6iB,EAAmB7iB,aAAa,IAAK,iBACrC6iB,EAAmB7iB,aAAa,OAAQ,QACxC8iB,EAAmB9iB,aAAa,IAAK,qJACrC4iB,EAAqBjiB,YAAYkiB,GACjCD,EAAqBjiB,YAAYmiB,GAEjCjlB,IAAIulB,EAAqB5mB,EAAEoK,QAAQyC,OAAO,SAAU,kCAAmC2Z,GACvFI,EAAmBnR,KAAO,SAC1BmR,EAAmB3U,MAAQ,mBAC3B2U,EAAmB7X,UAAY,2CAC/B6X,EAAmB5U,UAAUG,IAAI,gBACjCnS,EAAE4G,SAASF,GAAGkgB,EAAoB,QAAS5mB,EAAE4G,SAASigB,MACtD7mB,EAAE4G,SAASF,GAAGkgB,EAAoB,QAAS,IACzCvlB,IAAIylB,GAAa,EACjB7kB,EAAE4H,OAAO5B,SAAU,EACnB7H,KAAKmI,QAAQC,YAAY5E,GAAGmjB,SAAU,EACtC3mB,KAAKmI,QAAQC,YAAY5E,GAAGqE,SAAU,EACnC7H,KAAK8H,SAASD,SAAS7H,KAAKgkB,cAAcniB,EAAG7B,KAAKmI,QAAQC,YAAY5E,IACzExD,KAAKmI,QAAQC,YAAY5E,GAAG8E,cAAciW,WAAWtL,YAAYjT,KAAKmI,QAAQC,YAAY5E,GAAG8E,eAC7F,IAAIrH,IAAIoH,EAAI,EAAGA,EAAIrI,KAAKmI,QAAQC,YAAY3E,OAAQ4E,IAC9CrI,KAAKmI,QAAQC,YAAYC,GAAGse,UAASD,GAAa,GAErDA,GAAY1mB,KAAK4mB,uBAAuB3T,YAAYjT,KAAK6mB,sBAC3D7mB,MAEHiB,IAAI6lB,EAAuBlnB,EAAEoK,QAAQyC,OAAO,SAAU,oCAAqC2Z,GAC3FU,EAAqBzR,KAAO,SAC5ByR,EAAqBjV,MAAQ,kBAC7BiV,EAAqB1jB,aAAa,iBAAiB,GACnD0jB,EAAqBlV,UAAUG,IAAI,gBACnCnS,EAAE4G,SAASF,GAAGwgB,EAAsB,QAAS,KACd,IAA1BhB,EAAe5F,QAChB4G,EAAqB1jB,aAAa,iBAAiB,GACnD0iB,EAAe5F,QAAS,IAExB4G,EAAqB1jB,aAAa,iBAAiB,GACnD0iB,EAAe5F,QAAS,IAEzBlgB,MAEHmmB,EAAe/iB,aAAa,eAAe,GAC3C2iB,EAAYhiB,YAAY2D,GACxBof,EAAqB/iB,YAAYoiB,GACjCA,EAAepiB,YAAYiiB,GAC3BM,EAAqB/X,UAAY,UACjC+X,EAAqB5S,GAAK,4BAA8B9T,EAAEyJ,MAAMid,GAChE5R,EAAQtR,aAAa,OAAO,SAC5BsR,EAAQtR,aAAa,MAAO,KAC5BsR,EAAQtR,aAAa,MAAM,OAC3BsR,EAAQtR,aAAa,OAAO,OAC5BsR,EAAQtR,aAAa,kBAAmB,4BAA8BxD,EAAEyJ,MAAMid,IAC1ES,EAAe/mB,KAAKmI,QAAQC,YAAY5E,GAAG6N,aAAa,WAAarR,KAAKmI,QAAQC,YAAY5E,GAAGoB,aAAa,WAAW,MAC7H5E,KAAKmI,QAAQC,YAAY5E,GAAGugB,cAAcrP,QAAUqS,EACpDrS,EAAQtR,aAAa,QAAS2jB,GAC9BrS,EAAQ3P,MAAQgiB,EAChBnnB,EAAE4G,SAASF,GAAGoO,EAAS,SAAU1U,KAAK8jB,qBAAsB9jB,KAAKmI,QAAQC,YAAY5E,IAEjFwjB,EAAqBpnB,EAAEoK,QAAQyC,OAAO,OAAQ,wBAAyBsZ,GAkF3E,OAjFAre,EAAMuf,iBAAiBjnB,KAAKmI,QAAQC,YAAY5E,GAChDxD,KAAKmI,QAAQC,YAAY5E,GAAGqE,QAAUH,EAAMuf,eAC5Cvf,EAAM2N,KAAO,WACb2R,EAAmBrY,UAAYiX,EAC/BhmB,EAAE4G,SAASF,GAAGoB,EAAO,SAAU,IAC7B1H,KAAKgkB,cAAcniB,EAAG7B,KAAKmI,QAAQC,YAAY5E,MAEjDwjB,EAAmBtT,GAAK,2BAA6B9T,EAAEyJ,MAAM2d,GAAsB,IACnF1F,EAAOle,aAAa,kBAAmB4jB,EAAmBtT,IAC1DsT,EAAmB1F,OAASthB,KAAKmI,QAAQC,YAAY5E,GAErD8d,EAAO4F,aAAe5F,EAAO6F,YAAc,IACzC,GAA6D,UAAzDC,EAAU3d,OAAOG,cAAcF,QAAQwQ,eACI,UAA3CkN,EAAU3d,OAAOC,QAAQwQ,eACkB,UAA3CkN,EAAU3d,OAAOC,QAAQwQ,cAA2B,CACtDkN,EAAUlD,kBACVkD,EAAYA,aAAqBC,WAAaD,EAAUE,QAAQ,GAAKF,EAErEnmB,IAAIsmB,EAAUjG,EACVkG,EAAWlG,EAAO/C,WAClBkJ,GAAS,EAAOC,EAAON,EAAUO,QAErC3kB,SAAS4kB,KAAKC,YAAc7kB,SAAS4kB,KAAKE,YAAc,IACtDC,EAAUtd,iBAIVxJ,IAAI+mB,GAHJD,EAAYA,aAAqBV,WAAaU,EAAUT,QAAQ,GAAKS,GAG9CJ,QAAUD,EAEjC,GADAD,EAA4B,EAAnBxiB,KAAKgjB,IAAID,IAAeP,IAC5BD,IAAaC,GAAYD,GAAYA,EAAS1H,mBAAqB,GACpE0H,EAASU,wBAAwB/P,IAAMoP,EAAQW,wBAAwB9P,QACvEoP,EAASU,wBAAwB9P,OAASmP,EAAQW,wBAAwB/P,KAF9E,CAMAqP,EAAS5V,UAAUG,IAAI,mBACvBwV,EAAQtf,MAAM6S,UAAY,cAAekN,EAAQ,MACjDT,EAAQtf,MAAMkgB,cAAgB,OAE9BlnB,IAAIoC,EAAI0kB,EAAUK,QAAS9kB,EAAIykB,EAAUJ,QACrCU,GAAyB,iBAAlB5hB,EAAMiD,QAA6BjD,EAAmBA,EAAM0C,cAAc,mBAAjC8E,WAChDqa,EAAYD,EAAKE,iBAAiBllB,EAAGC,GACrCklB,EAAeF,GAAcA,EAAUtgB,QAAQ,YAAwBsgB,EAAUtgB,QAAQ,YAA5Buf,EAEjEiB,EAAevjB,KAAKgjB,IAAID,IAAWQ,EAAYC,aAAelB,EAAUiB,EAExEjB,EAAQnkB,aAAa,eAAgB,QACrCmkB,EAAQnkB,aAAa,kBAAmB,QACrColB,GAAehB,IAAagB,EAAYjK,aACzCiK,EAAcA,IAAgBjB,EAAQmB,YAAaF,EAAcA,EAAYE,YAC1EnB,IAAYiB,IACbd,EAAOK,EAAUJ,QACjBJ,EAAQtf,MAAM6S,UAAY,MAE5B0M,EAASmB,aAAapB,EAASiB,MAInCxlB,SAAS4kB,KAAKgB,WAAa5lB,SAAS4kB,KAAKiB,UAAY,KACnDtB,EAAQnkB,aAAa,eAAgB,SACrCmkB,EAAQ/f,gBAAgB,mBACxB+f,EAAQtf,MAAMkgB,cAAgB,KAC9BZ,EAAQtf,MAAM6S,UAAY,KAC1B7Z,IAAI6nB,EAAgBtB,EAAS9e,SACzB5C,EAAS,EACb,IAAI7E,IAAI4Z,KAAKiO,EAAc,CACzB7nB,IAAI8a,EAAWlB,EAAE1R,cAAc,QAAQmY,OAEvCvF,EAAS3Y,aAAa,cAAc,IACpCmjB,EAAQwC,sBAAsB,YAAahN,GAC3CA,EAASvU,gBAAgB,eAEzBuU,EAASJ,aAAe7V,EACxBiW,EAAS3Q,eAAesQ,UAAU5V,GAClCA,IAEF0hB,EAAS5V,UAAUlE,OAAO,mBAC1B1K,SAAS4kB,KAAKC,YAAc7kB,SAAS4kB,KAAKE,YAAc9kB,SAAS4kB,KAAKgB,WAAa5lB,SAAS4kB,KAAKiB,UAAY,QAI5GvH,GAGXpY,yBAA0B,WACxB,IAAI8f,EAAWppB,EAAEoK,QAAQyC,OAAO,WAAY,oBAC1C/E,EAAQ9H,EAAEoK,QAAQyC,OAAO,SACzBwc,EAAgBrpB,EAAEoK,QAAQyC,OAAO,OAAQ,yBACzCyc,EAAyBtpB,EAAEoK,QAAQyC,OAAO,QAC1C0c,EAAoBvpB,EAAEoK,QAAQyC,OAAO,MAAO,8BAA+Buc,GAC3EI,EAAoBxpB,EAAEoK,QAAQyC,OAAO,MAAO,4BAA6Buc,GACzEK,EAAkBzpB,EAAEoK,QAAQyC,OAAO,QAAS,0BAA2B0c,GACvEG,EAAoB1pB,EAAEoK,QAAQyC,OAAO,MAAO,4BAA6B0c,GACzE9C,EAAiBzmB,EAAEoK,QAAQyC,OAAO,UAAW,gDAAiD2c,GAC9F1U,EAAU9U,EAAEoK,QAAQyC,OAAO,SAC3B8c,EAAwB3pB,EAAEoK,QAAQyC,OAAO,WACzC+c,EAAyB5pB,EAAEyT,IAAI5G,OAAO,OACtCgd,EAAuB7pB,EAAEyT,IAAI5G,OAAO,QACpCid,EAAuB9pB,EAAEyT,IAAI5G,OAAO,QACpCkd,EAAkB/pB,EAAEoK,QAAQyC,OAAO,WAAY,+BAC/ChG,EAAQzG,KAAK8H,SAASyW,WACtBve,KAAK6jB,UAAYnP,EACjB1U,KAAKyjB,gBAAkBuF,EAGvBQ,EAAuBpmB,aAAa,UAAW,aAC/ComB,EAAuBpmB,aAAa,SAAU,MAC9ComB,EAAuBpmB,aAAa,QAAS,MAC7ComB,EAAuBpmB,aAAa,OAAQ,gBAC5CqmB,EAAqBrmB,aAAa,IAAK,iBACvCqmB,EAAqBrmB,aAAa,OAAQ,QAC1CsmB,EAAqBtmB,aAAa,IAAK,qJACvComB,EAAuBzlB,YAAY0lB,GACnCD,EAAuBzlB,YAAY2lB,GAEnCN,EAAkBlJ,QAAS,EAC3BgJ,EAAuB9lB,aAAa,eAAe,GAEnDnC,IAAI2oB,EAAsBhqB,EAAEoK,QAAQyC,OAAO,SAAU,kCAAmC6c,GACxFM,EAAoBvU,KAAO,SAC3BuU,EAAoB/X,MAAQ,eAC5B+X,EAAoBjb,UAAY,2CAChCib,EAAoBhY,UAAUG,IAAI,gBAElCnS,EAAE4G,SAASF,GAAGsjB,EAAqB,QAAShqB,EAAE4G,SAASigB,MACvD7mB,EAAE4G,SAASF,GAAGsjB,EAAqB,QAAS,IAC1C3oB,IAAI+nB,EAAW,EAAGxgB,EAAM6f,EAExB,GADAA,GAAyB,iBAAlB5hB,EAAMiD,QAA6BjD,EAAmBA,EAAM0C,cAAc,mBAAjC8E,WAC7CpM,EAAE4H,OAAOzB,QAAQ,YAAY6hB,qBAAuBhoB,EAAE4H,OAAOzB,QAAQ,YAAY6hB,mBAAmBC,SAErG,IADAthB,EAAO3G,EAAE4H,OAAOzB,QAAQ,YAAY+hB,uBAC9BvhB,GACJwgB,GAAY,EACZxgB,EAAOA,EAAKuhB,4BAIdvhB,EAAO,OAET/B,EAAMwM,YAAYpR,EAAE4H,OAAOzB,QAAQ,YAAYmB,cAAc,QAAQjC,MAAMY,UAC3EU,EAAOA,EAAO6f,EAAKlf,cAAc,gCAAgC6gB,kBAAmBxhB,EAAO6f,EAAKxX,iBAAiB,SAASmY,GAC1HxgB,EAAKI,SACJ5I,MAEHiB,IAAIgpB,EAA2BrqB,EAAEoK,QAAQyC,OAAO,SAAU,oCAAqC6c,GAmI/F,GAlIAW,EAAyB5U,KAAO,SAChC4U,EAAyBpY,MAAQ,iBACjCoY,EAAyB7mB,aAAa,iBAAiB,GACvD6mB,EAAyBrY,UAAUG,IAAI,gBACvCnS,EAAE4G,SAASF,GAAG2jB,EAA0B,QAAS,IAC/ChpB,IAAIxB,EAAeO,KAAK8H,SAASoiB,cAAcxjB,WAC3CjH,EAAa2K,aAAiC,UAAlBvI,EAAEsI,aAIF,IAA7Bif,EAAkBlJ,QACnB+J,EAAyB7mB,aAAa,iBAAiB,GACvDgmB,EAAkBlJ,QAAS,IAE3B+J,EAAyB7mB,aAAa,iBAAiB,GACvDgmB,EAAkBlJ,QAAS,GAR3BzgB,EAAa2K,aAAc,GAU5BpK,MAEH0H,EAAMuf,iBAAiBjnB,KAAKY,KAC5B8G,EAAM2N,KAAO,WACb3N,EAAMtE,aAAa,QAAQ,oCAC3B6lB,EAAc/hB,MAAQlH,MAEbmqB,aACHC,EAAapnB,SAASC,cAAc,MAC7BqT,KAAO,IAAMtW,KAAKqjB,OAC7B+G,EAAW7Y,KAAOvR,KAAKmqB,WACvBC,EAAW3gB,OAAS,SACpB2gB,EAAWC,WAAY,EACvBpB,EAAcllB,YAAYqmB,IAE1BnB,EAActa,UAAY3O,KAAKqjB,OAEjC4F,EAAcvV,GAAK,0BAA4B9T,EAAEyJ,MAAM4f,GAAiB,IACxEM,EAAsBhb,UAAY,UAClCgb,EAAsB7V,GAAK,4BAA8B9T,EAAEyJ,MAAMkgB,GACjElD,EAAetiB,YAAYwlB,GAC3BlD,EAAetiB,YAAY2Q,GAC3BA,EAAQtR,aAAa,OAAO,SAC5BsR,EAAQtR,aAAa,MAAO,KAC5BsR,EAAQtR,aAAa,MAAM,OAC3BsR,EAAQtR,aAAa,QAASpD,KAAK0G,WAAWuB,MAAMyM,SAAW,OAC/DA,EAAQtR,aAAa,OAAO,OAC5BsR,EAAQtR,aAAa,kBAAmBmmB,EAAsB7V,IAC9DgB,EAAQ3P,MAAQ/E,KAAK0G,WAAWuB,MAAMyM,SAAW,MAEjDsU,EAAS5lB,aAAa,eAAgB,SACtC4lB,EAAS5lB,aAAa,kBAAmB6lB,EAAcvV,IAEvDsV,EAAS9B,aAAe8B,EAAS7B,YAAc,IAC7C,GAA6D,UAAzDC,EAAU3d,OAAOG,cAAcF,QAAQwQ,eACI,UAA3CkN,EAAU3d,OAAOC,QAAQwQ,eACkB,UAA3CkN,EAAU3d,OAAOC,QAAQwQ,cAA2B,CACtDkN,EAAYA,aAAqBC,WAAaD,EAAUE,QAAQ,GAAKF,EACrEnmB,IAAIsmB,EAAUyB,EACVxB,EAAWwB,EAASzK,WACpBkJ,GAAS,EAAOC,EAAON,EAAUO,QAErC3kB,SAAS4kB,KAAKC,YAAc7kB,SAAS4kB,KAAKE,YAAc,IACtDC,EAAUtd,iBAIVxJ,IAAI+mB,GAHJD,EAAYA,aAAqBV,WAAaU,EAAUT,QAAQ,GAAKS,GAG9CJ,QAAUD,EAEjC,GADAD,EAA4B,EAAnBxiB,KAAKgjB,IAAID,IAAeP,IAC5BD,IAAaC,GAAYD,GAAYA,EAAS1H,mBAAqB,GACpE0H,EAASU,wBAAwB/P,IAAMoP,EAAQW,wBAAwB9P,QACvEoP,EAASU,wBAAwB9P,OAASmP,EAAQW,wBAAwB/P,KAF9E,CAMAqP,EAAS5V,UAAUG,IAAI,mBACvBwV,EAAQtf,MAAM6S,UAAY,cAAekN,EAAQ,MACjDT,EAAQtf,MAAMkgB,cAAgB,OAE9BlnB,IAAIoC,EAAI0kB,EAAUK,QAAS9kB,EAAIykB,EAAUJ,QACrCU,GAAyB,iBAAlB5hB,EAAMiD,QAA6BjD,EAAmBA,EAAM0C,cAAc,mBAAjC8E,WAChDqa,EAAYD,EAAKE,iBAAiBllB,EAAGC,GACrCklB,EAAeF,GAAcA,EAAUtgB,QAAQ,YAAwBsgB,EAAUtgB,QAAQ,YAA5Buf,EAEjEiB,EAAevjB,KAAKgjB,IAAID,IAAWQ,EAAYC,aAAelB,EAAUiB,EAExEjB,EAAQnkB,aAAa,eAAgB,QACrCmkB,EAAQnkB,aAAa,kBAAmB,QACrColB,GAAehB,IAAagB,EAAYjK,aACzCiK,EAAcA,IAAgBjB,EAAQmB,YAAaF,EAAcA,EAAYE,YAC1EnB,IAAYiB,IACbd,EAAOK,EAAUJ,QACjBJ,EAAQtf,MAAM6S,UAAY,MAE5B0M,EAASmB,aAAapB,EAASiB,MAInCxlB,SAAS4kB,KAAKgB,WAAa5lB,SAAS4kB,KAAKiB,UAAY,KACnDtB,EAAQnkB,aAAa,eAAgB,SACrCmkB,EAAQ/f,gBAAgB,mBACxB+f,EAAQtf,MAAMkgB,cAAgB,KAC9BZ,EAAQtf,MAAM6S,UAAY,KAC1B7Z,IAAI6nB,EAAgBtB,EAAS9e,SACzB5C,EAAS,EACb,IAAI7E,IAAI4Z,KAAKiO,EAAc,CACzB7nB,IAAIslB,EAAU1L,EAAE1R,cAAc,QAAQjC,MAAMY,SAE5Cye,EAAQnjB,aAAa,cAAc,IACnCqD,EAAMsiB,sBAAsB,YAAaxC,GACzCA,EAAQ/e,gBAAgB,eAGxB+e,EAAQ+D,OAAO5O,UAAU5V,GACzBA,IAEF0hB,EAAS5V,UAAUlE,OAAO,mBAC1B1K,SAAS4kB,KAAKC,YAAc7kB,SAAS4kB,KAAKE,YAAc9kB,SAAS4kB,KAAKiB,UAAY,QAKxFjpB,EAAE4G,SAASF,GAAGoO,EAAQ,SAAU1U,KAAK4jB,eAAgB5jB,MAErDqpB,EAAgBtlB,YAAY2D,GAC5B2hB,EAAgBtlB,YAAYklB,GAC5BgB,EAAyBlmB,YAAYmlB,GACrCA,EAAuBnlB,YAAYylB,GAE/BxpB,KAAKuqB,SACPnB,EAAkBrlB,YAAY/D,KAAKuqB,SAGjCvqB,KAAKwqB,YAAa,CACpB,IAAIC,EAAOznB,SAAS0nB,yBAChBrf,EAAYrL,KAAKmI,QAAQ4b,cAC7B,GAAI1Y,EACF,IAAK,IAAI7H,EAAE,EAAEA,EAAE6H,EAAU5H,OAAOD,IAE9B,IADA,IAAI0H,EAAWG,EAAU7H,GAChB6E,EAAE,EAAEA,EAAE6C,EAAS2O,OAAOpW,OAAO4E,IAAK,CACzC,IAKMsiB,EACAC,EANFC,EAAa3f,EAAS2O,OAAOxR,GAC7BqL,EAAK,IAAImX,EAAWjmB,aAAa,MAEI,eAArCimB,EAAWnhB,QAAQwQ,eAAmCuQ,EAAKthB,cAAcuK,KAEvEiX,EAAgB/qB,EAAEoK,QAAQyC,OAAO,UAAW,6CAA8Cge,GAC1FG,EAAgBhrB,EAAEoK,QAAQyC,OAAO,YACjCqe,EAAqBlrB,EAAEoK,QAAQyC,OAAO,UACnB8B,UAAYsc,EAAWjmB,aAAa,QACvDkmB,EAAmB1nB,aAAa,MAAOynB,EAAWjmB,aAAa,OAC/DgmB,EAAc7mB,YAAY+mB,GAC1BH,EAAc5mB,YAAY6mB,GAC1BD,EAAc5mB,YAAY8mB,EAAWlQ,aAKjDyO,EAAkBrlB,YAAY0mB,GAIhC,GAAGzqB,KAAKmI,SAAWnI,KAAKmI,QAAQC,YAAa,CAC3C,IAAI2iB,GAAY,EAChB/qB,KAAK4mB,uBAAyBwC,GAC9BppB,KAAK6mB,oBAAsB8C,GACXvmB,aAAa,aAAc,aAC3C,IAAInC,IAAIoH,EAAE,EAAGA,EAAIrI,KAAKmI,QAAQC,YAAY3E,OAAQ4E,IAChDshB,EAAgB5lB,YAAY/D,KAAKmI,QAAQC,YAAYC,GAAGC,eACpDtI,KAAKmI,QAAQC,YAAYC,GAAG6X,SAAQ6K,GAAY,GAElDA,GAAW3B,EAAkBrlB,YAAY4lB,GAG/C,OAAO3pB,KAAKyjB,iBAEhBH,YAAa,SAASxU,GAClB,IACI5H,EAMI8jB,EAQMpf,EAAKqf,EA8CnB,SAASC,EAAkBC,EAAcC,EAAYvqB,EAAYkK,EAAOqG,EAAMuT,GAC5E,IAAI0G,EAAe,GAEfC,EAAQH,EAAata,iBAAiB,qFACtC0a,EAAa,IAAKC,OAAO,kBAAoB,KAC7C7T,EAAYwT,EAAahiB,cAAc,4BACvCsiB,GAAe,EAAOC,EAAiB,CAE3ClnB,KAAsB,GACtB,GAAI4mB,EAAW,CACbnqB,IAAI6N,EAAUvM,EAAEoC,qBAAqBymB,EAAWxmB,aAAa,YAAasI,EAE1Ewe,EAAelnB,KAAOsK,EAAQtK,MAAQknB,EAAelnB,KAErDvD,IAAIiO,EAAWnO,OAAOC,KAAK8N,GAC3B,IAAI7N,IAAIuC,EAAG,EAAEA,EAAE0L,EAASzL,OAAOD,IAC7B,IAAI0L,EAAS1L,GAAG2L,SAAS,QAAQ,CAC/BjC,EAAK3K,EAAE6M,SAASF,EAAS1L,GAAGY,MAAM,KAAK,IACvC,MAGAiL,EAAO9M,EAAE+M,SAASpC,GACtBwe,EAAexnB,OAAS3B,EAAEgN,mBACxB3P,EAAEsE,OAAOtE,EAAE0E,OAAOwK,EAAQ,YAAYO,EAAK,KAAOP,EAAQ,YAAYO,EAAK,KAC3EzP,EAAE0E,OAAOwK,EAAQ,gBAAgBO,EAAK,KAAOP,EAAQ,gBAAgBO,EAAK,MAC1Eqc,EAAelnB,KAAM3D,EAAYqM,QAGnCwe,EAAexnB,OAAS3B,EAAE1B,GAAYtB,QAAQ0E,IAAI4T,KAAK3T,OAGzD,IAAK,IAAIV,EAAE,EAAEA,EAAG8nB,EAAM7nB,OAAOD,IAAK,CAChC,IAAImoB,EAAIL,EAAM9nB,GAAI0H,EAAWygB,EAAE/mB,aAAa,QAE5C,GADA+mB,EAAEhU,UAAYA,GACVzM,EAAS,CAEXjK,IACSuC,EAFT0H,EAAWL,EAEX,IAASrH,KADSuH,EAAM8F,iBAAiB,aAEvC3F,OAAgB1H,EAAEoB,aAAa,WAcnC,IAVA,IACIiN,EAAQ8Z,EAAEta,aAAa,SAAWsa,EAAE/mB,aAAa,SAAW,mBAC5DgnB,EAAO1gB,EAASsP,MAAM+Q,GACtBM,EAASF,EAAEta,aAAa,QAAkD,SAAxCsa,EAAE/mB,aAAa,OAAOsV,cAAqCyR,EAAE/mB,aAAa,OAAOsV,cAA/B,OACpF4R,EAAUH,EAAEta,aAAa,QAAmBsa,EAAE/mB,aAAa,QAAQsV,cAAjC,UAClCN,EAAS,GACTnF,EAAMkX,GAAKA,EAAEta,aAAa,OACtBpR,EAAa8K,EAAM5B,cAAc,uBACnB5G,EAAEoC,qBAAqBoG,EAAM5B,cAAc,uBAAuBvE,aAAa,iBAC/E8Y,EACqB,QAAnChG,EAAI6T,EAAWQ,KAAK7gB,KAAqB,CAC/C,IAoBQ8gB,EApBJC,EAAUvU,EAAE,GACZwU,EAAMf,EAAahiB,cAAc,kBAAkB8iB,EAAQ,qBAAqBA,EAAQ,KAC5F,IAAIC,EAqCG,CACL/V,QAAQC,IAAI,mBAAmB6V,EAAQ,iDAEvC,OAtCKC,EAAI7a,aAAa,SAAsC,aAA3B6a,EAAItnB,aAAa,SAC5CsnB,EAAI7a,aAAa,QAAW6a,EAAI7a,aAAa,SAC9C6a,EAAI7a,aAAa,SAAY,CAAC,IAAI,KAAKlC,SAAS+c,EAAItnB,aAAa,QAAQsV,iBACxEvC,GAAazM,EAASiE,aAAawI,EAAU/S,aAAa,aAC5D+S,EAAUvU,aAAa,QAASsoB,EAAelnB,MAE7CuV,EAAOmS,EAAItnB,aAAa,QACxBunB,EAAa5pB,EAAE6pB,kBAAkBV,EAAexnB,OAAQwnB,EAAelnB,KAAM3D,EAAY0B,EAAE6M,SAAS2K,IACxGmS,EAAI9oB,aAAa,MAAO+oB,EAAWhrB,IAAIoB,EAAE8pB,SAAStS,KAClDmS,EAAI9oB,aAAa,MAAO+oB,EAAW/qB,IAAImB,EAAE8pB,SAAStS,MAGpDH,EAAOtU,KAAK4mB,GACZT,EAAeA,GAAgBS,EAAI7a,aAAa,SAAsD,SAA3C6a,EAAItnB,aAAa,QAAQsV,cAClD,eAA9BgS,EAAIxiB,QAAQwQ,iBAEV8R,EAAKhpB,SAASC,cAAc,QAC5B+O,mBAAmB,aAAaka,EAAII,WAExCJ,EAAIvR,WAAaqR,EAAI7iB,cAAc,cACnC+iB,EAAIvR,WArGd,SAAoB4R,GAChB,IAAItS,EAASjX,SAASC,cAAc,UAChCupB,EAAmBD,EAAQE,oBAE/B,IAAIxrB,IAAIuC,EAAI,EAAGA,EAAIgpB,EAAiB/oB,OAAQD,IACxCyW,EAAO7W,aAAaopB,EAAiBhpB,GAAI+oB,EAAQ3nB,aAAa4nB,EAAiBhpB,KAGnF,IAAIjE,EAAUgtB,EAAQ7jB,SAEtB,IAAIzH,IAAIuC,EAAI,EAAGA,EAAIjE,EAAQkE,OAAQD,IAAI,CACnC,IAAIkpB,EAAS1pB,SAASC,cAAc,UAChC0pB,EAAkBptB,EAAQiE,GAAGipB,oBAEjC,IAAKxrB,IAAIoH,EAAI,EAAGA,EAAIskB,EAAgBlpB,OAAQ4E,IACxCqkB,EAAOtpB,aAAaupB,EAAgBtkB,GAAI9I,EAAQiE,GAAGoB,aAAa+nB,EAAgBtkB,KAGpFqkB,EAAO/d,UAAYpP,EAAQiE,GAAGmL,UAC9BsL,EAAOlW,YAAY2oB,GAEvB,OAAOzS,EAgFgB2S,CAAWV,EAAIvR,YAGhC/a,EAAE4G,SAASF,GAAG4lB,EAAIvR,WAAY,SAAUzT,EAAMiV,OAAQjV,GACjDA,EAAMsjB,cACTtjB,EAAMsjB,YAAc,IAEtBtjB,EAAMsjB,YAAYllB,KAAK4mB,EAAIvR,aAcjC,GAAIzP,GAAY0gB,EAAOnoB,SAAWmW,EAAOnW,QAAUyH,IAAaL,EAAe,CAChE,UAATghB,IACF3kB,EAAM2lB,WAAY,IAEhBpB,GAAgB9T,GAClBiC,EAAOtU,KAAKqS,GAEd1W,IAAIqa,EAAO3D,EAAYA,EAAU/S,aAAa,QAAU,EACpD0W,GAAiB,MAATA,IAAgBlB,MAAMkB,KAAOA,EAAO,GAEhD+P,EAAa/lB,KAAK,CAChB4F,SAAS4hB,UAAU,IAAIxb,IAAIpG,EAAUkG,IACrC4D,OAAQ2W,EACR9Z,MAAMA,EACN4J,IAAKoQ,EACLxW,KAAMyW,EACNjS,OAAQD,EACR3Z,WAAWA,EACX8sB,mBAAoB,CAAC7oB,OAAQwnB,EAAexnB,QAC5CygB,gBAAiBA,EACjB9jB,WAAWsqB,EAAavmB,aAAa,UAAY+F,EACjD8J,IAAIA,EACJ6G,KAAKA,KAIX,OAAO+P,EAGT,SAAS2B,EAAsBle,GAE3B,IAAI/D,EAAQ/K,KAAKitB,aAAene,EAGhC,GAFG/D,EAAM5B,eAAiB4B,EAAM5B,cAAc,iBAAejC,EAAMuH,SAAW1D,IAC1E/K,KAAKitB,aAAejtB,KAAKktB,eAAcniB,GAAQ,IAAIwL,WAAYC,gBAAgBxW,KAAKktB,aAAa,aACjGltB,KAAKmtB,aAAentB,KAAKotB,MAAQriB,EAAM5B,gBAAkB4B,EAAM5B,cAAc,eAAgB,CAC7F,IAAyDtI,EAArDsqB,EAAepgB,EAAM8F,iBAAiB,cAQ1C,GALIsa,EAAa1nB,SACf4pB,EAAatiB,EAAM5B,cAAc,8BAIT,GAAvBgiB,EAAa1nB,OACd,IAAIxC,IAAIuC,EAAI,EAAGA,EAAI2nB,EAAa1nB,SAI9BkhB,GAFE9jB,EAD4C,eAA1CsqB,EAAa3nB,GAAGkG,QAAQwQ,eAAkCiR,EAAa3nB,GAAG6N,aAAa,SAC5E8Z,EAAa3nB,GAAGoB,aAAa,SAE1B/D,IAAcA,IAAeqG,EAAM3H,QAAQ+tB,eAJvB9pB,UAShC6pB,GACiC,aAArCA,EAAW3jB,QAAQwQ,eAAgCmT,EAAWhc,aAAa,aAE7EsT,GADA9jB,EAAa0B,EAAEoC,qBAAqB0oB,EAAWzoB,aAAa,YAAYkK,UACxCjO,IAAeqG,EAAM3H,QAAQ+tB,eAIjE,IAwBU3I,EACI0G,EAzBVD,EAAargB,EAAM5B,cAAc,yBACjCokB,GAAqB5I,GAAmB5Z,EAAM5B,cAAc,+CAA+CjC,EAAM3H,QAAQ+tB,cAAc,KAEvIlc,EACd,IAAKE,IAAIvG,EAAM5B,cAAc,YAAc4B,EAAM5B,cAAc,YAAYvE,aAAa,QAAUmG,EAAMyiB,SAAWxtB,KAAKytB,YAAaztB,KAAKytB,aAAclc,KAE9I,IAAKoT,GAAmB4I,GAAqBA,EAAkBlc,aAAa,QAGxE,YADAnK,EAAMwD,KAAK,mBAAoB,CAAC6G,KAAO,IAAKD,IAAIic,EAAkB3oB,aAAa,QAASwM,GAAOG,OAAO,GAEnG,IAAKoT,GAAmBzd,EAAMtG,MAAuE,IAA/DsG,EAAMtG,KAAKrB,QAAQkH,MAAMoK,iBAAiB,UAAUpN,OAE/F,YADAyD,EAAMtG,KAAKrB,QAAQkH,MAAM5F,WAAaA,GAEjC,GAAKwsB,EAkBVnmB,EAAMiB,QAAUklB,MAlBK,CACrBnmB,EAAMiB,QAAU,GACbwc,IACDzd,EAAMiB,QAAQlE,IAAM1B,EAAE1B,IAExBqG,EAAMiB,QAAQC,YAAc,GAC5BlB,EAAMiB,QAAQ4b,cAAgB,GAC9B,IAAI9iB,IAAIoH,EAAI,EAAGA,EAAI8iB,EAAa1nB,OAAQ4E,IAClC8iB,EAAa9iB,GAAGc,cAAc,sFAC9BgiB,EAAa9iB,GAAGgJ,aAAa,WAC3BnK,EAAMiB,QAAQC,YAAY9C,KAAK6lB,EAAa9iB,IAC5Csc,EAAkBA,GAAmB4I,EACjClC,EAAeH,EAAkB5pB,KAAK4F,EAAOikB,EAAa9iB,GAAI+iB,EAAYvqB,EAAYkK,EAAOqG,EAAMuT,GACvGzd,EAAMiB,QAAQC,YAAYC,GAAG0b,cAAgBsH,EAC7CnkB,EAAMiB,QAAQ4b,cAAgB7c,EAAMiB,QAAQ4b,cAAc3P,OAAOiX,IAM3EnkB,EAAMwmB,uBAAuB3iB,EAAO7D,EAAOrG,GAE3C,IAAI2kB,EAASza,EAAM5B,cAAc,wBAC7Boc,EAAUxa,EAAM5B,cAAc,yBASlC,UAROjC,EAAMiB,QAAQqd,cACdte,EAAMiB,QAAQod,QACjBC,IACFte,EAAMiB,QAAQqd,OAAS,IAAKlU,IAAIkU,EAAO5gB,aAAa,QAASwM,GAAOG,MAElEgU,IACFre,EAAMiB,QAAQod,QAAU,IAAKjU,IAAIiU,EAAQ3gB,aAAa,QAASwM,GAAOG,MAEpErK,EAAMiB,QAAQC,YAChB,IAAInH,IAAIuC,EAAI,EAAGA,EAAI0D,EAAMiB,QAAQC,YAAY3E,OAAQD,IAChD0D,EAAMiB,QAAQC,YAAY5E,GAAG4H,gBAC9BlE,EAAMiB,QAAQC,YAAY5E,GAAG4H,eAAekS,MAAMpW,EAAMiB,QAAQC,YAAY5E,GAAGugB,cAAe7c,EAAMiB,QAAQC,YAAY5E,GAAGmY,cAKjI,GAAI5Q,EAAM5B,cAAc,YAAa,CACnC,IAAItE,EAAQ7B,SAASC,cAAc,aACjCuB,EAAOuG,EAAM5B,cAAc,iCAAmC4B,EAAM5B,cAAc,+BACpFtE,EAAMzB,aAAa,OAAQoB,GAAQA,EAAKI,aAAa,YAAcJ,GAAQA,EAAKI,aAAa,UAAY,KAEzG,IADA,IAAI+oB,EAAW5iB,EAAMvK,qBAAqB,YACjCotB,EAAG,EAAEA,EAAGD,EAASlqB,OAAOmqB,IAC7B/oB,EAAMd,YAAYf,SAAS6qB,WAAWF,EAASC,IAAK,IAExD1mB,EAAMkc,oBAAoBrf,YAAYc,GAKxC,GAHAtC,EAAEiP,uBAAuBzG,EAAOqG,EAAMlK,EAAMR,YAGzCQ,EAAMiB,QAAQC,YACf,IAAInH,IAAIoH,EAAI,EAAGA,EAAInB,EAAMiB,QAAQC,YAAY3E,OAAQ4E,IAAI,CACvD,IAAIud,EAAY1e,EAAMiB,QAAQC,YAAYC,GAAGzD,aAAa,SACtDkpB,EAAgB5mB,EAAMye,mBAAmBC,EAAWvd,GACxDnB,EAAMiB,QAAQC,YAAYC,GAAGC,cAAgBwlB,EAIjD,IAAIC,EAAahjB,EAAM8F,iBAAiB,6EACxC,GAAwB,EAApBkd,EAAWtqB,OAAY,CACzB,IAAIuqB,EAAgBhrB,SAASC,cAAc,WAC3CgrB,EAAuBjrB,SAASC,cAAc,WAC9CgrB,EAAqB1f,UAAY,QACjCyf,EAAcjqB,YAAYkqB,GAK1B,IAJA,IAAIC,EAAc,SAAUrsB,GACxBqF,EAAMwD,KAAK,cAAe,CAAC5G,IAAKjC,EAAE4H,OAAO7E,aAAa,eAAe,IAGhEyD,EAAE,EAAEA,EAAE0lB,EAAWtqB,OAAO4E,IAAK,CACpC,IAAI8lB,EAAcnrB,SAASC,cAAc,OACzCmrB,EAAmBD,EAAYpqB,YAAYf,SAASC,cAAc,UAClEmrB,EAAiBhrB,aAAa,OAAQ,SACtCgrB,EAAiBhrB,aAAa,KAAM,OAAOxD,EAAEyJ,MAAM+kB,IACnDA,EAAiBhrB,aAAa,OAAQ,UAAUpD,KAAKqjB,QACrD+K,EAAiBhrB,aAAa,QAAS2qB,EAAW1lB,GAAGzD,aAAa,UAClEwpB,EAAiBhrB,aAAa,YAAa,IAAIkO,IAAIyc,EAAW1lB,GAAGzD,aAAa,QAAQwM,GAAMG,MAC5F,IAAI8c,EAAmBF,EAAYpqB,YAAYf,SAASC,cAAc,UACtEorB,EAAiBjrB,aAAa,MAAO,OAAOxD,EAAEyJ,MAAM+kB,IACpDC,EAAiB9f,UAAYwf,EAAW1lB,GAAGzD,aAAa,SACd,eAAtCmpB,EAAW1lB,GAAGzD,aAAa,QAAiE,eAAtCmpB,EAAW1lB,GAAGzD,aAAa,SACnFwpB,EAAiBvmB,SAAU,GAE7BmmB,EAAcjqB,YAAYoqB,GAC1BvuB,EAAEoK,QAAQ2C,SAASqhB,EAAc,+CACjCpuB,EAAE4G,SAASF,GAAG8nB,EAAiB,QAASF,EAAahnB,GAEvDA,EAAMqjB,QAAUyD,EAGdjjB,EAAM5B,cAAc,aACtBjC,EAAMmc,OAAStY,EAAM5B,cAAc,aAAamlB,YAAYC,OACnDxjB,aAAiByjB,SAAWzjB,EAAMsG,aAAa,WACxDnK,EAAMmc,OAAStY,EAAMnG,aAAa,SAAS2pB,QAEzCrnB,EAAMtG,OACNsG,EAAMqc,kBAGFrc,EAAMtG,KAAK4c,SAAStW,IACpBA,EAAMtG,KAAK6tB,mBAAmBC,eAAexnB,EAAMue,wBAK3Dve,EAAMsI,OAAQ,EAEdxP,KAAKitB,cAYX,WACEhsB,IAAI8J,EAAQigB,EAAIiC,YACZhf,EAAajO,KAAK8H,SAASmG,WAC/B,GAAIlD,EAAO,CACT9J,IAAI0tB,EAAW5jB,EAAMrC,SAAS,GAAGA,SAAS,GAAGA,SAC7C,GAAIimB,EAAU,CACZ1tB,IACSse,EAUCqP,EAXNC,EAAU9jB,EAAMrC,SAAS,GAAGA,SAAS,GAAGS,cAAc,aAAavE,aAAa,QACpF,IAAS2a,KAAMoP,EAAU,CAGvB1tB,IAAIiL,EAAOqT,EAAG7N,WAAU,GAGxB,GAFA6N,EAAG9N,SAAWvF,EAEQ,aAAlBA,EAAKiF,SAAyB,CAChClQ,IAAI2K,EAAMM,EAAKtH,aAAa,SAAWsH,EAAKtH,aAAa,SAErDgH,GAAmC,IAA3BA,EAAIyM,QAAQ,YAAgD,IAA5BzM,EAAIyM,QAAQ,cAClDuW,EAAcC,EAAUjjB,EACxBM,EAAKmF,aAAa,QACpBnF,EAAK9I,aAAa,OAAQwrB,GAE1B1iB,EAAK9I,aAAa,OAAQwrB,IAIhC3gB,EAAWlK,YAAYmI,OApCZ5K,KAAK4F,GAEtBA,EAAMwD,KAAK,aAAcxD,GAAO,GAE5BA,EAAMY,SAAS8B,eAEjB1C,EAAMY,SAAS8B,cAAcklB,kBAE/B5nB,EAAMY,SAASmN,cAAc,IAAIC,YAAY,aAAc,CAACC,OAAQjO,MA9VnElH,KAAKkjB,OAAUpU,MAChB5H,EAAQlH,MAKHkjB,OACD8H,EAAM,IAAI+D,eAQJnjB,EANL5L,KAAKkjB,MAMK+H,EANE+B,EAOjBhC,EAAIgE,mBAAqB,WACpBhvB,KAAKmtB,aAAentB,KAAKotB,OACN,MAAhBptB,KAAKgW,QACW,MAAhBhW,KAAKgW,QACW,MAAhBhW,KAAKgW,QACW,MAAhBhW,KAAKgW,SACL9O,EAAMsI,OAAQ,EACdtI,EAAMwD,KAAK,aAAcxD,GAAO,GAChC8jB,EAAIiE,WAGZjE,EAAIkE,OAASjE,EACbD,EAAImE,QAAU,WACZjoB,EAAMsI,OAAQ,EACdtI,EAAMwD,KAAK,aAAcxD,GAAO,IAElC8jB,EAAIoE,KAAK,MAAOxjB,GAChBof,EAAIqE,iBAAiB,SAAS9sB,EAAE+sB,MAChCtE,EAAIuE,iBAAiB,YACrBvE,EAAIwE,QAzBG1gB,GAGPke,EAAsB1rB,KAAKtB,KAAM8O,KAmXzCyU,gBAAiB,WAEf,GAAIvjB,KAAKmI,SAAYnI,KAAKY,KAA1B,CAGA,IAQU4D,EARN2mB,EAAenrB,KAAKmI,QAAQC,aAAyC,CAACpI,KAAKmI,SAG7E,IAAIlH,IAAIuC,EAAI,EAAGA,EAAI2nB,EAAa1nB,OAAQD,IAAI,CAC1C,IAAK2nB,EAAa3nB,GAAG2F,cACnB,OAEAgiB,EAAa3nB,GAAG2F,cAAc,+CAC1B3E,EAAO2mB,EAAa3nB,GAAG2F,cAAc,gBACpC/F,aAAa,MAAMpD,KAAKY,KAAKykB,cAClC7gB,EAAKpB,aAAa,MAAMpD,KAAKY,KAAK0kB,gBAEpCmK,EAAKtE,EAAa3nB,GAAG6N,aAAa,SAAW8Z,EAAa3nB,GAAGoB,aAAa,SAAW,OAC3ErC,EAAEktB,GACPzvB,KAAKmI,QAAQC,YAAapI,KAAKmI,QAAQC,YAAY5E,GAAGS,IAAM1B,EAAEktB,GAC5DzvB,KAAKmI,QAAQlE,IAAM1B,EAAEktB,GAEvBzvB,KAAKmI,QAAQC,YAAapI,KAAKmI,QAAQC,YAAY5E,GAAGS,IAAM1B,EAAEmtB,QAC5D1vB,KAAKmI,QAAQlE,IAAM1B,EAAEmtB,WAMlC9K,cAAe,WACb,GAAI5kB,KAAKmI,QAAT,CACAlH,IAAIqgB,EAASthB,KAAKmI,QAAQC,YAAcpI,KAAKmI,QAAQC,YAAY,GAAKpI,KAAKmI,QAC3E,IAAImZ,EAAQ,OAAO3W,EACnB,OAAQ2W,EAAO5X,QAAQuF,eACrB,IAAK,aACH,GAAGqS,EAAOjQ,aAAa,SACrB,OAAOiQ,EAAO1c,aAAa,SAASqK,cACtC,MACF,IAAK,YACH,GAAGqS,EAAOjQ,aAAa,SACrB,OAAOiQ,EAAO1c,aAAa,SAASqK,cACtC,MACF,IAAK,WACH,GAAGqS,EAAOjQ,aAAa,WACrB,OAAO9O,EAAEoC,qBAAqB2c,EAAO1c,aAAa,YAAYkK,QAAQG,cACxE,MACF,QACE,OAAOtE,EAEX,OAAOA,IAET+iB,uBAAwB,SAAUiC,EAAKzoB,GACnC,IAAyF0oB,EAArFC,EAAeF,EAAIxmB,cAAc,yBACjC0mB,IACAC,EAAeD,EAAYjrB,aAAa,SAExCgrB,EAAU,YADGC,EAAYjrB,aAAa,QACD,YAAYkrB,EAAa,KAAKA,EAAa,QAEpFlwB,EAAES,WAAW6G,EAAM,CAACwe,YAAYkK,IAC5BxF,EAAauF,EAAIxmB,cAAc,wBAC/BihB,IACFljB,EAAMijB,WAAaC,EAAWxlB,aAAa,UAGjDmrB,kBAAmB,SAASC,GACxB,GAAIhwB,KAAKmI,SAAWnI,KAAKmI,QAAQ2T,SAAU,CACzC,IAAIzQ,EAAY,GAEhB,GAAIrL,KAAK8H,SAASD,UAAY7H,KAAK8H,SAASoY,QAAUlgB,KAAKyjB,gBAAiB,CAC1ExiB,IAAIgvB,EAAkBjwB,KAAKyjB,gBAAgB5S,iBAAiB,0BAC5D,IAAI5P,IAAIuC,EAAI,EAAGA,EAAIysB,EAAgBxsB,OAAQD,IACzC,GAAIysB,EAAgBzsB,GAAG8d,QAA8C,IAApCthB,KAAKmI,QAAQC,YAAY3E,OAAc,CACtExC,IAAIqgB,EAAS2O,EAAgBzsB,GAAG8d,QAAUthB,KAAKmI,QAAQC,YAAY,GACnE,IAAKnH,IAAIoH,EAAI,EAAGA,EAAIiZ,EAAOyC,cAActgB,OAAQ4E,IAC/C,GAAIiZ,EAAOzZ,QAAS,CAClB5G,IAAIiK,EAAWoW,EAAOyC,cAAc1b,GAEpC,IAAKpH,IAAIyO,EAAI,EAAGA,EAAI1P,KAAKmI,QAAQ2T,SAASrY,OAAQiM,IAAK,CACrDzO,IAAIivB,EAAgBlwB,KAAKmI,QAAQ2T,SAASpM,GACtCxE,IAAaglB,GAAiBA,EAAc1b,aAAaiD,SAASuY,IACpE3kB,EAAU/F,KAAK4qB,KAO3B,OAAO7kB,KAIfoZ,mBAAoB,SAAS5iB,GAC3BZ,IAAIoN,EAAQxM,EAAEwM,MAAOrH,EAAMnF,EAAE4H,OAAQvC,EAAOyL,EACxC7D,EAAUT,EAAM3H,WAAW6B,uBAAuB,uBAAuB,GAE7E8F,EAAM3H,WAAWtD,aAAa,OAAQ,UACtC0L,EAAQ1L,aAAa,WAAY,MAEjC0L,EAAQ1L,aAAa,OAAQ,YAC7BiL,EAAMuP,OAAS,EAEZvP,EAAMyP,QAAQqS,eACfjpB,EAAQmH,EAAMyP,QAAQqS,cAAcpvB,OAAOC,KAAKqN,EAAMyP,QAAQqS,eAAe,IAC7Exd,EAAQtE,EAAMyP,QAAQnL,MAEtByd,EAAe9uB,KAAK+M,KAEpBnH,EAAQmH,EAAMyP,QAAQ0G,gBAEtBxd,EAAIV,GAAG,iBAAkB8pB,EAAgB/hB,IAGxCA,EAAM3H,WAAWyC,cAAc,sCAChCvJ,EAAEoK,QAAQ0D,OAAOW,EAAM3H,WAAWyC,cAAc,qCAChDvJ,EAAEoK,QAAQ0D,OAAOW,EAAM3H,WAAWyC,cAAc,QAGlDlI,IAAI+qB,EAAMpsB,EAAEoK,QAAQyC,OAAO,MAAO,uBAGlCxL,IAAIovB,EAAiBzwB,EAAEoK,QAAQyC,OAAO,SAAU,qBAAsBuf,GACtEqE,EAAehb,KAAO,SACtBgb,EAAexe,MAAQ,YACvBwe,EAAe1hB,UAAY,4CAC3B/O,EAAE4G,SAASF,GAAG+pB,EAAgB,QAAS,IACrCzwB,EAAE4G,SAASigB,KAAK5kB,GAChBmF,EAAI2G,aAAa2iB,aACjBtpB,EAAIoV,aACJpV,EAAIN,WAAWkC,SACdyF,GAGHpN,IAAIsvB,EAAiB3wB,EAAEoK,QAAQyC,OAAO,SAAU,qBAAsBuf,GACtEuE,EAAelb,KAAO,SACtBkb,EAAe1e,MAAQ,mBACvB0e,EAAe5hB,UAAY,2CAC3B/O,EAAE4G,SAASF,GAAGiqB,EAAgB,QAASrpB,EAAMyW,iBAAkBtP,GAG/DpN,IAAIuvB,EAAe5wB,EAAEoK,QAAQyC,OAAO,IAAK,sBAAuBuf,GAC5DyE,EAAgBzwB,KAAKwO,oBAA+C,EACxEgiB,EAAajiB,UAAaF,EAAMuP,OAAS,EAAG,IAAI6S,EAGhDxvB,IAAIyvB,EAAa9wB,EAAEoK,QAAQyC,OAAO,SAAU,qBAAsBuf,GAClE0E,EAAWrb,KAAO,SAClBqb,EAAW7e,MAAQ,eACnB6e,EAAW/hB,UAAY,2CACvB/O,EAAE4G,SAASF,GAAGoqB,EAAY,QAASxpB,EAAM2W,aAAcxP,GAGvDpN,IAAI0vB,EAAqB/wB,EAAEoK,QAAQyC,OAAO,SAAU,qBAAsBuf,GAC1E2E,EAAmBtb,KAAO,SAC1Bsb,EAAmB9e,MAAQ,iBAC3B8e,EAAmBhiB,UAAY,4CAC/B/O,EAAE4G,SAASF,GAAGqqB,EAAoB,QAAS,IACzC3pB,EAAI2G,aAAa2iB,aACjBtpB,EAAI2G,aAAaijB,aAAe5pB,EAAI2G,aAAakjB,gBAAgBptB,OAAS,EAC1EuD,EAAI2G,aAAakjB,gBAAgB,GAAGC,KAAK1tB,aAAa,YAAa,GACnE4D,EAAI2G,aAAakjB,gBAAgB7pB,EAAI2G,aAAaijB,cAAcE,KAAK1tB,aAAa,WAAY,GAC9FxD,EAAE4G,SAASigB,KAAK5kB,GAChBmF,EAAIoV,aACJpV,EAAI+pB,kBAAkB5nB,cAAc,mBAAmBP,SACtDyF,GAEC2iB,EAAUpxB,EAAEoK,QAAQyC,OAAO,KAAM,uBAiBrC,SAASwkB,EAAaC,GACpBjwB,IAAI6vB,EAAOI,EAAWhnB,cAAc4mB,MAAQI,EAAWhnB,cAAcinB,eACrElwB,IAAImwB,EAA6C,IAArCF,EAAWhnB,cAAcmnB,QACjCC,EAAeJ,EAAWhnB,cAAcqnB,UACvCT,EAAK,GAAGlf,UAAU6F,SAAS,+BAAiC2Z,IAAUE,GACpC,KAArCJ,EAAWhnB,cAAcmnB,SACzBP,EAAK,GAAGlf,UAAU6F,SAAS,+BAAsE,KAArCyZ,EAAWhnB,cAAcmnB,SAM5EP,EAAK,GAAGlf,UAAU6F,SAAS,wBAA0B2Z,GAASE,GAM9DR,EAAK,KAAOziB,EAAMI,SAAStF,cAAc,MAAQioB,GAASE,IAXnE3oB,WAAW,KACT3B,EAAIoV,WAAW/N,GACfsE,EAAM/J,QACNhJ,EAAE4G,SAASigB,KAAKyK,IACf,GAgBP,SAASM,EAASN,GAChBjwB,IAAI6vB,EAAOI,EAAWhnB,cAAc4mB,MAAQI,EAAWhnB,cAAcinB,eACrElwB,IAAImwB,EAA6C,IAArCF,EAAWhnB,cAAcmnB,QACrCC,EAAeJ,EAAWhnB,cAAcqnB,SAEC,KAArCL,EAAWhnB,cAAcmnB,SAAkBP,EAAK,GAAGlf,UAAU6F,SAAS,+BAAuE,KAArCyZ,EAAWhnB,cAAcmnB,SACnIzxB,EAAE4G,SAAS0d,gBAAgBgN,GAC3BlqB,EAAIoV,WAAW/N,GACfrH,EAAIN,WAAWkC,QACyB,KAArCsoB,EAAWhnB,cAAcmnB,UAAerqB,EAAIyqB,cAAe,IACrDL,GAASN,EAAK,GAAGlf,UAAU6F,SAAS,8BAC7CzQ,EAAIoV,WAAW/N,IACNyiB,EAAK,GAAGlf,UAAU6F,SAAS,wBAA0B2Z,GAASE,GAM9DR,EAAK,KAAOziB,EAAMI,SAAStF,cAAc,MAAQioB,GAASE,KALnEtqB,EAAIoV,WAAW/N,GACf1F,WAAW,KACT/I,EAAE4G,SAASigB,KAAKyK,GAChBlqB,EAAIN,WAAWkC,SACd,IAUP,SAASwnB,EAAgBvuB,GAEvBZ,IAAI6N,EAAU9O,KAAKyO,SACfijB,EAAY7vB,EAAIA,EAAE+M,YAAc5O,KAAK8d,QAAQ6T,YAAYC,WAI7D,GAHI9iB,EAAQ3F,cAAc,sBACxB2F,EAAQ3F,cAAc,qBAAqBuE,SAExCgkB,EAAUvoB,cAAc,gBAA7B,CACAlI,IAAI4wB,EAAKH,EAAUpQ,OAAOwQ,QAAQC,KAC9BC,EAAKN,EAAUpQ,OAAO2Q,YAAYF,KAClChiB,EAASnQ,EAAEsyB,aAAatyB,EAAEuyB,OAAON,EAAG1X,WAAY0X,EAAGtX,UAAW3a,EAAEuyB,OAAOH,EAAG7X,WAAY6X,EAAGzX,WAAW2E,WAAU,GAClHje,IAAImxB,EAAWpvB,SAASC,cAAc,KACtCmvB,EAAS7gB,SAAWmgB,EAAUpM,gBAAgBvV,EAAOsiB,OAAOtiB,EAAOuiB,IACnEF,EAASzjB,UAAY,GAAGpM,EAAEhD,QAAQgzB,OAAOC,UACzCJ,EAAS3pB,UAAY,kBACrB2pB,EAASK,QAAUL,EAASM,UAAY,SAAU7wB,IAC1CA,aAAa8wB,YAA6B,KAAd9wB,EAAEwvB,WACpCxvB,EAAE4I,iBACFinB,EAAUkB,WAEZ9jB,EAAQ6Z,aAAayJ,EAAUtjB,EAAQ3F,cAAc,4BAzFvDkF,EAAMC,eAAiB0d,EACvB3d,EAAMI,SAAS1K,YAAYitB,GAC3B3iB,EAAMI,SAAS1K,YAAYioB,GAE3Bld,EAAQlG,QAEL+J,IAAUpQ,EAAEhD,QAAQszB,2BAGrBlgB,EAAMvP,aAAa,gBAAiB,QACpC4D,EAAIV,GAAG,UAAW2qB,IAElBjqB,EAAIV,GAAG,UAAWkrB,GAiFpBxqB,EAAIV,GAAG,aACP,SAASwsB,EAAeC,GAClBA,EAAY1kB,QAAUA,IACxBrH,EAAIC,IAAI,UAAWgqB,GACnBjqB,EAAIC,IAAI,UAAWuqB,GACnBxqB,EAAIC,IAAI,YAAampB,GACrBppB,EAAIC,IAAI,aAAc6rB,GACnBngB,GAAOA,EAAMvP,aAAa,gBAAiB,eAUpDiJ,EAAezM,EAAE2b,MAAMzb,OAAO,CAEhCW,MAAO,SAAUuG,GAEf/F,IAAI+xB,EAAUhsB,EAAI+Y,WAGF,IAAZiT,EAAQ3vB,GAAuB,IAAZ2vB,EAAQ1vB,KAC7BtD,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,QAAS,cAAezF,EAAIN,YAE/D1G,KAAKizB,OAASC,EAAW,CACvBzqB,UAAW,oBACXiE,KAAM1M,KAAK0G,aAEbM,EAAI6I,SAAS7P,KAAKizB,SAIpBjzB,KAAKmzB,MAAQC,EAAU,CACrB3qB,UAAW,mBACXiE,KAAM1F,EAAIqsB,OAAOC,QACjBxtB,OAAQ,IACR5C,SAAU8D,EAAIzH,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,IAExD2D,EAAI6I,SAAS7P,KAAKmzB,OAElBnzB,KAAKuzB,SAAWC,EAAa,CAC3B/qB,UAAW,sBACXiE,KAAM1F,EAAIqsB,OAAOC,QACjBG,SAAUzzB,KAAK0G,aAEjBM,EAAI6I,SAAS7P,KAAKuzB,WAGpBxsB,SAAU,SAAUC,GAClBA,EAAIS,YAAYzH,KAAKmzB,OACrBnsB,EAAIS,YAAYzH,KAAKuzB,UACjBvzB,KAAKizB,SACPjsB,EAAIS,YAAYzH,KAAKizB,QACrBrzB,EAAEoK,QAAQ0D,OAAO1N,KAAK0G,gBAUxBgtB,EAAa9zB,EAAE2b,MAAMzb,OAAO,CAE9BC,WAAY,SAAUR,GACpBK,EAAES,WAAWL,KAAMT,IAGrBkB,MAAO,SAAUuG,GAEfhH,KAAKqjB,OAASzjB,EAAEoK,QAAQyC,OAAO,UAAW,qBAAsBzM,KAAKT,QAAQmN,MAC7E1M,KAAKqjB,OAAO1U,UAAY,aAExB3H,EAAI2sB,MAAQ,GACZ3sB,EAAI2sB,MAAMC,eAAiB5zB,KAAK6zB,gBAAkBj0B,EAAEoK,QAAQyC,OAAO,QAAS,oBAAqBzM,KAAKT,QAAQmN,MAE9GzL,IAAI6yB,EAAgB9sB,EAAI2sB,MAAMC,eAE9B5sB,EAAI2sB,MAAMI,WAAan0B,EAAEoK,QAAQyC,OAAO,KAAM,0BAA2BqnB,GACzE9sB,EAAI2sB,MAAMK,iBAAmBp0B,EAAEoK,QAAQyC,OAAO,KAAM,0BAA2BqnB,GAC/E9sB,EAAI2sB,MAAMM,UAAYr0B,EAAEoK,QAAQyC,OAAO,KAAM,0BAA2BqnB,GACxE9sB,EAAI2sB,MAAMO,WAAat0B,EAAEoK,QAAQyC,OAAO,KAAM,0BAA2BqnB,GACzE9sB,EAAI2sB,MAAMQ,WAAav0B,EAAEoK,QAAQyC,OAAO,KAAM,0BAA2BqnB,GACzE9sB,EAAI2sB,MAAMS,WAAax0B,EAAEoK,QAAQyC,OAAO,KAAM,0BAA2BqnB,GAEzE9zB,KAAKY,KAAK0F,GAAG,YAAatG,KAAKq0B,gBAGjCttB,SAAU,WACRnH,EAAEoK,QAAQ0D,OAAO1N,KAAKqjB,QAClBrjB,KAAK6zB,kBACPj0B,EAAEoK,QAAQ0D,OAAO1N,KAAK6zB,iBACtB7zB,KAAKY,KAAKqG,IAAI,YAAajH,KAAKq0B,iBAGpCA,cAAe,SAAUxyB,GACvB,IAAI7B,KAAK6J,YAAYyqB,SAArB,CACArzB,IAAIwF,EAAQzG,KAAKT,QAAQkH,MACvBnC,EAAQmC,EAAM7F,KAAK2zB,QAAQ1yB,EAAEwI,QAC7B4F,EAAQxJ,EAAM7F,KAAKrB,QAAQ0E,IAAIgM,OAAOxJ,EAAMjC,MAC5CqT,EAAOpR,EAAM7F,KAAKrB,QAAQ0E,IAAImV,eAAeC,YAAY/U,EAAO2L,GAChE/M,EAAWuD,EAAM7F,KAAKrB,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EAC9DmxB,EAASlwB,EAAMjB,EAAIH,EAAUuxB,EAASnwB,EAAMhB,EAAIJ,EAE9CsxB,EAAS,IAAGA,GAAUtxB,GACtBuxB,EAAS,IAAGA,GAAUvxB,GAE1BlD,KAAK2zB,MAAMI,WAAWplB;;eAEb1J,KAAKyvB,MAAMF;eACXvvB,KAAKyvB,MAAMD;QAEpBz0B,KAAK2zB,MAAMM,UAAUtlB;;eAEZ1J,KAAKyvB,MAAM7yB,EAAE0I,eAAelH;eAC5B4B,KAAKyvB,MAAM7yB,EAAE0I,eAAejH;QAErCtD,KAAK2zB,MAAMS,WAAWzlB;;iBAEX9M,EAAEwI,OAAOgoB,IAAIsC,QAAQ;iBACrB9yB,EAAEwI,OAAOioB,IAAIqC,QAAQ;QAEhC30B,KAAK2zB,MAAMO,WAAWvlB;;eAEb1J,KAAKyvB,MAAMpwB,EAAMjB;eACjB4B,KAAKyvB,MAAMpwB,EAAMhB;QAE1BtD,KAAK2zB,MAAMK,iBAAiBrlB;;oBAEd1J,KAAKyvB,MAAMpwB,EAAMjB,EAAIH;iBACxB+B,KAAKyvB,MAAMpwB,EAAMhB,EAAIJ;QAEhClD,KAAK2zB,MAAMQ,WAAWxlB;;qBAEPkJ,EAAKxU,EAAEsxB,QAAQ;sBACd9c,EAAKvU,EAAEqxB,QAAQ;YAM/BzB,EAAa,SAAU3zB,GACzB,OAAO,IAAIm0B,EAAWn0B,IAGpBq1B,EAAYh1B,EAAEC,UAAUC,OAAO,CAEjCC,WAAY,SAAUR,GACpBK,EAAES,WAAWL,KAAMT,GACnBK,EAAEC,UAAUwB,UAAUtB,WAAWuB,KAAKtB,KAAMA,KAAKY,OAGnDiC,WAAY,SAAUF,GACpB1B,IAAIyC,EAAO9D,EAAEoK,QAAQyC,OAAO,MAAO,oBAOnC,OANA/I,EAAKN,aAAa,MAAOT,EAAOU,GAChCK,EAAKN,aAAa,MAAOT,EAAOW,GAChCI,EAAKN,aAAa,OAAQT,EAAOY,GACjCG,EAAKiL,UAAY,CAAC,QAAQhM,EAAOU,EAAK,QAAQV,EAAOW,EAAK,SAASX,EAAOY,GAAKsxB,KAAK,MAEpFnxB,EAAKuE,MAAM6sB,QAAU,iBACdpxB,KAIP0vB,EAAY,SAAU7zB,GACxB,OAAO,IAAIq1B,EAAUr1B,IAGnBw1B,EAAen1B,EAAEo1B,WAAWl1B,OAAO,CACrCC,WAAY,SAAUR,GACpBK,EAAES,WAAWL,KAAMT,GACnBK,EAAEo1B,WAAW3zB,UAAUtB,WAAWuB,KAAKtB,KAAMA,KAAKY,KAAMrB,IAE1DkB,MAAO,SAAUuG,GACfA,EAAIV,GAAG,gBAAiBtG,KAAKi1B,gBAAiBj1B,MAC9CgH,EAAIV,GAAG,aAActG,KAAKi1B,gBAAiBj1B,MAC3CiB,IAAI8O,EAAS/I,EAAIzH,QAAQ0E,IAAImV,eAAe0B,UAAUlb,EAAE0E,MAAM,EAAG,GAAI0C,EAAIzH,QAAQ0E,IAAIgM,MAAM,IAC3FjQ,KAAKk1B,cAAgBt1B,EAAEu1B,OAAOnuB,EAAIzH,QAAQ0E,IAAImxB,cAAcrlB,EAAQ,GAAI,CAAEslB,OAAQ,MAClFr1B,KAAKk1B,cAAc5iB,YAAY,qBAE/BtS,KAAKs1B,WAAWtuB,IAElBD,SAAU,SAAUC,GAClBhH,KAAKmO,eAGPmnB,WAAY,SAAUtuB,GACpB/F,IAAIyS,EAAK3S,OAAOC,KAAKgG,EAAIf,SACvBvG,EAASsH,EAAIf,QACbsvB,EAAS,CAAC,UAAW,UAAW,UAAW,UAAW,WACtDltB,EAAI,EAENrI,KAAK6P,SAAS7P,KAAKk1B,eAEnB,IAAKj0B,IAAIuC,KAAKkQ,EACZ,GAAIhU,EAAO8D,GAAG1C,aAAepB,EAAO8D,GAAGgR,aAAc,CACnDvT,IAAIu0B,EAEFA,EADC91B,EAAO8D,GAAG1C,YACG,CACZpB,EAAO8D,GAAG1C,YAAYK,IACtBvB,EAAE0E,MAAM5E,EAAO8D,GAAG1C,YAAYM,IAAIiC,EAAG3D,EAAO8D,GAAG1C,YAAYK,IAAImC,GAC/D5D,EAAO8D,GAAG1C,YAAYM,IACtBxB,EAAE0E,MAAM5E,EAAO8D,GAAG1C,YAAYK,IAAIkC,EAAG3D,EAAO8D,GAAG1C,YAAYM,IAAIkC,IAGnD,CACZ5D,EAAO8D,GAAGgR,aAAarT,IACvBvB,EAAE0E,MAAM5E,EAAO8D,GAAGgR,aAAapT,IAAIiC,EAAG3D,EAAO8D,GAAGgR,aAAarT,IAAImC,GACjE5D,EAAO8D,GAAGgR,aAAapT,IACvBxB,EAAE0E,MAAM5E,EAAO8D,GAAGgR,aAAarT,IAAIkC,EAAG3D,EAAO8D,GAAGgR,aAAapT,IAAIkC,IAGrErC,IAAIw0B,EAAaC,EAAgBF,EAAa,CAC5CtjB,MAAOqjB,EAAOltB,EAAIktB,EAAO9xB,QACzBkyB,OAAQ,EACRjhB,QAAS,EACTkhB,YAAa,IACbC,MAAM,IAEJn2B,EAAO8D,GAAGjE,QAAQgO,eACpBkoB,EAAWnjB,YAAY5S,EAAO8D,GAAGjE,QAAQgO,cAAc8V,OAAQ,CAAE7Q,QAAQ,IAC3ExS,KAAK6P,SAAS4lB,GACdptB,IAIDrB,EAAI8uB,mBACDC,EAAmB,CACrB/uB,EAAI8uB,iBAAiB30B,IACrBvB,EAAE0E,MAAM0C,EAAI8uB,iBAAiB10B,IAAIiC,EAAG2D,EAAI8uB,iBAAiB30B,IAAImC,GAC7D0D,EAAI8uB,iBAAiB10B,IACrBxB,EAAE0E,MAAM0C,EAAI8uB,iBAAiB30B,IAAIkC,EAAG2D,EAAI8uB,iBAAiB10B,IAAIkC,IAG3D0yB,EAAcN,EACdK,EACA,CAAC7jB,MAAO,UAAWyjB,OAAQ,EAAGjhB,QAAS,GAAKmhB,MAAM,IACtD71B,KAAK6P,SAASmmB,KAIlBf,gBAAiB,SAAUpzB,GACzB7B,KAAKmO,cACLnO,KAAKs1B,WAAWzzB,EAAE4H,WAIlB+pB,EAAe,SAAUj0B,GAC3B,OAAO,IAAIw1B,EAAax1B,IAItB02B,EAAkBr2B,EAAEs2B,KAAKp2B,OAAO,CAElCof,UAAW,SAAU3O,GACnBtP,IAAIgD,EAAMjE,KAAKY,KAAKrB,QAAQ0E,IAC5B,OAAOA,EAAIkyB,UAAUv2B,EAAEsE,OAAOlE,KAAKo2B,YAAYlX,cAIjD3f,QAAS,CACPkJ,UAAW,sBAEb1I,WAAY,SAAUs2B,EAAW92B,GAE/BS,KAAKo2B,WAAaC,EAClBz2B,EAAES,WAAWL,KAAMT,IAGrB8X,SAAU,WACRrX,KAAKs2B,OAAS,GACdr1B,IAAIgP,EAAQjQ,KAAKY,KAAKrB,QAAQ0E,IAAIgM,MAAMjQ,KAAKY,KAAKmB,WAChDiF,EAAMhH,KAAKY,KACb,IAAKK,IAAIuC,EAAI,EAAGA,EAAIxD,KAAKo2B,WAAW3yB,OAAQD,IAAK,CAC/CvC,IAAIqD,EAAQ0C,EAAIzH,QAAQ0E,IAAImV,eAAe0B,UAAU9a,KAAKo2B,WAAW5yB,GAAIyM,GAEzEjQ,KAAKs2B,OAAOhxB,KAAK1F,EAAE0E,MAAMA,EAAMjB,EAAGiB,EAAMhB,GAAGizB,UAAUvvB,EAAIma,mBAI3DnhB,KAAKw2B,OAAS,CAACx2B,KAAKs2B,SAGtBzvB,QAAS,WACF7G,KAAKY,MACVZ,KAAKy2B,UAAUC,YAAY12B,MAAM,MAKjC01B,EAAkB,SAAUW,EAAW92B,GACzC,OAAO,IAAI02B,EAAgBI,EAAW92B,IAGpCo3B,EAAe/2B,EAAEg3B,QAAQ92B,OAAO,CAChC+2B,SAAU,WAINj3B,EAAES,WAAWL,KAAM,CAACyG,MAAOzG,KAAKY,KAAKrB,QAAQkH,QAC7C7G,EAAE4G,SAASF,GAAGtG,KAAKY,KAAM,QAASZ,KAAK82B,eAAgB92B,MACvDJ,EAAE4G,SAASF,GAAGtG,KAAKY,KAAM,WAAYZ,KAAK+2B,0BAA2B/2B,OAEzEg3B,YAAa,WACTp3B,EAAE4G,SAASS,IAAIjH,KAAKY,KAAM,QAASZ,KAAK82B,eAAgB92B,MACxDJ,EAAE4G,SAASF,GAAGtG,KAAKY,KAAM,WAAYZ,KAAK+2B,0BAA2B/2B,OAEzEi3B,sBAAuB,WAGnB,IAFA,IAAIv3B,EAASM,KAAKT,QAAQkH,MAAM/G,OAEvBw3B,EAAEx3B,EAAO+D,OAAO,EAAK,GAAHyzB,EAAKA,IAAK,CACnC,IAAIC,EAAaz3B,EAAOw3B,GAAG5M,OAC3B,GAAI5qB,EAAOw3B,GAAGrvB,SAAWsvB,EAAWtK,UAChC,OAAOsK,IAIjBJ,0BAA2B,SAAUK,GACnCzuB,WAAW,MACL3I,KAAKY,KAAKy2B,WAAcr3B,KAAKY,KAAK6wB,cAA6C,MAA5B2F,EAAMltB,cAAchJ,KAAgD,KAAhCk2B,EAAMltB,cAAcmnB,eAOtGrxB,KAAKY,KAAK6wB,aANjBzxB,KAAKY,KAAK8J,KAAK,QAAS,CACpBL,OAAQrK,KAAKY,KAAKse,YAClBoY,WAAYt3B,KAAKY,KAAK22B,mBAAmBv3B,KAAKY,KAAKse,aACnD3U,eAAgBvK,KAAKY,KAAK42B,uBAAuBx3B,KAAKY,KAAKse,gBAKhE,IAEL4X,eAAgB,SAASM,GACrB,IAAIlwB,EAAQlH,KAAKi3B,wBACb/vB,IACGA,EAAM4F,uBAAuB5F,EAAM4F,eACtC9M,KAAKy3B,OAAOL,EAAOlwB,KAG3BuwB,OAAO51B,EAAGqF,GAOQ,SAAZwwB,EAAsB7c,GACpB,OAAO5W,EAAImV,eAAeC,YAAYwB,EAAE5W,EAAIgM,MAAMzL,IAExC,SAAZmzB,EAAsB9c,GACpB,OAAO5W,EAAIkyB,UAAUlyB,EAAImV,eAAeC,YAAYwB,EAAE5W,EAAIgM,MAAMzL,IAAOA,GAYzD,SAAhBozB,EAAyB1sB,EAAUlC,EAAK6uB,GAC1C,MAAM/Y,EAAS,IAAIvI,UACnBZ,MAAM/V,EAAEgT,KAAK1H,SAASA,EAASA,SAAUlC,GAAM,CAAE6M,SAAU,WACxDC,KAAK,IACJ,GAAuB,KAAnBC,EAASC,QAAiBD,EAASC,OAAS,IAC9C,OAAOD,EAASO,OAAOR,KAAMQ,IACpB,CACLwhB,YAAa/hB,EAAS8I,QAAQkZ,IAAI,gBAClCzhB,KAAMA,KAIV,MAAM,IAAI0hB,MAAMjiB,EAASC,UAE9BF,KAAK,IAEN,GADI5O,EAAM4F,iBAAgB5F,EAAM4F,eAAiB,IAC7CiJ,EAAS+hB,YAAYxiB,WAAW,cAAe,CAGjDrU,IAAIg3B,EAAWnZ,EAAOtI,gBAAgBT,EAASO,KAAM,mBACjDvJ,EAAWmrB,MAAM72B,UAAU82B,MAAM72B,KAAK22B,EAASpnB,iBAAiB,gBACjE9D,EAAStJ,SAAQyD,EAAM4F,eAAiB5F,EAAM4F,eAAesH,OAAOrH,QAClE,CAEL9L,IAAIm3B,EAAO,uDAAuDv2B,EAAEwI,OAAOgoB,IAAI,IAAIxwB,EAAEwI,OAAOioB,IAAI,gDAC5FvkB,EAAU+Q,EAAOtI,gBAAgB,gCAC/BT,EAASO,KAAK,oBAAoB8hB,EAAK,iBAAkB,aAAajvB,cAAc,eAC1FjC,EAAM4F,eAAexH,KAAKyI,GAE5B,GAAG8pB,EAAS,CAEV,IAAK52B,IAAI8M,KAAW7G,EAAM4F,eACxBiB,EAAQC,UAAY9C,EAAS8C,WAiEnC,SAA8BjB,EAAUyT,GAEtCvf,IAAIo3B,EAAI91B,EAAEuI,aAAaiC,EAAU,CAG7BH,SAAUrK,EAAE2b,kBAGZxR,KAAMjI,EAKN5D,WAAYmG,EAAIzH,QAAQsB,WACxB0M,cAAerG,EACf2F,OAAO,EACPL,QAAO,IAEX6rB,EAAEvX,MAAM9Z,GAER/F,IAAI+qB,EAAMpsB,EAAEoK,QAAQyC,OAAO,MAAO,uBAC9BoO,EAAIjb,EAAEoK,QAAQyC,OAAO,UACzBoO,EAAE5S,MAAQ,eACV4S,EAAEnM,OAAS3B,EAAS,GAAG5D,cAAc,8BAA8BwF,UACnEkM,EAAEzX,aAAa,UAAU,iCACzB4oB,EAAIjoB,YAAY8W,GAGhB3T,EAAMsH,mBAAqBzB,EAAStJ,OACpCyD,EAAMiX,UAAU6N,EAAKsM,GAAcC,UAAU/X,GAC7CtZ,EAAMZ,GAAG,aAAc,WACnBU,EAAIS,YAAY4wB,KAEpBA,EAAE5qB,sBAAsB,CAACjK,EAAG,EAAG6K,MAAOnH,EAAMsxB,SAhG1CC,CAAqBvxB,EAAM4F,eAAgBjL,EAAEwI,WAE9CqM,MAAM,IACPP,QAAQC,IAAI,2CAA6CO,EAAI+hB,WA3D/D,IAAIl0B,EAAO3C,EAAE4H,OAAO1H,UAChBiF,EAAMhH,KAAKY,KACXqD,EAAMiD,EAAMiB,QAAQlE,IACpBf,EAAW8D,EAAIzH,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EACvDoB,EAAYyC,EAAMR,WAClB4xB,EAAe,CAACla,WAAW,EAAOua,SAAS,EAAMC,UAA8B,GAAlB5xB,EAAI+Y,UAAUzc,EAAW,IAOtFu1B,EAAe50B,EAAI60B,cAAcj3B,EAAEwI,OAAQ7F,GAC3Cu0B,EAAqBF,EAAa9d,SAAS7X,GAAUgW,QACrD8f,EAAa,IAAIp5B,EAAEq5B,OAAOJ,EAAa9d,SAAS7X,GAAUgW,QAAQ9I,WAAWlN,GAC7E21B,EAAa9d,SAAS7X,GAAUg2B,OAAO9oB,WAAWlN,IAElDoB,EAAQtE,KAAKY,KAAK2zB,QAAQ1yB,EAAEwI,QAC5B4F,EAAQjQ,KAAKY,KAAKrB,QAAQ0E,IAAIgM,MAAMjQ,KAAKY,KAAKmB,WAC9CiuB,EAAYhwB,KAAKY,KAAKrB,QAAQ0E,IAAImV,eAAeC,YAAY/U,EAAM2L,GACnE5E,EAAYnE,EAAM6oB,kBAAkBC,GA2C1C,IAAI/uB,IAAIuC,EAAI,EAAGA,EAAI6H,EAAU5H,OAAQD,IAAI,CAEvC,IA2CSkU,EA3CL1O,EAAM,GACNkC,EAAWG,EAAU7H,GA0CzB,IAASkU,KAvCT1O,EAAIkC,EAAS2B,MAAMqQ,OAAS2b,EAAax1B,EAAEsxB,UAAaoE,EAAmB11B,EAAIH,EAC/E8F,EAAIkC,EAAS2B,MAAMuQ,OAASyb,EAAav1B,EAAEqxB,UAAaoE,EAAmBz1B,EAAIJ,EAG/E8F,EAAIkC,EAAS2B,MAAMsQ,MAASnW,EAAI+Y,UAAUhF,SAAS,GAAI1X,EAAEsxB,UACzD3rB,EAAIkC,EAAS2B,MAAMwQ,MAASrW,EAAI+Y,UAAUhF,SAAS,GAAIzX,EAAEqxB,UAEzD3rB,EAAIkC,EAAS2B,MAAMyP,WAAarY,EAAImxB,cAAcyD,EAAcr0B,GAAM6tB,IACtErpB,EAAIkC,EAAS2B,MAAM+P,UAAY3Y,EAAImxB,cAAcyD,EAAcr0B,GAAM8tB,IACrEtpB,EAAIkC,EAAS2B,MAAM4P,YAAcxY,EAAImxB,cAAcyD,EAAa9mB,IAAI,CAAC,EAAE,IAAKvN,GAAM6tB,IAClFrpB,EAAIkC,EAAS2B,MAAMkQ,aAAe9Y,EAAImxB,cAAcyD,EAAa9mB,IAAI,CAAC,EAAE,IAAKvN,GAAM8tB,IAEnFtpB,EAAIkC,EAAS2B,MAAMssB,QAAUJ,EAAmB11B,EAChD2F,EAAIkC,EAAS2B,MAAM1H,KAAO4zB,EAAmBz1B,EAC7C0F,EAAIkC,EAAS2B,MAAMxJ,GAAKw1B,EAAax1B,EAAEsxB,UACvC3rB,EAAIkC,EAAS2B,MAAMvJ,GAAKu1B,EAAav1B,EAAEqxB,UAKvC3rB,EAAIkC,EAAS2B,MAAMiL,SAAY4f,EAAUmB,GAAcx1B,EACvD2F,EAAIkC,EAAS2B,MAAMqL,UAAYwf,EAAUmB,GAAcv1B,EACvD0F,EAAIkC,EAAS2B,MAAMusB,WAAczB,EAAUkB,GAAcxG,IACzDrpB,EAAIkC,EAAS2B,MAAMwsB,UAAY1B,EAAUkB,GAAcvG,IACvDtpB,EAAIkC,EAAS2B,MAAMrI,MAAQA,EAC3BwE,EAAIkC,EAAS2B,MAAMlJ,OAASqD,EAAI+Y,UAAU1c,EAC1C2F,EAAIkC,EAAS2B,MAAMjJ,QAAUoD,EAAI+Y,UAAUzc,EAE3C0F,EAAIkC,EAAS2B,MAAMoQ,WAAaya,EAAUmB,EAAa9mB,IAAI/K,EAAI+Y,UAAUhF,SAAS,KAAKzX,EACvF0F,EAAIkC,EAAS2B,MAAM2P,SAAWkb,EAAUmB,EAAaxoB,SAASrJ,EAAI+Y,UAAUhF,SAAS,KAAK1X,EAC1F2F,EAAIkC,EAAS2B,MAAMiQ,QAAU4a,EAAUmB,EAAaxoB,SAASrJ,EAAI+Y,UAAUhF,SAAS,KAAKzX,EACzF0F,EAAIkC,EAAS2B,MAAM8P,UAAY+a,EAAUmB,EAAa9mB,IAAI/K,EAAI+Y,UAAUhF,SAAS,KAAK1X,EAEtF2F,EAAIkC,EAAS2B,MAAMmQ,YAAc0a,EAAUsB,EAAW53B,KAAKkC,EAC3D0F,EAAIkC,EAAS2B,MAAM0P,UAAYmb,EAAUsB,EAAW73B,KAAKkC,EACzD2F,EAAIkC,EAAS2B,MAAMgQ,SAAW6a,EAAUsB,EAAW73B,KAAKmC,EACxD0F,EAAIkC,EAAS2B,MAAM6P,WAAagb,EAAUsB,EAAW53B,KAAKiC,EAG5C6H,EAAS2B,MACf,CAAC,OAAO,OAAO,QAAQ,QAAQ,MAAM,MAAM,IAAI,IAAI,UAAU,WAAW,YAAY,WAAW,QAAQ,SAAS,OAAO,UAAU,WAAW,UAAU,YAAY,WAAW,YAAY,UAAU,aAAa,WAAW,cAAc,YAAY,cAAcwL,QAAQX,GAAK,IAChR1O,EAAI0O,GAAKxM,EAAS2B,MAAM6K,IAI7BxM,EAASsJ,aAAaiD,SAASuY,IAEhC4H,EAAc1sB,EAAUlC,EADTxF,IAAO6H,EAAU5H,OAAS,OAqD7C61B,EAAc15B,EAAEg3B,QAAQ92B,OAAO,CACjCy5B,YAAa35B,EAAE+Y,QAAQ6gB,UAAY,gBAAkB55B,EAAE+Y,QAAQ8gB,QAAU,cAAgB,aAEzF15B,WAAY,SAAUiH,GACpBpH,EAAEg3B,QAAQv1B,UAAUtB,WAAWuB,KAAKtB,KAAMgH,GAC1ChH,KAAK05B,YAAc,EACnB15B,KAAK25B,gBAAkB,CAAC,EAAG,GAC3B35B,KAAK45B,UAAW,EAEhB55B,KAAK65B,OAAS,CACZ,CACEvjB,KAAM/T,EAAEhD,QAAQgzB,OAAOuH,OAAS,+BAChCC,SAAS/5B,KAAKg6B,SAEhB,CACE1jB,KAAM/T,EAAEhD,QAAQgzB,OAAO0H,UAAY,gCACnCF,SAAS/5B,KAAKk6B,YAEhB,CACE5jB,KAAM/T,EAAEhD,QAAQgzB,OAAO4H,SAAW,uBAClCJ,SAAS/5B,KAAKo6B,SAEhB,CACE9jB,KAAM/T,EAAEhD,QAAQgzB,OAAO8H,cAAgB,kBACvCN,SAAS/5B,KAAKs6B,mBAEhB,CACEC,OAAO,KAET,CACEjkB,KAAM/T,EAAEhD,QAAQgzB,OAAOiI,aAAe,+BACtCT,SAAS/5B,KAAKy6B,YACdC,cAAa,EACbrsB,OAAM,EACNssB,QAAQ,CACN,CACErkB,KAAM/T,EAAEhD,QAAQgzB,OAAOqI,YACvBb,SAAS/5B,KAAK66B,YAEhB,CACEvkB,KAAM/T,EAAEhD,QAAQgzB,OAAOuI,aACvBf,SAAS/5B,KAAK+6B,aAEhB,CACEzkB,KAAM/T,EAAEhD,QAAQgzB,OAAOyI,eACvBjB,SAAS/5B,KAAKi7B,iBAIpB,CACE3kB,KAAM/T,EAAEhD,QAAQgzB,OAAO2I,aAAe,kBACtCnB,SAAS/5B,KAAKm7B,QAEhB,CACEZ,OAAO,KAET,CACEjkB,KAAM/T,EAAEhD,QAAQgzB,OAAO6I,iBAAmB,kBAC1CrB,SAAS/5B,KAAK8uB,iBACR,CACNxY,KAAM/T,EAAEhD,QAAQgzB,OAAO8I,cAAgB,kBACvCtB,SAAS/5B,KAAKs7B,cAEhB,CACEhlB,KAAM/T,EAAEhD,QAAQgzB,OAAOgJ,aAAe,kBACtCxB,SAAS/5B,KAAKw7B,cAMlBx7B,KAAKy7B,SAAWl5B,EAAEhD,QAAQm8B,eAC1B17B,KAAK27B,SAAWp5B,EAAEhD,QAAQq8B,eAC1B57B,KAAK67B,YAAc,CACjB,CACEvlB,KAAM/T,EAAEhD,QAAQgzB,OAAOuJ,cAAgB,kBACvC/B,SAAS/5B,KAAK+7B,cAEhB,CACEzlB,KAAM/T,EAAEhD,QAAQgzB,OAAOyJ,YAAc,kBACrCjC,SAAS/5B,KAAKi8B,aAGlBj8B,KAAKk8B,iBAAkB,EACvBl8B,KAAKm8B,gBAAiB,EAEtBn8B,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,oBAAqBzF,EAAIN,YACnE1G,KAAK0G,WAAWtD,aAAa,SAAU,IAEvC,IAAKnC,IAAIuC,EAAI,EAAGA,EAAI,EAAGA,IACrBxD,KAAK65B,OAAOr2B,GAAG+b,GAAKvf,KAAKo8B,YAAYp8B,KAAK0G,WAAY1G,KAAK65B,OAAOr2B,IAGpExD,KAAKq8B,WAAaz8B,EAAEoK,QAAQyC,OAAO,MAAO,kCAAmCzM,KAAK0G,YAClF1G,KAAKq8B,WAAW3oB,GAAK,qBACrB1T,KAAKq8B,WAAWj5B,aAAa,SAAU,IAEvCpD,KAAKs8B,YAAc,KAEnB,IAAIr7B,IAAIuC,EAAG,EAAEA,EAAExD,KAAK65B,OAAO,GAAGc,QAAQl3B,OAAOD,IAC3CxD,KAAKo8B,YAAYp8B,KAAKq8B,WAAWr8B,KAAK65B,OAAO,GAAGc,QAAQn3B,GAAGA,GAG7DxD,KAAK65B,OAAO,GAAGta,GAAKvf,KAAKo8B,YAAYp8B,KAAK0G,WAAY1G,KAAK65B,OAAO,IAClE75B,KAAK65B,OAAO,GAAGta,GAAKvf,KAAKo8B,YAAYp8B,KAAK0G,WAAY1G,KAAK65B,OAAO,IAClE75B,KAAK65B,OAAO,GAAGta,GAAKvf,KAAKo8B,YAAYp8B,KAAK0G,WAAY1G,KAAK65B,OAAO,IAClE75B,KAAK65B,OAAO,GAAGta,GAAKvf,KAAKo8B,YAAYp8B,KAAK0G,WAAY1G,KAAK65B,OAAO,IAClE75B,KAAK65B,OAAO,IAAIta,GAAKvf,KAAKo8B,YAAYp8B,KAAK0G,WAAY1G,KAAK65B,OAAO,KAEnE75B,KAAK8J,WAAalK,EAAEoK,QAAQyC,OAAO,MAAO,qCAAsCzF,EAAIN,YACpF1G,KAAK8J,WAAW1G,aAAa,SAAU,IACvC,IAAKnC,IAAIuC,EAAI,EAAGA,EAAIxD,KAAK67B,YAAYp4B,OAAQD,IAC3CxD,KAAKo8B,YAAYp8B,KAAK8J,WAAY9J,KAAK67B,YAAYr4B,IAGrD5D,EAAE4G,SACCF,GAAGtG,KAAK0G,WAAY,QAAS9G,EAAE4G,SAASigB,MACxCngB,GAAGtG,KAAK0G,WAAY,YAAa9G,EAAE4G,SAASigB,MAC5CngB,GAAGtG,KAAK0G,WAAY,WAAY9G,EAAE4G,SAASigB,MAC3CngB,GAAGtG,KAAK0G,WAAY,cAAe9G,EAAE4G,SAASigB,MAC9CngB,GAAGtG,KAAK8J,WAAY,QAASlK,EAAE4G,SAASigB,MACxCngB,GAAGtG,KAAK8J,WAAY,YAAalK,EAAE4G,SAASigB,MAC5CngB,GAAGtG,KAAK8J,WAAY,WAAYlK,EAAE4G,SAASigB,MAC3CngB,GAAGtG,KAAK8J,WAAY,cAAelK,EAAE4G,SAASigB,MAEjDzmB,KAAK2rB,EAAI3oB,SAASC,cAAc,YAChCjD,KAAK2rB,EAAEhd;;;;;;;;;;;uBAeTkoB,SAAU,WACR,IAAIpyB,EAAYzE,KAAKY,KAAK27B,eAE1B38B,EAAE4G,SACCF,GAAG7B,EAAW,aAAczE,KAAKw8B,MAAOx8B,MACxCsG,GAAGtD,SAAU,UAAWhD,KAAKy8B,WAAYz8B,MAExCJ,EAAE+Y,QAAQ+jB,OACZ98B,EAAE4G,SAASF,GAAGtD,SAAUhD,KAAKu5B,YAAav5B,KAAKw8B,MAAOx8B,MAGxDA,KAAKY,KAAK0F,GAAG,CACXq2B,YAAa38B,KAAK48B,MAClBC,UAAW78B,KAAKw8B,MAChBvgB,UAAWjc,KAAKw8B,OACfx8B,OAGLg3B,YAAa,WACX,IAAIvyB,EAAYzE,KAAKY,KAAK27B,eAE1B38B,EAAE4G,SACCS,IAAIxC,EAAW,aAAczE,KAAKw8B,MAAOx8B,MACzCiH,IAAIjE,SAAU,UAAWhD,KAAKy8B,WAAYz8B,MAEzCJ,EAAE+Y,QAAQ+jB,OACZ98B,EAAE4G,SAASS,IAAIjE,SAAUhD,KAAKu5B,YAAav5B,KAAKw8B,MAAOx8B,MAGzDA,KAAKY,KAAKqG,IAAI,CACZ01B,YAAa38B,KAAK48B,MAClBC,UAAW78B,KAAKw8B,MAChBvgB,UAAWjc,KAAKw8B,OACfx8B,OAGL88B,UAAW,WACL98B,KAAKy7B,WAAal5B,EAAEhD,QAAQm8B,gBAAkB17B,KAAK27B,WAAap5B,EAAEhD,QAAQq8B,iBAC5E57B,KAAKy7B,SAAWl5B,EAAEhD,QAAQm8B,eAC1B17B,KAAK27B,SAAWp5B,EAAEhD,QAAQq8B,iBAI9Bb,YAAa,SAAUl5B,GACrBZ,IAAI8d,GAAUld,aAAak7B,cAAgB/8B,KAAKY,KAAmBZ,MAAd6J,YACjDmzB,EAAQje,EAAQ0c,SAAU1c,EAAQ0c,SAASvhB,cAAgB,OAC3D2X,GAAKhwB,aAAak7B,cAAe/8B,KAA6BA,KAAKT,QAAQkH,OAArC6a,OAAOwQ,QAAQkL,GACrDhL,GAAKnwB,aAAak7B,cAAe/8B,KAAiCA,KAAKT,QAAQkH,OAAzC6a,OAAO2Q,YAAY+K,GACzDC,EAAO,GAIO,SAAVD,EACFC,uDAA4Dh4B,KAAKsL,MAAMshB,EAAG1X,kCAAkClV,KAAKsL,MAAMshB,EAAGtX,mCAAmCtV,KAAKsL,MAAMyhB,EAAG7X,sCAAsClV,KAAKsL,MAAMyhB,EAAGzX,yBAC5M,SAAVyiB,EACTC,yDAA8DpL,EAAG1X,iCAAiC0X,EAAGtX,oCAAoCyX,EAAG7X,qCAAqC6X,EAAGzX,wBACjK,SAAVyiB,EACTC,iDAAsDpL,EAAG,GAAG1X,0BAA0B0X,EAAG,GAAGtX,4BAA4ByX,EAAGA,EAAGvuB,OAAS,GAAG0W,8BAA8B6X,EAAGA,EAAGvuB,OAAS,GAAG8W,wBACvK,eAAVyiB,EACTC,sDAA2DpL,EAAG,GAAG1X,4BAA4B0X,EAAG,GAAGtX,iCAAiCyX,EAAGA,EAAGvuB,OAAS,GAAG0W,gCAAgC6X,EAAGA,EAAGvuB,OAAS,GAAG8W,wBAExMpE,QAAQC,IAAI,eAIlB2I,EAAQme,UAAUD,IAGpBlB,aAAc,SAAUl6B,GACtBZ,IAAI8d,GAAUld,aAAak7B,cAAgB/8B,KAAKY,KAAmBZ,MAAd6J,YACrDkV,EAAQoe,cAAcj2B,MAAMY,SAAS8qB,UAGvCqJ,WAAY,SAAUp6B,GACpBZ,IAAI8d,GAAUld,aAAak7B,cAAgB/8B,KAAKY,KAAmBZ,MAAd6J,YACnDuzB,EAAYre,EAAQoe,cAAcj2B,MAAMY,SAC1CiX,EAAQme,UAAUE,EAAUC,iBAG9BnD,WAAY,SAASr4B,GACnBZ,IAAIwF,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACzDA,EAAM62B,WAGRtD,QAAS,SAASn4B,GAChBZ,IAAIwF,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACzDA,EAAM82B,QAGRnD,QAAS,SAASv4B,GAChBZ,IAAIwF,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACzDA,EAAM+2B,UAGRlD,kBAAmB,SAASz4B,GAC1BZ,IAAIwF,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACzDA,EAAM6zB,qBAGRxL,gBAAiB,SAASjtB,GACxBZ,IAAIwF,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACrDA,EAAM+gB,SACR/gB,EAAM+gB,UAAW,EAEjB/gB,EAAM+gB,UAAW,GAIrBqT,WAAY,SAASh5B,GACnBZ,IAAI8d,GAAUld,aAAak7B,cAAgB/8B,KAAKY,KAAmBZ,MAAd6J,YACnDpD,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACvDsY,EAAQme,UAAUz2B,EAAM6lB,UAAUmR,QAAQ,6GAA8G,MAI1JtC,OAAQ,SAASt5B,IACDA,aAAak7B,cAAgB/8B,KAAKY,KAAmBZ,MAAd6J,YAArD5I,IACEwF,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACvDi3B,UAAUC,UACPC,WACA9nB,KACG,IACEvT,EAAEs7B,YAAYp3B,EAAOS,MAK/Bs0B,YAAa,SAAS35B,GACpBZ,IAAIwF,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACzDA,EAAMq3B,cAGRxC,aAAc,SAASz5B,GACrBZ,IAAIwF,GAAQ5E,aAAak7B,cAAc/8B,KAAKY,KAAmBZ,MAAdT,QAAQkH,MACzDA,EAAMs3B,eAGRtD,YAAa,SAAS54B,GACpBZ,IAAI+8B,EAAYh+B,KAAK6J,aAA6B7J,KAClDg+B,EAAUC,eAAep8B,IAG3Bq7B,UAAW,SAASD,GAClB,MAAM1d,EAAKvc,SAASC,cAAc,YAClCsc,EAAGxa,MAAQk4B,EACXj6B,SAAS4kB,KAAK7jB,YAAYwb,GAC1BA,EAAGtF,SACHjX,SAASk7B,YAAY,QACrBl7B,SAAS4kB,KAAK3U,YAAYsM,IAG5B0b,cAAe,SAASp5B,GACtB,MAAMs8B,EAAOn+B,KAAK6J,YAClB,OAAOs0B,EAAKxC,SAASzhB,eACnB,IAAK,OAAQikB,EAAKC,UAAU98B,KAAKtB,KAAM6B,GAAI,MAC3C,IAAK,aAAcs8B,EAAKE,gBAAgB/8B,KAAKtB,KAAM6B,GAAI,MACvD,IAAK,MAAOs8B,EAAKG,SAASh9B,KAAKtB,KAAM6B,GAAI,MACzC,IAAK,OAAQs8B,EAAKI,UAAUj9B,KAAKtB,KAAM6B,GAAI,MAC3C,IAAK,OAAQs8B,EAAKK,UAAUl9B,KAAKtB,KAAM6B,GAAI,MAE3C,QACEs8B,EAAKM,UAAUn9B,KAAKtB,KAAM6B,KAKhC48B,UAAW,SAAS58B,GAClBZ,IAAIwF,EAAQzG,KAAKT,QAAQkH,MACrBi4B,EAAQ1+B,KAAK6J,YAAYyyB,YACzBz7B,EAAa4F,EAAM5F,WACnBkN,EAAU/N,KAAK6J,YAAY8hB,EAAE7c,QAAQkb,kBAAkBtY,WAAU,GACjEitB,EAAW5wB,EAAQ5E,cAAc,sBACjCy1B,EAAK7wB,EAAQ5E,cAAc,MAC3B6iB,EAAMje,EAAQ5E,cAAc,OAC5BivB,EAAOrqB,EAAQ5E,cAAc,gBAC7BxG,EAASoL,EAAQ5E,cAAc,mBAEnC4E,EAAQ3K,aAAa,OAAQqD,EAAMjC,MACnC4zB,EAAKh1B,aAAa,KAAK,QACvBu7B,EAAQrQ,sBAAwBztB,kBAChC+9B,EAAGtQ,sBAAwBztB,kBAC3BmrB,EAAIsC,YAAiBoQ,EAAMr0B,OAAOgoB,IAAIsC,QAAQ,GAA5B,IAAkC+J,EAAMr0B,OAAOioB,IAAIqC,QAAQ,GAC7EhyB,EAAO2rB,YAAiBoQ,EAAMr0B,OAAOgoB,IAAIsC,QAAQ,GAA5B,IAAkC+J,EAAMr0B,OAAOioB,IAAIqC,QAAQ,GAChF30B,KAAK6J,YAAYqzB,UAAUnvB,EAAQue,YAGrCiS,UAAW,SAAS18B,GAClBZ,IAAIwF,EAAQzG,KAAKT,QAAQkH,MACrBi4B,EAAQ1+B,KAAK6J,YAAYyyB,YACzBh4B,EAAQmC,EAAM7F,KAAK2zB,QAAQmK,EAAMr0B,QACjCw0B,EAAQv6B,EAAMjB,EAAEsxB,UAAhBkK,EAA4Bv6B,EAAMhB,EAAEqxB,UACpC9zB,EAAa4F,EAAM5F,WACnBkN,EAAU/N,KAAK6J,YAAY8hB,EAAE7c,QAAQkb,kBAAkBtY,WAAU,GACjEitB,EAAW5wB,EAAQ5E,cAAc,sBACjCy1B,EAAK7wB,EAAQ5E,cAAc,MAC3B6iB,EAAMje,EAAQ5E,cAAc,OAC5BivB,EAAOrqB,EAAQ5E,cAAc,gBAC7BxG,EAASoL,EAAQ5E,cAAc,mBAEnC4E,EAAQ3K,aAAa,OAAQqD,EAAMjC,MACnC4zB,EAAKh1B,aAAa,KAAK,QACvBu7B,EAAQrQ,sBAAwBztB,kBAChC+9B,EAAGtQ,sBAAwBztB,kBAC3BmrB,EAAIsC,YAAiBuQ,EAAH,IAAWA,EAC7Bl8B,EAAO2rB,YAAiBuQ,EAAH,IAAWA,EAChC7+B,KAAK6J,YAAYqzB,UAAUnvB,EAAQue,YAGrC+R,gBAAiB,SAASx8B,GACxBZ,IAAIwF,EAAQzG,KAAKT,QAAQkH,MACrBi4B,EAAQ1+B,KAAK6J,YAAYyyB,YACzBh4B,EAAQmC,EAAM7F,KAAK2zB,QAAQmK,EAAMr0B,QACjCnH,EAAWuD,EAAM7F,KAAKrB,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EAC9DxC,EAAa4F,EAAM5F,WACnBkN,EAAU/N,KAAK6J,YAAY8hB,EAAE7c,QAAQkb,kBAAkBtY,WAAU,GACjEitB,EAAW5wB,EAAQ5E,cAAc,sBACjCy1B,EAAK7wB,EAAQ5E,cAAc,MAC3B6iB,EAAMje,EAAQ5E,cAAc,OAC5BivB,EAAOrqB,EAAQ5E,cAAc,gBAC7BxG,EAASoL,EAAQ5E,cAAc,mBAEnC4E,EAAQ3K,aAAa,OAAQqD,EAAMjC,MACnC4zB,EAAKh1B,aAAa,KAAK,QACvBu7B,EAAQrQ,sBAAwBztB,8CAChC+9B,EAAGtQ,sBAAwBztB,8CAC3BmrB,EAAIsC,YAAiBrpB,KAAKyvB,MAAMpwB,EAAMjB,EAAEH,GAAtB,IAAmC+B,KAAKyvB,MAAMpwB,EAAMhB,EAAEJ,GACxEP,EAAO2rB,YAAiBoQ,EAAMr0B,OAAOgoB,IAAIsC,QAAQ,GAA5B,IAAkC+J,EAAMr0B,OAAOioB,IAAIqC,QAAQ,GAChF30B,KAAK6J,YAAYqzB,UAAUnvB,EAAQue,YAGrCkS,UAAW,SAAS38B,GAClBZ,IAAIwF,EAAQzG,KAAKT,QAAQkH,MACrBi4B,EAAQ1+B,KAAK6J,YAAYyyB,YACzBh4B,EAAQmC,EAAM7F,KAAK2zB,QAAQmK,EAAMr0B,QACjC4F,EAAQxJ,EAAM7F,KAAKrB,QAAQ0E,IAAIgM,OAAOxJ,EAAMjC,MAC5CqT,EAAOpR,EAAM7F,KAAKrB,QAAQ0E,IAAImV,eAAeC,YAAY/U,EAAM2L,GAAOM,QACtE1P,EAAa4F,EAAM5F,WACnBkN,EAAU/N,KAAK6J,YAAY8hB,EAAE7c,QAAQkb,kBAAkBtY,WAAU,GACjEitB,EAAW5wB,EAAQ5E,cAAc,sBACjCy1B,EAAK7wB,EAAQ5E,cAAc,MAC3B6iB,EAAMje,EAAQ5E,cAAc,OAC5BivB,EAAOrqB,EAAQ5E,cAAc,gBAC7BxG,EAASoL,EAAQ5E,cAAc,mBAEnC4E,EAAQ3K,aAAa,OAAQqD,EAAMjC,MACnC4zB,EAAKh1B,aAAa,KAAK,QACvBu7B,EAAQrQ,sBAAwBztB,kBAChC+9B,EAAGtQ,sBAAwBztB,kBAC3BmrB,EAAIsC,YAAiBzW,EAAKxU,EAAR,IAAawU,EAAKvU,EACpCX,EAAO2rB,YAAiBzW,EAAKxU,EAAR,IAAawU,EAAKvU,EACvCtD,KAAK6J,YAAYqzB,UAAUnvB,EAAQue,YAGrC8R,UAAW,SAASv8B,GAClBZ,IAAIwF,EAAQzG,KAAKT,QAAQkH,MACrBi4B,EAAQ1+B,KAAK6J,YAAYyyB,YAKzBh4B,EAAQmC,EAAM7F,KAAK2zB,QAAQmK,EAAMr0B,QACjCnH,EAAWuD,EAAM7F,KAAKrB,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EAC9Dy7B,EAASx6B,EAAMjB,EAAIH,EAAU67B,EAASz6B,EAAMhB,EAAIJ,EAChD27B,EAAKj/B,EAAE0E,MAAMw6B,EAAOC,GAAQrK,QAC5B7zB,EAAa4F,EAAM5F,WACnBkN,EAAU/N,KAAK6J,YAAY8hB,EAAE7c,QAAQkb,kBAAkBtY,WAAU,GACjEitB,EAAW5wB,EAAQ5E,cAAc,sBACjCy1B,EAAK7wB,EAAQ5E,cAAc,MAC3B6iB,EAAMje,EAAQ5E,cAAc,OAC5BivB,EAAOrqB,EAAQ5E,cAAc,gBAC7BxG,EAASoL,EAAQ5E,cAAc,mBAEhC01B,EAAGx7B,EAAI,IAAGw7B,EAAGx7B,GAAKH,GAClB27B,EAAGv7B,EAAI,IAAGu7B,EAAGv7B,GAAKJ,GAErB6K,EAAQ3K,aAAa,OAAQqD,EAAMjC,MACnC4zB,EAAKh1B,aAAa,KAAK,QACvBu7B,EAAQrQ,sBAAwBztB,wCAChC+9B,EAAGtQ,sBAAwBztB,wCAC3BmrB,EAAIsC,YAAiBuQ,EAAGx7B,EAAN,IAAWw7B,EAAGv7B,EAChCX,EAAO2rB,YAAiBoQ,EAAMr0B,OAAOgoB,IAAIsC,QAAQ,GAA5B,IAAkC+J,EAAMr0B,OAAOioB,IAAIqC,QAAQ,GAChF30B,KAAK6J,YAAYqzB,UAAUnvB,EAAQue,YAGrCgS,SAAU,SAASz8B,GACjBZ,IAAIwF,EAAQzG,KAAKT,QAAQkH,MACrBi4B,EAAQ1+B,KAAK6J,YAAYyyB,YACzB0C,EAAQN,EAAMn0B,eAAemqB,QAC7B7zB,EAAa4F,EAAM5F,WACnBkN,EAAU/N,KAAK6J,YAAY8hB,EAAE7c,QAAQkb,kBAAkBtY,WAAU,GACjEitB,EAAW5wB,EAAQ5E,cAAc,sBACjCy1B,EAAK7wB,EAAQ5E,cAAc,MAC3B6iB,EAAMje,EAAQ5E,cAAc,OAC5BivB,EAAOrqB,EAAQ5E,cAAc,gBAC7BxG,EAASoL,EAAQ5E,cAAc,mBAEnC4E,EAAQ3K,aAAa,OAAQqD,EAAMjC,MACnC4zB,EAAKh1B,aAAa,KAAK,QACvBu7B,EAAQrQ,sBAAwBztB,uCAChC+9B,EAAGtQ,sBAAwBztB,uCAC3BmrB,EAAIsC,YAAiB0Q,EAAM37B,EAAT,IAAc27B,EAAM17B,EACtCX,EAAO2rB,YAAiBoQ,EAAMr0B,OAAOgoB,IAAIsC,QAAQ,GAA5B,IAAkC+J,EAAMr0B,OAAOioB,IAAIqC,QAAQ,GAChF30B,KAAK6J,YAAYqzB,UAAUnvB,EAAQue,YAGrC2S,eAAgB,SAASp9B,GACvBZ,IAAIwF,EAAQzG,KAAKT,QAAQkH,MACzBi4B,EAAQ1+B,KAAK6J,YAAYyyB,YACzBh4B,EAAQmC,EAAM7F,KAAK2zB,QAAQmK,EAAMr0B,QACjCnH,EAAWuD,EAAM7F,KAAKrB,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EAC9Dy7B,EAASx6B,EAAMjB,EAAIH,EAAU67B,EAASz6B,EAAMhB,EAAIJ,EAChD+M,EAAQxJ,EAAM7F,KAAKrB,QAAQ0E,IAAIgM,OAAOxJ,EAAMjC,MAC5CqT,EAAOpR,EAAM7F,KAAKrB,QAAQ0E,IAAImV,eAAeC,YAAY/U,EAAM2L,GAC/DhP,IAAIi+B,OAAez4B,EAAMjC;EACzB06B,cAAsBj6B,KAAKyvB,MAAMoK,SAAc75B,KAAKyvB,MAAMqK;EAC1DG,yBAAiCj6B,KAAKyvB,MAAMpwB,EAAMjB,EAAEH,WAAkB+B,KAAKyvB,MAAMpwB,EAAMhB,EAAEJ;EACzFg8B,aAAqBj6B,KAAKyvB,MAAMgK,EAAMn0B,eAAelH,SAAS4B,KAAKyvB,MAAMgK,EAAMn0B,eAAejH;EAC9F47B,cAAsBj6B,KAAKyvB,MAAMpwB,EAAMjB,SAAS4B,KAAKyvB,MAAMpwB,EAAMhB;EACjE47B,oBAA4BrnB,EAAKxU,EAAEsxB,QAAQ,gBAAgB9c,EAAKvU,EAAEqxB,QAAQ;EAC1EuK,iBAAyBR,EAAMr0B,OAAOgoB,IAAIsC,QAAQ,WAAW+J,EAAMr0B,OAAOioB,IAAIqC,QAAQ,GACtF30B,KAAK6J,YAAYqzB,UAAUgC,IAG7B9C,YAAa,SAAU33B,EAAWlF,EAAS4/B,GACzC,GAAI5/B,EAAQg7B,OACV,OAAOv6B,KAAKo/B,iBAAiB36B,EAAW06B,GAItC5f,EAAKvf,KAAKq/B,iBAAiB,SADjB,yBACoC56B,EAAW06B,GACzDpF,EAAW/5B,KAAKs/B,oBAAoB/f,EAAIhgB,EAAQw6B,SAAUx6B,EAAQwf,QAASxf,EAAQm7B,cA2BvF,OAxBAnb,EAAG5Q,UAFQ,GAEWpP,EAAQ+W,KAC9BiJ,EAAGnc,aAAa,OAAQ,UACxBmc,EAAG3N,UAAUG,IAAI,gBACdxS,EAAQ8O,QACTkR,EAAGnc,aAAa,gBAAiB,QACjCmc,EAAGnc,aAAa,gBAAiB,SACjCmc,EAAGnc,aAAa,gBAAiB,uBAGnCxD,EAAE4G,SACCF,GAAGiZ,EAAI,YAAavf,KAAKu/B,iBAAkBv/B,MAC3CsG,GAAGiZ,EAAI,WAAYvf,KAAKw/B,gBAAiBx/B,MACzCsG,GAAGiZ,EAAI,YAAa3f,EAAE4G,SAAS0d,iBAC/B5d,GAAGiZ,EAAI,QAASwa,GAEfn6B,EAAE+Y,QAAQ+jB,OACZ98B,EAAE4G,SAASF,GAAGiZ,EAAIvf,KAAKu5B,YAAa35B,EAAE4G,SAAS0d,iBAI5CtkB,EAAE+Y,QAAQ8gB,SACb75B,EAAE4G,SAASF,GAAGiZ,EAAI,QAASvf,KAAKw/B,gBAAiBx/B,MAG5C,CACL0T,GAAI9T,EAAEgT,KAAKvJ,MAAMkW,GACjBA,GAAIA,EACJwa,SAAUA,IAIdqF,iBAAkB,SAAU36B,EAAW06B,GACjC5f,EAAKvf,KAAKq/B,iBAAiB,MAAO,8BAA+B56B,EAAW06B,GAEhF,MAAO,CACLzrB,GAAI9T,EAAEgT,KAAKvJ,MAAMkW,GACjBA,GAAIA,IAIR+f,oBAAqB,SAAU/f,EAAIkgB,EAAM1gB,EAAS2b,GAChDz5B,IAAIqd,EAASte,KAIb,OAFA06B,OAAiChd,IAAjBgd,GAA8BA,EAEvC,SAAU74B,GACfZ,IAAI+F,EAAMsX,EAAO1d,KACf2J,EAAiB+T,EAAOohB,cAAcn1B,eACtC+sB,EAAatwB,EAAI24B,2BAA2Bp1B,GAC5CF,EAASrD,EAAI44B,mBAAmBtI,GAChC3tB,EAAgB2U,EAAOohB,cAAc/1B,cACrCszB,EAAO,CACL1yB,eAAgBA,EAChB+sB,WAAYA,EACZjtB,OAAQA,EACRV,cAAeA,GAGf+wB,GACFpc,EAAOke,QAGLiD,GACFA,EAAKn+B,KAAKyd,GAAW/X,EAAKi2B,GAG5B3e,EAAO1d,KAAK8J,KAAK,qBAAsB,CACrCiyB,YAAare,EACbiB,GAAIA,MAKV8f,iBAAkB,SAAU31B,EAASjB,EAAWhE,EAAW06B,GACvDl+B,IAAI4+B,EACAtgB,EAAKvc,SAASC,cAAcyG,GAchC,OAZA6V,EAAG9W,UAAYA,OAEDiV,IAAVyhB,IACAU,EAAQp7B,EAAUiE,SAASy2B,IAG3BU,EACAp7B,EAAUkkB,aAAapJ,EAAIsgB,GAE3Bp7B,EAAUV,YAAYwb,GAGnBA,GAGXqd,MAAO,SAAU/6B,GACZ7B,KAAKk8B,iBAAiBl8B,KAAKw8B,QAE9Bv7B,IAAIuH,GADJxI,KAAKs8B,YAAcz6B,GACNqI,cAAcT,OAC3B,GAAGjB,EAAKR,QAAQ,YAAY,CAK1B,GAJAQ,EAAOA,EAAKR,QAAQ,YACpBQ,GAA2B,uBAAnBA,EAAKC,UACLD,EAAKR,QAAQ,YAAYuW,WAAWA,WAAWA,WAC/C/V,GAD0DW,cAAc,SAE5EX,EAAKtB,MAAMsc,gBAAiB,OAChCxjB,KAAKm9B,cAAgB30B,EACrBxI,KAAK8J,WAAWtC,gBAAgB,UAChCxH,KAAK8/B,aAAaj+B,EAAE0I,eAAgB1I,EAAG7B,KAAK8J,gBACvC,CAAA,IAEDi2B,GAFIv3B,EAAKoJ,UAAU6F,SAAS,sBAAwBjP,EAAKoJ,UAAU6F,SAAS,uBACjE,SAAjBjP,EAAKkB,WACCq2B,EAAY//B,KAAKY,KAAKrB,QAAQkH,MAAM/G,OACxCM,KAAKm9B,cAAgBjF,MAAM8H,KAAKD,GAAWE,KAAK1gB,GAAMA,EAAG1X,SAEzD7H,KAAK0G,WAAWc,gBAAgB,UAChCxH,KAAK8/B,aAAaj+B,EAAE0I,eAAgB1I,EAAG7B,KAAK0G,YAC5C1G,KAAK88B,aAEuB,IAA3Bj7B,EAAEqI,cAAcg2B,SAA4C,IAA5Br+B,EAAEqI,cAAcg2B,SACjDlgC,KAAKm8B,gBAAiB,EACnBn8B,KAAKm9B,cAAc10B,UAAU0G,SAAS,qBACnCgxB,EAAWn9B,SAASo9B,cACxBpgC,KAAKqgC,gBAAkBF,EAASlyB,WAAWmyB,cAC3CpgC,KAAKsgC,eAAiB,EACtBtgC,KAAK8J,WAAWoE,WAAWtF,SAE3B5I,KAAK0G,WAAWmK,iBAAiB,0BAA0B,GAAGjI,UAMpEk3B,aAAc,SAAUjB,EAAI5B,EAAMx4B,GAC9B,IACQ2yB,EADJp3B,KAAK65B,OAAOp2B,SACR2zB,EAAQx3B,EAAEE,OAAOm9B,GAAQ,GAAI,CAACN,YAAa38B,OAE/CA,KAAK0/B,cAAgB,CACjBn1B,eAAgBs0B,GAGhB5B,GAAQA,EAAKtzB,gBACb3J,KAAK0/B,cAAc/1B,cAAgBszB,EAAKtzB,eAG5C3J,KAAKugC,aAAa1B,EAAGp6B,GAEhBzE,KAAKk8B,kBACRz3B,EAAU+C,gBAAgB,UACxBxH,KAAKk8B,iBAAkB,GAG3Bl8B,KAAKY,KAAK8J,KAAK,mBAAoB0sB,KAI3CoF,MAAO,WACCx8B,KAAKk8B,kBACLl8B,KAAKk8B,iBAAkB,EACvBl8B,KAAK0G,WAAWtD,aAAa,SAAU,IACvCpD,KAAKq8B,WAAWj5B,aAAa,SAAU,IACvCpD,KAAK8J,WAAW1G,aAAa,SAAU,IACvCpD,KAAKY,KAAK8J,KAAK,mBAAoB,CAACiyB,YAAa38B,OACjD2I,WAAW,IAAM3I,KAAKY,KAAK8F,WAAWkC,QAAS,GAC/C5I,KAAK05B,YAAc,EACnB15B,KAAK45B,UAAW,IAIxB2G,aAAc,SAAU1B,EAAIp6B,GACxBxD,IAEIu/B,EAFAxN,EAAUhzB,KAAKY,KAAKmf,UACpB0gB,EAAgBzgC,KAAK0gC,gBAAgBj8B,GAGrCzE,KAAKY,KAAKrB,QAAQohC,oBAClBH,EAAS5gC,EAAE0E,MAAMtE,KAAKY,KAAKrB,QAAQohC,mBACnC9B,EAAKA,EAAG9sB,IAAIyuB,KAGhB/7B,EAAUm8B,aAAe/B,GAElBx7B,EAAIo9B,EAAcp9B,EAAI2vB,EAAQ3vB,GACjCoB,EAAUwD,MAAM8P,KAAO,OACvBtT,EAAUwD,MAAMgQ,MAAQhT,KAAK9D,IAAI8D,KAAK7D,IAAI4xB,EAAQ3vB,EAAIw7B,EAAGx7B,EAAG,GAAI2vB,EAAQ3vB,EAAIo9B,EAAcp9B,EAAI,GAAK,OAEnGoB,EAAUwD,MAAM8P,KAAO9S,KAAK7D,IAAIy9B,EAAGx7B,EAAG,GAAK,KAC3CoB,EAAUwD,MAAMgQ,MAAQ,QAGxB4mB,EAAGv7B,EAAIm9B,EAAcn9B,EAAI0vB,EAAQ1vB,GACjCmB,EAAUwD,MAAMkQ,IAAM,OACtB1T,EAAUwD,MAAMmQ,OAASnT,KAAK9D,IAAI8D,KAAK7D,IAAI4xB,EAAQ1vB,EAAIu7B,EAAGv7B,EAAG,GAAI0vB,EAAQ1vB,EAAIm9B,EAAcn9B,EAAI,GAAK,OAEpGmB,EAAUwD,MAAMkQ,IAAMlT,KAAK7D,IAAIy9B,EAAGv7B,EAAG,GAAK,KAC1CmB,EAAUwD,MAAMmQ,OAAS,SAIjCsoB,gBAAiB,SAAUnhB,GACvBte,IAAI6K,EAAO9L,KAAK0hB,MAgBhB,OAdK5V,IAAQ9L,KAAK6gC,eACd/0B,EAAO,GAEPyT,EAAGtX,MAAM8P,KAAO,YAChBwH,EAAGtX,MAAMgQ,MAAQ,OAEjBnM,EAAKzI,EAAIkc,EAAGuhB,YACZh1B,EAAKxI,EAAIic,EAAGkJ,aAEZlJ,EAAGtX,MAAM8P,KAAO,OAEhB/X,KAAK6gC,cAAe,GAGjB/0B,GAIVi1B,qBAAsB,WACrB/gC,KAAKk8B,iBAAkB,SAChBl8B,KAAKsgC,eACZtgC,KAAK8J,WAAW1G,aAAa,SAAU,KACpCpD,KAAKqgC,iBAGNrgC,KAAKm9B,cAAcvzB,cAAcsE,YAFZtF,eAIhB5I,KAAKqgC,iBAGdW,eAAgB,SAAS7B,GAOvB,GAN0C,OAAtCn8B,SAASo9B,cAAcnyB,aAA2C,IAApBjO,KAAKihC,aAErDjhC,KAAKihC,YAAa,EAElBjhC,KAAK65B,OAAO,GAAGta,GAAGA,GAAG3W,SAEnB5F,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAK65B,OAAOsF,GAAO5f,GAAGA,GAAG5Q,UAAU,CAEnG1N,IAAIigC,EAAO/B,EAAQ,EACnB,KAAOn/B,KAAK65B,OAAOqH,GAAM3hB,GAAGA,GAAGxX,UAC7Bm5B,IACIA,GAAQlhC,KAAK65B,OAAOp2B,SACtBy9B,EAAO,GAGXlhC,KAAKghC,eAAeE,QAEpB,GAAIlhC,KAAK25B,gBAAgBxqB,SAASgwB,GAAQ,CAExCl+B,IAAIkgC,EAAYhC,EAAQ,EACpBiC,EAAYjC,EAAQ,EACxB,KAAOn/B,KAAK25B,gBAAgBxqB,SAASgyB,IAAcnhC,KAAK65B,OAAOsH,GAAW5hB,GAAGA,GAAGxX,UAC9Eo5B,IACIA,GAAanhC,KAAK65B,OAAOp2B,SAC3B09B,EAAY,GAGhB,KAAOnhC,KAAK25B,gBAAgBxqB,SAASiyB,IAAcphC,KAAK65B,OAAOuH,GAAW7hB,GAAGA,GAAGxX,UAC9Eq5B,IACIA,EAAY,IACdA,EAAYphC,KAAK65B,OAAOp2B,OAAS,GAIjCzD,KAAK05B,YAAcyF,EACrBn/B,KAAKghC,eAAeG,GAEpBnhC,KAAKghC,eAAeI,QAItBphC,KAAK65B,OAAOsF,GAAO5f,GAAGA,GAAG3W,QACzB5I,KAAK05B,YAAcyF,GAKzB1C,WAAY,SAAU56B,GACpB,GAAI7B,KAAKk8B,gBAAT,CAEAj7B,IAAIC,EAAMW,EAAEwvB,QACRP,EAAOjvB,EAAEivB,MAAQjvB,EAAEsvB,eAKvB,GAHW,KAARjwB,GACDW,EAAE4I,kBAEDzK,KAAKsgC,gBAA2B,IAARp/B,GAAqB,KAARA,EAUjC,GAAY,KAARA,EACT,GAAKlB,KAAKq8B,WAAWhrB,aAAa,WACO,OAAtCrO,SAASo9B,cAAcnyB,YACxBjL,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,UAErF,GAAK3O,KAAKq8B,WAAWhrB,aAAa,WACvCrO,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,UAErF,GAAK3O,KAAKq8B,WAAWhrB,aAAa,WACvCrO,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,UAErF,GAAK3O,KAAK8J,WAAWuH,aAAa,WACvCrO,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAK8J,WAAWpB,SAAS,GAAGiG,UAErF,GAAK3O,KAAK8J,WAAWuH,aAAa,UAGvC,GAAuB,EAAnBrR,KAAK05B,YAAiB,CACxBz4B,IAAImgC,EAAYphC,KAAK05B,YAAc,EACnC,KAAO15B,KAAK65B,OAAOuH,GAAW7hB,GAAGA,GAAGxX,UAClCq5B,IACIA,EAAY,IACdA,EAAYphC,KAAK65B,OAAOp2B,OAAS,GAGrCzD,KAAKghC,eAAeI,QAEpBphC,KAAKghC,eAAehhC,KAAK65B,OAAOp2B,OAAS,QAZ3CzD,KAAK8J,WAAWpB,SAAS,GAAGE,aAF5B5I,KAAK8J,WAAWpB,SAAS,GAAGE,aAH5B5I,KAAKq8B,WAAW3zB,SAAS,GAAGE,aAH5B5I,KAAKq8B,WAAW3zB,SAAS,GAAGE,aAH5B5I,KAAKq8B,WAAW3zB,SAAS,GAAGE,aA0BzB,GAAY,KAAR1H,EACT,GAAKlB,KAAKq8B,WAAWhrB,aAAa,WACO,OAAtCrO,SAASo9B,cAAcnyB,YACxBjL,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,UAErF,GAAK3O,KAAKq8B,WAAWhrB,aAAa,WACvCrO,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,UAErF,GAAK3O,KAAKq8B,WAAWhrB,aAAa,WACvCrO,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,UAErF,GAAK3O,KAAK8J,WAAWuH,aAAa,WACvCrO,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAK8J,WAAWpB,SAAS,GAAGiG,UAErF,GAAK3O,KAAK8J,WAAWuH,aAAa,UAGvC,GAAIrR,KAAK05B,YAAc15B,KAAK65B,OAAOp2B,OAAS,EAE1C,GAAKzD,KAAK45B,UAAiC,IAArB55B,KAAK05B,aAAsB15B,KAAK65B,OAAO75B,KAAK05B,aAAana,GAAGA,GAAGxX,SAG9E,CACL9G,IAAIkgC,EAAYnhC,KAAK05B,YAAc,EACnC,KAAO15B,KAAK65B,OAAOsH,GAAW5hB,GAAGA,GAAGxX,UAClCo5B,IACIA,GAAanhC,KAAK65B,OAAOp2B,SAC3B09B,EAAY,GAGhBnhC,KAAKghC,eAAeG,QAVpBnhC,KAAKghC,eAAe,GACpBhhC,KAAK45B,UAAW,MAWb,CACL34B,IAAIkgC,EAAY,EAChB,KAAOnhC,KAAK65B,OAAOsH,GAAW5hB,GAAGA,GAAGxX,UAClCo5B,IACIA,GAAanhC,KAAK65B,OAAOp2B,SAC3B09B,EAAY,GAGhBnhC,KAAKghC,eAAeG,QAzBtBnhC,KAAK8J,WAAWpB,SAAS,GAAGE,aAF5B5I,KAAK8J,WAAWpB,SAAS,GAAGE,aAH5B5I,KAAKq8B,WAAW3zB,SAAS,GAAGE,aAH5B5I,KAAKq8B,WAAW3zB,SAAS,GAAGE,aAH5B5I,KAAKq8B,WAAW3zB,SAAS,GAAGE,aAuCb,KAAR1H,EACiC,OAAtC8B,SAASo9B,cAAcnyB,YACvBjL,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAChD3O,KAAK65B,OAAO,GAAGta,GAAGA,GAAG5Q,WACvB3O,KAAKq8B,WAAWhrB,aAAa,WAC7BrR,KAAKi+B,iBACLj+B,KAAKq8B,WAAW3zB,SAAS,GAAGE,SACnB5F,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAK65B,OAAO,GAAGta,GAAGA,GAAG5Q,WAC3F3O,KAAKq8B,WAAWhrB,aAAa,WAC9BrR,KAAKq8B,WAAW3zB,SAAS,GAAGE,QAEb,KAAR1H,EACJlB,KAAKq8B,WAAWhrB,aAAa,WACQ,OAAtCrO,SAASo9B,cAAcnyB,YACrBjL,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,WAC9F3L,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,WAC1F3L,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,YACxF3O,KAAKq8B,WAAWj5B,aAAa,SAAS,IACtCpD,KAAKghC,eAAe,IAGP,KAAR9/B,EACiC,OAAtC8B,SAASo9B,cAAcnyB,YAGpBjO,KAAKq8B,WAAWhrB,aAAa,UAFlCrR,KAAKw8B,QAGCx5B,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,WAC9F3L,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,WAC1F3L,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAKq8B,WAAW3zB,SAAS,GAAGiG,YACxF3O,KAAKq8B,WAAWj5B,aAAa,SAAS,IACtCpD,KAAKghC,eAAe,IAMV,KAAR9/B,GAAqB,IAAPA,IACVlB,KAAKm9B,cAAc10B,UAAU0G,SAAS,qBAAgC,KAARjO,GACjE4vB,EAAK,GAAGviB,YAAehM,EAAEhD,QAAQgzB,OAAOiI,aAAe,QAChEx6B,KAAKw8B,aAzHF36B,EAAE0vB,WACHvxB,KAAKsgC,eAELtgC,KAAKsgC,gBAAkB,EAEE,IAAxBtgC,KAAKsgC,gBAAgD,IAAxBtgC,KAAKsgC,gBAAgC,KAARp/B,IAC3DtB,EAAE4G,SAASigB,KAAK5kB,GAChB7B,KAAK+gC,wBAoHT,OAAO7/B,GACL,KAAK,GACA8B,SAASo9B,cAAcnyB,WAAWmyB,cAAczxB,YAAc3O,KAAK65B,OAAO,GAAGta,GAAGA,GAAG5Q,WACpF3O,KAAKy6B,YAAY,CACfpwB,OAAOrK,KAAKY,KAAKse,cAEnBlf,KAAKq8B,WAAWnuB,WAAWtF,SAExB5I,KAAKY,KAAK8F,WAAW6X,WAAW6hB,cAAc7hB,WAAW3M,UAAU6F,SAAS,sBAC7EzX,KAAKY,KAAK8F,WAAW6X,WAAW6hB,cAAc1B,QAElD,MACF,KAAK,GACA1+B,KAAKY,KAAK8F,WAAW6X,WAAW6hB,cAAc7hB,WAAW3M,UAAU6F,SAAS,sBAC7EzX,KAAKY,KAAK8F,WAAW6X,WAAW6hB,cAAc1B,QAChD,MACF,KAAK,GACH1+B,KAAKy6B,YAAY,CACfpwB,OAAOrK,KAAKY,KAAKse,cAEnBlf,KAAKq8B,WAAWnuB,WAAWtF,QAC3B,MACF,KAAK,GACH5I,KAAKs7B,aAAaz5B,GAClB,MACF,KAAK,GACH7B,KAAK66B,WAAWh5B,GAChB,MACF,KAAK,GACA7B,KAAKm9B,cAAc10B,UAAU0G,SAAS,qBACvCnP,KAAKi8B,WAAWp6B,GAClB,MACF,KAAK,GACH7B,KAAKs6B,kBAAkBz4B,GACvB,MACF,KAAK,GACH7B,KAAKm7B,OAAOt5B,GACZ,MACF,KAAK,GACH7B,KAAK8uB,gBAAgBjtB,GACrB,MACF,KAAK,GACH7B,KAAKw7B,YAAY35B,GACjB,MACF,KAAK,GACA7B,KAAKm9B,cAAc10B,UAAU0G,SAAS,qBACvCnP,KAAK+7B,aAAal6B,MAK1Bo8B,eAAgB,SAASp8B,GACvBZ,IAAI+xB,EAAUhzB,KAAKY,KAAKmf,UACpB2e,EAAQ1+B,KAAKs8B,YACb6B,EAAOn+B,KAAKq8B,WACZgF,EAASrhC,KAAK65B,OAAO,GAAGta,GAAGA,GAE/B8hB,EAAOj+B,aAAa,gBAAgB,QACpC+6B,EAAK32B,gBAAgB,UAErB,IAAM85B,EAAYthC,KAAK0G,WAAWo6B,YAE5BS,GADavhC,KAAK0G,WAAW+hB,aACd0V,EAAK2C,aACtBpC,EAAMn0B,eAAelH,EAAIi+B,EAAYC,EAAevO,EAAQ3vB,GAC9D86B,EAAKl2B,MAAM8P,KAAO,OAClBomB,EAAKl2B,MAAMgQ,MAAQqpB,EAAY,OAE/BnD,EAAKl2B,MAAM8P,KAAOupB,EAAY,KAC9BnD,EAAKl2B,MAAMgQ,MAAQ,QAGrBkmB,EAAKl2B,MAAMkQ,IAAM,OACjBgmB,EAAKl2B,MAAMmQ,OAAS,QAGtBopB,eAAgB,SAAS3/B,GACvB,GAAIA,EAAE8H,eAAkB9H,EAAE8H,cAAcC,gBACpC/H,EAAE8H,cAAcC,cAAcgI,UAAU6F,SAAS,mBACjD5V,EAAE8H,cAAciI,UAAU6F,SAAS,iBAFvC,CAGAxW,IAAIk9B,EAAOn+B,KAAKq8B,WAAYgF,EAASrhC,KAAK65B,OAAO,GAAGta,GAAGA,GACvD8hB,EAAOj+B,aAAa,gBAAgB,SACpC+6B,EAAK/6B,aAAa,SAAU,IAC5BpD,KAAKihC,YAAa,IAGpB1B,iBAAkB,SAAU19B,GAC1BjC,EAAEoK,QAAQ2C,SAAS9K,EAAE4H,QAAU5H,EAAE4/B,WAAY,QAC1C5/B,EAAE4/B,WAAWlzB,YAAehM,EAAEhD,QAAQgzB,OAAOiI,aAAe,QAASx6B,KAAKi+B,eAAep8B,IAG9F29B,gBAAiB,SAAU39B,GACzBjC,EAAEoK,QAAQC,YAAYpI,EAAE4H,QAAU5H,EAAE4/B,WAAY,QAChDzhC,KAAKwhC,eAAe3/B,IAGtB6/B,sBAAuB,SAAUniC,EAAQoiC,GACvCpiC,EAAUA,EAAQ0P,cACJ,aAAV0yB,EACc,aAAZpiC,EACFS,KAAK65B,OAAO,GAAGta,GAAGA,GAAGxX,UAAW,EACX,SAAZxI,EACTS,KAAK65B,OAAO,GAAGta,GAAGA,GAAGxX,UAAW,EACX,YAAZxI,EACTS,KAAK65B,OAAO,GAAGta,GAAGA,GAAGxX,UAAW,EACX,WAAZxI,IACTS,KAAK65B,OAAO,GAAGta,GAAGA,GAAGxX,UAAW,GAEhB,YAAV45B,IACQ,aAAZpiC,EACFS,KAAK65B,OAAO,GAAGta,GAAGA,GAAGxX,UAAW,EACX,SAAZxI,EACTS,KAAK65B,OAAO,GAAGta,GAAGA,GAAGxX,UAAW,EACX,YAAZxI,EACTS,KAAK65B,OAAO,GAAGta,GAAGA,GAAGxX,UAAW,EACX,WAAZxI,IACTS,KAAK65B,OAAO,GAAGta,GAAGA,GAAGxX,UAAW,KAKtC65B,2BAA4B,SAAUriC,GACpB,SAAZA,EACFS,KAAKY,KAAKiJ,YAAYgwB,OAAO,GAAGta,GAAGA,GAAG5Q,UAAYpM,EAAEhD,QAAQgzB,OAAO8H,cAAgB,kBAEhE,SAAZ96B,IACPS,KAAKY,KAAKiJ,YAAYgwB,OAAO,GAAGta,GAAGA,GAAG5Q,UAAYpM,EAAEhD,QAAQgzB,OAAOsP,kBAAoB,sBAKzFjvB,EAGsB,SAASqI,EAAYjU,GAC3C,IAAIiU,IAAejU,EAAK,MAAO,GAE/B/F,IAAI6gC,EAAc,GAAIC,EAAkB,GACpCC,EAAoB,GAAIC,EAAwB,GAChD/+B,EAAW8D,EAAIzH,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIkC,EAE3D,IAAIrC,IAAIuC,EAAI,EAAEA,EAAEwD,EAAIzH,QAAQ0E,IAAI1E,QAAQuR,YAAYrN,OAAOD,IAAI,CAC7DvC,IAAIgP,EAAQjJ,EAAIzH,QAAQ0E,IAAIgM,MAAMzM,GAC9B0+B,EAAel7B,EAAIzH,QAAQ0E,IAAImV,eAAe0B,UAAUG,EAAW9Z,IAAI8O,GACvEkyB,EAAen7B,EAAIzH,QAAQ0E,IAAImV,eAAe0B,UAAUG,EAAW7Z,IAAI6O,GAE3E6xB,EAAYx8B,KAAK,CACf6U,WAAY+nB,EAAa7+B,EACzBkX,SAAS4nB,EAAa7+B,IAExBy+B,EAAgBz8B,KAAK,CACnB6U,WAAYgoB,EAAa9+B,EACzBkX,SAAU2nB,EAAa5+B,IAIzB0+B,EAAkB18B,KAAK,CACrB6U,WAAY2nB,EAAYt+B,GAAG2W,WAAajX,EACxCqX,SAASunB,EAAYt+B,GAAG+W,SAAWrX,IAErC++B,EAAsB38B,KAAK,CACzB6U,WAAY4nB,EAAgBv+B,GAAG2W,WAAajX,EAC5CqX,SAAUwnB,EAAgBv+B,GAAG+W,SAAWrX,IAK5CjC,IAAImhC,EAAiBp7B,EAAIzH,QAAQ0E,IAAIkyB,UAAUlb,EAAW9Z,KACtDkhC,EAAiBr7B,EAAIzH,QAAQ0E,IAAIkyB,UAAUlb,EAAW7Z,KAE1DH,IAAI8wB,EACM,CACN5X,WAAYioB,EAAe/P,IAC3B9X,SAAS8nB,EAAe/P,KAHxBP,EAKU,CACV5X,WAAYkoB,EAAehQ,IAC3B9X,SAAU6nB,EAAe9P,KAKzBza,EACM,CACNsC,WAAWc,EAAW9Z,IAAIkC,EAC1BkX,SAASU,EAAW7Z,IAAIkC,GAHxBuU,EAKU,CACVsC,WAAWc,EAAW7Z,IAAIiC,EAC1BkX,SAASU,EAAW9Z,IAAImC,GAK5B,MAAO,CACLwuB,QAAQ,CACNwQ,KAAKR,EACLryB,WAAWuyB,EACXjQ,KAAKA,EACLla,KAAKA,GAEPoa,YAAY,CACVqQ,KAAKP,EACLtyB,WAAWwyB,EACXlQ,KAAKA,EACLla,KAAKA,GAEPhX,WAAWmG,EAAIzH,QAAQsB,aA5EzB+R,EAkFmB,SAAS1H,GAC5B,GAAIA,EAAJ,CAGAjK,IAAI2Y,EAAS1O,EAAS2O,OAAQhZ,EAAaqK,EAASrK,YAAc8J,EAAqB5F,EAAQ,EAAGw9B,EAAa33B,EAC3G1G,EAASlE,KAAKa,GAAYtB,QAAQ0E,IAAIwL,WAAWvL,OAAO,GACpCs+B,EAAiBxiC,KAAKa,GAAYtB,QAAQuR,YAAYrN,OAAS,EACnFg/B,EADiB,EACeC,EAAgBF,EAChDG,GAAY,EAAOC,EAAe,EACtC,IAAI3hC,IAAIuC,EAAE,EAAEA,EAAEoW,EAAOnW,OAAOD,IAC1B,OAAOoW,EAAOpW,GAAGoB,aAAa,SAC5B,IAAK,OACH69B,IAAkB7oB,EAAOpW,GAAG6N,aAAa,SAAW+I,OAAOR,EAAOpW,GAAGoB,aAAa,QAAUgV,EAAOpW,GAAGoB,aAAa,OANpG,GAOf89B,IAAkB9oB,EAAOpW,GAAG6N,aAAa,SAAW+I,OAAOR,EAAOpW,GAAGoB,aAAa,QAAUgV,EAAOpW,GAAGoB,aAAa,OAAS49B,GAC5Hz9B,GAAS6U,EAAOpW,GAAGoB,aAAa,SAClC,MACA,IAAK,WACH,IAAIgV,EAAOpW,GAAGoB,aAAa,SAAWgV,EAAOpW,GAAGoB,aAAa,OAAQ,SACrE3D,IAAIG,GAAOwY,EAAOpW,GAAGoB,aAAa,OAAOzD,GAAOyY,EAAOpW,GAAGoB,aAAa,OACvE,OAAOgV,EAAOpW,GAAGoB,aAAa,QAAQsV,eACpC,IAAK,IACL,IAAK,YACL,IAAK,SACL,IAAK,UACHqoB,EAAahgC,EAAE6M,SAASwK,EAAOpW,GAAGoB,aAAa,QAAQsV,eACvDhW,EAAO/C,IAAIkC,EAAIlC,EACf+C,EAAO9C,IAAIiC,EAAIjC,EACfwhC,IACF,MACA,IAAK,IACL,IAAK,WACL,IAAK,MACL,IAAK,WACHL,EAAahgC,EAAE6M,SAASwK,EAAOpW,GAAGoB,aAAa,QAAQsV,eACvDhW,EAAO/C,IAAImC,EAAInC,EACf+C,EAAO9C,IAAIkC,EAAIlC,EACfwhC,KAMU,GAAhBA,IACFD,GAAY,GAId1hC,IAAIhB,EAAa,CACfoC,QAAS6I,EAASjL,YAAYkB,MAAQiZ,OAAOlP,EAASjL,WAAWkB,MAAQ+J,EAASjL,WAAWkB,IA1C1E,EA2CnBiB,QAAS8I,EAASjL,YAAYmB,MAAQgZ,OAAOlP,EAASjL,WAAWmB,MAAQ8J,EAASjL,WAAWmB,IAAMohC,EACnGtgC,cAAeugC,EACfxgC,cAAeygC,GASjB,OANEx+B,GADEy+B,GAAaz3B,EAAS6hB,oBAAsB7hB,EAAS6hB,mBAAmB7oB,OACjEgH,EAAS6hB,mBAAmB7oB,OAC5By+B,EACA3iC,KAAKuP,mBAAmBrL,EAAOa,EAAMlE,EAAW0hC,GAEhDviC,KAAKa,GAAYtB,QAAQ0E,IAAI4T,KAAK3T,OAEtC,CACLjE,WAAYA,EACZiE,OAAQA,KAhJV0O,EAuJS,SAASmH,GAClB,IACE,OAAOA,EAAKG,eACV,IAAK,MACL,IAAK,SACH,MAAO,aACT,IAAK,IACL,IAAK,IACH,MAAO,CAAC,MAAM,QAChB,IAAK,IACL,IAAK,IACH,MAAO,OACT,IAAK,WACL,IAAK,YACH,MAAO,OACT,IAAK,WACL,IAAK,UACH,MAAO,OACT,QACE,OAAOtP,GAEX,MAAO/I,GAAI,SA5Kb+Q,EAkLQ,SAAS1F,GACjB,IACE,OAAOA,EAAGgN,eACR,IAAK,aACH,MAAO,CAAC,SAAU,OACpB,IAAK,MACL,IAAK,OACH,MAAO,CAAC,IAAK,KACf,IAAK,OACH,MAAO,CAAC,IAAK,KACf,IAAK,OACH,MAAO,CAAC,YAAa,YACvB,IAAK,OACH,MAAO,CAAC,UAAW,aAEvB,MAAOrY,GAAI,SAjMb+Q,EAuMQ,SAASmH,GACjB,IACE,OAAOA,EAAKG,eACV,IAAK,IACL,IAAK,SACL,IAAK,YACL,IAAK,IACL,IAAK,UACH,MAAO,IACT,IAAK,MACL,IAAK,IACL,IAAK,WACL,IAAK,IACL,IAAK,WACH,MAAO,IAET,QACE,QAEJ,MAAOrY,GAAI,SA1Nb+Q,EA+NiB,SAASqI,EAAYzW,EAAM3D,EAAYqM,GACxD,GAAI+N,IAAgBzW,GAAiB,IAATA,IAAgB6V,OAAOwoB,UAAUr+B,IAAU3D,GAAeqM,EAEtF,OADArM,EAAoC,iBAAfA,EAA2B0B,EAAE1B,GAAcA,EACxDqM,EAAG+B,eACT,IAAK,OACH,OAAOgM,EACT,IAAK,OACL,IAAK,aACHha,IAAI6hC,EAAWjiC,EAAWuY,eAAe0B,UAAUG,EAAW9Z,IAAKN,EAAWoP,OAAOzL,IACjFu+B,EAAWliC,EAAWuY,eAAe0B,UAAUG,EAAW7Z,IAAKP,EAAWoP,OAAOzL,IACrF,GAAyB,SAArB0I,EAAG+B,cAA0B,OAAOrP,EAAEsE,OAAO4+B,EAAUC,GAC3D9hC,IAAIiC,EAAWrC,EAAWtB,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EACtD,OAAOzD,EAAEsE,OAAOtE,EAAE0E,MAAMw+B,EAASz/B,EAAIH,EAAU4/B,EAASx/B,EAAIJ,GAAWtD,EAAE0E,MAAMy+B,EAAS1/B,EAAIH,EAAS6/B,EAASz/B,EAAIJ,IACpH,IAAK,OACC8/B,EAAUniC,EAAWs1B,UAAUlb,EAAW9Z,KAC1C8hC,EAAUpiC,EAAWs1B,UAAUlb,EAAW7Z,KAC9C,OAAOxB,EAAEsE,OAAOtE,EAAE0E,MAAM0+B,EAAQ3Q,IAAK2Q,EAAQ1Q,KAAM1yB,EAAE0E,MAAM2+B,EAAQ5Q,IAAK4Q,EAAQ3Q,MAClF,QACE,SAjPJ1f,EAuPgB,SAAStO,EAAOE,EAAM3D,EAAYqM,GAClD,GAAI5I,IAAWE,GAAiB,IAATA,IAAgB6V,OAAOwoB,UAAUr+B,IAAU0I,GAAOrM,EAAzE,CAEAI,IAAIiC,GADJrC,EAAoC,iBAAfA,EAA2B0B,EAAE1B,GAAcA,GACtCtB,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIiC,EACtD,OAAO6J,EAAG+B,eACR,IAAK,aACH,OAAO1M,EAAE2gC,iBAAiBtjC,EAAE0E,MAAMA,EAAMjB,EAAEH,EAASoB,EAAMhB,EAAEJ,GAAUsB,EAAK3D,GAC5E,IAAK,OACH,OAAOyD,EACT,IAAK,OACH,OAAO/B,EAAE2gC,iBAAiB5+B,EAAME,EAAK3D,GACvC,IAAK,OACH,OAAOA,EAAW0zB,QAAQ30B,EAAEuyB,OAAO7tB,EAAMhB,EAAEgB,EAAMjB,IACnD,QACE,UArQJuP,EA2QgB,SAAStO,EAAOE,EAAM3D,GACtC,GAAIyD,IAAWE,GAAiB,IAATA,IAAgB6V,OAAOwoB,UAAUr+B,IAAU3D,EAElE,OADAA,EAAoC,iBAAfA,EAA2B0B,EAAE1B,GAAcA,GAC9CuY,eAAeC,YAAY/U,EAAMzD,EAAWoP,MAAMzL,KA9QpEoO,EAmRkB,SAAS1O,EAAQM,EAAM3D,EAAYqM,GACrD,GAAIhJ,GAAWA,EAAO9C,KAAQ8C,EAAO/C,MAASqD,GAAiB,IAATA,IAAgB6V,OAAOwoB,UAAUr+B,IAAU3D,GAAeqM,EAEhH,OADArM,EAAoC,iBAAfA,EAA2B0B,EAAE1B,GAAcA,EACzDjB,EAAEsE,OAAO3B,EAAE4gC,iBAAiBj/B,EAAO/C,IAAKqD,EAAM3D,EAAYqM,GAAK3K,EAAE4gC,iBAAiBj/B,EAAO9C,IAAKoD,EAAM3D,EAAYqM,KAtRvH0F,EA2RkB,SAAS1O,EAAQM,EAAM3D,GACzC,GAAIqD,GAAWA,EAAO9C,KAAQ8C,EAAO/C,MAASqD,GAAiB,IAATA,IAAgB6V,OAAOwoB,UAAUr+B,IAAU3D,EAEjG,OADAA,EAAoC,iBAAfA,EAA2B0B,EAAE1B,GAAcA,EACzDjB,EAAEsE,OAAO3B,EAAE2gC,iBAAiBh/B,EAAO/C,IAAKqD,EAAM3D,GAAa0B,EAAE2gC,iBAAiBh/B,EAAO9C,IAAKoD,EAAM3D,KA9RvG+R,EAmSoB,SAASlL,GAC7B,IAAIA,GAASA,aAAiB3G,OAAO,MAAO,GAC5CE,IAAI6N,EAAUpH,EAAMtD,MAAM,OAAOywB,KAAK,IAClCuO,EAAe,GACfC,EAAcv0B,EAAQ1K,MAAM,KAEhC,IAAInD,IAAIuC,EAAE,EAAEA,EAAE6/B,EAAY5/B,OAAOD,IAAI,CACnCvC,IAAIqiC,EAAOD,EAAY7/B,GAAGY,MAAM,KACb,IAAhBk/B,EAAK7/B,SAAc2/B,EAAaE,EAAK,IAAIA,EAAK,IAGnD,MADoB,KAAjBF,GAA2D,IAApCC,EAAY,GAAGj/B,MAAM,KAAKX,SAAY2/B,EAAat0B,QAAUu0B,EAAY,IAC5FD,GA9SPxwB,EAmTc,SAAS2wB,GACvB,IAAK,IAAI//B,EAAE,EAAGggC,EAAQ,GAAI7gC,EAAS4gC,EAAgBn/B,MAAM,KAAKZ,EAAEb,EAAOc,OAAOD,GAAG,EAC/EggC,EAAMl+B,KAAK,CAACmV,SAAS9X,EAAOa,EAAE,IAAIiX,SAAS9X,EAAOa,MAEpD,OAAOggC,GAvTP5wB,EA2TsB,SAAS7H,EAAOqG,EAAM3M,GAC1C,GAAMA,aAAqB+pB,SAAazjB,GAAUA,EAAM5B,cAAc,sCAAtE,CAEA,GAAGiI,aAAgBod,QACjBpd,EAAOA,EAAKxM,aAAa,QAAQwM,EAAKxM,aAAa,QAAQ5B,SAASsO,SAC/D,IAAKF,GAAe,KAAPA,GAAaA,aAAgBrQ,OAC/C,OAKF,IAFA,IAIQwQ,EAUEkyB,EAdNC,EAAK,GACLC,EAAc54B,EAAM8F,iBAAiB,sCAChCrN,EAAE,EAAEA,EAAEmgC,EAAYlgC,OAAOD,IACc,aAA1CmgC,EAAYngC,GAAG2N,SAASlC,eACtBsC,EAAOoyB,EAAYngC,GAAG6N,aAAa,QAAU,IAAIC,IAAIqyB,EAAYngC,GAAGoB,aAAa,QAAQwM,GAAMG,KAAM,QAElG9M,EAAU0E,cAAc,cAAcoI,EAAK,SAC1CqyB,EAAU5gC,SAASC,cAAc,SAC7BG,aAAa,OAAQmO,GAC7BqyB,EAAQxgC,aAAa,MAAO,cAC5BsgC,EAAGp+B,KAAKs+B,OAINH,EAAWzgC,SAASC,cAAc,UAC7BqrB,YAAcqV,EAAYngC,GAAG8qB,YACtCoV,EAAGp+B,KAAKm+B,IAOd,IAAK,IAAII,EAAEH,EAAGjgC,OAAO,EAAO,GAALogC,EAAOA,IAC5Bp/B,EAAUskB,sBAAsB,aAAa2a,EAAGG,MA5VpDjxB,EAiWgB,SAAS2Z,EAAS4S,EAAO2E,GACzC,IAAIC,EAAI,GACRxX,EAAQnoB,MAAM,UAAU2gB,QAAQxiB,EAAEyhC,aAAaD,GAC/C/jC,KAAKsF,KAAKy+B,IApWVnxB,EAwWa,SAAS2Z,EAAS4S,EAAO2E,GACtC9jC,KAAKsF,KAAKgV,WAAWiS,KAzWrB3Z,EA6WW,SAAUqxB,EAAMC,GAC3BjjC,IAAI2xB,EAAQuR,GAAU,EAAOj9B,EAAOF,EAAMk9B,EAAatjC,KAAM8T,EAC7D,GAAiB,cAAduvB,EAAK5uB,MAAwC,WAAhB4uB,EAAKx6B,OACnCw6B,EAAKx6B,OAAS,YACT,GAAkB,cAAdw6B,EAAK5uB,MAAwB4uB,EAAKr4B,IAAIuD,SAAS,KAAK,CAC7DlO,IAAImjC,EAAOH,EAAKr4B,IAAIxH,MAAM,KAAMoc,EAAM4jB,EAAK,GAAGhgC,MAAM,KACpDwuB,EAAS,CAACrvB,EAAGid,EAAI,IAAM,EAAG6R,IAAK7R,EAAI,IAAM,EAAG8R,IAAK9R,EAAI,IAAM,GAC3D2jB,GAAWC,EAAK,GACb,CAAC,IAAK,IAAI,KAAKj1B,SAAS80B,EAAKr4B,IAAI,MAAKq4B,EAAKx6B,OAAS,SAEzD,GAAI06B,EA0COvR,IAAWqR,EAAKI,SAAWF,IACpCD,EAAatjC,KAAKrB,QAAQkH,MAAMmsB,QAAQA,EAAON,KAAMM,EAAOP,KAAMO,EAAOrvB,GACtEmR,IAASxN,EAAMwN,QAAUA,QA5CjB,CACXzT,IAAIqjC,GAAW,EAIf,OAHAp9B,EAAQlE,SAASC,cAAc,UAC/BiE,EAAM9D,aAAa,MAAO6gC,EAAKr4B,KAC/B1E,EAAM9D,aAAa,UAAW,IACtB6gC,EAAKx6B,QACX,IAAK,SACe,cAAdw6B,EAAK5uB,KACPkvB,OAAOnV,KAAK6U,EAAKr4B,MAEjB5E,EAAIzH,QAAQkH,MAAM1C,YAAYmD,GAC9Bo9B,GAAW,GAEb,MACF,IAAK,UACH,IAAKrjC,IAAIi2B,KAAKlwB,EAAIzH,QAAQkH,MAAMoK,iBAAiB,UAC3CqmB,EAAE5M,SAAW4Z,GAAcl9B,EAAIzH,QAAQkH,MAAMwM,YAAYikB,GAC/DlwB,EAAIzH,QAAQkH,MAAM1C,YAAYmD,GAC9BF,EAAIzH,QAAQkH,MAAMwM,YAAYixB,EAAap8B,UAC3Cw8B,GAAW,EACX,MACF,IAAK,OACHC,OAAO14B,SAAS0F,KAAO0yB,EAAKr4B,IAC5B,MACF,QACE8I,EAAUwvB,EAAap8B,SAAS4M,QAChCwvB,EAAap8B,SAASihB,sBAAsB,cAAe7hB,GAC3DF,EAAIzH,QAAQkH,MAAMwM,YAAYixB,EAAap8B,UAC3Cw8B,GAAW,GAEXL,EAAKI,SAAWC,GAAU1kC,EAAE4G,SAASF,GAAGY,EAAM,aAAc,SAASs9B,EAAY3iC,GAChFyiC,GAAY,CAAC,UAAW,SAASn1B,SAAS80B,EAAKx6B,SAAqE,IAA1DvC,EAAM0C,cAAciH,iBAAiB,UAAUpN,SAC1GyD,EAAM0C,cAAc/I,WAAaqG,EAAMojB,OAAO1F,iBAC7C1d,EAAMoa,SACJsR,EAAQ1rB,EAAM0C,cAAcgpB,QAAQA,EAAON,KAAMM,EAAOP,KAAMO,EAAOrvB,GACnE2D,EAAM0rB,SACXhzB,EAAE4G,SAASS,IAAIC,EAAO,aAAcs9B,IAGnC9vB,IAASxN,EAAMwN,QAAUA,GAC5B1N,EAAIu1B,eAAe3zB,YA/ZvBgK,EAyaiB,SAAUnM,GAC3BxF,IAAIqD,EAAQmC,EAAM7F,KAAK2zB,QAAQ9tB,EAAM7F,KAAKse,aACtChc,EAAWuD,EAAM7F,KAAKrB,QAAQ0E,IAAI1E,QAAQ0E,IAAIP,KAAKQ,OAAO9C,IAAIkC,EAGlE,MAAO,CAFM2B,KAAKyvB,MAAMpwB,EAAMjB,EAAIH,GACxB+B,KAAKyvB,MAAMpwB,EAAMhB,EAAIJ,KA7a/B0P,EAqbW,SAAUnM,EAAO6P,GAC5B,IACE,IAAIhF,IAAIgF,GAERrV,IAAIi2B,EAAI,gBAAkB5gB,EAAO,YAAc/T,EAAEhD,QAAQgzB,OAAOkS,QAAU,yBAC1Eh+B,EAAMuL,mBAAmB,YAAaklB,GACtCzwB,EAAMi+B,UAAUC,iBAAiB,QAAS,WACpCl+B,GAEFA,EAAMwM,YAAYxM,EAAMi+B,WAG1BxN,EAAI,OAEN,MAAOvgB,GAEP,GAAyB,aADzBL,EAAOA,EAAKmnB,QAAQ,kDAAmD,IAAIlP,QACjE4J,MAAM,EAAE,IAAyC,cAAnB7hB,EAAK6hB,OAAO,GAClD1xB,EAAMuL,mBAAmB,YAAasE,QACjC,GAAyB,iBAArBA,EAAK6hB,MAAM,EAAE,KAA8C,mBAApB7hB,EAAK6hB,OAAO,IAA0B,CACtFl3B,IAAIiG,oBAA0B3E,EAAEhD,QAAQgzB,OAAOqS;8DACKn+B,EAAM5F,0BAA0ByV,EACxE,YACZ7P,EAAMuL,mBAAmB,YAAa9K,QAEtC,IACET,EAAMo+B,cAAcC,KAAKC,MAAMzuB,IAC/B,MACAH,QAAQC,IAAI,qBAhdlBxD,EAwdiB,SAAUoyB,GAC3B/jC,IAAIgkC,EAAQjiC,SAASC,cAAc,SAG/BiiC,EAAQD,EAAME,cACdhgC,EAAM+/B,EAAME,YACZC,EAAMriC,SAASC,cAAc,MAC7BqiC,EAAMtiC,SAASC,cAAc,MACjCoiC,EAAIthC,YAAYf,SAASuiC,eAAe,kBACxCD,EAAIvhC,YAAYf,SAASuiC,eAAe,mBACxCF,EAAIjiC,aAAa,OAAQ,gBACzBkiC,EAAIliC,aAAa,OAAQ,gBACzBiiC,EAAIjiC,aAAa,QAAS,OAC1BkiC,EAAIliC,aAAa,QAAS,OAC1B+B,EAAIpB,YAAYshC,GAChBlgC,EAAIpB,YAAYuhC,GAGhBrkC,IAAIukC,EAAQP,EAAMQ,cAClB,IAAKxkC,IAAIC,KAAO8jC,EACZ,GAAIA,EAAKU,eAAexkC,GAAM,CAC1BD,IAAIkE,EAAMqgC,EAAMJ,YACZO,EAAK3iC,SAASC,cAAc,MAC5B2iC,EAAK5iC,SAASC,cAAc,MAChC0iC,EAAG5hC,YAAYf,SAASuiC,eAAerkC,IACvC0kC,EAAG7hC,YAAYf,SAASuiC,eAAeP,EAAK9jC,KAC5CykC,EAAGviC,aAAa,QAAS,OACzBwiC,EAAGxiC,aAAa,WAAYlC,GAC5BiE,EAAIpB,YAAY4hC,GAChBxgC,EAAIpB,YAAY6hC,GAGxB,OAAOX,GAxfPryB,GA8fa,SAAUizB,EAAYxiC,EAAGC,GACtC,OAAIuiC,IAAe,KAGnBA,EAAW,GAAK5gC,KAAK9D,IAAIkC,EAAGwiC,EAAW,IACvCA,EAAW,GAAK5gC,KAAK9D,IAAImC,EAAGuiC,EAAW,IACvCA,EAAW,GAAK5gC,KAAK7D,IAAIiC,EAAGwiC,EAAW,IACvCA,EAAW,GAAK5gC,KAAK7D,IAAIkC,EAAGuiC,EAAW,KAL9BA,GAhgBTjzB,GAihBa,SAAUoyB,EAAMzlC,EAAU,GAAI2H,EAAQ,KAAM2+B,EAAW,IASpEtmC,EAAUwB,OAAOwS,OAAO,GART,CACX3L,MAAO,KACP/G,WAAY,UACZ89B,QAAS,KACT7sB,WAAY,KACZg0B,iBAAkB,MAGgBvmC,GAMtC0B,IACI8kC,GAHAf,EADgB,iBAATA,EACAF,KAAKC,MAAMC,GAGPA,GAAK3vB,KAAKpG,cACzBhO,IAAI+kC,EAAM,GACNC,GAAY,EAGZnnB,EAAS,IAAIvI,UAGH,OAAVrP,IACK89B,EAAKkB,OACRD,GAAY,GAGVE,EAAiB,iEAAmE5mC,EAAQsB,WAAa,uEAC7GqG,EAAQ4X,EAAOtI,gBAAgB2vB,EAAgB,aAEzB,OAAlB5mC,EAAQqI,MACRV,EAAMiC,cAAc,UAAU/F,aAAa,QAAS7D,EAAQqI,OACrDo9B,EAAK39B,KACZH,EAAMiC,cAAc,UAAU/F,aAAa,QAAS4hC,EAAK39B,MAClD29B,EAAKnzB,MACZ3K,EAAMiC,cAAc,UAAU/F,aAAa,QAAS4hC,EAAKnzB,OAEzD3K,EAAMiC,cAAc,UAAU/F,aAAa,QAASb,EAAEhD,QAAQgzB,OAAOkS,UAG7ExjC,IAAIqD,EAAQ,0BACZA,EAAQwa,EAAOtI,gBADH,0BAC0B,aAEtCvV,IAAImlC,EAAa,uEACjBA,EAAatnB,EAAOtI,gBADH,uEAC+B,aAEhDvV,IAAIolC,EAAa,uEACjBA,EAAavnB,EAAOtI,gBADH,uEAC+B,aAEhDvV,IAAIqlC,EAAkB,8CACtBA,EAAkBxnB,EAAOtI,gBADH,8CACoC,aAE1DvV,IAAIslC,EAAU,8BACdA,EAAUznB,EAAOtI,gBADH,8BAC4B,aAE1CvV,IAAIulC,EAAe,wCACnBA,EAAe1nB,EAAOtI,gBADH,wCACiC,aAEpDvV,IAAIwlC,EAAqB,oDACzBA,EAAqB3nB,EAAOtI,gBADH,oDACuC,aAEhEvV,IAAI8M,EAAU,qIACdA,EAAU+Q,EAAOtI,gBADH,qIAC4B,aAG1CvV,IAAI0B,EAAS,sCAIb,GAHAA,EAASmc,EAAOtI,gBADH,sCAC2B,aAGvB,sBAAbuvB,EAAkC,CAG9Bf,EAAKkB,KACLh/B,EAAMiC,cAAc,UAAU6I,mBAAmB,aAAc,uDAAyDgzB,EAAKkB,KAAK,GAAK,uBAAyBlB,EAAKkB,KAAK,GAAK,4BAA8BlB,EAAKkB,KAAK,GAAK,0BAA4BlB,EAAKkB,KAAK,GAAK,iBAEzQL,EAAa,CAACa,EAAAA,EAAUA,EAAAA,EAAUrsB,OAAOssB,kBAAmBtsB,OAAOssB,mBAGrE1lC,IAAI8L,EAAWi4B,EAAKj4B,SAEpB,IAAK9L,IAAIi2B,EAAE,EAAEA,EAAEnqB,EAAStJ,OAAOyzB,IAC3B30B,EAAEsiC,cAAc93B,EAASmqB,GAAI33B,EAAS2H,EAAO2+B,QAE9C,GAAiB,YAAbE,EAAwB,CAE/B9kC,IAAI2lC,EAAgB74B,EAAQ2D,WAAU,GAClCm1B,EAAeD,EAAcz9B,cAAc,eAG3C67B,EAAKkB,KACPh/B,EAAMiC,cAAc,UAAU6I,mBAAmB,aAAc,uDAAyDgzB,EAAKkB,KAAK,GAAK,uBAAyBlB,EAAKkB,KAAK,GAAK,4BAA8BlB,EAAKkB,KAAK,GAAK,0BAA4BlB,EAAKkB,KAAK,GAAK,iBACvO,iBAAfL,QAAmDnoB,IAAtBmoB,EAAWpiC,SACzDoiC,EAAa,CAACa,EAAAA,EAAUA,EAAAA,EAAUrsB,OAAOssB,kBAAmBtsB,OAAOssB,oBAIrE1lC,IAAI6lC,EAAiB5/B,EAAMiC,cAAc,UAAUvE,aAAa,SACjC,mBAApBrF,EAAQo/B,QACfmI,EAAiBvnC,EAAQo/B,QAAQqG,GACC,iBAApBzlC,EAAQo/B,SACtBmI,EAAiB9B,EAAKlzB,WAAWvS,EAAQo/B,cAElBjhB,IAAnBopB,IACAA,EAAiBvnC,EAAQo/B,UAEtBqG,EAAKtxB,KACdozB,EAAiB9B,EAAKtxB,IAExBmzB,EAAa19B,cAAc,sBAAsBwF,UAAYm4B,EAG7D7lC,IAAI8lC,EAE8B,mBAAvBxnC,EAAQuS,YACfi1B,EAAIxnC,EAAQuS,WAAWkzB,GAEjB+B,aAAavY,UACfuY,GAAI,EACJ5wB,QAAQ3G,MAAM,6EAIlBu3B,EAFqC,iBAAvBxnC,EAAQuS,YACtB+0B,EAAa19B,cAAc,kBAAkB6I,mBAAmB,YAAazS,EAAQuS,aACjF,GACGvS,EAAQuS,sBAAsBk1B,YACjCznC,EAAQuS,WAERvP,EAAE0kC,kBAAkBjC,EAAKlzB,YAG7Bi1B,GACAF,EAAa19B,cAAc,kBAAkBpF,YAAYgjC,GAI7D9lC,IAAI6V,EAAIvU,EAAEsiC,cAAcG,EAAK7xB,SAAU5T,EAAS2H,EAAO2+B,GACf,mBAA7BtmC,EAAQumC,iBACfe,EAAa19B,cAAc,gBAAgBpF,YAAYxE,EAAQumC,iBAAiBhvB,EAAGkuB,IAEnF6B,EAAa19B,cAAc,gBAAgBpF,YAAY+S,GAI3D5P,EAAMiC,cAAc,UAAUpF,YAAY8iC,QAEvC,GAnIY,CAAC,QAAS,aAAc,UAAW,aAAc,kBAAmB,eAAgB,sBAmI/E13B,SAAS42B,GAE7B,OAAOA,GACH,IAAK,QACDF,EAAatjC,EAAE2kC,cAAcrB,EAAYb,EAAKmC,YAAY,GAAInC,EAAKmC,YAAY,IAC/EnB,EAAMhB,EAAKmC,YAAY,GAAK,IAAMnC,EAAKmC,YAAY,GAGnDlmC,IAAImmC,EAAc9iC,EAAMoN,WAAU,GAClC01B,EAAcA,EAAYj+B,cAAc,aAGxClI,IAAIomC,EAAe1kC,EAAO+O,WAAU,GAOpC,OANA21B,EAAeA,EAAal+B,cAAc,mBAE1Ck+B,EAAa14B,UAAYq3B,EAEzBoB,EAAYrjC,YAAYsjC,GAEjBD,EAEX,IAAK,aACDnmC,IAAIqmC,EAAmBjB,EAAW30B,WAAU,GACxC61B,EAA0BD,EAAiBn+B,cAAc,mBAE7D68B,EAAM,GAEN,IAAK/kC,IAAIoC,EAAE,EAAEA,EAAE2hC,EAAKmC,YAAY1jC,OAAOJ,IACnCwiC,EAAatjC,EAAE2kC,cAAcrB,EAAYb,EAAKmC,YAAY9jC,GAAG,GAAI2hC,EAAKmC,YAAY9jC,GAAG,IACrF2iC,EAAMA,EAAMhB,EAAKmC,YAAY9jC,GAAG,GAAK,IAAM2hC,EAAKmC,YAAY9jC,GAAG,GAAK,IAKxE,OAFAkkC,EAAwB54B,UAAYq3B,EAE5BsB,EAAiBn+B,cAAc,kBAE3C,IAAK,UACDlI,IAAIumC,EAAgBjB,EAAQ70B,WAAU,GACtC81B,EAAgBA,EAAcr+B,cAAc,eAG5C,IAAKlI,IAAIqC,EAAE,EAAEA,EAAE0hC,EAAKmC,YAAY1jC,OAAOH,IAAK,CACxCrC,IAAI+kC,EAAM,GACNqB,EAAe1kC,EAAO+O,WAAU,GACpC21B,EAAeA,EAAal+B,cAAc,mBAG1C,IAAKlI,IAAIoC,EAAE,EAAEA,EAAE2hC,EAAKmC,YAAY7jC,GAAGG,OAAOJ,IACtCwiC,EAAatjC,EAAE2kC,cAAcrB,EAAYb,EAAKmC,YAAY7jC,GAAGD,GAAG,GAAI2hC,EAAKmC,YAAY7jC,GAAGD,GAAG,IAC3F2iC,EAAMA,EAAMhB,EAAKmC,YAAY7jC,GAAGD,GAAG,GAAK,IAAM2hC,EAAKmC,YAAY7jC,GAAGD,GAAG,GAAK,IAI9EgkC,EAAa14B,UAAYq3B,EAEzBwB,EAAczjC,YAAYsjC,GAG9B,OAAOG,EAEX,IAAK,aACDxB,EAAM,GAEN/kC,IAAIwmC,EAAmBrB,EAAW10B,WAAU,GAC5C+1B,EAAmBA,EAAiBt+B,cAAc,kBAElD,IAAKlI,IAAIuC,EAAE,EAAEA,EAAEwhC,EAAKmC,YAAY1jC,OAAOD,IACnCqiC,EAAatjC,EAAE2kC,cAAcrB,EAAYb,EAAKmC,YAAY3jC,GAAG,GAAIwhC,EAAKmC,YAAY3jC,GAAG,IACrFwiC,EAAMA,EAAMhB,EAAKmC,YAAY3jC,GAAG,GAAK,IAAMwhC,EAAKmC,YAAY3jC,GAAG,GAAK,IAGxE,OADAikC,EAAiBt+B,cAAc,mBAAmBwF,UAAYq3B,EACvDyB,EAEX,IAAK,kBACDxmC,IAAIymC,EAAwBpB,EAAgB50B,WAAU,GACtDg2B,EAAwBA,EAAsBv+B,cAAc,uBAE5D,IAAIlI,IAAIuC,EAAE,EAAEA,EAAEwhC,EAAKmC,YAAY1jC,OAAOD,IAAK,CACvCvC,IAAI+kC,EAAM,GACNqB,EAAe1kC,EAAO+O,WAAU,GACpC21B,EAAeA,EAAal+B,cAAc,mBAC1C,IAAIlI,IAAIqC,EAAE,EAAEA,EAAE0hC,EAAKmC,YAAY3jC,GAAGC,OAAOH,IACrCuiC,EAAatjC,EAAE2kC,cAAcrB,EAAYb,EAAKmC,YAAY3jC,GAAGF,GAAG,GAAI0hC,EAAKmC,YAAY3jC,GAAGF,GAAG,IAC3F0iC,EAAMA,EAAMhB,EAAKmC,YAAY3jC,GAAGF,GAAG,GAAK,IAAM0hC,EAAKmC,YAAY3jC,GAAGF,GAAG,GAAK,IAE9E+jC,EAAa14B,UAAYq3B,EACzB0B,EAAsB3jC,YAAYsjC,GAEtC,OAAOK,EAEX,IAAK,eACDzmC,IAAI0mC,EAAInB,EAAa90B,WAAU,GAC/Bi2B,EAAIA,EAAEx+B,cAAc,oBAGpB,IAAKlI,IAAIuC,EAAE,EAAEA,EAAEwhC,EAAKmC,YAAY1jC,OAAOD,IAAK,CACxCvC,IAAIumC,EAAgBjB,EAAQ70B,WAAU,GACtC81B,EAAgBA,EAAcr+B,cAAc,eAG5C,IAAKlI,IAAIqC,EAAE,EAAEA,EAAE0hC,EAAKmC,YAAY3jC,GAAGC,OAAOH,IAAK,CAC3CrC,IAAI+kC,EAAM,GACNqB,EAAe1kC,EAAO+O,WAAU,GACpC21B,EAAeA,EAAal+B,cAAc,mBAG1C,IAAKlI,IAAIoC,EAAE,EAAEA,EAAE2hC,EAAKmC,YAAY3jC,GAAGF,GAAGG,OAAOJ,IACzCwiC,EAAatjC,EAAE2kC,cAAcrB,EAAYb,EAAKmC,YAAY3jC,GAAGF,GAAGD,GAAG,GAAI2hC,EAAKmC,YAAY3jC,GAAGF,GAAGD,GAAG,IACjG2iC,EAAMA,EAAMhB,EAAKmC,YAAY3jC,GAAGF,GAAGD,GAAG,GAAK,IAAM2hC,EAAKmC,YAAY3jC,GAAGF,GAAGD,GAAG,GAAK,IAIpFgkC,EAAa14B,UAAYq3B,EAEzBwB,EAAczjC,YAAYsjC,GAE9BM,EAAE5jC,YAAYyjC,GAElB,OAAOG,EACX,IAAK,qBACD1mC,IAAI6V,EAAI2vB,EAAmB/0B,WAAU,GACrCoF,EAAIA,EAAE3N,cAAc,0BAEpB,IAAKlI,IAAIuC,EAAE,EAAEA,EAAEwhC,EAAK4C,WAAWnkC,OAAOD,IAAK,CACvCvC,IAAI4mC,EAAKtlC,EAAEsiC,cAAcG,EAAK4C,WAAWpkC,GAAIjE,EAAS2H,EAAO2+B,GAC7D/uB,EAAE/S,YAAY8jC,GAElB,OAAO/wB,EAOnB,OAHImvB,GACF/+B,EAAMiC,cAAc,UAAU6I,mBAAmB,aAAc,uDAAyD6zB,EAAW,GAAK,uBAAyBA,EAAW,GAAK,4BAA8BA,EAAW,GAAK,0BAA4BA,EAAW,GAAK,iBAEtQ3+B,EAAMiC,cAAc,WAzyB3ByJ,GA+yBW,SAAUk1B,GAErB7mC,IAAI8mC,EAAgB,GAEpBD,EAAMA,EAAIn2B,OAAOtO,IAAO,WAAW2kC,KAAK3kC,IAAKsO,OAAOtO,GAAKA,GACzD,IAAKpC,IAAIuC,EAAE,EAAGA,EAAEskC,EAAIrkC,OAAQD,GAJjB,EAKPukC,EAAcziC,KAAMwiC,EAAI3P,MAAM30B,EAAEA,EALzB,GAKkCwD,IAAIqT,SAEjD,OAAO0tB,GAvzBPn1B,GA6zBiB,SAAUqyB,GAGd,OADFA,EAAM97B,cAAc,UAE3B87B,EAAM97B,cAAc,SAASuE,SAEjCzM,IAAI+jC,EAAO,GAKX,OAJAC,EAAMp0B,iBAAiB,MAAMkU,QAAQ,IAC7BkjB,EAAYC,EAAGr3B,iBAAiB,UACpCm0B,EAAKiD,EAAU,GAAGt5B,WAAas5B,EAAU,GAAGt5B,YAEzCq2B,GAx0BPpyB,GA80BiB,SAAU2M,EAAI4oB,EAAQC,EAAMttB,GAE7C,KAAqC,aAA9ByE,EAAGpO,SAASlC,eACkB,UAA9BsQ,EAAGpO,SAASlC,eACXsQ,EAAKA,EAAGyK,kBAEhB/oB,IAAIuH,EAAO+W,EAAGpO,SACV9I,EAAI,GACJ20B,EAEJ,OAAOx0B,EAAKyG,eACR,IAAK,YAED,IACQo5B,EAFRhgC,EAAEgN,KAAO,QACLyF,GACIutB,EAAYC,MAAMxtB,UAAUqtB,EAAQC,EAAQ7oB,EAAGpW,cAAc,mBAAmBwF,UAAUvK,MAAM,WAAY4C,IAAIqT,SACpHhS,EAAE8+B,YAAc,CAACkB,EAAUhlC,EAAGglC,EAAU/kC,IAExC+E,EAAE8+B,YAAe5nB,EAAGpW,cAAc,mBAAmBwF,UAAUvK,MAAM,WAAY4C,IAAIqT,QAEzF,MACJ,IAAK,iBACDhS,EAAEgN,KAAO,aACT2nB,EAAQzd,EAAGpW,cAAc,mBAAmBwF,UAAUvK,MAAM,WAC5D44B,EAAQz6B,EAAEgmC,YAAYvL,GAClBliB,IACAkiB,EAAQz6B,EAAEimC,YAAYxL,EAAOmL,EAAQC,IAEzC//B,EAAE8+B,YAAcnK,EAChB,MACJ,IAAK,cACD30B,EAAEgN,KAAO,UACThN,EAAE8+B,YAAc,GAChBlmC,IAAIoC,EAAI,EACRkc,EAAG1O,iBAAiB,mBAAmBkU,QAAQ,IAC3CiY,EAAQA,EAAMruB,UAAUvK,MAAM,WAC9B44B,EAAQz6B,EAAEgmC,YAAYvL,GAClBliB,IACAkiB,EAAQz6B,EAAEimC,YAAYxL,EAAOmL,EAAQC,IAEzC//B,EAAE8+B,YAAY9jC,GAAK25B,EACnB35B,MAEJ,MACJ,IAAK,iBACDgF,EAAEgN,KAAO,aACT2nB,EAAQz6B,EAAEgmC,YAAYhpB,EAAGpW,cAAc,mBAAmBwF,UAAUvK,MAAM,YACtE0W,IACAkiB,EAAQz6B,EAAEimC,YAAYxL,EAAOmL,EAAQC,IAEzC//B,EAAE8+B,YAAcnK,EAChB,MACJ,IAAK,sBACD30B,EAAEgN,KAAO,kBACThN,EAAE8+B,YAAc,GAChBlmC,IAAIuC,EAAI,EACR+b,EAAG1O,iBAAiB,mBAAmBkU,QAAQ,IAC3CiY,EAAQA,EAAMruB,UAAUvK,MAAM,WAC9B44B,EAAQz6B,EAAEgmC,YAAYvL,GAClBliB,IACAkiB,EAAQz6B,EAAEimC,YAAYxL,EAAOmL,EAAQC,IAEzC//B,EAAE8+B,YAAY3jC,GAAKw5B,EACnBx5B,MAEJ,MACJ,IAAK,mBACD6E,EAAEgN,KAAO,eACThN,EAAE8+B,YAAc,GAChBlmC,IAAI8lC,EAAI,EACRxnB,EAAG1O,iBAAiB,eAAekU,QAAQ,IACvC9jB,IAAIqC,EAAI,EACR+E,EAAE8+B,YAAY7hC,KAAK,IACnBmjC,EAAK53B,iBAAiB,mBAAmBkU,QAAQ,IAC7CiY,EAAQA,EAAMruB,UAAUvK,MAAM,WAC9B44B,EAAQz6B,EAAEgmC,YAAYvL,GAClBliB,IACAkiB,EAAQz6B,EAAEimC,YAAYxL,EAAOmL,EAAQC,IAEzC//B,EAAE8+B,YAAYJ,GAAGzhC,KAAK,IACtB+C,EAAE8+B,YAAYJ,GAAGzjC,GAAK05B,EACtB15B,MAEJyjC,MAIZ,OAAO1+B,GAp6BPuK,GAw6BW,SAAUk1B,EAAKK,EAAQC,GAClCnnC,IAAIynC,EAAS,GACb,IAAKznC,IAAIuC,EAAE,EAAGA,EAAEskC,EAAIrkC,OAAQD,IAAK,CAC7BvC,IACA0nC,EAAO,EADHA,EAAOL,MAAMxtB,UAAUqtB,EAAQC,EAAMN,EAAItkC,KAChCH,EAAGslC,EAAKrlC,GACrBolC,EAAOpjC,KAAKqjC,GAEhB,OAAOD,GA/6BP91B,GAu7Ba,SAAU2Z,EAAShtB,EAAU,IAMxCA,EAAUwB,OAAOwS,OAAO,GALT,CACXq1B,iBAAkB,KAClB9tB,WAAW,GAGuBvb,GAEtC0B,IAAI+jC,EAAO,CACX3vB,KAAY,qBACZ2vB,EAAKnzB,MAAQ0a,EAAQ3nB,aAAa,SAClCogC,EAAKj4B,SAAW,GAGhB9L,IAAIknC,EAAS,KACTC,EAAO,KACP7oC,EAAQub,YACRqtB,EAAS,IAAIG,MAAMO,KAAKtc,EAAQ3iB,cAAchJ,KAAKrB,QAAQ0E,IAAI6kC,MAC/DV,EAAO,IAAIE,MAAMO,KAAK,aAC8B,cAAhDtc,EAAQ3iB,cAAchJ,KAAKrB,QAAQ0E,IAAI6kC,MAAyE,cAAjDvc,EAAQ3iB,cAAchJ,KAAKrB,QAAQ0E,IAAI6kC,OACtGvpC,EAAQub,WAAY,IAK5B7Z,IAAI8nC,EAAQxc,EAAQ1b,iBAAiB,YACrCk4B,EAAMhkB,QAAQ,IAEV,GAAa,WADFrgB,EAAKE,aAAa,QACN,CACnB3D,IAAI6N,EAAUpK,EAAKE,aAAa,WAC5BkjC,EAAMh5B,EAAQ1K,MAAM,KACpB4kC,EAAK,GACT,IAAK/nC,IAAIuC,EAAE,EAAGA,EAAEskC,EAAIrkC,OAAQD,IAAK,CAC7BvC,IAAI4iC,EAAIiE,EAAItkC,GAAGY,MAAM,KACrBy/B,EAAE,GAAKA,EAAE,GAAGtV,OACZsV,EAAE,GAAKvpB,WAAWupB,EAAE,IACpBmF,EAAGnF,EAAE,IAAMA,EAAE,GAEjBmB,EAAKkB,KAAO,CAAC8C,EAAG,sBAAuBA,EAAG,qBAAsBA,EAAG,0BAA2BA,EAAK,6BAK3G/nC,IAAI8L,EAAWwf,EAAQ1b,iBAAiB,eACpCo4B,EAAM,EA8DV,OA3DAl8B,EAASgY,QAAQ,IAQb,IAQQjT,EAbRkzB,EAAKj4B,SAASk8B,GAAO,CAAC5zB,KAAQ,WAC9B2vB,EAAKj4B,SAASk8B,GAAK91B,SAAW,GAC9B6xB,EAAKj4B,SAASk8B,GAAKn3B,WAAa,GAG3B/D,EAAQ5E,cAAc,kBAEoB,mBAA7B5J,EAAQqpC,kBAClB92B,EAAavS,EAAQqpC,iBAAiB76B,EAAQ5E,cAAc,mBAChE67B,EAAKj4B,SAASk8B,GAAKn3B,WAAaA,GAC0C,OAAnE/D,EAAQ5E,cAAc,kBAAkBA,cAAc,UAEzD87B,EAASl3B,EAAQ5E,cAAc,kBAAkBA,cAAc,SAAUuI,WAAU,GACnFI,EAAavP,EAAE2mC,kBAAkBjE,GACrCD,EAAKj4B,SAASk8B,GAAKn3B,WAAaA,GAGhCkzB,EAAKj4B,SAASk8B,GAAKn3B,WAAa,CAACq3B,MAAQp7B,EAAQ5E,cAAc,kBAA2B,UAAEs0B,QAAS,gBAAiB,KAXxHuH,EAAKj4B,SAASk8B,GAAKn3B,WAAa,KAclC7Q,IAAIm3B,EAAOrqB,EAAQ5E,cAAc,gBAAgB6gB,kBAGjD,KAAuC,aAAhCoO,EAAKjnB,SAASlC,eACkB,UAAhCmpB,EAAKjnB,SAASlC,eACbmpB,EAAOA,EAAKpO,kBAIgB,2BAAhCoO,EAAKjnB,SAASlC,cACd+1B,EAAKj4B,SAASk8B,GAAK91B,SAAW5Q,EAAE6mC,kBAAkBhR,EAAM+P,EAAQC,EAAM7oC,EAAQub,YAE9EkqB,EAAKj4B,SAASk8B,GAAK91B,SAASkC,KAAO,qBACnC2vB,EAAKj4B,SAASk8B,GAAK91B,SAASy0B,WAAa,GAErCyB,EAAQjR,EAAK1vB,SACjBwvB,MAAM8H,KAAKqJ,GAAOtkB,QAAQ,IAExB9jB,IAAIqoC,EAAIxyB,EAAE3F,SAASlC,cACT,aAANq6B,GAA0B,UAANA,GAEtB,KADAxyB,EAAIA,EAAEpF,WAAU,IACVb,iBAAiB,oBAAoBkU,QAAQljB,GAAKA,EAAE0nC,eAAe1nC,EAAE6G,WAC3EwvB,MAAM8H,KAAKlpB,EAAEpO,UAAUqc,QAAQ,IAC7BvhB,EAAIjB,EAAE6mC,kBAAkB5lC,EAAG2kC,EAAQC,EAAM7oC,EAAQub,WACjDkqB,EAAKj4B,SAASk8B,GAAK91B,SAASy0B,WAAWtiC,KAAK9B,OAG9CsT,EAAIvU,EAAE6mC,kBAAkBtyB,EAAGqxB,EAAQC,EAAM7oC,EAAQub,WACjDkqB,EAAKj4B,SAASk8B,GAAK91B,SAASy0B,WAAWtiC,KAAKwR,OAKpDmyB,MAGGjE,GAjiCTpyB,GAuiCU,SAAU42B,EAAOxiC,EAAK3E,EAASD,GACzC,GAAIonC,EAAJ,CAEAvoC,IAAIwoC,EAAUziC,EAAIjF,UACdkO,EAAQjJ,EAAIzH,QAAQ0E,IAAIgM,MAAMw5B,GAC9BC,EAAgB1iC,EAAIzH,QAAQ0E,IAAImV,eAAe0B,UAAU0uB,EAAMtqB,WAAU,GAAOjP,GAEpFhP,IAAI0oC,EAAU3iC,EAAI+Y,UAAUhF,SAAS,GACjC6uB,EAAWF,EAAcr5B,SAASs5B,GAASp5B,QAC3Cs5B,EAAWH,EAAc33B,IAAI43B,GAASp5B,QAEtCu5B,EAAevnC,EAAE2gC,iBAAiB0G,EAAUH,EAASziC,EAAIzH,QAAQsB,YACjEkpC,EAAexnC,EAAE2gC,iBAAiB2G,EAAUJ,EAASziC,EAAIzH,QAAQsB,YAErEI,IAAI+oC,EAAUpqC,EAAEsE,OAAO4lC,EAAcC,GACjCE,EAAUD,EAAQvyB,SAAS+xB,GAAS,GAAK,EAE7C,MAAoB,GAAbS,IAAoBD,EAAQvyB,SAAS+xB,IAAYC,EAAU,GAAMpnC,GACrD,GAAZ4nC,GAAiBD,EAAQvyB,SAAS+xB,IAAWC,EAAU,GAAMrnC,GAClEqnC,GAAWQ,EACXh6B,EAAQjJ,EAAIzH,QAAQ0E,IAAIgM,MAAMw5B,GAC9BC,EAAgB1iC,EAAIzH,QAAQ0E,IAAImV,eAAe0B,UAAU0uB,EAAMtqB,WAAU,GAAOjP,GAEhF25B,EAAWF,EAAcr5B,SAASs5B,GAASp5B,QAC3Cs5B,EAAWH,EAAc33B,IAAI43B,GAASp5B,QACtCu5B,EAAevnC,EAAE2gC,iBAAiB0G,EAAUH,EAASziC,EAAIzH,QAAQsB,YACjEkpC,EAAexnC,EAAE2gC,iBAAiB2G,EAAUJ,EAASziC,EAAIzH,QAAQsB,YAEjEmpC,EAAUpqC,EAAEsE,OAAO4lC,EAAcC,GAInC,OADe,GAAZE,GAAgC,GAAfR,EAAU,IAAYA,IAAYrnC,IAAW4nC,EAAQvyB,SAAS+xB,KAASC,IACpFA,IAIPS,GAAoBtqC,EAAE2F,QAAQ4kC,YAAYrqC,OAAO,CACpDP,QAAS,CACR6qC,OAAQ,yhBAGT3pC,MAAO,SAAUuG,GAKhB,IAAK,IAAIxD,KAJTwD,EAAIynB,mBAAqBzuB,MACpB0G,WAAa9G,EAAEoK,QAAQyC,OAAO,UAAW,+BAC9C7M,EAAE4G,SAAS6jC,wBAAwBrqC,KAAK0G,YAE1BM,EAAIf,QACbe,EAAIf,QAAQzC,GAAGiiB,gBAClBzlB,KAAK0uB,eAAe1nB,EAAIf,QAAQzC,GAAGiiB,kBAIrCzlB,KAAK6G,UAELG,EAAIV,GAAG,WAAYtG,KAAKsqC,gBAAiBtqC,MAEzCiB,IAAIspC,EAASvnC,SAASC,cAAc,UAWpC,OAVAsnC,EAAOnnC,aAAa,QAAS,oBAC7BmnC,EAAOnnC,aAAa,YAAa,IACjCmnC,EAAO9X,QAAU,SAAU5wB,GAC1BA,EAAEqiB,mBAEHqmB,EAAO57B,gBAAkBpM,EAAEhD,QAAQgzB,OAAOiY,wGAC/BjoC,EAAEhD,QAAQgzB,OAAOkY,wCAAwCloC,EAAEhD,QAAQgzB,OAAOmY,sCAAsCnoC,EAAEhD,QAAQgzB,OAAOoY,wCAAwCpoC,EAAEhD,QAAQgzB,OAAOqY,wCAAwCroC,EAAEhD,QAAQgzB,OAAOsY,oCAAoCtoC,EAAEhD,QAAQgzB,OAAOuY,kCAAkCvoC,EAAEhD,QAAQgzB,OAAOwY,mFAAmFxoC,EAAEhD,QAAQgzB,OAAOyY,yFAAyFzoC,EAAEhD,QAAQgzB,OAAOyY,6DAA6DzoC,EAAEhD,QAAQgzB,OAAO0Y,8BACvnB1oC,EAAEhD,QAAQgzB,OAAO2Y,8CAA8C3oC,EAAEhD,QAAQgzB,OAAO4Y,mDAAmD5oC,EAAEhD,QAAQgzB,OAAO6Y,2BAC/JpkC,EAAIN,WAAW3C,YAAYwmC,GAEpBvqC,KAAK0G,YAGbG,QAAS,WACR,GAAK7G,KAAKY,KAAV,CAEA,IAES4C,EAFL6nC,EAAU,GAEd,IAAS7nC,KAAKxD,KAAKsrC,cACdtrC,KAAKsrC,cAAc9nC,IACtB6nC,EAAQ/lC,KAAK9B,GAIf,IAAI+nC,EAAmB,GAEnBvrC,KAAKT,QAAQ6qC,QAChBmB,EAAiBjmC,KAAKtF,KAAKT,QAAQ6qC,QAEhCiB,EAAQ5nC,QACX8nC,EAAiBjmC,KAAK+lC,EAAQxW,KAAK,OAEpC70B,KAAK0G,WAAWiI,UAAY,miBAA8iBpM,EAAEhD,QAAQgzB,OAAOiY,2BAA6Be,EAAiB1W,KAAK,uCAAyC,SACvrB70B,KAAK0G,WAAWtD,aAAa,OAAO,SACpCpD,KAAK0G,WAAWtD,aAAa,aAAa,GAAGb,EAAEhD,QAAQgzB,OAAOiZ,oBAIhE5rC,EAAE6rC,IAAIC,aAAa,CAClBjd,oBAAoB,EACpBkd,8BAA8B,IAG/B/rC,EAAE6rC,IAAIG,YAAY,WACb5rC,KAAKT,QAAQosC,+BAChB,IAAIzB,IAAoBppB,MAAM9gB,QAIR,SAApB6rC,GAA8BtsC,GACjC,OAAO,IAAI2qC,GAAkB3qC,GAiEX,SAAfusC,GAAyBvsC,GAC3B,OAAO,IAAIwsC,GAAaxsC,GA4FX,SAAXysC,GAAqBzsC,GACxB,OAAO,IAAI0sC,GAAS1sC,GAhKrB,IAIIwsC,GAAensC,EAAE2F,QAAQzF,OAAO,CAClCP,QAAS,CACPya,SAAU,WAGZvZ,MAAO,SAAUuG,GACf/F,IAAIwD,EAAY7E,EAAEoK,QAAQyC,OAAO,MAAO,mCAExCxL,IAAIgjC,EAAOrkC,EAAEoK,QAAQyC,OAAO,SAAU,sBAAuBhI,GAgB7D,OAfAw/B,EAAKt1B,UAAY,2CACjBs1B,EAAKpyB,MAAQtP,EAAEhD,QAAQgzB,OAAO4H,SAC9B8J,EAAK7gC,aAAa,OAAQ,UAC1B6gC,EAAKryB,UAAUG,IAAI,gBACnBkyB,EAAK7gC,aAAa,aAAc,UAEhCxD,EAAE4G,SAAS6jC,wBAAwBpG,GACnCrkC,EAAE4G,SAASF,GAAG29B,EAAM,QAASrkC,EAAE4G,SAASigB,MACxC7mB,EAAE4G,SAASF,GAAG29B,EAAM,QAASjkC,KAAKksC,UAAWlsC,MAE7CA,KAAKmsC,cAAgBlI,EAErBjkC,KAAKosC,kBACLplC,EAAIV,GAAG,UAAWtG,KAAKosC,gBAAiBpsC,MAEjCyE,GAGTsC,SAAU,SAAUC,GAClBA,EAAIC,IAAI,UAAWjH,KAAKosC,gBAAiBpsC,OAG3CqsC,QAAS,WAGP,OAFArsC,KAAKssC,WAAY,EACjBtsC,KAAKosC,kBACEpsC,MAGTusC,OAAQ,WAGN,OAFAvsC,KAAKssC,WAAY,EACjBtsC,KAAKosC,kBACEpsC,MAGTksC,UAAW,SAAUrqC,IACd7B,KAAKssC,WAAuD,EAA1CtsC,KAAKY,KAAKrB,QAAQkH,MAAMgY,SAAShb,QACtDzD,KAAKY,KAAKrB,QAAQkH,MAAM+2B,UAI5B4O,gBAAiB,WACfzjC,WAAW,KACT/I,EAAEoK,QAAQC,YAAYjK,KAAKmsC,cAAe,oBAC1CnsC,KAAKmsC,cAAc/oC,aAAa,gBAAiB,SAE7CpD,KAAKY,OAASZ,KAAKssC,WAAatsC,KAAKY,KAAKrB,QAAQkH,MAAMgY,SAAShb,QAAU,KAC7E7D,EAAEoK,QAAQ2C,SAAS3M,KAAKmsC,cAAe,oBACvCnsC,KAAKmsC,cAAc/oC,aAAa,gBAAiB,UAElD,MAQH6oC,GAAWrsC,EAAE2F,QAAQinC,MAAM1sC,OAAO,CAClCP,QAAS,CACPktC,SAAU,IACVC,gBAAgB,EAChB1yB,SAAU,cAGZvZ,MAAO,SAAUuG,GAIfA,EAAIN,WAAWsL,mBAAmB,YADhB,kHAIlBhS,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAM,uBACzCxL,IAAI0rC,EAAe/sC,EAAE2F,QAAQinC,MAAMnrC,UAAUZ,MAAMa,KAAKtB,KAAMgH,GAiB9D,OAhBAhH,KAAK0G,WAAW3C,YAAY4oC,GAC5B3sC,KAAK0G,WAAWtD,aAAa,WAAW,GACxCpD,KAAK4sC,cAAgB5sC,KAGrB2I,WAAW,KACT3I,KAAK6sC,gBACL7sC,KAAK8sC,gBACJ,GAGH9lC,EAAIV,GAAG,kBAAmBtG,KAAK6sC,cAAe7sC,MAG9CA,KAAKY,KAAK8F,WAAWi+B,iBAAiB,QAAS,IAAM3kC,KAAK8sC,gBAEnD9sC,KAAK0G,YAGdK,SAAU,SAAUC,GAClBA,EAAIC,IAAI,kBAAmBjH,KAAK6sC,cAAe7sC,OAGjDu8B,aAAc,WACZ,OAAOv8B,KAAK0G,YAGdqmC,kBAAmB,SAAUC,EAAIlzB,GAC/B7Y,IAAIgsC,EAAgC,GAA1B1I,OAAO2I,iBACjB,MAAc,WAAVpzB,EACKkzB,EAAKC,EAAM,KAEbD,EAAKC,GAGdE,aAAc,SAAUl9B,GACtBhP,IAAImsC,EAAcn9B,EAAMrL,aAAa,SAGrC,OAFkB6V,SAAS2yB,EAAY5yB,MAAM,oBAAoB,KAMnEsyB,aAAc,WACZnkC,WAAW,KACT1H,IAAIosC,EAAcrtC,KAAKY,KAAK8F,WAAWyC,cAAc,qCACrDkkC,EAAY/e,YAAc,GAC1B3lB,WAAW,KACT0kC,EAAY/e,YAActuB,KAAK0G,WAAW9B,aAAa,eACtD,MACF,IAGLioC,cAAe,WACb5rC,IAAIqsC,EAAS,GACTC,EAAYvtC,KAAK4sC,cAAcrQ,eAAeh0B,uBAAuB,8BAA8B,GAEvG,IAMMilC,EAFJF,EAJEttC,KAAKT,QAAQkuC,QACXD,EAAWlzB,WAAYta,KAAK+sC,kBAAkB/sC,KAAKmtC,aAAaI,GAAW,UAAW5Y,QAAQ,IAClG2Y,EAAYE,EAAH,mBAA8BD,EAAUjf,YAAYC,OAC7D+e,EAASA,EAAO7P,QAAQ,eAAgB,aAC/B6P,EAAO7P,QAAQ,OAAQ,iBAE5B+P,EAAWlzB,WAAYta,KAAK+sC,kBAAkB/sC,KAAKmtC,aAAaI,GAAW,YAAa5Y,QAAQ,IACpG2Y,EAAYE,EAAH,cAAyBD,EAAUjf,YAAYC,OACxD+e,EAASA,EAAO7P,QAAQ,MAAO,QACtB6P,EAAO7P,QAAQ,MAAO,UAGjCz9B,KAAK0G,WAAWtD,aAAa,aAAckqC,GAC3CttC,KAAKY,KAAK8F,WAAWyC,cAAc,qCAAqCmlB,YAAcgf,KAOxFI,GAAmB9tC,EAAE2F,QAAQzF,OAAO,CAChCP,QAAS,CACLya,SAAU,UACVnI,MAAO,CACH87B,MAAS,kBACTC,KAAQ,oBAIhBntC,MAAO,SAAUuG,GACb,IAAIvC,EAAY7E,EAAEoK,QAAQyC,OAAO,MAAO,0DAYxC,OAVAzM,KAAKikC,KAAOrkC,EAAEoK,QAAQyC,OAAO,IAAK,qDAAsDhI,GACxFzE,KAAKikC,KAAK1yB,KAAO,IACjBvR,KAAKikC,KAAK7gC,aAAa,OAAQ,UAE/BpD,KAAKY,KAAOoG,EACZhH,KAAKY,KAAK0F,GAAG,mBAAoBtG,KAAK6tC,aAAc7tC,MACpDA,KAAK6tC,eAELjuC,EAAE4G,SAASF,GAAGtG,KAAKikC,KAAM,QAASjkC,KAAK8tC,OAAQ9tC,MAExCyE,GAGXsC,SAAU,SAAUC,GAChBA,EAAIC,IAAI,mBAAoBjH,KAAK6tC,aAAc7tC,OAGnD8tC,OAAQ,SAAUjsC,GACdjC,EAAE4G,SAAS0d,gBAAgBriB,GAC3BjC,EAAE4G,SAASiE,eAAe5I,GAC1B7B,KAAKY,KAAKmtC,iBAAiB/tC,KAAKT,UAGpCsuC,aAAc,WACV7tC,KAAKikC,KAAKpyB,MAAQ7R,KAAKT,QAAQsS,MAAM7R,KAAKY,KAAKotC,mBAIvDpuC,EAAE6rC,IAAIwC,QAAQ,CACVD,aAAc,WACV,OAAOhuC,KAAKkuC,gBAAiB,GAGjCH,iBAAkB,SAAUxuC,GAGxB,IAAIkH,EAAQzG,KAAKu8B,eAAe4R,cAAcC,KAC1C3pC,EAA+B,QAAnBgC,EAAM0K,SAAqB1K,EAAMmD,cAAgBnD,EAC7DzG,KAAKguC,eACDzuC,GAAWA,EAAQ8uC,iBACnBruC,KAAKsuC,yBAAyB7pC,GACvBzB,SAASurC,eAChBvrC,SAASurC,iBACFvrC,SAASwrC,oBAChBxrC,SAASwrC,sBACFxrC,SAASyrC,uBAChBzrC,SAASyrC,yBACFzrC,SAAS0rC,iBAChB1rC,SAAS0rC,mBAET1uC,KAAKsuC,yBAAyB7pC,GAG9BlF,GAAWA,EAAQ8uC,iBACnBruC,KAAK2uC,wBAAwBlqC,GACtBA,EAAUmqC,kBACjBnqC,EAAUmqC,oBACHnqC,EAAUoqC,qBACjBpqC,EAAUoqC,uBACHpqC,EAAUqqC,wBACjBrqC,EAAUqqC,wBAAwBtgB,QAAQugB,sBACnCtqC,EAAUuqC,oBACjBvqC,EAAUuqC,sBAEVhvC,KAAK2uC,wBAAwBlqC,IAMzCkqC,wBAAyB,SAAUlqC,GAC/B7E,EAAEoK,QAAQ2C,SAASlI,EAAW,6BAC9BzE,KAAKivC,gBAAe,GACpBjvC,KAAK0K,KAAK,qBAGd4jC,yBAA0B,SAAU7pC,GAChC7E,EAAEoK,QAAQC,YAAYxF,EAAW,6BACjCzE,KAAKivC,gBAAe,GACpBjvC,KAAK0K,KAAK,qBAGdukC,eAAgB,SAASC,GACrBlvC,KAAKkuC,cAAgBgB,EACrB,IAAIzqC,EAAYzE,KAAKu8B,eAAe4R,cAAcC,KAC9Cc,EACAtvC,EAAEoK,QAAQ2C,SAASlI,EAAW,uBAE9B7E,EAAEoK,QAAQC,YAAYxF,EAAW,uBAErCzE,KAAKmvC,kBAGTC,oBAAqB,SAAUvtC,GAC3B,IAAIwtC,EACArsC,SAASqsC,mBACTrsC,SAASssC,sBACTtsC,SAASusC,yBACTvsC,SAASwsC,oBACT/oC,EAAQzG,KAAKu8B,eAAe4R,cAAcC,KAC1C3pC,EAA+B,QAAnBgC,EAAM0K,SAAqB1K,EAAMmD,cAAgBnD,EAG7D4oC,IAAsB5qC,GAAczE,KAAKkuC,cAGlCmB,IAAsB5qC,GAAazE,KAAKkuC,gBAC/CluC,KAAKivC,gBAAe,GACpBjvC,KAAK0K,KAAK,sBAJV1K,KAAKivC,gBAAe,GACpBjvC,KAAK0K,KAAK,wBAQtB9K,EAAE6rC,IAAIC,aAAa,CACf+D,mBAAmB,IAGvB7vC,EAAE6rC,IAAIG,YAAY,WAMd,IAAI8D,EAaIC,EAlBJ3vC,KAAKT,QAAQkwC,oBACbzvC,KAAKyvC,kBAAoB,IAAI/B,GAAiB1tC,KAAKT,QAAQkwC,mBAC3DzvC,KAAK4vC,WAAW5vC,KAAKyvC,oBAKrB,uBAAwBzsC,SACxB0sC,EAAmB,mBACZ,0BAA2B1sC,SAClC0sC,EAAmB,sBACZ,6BAA8B1sC,SACrC0sC,EAAmB,yBACZ,yBAA0B1sC,WACjC0sC,EAAmB,sBAGnBA,IACIC,EAAqB/vC,EAAEob,KAAKhb,KAAKovC,oBAAqBpvC,MAE1DA,KAAK6vC,UAAU,WACXjwC,EAAE4G,SAASF,GAAGtD,SAAU0sC,EAAkBC,KAG9C3vC,KAAKsG,GAAG,SAAU,WACd1G,EAAE4G,SAASS,IAAIjE,SAAU0sC,EAAkBC,QAKhC,SAAnBG,GAA6BvwC,GAC7B,OAAO,IAAImuC,GAAiBnuC,GA4CZ,SAApBwwC,GAA8BxwC,GAChC,OAAO,IAAIywC,GAAkBzwC,GAuFf,SAAZ0wC,GAAsB1wC,GACxB,OAAO,IAAI2wC,GAAU3wC,GA+WT,SAAVwO,GAAoB6I,EAAQrX,GAC9B,OAAO,IAAI4wC,GAAQv5B,EAAQrX,GA6RP,SAAlB2e,GAA4B3e,GAC9B,OAAO,IAAI4X,GAAgB5X,GA8MV,SAAf0U,GAAyBvU,EAAQH,GACnC,OAAO,IAAI+M,GAAa5M,EAAQH,GAn+B9B,IAIAywC,GAAoBpwC,EAAE2F,QAAQzF,OAAO,CACvCP,QAAS,CACLya,SAAU,eAGdvZ,MAAO,SAAUuG,GACfhH,KAAKowC,cAAgBxwC,EAAE2nB,QAAQ8oB,OAAO,CACpCC,WAAW,EACXC,QAAS,CACP1+B,MAAOtP,EAAEhD,QAAQgzB,OAAOie,gBAE1Bx2B,SAAUha,KAAKT,QAAQya,SACvBy2B,cAAe,CACbruC,QAAS,MAEV0e,MAAM9Z,GAET,IAAIvC,EAAYzE,KAAKowC,cAAc1pC,WAC/Bw5B,EAASlgC,KAAKowC,cAelB,OAde,IAAIM,iBAAiB,SAASC,GACvClsC,EAAUmN,UAAU6F,SAAS,WAAahT,EAAUmN,UAAU6F,SAAS,cACzEhT,EAAUyJ,WAAW2D,MAAQtP,EAAEhD,QAAQgzB,OAAOqe,cAC9C1Q,EAAO2Q,QAAQv+B,YAAY/P,EAAEhD,QAAQgzB,OAAOue,gBAAgB,CAACC,WAAU,KAC9DtsC,EAAUmN,UAAU6F,SAAS,WACtChT,EAAUyJ,WAAW2D,MAAQtP,EAAEhD,QAAQgzB,OAAOye,qBAC9C9Q,EAAO2Q,QAAQv+B,YAAY/P,EAAEhD,QAAQgzB,OAAO0e,2BAE5CxsC,EAAUyJ,WAAW2D,MAAQtP,EAAEhD,QAAQgzB,OAAOie,iBAIzCU,QAAQzsC,EADI,CAAE0sC,YAAY,EAAMC,gBAAiB,CAAC,WAGpD3sC,GAGTgiB,KAAM,WACJ,OAAOzmB,KAAKowC,cAAc3pB,UAQ1BypB,GAAYtwC,EAAE2b,MAAMzb,OAAO,CAC7BW,MAAO,SAAUuG,GAMfhH,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,kBAAmBzF,EAAIN,YACjE1G,KAAK0G,WAAWiI,UAHG,4yBAInB3H,EAAIqwB,WAAY,EAChBr3B,KAAKqxC,cAAe,EAEpBrqC,EAAIV,GAAG,iDAAkDtG,KAAKsxC,cAAetxC,MAC7EgH,EAAIV,GAAG,YAAatG,KAAKuxC,cAAevxC,MACxCJ,EAAE4G,SAASF,GAAGU,EAAIN,WAAY,0BAA2B1G,KAAKuxC,cAAevxC,MAE7EA,KAAKwxC,yBAGPzqC,SAAU,SAAUC,GAClBA,EAAIC,IAAI,iDAAkDjH,KAAKsxC,eAC/DtqC,EAAIC,IAAI,YAAajH,KAAKuxC,eAC1B3xC,EAAE4G,SAASS,IAAID,EAAIN,WAAY,0BAA2B1G,KAAKuxC,gBAGjED,cAAe,WACTtxC,KAAKyxC,qBACPzxC,KAAKY,KAAK0F,GAAG,yBAA0BtG,KAAKwxC,sBAAuBxxC,MAEnEA,KAAKY,KAAKqG,IAAI,yBAA0BjH,KAAKwxC,sBAAuBxxC,MAEtEA,KAAKwxC,yBAGPA,sBAAuB,SAAU3vC,GAC3B7B,KAAKyxC,qBACPzxC,KAAK0G,WAAWc,gBAAgB,UAEhCxH,KAAK0G,WAAWtD,aAAa,SAAU,KAI3CsuC,uBAAwB,SAAU7vC,GAChCZ,IAAI0wC,EAAe3xC,KAAKY,KAAK8F,WACzB1G,KAAKY,KAAKy2B,YAAcr3B,KAAK4xC,SAC/B5xC,KAAK4xC,SAAWhyC,EAAEoK,QAAQyC,OAAO,MAAO,gBAAiBklC,IAC/C3xC,KAAKY,KAAKy2B,WAAar3B,KAAK4xC,WACtChyC,EAAEoK,QAAQ0D,OAAO1N,KAAK4xC,iBACf5xC,KAAK4xC,WAIhBH,mBAAoB,WAClBxwC,IAAIvB,EAASM,KAAKY,KAAKrB,QAAQkH,MAAM/G,OACrC,GAAIM,KAAKY,KAAKy2B,UACZ,IAAKp2B,IAAIiG,KAASxH,EAChB,GAAIwH,EAAMW,SAAWX,EAAMojB,OAAOuC,UAChC,OAAO,EAIb,OAAO,GAIT0kB,cAAe,SAAU1vC,GAEvB,IAIIgwC,EAJA7xC,KAAKY,KAAK8F,WAAW6X,WAAW6hB,gBAIhCyR,EAAqB7xC,KAAKY,KAAK8F,WAAW6X,WAAW6hB,cAAcxuB,UAAU6F,SAAS,uBAChE,CAAC,WAAWtI,SAAStN,EAAEwT,OAAUxT,EAAE0vB,UAA0B,IAAd1vB,EAAEwvB,QACzErxB,KAAKY,KAAKy2B,WAAY,EACjBr3B,KAAKY,KAAKy2B,UAAYwa,GAAsB,CAAC,QAAS,WAAW1iC,SAAStN,EAAEwT,MAEhFrV,KAAKY,KAAKy2B,WAAWr3B,KAAKY,KAAK8J,KAAK,sBACvC1K,KAAK0xC,yBACL1xC,KAAKwxC,yBAVHxxC,KAAKY,KAAKy2B,WAAY,KAwCxB8Y,GAAUvwC,EAAEs2B,KAAKp2B,OAAO,CAO1BC,WAAY,SAAU6W,EAAQrX,GAC5BS,KAAKqV,KAAOuB,EAAOlN,QAAQuF,cAEV,cAAdjP,KAAKqV,MAAsC,mBAAdrV,KAAKqV,OAA2B9V,EAAQq2B,YAAc,GAEzD,EAA1Br2B,EAAQoU,SAASlQ,SAClBlE,EAAUwB,OAAOwS,OAAOvT,KAAK8xC,iBAAiBvyC,EAAQoU,UAAWpU,IACnEK,EAAES,WAAWL,KAAMT,GAEnBS,KAAK2S,MAAQ3S,KAAKT,QAAQoT,MAC1B3S,KAAKT,QAAQgT,YAAcvS,KAAKT,QAAQ0kC,MAASjkC,KAAKT,QAAQuS,YAAc9R,KAAKT,QAAQ8S,cAEzFrS,KAAKw2B,OAAS,GACdx2B,KAAK+xC,QAAUn7B,EACf5W,KAAKT,QAAQiF,KAAOoS,EAAOhS,aAAa,SAAW5E,KAAKT,QAAQuF,WAEhE9E,KAAKgyC,kBAEFp7B,EAAOzN,cAAc,aAAeyN,EAAOzN,cAAc,WAC1DnJ,KAAKiyC,yBAGPjyC,KAAKkyC,SAAWlyC,KAAKmyC,aASvBC,kBAAmB,SAAU5pC,EAAMy7B,EAAMC,GACvCjjC,IAAIoxC,EAAW5tC,EAAYzB,SAASC,cAAc,OAAQ8jC,EAAI/jC,SAASC,cAAc,KAAMqvC,GAAU,EACrG7tC,EAAUmN,UAAUG,IAAI,sBACxBtN,EAAUV,YAAYgjC,GACtBv+B,EAAKoJ,UAAUG,IAAI,SACfkyB,EAAKsO,SAAS/pC,EAAKoJ,UAAUG,IAAI,iBACrCvJ,EAAKq0B,UAAYh7B,GAAKwwC,EAAY,CAAChvC,EAAExB,EAAEumB,QAAS9kB,EAAEzB,EAAE8lB,SACpD/nB,EAAE4G,SAASF,GAAGkC,EAAM,YAAaA,EAAKq0B,UAAW78B,MACjDwI,EAAKgqC,QAAU,IACb,GAAiB,IAAb3wC,EAAEq+B,OAAN,CACAj/B,IAAIwxC,GAAQ,EAAMC,EAAY1yC,KAAKT,QAAQgO,cAAczF,SAAS+hB,mBAClE,KAAM6oB,GAAaD,GACdC,EAAUhpC,SAA+C,WAApCgpC,EAAUhpC,QAAQuF,gBACxCwjC,IAAUC,EAAU7qC,SAAW6qC,EAAUpoB,OAAOuC,YAClD6lB,EAAYA,EAAU7oB,mBAErB4oB,GAASJ,GAGPxwC,EAAE8wC,aAAeC,MAAMC,gBACf5tC,KAAK6tC,KAAK7tC,KAAK8tC,IAAIV,EAAUhvC,EAAIxB,EAAEumB,QAAS,GAAKnjB,KAAK8tC,IAAIV,EAAU/uC,EAAIzB,EAAE8lB,QAAS,KAClF,IACVsc,EAAKsO,SAAU,EACf/pC,EAAKpF,aAAa,SAAU,WAC5BoF,EAAKoJ,UAAUG,IAAI,iBACnBxP,EAAEywC,YAAY/O,EAAMC,MAI1BtkC,EAAE4G,SAASF,GAAGkC,EAAM,UAAWA,EAAKgqC,QAASxyC,MAC7CJ,EAAE4G,SAASF,GAAGkC,EAAM,WAAY,IAC9B5I,EAAE4G,SAASigB,KAAK5kB,GACC,KAAdA,EAAEwvB,SAAgC,KAAdxvB,EAAEwvB,UACvB4S,EAAKsO,SAAU,EACf/pC,EAAKpF,aAAa,SAAU,WAC5BoF,EAAKoJ,UAAUG,IAAI,iBACnBxP,EAAEywC,YAAY/O,EAAMC,KAErBlkC,MACHJ,EAAE4G,SAASF,GAAGkC,EAAM,mBAAoB,IACtC,GAAG3G,EAAE4H,SAAW5H,EAAEoxC,cAAlB,CACAX,GAAU,EACVrxC,IAAIiyC,EAAWlwC,SAASC,cAAc,KAAMkwC,EAAWnzC,KAAKY,KAAK27B,eAAe6W,YAMhF,IALAF,EAAS3hC,KAAO0yB,EAAKr4B,IACrBm7B,EAAEp4B,UAAYukC,EAAS3hC,KAEvBvR,KAAKY,KAAK27B,eAAex4B,YAAYU,GAE/BsiC,EAAEqM,YAAcD,EAAS,GAC7BpM,EAAEp4B,UAAYo4B,EAAEp4B,UAAU0kC,UAAU,EAAGtM,EAAEp4B,UAAUlL,OAAS,GAAK,MAEnEkF,WAAW,KACN2pC,IAASvL,EAAEp4B,UAAYukC,EAAS3hC,OAClC,OACFvR,MACHJ,EAAE4G,SAASF,GAAGkC,EAAM,6BAA8B,IAC7C3G,EAAE4H,SAAW5H,EAAEoxC,eAAkBxuC,EAAUmF,gBAC9C0oC,GAAU,EACVtyC,KAAKY,KAAK27B,eAAetpB,YAAYxO,KACpCzE,MACHJ,EAAE4G,SAASF,GAAG49B,EAAatjC,KAAK27B,eAAe,4BAA6B,IACtE93B,EAAUmF,gBACd0oC,GAAU,EACVtyC,KAAKY,KAAK27B,eAAetpB,YAAYxO,KACpCzE,OAULqX,SAAU,SAAUi8B,EAAUC,OAAa71B,EAAW81B,OAAY91B,GAChEzc,IAAI+F,EAAMssC,GAAYtzC,KAAKY,KAAM6yC,EAASF,GAAcvsC,EAAIma,iBAAkB3c,OAAqBkZ,IAAd81B,EAA0BxsC,EAAIjF,UAAYyxC,EAC/H,IAAKvyC,IAAI8lC,KAAK/mC,KAAKw2B,OAAQ,CACzBuQ,EAAE2M,WAAa1zC,KAAK2zC,aAAa5M,EAAE6M,MAAO5sC,EAAKysC,EAAQjvC,GACvD,IAAKvD,IAAI4yC,KAAQ9M,EAAE+M,SACjBD,EAAKE,cAAgB/zC,KAAK2zC,aAAa,CAACE,GAAO7sC,EAAKysC,EAAQjvC,GAGhE,GAAKxE,KAAK4xC,SAAV,CACA5xC,KAAKg0C,aAAe,GACpB,IAAK/yC,IAAIgzC,KAAKj0C,KAAK4xC,SACjB5xC,KAAKg0C,aAAeh0C,KAAKg0C,aAAa5/B,OAAOpU,KAAK2zC,aAAaM,EAAGjtC,EAAKysC,EAAQjvC,MAanFmvC,aAAc,SAAUl7B,EAAGzR,EAAKysC,EAAQjvC,GAEtCvD,IAAIgP,EAAQjJ,EAAIzH,QAAQ0E,IAAIgM,MAAMzL,GAAO0vC,EAAQ,GACjD,IAAKjzC,IAAIkzC,KAAO17B,EAAG,CACjBxX,IAAImzC,EAAS,GACb,IAAKnzC,IAAI8lC,KAAKoN,EAAIE,OAAQ,CACpB1L,EAAO3hC,EAAIzH,QAAQ0E,IAAImV,eAAe0B,UAAUisB,EAAG92B,GACvDmkC,EAAO9uC,KAAK1F,EAAE0E,MAAMqkC,EAAKtlC,EAAGslC,EAAKrlC,GAAGizB,UAAUkd,GAAQljC,SAExD2jC,EAAM5uC,KAAK8uC,GAEb,OAAOF,GAOTrtC,QAAS,WACF7G,KAAKY,MACVZ,KAAKy2B,UAAUlf,eAAevX,OAQhC8xC,iBAAkB,SAAU39B,GAC1B,GAAIA,GAA0B,IAAjBA,EAAM1Q,OAAnB,CACAxC,IAAI2Q,EAAY,GAAI07B,EAAS,GAC7B,IAAIrsC,IAAIuH,KAAQ2L,EACd,GAAkC,UAA/B3L,EAAKkB,QAAQuF,eAA6BzG,EAAKC,UAChDmJ,GAAepJ,EAAKC,UAAR,SACP,IAAI6kC,EAAOrJ,MAAQz7B,EAAK5D,aAAa,QAAS,CACnD3D,IAAIgjC,EAAO,GACXA,EAAKr4B,IAAMpD,EAAK5D,aAAa,QAC1B4D,EAAK6I,aAAa,YAAW4yB,EAAKx6B,OAASjB,EAAK5D,aAAa,WAC7D4D,EAAK6I,aAAa,UAAS4yB,EAAK5uB,KAAO7M,EAAK5D,aAAa,SACzD4D,EAAK6I,aAAa,aAAY4yB,EAAKI,SAAU,GAChDiJ,EAAOrJ,KAAOA,EAIlB,OADAqJ,EAAO7kC,WAAemJ,EAAH,IAAgB5R,KAAKT,QAAQkJ,WAAY8lB,OACrD+e,IAOT0E,eAAgB,WACd,GAAKhyC,KAAK+xC,QAAV,CAEA9wC,IASS4Z,EATLy5B,EAAOt0C,KAAK+xC,QAAQZ,WACxBnxC,KAAKu0C,kBAAoB,GACtBv0C,KAAKT,QAAQ0kC,MAA6D,UAArDjkC,KAAK+xC,QAAQnoC,cAAcF,QAAQuF,eAAgG,iBAAnEjP,KAAK+xC,QAAQnoC,cAAcA,cAAcF,QAAQuF,gBACvIjP,KAAKu0C,kBAAkBC,SAAW,KACpC,IAAIvzC,IAAIuC,EAAI,EAAGA,EAAI8wC,EAAK7wC,OAAQD,IAC9BxD,KAAKu0C,kBAAkBD,EAAK9wC,GAAG6D,MAAQitC,EAAK9wC,GAAGuB,MAGjD9D,IAAIwzC,GAAQ,EACZ,IAAS55B,KAAK7a,KAAK+xC,QAAQlhC,iBAAiB,mBAAoB,CAC9D5P,IAAIyzC,EAAO,GAAIC,EAAW,GAE1B,GADA30C,KAAK40C,oBAAoB/5B,EAAG65B,EAAMC,EAAU30C,KAAKT,QAAQkJ,WACpDgsC,GAAuB,gBAAdz0C,KAAKqV,KAIZ,GAAkB,mBAAdrV,KAAKqV,KACd,IAAKpU,IAAIqD,KAASowC,EAAK,GAAGL,OAAOjgC,OAAOugC,GACtC30C,KAAKw2B,OAAOlxB,KAAK,CAAEsuC,MAAO,CAAC,CAAES,OAAQ,CAAC/vC,KAAWwvC,SAAU,GAAIe,QAAOvwC,EAAMuwC,KAAO,OAAM70C,KAAKT,QAAQkJ,WAAa,KAAK8lB,cAG1HvuB,KAAKw2B,OAAOlxB,KAAK,CAAEsuC,MAAOc,EAAMZ,SAAUa,EAAUE,QAAQ70C,KAAKu0C,kBAAkBO,OAAS,OAAM90C,KAAKT,QAAQkJ,WAAa,KAAK8lB,cARjIvuB,KAAKw2B,OAAO,GAAGod,MAAMtuC,KAAKovC,EAAK,IACT,EAAlBC,EAASlxC,SACXzD,KAAKw2B,OAAO,GAAGsd,SAAW9zC,KAAKw2B,OAAO,GAAGsd,SAAS1/B,OAAOugC,IAQ7DF,GAAQ,KAQZxC,uBAAwB,WACtB,GAAkB,mBAAdjyC,KAAKqV,MAA2C,cAAdrV,KAAKqV,MAAsC,mBAAdrV,KAAKqV,MAA2C,wBAAdrV,KAAKqV,KAA1G,CAEArV,KAAK4xC,SAAW,GAChB,IAAK3wC,IAAI0B,KAAU3C,KAAK+xC,QAAQlhC,iBAAiB,mBAAoB,CACnE5P,IAAI8zC,EAAQpyC,EAAOqyC,WAAYC,EAAM,EAAGC,EAAUlyC,SAASC,cAAc,OAAqB8xC,EAAMtxC,OACpG,IAAIxC,IAAIuC,EAAI,EAAGA,EAAIuxC,EAAMtxC,OAAQD,IACW,IAAvCuxC,EAAMvxC,GAAG8qB,YAAYC,OAAO9qB,QAC7BsxC,EAAMvxC,GAAGkK,SAGb,IAAKzM,IAAIqoC,KAAKyL,EAAO,CACnB9zC,IAIQk0C,EAJJC,EAAO,GACX,IAAK9L,EAAE5/B,QAAS,CACdzI,IAAI4Z,EAAI,GAAIw6B,IAASJ,EAAM,GAAGF,EAAMtxC,OAAUsxC,EAAMtxC,QAAUsxC,EAAMtxC,OAChEsxC,EAAMM,GAAK3rC,UACTyrC,EAAOJ,EAAMM,GAAK/mB,YAAYC,OAAOnqB,MAAM,OAC/CyW,MAAQs6B,EAAKA,EAAK1xC,OAAS,MAAM0xC,EAAKA,EAAK1xC,OAAS,OAEtDoX,GAAKyuB,EAAEhb,YACP+mB,IAASJ,EAAM,GAAGF,EAAMtxC,OAAUsxC,EAAMtxC,QAAUsxC,EAAMtxC,OACpDsxC,EAAMM,GAAK3rC,UACTw3B,EAAO6T,EAAMM,GAAK/mB,YAAYC,OAAOnqB,MAAM,OAC/CyW,MAAQqmB,EAAK,MAAMA,EAAK,OAE1BgU,EAAQvmC,UAAYkM,EACpB7a,KAAK40C,oBAAoBM,EAASE,EAAM,IAAI,EAAMp1C,KAAKu0C,kBAAkBO,OAAS90C,KAAKT,QAAQkJ,WAC/FzI,KAAK4xC,SAAStsC,KAAK8vC,GAErBH,QAeNL,oBAAqB,SAAUjyC,EAAQ2yC,EAAMC,EAAUC,GAAU,EAAMX,OAAMn3B,EAAW+3B,EAAU,IAChG,IAAKx0C,IAAIy0C,KAAQ/yC,EAAO+F,SACtB1I,KAAK40C,oBAAoBc,EAAMJ,EAAMC,GAAU,EAAOG,EAAK9wC,aAAa,SAAU6wC,EAAQrhC,OAAO,CAACshC,KAEpGz0C,IAAI00C,EAAShzC,EAAO2rB,YAAYmP,QAAQ,gBAAiB,IACrD+F,EAAQmS,EAAOn7B,MAAM,kBAAmBo7B,EAAQ,GAAI1xC,EACxD,IAAKjD,IAAI8lC,KAAKvD,EAAO,CACnBviC,IAAI40C,EAAU,GACd9O,EAAE3iC,MAAM,UAAU2gB,QAAQxiB,EAAEyhC,aAAc6R,GACtCvxC,EAAQ/B,EAAE4gC,iBAAiBvjC,EAAE0E,MAAMuxC,GAAU71C,KAAKT,QAAQiF,KAAMxE,KAAKT,QAAQsB,WAAYb,KAAKT,QAAQ0N,UAC1G2oC,EAAMtwC,KAAKhB,GACXJ,EAASA,EAASA,EAAOpE,OAAOwE,GAAS1E,EAAEsE,OAAOI,EAAOA,GAQ3D,GANItE,KAAKU,SACPV,KAAKU,QAAQZ,OAAOoE,EAAO/C,KAC3BnB,KAAKU,QAAQZ,OAAOoE,EAAO9C,MAE3BpB,KAAKU,QAAUwD,EAEbsxC,EACFF,EAAKhwC,KAAK,CAAE+uC,OAAQuB,QACf,CACL30C,IAAI60C,EAAU,GAAIxB,EAAO3xC,EAAOwuC,WAAY4E,EAAc/1C,KAAK8xC,iBAAiB2D,GAC7EM,EAAY9R,OAAM6R,EAAQtB,SAAW,KACxC,IAAIvzC,IAAIuC,EAAI,EAAGA,EAAI8wC,EAAK7wC,OAAQD,IACV,UAAjB8wC,EAAK9wC,GAAG6D,OACXyuC,EAAQxB,EAAK9wC,GAAG6D,MAAQitC,EAAK9wC,GAAGuB,OAElCwwC,EAASS,QAAQ,CACf3B,OAAQuB,EACR7lC,OAAQ7L,EAAOgb,YACf21B,QAAQA,GAAO,OAAMkB,EAAYttC,WAAa,KAAK8lB,OACnD+lB,KAAMwB,EACN7R,KAAM8R,EAAY9R,KAClBgS,WAAYF,EAAYE,WACxBC,SAAUH,EAAYG,aAS5B/D,UAAW,WACT,OAAQnyC,KAAKqV,MACX,IAAK,cACL,IAAK,mBACL,IAAK,YACL,IAAK,iBACH,OAAO,EAIT,QACE,OAAO,IAQb6J,UAAW,WACT,OAAKlf,KAAKU,QACHV,KAAKY,KAAKrB,QAAQ0E,IAAIkyB,UAAUn2B,KAAKU,QAAQwe,aAD1B,MAI5Bi3B,cAAe,WACb,OAAOn2C,KAAKU,QAAQwe,eAmBpB/H,GAAkBvX,EAAEyT,IAAIvT,OAAO,CAQjC+U,eAAgB,WAGdjV,EAAEyT,IAAIhS,UAAUwT,eAAevT,KAAKtB,MAIpCA,KAAK0G,WAAWtD,aAAa,OAAQ,sBASvCgU,UAAW,SAAUlQ,EAAOkvC,GAAa,GAEvC,GAAGlvC,EAAM0qC,SAAU,CACjB3wC,IAAIo1C,EAAcz2C,EAAEyT,IAAI5G,OAAO,QAC3BvF,EAAM3H,QAAQkJ,WAAW7I,EAAEoK,QAAQ2C,SAAS0pC,EAAanvC,EAAMqtC,kBAAkBO,OAAS5tC,EAAM3H,QAAQkJ,WAC5G7I,EAAEoK,QAAQ2C,SAAS0pC,EAAa,yBAChCA,EAAYpuC,MAAM4tB,KAAO,OACzB3uB,EAAMmvC,YAAcA,EAItB,IAAKp1C,IAAI8lC,KAAK7/B,EAAMsvB,OAAQ,CAK1B,GAJIuQ,EAAE6M,QACJ5zC,KAAKs2C,YAAYvP,EAAG7/B,EAAM3H,QAAQkJ,UAAWvB,EAAMqtC,kBAAkB,cAAertC,EAAM3H,QAAQgT,YAAarL,EAAMqtC,mBAClHrtC,EAAMmvC,cAAatP,EAAEjW,KAAK7oB,MAAMsuC,OAAS,SAE1CxP,EAAE+M,SACJ,IAAK7yC,IAAIwX,KAAKsuB,EAAE+M,SACd9zC,KAAKs2C,YAAY79B,EAAGvR,EAAM3H,QAAQkJ,UAAWgQ,EAAE67B,KAAK,mBAA2B52B,IAAXjF,EAAEwrB,KAAqBxrB,EAAE67B,MAGjGt0C,KAAKw2C,aAAatvC,GAEjBkvC,IACG/sC,EAAQzJ,EAAEyJ,MAAMnC,GACpBlH,KAAKiG,QAAQoD,GAASnC,IAa1BovC,YAAa,SAAU5B,EAAMG,EAAKhjC,EAAOU,GAAc,EAAO+hC,OAAO52B,GACnEzc,IAAI8lC,EAAInnC,EAAEyT,IAAI5G,OAAO,QAErB,GADAioC,EAAK5jB,KAAOiW,EACRuN,EAGF,IAAIrzC,GAAI,CAACoG,EAAMtC,KAAUhE,OAAO01C,QAAQnC,GAC1B,OAATjtC,GAA0B,aAATA,GACpB0/B,EAAE3jC,aAAaiE,EAAMtC,QAJnB8M,GAAOk1B,EAAE3jC,aAAa,aAAcyO,IAOtC6iC,EAAKG,KAAOA,IACdj1C,EAAEoK,QAAQ2C,SAASo6B,EAAG2N,EAAKG,KAAOA,GAEhCtiC,GACF3S,EAAEoK,QAAQ2C,SAASo6B,EAAG,wBAW1BzvB,SAAU,SAAUpQ,EAAOzC,OAAYiZ,EAAWnL,GAAc,GACzDvS,KAAK02C,YAAejyC,GAAazE,KAAK6U,iBAC3C5T,IAAI4Z,EAAIpW,GAAazE,KAAK02C,WAAYC,GAAe,EAClDpkC,GACDrL,EAAMkb,qBAAqBlb,EAAMyL,OAEnC,IAAK1R,IAAI8lC,KAAK7/B,EAAMsvB,OAAQ,CACtBuQ,EAAEjW,MACJ5pB,EAAMyL,MAAM5O,YAAYgjC,EAAEjW,MACxBve,IACCrL,EAAM3H,QAAQ0kC,MAAM/8B,EAAMkrC,kBAAkBrL,EAAEjW,KAAM5pB,EAAM3H,QAAQ0kC,KAAM/8B,EAAM3H,QAAQgO,eACzFrG,EAAMkb,qBAAqB2kB,EAAEjW,QAG3B6lB,GAAgBzvC,EAAM8sC,eACxB9sC,EAAMyL,MAAM5O,YAAYmD,EAAMmvC,aAC9BM,GAAe,GAGjB,IAAK11C,IAAI4yC,KAAQ9M,EAAE+M,SACbD,EAAK/iB,OACH+iB,EAAK5P,OACP/8B,EAAMkrC,kBAAkByB,EAAK/iB,KAAM+iB,EAAK5P,KAAM/8B,EAAM3H,QAAQgO,eAC5DrG,EAAMkb,qBAAqByxB,EAAK/iB,OAElC5pB,EAAMyL,MAAM5O,YAAY8vC,EAAK/iB,OAInCjW,EAAE9W,YAAYmD,EAAMyL,QAQtBikC,YAAa,SAAU1vC,GACrB,IAAKjG,IAAI8lC,KAAK7/B,EAAMsvB,OAAQ,CACtBuQ,EAAEjW,OACJ5pB,EAAMmb,wBAAwB0kB,EAAEjW,MAChClxB,EAAEoK,QAAQ0D,OAAOq5B,EAAEjW,OAErB,IAAK7vB,IAAI4yC,KAAQ9M,EAAE+M,SACbD,EAAK/iB,MACPlxB,EAAEoK,QAAQ0D,OAAOmmC,EAAK/iB,MAGzB5pB,EAAMmvC,aAAaz2C,EAAEoK,QAAQ0D,OAAOxG,EAAMmvC,aAC7CnvC,EAAMmb,wBAAwBnb,EAAMyL,OACpC/S,EAAEoK,QAAQ0D,OAAOxG,EAAMyL,cAChB3S,KAAKiG,QAAQrG,EAAEyJ,MAAMnC,KAQ9BqQ,eAAgB,SAAUrQ,GACpBA,EAAM8sC,cAAch0C,KAAK62C,SAAS3vC,EAAMmvC,YAAar2C,KAAK82C,eAAe5vC,EAAM8sC,cAAc,IACjG,IAAK/yC,IAAI8lC,KAAK7/B,EAAMsvB,OAAQ,CAC1Bx2B,KAAK62C,SAAS9P,EAAEjW,KAAM9wB,KAAK82C,eAAe/P,EAAE2M,WAAYxsC,EAAMgrC,WAC9D,IAAKjxC,IAAI4yC,KAAQ9M,EAAE+M,SACjB9zC,KAAK62C,SAAShD,EAAK/iB,KAAM9wB,KAAK82C,eAAejD,EAAKE,eAAe,MAWvEgD,eAAgB,SAAUhQ,GACxB,UAAWA,EAAE1jC,KAAK0jC,EAAEzjC,MAAMyjC,EAAE1jC,EAAI,QAAQ0jC,EAAEzjC,EAAI,OAAOyjC,EAAE1jC,EAAI,QAAQ0jC,EAAEzjC,EAAI,OAAOyjC,EAAE1jC,EAAI,QAAQ0jC,EAAEzjC,EAAI,OAAOyjC,EAAE1jC,EAAI,QAAQ0jC,EAAEzjC,EAAI,OAAOyjC,EAAE1jC,KAAK0jC,EAAEzjC,MAQjJkzC,aAAc,SAAUtvC,GACtBlH,KAAKg3C,iBAAiB9vC,EAAMmvC,YAAanvC,GAAO,GAAO,GACvD,IAAKjG,IAAI8lC,KAAK7/B,EAAMsvB,OAAQ,CACtBuQ,EAAEjW,MACJ9wB,KAAKg3C,iBAAiBjQ,EAAEjW,KAAM5pB,GAAO,GAEvC,IAAKjG,IAAI4yC,KAAQ9M,EAAE+M,SACbD,EAAK/iB,MACP9wB,KAAKg3C,iBAAiBnD,EAAK/iB,KAAM5pB,KAazC8vC,iBAAkB,SAAUlmB,EAAM5pB,EAAO+vC,GAAS,EAAOC,GAAY,GACnE,IACI33C,EAAyB2yC,EADxBphB,GAAS5pB,IACV3H,EAAU2H,EAAM3H,QAAS2yC,EAAWhrC,EAAMgrC,SACzC3yC,EAAQg3C,UAAYrE,GAAYgF,IAAgBD,IAAW/vC,EAAMmvC,aACpEvlB,EAAK1tB,aAAa,SAAU7D,EAAQ2S,OACpC4e,EAAK1tB,aAAa,iBAAkB7D,EAAQmV,SAC5Coc,EAAK1tB,aAAa,eAAgB7D,EAAQo2B,QAC1C7E,EAAK1tB,aAAa,iBAAkB7D,EAAQ43C,SAC5CrmB,EAAK1tB,aAAa,kBAAmB7D,EAAQ63C,UAEzC73C,EAAQ83C,UACVvmB,EAAK1tB,aAAa,mBAAoB7D,EAAQ83C,WAE9CvmB,EAAKtpB,gBAAgB,oBAGnBjI,EAAQ+3C,WACVxmB,EAAK1tB,aAAa,oBAAqB7D,EAAQ+3C,YAE/CxmB,EAAKtpB,gBAAgB,qBAGnBjI,EAAQ0kC,OACVnT,EAAK1tB,aAAa,SAAU7D,EAAQ0kC,KAAKsO,QAAQ,UAAU,WAC3DzhB,EAAK1tB,aAAa,iBAAkB,KACpC0tB,EAAK1tB,aAAa,eAAgB,OAClC0tB,EAAK1tB,aAAa,mBAAoB,UAGxC0tB,EAAK1tB,aAAa,SAAU,QAG3B8uC,IAAagF,EACT33C,EAAQs2B,KAKX/E,EAAK1tB,aAAa,OAAQ7D,EAAQ2S,QAJlC4e,EAAK1tB,aAAa,OAAQ7D,EAAQg4C,WAAah4C,EAAQ2S,OACvD4e,EAAK1tB,aAAa,eAAgB7D,EAAQq2B,aAC1C9E,EAAK1tB,aAAa,YAAa7D,EAAQi4C,UAAY,YAKrD1mB,EAAK1tB,aAAa,OAAQ,UAU9ByzC,SAAU,SAAU/lB,EAAM2mB,GACxB3mB,EAAK1tB,aAAa,IAAKq0C,IASzBX,eAAgB,SAAUlD,EAAO8D,GAC/Bz2C,IAAI02C,EAAM,GAAIn0C,EAAG6E,EAAG0I,EAAK6mC,EAAMvD,EAAQtN,EAEvC,IAAKvjC,EAAI,EAAGuN,EAAM6iC,EAAMnwC,OAAQD,EAAIuN,EAAKvN,IAAK,CAE5C,GAAsB,KADtB6wC,EAAST,EAAMpwC,IACJC,OACT,OAAOzD,KAAK+2C,eAAe1C,EAAO,IAEpC,IAAKhsC,EAAI,EAAGuvC,EAAOvD,EAAO5wC,OAAQ4E,EAAIuvC,EAAMvvC,IAC1C0+B,EAAIsN,EAAOhsC,GACXsvC,IAAQtvC,EAAI,IAAM,KAAO0+B,EAAE1jC,EAAI,IAAM0jC,EAAEzjC,EAEzCq0C,GAAOD,EAAS,IAAM,GAExB,OAAOC,GAAO,UAadrrC,GAAe1M,EAAE0M,aAAaxM,OAAO,CAOvCC,WAAY,SAAUL,EAAQH,GAO5B,IAkBSwO,EAxBNxO,EAAQoU,UAAsC,EAA1BpU,EAAQoU,SAASlQ,SACtClE,EAAUwB,OAAOwS,OAAOhR,EAAE4tC,QAAQ9uC,UAAUywC,iBAAiBvyC,EAAQoU,UAAWpU,IAElFK,EAAEo1B,WAAW3zB,UAAUtB,WAAWuB,KAAKtB,KAAMN,EAAQH,GACrDS,KAAK4xB,WAAa5xB,KAAKT,QAAQuU,cAE3B9T,KAAKT,QAAQ8S,eAAiBrS,KAAKT,QAAQuS,YAAe9R,KAAKT,QAAQ0kC,QACzErkC,EAAEoK,QAAQ2C,SAAS3M,KAAKT,QAAQoT,MAAO,uBACnCklC,EAAan4C,EAAOqB,OAAOC,KAAKtB,GAAQ,IACvB,IAAlBA,EAAO+D,QAAgBo0C,EAAWt4C,QAAQ0kC,OAAMjkC,KAAKT,QAAQ0kC,KAAO4T,EAAWt4C,QAAQ0kC,MACvFjkC,KAAKT,QAAQ0kC,MACd1hC,EAAE4tC,QAAQ9uC,UAAU+wC,kBAAkB9wC,KAAKtB,KAAMA,KAAKT,QAAQoT,MAAO3S,KAAKT,QAAQ0kC,KAAMjkC,KAAKT,QAAQgO,eACrGvN,KAAKT,QAAQoT,MAAMvP,aAAa,OAAQ,UAExCpD,KAAKT,QAAQoT,MAAMvP,aAAa,gBAAiB,SACjDpD,KAAKT,QAAQoT,MAAMvP,aAAa,OAAQ,UACxCpD,KAAKT,QAAQ8S,cAAcrS,KAAKT,QAAQuS,WAAY9R,MACpDA,KAAKiH,IAAI,QAASjH,KAAK83C,cAI3Bl4C,EAAE4G,SAASF,GAAGtG,KAAKT,QAAQoT,MAAO,gBAAiB3S,KAAK+3C,aAAc/3C,MACtEA,KAAKT,QAAQoT,MAAMvP,aAAa,aAAcpD,KAAKT,QAAQwU,iBACxD/T,KAAKT,QAAQkU,WAAWzT,KAAKT,QAAQoT,MAAMvP,aAAa,WAAYpD,KAAKT,QAAQkU,WACpF,IAAS1F,KAAWrO,EAClBqO,EAAQ4jB,YAAc3xB,MAI1BS,MAAO,SAAUuG,GACfpH,EAAEo1B,WAAW3zB,UAAUZ,MAAMa,KAAKtB,KAAMgH,GACxChH,KAAKg4C,qBAGPA,kBAAmB,WACjB/2C,IAAI+F,EAAMhH,KAAKY,MAAQZ,KAAKT,QAAQgO,cAAc3M,KAIlD,IAAKK,IAAIg3C,KAHNj4C,KAAKT,QAAQ8S,eAAiBrS,KAAKT,QAAQ0kC,OAC5Cj9B,EAAI2G,aAAauqC,WAAWl4C,KAAMA,KAAKm2C,gBAAiBn2C,KAAKT,QAAQoT,OAEnD3S,KAAKiG,QAAS,CAChChF,IAAIiG,EAAQlH,KAAKiG,QAAQgyC,GACzB,IAAIh3C,IAAIk3C,KAAQjxC,EAAMsvB,OAAO,CACxBtvB,EAAMqtC,mBAAqBrtC,EAAMqtC,kBAAkBC,UACpDxtC,EAAI2G,aAAauqC,WAAWhxC,EAAOA,EAAMivC,gBAAiBgC,EAAKrnB,MACjE,IAAI7vB,IAAIm3C,KAAWD,EAAKrE,SACnBsE,EAAQ9D,MAAQ8D,EAAQ9D,KAAKE,UAAUxtC,EAAI2G,aAAauqC,WAAWhxC,EAAOkxC,EAAQroC,OAAQqoC,EAAQtnB,SAc7GlhB,aAAc,SAASpL,EAAM6zC,EAAeC,GAC1Cr3C,IAAIoB,EAAUrC,KAAK4xB,WAAWhtB,aAAa,OACvCxC,EAAUpC,KAAK4xB,WAAWhtB,aAAa,OAE3C,QAAW0zC,EAAP9zC,GAAwBA,EAAO6zC,KAEnB,OAAZh2C,GAAgC,OAAZD,KAEP,OAAZC,GAAoBmC,GAAQnC,GAAyB,OAAZD,IAA4BA,EAARoC,KAWpEuzC,aAAc,SAASl2C,GAErB,GAAI,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,IAAIsN,SAAStN,EAAEwvB,UAAwB,YAAXxvB,EAAEwT,KAAmB,CAC3EpU,IAAIk+B,EAAQn/B,KAAKY,KAAK+M,aAAaijB,aAGnC,GAAiB,KAAd/uB,EAAEwvB,SAAgC,KAAdxvB,EAAEwvB,QACvBzxB,EAAE4G,SAASigB,KAAK5kB,GAChB7B,KAAKY,KAAK+M,aAAakjB,gBAAgBsO,GAAOrO,KAAK1tB,aAAa,YAAa,GAChE,IAAV+7B,GACDn/B,KAAKY,KAAK+M,aAAakjB,gBAAgB7wB,KAAKY,KAAK+M,aAAakjB,gBAAgBptB,OAAS,GAAGqtB,KAAKloB,QAC/F5I,KAAKY,KAAK+M,aAAaijB,aAAe5wB,KAAKY,KAAK+M,aAAakjB,gBAAgBptB,OAAS,IAEtFzD,KAAKY,KAAK+M,aAAakjB,gBAAgBsO,EAAQ,GAAGrO,KAAKloB,QACvD5I,KAAKY,KAAK+M,aAAaijB,qBAEpB,GAAkB,KAAd/uB,EAAEwvB,SAAgC,KAAdxvB,EAAEwvB,QAC/BzxB,EAAE4G,SAASigB,KAAK5kB,GAChB7B,KAAKY,KAAK+M,aAAakjB,gBAAgBsO,GAAOrO,KAAK1tB,aAAa,YAAa,GAC1E+7B,IAAUn/B,KAAKY,KAAK+M,aAAakjB,gBAAgBptB,OAAS,GAC3DzD,KAAKY,KAAK+M,aAAakjB,gBAAgB,GAAGC,KAAKloB,QAC/C5I,KAAKY,KAAK+M,aAAaijB,aAAe,IAEtC5wB,KAAKY,KAAK+M,aAAakjB,gBAAgBsO,EAAQ,GAAGrO,KAAKloB,QACvD5I,KAAKY,KAAK+M,aAAaijB,qBAEpB,GAAiB,KAAd/uB,EAAEwvB,QAAe,CAGzB,GAAyC,OAFxBrxB,KAAKY,KAAKrB,QAAQkH,MAAMwH,YACrCjO,KAAKY,KAAKrB,QAAQkH,MAAM0C,cAAc,kBAAkB8E,YAC9CmyB,cAAcjvB,SAAkB,OAC9CnR,KAAKY,KAAK8F,WAAWkC,aAChB,GAAkB,IAAd/G,EAAEwvB,QAAe,CAC1BpwB,IAAI+H,EAAMhJ,KACV2I,WAAW,WACTK,EAAIpI,KAAK+M,aAAakjB,gBAAgB,GAAGC,KAAK1tB,aAAa,WAAY,IACtE,QAKM,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAI+L,SAAStN,EAAEwvB,WAClFrxB,KAAKY,KAAK+M,aAAaijB,aAAe,EACtC5wB,KAAKY,KAAK+M,aAAakjB,gBAAgB,GAAGC,KAAKloB,SAIX,MAAnC/G,EAAE4H,OAAOC,QAAQuF,gBAChB,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAIE,SAAStN,EAAEwvB,UAAwB,UAAXxvB,EAAEwT,KACxFrV,KAAKu4C,cACkB,KAAd12C,EAAEwvB,SAAgC,KAAdxvB,EAAEwvB,SAC/BrxB,KAAKw4C,gBACDx4C,KAAKT,QAAQ0kC,MAAQjkC,KAAKT,QAAQ8S,gBACpCzS,EAAE4G,SAASigB,KAAK5kB,GAChB7B,KAAKu4B,cAGPv4B,KAAKw4C,iBAQT3oC,SAAU,SAAU3I,IACdA,EAAM3H,QAAQ0kC,MAAQ/8B,EAAM3H,QAAQgT,aACtCvS,KAAKT,QAAQ8S,cAAcrS,KAAKT,QAAQuS,WAAY5K,GAEtDtH,EAAE0M,aAAajL,UAAUwO,SAASvO,KAAKtB,KAAMkH,IAQ/CyW,iBAAkB,SAAS9b,GACzBjC,EAAE4G,SAASigB,KAAK5kB,GAChB7B,KAAKY,KAAK+M,aAAaijB,aAAe3rB,KAAK7D,IAAIpB,KAAKY,KAAK+M,aAAaijB,aAAe,EAAG,GACxF3vB,IAAIw3C,EAAYz4C,KAAKY,KAAK+M,aAAakjB,gBAAgB7wB,KAAKY,KAAK+M,aAAaijB,cAC9E6nB,EAAU3nB,KAAKloB,QACf5I,KAAKY,KAAKwb,cAQZyB,aAAc,SAAShc,GACrBjC,EAAE4G,SAASigB,KAAK5kB,GAChB7B,KAAKY,KAAK+M,aAAaijB,aAAe3rB,KAAK9D,IAAInB,KAAKY,KAAK+M,aAAaijB,aAAe,EAAG5wB,KAAKY,KAAK+M,aAAakjB,gBAAgBptB,OAAS,GACxIxC,IAAIy3C,EAAY14C,KAAKY,KAAK+M,aAAakjB,gBAAgB7wB,KAAKY,KAAK+M,aAAaijB,cAC9E8nB,EAAU5nB,KAAKloB,QACf5I,KAAKY,KAAKwb,cAGZ+5B,cAAe,WACbl1C,IAAIiD,EACJ,IAAIjD,IAAIi2B,KAAKl3B,KAAKiG,QAAQ,CACxBhF,IAAIiG,EAAQlH,KAAKiG,QAAQixB,GACpBhzB,EAGHA,EAAOpE,OAAOoH,EAAMivC,iBAFpBjyC,EAAStE,EAAEsE,OAAOgD,EAAMivC,gBAAiBjvC,EAAMivC,iBAKnD,OAAOjyC,EAAOgb,eAcdy5B,GAAmB/4C,EAAEg3B,QAAQ92B,OAAO,CACpC+2B,SAAU,WACN72B,KAAKY,KAAK0F,GAAG,CACTsyC,SAAU54C,KAAKg2B,YACf6iB,YAAa74C,KAAKg2B,cAGtBh2B,KAAKY,KAAKrB,QAAQkH,MAAMk+B,iBAAiB,UAAW3kC,KAAK84C,gBACzD94C,KAAKY,KAAKm4C,SAASC,WAAWrU,iBAAiB,YAAa3kC,KAAKi5C,SACjEj5C,KAAKY,KAAKrB,QAAQkH,MAAMk+B,iBAAiB,aAAc3kC,KAAKk5C,oBAEhEliB,YAAa,WACTh3B,KAAKY,KAAKqG,IAAI,CACV2xC,SAAU54C,KAAKg2B,YACf6iB,YAAa74C,KAAKg2B,cAGtBh2B,KAAKY,KAAKrB,QAAQkH,MAAM0yC,oBAAoB,UAAWn5C,KAAK84C,gBAC5D94C,KAAKY,KAAKm4C,SAASC,WAAWG,oBAAoB,YAAan5C,KAAKi5C,SACpEj5C,KAAKY,KAAKrB,QAAQkH,MAAM0yC,oBAAoB,aAAcn5C,KAAKk5C,oBAGnEA,kBAAmB,WACdj4C,IAAIwF,EAAQzG,KACZ2I,WAAW,WACP1H,IAAIse,GAAK9Y,EAAM0C,cAAc,kBAAoB1C,EAAM0C,cAAc,kBACjE1C,GADmFwH,WAAW9E,cAAc,sBAGhHlI,IAAIa,EAAU2E,EAAM7F,KAAKmB,UACVQ,EAAE62C,kBAAkB3yC,GACnCxF,IAAIo4C,EAAW92C,EAAEhD,QAAQgzB,OAAO+mB,OAAS,IAAMx3C,EAE5CA,IAAY2E,EAAM7F,KAAK24C,eACtBF,EAAW92C,EAAEhD,QAAQgzB,OAAOinB,UAAY,IAAMH,EAE1Cv3C,IAAY2E,EAAM7F,KAAK64C,iBAC3BJ,EAAW92C,EAAEhD,QAAQgzB,OAAOmnB,UAAY,IAAML,GAGlD95B,EAAGnc,aAAa,uBAAwB,UAAYi2C,GACpD1wC,WAAW,WACP4W,EAAG/X,gBAAgB,yBACpB,MACJ,IAGRsxC,eAAgB,WACZ,KAAyB,EAAtB94C,KAAK25C,gBAAR,CAGA14C,IAAIa,EAAU9B,KAAKY,KAAKmB,UACpBgT,EAAYxS,EAAEC,kBAAkBxC,KAAKY,KAAK6B,iBAAiBX,EAAQ9B,KAAKY,KAAKrB,QAAQsB,YAEzFI,IAAI24C,GAAU,EACX55C,KAAKY,KAAKk1B,mBACT8jB,EAAU93C,GAAW9B,KAAKY,KAAK24C,gBAAkBz3C,GAAW9B,KAAKY,KAAK64C,gBAClEz5C,KAAKY,KAAKk1B,iBAAiBxzB,SAASyS,IAG5C9T,IAAIqsC,GAASttC,KAAKmJ,cAAc,kBAAoBnJ,KAAKmJ,cAAc,kBACnEnJ,MADqFiO,WAAW9E,cAAc,+BAInG5G,EAAE62C,kBAAkBp5C,MAAnCiB,IAIQ44C,EAHJR,EAAW92C,EAAEhD,QAAQgzB,OAAO+mB,OAAS,IAAMx3C,EAE3C83C,GA2BIE,GAAW95C,KAAKye,SAASze,KAAK+5C,cAAgB,GAAK/5C,KAAKye,SAASze,KAAK+5C,cAAgB,GAAU/5C,KAAKye,SAASze,KAAK+5C,gBAA1Bv1C,KAC1F1C,IAAY9B,KAAKY,KAAK24C,gBAAkBz3C,IAAYg4C,EACnDxM,EAAO/+B,UAAYhM,EAAEhD,QAAQgzB,OAAOinB,UAAY,IAAMH,EAElDv3C,IAAY9B,KAAKY,KAAK64C,gBAAkB33C,IAAYg4C,EACxDxM,EAAO/+B,UAAYhM,EAAEhD,QAAQgzB,OAAOmnB,UAAY,IAAML,EAGtD/L,EAAO/+B,UAAY8qC,IAlCnBQ,EAAiB75C,KAAKye,SAASze,KAAK+5C,eACpCC,EAAch6C,KAAKye,SAASze,KAAK+5C,cAAgB,GACrD/5C,KAAKu9B,OACLv9B,KAAKye,SAASw7B,MAEXJ,EAAer1C,OAASw1C,EAAYx1C,KACnC8oC,EAAO/+B,UAAYhM,EAAEhD,QAAQgzB,OAAO2nB,YAEhCl6C,KAAKY,KAAKm4C,SAASC,WAAWmB,WAClC7M,EAAO/+B,UAAYhM,EAAEhD,QAAQgzB,OAAO6nB,aAEhCP,EAAex2C,EAAI22C,EAAY32C,EACnCiqC,EAAO/+B,UAAYhM,EAAEhD,QAAQgzB,OAAO8nB,YAEhCR,EAAex2C,EAAI22C,EAAY32C,EACnCiqC,EAAO/+B,UAAYhM,EAAEhD,QAAQgzB,OAAO+nB,YAEhCT,EAAev2C,EAAI02C,EAAY12C,EACnCgqC,EAAO/+B,UAAYhM,EAAEhD,QAAQgzB,OAAOgoB,aAEhCV,EAAev2C,EAAI02C,EAAY12C,IACnCgqC,EAAO/+B,UAAYhM,EAAEhD,QAAQgzB,OAAOioB,eAgB5Cx6C,KAAKY,KAAKm4C,SAASC,WAAWmB,YAAa,IAG/CnkB,YAAa,WACT/0B,IAAIvB,EAASqB,OAAOC,KAAKhB,KAAKiG,SAC1B/B,EAAStE,EAAEsE,SAEfxE,EAAOqlB,QAAQvhB,IACX,IAEYc,EAFTtE,KAAKiG,QAAQzC,GAAG1C,cACXoD,IACII,EAAQtE,KAAKiG,QAAQzC,GAAG1C,YAAYoe,YACxChb,EAAStE,EAAEsE,OAAOI,EAAOA,IAE7BJ,EAAOpE,OAAOE,KAAKiG,QAAQzC,GAAG1C,YAAYK,KAC1C+C,EAAOpE,OAAOE,KAAKiG,QAAQzC,GAAG1C,YAAYM,QAIlDpB,KAAK81B,iBAAmB5xB,GAG5B+0C,QAAS,WACLj5C,KAAKm6C,YAAa,KAKtBM,GAAe76C,EAAEg3B,QAAQ92B,OAAO,CAClCC,WAAY,SAAUiH,GACpBpH,EAAEg3B,QAAQv1B,UAAUtB,WAAWuB,KAAKtB,KAAMgH,GAC1ChH,KAAK6wB,gBAAkB,GACvB7wB,KAAK06C,iBAAmB,GACxB16C,KAAK4wB,aAAe,EACpB5wB,KAAK26C,eAAiBp4C,EAAEC,kBACtBwE,EAAIvE,iBACJuE,EAAIjF,UACJiF,EAAIzH,QAAQsB,aAGhBg2B,SAAU,WACR72B,KAAKY,KAAK0F,GAAG,qBAAsBtG,KAAK46C,iBAAkB56C,MAC1DA,KAAKY,KAAK0F,GAAG,qBAAsBtG,KAAKswB,WAAYtwB,OAGtDg3B,YAAa,WACXh3B,KAAKY,KAAKqG,IAAI,qBAAsBjH,KAAK46C,kBACzC56C,KAAKY,KAAKqG,IAAI,qBAAsBjH,KAAKswB,aAS3C4nB,WAAY,SAAUhxC,EAAO2zC,EAAI/pB,GAC/B7vB,IAAI65C,EAAK96C,KAAK26C,eAAez7B,YACzB67B,EAAO91C,KAAK6tC,KAAK7tC,KAAK8tC,IAAI8H,EAAGx3C,EAAIy3C,EAAGz3C,EAAG,GAAK4B,KAAK8tC,IAAI8H,EAAGv3C,EAAIw3C,EAAGx3C,EAAG,IACtErC,IAAIk+B,EAAQn/B,KAAK26C,eAAeljC,SAASojC,GAAM76C,KAAK6wB,gBAAkB7wB,KAAK06C,iBAEvElyC,EAAO,CAACsoB,KAAMA,EAAM5pB,MAAOA,EAAO6I,OAAQ8qC,EAAIE,KAAMA,GACxDjqB,EAAK1tB,aAAa,YAAa,GAE/B+7B,EAAM75B,KAAKkD,GAGX,IAAKvH,IAAIuC,EAAI27B,EAAM17B,OAAS,EAAO,EAAJD,GAAS27B,EAAM37B,GAAGu3C,KAAO5b,EAAM37B,EAAE,GAAGu3C,KAAMv3C,IAAK,CAC5EvC,IAAI+5C,EAAM7b,EAAM37B,GAChB27B,EAAM37B,GAAK27B,EAAM37B,EAAE,GACnB27B,EAAM37B,EAAE,GAAKw3C,EAGXh7C,KAAK26C,eAAeljC,SAASojC,GAC/B76C,KAAK6wB,gBAAkBsO,EAEvBn/B,KAAK06C,iBAAmBvb,GAO5BvxB,WAAY,WACV5N,KAAK4wB,aAAe,EACpB5wB,KAAK6wB,gBAAkB7wB,KAAK6wB,gBAAgBlf,OAAO,IACjD1Q,IAAIg6C,EAAUj7C,KAAK26C,eAAeljC,SAASjP,EAAKuH,QAKhD,OAJAvH,EAAKsoB,KAAK1tB,aAAa,YAAa,GAChCoF,EAAKtB,MAAMtG,OAASq6C,GACtBj7C,KAAK06C,iBAAiBp1C,KAAKkD,GAEtBA,EAAKtB,MAAMtG,MAAQq6C,IAE5Bj7C,KAAK06C,iBAAmB16C,KAAK06C,iBAAiB/oC,OAAO,IACnD1Q,IAAIg6C,EAAUj7C,KAAK26C,eAAeljC,SAASjP,EAAKuH,QAKhD,OAJAvH,EAAKsoB,KAAK1tB,aAAa,YAAa,GAChCoF,EAAKtB,MAAMtG,MAAQq6C,GACrBj7C,KAAK6wB,gBAAgBvrB,KAAKkD,GAErBA,EAAKtB,MAAMtG,OAASq6C,KAQ/B3qB,WAAY,WAEV,GADAtwB,KAAK4N,aAC8B,IAAhC5N,KAAK6wB,gBAAgBptB,OAAxB,CAEAxC,IAAI65C,EAAK96C,KAAK26C,eAAez7B,YAE7Blf,KAAK6wB,gBAAgBqqB,KAAK,SAASnX,EAAGoX,GACpCl6C,IAAIm6C,EAAKrX,EAAEh0B,OACPsrC,EAAKF,EAAEprC,OAGX,OAFAg0B,EAAEgX,KAAO91C,KAAK6tC,KAAK7tC,KAAK8tC,IAAIqI,EAAG/3C,EAAIy3C,EAAGz3C,EAAG,GAAK4B,KAAK8tC,IAAIqI,EAAG93C,EAAIw3C,EAAGx3C,EAAG,IACpE63C,EAAEJ,KAAO91C,KAAK6tC,KAAK7tC,KAAK8tC,IAAIsI,EAAGh4C,EAAIy3C,EAAGz3C,EAAG,GAAK4B,KAAK8tC,IAAIsI,EAAG/3C,EAAIw3C,EAAGx3C,EAAG,IAC7DygC,EAAEgX,KAAOI,EAAEJ,OAEpB/6C,KAAK6wB,gBAAgB,GAAGC,KAAK1tB,aAAa,WAAY,KAQxDw3C,iBAAkB,SAAU/4C,GAE1B7B,KAAK26C,eAAiBp4C,EAAEC,kBACtBxC,KAAKY,KAAK6B,iBACVzC,KAAKY,KAAKmB,UACV/B,KAAKY,KAAKrB,QAAQsB,eAIpBy6C,GAAU,CACZzoB,2BAA2B,EAC3B0oB,kBAAkB,EAClBC,cAAe,CAAC/N,QAAU,EAAMgO,UAAY,GAC5C/f,eAAgB,OAChBE,eAAgB,OAChBrJ,OAAQ,CACNuH,OAAQ,OACRG,UAAW,UACXE,SAAU,SACViB,iBAAkB,kBAClBZ,aAAc,OACdI,YAAa,MACbE,aAAc,SACdE,eAAgB,WAChBK,cAAe,oBACfH,aAAc,QACdK,aAAc,kBACdO,cAAe,gBACfE,YAAa,aACb0f,UAAW,UACXlQ,eAAgB,uBAChBV,UAAW,UACXC,WAAY,WACZ1Q,cAAe,kBACfwH,kBAAmB,kBACnB+O,cAAe,0CACfE,gBAAiB,oCACjBN,eAAgB,2CAChBQ,qBAAsB,+CACtBC,yBAA0B,uCAC1BqI,OAAQ,aACRqC,SAAU,SACVC,MAAO,MACPpC,UAAW,0CACXE,UAAW,2CACXQ,YAAa,qCACbE,aAAc,sCACdC,YAAa,4CACbC,YAAa,4CACbC,aAAc,8CACdC,aAAc,8CACdhQ,aAAc,qBACdC,YAAa,gBACbS,WAAY,0BACZR,SAAU,SACVC,WAAY,WACZC,WAAY,WACZC,YAAa,YACbG,gBAAiB,gBACjBC,QAAS,uBACTE,eAAgB,mBAChBC,eAAgB,eAChB3G,QAAS,QACTjS,UAAW,eACXoS,cAAe,iBAInBhlC,EAAE6rC,IAAIoQ,SAAS5N,QAAQ,CACnBxR,WAAY,SAAU56B,GAElB,IAAIA,EAAEi6C,SAAUj6C,EAAEk6C,QAAlB,CAEA96C,IAgBI+mB,EAFA9mB,EAAMW,EAAEwvB,QACRrqB,EAAMhH,KAAKY,KAGf,GAAIM,KAAOlB,KAAKg8C,SACPh1C,EAAIi1C,UAAaj1C,EAAIi1C,SAASC,cAC/Bl0B,EAAShoB,KAAKg8C,SAAS96C,GACnBW,EAAE0vB,WACFvJ,EAASpoB,EAAE0E,MAAM0jB,GAAQ5X,WAAW,IAEpCvO,EAAEs6C,UACFn0B,EAASpoB,EAAE0E,MAAM0jB,GAAQjN,SAAS,IAGtC/T,EAAIo1C,MAAMp0B,GAENhhB,EAAIzH,QAAQ88C,WACZr1C,EAAIs1C,gBAAgBt1C,EAAIzH,QAAQ88C,iBAGrC,GAAIn7C,KAAOlB,KAAKu8C,WACfr7C,IAnCK,CACTs7C,IAAK,IACLC,IAAK,IACLC,GAAI,GACJC,IAAK,MA+BgB31C,EAAIuyC,iBAAmBvyC,EAAIjF,WAAeb,IA5BrD,CACV07C,IAAK,IACLC,IAAK,IACLC,GAAI,GACJC,IAAK,MAwB4E/1C,EAAIyyC,iBAAmBzyC,EAAIjF,YACxGiF,EAAIg2C,QAAQh2C,EAAIjF,WAAaF,EAAE0vB,SAAW,EAAI,GAAKvxB,KAAKu8C,UAAUr7C,QAEnE,CAAA,GAAY,KAARA,IAAc8F,EAAIwxB,SAAUxxB,EAAIwxB,OAAOj5B,QAAQ09C,iBAItD,OAHAj2C,EAAIoV,aAMRxc,EAAE4G,SAASigB,KAAK5kB,OAmNE,SAAtBq7C,GAAgC39C,GAChC,OAAO,IAAI49C,GAAoB59C,GAhNnC,IA6PWglC,GAEPhiC,GA/PA46C,GAAsBv9C,EAAE2b,MAAMzb,OAAO,CACrCW,MAAO,SAAUuG,GAGbhH,KAAK0G,WAAa9G,EAAEoK,QAAQyC,OAAO,MAAO,0BAA2BzF,EAAIN,YACzE1G,KAAK0G,WAAWiI,UAHG,iPAKnB3O,KAAKo9C,QAAUx9C,EAAEoK,QAAQyC,OAAO,SAAU,sBAAuBzF,EAAIN,YACrE1G,KAAKo9C,QAAQh6C,aAAa,OAAQ,UAClCpD,KAAKo9C,QAAQh6C,aAAa,YAAa,UACvCpD,KAAKo9C,QAAQh6C,aAAa,cAAe,QACzCpD,KAAKq9C,MAAQz9C,EAAEoK,QAAQyC,OAAO,OAAQ,8BAA+BzM,KAAKo9C,SAC1Ep9C,KAAKq9C,MAAMle,MAAQ,EACnBn/B,KAAKo9C,QAAQE,cAAe,EAC5Bt2C,EAAIV,GAAG,iDAAkDtG,KAAKsxC,cAAetxC,MAC7EgH,EAAIV,GAAG,0CAA2CtG,KAAKu9C,cAAev9C,MACtEgH,EAAIV,GAAG,UAAWtG,KAAKy8B,WAAYz8B,MACnCA,KAAKw9C,4BAGTC,wBAAyB,WACrBx8C,IAAIiD,EAASlE,KAAKY,KAAK6B,iBACvBxB,IAAI8O,EAAS7L,EAAOgb,YAChBw+B,EAASz4C,KAAKgjB,IAAI/jB,EAAO/C,IAAIkC,EAAIa,EAAO9C,IAAIiC,GAAMrD,KAAKY,KAAKrB,QAAQkH,MAAW,MAC/Ek3C,EAAS14C,KAAKgjB,IAAI/jB,EAAO/C,IAAImC,EAAIY,EAAO9C,IAAIkC,GAAMtD,KAAKY,KAAKrB,QAAQkH,MAAY,OAEpFxF,IAAI28C,EAAoBC,iBAAiB79C,KAAK0G,YAAiB,MAAE+2B,QAAQ,UAAU,IACxB,MAAvDogB,iBAAiB79C,KAAK0G,YAAiB,MAAEyxB,OAAO,KAChDylB,EAAmBA,EAAmB59C,KAAKY,KAAKrB,QAAQkH,MAAM9C,MAAQ,KAE1E1C,IAAI68C,EAAIJ,EAASE,EAAmB,EAChCG,EAAIJ,EAASC,EAAmB,EAChCI,EAAWp+C,EAAE0E,MAAMyL,EAAO1M,EAAIy6C,EAAG/tC,EAAOzM,EAAIy6C,GAC5CE,EAAWr+C,EAAE0E,MAAMyL,EAAO1M,EAAIy6C,EAAG/tC,EAAOzM,EAAIy6C,GAC5C5C,EAAIv7C,EAAEsE,OAAO85C,EAAUC,GAC3B,OAAO17C,EAAEC,kBAAkB24C,EAAEn7C,KAAKY,KAAKmB,UAAU/B,KAAKY,KAAKrB,QAAQsB,aAGvE08C,cAAe,SAAU17C,GAErB,GADc,UAAXA,EAAEwT,OAAkBrV,KAAKo9C,QAAQE,cAAe,GAC/Ct9C,KAAKo9C,QAAQE,aACjB,GAAGt9C,KAAKo9C,QAAQc,YACZl+C,KAAKo9C,QAAQc,aAAc,MAD/B,CAKAl+C,KAAKY,KAAK8J,KAAK,sBAEfzJ,IAAIk9C,EAAqBn+C,KAAKy9C,0BAC1B1wC,EAAW/M,KAAKY,KAAK+M,aAAakjB,gBAClCsO,EAAQ,EACRn+B,EAAOD,OAAOC,KAAK+L,GACnB6a,EAAO5nB,KAAKq9C,MAEhBz1B,EAAKjZ,UAAY,GACjBiZ,EAAKuX,MAAQ,EAEbvX,EAAKw2B,YAAc,GACnBp9C,EAAK+jB,QAAQvhB,IACTvC,IAAIiG,EAAQ6F,EAASvJ,GAAG0D,MACxBjG,IAAIvB,EAASqN,EAASvJ,GAAG0D,MAAMjB,QAC/BhF,IAAIiD,EAAStE,EAAEsE,SAEf,GAAGxE,EAAQ,CACPuB,IAAID,EAAOD,OAAOC,KAAKtB,GACvBsB,EAAK+jB,QAAQ1c,IACGnE,EAARA,GAAiBtE,EAAEsE,OAAOgD,EAAMjB,QAAQoC,GAAG3H,QAAQS,IAAK+F,EAAMjB,QAAQoC,GAAG3H,QAAQU,KACrF8C,EAAOpE,OAAOoH,EAAMjB,QAAQoC,GAAG3H,QAAQS,KACvC+C,EAAOpE,OAAOoH,EAAMjB,QAAQoC,GAAG3H,QAAQU,YAErC8F,EAAMxG,UACZwD,EAAStE,EAAEsE,OAAOgD,EAAMxG,QAAQS,IAAK+F,EAAMxG,QAAQU,MAGpD+8C,EAAmB77C,SAAS4B,KACvB0D,EAAQmF,EAASvJ,GAAGstB,KAAKlsB,aAAa,cAEtCu6B,EAAQ,GACRvX,EAAK7jB,YAAY/D,KAAK6sC,cAAcjlC,EAAOu3B,EAAOA,IAElDA,EAAQ,GAAM,GAAe,IAAVA,GACnBvX,EAAKw2B,YAAY94C,KAAK,IAE1BsiB,EAAKw2B,YAAYn5C,KAAKiU,OAAOimB,EAAQ,GAAK,IAAI75B,KAAK,CAACsC,MAAAA,EAAOu3B,MAAAA,EAAOj4B,MAAAA,IAC9D0gB,EAAKw2B,YAAY,IAAqC,IAA/Bx2B,EAAKw2B,YAAY,GAAG36C,QAC3CmkB,EAAK7jB,YAAY/D,KAAK6sC,cAAc,eAAgB,EAAG,IAE3D1N,GAAS,KAGjBn/B,KAAKq+C,mBAGTxR,cAAe,SAAUjlC,EAAOu3B,EAAOj+B,GACnCD,IAAIy0C,EAAO1yC,SAASC,cAAc,QAKlC,OAJAyyC,EAAKtyC,aAAa,aAAc+7B,GAGhCuW,EAAK/mC,kBAAqBzN,UAAc,IAAM0G,EAAQ,kBAC/C8tC,GAGX2I,eAAgB,WACZp9C,IAAIm9C,EAAcp+C,KAAKq9C,MAAMe,YAC7B,IAAIn9C,IAAIuC,EAAI,EAAGA,EAAI46C,EAAY36C,OAAQD,IAAI,CACvC,GAA6B,IAA1B46C,EAAY56C,GAAGC,OAAc,OAC7B26C,EAAY56C,EAAI,IAEf46C,EAAY56C,GAAG8B,KAAK,CAACsC,MADT,qBAIbw2C,EAAY56C,EAAI,IAAkC,EAA5B46C,EAAY56C,EAAI,GAAGC,QAExC26C,EAAY56C,GAAG8B,KAAK,CAACsC,MADT,mBAMxB60B,WAAY,SAAU56B,GAClBZ,IAAI2mB,EAAO5nB,KAAKq9C,MACZn8C,EAAMW,EAAEqI,cAAcmnB,QAC1B,GAAW,IAAPnwB,GAAaA,GAAO,IACpB,GAAI0mB,EAAKw2B,YAAYx2B,EAAKuX,OAA1B,CACIpxB,EAAU6Z,EAAKw2B,YAAYx2B,EAAKuX,OAAOj+B,EAAM,IACjD,GAAK6M,EAAL,CACA9M,IAAIiG,EAAQ6G,EAAQ7G,MAChBA,IACAlH,KAAKY,KAAK+M,aAAaijB,aAAe7iB,EAAQoxB,MAAQ,EAClDj4B,EAAMsxB,QACNx4B,KAAKY,KAAKwb,aACVlV,EAAMqxB,aAELrxB,EAAM3H,QAAQoT,MAAM/J,gBAEf,KAAR1H,EACNlB,KAAKs+C,YAAY12B,GAAO,GACV,KAAR1mB,GACNlB,KAAKs+C,YAAY12B,EAAM,IAI/B02B,YAAa,SAAU12B,EAAM22B,GACzBt9C,IAAIk+B,EAAQvX,EAAK1Z,WAAWtJ,aAAa,cACrC45C,EAAa52B,EAAKw2B,YAAYn5C,KAAKiU,OAAQimB,EAAQ,GAAK,EAAKof,IACjE,GAAGC,GAAkC,EAApBA,EAAW/6C,OAAW,CACnCmkB,EAAKjZ,UAAY,GACjBiZ,EAAKuX,OAASof,EACd,IAAIt9C,IAAIuC,EAAI,EAAGA,EAAIg7C,EAAW/6C,OAAQD,IAAI,CACtCvC,IAAI8M,EAAUywC,EAAWh7C,GACrB27B,EAAQpxB,EAAQoxB,OAAwB,EAC5Cl+B,IAAIC,EAAMsC,EAAI,EACQ,iBAAlBuK,EAAQnG,QAA0B1G,EAAM,GACtB,qBAAlB6M,EAAQnG,QAA8B1G,EAAM,GAChD0mB,EAAK7jB,YAAY/D,KAAK6sC,cAAc9+B,EAAQnG,MAAOu3B,EAAOj+B,OAKtEowC,cAAe,WACXtxC,KAAKY,KAAK0F,GAAG,+CAAgDtG,KAAKw9C,yBAA0Bx9C,OAIhGw9C,yBAA0B,SAAU37C,GAChCZ,IAAI8L,EAAW/M,KAAKq9C,MAAMe,YAAcp+C,KAAKq9C,MAAMe,YAAY36C,OAAS,EAExE,GAAKzD,KAAKo9C,QAAQE,cAEX,GAAGt9C,KAAKo9C,QAAQ/rC,aAAa,eAAe,CAC/CpQ,IAAI+H,EAAMhJ,KACV2I,WAAW,WACPK,EAAIo0C,QAAQ51C,gBAAgB,gBAC7B,WALHxH,KAAKo9C,QAAQh6C,aAAa,cAAe,QAQ1CvB,GAAgB,eAAXA,EAAEwT,MACNrV,KAAKo9C,QAAQh6C,aAAa,cAAe,QACzCpD,KAAKo9C,QAAQc,aAAc,GACpBr8C,GAAgB,UAAXA,EAAEwT,MACdrV,KAAK0G,WAAWc,gBAAgB,UACf,IAAbuF,GAAgB/M,KAAKo9C,QAAQxrC,UAAUlE,OAAO,+BAC3C7L,GAAKA,EAAEqI,eAA0C,gBAAzBrI,EAAEqI,cAAcmL,MAC/CrV,KAAK0G,WAAWtD,aAAa,SAAU,IACvCpD,KAAKo9C,QAAQxrC,UAAUG,IAAI,+BACpBlQ,GAAKA,EAAE4H,OAAO+uB,OACrBx4B,KAAK0G,WAAWtD,aAAa,SAAU,IAChCvB,GAAgB,SAAXA,EAAEwT,MACdrV,KAAK0G,WAAWtD,aAAa,SAAU,IACvCpD,KAAKo9C,QAAQxrC,UAAUG,IAAI,8BAC3B/R,KAAKo9C,QAAQE,cAAe,EAC5Bt9C,KAAKw9C,4BACEx9C,KAAKY,KAAKy2B,WAAax1B,GAC9B7B,KAAK0G,WAAWc,gBAAgB,UACf,IAAbuF,EACA/M,KAAKo9C,QAAQxrC,UAAUlE,OAAO,8BAE9B1N,KAAKo9C,QAAQxrC,UAAUG,IAAI,gCAG/B/R,KAAK0G,WAAWtD,aAAa,SAAU,IACvCpD,KAAKo9C,QAAQxrC,UAAUG,IAAI,kCAqD5BwyB,GA8mBTA,OA5mBEhiC,GAAI,GACRgiC,GAAOhiC,EAAIA,GAEV,WACCA,GAAEk8C,gBAAkB,SAAUh6C,GAO7B,IAAI8a,EAAK3f,EAAEoK,QAAQyC,OAAO,MAAQ,4BAA6BhI,GAC3DqsB,EAAOlxB,EAAEoK,QAAQ00C,SAASn/B,EAAI,qBACvB3f,EAAEoK,QAAQ00C,SAASn/B,EAAI,mBAUlC,OARA9a,EAAUwO,YAAYsM,GAGrBuR,EADY,OAATA,GAAyC,IAAxBA,EAAKzY,QAAQ,OAC1B,GAEAyY,EAAK2M,QAAQ,cAAe,IAAIA,QAAQ,2BAA4B,KAK7El7B,GAAE+sB,KAAO,aAETruB,IAAI09C,EAAapa,GAAOvhC,SAAS47C,KAAKz1C,cAAc,eACpD5G,GAAEhD,QAAU+7C,GACRqD,IAAYp8C,GAAEhD,QAAUwB,OAAOwS,OAAOhR,GAAEhD,QAASulC,KAAKC,MAAM4Z,EAAWhwC,aAO3EpM,GAAEs8C,MAAQ,IAAIj/C,EAAEipC,KAAKiW,IAAI,YAAY,oDAAqD,CACxFrL,OAAQ,EAAE,IAAI,IACdvvC,OAAQtE,EAAEsE,OAAO,CAAC,EAAE,KAAK,IAAI,CAAC,IAAI,MAClC4M,YAAa,CACX,QACA,SACA,UACA,WACA,YACA,aACA,cACA,eACA,gBACA,iBACA,kBACA,kBACA,kBACA,iBACA,iBACA,iBACA,iBACA,gBACA,gBACA,gBACA,eACA,gBAEF7M,IAAK,CACHq+B,KAAM,CACJnoB,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEs8C,MAAMt/C,QAAQ2E,OAAO6b,UAAU1c,EAAId,GAAEs8C,MAAMt/C,QAAQuR,YAAYtM,KAE5F+V,SAAU,CACRlT,KAAM,IACNlG,IAAI,EACJC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEs8C,MAAMt/C,QAAQ2E,OAAO6b,UAAUzc,EAAIf,GAAEs8C,MAAMt/C,QAAQuR,YAAYtM,KAE5FN,OAAQM,GAAQ5E,EAAEsE,OAAO,CAAC3B,GAAEs8C,MAAMt/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAWhZ,IAC5CoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASpZ,KACnC,CAACoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAW/Y,IAAIoD,GACxCjC,GAAEs8C,MAAMt/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASnZ,IAAIoD,MAE1DqT,KAAM,CACJsC,WAAY,CACV9S,KAAM,YACNlG,UAAW,OAAOoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAI8tB,KAAK5X,WAAWhZ,KACtDC,UAAW,OAAOmB,GAAEs8C,MAAMt/C,QAAQ0E,IAAI8tB,KAAK5X,WAAW/Y,MAExDmZ,SAAU,CACRlT,KAAM,WACNlG,UAAW,OAAOoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAI8tB,KAAKxX,SAASpZ,KACpDC,UAAW,OAAOmB,GAAEs8C,MAAMt/C,QAAQ0E,IAAI8tB,KAAKxX,SAASnZ,MAEtD8C,aAAc,OAAO3B,GAAEs8C,MAAMt/C,QAAQ2E,SAEvC6tB,KAAM,CACJ5X,WAAY,CACV9S,KAAM,YAENlG,KAAM,IACNC,IAAK,KAEPmZ,SAAU,CACRlT,KAAM,WAENlG,KAAM,GACNC,IAAK,IAEP8C,aAAc,OAAOtE,EAAEsyB,aACjB,CAAC3vB,GAAEs8C,MAAMt/C,QAAQ0E,IAAI8tB,KAAKxX,SAASpZ,IAAIoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAI8tB,KAAK5X,WAAWhZ,KAC3E,CAACoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAI8tB,KAAKxX,SAASnZ,IAAImB,GAAEs8C,MAAMt/C,QAAQ0E,IAAI8tB,KAAK5X,WAAW/Y,QAEnF4F,IAAK,CACHmT,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAK4F,GAAOA,EAAI+Y,UAAU1c,GAE5BkX,SAAU,CACRlT,KAAM,IACNlG,IAAK,EACLC,IAAK4F,GAAOA,EAAI+Y,UAAUzc,GAE5BY,OAAQ8C,GAAOpH,EAAEsE,OAAOtE,EAAE0E,MAAM,CAAC,EAAE,IAAI0C,EAAI+Y,YAE7Crc,KAAM,CACJyW,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAK,KAEPmZ,SAAU,CACRlT,KAAM,IACNlG,IAAK,EACLC,IAAK,KAEP8C,aAAc,OAAOtE,EAAEsE,OACb,CAAC3B,GAAEs8C,MAAMt/C,QAAQ0E,IAAIP,KAAKyW,WAAWhZ,IAAIoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAIP,KAAK6W,SAASpZ,KAC3E,CAACoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAIP,KAAKyW,WAAW/Y,IAAImB,GAAEs8C,MAAMt/C,QAAQ0E,IAAIP,KAAK6W,SAASnZ,QAEvFqO,WAAY,CACV0K,WAAY,CACV9S,KAAM,SACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEs8C,MAAMt/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAW/Y,IAAIoD,GAAQjC,GAAEs8C,MAAMt/C,QAAQ0E,IAAIP,KAAKQ,OAAO6b,UAAU1c,IAErHkX,SAAU,CACRlT,KAAM,MACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEs8C,MAAMt/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASnZ,IAAIoD,GAAQjC,GAAEs8C,MAAMt/C,QAAQ0E,IAAIP,KAAKQ,OAAO6b,UAAUzc,IAEnHY,OAAQM,GAAQ5E,EAAEsE,OACT,CAAC3B,GAAEs8C,MAAMt/C,QAAQ0E,IAAIwL,WAAW0K,WAAWhZ,IAC1CoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAIwL,WAAW8K,SAASpZ,KACzC,CAACoB,GAAEs8C,MAAMt/C,QAAQ0E,IAAIwL,WAAW0K,WAAW/Y,IAAIoD,GAC9CjC,GAAEs8C,MAAMt/C,QAAQ0E,IAAIwL,WAAW8K,SAASnZ,IAAIoD,SAI5DjC,GAAEw8C,QAAU,IAAIn/C,EAAEipC,KAAKiW,IAAI,YAC3B,+GAAgH,CAC9GrL,OAAQ,EAAE,SAAU,QACpBvvC,OAAQtE,EAAEsE,OAAO,CAAC,EAAE,UAAU,MAAU,CAAC,IAAS,UAClD4M,YAAa,CACX,mBACA,kBACA,mBACA,mBACA,mBACA,mBACA,mBACA,kBACA,kBACA,mBACA,mBACA,mBACA,iBACA,kBACA,kBACA,mBACA,mBACA,mBACA,mBACA,mBACA,kBACA,kBACA,gBACA,mBACA,mBACA,oBAEF7M,IAAK,CACHq+B,KAAM,CACJnoB,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEw8C,QAAQx/C,QAAQ2E,OAAO6b,UAAU1c,EAAId,GAAEw8C,QAAQx/C,QAAQuR,YAAYtM,KAEhG+V,SAAU,CACRlT,KAAM,IACNlG,IAAI,EACJC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEw8C,QAAQx/C,QAAQ2E,OAAO6b,UAAUzc,EAAIf,GAAEw8C,QAAQx/C,QAAQuR,YAAYtM,KAEhGN,OAAQM,GAAQ5E,EAAEsE,OAAO,CAAC3B,GAAEw8C,QAAQx/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAWhZ,IAC9CoB,GAAEw8C,QAAQx/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASpZ,KACrC,CAACoB,GAAEw8C,QAAQx/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAW/Y,IAAIoD,GAC1CjC,GAAEw8C,QAAQx/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASnZ,IAAIoD,MAE5DqT,KAAM,CACJsC,WAAY,CACV9S,KAAM,UACNlG,UAAW,OAAOoB,GAAEw8C,QAAQx/C,QAAQ2E,OAAO/C,IAAIkC,GAC/CjC,UAAW,OAAOmB,GAAEw8C,QAAQx/C,QAAQ2E,OAAO9C,IAAIiC,IAEjDkX,SAAU,CACRlT,KAAM,WACNlG,UAAW,OAAOoB,GAAEw8C,QAAQx/C,QAAQ2E,OAAO/C,IAAImC,GAC/ClC,UAAW,OAAOmB,GAAEw8C,QAAQx/C,QAAQ2E,OAAO9C,IAAIkC,IAEjDY,aAAc,OAAO3B,GAAEw8C,QAAQx/C,QAAQ2E,SAEzC6tB,KAAM,CACJ5X,WAAY,CACV9S,KAAM,YAENlG,KAAM,OACNC,KAAM,OAERmZ,SAAU,CACRlT,KAAM,WAENlG,IAAK,MACLC,IAAK,OAEP8C,aAAc,OAAOtE,EAAEsyB,aACjB,CAAC3vB,GAAEw8C,QAAQx/C,QAAQ0E,IAAI8tB,KAAKxX,SAASpZ,IAAIoB,GAAEw8C,QAAQx/C,QAAQ0E,IAAI8tB,KAAK5X,WAAWhZ,KAC/E,CAACoB,GAAEw8C,QAAQx/C,QAAQ0E,IAAI8tB,KAAKxX,SAASnZ,IAAImB,GAAEw8C,QAAQx/C,QAAQ0E,IAAI8tB,KAAK5X,WAAW/Y,QAEvF4F,IAAK,CACHmT,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAK4F,GAAOA,EAAI+Y,UAAU1c,GAE5BkX,SAAU,CACRlT,KAAM,IACNlG,IAAK,EACLC,IAAK4F,GAAOA,EAAI+Y,UAAUzc,GAE5BY,OAAQ8C,GAAOpH,EAAEsE,OAAOtE,EAAE0E,MAAM,CAAC,EAAE,IAAI0C,EAAI+Y,YAE7Crc,KAAM,CACJyW,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAK,KAEPmZ,SAAU,CACRlT,KAAM,IACNlG,IAAK,EACLC,IAAK,KAEP8C,aAAc,OAAOtE,EAAEsE,OACb,CAAC3B,GAAEw8C,QAAQx/C,QAAQ0E,IAAIP,KAAKyW,WAAWhZ,IAAIoB,GAAEw8C,QAAQx/C,QAAQ0E,IAAIP,KAAK6W,SAASpZ,KAC/E,CAACoB,GAAEw8C,QAAQx/C,QAAQ0E,IAAIP,KAAKyW,WAAW/Y,IAAImB,GAAEw8C,QAAQx/C,QAAQ0E,IAAIP,KAAK6W,SAASnZ,QAE3FqO,WAAY,CACV0K,WAAY,CACV9S,KAAM,SACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEw8C,QAAQx/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAW/Y,IAAIoD,GAAQjC,GAAEw8C,QAAQx/C,QAAQ0E,IAAIP,KAAKQ,OAAO6b,UAAU1c,IAEzHkX,SAAU,CACRlT,KAAM,MACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEw8C,QAAQx/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASnZ,IAAIoD,GAAQjC,GAAEw8C,QAAQx/C,QAAQ0E,IAAIP,KAAKQ,OAAO6b,UAAUzc,IAEvHY,OAAQM,GAAQ5E,EAAEsE,OAAO,CAAC,EAAE,GACnB,CAAC3B,GAAEw8C,QAAQx/C,QAAQ0E,IAAIwL,WAAW0K,WAAW/Y,IAAIoD,GAChDjC,GAAEw8C,QAAQx/C,QAAQ0E,IAAIwL,WAAW8K,SAASnZ,IAAIoD,SAI9DjC,GAAEy8C,QAAU,IAAIp/C,EAAEipC,KAAKiW,IAAI,YAC3B,iHAAkH,CAChHrL,OAAQ,EAAE,gBAAmB,iBAC7BvvC,OAAQtE,EAAEsE,OAAO,CAAC,EAAE,oBAAoB,oBAAoB,CAAC,mBAAmB,qBAChF4M,YAAa,CACX,cACA,cACA,iBACA,iBACA,gBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBAEF7M,IAAK,CACHq+B,KAAM,CACJnoB,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEy8C,QAAQz/C,QAAQ2E,OAAO6b,UAAU1c,EAAId,GAAEy8C,QAAQz/C,QAAQuR,YAAYtM,KAEhG+V,SAAU,CACRlT,KAAM,IACNlG,IAAI,EACJC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEy8C,QAAQz/C,QAAQ2E,OAAO6b,UAAUzc,EAAIf,GAAEy8C,QAAQz/C,QAAQuR,YAAYtM,KAEhGN,OAAQM,GAAQ5E,EAAEsE,OAAO,CAAC3B,GAAEy8C,QAAQz/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAWhZ,IAC9CoB,GAAEy8C,QAAQz/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASpZ,KACrC,CAACoB,GAAEy8C,QAAQz/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAW/Y,IAAIoD,GAC1CjC,GAAEy8C,QAAQz/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASnZ,IAAIoD,MAE5DqT,KAAM,CACJsC,WAAY,CACV9S,KAAM,UACNlG,UAAW,OAAOoB,GAAEy8C,QAAQz/C,QAAQ2E,OAAO/C,IAAIkC,GAC/CjC,UAAW,OAAOmB,GAAEy8C,QAAQz/C,QAAQ2E,OAAO9C,IAAIiC,IAEjDkX,SAAU,CACRlT,KAAM,WACNlG,UAAW,OAAOoB,GAAEy8C,QAAQz/C,QAAQ2E,OAAO/C,IAAImC,GAC/ClC,UAAW,OAAOmB,GAAEy8C,QAAQz/C,QAAQ2E,OAAO9C,IAAIkC,IAEjDY,aAAc,OAAO3B,GAAEy8C,QAAQz/C,QAAQ2E,SAEzC6tB,KAAM,CACJ5X,WAAY,CACV9S,KAAM,YAENlG,KAAM,IACNC,IAAK,KAEPmZ,SAAU,CACRlT,KAAM,WAENlG,IAAK,GACLC,IAAK,IAEP8C,aAAc,OAAOtE,EAAEsyB,aACb,CAAC3vB,GAAEy8C,QAAQz/C,QAAQ0E,IAAI8tB,KAAKxX,SAASpZ,IAAIoB,GAAEy8C,QAAQz/C,QAAQ0E,IAAI8tB,KAAK5X,WAAWhZ,KAC/E,CAACoB,GAAEy8C,QAAQz/C,QAAQ0E,IAAI8tB,KAAKxX,SAASnZ,IAAImB,GAAEy8C,QAAQz/C,QAAQ0E,IAAI8tB,KAAK5X,WAAW/Y,QAE3F4F,IAAK,CACHmT,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAK4F,GAAOA,EAAI+Y,UAAU1c,GAE5BkX,SAAU,CACRlT,KAAM,IACNlG,IAAK,EACLC,IAAK4F,GAAOA,EAAI+Y,UAAUzc,GAE5BY,OAAQ8C,GAAOpH,EAAEsE,OAAOtE,EAAE0E,MAAM,CAAC,EAAE,IAAI0C,EAAI+Y,YAE7Crc,KAAM,CACJyW,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAK,KAEPmZ,SAAU,CACRlT,KAAM,IACNlG,IAAK,EACLC,IAAK,KAEP8C,aAAc,OAAOtE,EAAEsE,OACb,CAAC3B,GAAEy8C,QAAQz/C,QAAQ0E,IAAIP,KAAKyW,WAAWhZ,IAAIoB,GAAEy8C,QAAQz/C,QAAQ0E,IAAIP,KAAK6W,SAASpZ,KAC/E,CAACoB,GAAEy8C,QAAQz/C,QAAQ0E,IAAIP,KAAKyW,WAAW/Y,IAAImB,GAAEy8C,QAAQz/C,QAAQ0E,IAAIP,KAAK6W,SAASnZ,QAE3FqO,WAAY,CACV0K,WAAY,CACV9S,KAAM,SACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEy8C,QAAQz/C,QAAQ0E,IAAIq+B,KAAKnoB,WAAW/Y,IAAIoD,GAAQjC,GAAEy8C,QAAQz/C,QAAQ0E,IAAIP,KAAKQ,OAAO6b,UAAU1c,IAEzHkX,SAAU,CACRlT,KAAM,MACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEy8C,QAAQz/C,QAAQ0E,IAAIq+B,KAAK/nB,SAASnZ,IAAIoD,GAAQjC,GAAEy8C,QAAQz/C,QAAQ0E,IAAIP,KAAKQ,OAAO6b,UAAUzc,IAEvHY,OAAQM,GAAQ5E,EAAEsE,OAAO,CAAC,EAAE,GACnB,CAAC3B,GAAEy8C,QAAQz/C,QAAQ0E,IAAIwL,WAAW0K,WAAW/Y,IAAIoD,GAChDjC,GAAEy8C,QAAQz/C,QAAQ0E,IAAIwL,WAAW8K,SAASnZ,IAAIoD,SAI9DjC,GAAEmtB,QAAU9vB,EAAEk/C,IAAIG,SAClBr/C,EAAES,WAAWkC,GAAEmtB,QAAS,CACtB+jB,OAAQ,EAAE,gBAAiB,iBAC3BvvC,OAAQtE,EAAEsE,OAAO,CAAC,EAAE,iBAAkB,iBAAiB,CAAC,gBAAiB,mBACzE4M,YAAa,CACX,YACA,YACA,aACA,cACA,cACA,eACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,iBACA,mBACA,oBACA,qBAEF7M,IAAK,CACHq+B,KAAM,CACJnoB,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEmtB,QAAQnwB,QAAQ2E,OAAO6b,UAAU1c,EAAId,GAAEmtB,QAAQnwB,QAAQuR,YAAYtM,KAEhG+V,SAAU,CACRlT,KAAM,IACNlG,IAAI,EACJC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEmtB,QAAQnwB,QAAQ2E,OAAO6b,UAAUzc,EAAIf,GAAEmtB,QAAQnwB,QAAQuR,YAAYtM,KAEhGN,OAAQM,GAAQ5E,EAAEsE,OAAO,CAAC3B,GAAEmtB,QAAQnwB,QAAQ0E,IAAIq+B,KAAKnoB,WAAWhZ,IAC9CoB,GAAEmtB,QAAQnwB,QAAQ0E,IAAIq+B,KAAK/nB,SAASpZ,KACrC,CAACoB,GAAEmtB,QAAQnwB,QAAQ0E,IAAIq+B,KAAKnoB,WAAW/Y,IAAIoD,GAC1CjC,GAAEmtB,QAAQnwB,QAAQ0E,IAAIq+B,KAAK/nB,SAASnZ,IAAIoD,MAE5DqT,KAAM,CACJsC,WAAY,CACV9S,KAAM,UACNlG,UAAW,OAAOoB,GAAEmtB,QAAQnwB,QAAQ2E,OAAO/C,IAAIkC,GAC/CjC,UAAW,OAAOmB,GAAEmtB,QAAQnwB,QAAQ2E,OAAO9C,IAAIiC,IAEjDkX,SAAU,CACRlT,KAAM,WACNlG,UAAW,OAAOoB,GAAEmtB,QAAQnwB,QAAQ2E,OAAO/C,IAAImC,GAC/ClC,UAAW,OAAOmB,GAAEmtB,QAAQnwB,QAAQ2E,OAAO9C,IAAIkC,IAEjDY,aAAc,OAAO3B,GAAEmtB,QAAQnwB,QAAQ2E,SAEzC6tB,KAAM,CACJ5X,WAAY,CACV9S,KAAM,YACNlG,UAAW,OAAOoB,GAAEmtB,QAAQyG,UAAU5zB,GAAEmtB,QAAQnwB,QAAQ2E,OAAO/C,KAAKkxB,KACpEjxB,UAAW,OAAOmB,GAAEmtB,QAAQyG,UAAU5zB,GAAEmtB,QAAQnwB,QAAQ2E,OAAO9C,KAAKixB,MAEtE9X,SAAU,CACRlT,KAAM,WACNlG,UAAW,OAAOoB,GAAEmtB,QAAQyG,UAAU5zB,GAAEmtB,QAAQnwB,QAAQ2E,OAAO/C,KAAKmxB,KACpElxB,UAAW,OAAOmB,GAAEmtB,QAAQyG,UAAU5zB,GAAEmtB,QAAQnwB,QAAQ2E,OAAO9C,KAAKkxB,MAEtEpuB,aAAc,OAAOtE,EAAEsyB,aACjB,CAAC3vB,GAAEmtB,QAAQnwB,QAAQ0E,IAAI8tB,KAAKxX,SAASpZ,IAAIoB,GAAEmtB,QAAQnwB,QAAQ0E,IAAI8tB,KAAK5X,WAAWhZ,KAC/E,CAACoB,GAAEmtB,QAAQnwB,QAAQ0E,IAAI8tB,KAAKxX,SAASnZ,IAAImB,GAAEmtB,QAAQnwB,QAAQ0E,IAAI8tB,KAAK5X,WAAW/Y,QAEvF4F,IAAK,CACHmT,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAK4F,GAAOA,EAAI+Y,UAAU1c,GAE5BkX,SAAU,CACRlT,KAAM,IACNlG,IAAK,EACLC,IAAK4F,GAAOA,EAAI+Y,UAAUzc,GAE5BY,OAAQ8C,GAAOpH,EAAEsE,OAAOtE,EAAE0E,MAAM,CAAC,EAAE,IAAI0C,EAAI+Y,YAE7Crc,KAAM,CACJyW,WAAY,CACV9S,KAAM,IACNlG,IAAK,EACLC,IAAK,KAEPmZ,SAAU,CACRlT,KAAM,IACNlG,IAAK,EACLC,IAAK,KAEP8C,aAAc,OAAOtE,EAAEsE,OACb,CAAC3B,GAAEmtB,QAAQnwB,QAAQ0E,IAAIP,KAAKyW,WAAWhZ,IAAIoB,GAAEmtB,QAAQnwB,QAAQ0E,IAAIP,KAAK6W,SAASpZ,KAC/E,CAACoB,GAAEmtB,QAAQnwB,QAAQ0E,IAAIP,KAAKyW,WAAW/Y,IAAImB,GAAEmtB,QAAQnwB,QAAQ0E,IAAIP,KAAK6W,SAASnZ,QAE3FqO,WAAY,CACV0K,WAAY,CACV9S,KAAM,SACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEmtB,QAAQnwB,QAAQ0E,IAAIq+B,KAAKnoB,WAAW/Y,IAAIoD,GAAQjC,GAAEmtB,QAAQnwB,QAAQ0E,IAAIP,KAAKQ,OAAO6b,UAAU1c,IAEzHkX,SAAU,CACRlT,KAAM,MACNlG,IAAK,EACLC,IAAKoD,GAASS,KAAKsL,MAAMhO,GAAEmtB,QAAQnwB,QAAQ0E,IAAIq+B,KAAK/nB,SAASnZ,IAAIoD,GAAQjC,GAAEmtB,QAAQnwB,QAAQ0E,IAAIP,KAAKQ,OAAO6b,UAAUzc,IAEvHY,OAAQM,GAAQ5E,EAAEsE,OAAO,CAAC,EAAE,GACnB,CAAC3B,GAAEmtB,QAAQnwB,QAAQ0E,IAAIwL,WAAW0K,WAAW/Y,IAAIoD,GAChDjC,GAAEmtB,QAAQnwB,QAAQ0E,IAAIwL,WAAW8K,SAASnZ,IAAIoD,SAjgBhE,GAugBAjC,GAAEywC,YAAcpgC,EAChBrQ,GAAE6pB,kBAAoBxZ,EACtBrQ,GAAE8pB,SAAWzZ,EACbrQ,GAAE+M,SAAWsD,EACbrQ,GAAE2iB,sBAAwBtS,EAC1BrQ,GAAE6M,SAAWwD,EACbrQ,GAAEyhC,aAAepxB,EACjBrQ,GAAEgS,oBAAsB3B,EACxBrQ,GAAE28C,iBAAmBtsC,EACrBrQ,GAAEgN,mBAAqBqD,EACvBrQ,GAAEC,kBAAoBoQ,EACtBrQ,GAAEoC,qBAAuBiO,EACzBrQ,GAAE48C,eAAiBvsC,EACnBrQ,GAAEiP,uBAAyBoB,EAC3BrQ,GAAE4gC,iBAAmBvwB,EACrBrQ,GAAE2gC,iBAAmBtwB,EACrBrQ,GAAE62C,kBAAoBxmC,EACtBrQ,GAAEs7B,YAAcjrB,EAChBrQ,GAAE0kC,kBAAoBr0B,EACtBrQ,GAAE2kC,cAAgBt0B,GAClBrQ,GAAEsiC,cAAgBjyB,GAClBrQ,GAAEgmC,YAAc31B,GAChBrQ,GAAE2mC,kBAAoBt2B,GACtBrQ,GAAE6mC,kBAAoBx2B,GACtBrQ,GAAEimC,YAAc51B,GAChBrQ,GAAE68C,cAAgBxsC,GAClBrQ,GAAE+iB,WAAa1S,GAEfrQ,GAAEo0B,aAAeA,EACjBp0B,GAAE+2B,YAAcA,EAChB/2B,GAAEo2C,iBAAmBA,GACrBp2C,GAAEk4C,aAAeA,GAGjB76C,EAAE6rC,IAAIG,YAAY,aAAc,QAASrpC,GAAEo0B,cAC3C/2B,EAAE6rC,IAAIG,YAAY,aAAc,cAAerpC,GAAE+2B,aACjD15B,EAAE6rC,IAAIG,YAAY,aAAc,mBAAoBrpC,GAAEo2C,kBACtD/4C,EAAE6rC,IAAIG,YAAY,aAAc,eAAgBrpC,GAAEk4C,cAElDl4C,GAAE4J,WAAaA,EACf5J,GAAE0J,WAAaA,EAEf1J,GAAEyJ,WAAaA,EACfzJ,GAAEoJ,WAAaA,EAEfpJ,GAAEmJ,oBAAsBA,EACxBnJ,GAAEkJ,oBAAsBA,EAExBlJ,GAAEiJ,uBAAyBA,EAC3BjJ,GAAEgJ,uBAAyBA,EAE3BhJ,GAAE+I,eAAiBA,EACnB/I,GAAE6I,eAAiBA,EAEnB7I,GAAE4I,mBAAqBA,EACvB5I,GAAE0I,mBAAqBA,EAEvB1I,GAAEyI,aAAeA,EACjBzI,GAAEuI,aAAeA,EAEjBvI,GAAE5C,aAAeA,EACjB4C,GAAE9C,aAAeA,EAEjB8C,GAAE2nC,kBAAoBA,GACtB3nC,GAAEspC,kBAAoBA,GAEtBtpC,GAAEwpC,aAAeA,GACjBxpC,GAAEupC,aAAeA,GAEjBvpC,GAAE0pC,SAAWA,GACb1pC,GAAEypC,SAAWA,GAEbzpC,GAAEmrC,iBAAmBA,GACrBnrC,GAAEutC,iBAAmBA,GAErBvtC,GAAEwtC,kBAAoBA,GAEtBxtC,GAAE/C,gBAAkBA,EACpB+C,GAAEjD,gBAAkBA,EAEpBiD,GAAE8J,aAAeA,EACjB9J,GAAE6J,aAAeA,EAEjB7J,GAAE2tC,UAAYA,GACd3tC,GAAE0tC,UAAYA,GAEd1tC,GAAE46C,oBAAsBA,GACxB56C,GAAE26C,oBAAsBA,GAExB36C,GAAE4tC,QAAUA,GACZ5tC,GAAEwL,QAAUA,GAEZxL,GAAE4U,gBAAkBA,GACpB5U,GAAE2b,gBAAkBA,GAEpB3b,GAAE+J,aAAeA,GACjB/J,GAAE0R,aAAeA,GAjiRnB"}