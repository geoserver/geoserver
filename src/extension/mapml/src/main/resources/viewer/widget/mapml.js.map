{"version":3,"file":"mapml.js","sources":["mapml.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  var StaticTileLayer = L.GridLayer.extend({\n    initialize: function (options) {\n      this.zoomBounds = this._getZoomBounds(\n        options.tileContainer,\n        options.maxZoomBound\n      );\n      L.extend(options, this.zoomBounds);\n      L.setOptions(this, options);\n      this._groups = this._groupTiles(\n        this.options.tileContainer.getElementsByTagName('map-tile')\n      );\n      this._bounds = this._getLayerBounds(this._groups, this.options.projection); //stores meter values of bounds\n      this.layerBounds = this._bounds[Object.keys(this._bounds)[0]];\n      for (let key of Object.keys(this._bounds)) {\n        this.layerBounds.extend(this._bounds[key].min);\n        this.layerBounds.extend(this._bounds[key].max);\n      }\n    },\n\n    onAdd: function (map) {\n      this._map = map;\n      L.GridLayer.prototype.onAdd.call(this, this._map);\n      this._handleMoveEnd();\n    },\n\n    getEvents: function () {\n      let events = L.GridLayer.prototype.getEvents.call(this, this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      events.move = () => {}; //needed to prevent moveend from running\n      return events;\n    },\n\n    //sets the bounds flag of the layer and calls default moveEnd if within bounds\n    //its the zoom level is between the nativeZoom and zoom then it uses the nativeZoom value to get the bound its checking\n    _handleMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let zoomLevel = mapZoom;\n      zoomLevel =\n        zoomLevel > this.options.maxNativeZoom\n          ? this.options.maxNativeZoom\n          : zoomLevel;\n      zoomLevel =\n        zoomLevel < this.options.minNativeZoom\n          ? this.options.minNativeZoom\n          : zoomLevel;\n      this.isVisible =\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this._bounds[zoomLevel] &&\n        this._bounds[zoomLevel].overlaps(\n          M.pixelToPCRSBounds(\n            this._map.getPixelBounds(),\n            this._map.getZoom(),\n            this._map.options.projection\n          )\n        );\n      if (!this.isVisible) return; //onMoveEnd still gets fired even when layer is out of bounds??, most likely need to overrride _onMoveEnd\n      this._parentOnMoveEnd();\n    },\n\n    _isValidTile(coords) {\n      return this._groups[this._tileCoordsToKey(coords)];\n    },\n\n    createTile: function (coords) {\n      let tileGroup = this._groups[this._tileCoordsToKey(coords)] || [],\n        tileElem = document.createElement('map-tile'),\n        tileSize = this.getTileSize();\n      tileElem.setAttribute('col', coords.x);\n      tileElem.setAttribute('row', coords.y);\n      tileElem.setAttribute('zoom', coords.z);\n\n      for (let i = 0; i < tileGroup.length; i++) {\n        let tile = document.createElement('img');\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tile.alt = '';\n        tile.setAttribute('role', 'presentation');\n        tile.src = tileGroup[i].src;\n        tileElem.appendChild(tile);\n      }\n      return tileElem;\n    },\n\n    _getLayerBounds: function (tileGroups, projection) {\n      let layerBounds = {},\n        tileSize = M[projection].options.crs.tile.bounds.max.x;\n      for (let tile in tileGroups) {\n        let sCoords = tile.split(':'),\n          pixelCoords = {};\n        pixelCoords.x = +sCoords[0] * tileSize;\n        pixelCoords.y = +sCoords[1] * tileSize;\n        pixelCoords.z = +sCoords[2]; //+String same as parseInt(String)\n        if (sCoords[2] in layerBounds) {\n          layerBounds[sCoords[2]].extend(L.point(pixelCoords.x, pixelCoords.y));\n          layerBounds[sCoords[2]].extend(\n            L.point(pixelCoords.x + tileSize, pixelCoords.y + tileSize)\n          );\n        } else {\n          layerBounds[sCoords[2]] = L.bounds(\n            L.point(pixelCoords.x, pixelCoords.y),\n            L.point(pixelCoords.x + tileSize, pixelCoords.y + tileSize)\n          );\n        }\n      }\n      // TODO: optimize by removing 2nd loop, add util function to convert point in pixels to point in pcrs, use that instead then this loop\n      // won't be needed\n      for (let pixelBounds in layerBounds) {\n        let zoom = +pixelBounds;\n        layerBounds[pixelBounds] = M.pixelToPCRSBounds(\n          layerBounds[pixelBounds],\n          zoom,\n          projection\n        );\n      }\n      return layerBounds;\n    },\n\n    _getZoomBounds: function (container, maxZoomBound) {\n      if (!container) return null;\n      let meta = M._metaContentToObject(\n          container.getElementsByTagName('map-tiles')[0].getAttribute('zoom')\n        ),\n        zoom = {},\n        tiles = container.getElementsByTagName('map-tile');\n      zoom.nativeZoom = +meta.value || 0;\n      zoom.maxNativeZoom = 0;\n      zoom.minNativeZoom = maxZoomBound;\n      for (let i = 0; i < tiles.length; i++) {\n        let lZoom = +tiles[i].getAttribute('zoom');\n        if (!tiles[i].getAttribute('zoom')) lZoom = zoom.nativeZoom;\n        zoom.minNativeZoom = Math.min(zoom.minNativeZoom, lZoom);\n        zoom.maxNativeZoom = Math.max(zoom.maxNativeZoom, lZoom);\n      }\n\n      //hard coded to only natively zoom out 2 levels, any more and too many tiles are going to be loaded in at one time\n      //lagging the users computer\n      zoom.minZoom = zoom.minNativeZoom - 2 <= 0 ? 0 : zoom.minNativeZoom - 2;\n      zoom.maxZoom = maxZoomBound;\n      if (meta.min)\n        zoom.minZoom =\n          +meta.min < zoom.minNativeZoom - 2 ? zoom.minNativeZoom - 2 : +meta.min;\n      if (meta.max) zoom.maxZoom = +meta.max;\n      return zoom;\n    },\n\n    _groupTiles: function (tiles) {\n      let tileMap = {};\n      for (let i = 0; i < tiles.length; i++) {\n        let tile = {};\n        tile.row = +tiles[i].getAttribute('row');\n        tile.col = +tiles[i].getAttribute('col');\n        tile.zoom = +tiles[i].getAttribute('zoom') || this.options.nativeZoom;\n        tile.src = tiles[i].getAttribute('src');\n        let tileCode = tile.col + ':' + tile.row + ':' + tile.zoom;\n        if (tileCode in tileMap) {\n          tileMap[tileCode].push(tile);\n        } else {\n          tileMap[tileCode] = [tile];\n        }\n      }\n      return tileMap;\n    }\n  });\n\n  var staticTileLayer = function (options) {\n    return new StaticTileLayer(options);\n  };\n\n  var LayerControl = L.Control.Layers.extend({\n    /* removes 'base' layers as a concept */\n    options: {\n      autoZIndex: false,\n      sortLayers: true,\n      sortFunction: function (layerA, layerB) {\n        return layerA.options.zIndex < layerB.options.zIndex\n          ? -1\n          : layerA.options.zIndex > layerB.options.zIndex\n          ? 1\n          : 0;\n      }\n    },\n    initialize: function (overlays, options) {\n      L.setOptions(this, options);\n\n      // the _layers array contains objects like {layer: layer, name: \"name\", overlay: true}\n      // the array index is the id of the layer returned by L.stamp(layer) which I guess is a unique hash\n      this._layerControlInputs = [];\n      this._layers = [];\n      this._lastZIndex = 0;\n      this._handlingClick = false;\n\n      for (var i in overlays) {\n        this._addLayer(overlays[i], i, true);\n      }\n    },\n    onAdd: function () {\n      this._initLayout();\n      this._map.on('validate', this._validateInput, this);\n      L.DomEvent.on(this.options.mapEl, 'layerchange', this._validateInput, this);\n      // Adding event on layer control button\n      L.DomEvent.on(\n        this._container.getElementsByTagName('a')[0],\n        'keydown',\n        this._focusFirstLayer,\n        this._container\n      );\n      L.DomEvent.on(\n        this._container,\n        'contextmenu',\n        this._preventDefaultContextMenu,\n        this\n      );\n      this._update();\n      //this._validateExtents();\n      if (this._layers.length < 1 && !this._map._showControls) {\n        this._container.setAttribute('hidden', '');\n      } else {\n        this._map._showControls = true;\n      }\n      return this._container;\n    },\n    onRemove: function (map) {\n      map.off('validate', this._validateInput, this);\n      L.DomEvent.off(\n        this._container.getElementsByTagName('a')[0],\n        'keydown',\n        this._focusFirstLayer,\n        this._container\n      );\n      // remove layer-registerd event handlers so that if the control is not\n      // on the map it does not generate layer events\n      for (var i = 0; i < this._layers.length; i++) {\n        this._layers[i].layer.off('add remove', this._onLayerChange, this);\n      }\n    },\n    addOrUpdateOverlay: function (layer, name) {\n      var alreadyThere = false;\n      for (var i = 0; i < this._layers.length; i++) {\n        if (this._layers[i].layer === layer) {\n          alreadyThere = true;\n          this._layers[i].name = name;\n          // replace the controls with updated controls if necessary.\n          break;\n        }\n      }\n      if (!alreadyThere) {\n        this.addOverlay(layer, name);\n      }\n      if (this._layers.length > 0) {\n        this._container.removeAttribute('hidden');\n        this._map._showControls = true;\n      }\n      return this._map ? this._update() : this;\n    },\n    removeLayer: function (layer) {\n      L.Control.Layers.prototype.removeLayer.call(this, layer);\n      if (this._layers.length === 0) {\n        this._container.setAttribute('hidden', '');\n      }\n    },\n    _validateInput: function (e) {\n      for (let i = 0; i < this._layers.length; i++) {\n        if (!this._layers[i].input.labels[0]) continue;\n        let label = this._layers[i].input.labels[0].getElementsByTagName('span'),\n          input = this._layers[i].input.labels[0].getElementsByTagName('input');\n        input[0].checked = this._layers[i].layer._layerEl.checked;\n        if (\n          this._layers[i].layer._layerEl.disabled &&\n          this._layers[i].layer._layerEl.checked\n        ) {\n          input[0].closest('fieldset').disabled = true;\n          label[0].style.fontStyle = 'italic';\n        } else {\n          input[0].closest('fieldset').disabled = false;\n          label[0].style.fontStyle = 'normal';\n        }\n        // check if an extent is disabled and disable it\n        if (\n          this._layers[i].layer._properties &&\n          this._layers[i].layer._properties._mapExtents\n        ) {\n          for (\n            let j = 0;\n            j < this._layers[i].layer._properties._mapExtents.length;\n            j++\n          ) {\n            let input =\n                this._layers[i].layer._properties._mapExtents[j].extentAnatomy,\n              label = input.getElementsByClassName('mapml-layer-item-name')[0];\n            if (\n              this._layers[i].layer._properties._mapExtents[j].disabled &&\n              this._layers[i].layer._properties._mapExtents[j].checked\n            ) {\n              label.style.fontStyle = 'italic';\n              input.disabled = true;\n            } else {\n              label.style.fontStyle = 'normal';\n              input.disabled = false;\n            }\n          }\n        }\n      }\n    },\n\n    // focus the first layer in the layer control when enter is pressed\n    _focusFirstLayer: function (e) {\n      if (\n        e.key === 'Enter' &&\n        this.className ===\n          'leaflet-control-layers leaflet-control leaflet-control-layers-expanded'\n      ) {\n        var elem =\n          this.children[1].children[2].children[0].children[0].children[0]\n            .children[0];\n        if (elem) setTimeout(() => elem.focus(), 0);\n      }\n    },\n\n    _withinZoomBounds: function (zoom, range) {\n      return range.min <= zoom && zoom <= range.max;\n    },\n    _addItem: function (obj) {\n      var layercontrols = obj.layer.getLayerUserControlsHTML();\n      // the input is required by Leaflet...\n      obj.input = layercontrols.querySelector(\n        'input.leaflet-control-layers-selector'\n      );\n\n      this._layerControlInputs.push(obj.input);\n      obj.input.layerId = L.stamp(obj.layer);\n\n      L.DomEvent.on(obj.input, 'click', this._onInputClick, this);\n      this._overlaysList.appendChild(layercontrols);\n      return layercontrols;\n    },\n\n    //overrides collapse and conditionally collapses the panel\n    collapse: function (e) {\n      if (\n        e.target.tagName === 'SELECT' ||\n        (e.relatedTarget &&\n          e.relatedTarget.parentElement &&\n          (e.relatedTarget.className === 'mapml-contextmenu mapml-layer-menu' ||\n            e.relatedTarget.parentElement.className ===\n              'mapml-contextmenu mapml-layer-menu')) ||\n        (this._map && this._map.contextMenu._layerMenu.style.display === 'block')\n      )\n        return this;\n\n      L.DomUtil.removeClass(this._container, 'leaflet-control-layers-expanded');\n      if (e.originalEvent?.pointerType === 'touch') {\n        this._container._isExpanded = false;\n      }\n      return this;\n    },\n    _preventDefaultContextMenu: function (e) {\n      let latlng = this._map.mouseEventToLatLng(e);\n      let containerPoint = this._map.mouseEventToContainerPoint(e);\n      e.preventDefault();\n      // for touch devices, when the layer control is not expanded,\n      // the layer context menu should not show on map\n      if (!this._container._isExpanded && e.pointerType === 'touch') {\n        this._container._isExpanded = true;\n        return;\n      }\n      this._map.fire('contextmenu', {\n        originalEvent: e,\n        containerPoint: containerPoint,\n        latlng: latlng\n      });\n    }\n  });\n  var layerControl = function (layers, options) {\n    return new LayerControl(layers, options);\n  };\n\n  const FALLBACK_PROJECTION = 'OSMTILE';\n  const FALLBACK_CS = 'TILEMATRIX';\n  const BLANK_TT_TREF = 'mapmltemplatedtileplaceholder';\n\n  var FeatureLayer = L.FeatureGroup.extend({\n    /*\n     * M.MapML turns any MapML feature data into a Leaflet layer. Based on L.GeoJSON.\n     *\n     * Used by MapMLLayer to create _mapmlvectors property, used to render features\n     */\n    initialize: function (mapml, options) {\n      /*\n          mapml:\n          1. for query: an array of map-feature elements that it fetches\n          2. for static templated feature: null\n          3. for non-templated feature: layer- (with no src) or mapml file (with src)\n        */\n      // options.extent: when you use a FeatureLayer, you can either get it to calculate the\n      // .layerBounds dynamically (the default), based on adds/removes of features from the layer/\n      // or you can construct it with a bounds (via options.extent),\n      // which will then remain static for the lifetime of the layer\n\n      L.setOptions(this, options);\n      if (this.options.static) {\n        this._container = L.DomUtil.create(\n          'div',\n          'leaflet-layer',\n          this.options.pane\n        );\n        // must have leaflet-pane class because of new/changed rule in leaflet.css\n        // info: https://github.com/Leaflet/Leaflet/pull/4597\n        L.DomUtil.addClass(\n          this._container,\n          'leaflet-pane mapml-vector-container'\n        );\n        L.setOptions(this.options.renderer, { pane: this._container });\n      }\n      this._layers = {};\n      if (this.options.query) {\n        this._mapmlFeatures = mapml.features ? mapml.features : mapml;\n        this.isVisible = true;\n        let native = M.getNativeVariables(mapml);\n        this.options.nativeZoom = native.zoom;\n        this.options.nativeCS = native.cs;\n      } else {\n        if (mapml) {\n          let native = M.getNativeVariables(mapml);\n          this.addData(mapml, native.cs, native.zoom);\n        } else if (!mapml) {\n          this.isVisible = false;\n          // use this.options._leafletLayer to distinguish the featureLayer constructed for initialization and for templated features / tiles\n          if (this.options._leafletLayer) {\n            // this._staticFeature should be set to true to make sure the _getEvents works properly\n            this._features = {};\n            this._staticFeature = true;\n          }\n        }\n      }\n    },\n\n    onAdd: function (map) {\n      this._map = map;\n      L.FeatureGroup.prototype.onAdd.call(this, map);\n      if (this._staticFeature) {\n        this._resetFeatures();\n        this.options._leafletLayer._map._addZoomLimit(this);\n      }\n      if (this._mapmlFeatures)\n        map.on('featurepagination', this.showPaginationFeature, this);\n    },\n\n    onRemove: function (map) {\n      if (this._mapmlFeatures) {\n        map.off('featurepagination', this.showPaginationFeature, this);\n        delete this._mapmlFeatures;\n        L.DomUtil.remove(this._container);\n      }\n      L.FeatureGroup.prototype.onRemove.call(this, map);\n      this._map.featureIndex.cleanIndex();\n    },\n\n    removeLayer: function (featureGroupLayer) {\n      L.FeatureGroup.prototype.removeLayer.call(this, featureGroupLayer);\n      delete this._layers[featureGroupLayer._leaflet_id];\n    },\n\n    getEvents: function () {\n      if (this._staticFeature) {\n        return {\n          moveend: this._handleMoveEnd,\n          zoomend: this._handleZoomEnd\n        };\n      }\n      return {};\n    },\n\n    // for query\n    showPaginationFeature: function (e) {\n      if (this.options.query && this._mapmlFeatures[e.i]) {\n        let feature = this._mapmlFeatures[e.i];\n        if (e.type === 'featurepagination') {\n          // remove map-feature only (keep meta's) when paginating\n          feature._extentEl.shadowRoot.querySelector('map-feature')?.remove();\n        } else {\n          // empty the map-extent shadowRoot\n          // remove the prev / next one <map-feature> and <map-meta>'s from shadow if there is any\n          feature._extentEl.shadowRoot.replaceChildren();\n        }\n        this.clearLayers();\n        feature._featureGroup = this.addData(\n          feature,\n          this.options.nativeCS,\n          this.options.nativeZoom\n        );\n        // append all map-meta from mapml document\n        if (e.meta) {\n          for (let i = 0; i < e.meta.length; i++) {\n            feature._extentEl.shadowRoot.appendChild(e.meta[i]);\n          }\n        }\n        feature._extentEl.shadowRoot.appendChild(feature);\n        e.popup._navigationBar.querySelector('p').innerText =\n          e.i + 1 + '/' + this.options._leafletLayer._totalFeatureCount;\n        e.popup._content\n          .querySelector('iframe')\n          .setAttribute('sandbox', 'allow-same-origin allow-forms');\n        e.popup._content.querySelector('iframe').srcdoc =\n          feature.querySelector('map-properties').innerHTML;\n        // \"zoom to here\" link need to be re-set for every pagination\n        this._map.fire('attachZoomLink', { i: e.i, currFeature: feature });\n        this._map.once(\n          'popupclose',\n          function (e) {\n            this.shadowRoot.innerHTML = '';\n          },\n          feature._extentEl\n        );\n      }\n    },\n\n    _handleMoveEnd: function () {\n      let mapZoom = this._map.getZoom(),\n        withinZoom = this.zoomBounds\n          ? mapZoom <= this.zoomBounds.maxZoom &&\n            mapZoom >= this.zoomBounds.minZoom\n          : false;\n      this.isVisible =\n        withinZoom &&\n        this._layers &&\n        this.layerBounds &&\n        this.layerBounds.overlaps(\n          M.pixelToPCRSBounds(\n            this._map.getPixelBounds(),\n            mapZoom,\n            this._map.options.projection\n          )\n        );\n      this._removeCSS();\n    },\n\n    _handleZoomEnd: function (e) {\n      // handle zoom end gets called twice for every zoom, this condition makes it go through once only.\n      if (this.zoomBounds) {\n        this._resetFeatures();\n      }\n    },\n\n    // remove or add features based on the min max attribute of the features,\n    //  and add placeholders to maintain position\n    _resetFeatures: function () {\n      // since features are removed and re-added by zoom level, need to clean the feature index before re-adding\n      if (this._map) this._map.featureIndex.cleanIndex();\n      let map = this._map || this.options._leafletLayer._map;\n      if (this._features) {\n        for (let zoom in this._features) {\n          for (let k = 0; k < this._features[zoom].length; k++) {\n            let featureGroupLayer = this._features[zoom][k],\n              checkRender = featureGroupLayer._checkRender(\n                map.getZoom(),\n                this.zoomBounds.minZoom,\n                this.zoomBounds.maxZoom\n              );\n            if (!checkRender) {\n              let placeholder = document.createElement('span');\n              placeholder.id = featureGroupLayer._leaflet_id;\n              featureGroupLayer.defaultOptions.group.insertAdjacentElement(\n                'beforebegin',\n                placeholder\n              );\n              // removing the rendering without removing the feature from the feature list\n              this.removeLayer(featureGroupLayer);\n            } else if (\n              // checking for _map so we do not enter this code block during the connectedCallBack of the map-feature\n              !map.hasLayer(featureGroupLayer) &&\n              !featureGroupLayer._map\n            ) {\n              this.addLayer(featureGroupLayer);\n              // update the layerbounds\n              let placeholder =\n                featureGroupLayer.defaultOptions.group.parentNode.querySelector(\n                  `span[id=\"${featureGroupLayer._leaflet_id}\"]`\n                );\n              placeholder.replaceWith(featureGroupLayer.defaultOptions.group);\n            }\n          }\n        }\n      }\n    },\n\n    _setZoomTransform: function (center, clampZoom) {\n      var scale = this._map.getZoomScale(this._map.getZoom(), clampZoom),\n        translate = center\n          .multiplyBy(scale)\n          .subtract(this._map._getNewPixelOrigin(center, this._map.getZoom()))\n          .round();\n\n      if (any3d) {\n        L.setTransform(this._layers[clampZoom], translate, scale);\n      } else {\n        L.setPosition(this._layers[clampZoom], translate);\n      }\n    },\n\n    addData: function (mapml, nativeCS, nativeZoom) {\n      if (mapml) {\n        this.isVisible = true;\n      }\n      var features =\n          mapml.nodeType === Node.DOCUMENT_NODE || mapml.nodeName === 'LAYER-'\n            ? mapml.getElementsByTagName('map-feature')\n            : null,\n        i,\n        len,\n        feature;\n\n      var linkedStylesheets =\n        mapml.nodeType === Node.DOCUMENT_NODE\n          ? mapml.querySelector('map-link[rel=stylesheet],map-style')\n          : null;\n      if (linkedStylesheets) {\n        var base =\n          mapml.querySelector('map-base') &&\n          mapml.querySelector('map-base').hasAttribute('href')\n            ? new URL(mapml.querySelector('map-base').getAttribute('href')).href\n            : mapml.URL;\n        M._parseStylesheetAsHTML(mapml, base, this._container);\n      }\n      if (features) {\n        for (i = 0, len = features.length; i < len; i++) {\n          // Only add this if geometry is set and not null\n          feature = features[i];\n          var geometriesExist =\n            feature.getElementsByTagName('map-geometry').length &&\n            feature.getElementsByTagName('map-coordinates').length;\n          if (geometriesExist) {\n            if (mapml.nodeType === Node.DOCUMENT_NODE) {\n              // if the <map-feature> element has migrated from mapml file,\n              // the featureGroup object should bind with the **CLONED** map-feature element in DOM instead of the feature in mapml\n              if (!feature._DOMnode) feature._DOMnode = feature.cloneNode(true);\n              feature._DOMnode._featureGroup = this.addData(\n                feature._DOMnode,\n                nativeCS,\n                nativeZoom\n              );\n            } else {\n              feature._featureGroup = this.addData(feature, nativeCS, nativeZoom);\n            }\n          }\n        }\n        return this; //if templated this runs\n      }\n\n      //if its a mapml with no more links this runs\n      var options = this.options;\n\n      if (options.filter && !options.filter(mapml)) {\n        return;\n      }\n\n      if (mapml.classList.length) {\n        options.className = mapml.classList.value;\n      }\n      let zoom = mapml.getAttribute('zoom') || nativeZoom,\n        title = mapml.querySelector('map-featurecaption');\n      title = title ? title.innerHTML : 'Feature';\n\n      if (mapml.querySelector('map-properties')) {\n        options.properties = document.createElement('div');\n        options.properties.classList.add('mapml-popup-content');\n        options.properties.insertAdjacentHTML(\n          'afterbegin',\n          mapml.querySelector('map-properties').innerHTML\n        );\n      }\n\n      let layer = this.geometryToLayer(mapml, options, nativeCS, +zoom, title);\n      if (layer) {\n        // if the layer is being used as a query handler output, it will have\n        // a color option set.  Otherwise, copy classes from the feature\n        if (!layer.options.color && mapml.hasAttribute('class')) {\n          layer.options.className = mapml.getAttribute('class');\n        }\n        layer.defaultOptions = layer.options;\n        this.resetStyle(layer);\n\n        if (options.onEachFeature) {\n          layer.bindTooltip(title, { interactive: true, sticky: true });\n        }\n        if (this._staticFeature) {\n          let featureZoom = mapml.getAttribute('zoom') || nativeZoom;\n          if (featureZoom in this._features) {\n            this._features[featureZoom].push(layer);\n          } else {\n            this._features[featureZoom] = [layer];\n          }\n        } else {\n          this.addLayer(layer);\n        }\n        if (mapml.tagName.toUpperCase() === 'MAP-FEATURE') {\n          mapml._groupEl = layer.options.group;\n        }\n        return layer;\n      }\n    },\n\n    resetStyle: function (layer) {\n      var style = this.options.style;\n      if (style) {\n        // reset any custom styles\n        L.Util.extend(layer.options, layer.defaultOptions);\n        this._setLayerStyle(layer, style);\n      }\n    },\n\n    setStyle: function (style) {\n      this.eachLayer(function (layer) {\n        this._setLayerStyle(layer, style);\n      }, this);\n    },\n\n    _setLayerStyle: function (layer, style) {\n      if (typeof style === 'function') {\n        style = style(layer.feature);\n      }\n      if (layer.setStyle) {\n        layer.setStyle(style);\n      }\n    },\n    _removeCSS: function () {\n      let toDelete = this._container.querySelectorAll(\n        'link[rel=stylesheet],style'\n      );\n      for (let i = 0; i < toDelete.length; i++) {\n        this._container.removeChild(toDelete[i]);\n      }\n    },\n    geometryToLayer: function (mapml, vectorOptions, nativeCS, zoom, title) {\n      let geometry =\n          mapml.tagName.toUpperCase() === 'MAP-FEATURE'\n            ? mapml.getElementsByTagName('map-geometry')[0]\n            : mapml,\n        cs = geometry?.getAttribute('cs') || nativeCS,\n        group = [],\n        svgGroup = L.SVG.create('g'),\n        copyOptions = Object.assign({}, vectorOptions);\n      if (geometry) {\n        for (let geo of geometry.querySelectorAll(\n          'map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint'\n        )) {\n          group.push(\n            M.path(\n              geo,\n              Object.assign(copyOptions, {\n                nativeCS: cs,\n                nativeZoom: zoom,\n                projection: this.options.projection,\n                featureID: mapml.id,\n                group: svgGroup,\n                wrappers: this._getGeometryParents(geo.parentElement),\n                featureLayer: this,\n                _leafletLayer: this.options._leafletLayer\n              })\n            )\n          );\n        }\n        let groupOptions = {\n            group: svgGroup,\n            mapmlFeature: mapml,\n            featureID: mapml.id,\n            accessibleTitle: title,\n            onEachFeature: vectorOptions.onEachFeature,\n            properties: vectorOptions.properties,\n            _leafletLayer: this.options._leafletLayer\n          },\n          collections =\n            geometry.querySelector('map-multipolygon') ||\n            geometry.querySelector('map-geometrycollection');\n        if (collections)\n          groupOptions.wrappers = this._getGeometryParents(\n            collections.parentElement\n          );\n        return M.geometry(group, groupOptions);\n      }\n    },\n\n    _getGeometryParents: function (subType, elems = []) {\n      if (subType && subType.tagName.toUpperCase() !== 'MAP-GEOMETRY') {\n        if (\n          subType.tagName.toUpperCase() === 'MAP-MULTIPOLYGON' ||\n          subType.tagName.toUpperCase() === 'MAP-GEOMETRYCOLLECTION'\n        )\n          return this._getGeometryParents(subType.parentElement, elems);\n        return this._getGeometryParents(\n          subType.parentElement,\n          elems.concat([subType])\n        );\n      } else {\n        return elems;\n      }\n    }\n  });\n  var featureLayer = function (mapml, options) {\n    return new FeatureLayer(mapml, options);\n  };\n\n  var TemplatedTileLayer = L.TileLayer.extend({\n    // a TemplateTileLayer is similar to a L.TileLayer except its templates are\n    // defined by the <map-extent><template/></map-extent>\n    // content found in the MapML document.  As such, the client map does not\n    // 'revisit' the server for more MapML content, it simply fills the map extent\n    // with tiles for which it generates requests on demand (as the user pans/zooms/resizes\n    // the map)\n    initialize: function (template, options) {\n      // _setUpTileTemplateVars needs options.crs, not available unless we set\n      // options first...\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      L.extend(options, this.zoomBounds);\n      options.tms = template.tms;\n      delete options.opacity;\n      L.setOptions(this, options);\n      this._setUpTileTemplateVars(template);\n\n      this._template = template;\n      this._initContainer();\n      // call the parent constructor with the template tref value, per the\n      // Leaflet tutorial: http://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      L.TileLayer.prototype.initialize.call(\n        this,\n        template.template,\n        L.extend(options, { pane: this._container })\n      );\n    },\n    onAdd: function () {\n      this._map._addZoomLimit(this);\n      L.TileLayer.prototype.onAdd.call(this, this._map);\n      this._handleMoveEnd();\n    },\n\n    getEvents: function () {\n      let events = L.TileLayer.prototype.getEvents.call(this, this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      return events;\n    },\n\n    _initContainer: function () {\n      if (this._container) {\n        return;\n      }\n\n      this._container = L.DomUtil.create(\n        'div',\n        'leaflet-layer',\n        this.options.pane\n      );\n      L.DomUtil.addClass(this._container, 'mapml-templated-tile-container');\n      this._updateZIndex();\n    },\n    _handleMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n      this.isVisible =\n        mapZoom <= this.options.maxZoom &&\n        mapZoom >= this.options.minZoom &&\n        this.extentBounds.overlaps(mapBounds);\n      if (!this.isVisible) return;\n      this._parentOnMoveEnd();\n    },\n    createTile: function (coords) {\n      let tileGroup = document.createElement('DIV'),\n        tileSize = this.getTileSize();\n      L.DomUtil.addClass(tileGroup, 'mapml-tile-group');\n      L.DomUtil.addClass(tileGroup, 'leaflet-tile');\n\n      this._template.linkEl.dispatchEvent(\n        new CustomEvent('tileloadstart', {\n          detail: {\n            x: coords.x,\n            y: coords.y,\n            zoom: coords.z,\n            appendTile: (elem) => {\n              tileGroup.appendChild(elem);\n            }\n          }\n        })\n      );\n\n      if (this._template.type.startsWith('image/')) {\n        let tile = L.TileLayer.prototype.createTile.call(\n          this,\n          coords,\n          function () {}\n        );\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tileGroup.appendChild(tile);\n      } else if (!this._url.includes(BLANK_TT_TREF)) {\n        // tiles of type=\"text/mapml\" will have to fetch content while creating\n        // the tile here, unless there can be a callback associated to the element\n        // that will render the content in the alread-placed tile\n        // var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n        this._fetchTile(coords, tileGroup);\n      }\n      return tileGroup;\n    },\n    _mapmlTileReady: function (tile) {\n      L.DomUtil.addClass(tile, 'leaflet-tile-loaded');\n    },\n    // instead of being child of a pane, the TemplatedTileLayers are 'owned' by the group,\n    // and so are DOM children of the group, not the pane element (the MapMLLayer is\n    // a child of the overlay pane and always has a set of sub-layers)\n    getPane: function () {\n      return this.options.pane;\n    },\n    _fetchTile: function (coords, tile) {\n      fetch(this.getTileUrl(coords), { redirect: 'follow' })\n        .then(function (response) {\n          if (response.status >= 200 && response.status < 300) {\n            return Promise.resolve(response);\n          } else {\n            console.log(\n              'Looks like there was a problem. Status Code: ' + response.status\n            );\n            return Promise.reject(response);\n          }\n        })\n        .then(function (response) {\n          return response.text();\n        })\n        .then((text) => {\n          var parser = new DOMParser();\n          return parser.parseFromString(text, 'application/xml');\n        })\n        .then((mapml) => {\n          this._createFeatures(mapml, coords, tile);\n          this._mapmlTileReady(tile);\n        })\n        .catch((err) => {\n          console.log('Error Creating Tile');\n        });\n    },\n\n    _createFeatures: function (markup, coords, tile) {\n      let stylesheets = markup.querySelector(\n        'map-link[rel=stylesheet],map-style'\n      );\n      if (stylesheets) {\n        let base =\n          markup.querySelector('map-base') &&\n          markup.querySelector('map-base').hasAttribute('href')\n            ? new URL(markup.querySelector('map-base').getAttribute('href')).href\n            : markup.URL;\n        M._parseStylesheetAsHTML(markup, base, tile);\n      }\n\n      let svg = L.SVG.create('svg'),\n        g = L.SVG.create('g'),\n        tileSize = this._map.options.crs.options.crs.tile.bounds.max.x,\n        xOffset = coords.x * tileSize,\n        yOffset = coords.y * tileSize;\n\n      let tileFeatures = M.featureLayer(markup, {\n        projection: this._map.options.projection,\n        static: false,\n        layerBounds: this.extentBounds,\n        zoomBounds: this.zoomBounds,\n        interactive: false\n      });\n\n      for (let groupID in tileFeatures._layers) {\n        for (let featureID in tileFeatures._layers[groupID]._layers) {\n          let layer = tileFeatures._layers[groupID]._layers[featureID];\n          M.FeatureRenderer.prototype._initPath(layer, false);\n          layer._project(this._map, L.point([xOffset, yOffset]), coords.z);\n          M.FeatureRenderer.prototype._addPath(layer, g, false);\n          M.FeatureRenderer.prototype._updateFeature(layer);\n        }\n      }\n      svg.setAttribute('width', tileSize.toString());\n      svg.setAttribute('height', tileSize.toString());\n      svg.appendChild(g);\n      tile.appendChild(svg);\n    },\n\n    getTileUrl: function (coords) {\n      if (\n        coords.z >= this._template.tilematrix.bounds.length ||\n        !this._template.tilematrix.bounds[coords.z].contains(coords)\n      ) {\n        return '';\n      }\n      var obj = {},\n        linkEl = this._template.linkEl,\n        zoomInput = linkEl.zoomInput;\n      obj[this._template.tilematrix.col.name] = coords.x;\n      obj[this._template.tilematrix.row.name] = coords.y;\n      if (\n        zoomInput &&\n        linkEl.hasAttribute('tref') &&\n        linkEl\n          .getAttribute('tref')\n          .includes(`{${zoomInput.getAttribute('name')}}`)\n      ) {\n        obj[this._template.zoom.name] = this._getZoomForUrl();\n      }\n      obj[this._template.pcrs.easting.left] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-left'\n      ).x;\n      obj[this._template.pcrs.easting.right] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-right'\n      ).x;\n      obj[this._template.pcrs.northing.top] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-left'\n      ).y;\n      obj[this._template.pcrs.northing.bottom] = this._tileMatrixToPCRSPosition(\n        coords,\n        'bottom-left'\n      ).y;\n      for (var v in this._template.tile) {\n        if (\n          ['row', 'col', 'zoom', 'left', 'right', 'top', 'bottom'].indexOf(v) < 0\n        ) {\n          obj[v] = this._template.tile[v];\n        }\n      }\n      if (this._map && !this._map.options.crs.infinite) {\n        let invertedY = this._globalTileRange.max.y - coords.y;\n        if (this.options.tms) {\n          obj[this._template.tilematrix.row.name] = invertedY;\n        }\n        //obj[`-${this._template.tilematrix.row.name}`] = invertedY; //leaflet has this but I dont see a use in storing row and -row as it doesnt follow that pattern\n      }\n      obj.r =\n        this.options.detectRetina && L.Browser.retina && this.options.maxZoom > 0\n          ? '@2x'\n          : '';\n      return L.Util.template(this._url, obj);\n    },\n    _tileMatrixToPCRSPosition: function (coords, pos) {\n      // this is a tile:\n      //\n      //   top-left         top-center           top-right\n      //      +------------------+------------------+\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      + center-left    center               + center-right\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      +------------------+------------------+\n      //   bottom-left     bottom-center      bottom-right\n\n      var map = this._map,\n        crs = map.options.crs,\n        tileSize = this.getTileSize(),\n        nwPoint = coords.scaleBy(tileSize),\n        sePoint = nwPoint.add(tileSize),\n        centrePoint = nwPoint.add(Math.floor(tileSize / 2)),\n        nw = crs.transformation.untransform(nwPoint, crs.scale(coords.z)),\n        se = crs.transformation.untransform(sePoint, crs.scale(coords.z)),\n        cen = crs.transformation.untransform(centrePoint, crs.scale(coords.z)),\n        result = null;\n\n      switch (pos) {\n        case 'top-left':\n          result = nw;\n          break;\n        case 'bottom-left':\n          result = new L.Point(nw.x, se.y);\n          break;\n        case 'center-left':\n          result = new L.Point(nw.x, cen.y);\n          break;\n        case 'top-right':\n          result = new L.Point(se.x, nw.y);\n          break;\n        case 'bottom-right':\n          result = se;\n          break;\n        case 'center-right':\n          result = new L.Point(se.x, cen.y);\n          break;\n        case 'top-center':\n          result = new L.Point(cen.x, nw.y);\n          break;\n        case 'bottom-center':\n          result = new L.Point(cen.x, se.y);\n          break;\n        case 'center':\n          result = cen;\n          break;\n      }\n      return result;\n    },\n    _setUpTileTemplateVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // tile with member properties as follows:\n      // {row: 'rowvarname',\n      //  col: 'colvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'}\n      template.tile = {};\n      var inputs = template.values,\n        crs = this.options.crs.options,\n        zoom,\n        east,\n        north,\n        row,\n        col;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select',\n          value = inputs[i].getAttribute('value'),\n          min = inputs[i].getAttribute('min'),\n          max = inputs[i].getAttribute('max');\n        if (type === 'location' && units === 'tilematrix') {\n          switch (axis) {\n            case 'column':\n              col = {\n                name: name,\n                min: crs.crs.tilematrix.horizontal.min,\n                max: crs.crs.tilematrix.horizontal.max(crs.resolutions.length - 1)\n              };\n              if (!isNaN(Number.parseFloat(min))) {\n                col.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                col.max = Number.parseFloat(max);\n              }\n              break;\n            case 'row':\n              row = {\n                name: name,\n                min: crs.crs.tilematrix.vertical.min,\n                max: crs.crs.tilematrix.vertical.max(crs.resolutions.length - 1)\n              };\n              if (!isNaN(Number.parseFloat(min))) {\n                row.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                row.max = Number.parseFloat(max);\n              }\n              break;\n            case 'longitude':\n            case 'easting':\n              if (!east) {\n                east = {\n                  min: crs.crs.pcrs.horizontal.min,\n                  max: crs.crs.pcrs.horizontal.max\n                };\n              }\n              if (!isNaN(Number.parseFloat(min))) {\n                east.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                east.max = Number.parseFloat(max);\n              }\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  east.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  east.right = name;\n                }\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (!north) {\n                north = {\n                  min: crs.crs.pcrs.vertical.min,\n                  max: crs.crs.pcrs.vertical.max\n                };\n              }\n              if (!isNaN(Number.parseFloat(min))) {\n                north.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                north.max = Number.parseFloat(max);\n              }\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  north.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  north.bottom = name;\n                }\n              }\n              break;\n            // unsuportted axis value\n          }\n        } else if (type && type.toLowerCase() === 'zoom') {\n          //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n          zoom = {\n            name: name,\n            min: 0,\n            max: crs.resolutions.length,\n            value: crs.resolutions.length\n          };\n          if (\n            !isNaN(Number.parseInt(value, 10)) &&\n            Number.parseInt(value, 10) >= zoom.min &&\n            Number.parseInt(value, 10) <= zoom.max\n          ) {\n            zoom.value = Number.parseInt(value, 10);\n          } else {\n            zoom.value = zoom.max;\n          }\n          if (\n            !isNaN(Number.parseInt(min, 10)) &&\n            Number.parseInt(min, 10) >= zoom.min &&\n            Number.parseInt(min, 10) <= zoom.max\n          ) {\n            zoom.min = Number.parseInt(min, 10);\n          }\n          if (\n            !isNaN(Number.parseInt(max, 10)) &&\n            Number.parseInt(max, 10) >= zoom.min &&\n            Number.parseInt(max, 10) <= zoom.max\n          ) {\n            zoom.max = Number.parseInt(max, 10);\n          }\n          template.zoom = zoom;\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          template.tile[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          // needs to be a const otherwise it gets overwritten\n          /*jshint -W104 */\n          const input = inputs[i];\n          template.tile[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      var transformation = this.options.crs.transformation,\n        tileSize = this.options.crs.options.crs.tile.bounds.max.x,\n        scale = L.bind(this.options.crs.scale, this.options.crs),\n        pcrs2tilematrix = function (c, zoom) {\n          return transformation\n            .transform(c, scale(zoom))\n            .divideBy(tileSize)\n            .floor();\n        };\n      if (east && north) {\n        template.pcrs = {};\n        template.pcrs.bounds = L.bounds(\n          [east.min, north.min],\n          [east.max, north.max]\n        );\n        template.pcrs.easting = east;\n        template.pcrs.northing = north;\n      } else if (col && row && !isNaN(zoom.value)) {\n        // convert the tile bounds at this zoom to a pcrs bounds, then\n        // go through the zoom min/max and create a tile-based bounds\n        // at each zoom that applies to the col/row values that constrain what tiles\n        // will be requested so that we don't generate too many 404s\n        if (!template.pcrs) {\n          template.pcrs = {};\n          template.pcrs.easting = '';\n          template.pcrs.northing = '';\n        }\n\n        template.pcrs.bounds = M.boundsToPCRSBounds(\n          L.bounds(L.point([col.min, row.min]), L.point([col.max, row.max])),\n          zoom.value,\n          this.options.crs,\n          M.axisToCS('column')\n        );\n\n        template.tilematrix = {};\n        template.tilematrix.col = col;\n        template.tilematrix.row = row;\n      } else {\n        console.log(\n          'Unable to determine bounds for tile template: ' + template.template\n        );\n      }\n\n      if (!template.tilematrix) {\n        template.tilematrix = {};\n        template.tilematrix.col = {};\n        template.tilematrix.row = {};\n      }\n      template.tilematrix.bounds = [];\n      var pcrsBounds = template.pcrs.bounds;\n      // the template should _always_ have a zoom, because we force it to\n      // by first processing the extent to determine the zoom and if none, adding\n      // one and second by copying that zoom into the set of template variable inputs\n      // even if it is not referenced by one of the template's variable references\n      var zmin = template.zoom ? template.zoom.min : 0,\n        zmax = template.zoom ? template.zoom.max : crs.resolutions.length;\n      for (var z = 0; z <= zmax; z++) {\n        template.tilematrix.bounds[z] =\n          z >= zmin\n            ? L.bounds(\n                pcrs2tilematrix(pcrsBounds.min, z),\n                pcrs2tilematrix(pcrsBounds.max, z)\n              )\n            : L.bounds(L.point([-1, -1]), L.point([-1, -1]));\n      }\n    },\n    _clampZoom: function (zoom) {\n      let clamp = L.GridLayer.prototype._clampZoom.call(this, zoom);\n      if (this._template.step > this.zoomBounds.maxNativeZoom)\n        this._template.step = this.zoomBounds.maxNativeZoom;\n\n      if (zoom !== clamp) {\n        zoom = clamp;\n      } else {\n        if (zoom % this._template.step !== 0) {\n          zoom = Math.floor(zoom / this._template.step) * this._template.step;\n        }\n      }\n      return zoom;\n    }\n  });\n  var templatedTileLayer = function (template, options) {\n    return new TemplatedTileLayer(template, options);\n  };\n\n  var TemplatedLayer = L.Layer.extend({\n    initialize: function (templates, options) {\n      this._templates = templates;\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n      this._container.style.opacity = this.options.opacity;\n      L.DomUtil.addClass(this._container, 'mapml-templatedlayer-container');\n\n      for (var i = 0; i < templates.length; i++) {\n        if (templates[i].rel === 'tile') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedTileLayer(\n            templates[i],\n            L.Util.extend(options, {\n              errorTileUrl:\n                'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==',\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'image') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedImageLayer(\n            templates[i],\n            L.Util.extend(options, {\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'features') {\n          this.setZIndex(options.extentZIndex);\n          this._templates[i].layer = M.templatedFeaturesLayer(\n            templates[i],\n            L.Util.extend(options, {\n              zIndex: options.extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'query') {\n          // add template to array of queryies to be added to map and processed\n          // on click/tap events\n          this.hasSetBoundsHandler = true;\n          if (!this._queries) {\n            this._queries = [];\n          }\n          let inputData = M._extractInputBounds(templates[i]);\n          templates[i].extentBounds = inputData.bounds;\n          templates[i].zoomBounds = inputData.zoomBounds;\n          templates[i]._extentEl = this.options.extentEl;\n          this._queries.push(\n            L.extend(templates[i], this._setupQueryVars(templates[i]))\n          );\n        }\n      }\n    },\n    getEvents: function () {\n      return {\n        zoomstart: this._onZoomStart\n      };\n    },\n    redraw: function () {\n      this.closePopup();\n      for (var i = 0; i < this._templates.length; i++) {\n        if (\n          this._templates[i].rel === 'tile' ||\n          this._templates[i].rel === 'image' ||\n          this._templates[i].rel === 'features'\n        ) {\n          this._templates[i].layer.redraw();\n        }\n      }\n    },\n    _onZoomStart: function () {\n      this.closePopup();\n    },\n\n    _setupQueryVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // query with member properties as follows:\n      // {width: 'widthvarname',\n      //  height: 'heightvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'\n      //  i: 'ivarname'\n      //  j: 'jvarname'}\n      //  x: 'xvarname' x being the tcrs x axis\n      //  y: 'yvarname' y being the tcrs y axis\n      //  z: 'zvarname' zoom\n      //  title: link title\n\n      var queryVarNames = { query: {} },\n        inputs = template.values;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          rel = inputs[i].getAttribute('rel'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          queryVarNames.query.width = name;\n        } else if (type === 'height') {\n          queryVarNames.query.height = name;\n        } else if (type === 'location') {\n          switch (axis) {\n            case 'x':\n            case 'y':\n            case 'column':\n            case 'row':\n              queryVarNames.query[axis] = name;\n              break;\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelleft = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tileleft = name;\n                  } else {\n                    queryVarNames.query.mapleft = name;\n                  }\n                } else if (position.match(/.*?-right/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelright = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tileright = name;\n                  } else {\n                    queryVarNames.query.mapright = name;\n                  }\n                }\n              } else {\n                queryVarNames.query[axis] = name;\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixeltop = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tiletop = name;\n                  } else {\n                    queryVarNames.query.maptop = name;\n                  }\n                } else if (position.match(/bottom-.*?/i)) {\n                  if (rel === 'pixel') {\n                    queryVarNames.query.pixelbottom = name;\n                  } else if (rel === 'tile') {\n                    queryVarNames.query.tilebottom = name;\n                  } else {\n                    queryVarNames.query.mapbottom = name;\n                  }\n                }\n              } else {\n                queryVarNames.query[axis] = name;\n              }\n              break;\n            case 'i':\n              if (units === 'tile') {\n                queryVarNames.query.tilei = name;\n              } else {\n                queryVarNames.query.mapi = name;\n              }\n              break;\n            case 'j':\n              if (units === 'tile') {\n                queryVarNames.query.tilej = name;\n              } else {\n                queryVarNames.query.mapj = name;\n              }\n              break;\n            // unsuportted axis value\n          }\n        } else if (type === 'zoom') {\n          //<input name=\"...\" type=\"zoom\" value=\"0\" min=\"0\" max=\"17\">\n          queryVarNames.query.zoom = name;\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          queryVarNames.query[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          queryVarNames.query[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      queryVarNames.query.title = template.title;\n      return queryVarNames;\n    },\n    reset: function (templates, extentZIndex) {\n      if (!templates) {\n        return;\n      }\n      if (!this._map) {\n        return;\n      }\n      var addToMap = this._map && this._map.hasLayer(this),\n        old_templates = this._templates;\n      delete this._queries;\n      this._map.off('click', null, this);\n\n      this._templates = templates;\n      for (var i = 0; i < templates.length; i++) {\n        if (templates[i].rel === 'tile') {\n          this._templates[i].layer = M.templatedTileLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              errorTileUrl:\n                'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==',\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'image') {\n          this._templates[i].layer = M.templatedImageLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'features') {\n          this._templates[i].layer = M.templatedFeaturesLayer(\n            templates[i],\n            L.Util.extend(this.options, {\n              zIndex: extentZIndex,\n              pane: this._container\n            })\n          );\n        } else if (templates[i].rel === 'query') {\n          if (!this._queries) {\n            this._queries = [];\n          }\n          this._queries.push(\n            L.extend(templates[i], this._setupQueryVars(templates[i]))\n          );\n        }\n        if (addToMap) {\n          this.onAdd(this._map);\n        }\n      }\n      for (i = 0; i < old_templates.length; i++) {\n        if (this._map.hasLayer(old_templates[i].layer)) {\n          this._map.removeLayer(old_templates[i].layer);\n        }\n      }\n    },\n    onAdd: function (map) {\n      for (var i = 0; i < this._templates.length; i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.addLayer(this._templates[i].layer);\n        }\n      }\n    },\n    //addTo: function(map) {\n    //for(let i = 0; i < this._templates.length; i++){\n    //    this._templates[0].layer.addTo(map);\n    //}\n    //},\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      for (var i = 0; i < this._templates.length; i++) {\n        if (this._templates[i].rel !== 'query') {\n          map.removeLayer(this._templates[i].layer);\n        }\n      }\n    },\n\n    _previousFeature: function (e) {\n      if (this._count + -1 >= 0) {\n        this._count--;\n        this._map.fire('featurepagination', { i: this._count, popup: this });\n      }\n    },\n\n    _nextFeature: function (e) {\n      if (this._count + 1 < this._source._totalFeatureCount) {\n        this._count++;\n        this._map.fire('featurepagination', { i: this._count, popup: this });\n      }\n    },\n\n    changeOpacity: function (opacity) {\n      this._container.style.opacity = opacity;\n    }\n  });\n  var templatedLayer = function (templates, options) {\n    // templates is an array of template objects\n    // a template object contains the template, plus associated <input> elements\n    // which need to be processed just prior to creating a url from the template\n    // with the values of the inputs\n    return new TemplatedLayer(templates, options);\n  };\n\n  var TemplatedFeaturesLayer = L.Layer.extend({\n    // this and M.ImageLayer could be merged or inherit from a common parent\n    initialize: function (template, options) {\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      this._template = template;\n      this._extentEl = options.extentEl;\n      this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n      L.extend(options, this.zoomBounds);\n      L.DomUtil.addClass(this._container, 'mapml-features-container');\n      delete options.opacity;\n      L.setOptions(\n        this,\n        L.extend(options, this._setUpFeaturesTemplateVars(template))\n      );\n    },\n    getEvents: function () {\n      var events = {\n        moveend: this._onMoveEnd\n      };\n      return events;\n    },\n    onAdd: function () {\n      this._map._addZoomLimit(this);\n      var opacity = this.options.opacity || 1,\n        container = this._container,\n        map = this._map;\n      if (!this._features) {\n        this._features = M.featureLayer(null, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: container,\n          // the bounds will be static, fixed, constant for the lifetime of the layer\n          layerBounds: this.extentBounds,\n          zoomBounds: this.zoomBounds,\n          opacity: opacity,\n          projection: map.options.projection,\n          static: true,\n          onEachFeature: function (properties, geometry) {\n            // need to parse as HTML to preserve semantics and styles\n            var c = document.createElement('div');\n            c.classList.add('mapml-popup-content');\n            c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n            geometry.bindPopup(c, { autoClose: false, minWidth: 108 });\n          }\n        });\n      }\n\n      map.fire('moveend'); // TODO: replace with moveend handler for layer and not entire map\n    },\n    redraw: function () {\n      this._onMoveEnd();\n    },\n\n    _removeCSS: function () {\n      let toDelete = this._container.querySelectorAll(\n        'link[rel=stylesheet],style'\n      );\n      for (let i = 0; i < toDelete.length; i++) {\n        let parent = toDelete[i].parentNode;\n        parent.removeChild(toDelete[i]);\n      }\n    },\n\n    _onMoveEnd: function () {\n      let history = this._map.options.mapEl._history;\n      let current = history[history.length - 1];\n      let previous = history[history.length - 2] ?? current;\n      let step = this._template.step;\n      let mapZoom = this._map.getZoom();\n      let steppedZoom = mapZoom;\n      //If zooming out from one step interval into a lower one or panning, set the stepped zoom\n      if (\n        (step !== '1' &&\n          (mapZoom + 1) % step === 0 &&\n          current.zoom === previous.zoom - 1) ||\n        current.zoom === previous.zoom ||\n        Math.floor(mapZoom / step) * step !==\n          Math.floor(previous.zoom / step) * step\n      ) {\n        steppedZoom = Math.floor(mapZoom / step) * step;\n      }\n      //No request needed if in a step interval (unless panning)\n      else if (mapZoom % this._template.step !== 0) return;\n\n      let scaleBounds = this._map.getPixelBounds(\n        this._map.getCenter(),\n        steppedZoom\n      );\n      let url = this._getfeaturesUrl(steppedZoom, scaleBounds);\n      //No request needed if the current template url is the same as the url to request\n      if (url === this._url) return;\n\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n      this.isVisible =\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this.extentBounds.overlaps(mapBounds);\n\n      this._features.clearLayers();\n      // shadow may has not yet attached to <map-extent> for the first-time rendering\n      if (this._extentEl.shadowRoot) {\n        this._extentEl.shadowRoot.innerHTML = '';\n      }\n      this._removeCSS();\n      //Leave the layers cleared if the layer is not visible\n      if (!this.isVisible && steppedZoom === mapZoom) {\n        this._url = '';\n        return;\n      }\n\n      // TODO add preference with a bit less weight than that for text/mapml; 0.8 for application/geo+json; 0.6\n      var mapml,\n        headers = new Headers({\n          Accept: 'text/mapml;q=0.9,application/geo+json;q=0.8'\n        }),\n        parser = new DOMParser(),\n        features = this._features,\n        extentEl = this._extentEl,\n        map = this._map,\n        context = this,\n        MAX_PAGES = 10,\n        _pullFeatureFeed = function (url, limit) {\n          return fetch(url, { redirect: 'follow', headers: headers })\n            .then(function (response) {\n              return response.text();\n            })\n            .then(function (text) {\n              //TODO wrap this puppy in a try/catch/finally to parse application/geo+json if necessary\n              mapml = parser.parseFromString(text, 'application/xml');\n              var base = new URL(\n                mapml.querySelector('map-base')\n                  ? mapml.querySelector('map-base').getAttribute('href')\n                  : url\n              ).href;\n              url = mapml.querySelector('map-link[rel=next]')\n                ? mapml.querySelector('map-link[rel=next]').getAttribute('href')\n                : null;\n              url = url ? new URL(url, base).href : null;\n              // TODO if the xml parser barfed but the response is application/geo+json, use the parent addData method\n              let nativeZoom = (extentEl._nativeZoom =\n                (mapml.querySelector('map-meta[name=zoom]') &&\n                  +M._metaContentToObject(\n                    mapml\n                      .querySelector('map-meta[name=zoom]')\n                      .getAttribute('content')\n                  ).value) ||\n                0);\n              let nativeCS = (extentEl._nativeCS =\n                (mapml.querySelector('map-meta[name=cs]') &&\n                  M._metaContentToObject(\n                    mapml\n                      .querySelector('map-meta[name=cs]')\n                      .getAttribute('content')\n                  ).content) ||\n                'GCRS');\n              features.addData(mapml, nativeCS, nativeZoom);\n              // \"migrate\" to extent's shadow\n              // make a clone, prevent the elements from being removed from mapml file\n              // same as _attachToLayer() in MapMLLayer.js\n              for (let el of mapml.querySelector('map-body').children) {\n                extentEl.shadowRoot.append(el._DOMnode);\n                el._DOMnode._extentEl = extentEl;\n              }\n              if (url && --limit) {\n                return _pullFeatureFeed(url, limit);\n              }\n            });\n        };\n      this._url = url;\n      _pullFeatureFeed(url, MAX_PAGES)\n        .then(function () {\n          map.addLayer(features);\n          //Fires event for feature index overlay\n          map.fire('templatedfeatureslayeradd');\n          M.TemplatedFeaturesLayer.prototype._updateTabIndex(context);\n        })\n        .catch(function (error) {\n          console.log(error);\n        });\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n      return this;\n    },\n    _updateTabIndex: function (context) {\n      let c = context || this;\n      for (let layerNum in c._features._layers) {\n        let layer = c._features._layers[layerNum];\n        if (layer._path) {\n          if (layer._path.getAttribute('d') !== 'M0 0') {\n            layer._path.setAttribute('tabindex', 0);\n          } else {\n            layer._path.removeAttribute('tabindex');\n          }\n          if (layer._path.childElementCount === 0) {\n            let title = document.createElement('title');\n            title.innerText = 'Feature';\n            layer._path.appendChild(title);\n          }\n        }\n      }\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function () {\n      this._map.removeLayer(this._features);\n    },\n    _getfeaturesUrl: function (zoom, bounds) {\n      if (zoom === undefined) zoom = this._map.getZoom();\n      if (bounds === undefined) bounds = this._map.getPixelBounds();\n      var obj = {};\n      if (this.options.feature.zoom) {\n        obj[this.options.feature.zoom] = zoom;\n      }\n      if (this.options.feature.width) {\n        obj[this.options.feature.width] = this._map.getSize().x;\n      }\n      if (this.options.feature.height) {\n        obj[this.options.feature.height] = this._map.getSize().y;\n      }\n      if (this.options.feature.bottom) {\n        obj[this.options.feature.bottom] = this._TCRSToPCRS(bounds.max, zoom).y;\n      }\n      if (this.options.feature.left) {\n        obj[this.options.feature.left] = this._TCRSToPCRS(bounds.min, zoom).x;\n      }\n      if (this.options.feature.top) {\n        obj[this.options.feature.top] = this._TCRSToPCRS(bounds.min, zoom).y;\n      }\n      if (this.options.feature.right) {\n        obj[this.options.feature.right] = this._TCRSToPCRS(bounds.max, zoom).x;\n      }\n      // hidden and other variables that may be associated\n      for (var v in this.options.feature) {\n        if (\n          ['width', 'height', 'left', 'right', 'top', 'bottom', 'zoom'].indexOf(\n            v\n          ) < 0\n        ) {\n          obj[v] = this.options.feature[v];\n        }\n      }\n      return L.Util.template(this._template.template, obj);\n    },\n    _TCRSToPCRS: function (coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    },\n    _setUpFeaturesTemplateVars: function (template) {\n      // process the inputs and create an object named \"extent\"\n      // with member properties as follows:\n      // {width: {name: 'widthvarname'}, // value supplied by map if necessary\n      //  height: {name: 'heightvarname'}, // value supplied by map if necessary\n      //  left: {name: 'leftvarname', axis: 'leftaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n      //  right: {name: 'rightvarname', axis: 'rightaxisname'}, // axis name (coordinate system of) drives the value supplied by the map\n      //  top: {name: 'topvarname', axis: 'topaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n      //  bottom: {name: 'bottomvarname', axis: 'bottomaxisname'} // axis name drives (coordinate system of) the value supplied by the map\n      //  zoom: {name: 'zoomvarname'}\n      //  hidden: [{name: name, value: value}]}\n\n      var featuresVarNames = { feature: {} },\n        inputs = template.values;\n      featuresVarNames.feature.hidden = [];\n      for (var i = 0; i < inputs.length; i++) {\n        // this can be removed when the spec removes the deprecated inputs...\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          value = inputs[i].getAttribute('value'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          featuresVarNames.feature.width = name;\n        } else if (type === 'height') {\n          featuresVarNames.feature.height = name;\n        } else if (type === 'zoom') {\n          featuresVarNames.feature.zoom = name;\n        } else if (\n          type === 'location' &&\n          (units === 'pcrs' || units === 'gcrs')\n        ) {\n          //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting\">\n          switch (axis) {\n            case 'x':\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  featuresVarNames.feature.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  featuresVarNames.feature.right = name;\n                }\n              }\n              break;\n            case 'y':\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  featuresVarNames.feature.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  featuresVarNames.feature.bottom = name;\n                }\n              }\n              break;\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          featuresVarNames.feature[name] = function () {\n            return parsedselect.value;\n          };\n          // projection is deprecated, make it hidden\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          featuresVarNames.feature[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      return featuresVarNames;\n    }\n  });\n  var templatedFeaturesLayer = function (template, options) {\n    return new TemplatedFeaturesLayer(template, options);\n  };\n\n  var TemplatedImageLayer = L.Layer.extend({\n    initialize: function (template, options) {\n      this._template = template;\n      this._container = L.DomUtil.create('div', 'leaflet-layer', options.pane);\n      L.DomUtil.addClass(this._container, 'mapml-image-container');\n      let inputData = M._extractInputBounds(template);\n      this.zoomBounds = inputData.zoomBounds;\n      this.extentBounds = inputData.bounds;\n      this.isVisible = true;\n      delete options.opacity;\n      L.extend(options, this.zoomBounds);\n      L.setOptions(\n        this,\n        L.extend(options, this._setUpExtentTemplateVars(template))\n      );\n    },\n    getEvents: function () {\n      var events = {\n        moveend: this._onMoveEnd,\n        zoomstart: this._clearLayer\n      };\n      return events;\n    },\n    onAdd: function () {\n      this._map._addZoomLimit(this); //used to set the zoom limit of the map\n      this.setZIndex(this.options.zIndex);\n      this._onAdd();\n    },\n    redraw: function () {\n      this._onMoveEnd();\n    },\n\n    _clearLayer: function () {\n      let containerImages = this._container.querySelectorAll('img');\n      for (let i = 0; i < containerImages.length; i++) {\n        this._container.removeChild(containerImages[i]);\n      }\n    },\n\n    _addImage: function (bounds, zoom, loc) {\n      let map = this._map;\n      let overlayToRemove = this._imageOverlay;\n      let src = this.getImageUrl(bounds, zoom);\n      let size = map.getSize();\n      this._imageOverlay = M.imageLayer(src, loc, size, 0, this._container);\n      this._imageOverlay._step = this._template.step;\n      this._imageOverlay.addTo(map);\n      if (overlayToRemove) {\n        this._imageOverlay._overlayToRemove = overlayToRemove._url;\n        this._imageOverlay.on('load error', function () {\n          map.removeLayer(overlayToRemove);\n        });\n      }\n    },\n\n    _scaleImage: function (bounds, zoom) {\n      let obj = this;\n      setTimeout(function () {\n        let step = obj._template.step;\n        let steppedZoom = Math.floor(zoom / step) * step;\n        let scale = obj._map.getZoomScale(zoom, steppedZoom);\n        let translate = bounds.min\n          .multiplyBy(scale)\n          .subtract(obj._map._getNewPixelOrigin(obj._map.getCenter(), zoom))\n          .round();\n        L.DomUtil.setTransform(obj._imageOverlay._image, translate, scale);\n      });\n    },\n\n    _onAdd: function () {\n      let zoom = this._map.getZoom();\n      let steppedZoom = zoom;\n      let step = this._template.step;\n\n      if (zoom % step !== 0) steppedZoom = Math.floor(zoom / step) * step;\n      let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n      this._pixelOrigins = {};\n      this._pixelOrigins[steppedZoom] = bounds.min;\n      // if the map is panned before the new image layer is added,\n      // the location that the layer should be added to is no longer (0,0) but need to be calculated\n      let loc = this._map\n        .getPixelBounds()\n        .min.subtract(this._map.getPixelOrigin());\n      this._addImage(bounds, steppedZoom, loc);\n      if (zoom !== steppedZoom) {\n        this._scaleImage(bounds, zoom);\n      }\n    },\n\n    _onMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let history = this._map.options.mapEl._history;\n      let current = history[history.length - 1];\n      let previous = history[history.length - 2];\n      if (!previous) previous = current;\n      let step = this._template.step;\n      let steppedZoom = Math.floor(mapZoom / step) * step;\n      let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n      //Zooming from one step increment into a lower one\n      if (\n        step !== '1' &&\n        (mapZoom + 1) % step === 0 &&\n        current.zoom === previous.zoom - 1\n      ) {\n        this._addImage(bounds, steppedZoom, L.point(0, 0));\n        this._scaleImage(bounds, mapZoom);\n        //Zooming or panning within a step increment\n      } else if (e && mapZoom % step !== 0) {\n        this._imageOverlay._overlayToRemove = this._imageOverlay._url;\n        if (current.zoom !== previous.zoom) {\n          //Zoomed from within one step increment into another\n          this._addImage(bounds, steppedZoom, L.point(0, 0));\n          this._pixelOrigins[steppedZoom] = bounds.min;\n          this._scaleImage(bounds, mapZoom);\n        } else {\n          // Panning within a step increment\n          let pixelOrigin = this._pixelOrigins[steppedZoom];\n          let loc = bounds.min.subtract(pixelOrigin);\n          if (this.getImageUrl(bounds, steppedZoom) === this._imageOverlay._url)\n            return;\n          this._addImage(bounds, steppedZoom, loc);\n          this._scaleImage(bounds, mapZoom);\n        }\n        // Zooming from one step decrement into a higher one\n        // OR panning when mapZoom % step === 0\n      } else {\n        let mapBounds = M.pixelToPCRSBounds(\n          this._map.getPixelBounds(),\n          mapZoom,\n          this._map.options.projection\n        );\n        this.isVisible =\n          mapZoom <= this.zoomBounds.maxZoom &&\n          mapZoom >= this.zoomBounds.minZoom &&\n          this.extentBounds.overlaps(mapBounds);\n        if (!this.isVisible) {\n          this._clearLayer();\n          return;\n        }\n        var map = this._map,\n          loc = map.getPixelBounds().min.subtract(map.getPixelOrigin());\n        this._addImage(map.getPixelBounds(), mapZoom, loc);\n        this._pixelOrigins[mapZoom] = map.getPixelOrigin();\n      }\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function (map) {\n      this._clearLayer();\n      map._removeZoomLimit(this);\n      this._container = null;\n    },\n    getImageUrl: function (pixelBounds, zoom) {\n      var obj = {};\n      obj[this.options.extent.width] = this._map.getSize().x;\n      obj[this.options.extent.height] = this._map.getSize().y;\n      obj[this.options.extent.bottom] = this._TCRSToPCRS(pixelBounds.max, zoom).y;\n      obj[this.options.extent.left] = this._TCRSToPCRS(pixelBounds.min, zoom).x;\n      obj[this.options.extent.top] = this._TCRSToPCRS(pixelBounds.min, zoom).y;\n      obj[this.options.extent.right] = this._TCRSToPCRS(pixelBounds.max, zoom).x;\n      // hidden and other variables that may be associated\n      for (var v in this.options.extent) {\n        if (\n          ['width', 'height', 'left', 'right', 'top', 'bottom'].indexOf(v) < 0\n        ) {\n          obj[v] = this.options.extent[v];\n        }\n      }\n      return L.Util.template(this._template.template, obj);\n    },\n    _TCRSToPCRS: function (coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    },\n    _setUpExtentTemplateVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // extent with member properties as follows:\n      // {width: 'widthvarname',\n      //  height: 'heightvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'}\n\n      var extentVarNames = { extent: {} },\n        inputs = template.values;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          extentVarNames.extent.width = name;\n        } else if (type === 'height') {\n          extentVarNames.extent.height = name;\n        } else if (\n          type === 'location' &&\n          (units === 'pcrs' || units === 'gcrs')\n        ) {\n          //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n          switch (axis) {\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  extentVarNames.extent.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  extentVarNames.extent.right = name;\n                }\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  extentVarNames.extent.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  extentVarNames.extent.bottom = name;\n                }\n              }\n              break;\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          extentVarNames.extent[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          extentVarNames.extent[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      return extentVarNames;\n    }\n  });\n  var templatedImageLayer = function (template, options) {\n    return new TemplatedImageLayer(template, options);\n  };\n\n  var ImageLayer = L.ImageOverlay.extend({\n    initialize: function (url, location, size, angle, container, options) {\n      // (String, Point, Point, Number, Element, Object)\n      this._container = container;\n      this._url = url;\n      // instead of calculating where the image goes, put it at 0,0\n      //this._location = L.point(location);\n      // the location for WMS requests will be the upper left hand\n      // corner of the map.  When the map is initialized, that is 0,0,\n      // but as the user pans, of course the\n      this._location = location;\n      this._size = L.point(size);\n      this._angle = angle;\n\n      L.setOptions(this, options);\n    },\n    getEvents: function () {\n      var events = {\n        viewreset: this._reset\n      };\n\n      if (this._zoomAnimated && this._step <= 1) {\n        events.zoomanim = this._animateZoom;\n      }\n\n      return events;\n    },\n    onAdd: function () {\n      this.on({\n        load: this._onImageLoad\n      });\n\n      if (!this._image) {\n        this._initImage();\n      }\n\n      if (this.options.interactive) {\n        L.DomUtil.addClass(this._image, 'leaflet-interactive');\n        this.addInteractiveTarget(this._image);\n      }\n\n      this._container.appendChild(this._image);\n      this._reset();\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._image);\n      if (this.options.interactive) {\n        this.removeInteractiveTarget(this._image);\n      }\n    },\n    _onImageLoad: function () {\n      if (!this._image) {\n        return;\n      }\n      this._image.loaded = +new Date();\n      this._updateOpacity();\n    },\n    _animateZoom: function (e) {\n      var scale = this._map.getZoomScale(e.zoom),\n        translate = this._map\n          .getPixelOrigin()\n          .add(this._location)\n          .multiplyBy(scale)\n          .subtract(this._map._getNewPixelOrigin(e.center, e.zoom))\n          .round();\n\n      if (L.Browser.any3d) {\n        L.DomUtil.setTransform(this._image, translate, scale);\n      } else {\n        L.DomUtil.setPosition(this._image, translate);\n      }\n    },\n    _reset: function (e) {\n      var image = this._image,\n        location = this._location,\n        size = this._size;\n      // TBD use the angle to establish the image rotation in CSS\n\n      if (\n        e &&\n        this._step > 1 &&\n        (this._overlayToRemove === undefined ||\n          this._url === this._overlayToRemove)\n      ) {\n        return;\n      }\n      L.DomUtil.setPosition(image, location);\n\n      image.style.width = size.x + 'px';\n      image.style.height = size.y + 'px';\n    },\n    _updateOpacity: function () {\n      if (!this._map) {\n        return;\n      }\n\n      //L.DomUtil.setOpacity(this._image, this.options.opacity);\n\n      var now = +new Date(),\n        nextFrame = false;\n\n      var image = this._image;\n\n      var fade = Math.min(1, (now - image.loaded) / 200);\n\n      L.DomUtil.setOpacity(image, fade);\n      if (fade < 1) {\n        nextFrame = true;\n      }\n      if (nextFrame) {\n        L.Util.cancelAnimFrame(this._fadeFrame);\n        this._fadeFrame = L.Util.requestAnimFrame(this._updateOpacity, this);\n      }\n      L.DomUtil.addClass(image, 'leaflet-image-loaded');\n    }\n  });\n  var imageLayer = function (\n    url,\n    location,\n    size,\n    angle,\n    container,\n    options\n  ) {\n    return new ImageLayer(url, location, size, angle, container, options);\n  };\n\n  /* global M */\n\n  var MapMLLayer = L.Layer.extend({\n    // zIndex has to be set, for the case where the layer is added to the\n    // map before the layercontrol is used to control it (where autoZindex is used)\n    // e.g. in the raw MapML-Leaflet-Client index.html page.\n    options: {\n      maxNext: 10,\n      zIndex: 0,\n      maxZoom: 25,\n      opacity: '1.0'\n    },\n    // initialize is executed before the layer is added to a map\n    initialize: function (href, layerEl, mapml, options) {\n      // in the custom element, the attribute is actually 'src'\n      // the _href version is the URL received from layer-@src\n      if (href) {\n        this._href = href;\n      }\n      let local;\n      this._layerEl = layerEl;\n      local = layerEl.querySelector('map-feature,map-tile,map-extent')\n        ? true\n        : false;\n      this._content = local ? layerEl : mapml;\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      this.changeOpacity(this.options.opacity);\n      L.DomUtil.addClass(this._container, 'mapml-layer');\n      this._imageContainer = L.DomUtil.create(\n        'div',\n        'leaflet-layer',\n        this._container\n      );\n      L.DomUtil.addClass(this._imageContainer, 'mapml-image-container');\n\n      // this layer 'owns' a mapmlTileLayer, which is a subclass of L.GridLayer\n      // it 'passes' what tiles to load via the content of this._mapmlTileContainer\n      this._mapmlTileContainer = L.DomUtil.create(\n        'div',\n        'mapml-tile-container',\n        this._container\n      );\n      // hit the service to determine what its extent might be\n      // OR use the extent of the content provided\n\n      this._initialize(local ? layerEl : mapml);\n\n      // a default extent can't be correctly set without the map to provide\n      // its bounds , projection, zoom range etc, so if that stuff's not\n      // established by metadata in the content, we should use map properties\n      // to set the extent, but the map won't be available until the <layer>\n      // element is attached to the <map> element, wait for that to happen.\n      this.on('attached', this._validateExtent, this);\n      // weirdness.  options is actually undefined here, despite the hardcoded\n      // options above. If you use this.options, you see the options defined\n      // above.  Not going to change this, but failing to understand ATM.\n      // may revisit some time.\n      this.validProjection = true;\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    getHref: function () {\n      return this._href ?? '';\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    // remove all the extents before removing the layer from the map\n    _removeExtents: function (map) {\n      if (this._properties._mapExtents) {\n        for (let i = 0; i < this._properties._mapExtents.length; i++) {\n          if (this._properties._mapExtents[i].templatedLayer) {\n            map.removeLayer(this._properties._mapExtents[i].templatedLayer);\n          }\n        }\n      }\n      if (this._properties._queries) {\n        delete this._properties._queries;\n      }\n    },\n    _changeOpacity: function (e) {\n      if (e && e.target && e.target.value >= 0 && e.target.value <= 1.0) {\n        this.changeOpacity(e.target.value);\n      }\n    },\n    changeOpacity: function (opacity) {\n      this._container.style.opacity = opacity;\n      this._layerEl._opacity = opacity;\n      if (this.opacityEl) this.opacityEl.value = opacity;\n    },\n    _changeExtentOpacity: function (e) {\n      if (e && e.target && e.target.value >= 0 && e.target.value <= 1.0) {\n        this.templatedLayer.changeOpacity(e.target.value);\n        this._templateVars.opacity = e.target.value;\n      }\n    },\n    _changeExtent: function (e, extentEl) {\n      if (e.target.checked) {\n        extentEl.checked = true;\n        if (this._layerEl.checked) {\n          extentEl.templatedLayer = M.templatedLayer(extentEl._templateVars, {\n            pane: this._container,\n            opacity: extentEl._templateVars.opacity,\n            _leafletLayer: this,\n            crs: extentEl.crs,\n            extentZIndex: extentEl.extentZIndex,\n            extentEl: extentEl._DOMnode || extentEl\n          }).addTo(this._map);\n          extentEl.templatedLayer.setZIndex();\n          this._setLayerElExtent();\n        }\n      } else {\n        L.DomEvent.stopPropagation(e);\n        extentEl.checked = false;\n        if (this._layerEl.checked) this._map.removeLayer(extentEl.templatedLayer);\n        this._setLayerElExtent();\n      }\n    },\n    titleIsReadOnly() {\n      return !!this._titleIsReadOnly;\n    },\n    setName(newName) {\n      // a layer's accessible name is set by the <map-title>, if present\n      // if it's not available the <layer- label=\"accessible-name\"> attribute\n      // can be used\n      if (!this.titleIsReadOnly()) {\n        this._title = newName;\n        this._mapmlLayerItem.querySelector('.mapml-layer-item-name').innerHTML =\n          newName;\n      }\n    },\n    getName() {\n      return this._title;\n    },\n\n    onAdd: function (map) {\n      if (this._properties && !this._validProjection(map)) {\n        this.validProjection = false;\n        return;\n      }\n      this._map = map;\n      if (this._mapmlvectors) map.addLayer(this._mapmlvectors);\n\n      if (!this._imageLayer) {\n        this._imageLayer = L.layerGroup();\n      }\n      map.addLayer(this._imageLayer);\n      // the layer._imageContainer property contains an element in which\n      // content will be maintained\n\n      //only add the layer if there are tiles to be rendered\n      if (this._staticTileLayer) {\n        map.addLayer(this._staticTileLayer);\n      }\n\n      const createAndAdd = createAndAddTemplatedLayers.bind(this);\n      // if the extent has been initialized and received, update the map,\n      if (\n        this._properties &&\n        this._properties._mapExtents &&\n        this._properties._mapExtents[0]._templateVars\n      ) {\n        createAndAdd();\n      }\n      this._setLayerElExtent();\n\n      this.setZIndex(this.options.zIndex);\n      this.getPane().appendChild(this._container);\n      setTimeout(() => {\n        map.fire('checkdisabled');\n      }, 0);\n      map.on('popupopen', this._attachSkipButtons, this);\n\n      function createAndAddTemplatedLayers() {\n        if (this._properties && this._properties._mapExtents) {\n          for (let i = 0; i < this._properties._mapExtents.length; i++) {\n            if (\n              this._properties._mapExtents[i]._templateVars &&\n              this._properties._mapExtents[i].checked\n            ) {\n              if (!this._properties._mapExtents[i].extentZIndex)\n                this._properties._mapExtents[i].extentZIndex = i;\n              this._templatedLayer = M.templatedLayer(\n                this._properties._mapExtents[i]._templateVars,\n                {\n                  pane: this._container,\n                  opacity: this._properties._mapExtents[i]._templateVars.opacity,\n                  _leafletLayer: this,\n                  crs: this._properties.crs,\n                  extentZIndex: this._properties._mapExtents[i].extentZIndex,\n                  // when a <map-extent> migrates from a remote mapml file and attaches to the shadow of <layer- >\n                  // this._properties._mapExtents[i] refers to the <map-extent> in remote mapml\n                  extentEl:\n                    this._properties._mapExtents[i]._DOMnode ||\n                    this._properties._mapExtents[i]\n                }\n              ).addTo(map);\n              this._properties._mapExtents[i].templatedLayer =\n                this._templatedLayer;\n              if (this._templatedLayer._queries) {\n                if (!this._properties._queries) this._properties._queries = [];\n                this._properties._queries = this._properties._queries.concat(\n                  this._templatedLayer._queries\n                );\n              }\n            }\n            if (this._properties._mapExtents[i].hasAttribute('opacity')) {\n              let opacity =\n                this._properties._mapExtents[i].getAttribute('opacity');\n              this._properties._mapExtents[i].templatedLayer.changeOpacity(\n                opacity\n              );\n            }\n          }\n        }\n      }\n    },\n\n    _validProjection: function (map) {\n      let noLayer = false;\n      if (this._properties && this._properties._mapExtents) {\n        for (let i = 0; i < this._properties._mapExtents.length; i++) {\n          if (this._properties._mapExtents[i]._templateVars) {\n            for (let template of this._properties._mapExtents[i]._templateVars)\n              if (\n                !template.projectionMatch &&\n                template.projection !== map.options.projection\n              ) {\n                noLayer = true; // if there's a single template where projections don't match, set noLayer to true\n                break;\n              }\n          }\n        }\n      }\n      return !(noLayer || this.getProjection() !== map.options.projection);\n    },\n\n    //sets the <layer-> elements .bounds property\n    _setLayerElExtent: function () {\n      let bounds,\n        zoomMax,\n        zoomMin,\n        maxNativeZoom,\n        minNativeZoom,\n        zoomBounds = {\n          minZoom: 0,\n          maxZoom: 0,\n          maxNativeZoom: 0,\n          minNativeZoom: 0\n        };\n      let layerTypes = [\n        '_staticTileLayer',\n        '_imageLayer',\n        '_mapmlvectors',\n        '_templatedLayer'\n      ];\n      layerTypes.forEach((type) => {\n        if (this[type]) {\n          if (type === '_templatedLayer') {\n            for (let i = 0; i < this._properties._mapExtents.length; i++) {\n              for (\n                let j = 0;\n                j < this._properties._mapExtents[i]._templateVars.length;\n                j++\n              ) {\n                let inputData = M._extractInputBounds(\n                  this._properties._mapExtents[i]._templateVars[j]\n                );\n                this._properties._mapExtents[i]._templateVars[\n                  j\n                ].tempExtentBounds = inputData.bounds;\n                this._properties._mapExtents[i]._templateVars[\n                  j\n                ].extentZoomBounds = inputData.zoomBounds;\n              }\n            }\n            for (let i = 0; i < this._properties._mapExtents.length; i++) {\n              if (this._properties._mapExtents[i].checked) {\n                for (\n                  let j = 0;\n                  j < this._properties._mapExtents[i]._templateVars.length;\n                  j++\n                ) {\n                  if (!bounds) {\n                    bounds =\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .tempExtentBounds;\n                    zoomMax =\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.maxZoom;\n                    zoomMin =\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.minZoom;\n                    maxNativeZoom =\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.maxNativeZoom;\n                    minNativeZoom =\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.minNativeZoom;\n                  } else {\n                    bounds.extend(\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .tempExtentBounds.min\n                    );\n                    bounds.extend(\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .tempExtentBounds.max\n                    );\n                    zoomMax = Math.max(\n                      zoomMax,\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.maxZoom\n                    );\n                    zoomMin = Math.min(\n                      zoomMin,\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.minZoom\n                    );\n                    maxNativeZoom = Math.max(\n                      maxNativeZoom,\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.maxNativeZoom\n                    );\n                    minNativeZoom = Math.min(\n                      minNativeZoom,\n                      this._properties._mapExtents[i]._templateVars[j]\n                        .extentZoomBounds.minNativeZoom\n                    );\n                  }\n                }\n              }\n            }\n            zoomBounds.minZoom = zoomMin;\n            zoomBounds.maxZoom = zoomMax;\n            zoomBounds.minNativeZoom = minNativeZoom;\n            zoomBounds.maxNativeZoom = maxNativeZoom;\n            this._properties.zoomBounds = zoomBounds;\n            this._properties.layerBounds = bounds;\n            // assign each template the layer and zoom bounds\n            for (let i = 0; i < this._properties._mapExtents.length; i++) {\n              this._properties._mapExtents[i].templatedLayer.layerBounds = bounds;\n              this._properties._mapExtents[i].templatedLayer.zoomBounds =\n                zoomBounds;\n            }\n          } else if (type === '_staticTileLayer') {\n            if (this[type].layerBounds) {\n              if (!bounds) {\n                bounds = this[type].layerBounds;\n                zoomBounds = this[type].zoomBounds;\n              } else {\n                bounds.extend(this[type].layerBounds.min);\n                bounds.extend(this[type].layerBounds.max);\n              }\n            }\n          } else if (type === '_imageLayer') {\n            if (this[type].layerBounds) {\n              if (!bounds) {\n                bounds = this[type].layerBounds;\n                zoomBounds = this[type].zoomBounds;\n              } else {\n                bounds.extend(this[type].layerBounds.min);\n                bounds.extend(this[type].layerBounds.max);\n              }\n            }\n          } else if (\n            // only process extent if mapmlvectors is not empty\n            type === '_mapmlvectors' &&\n            Object.keys(this[type]._layers).length !== 0\n          ) {\n            if (this[type].layerBounds) {\n              if (!bounds) {\n                bounds = this[type].layerBounds;\n                zoomBounds = this[type].zoomBounds;\n              } else {\n                bounds.extend(this[type].layerBounds.min);\n                bounds.extend(this[type].layerBounds.max);\n              }\n            }\n          }\n        }\n      });\n      if (bounds) {\n        //assigns the formatted extent object to .extent and spreads the zoom ranges to .extent also\n        this._layerEl.extent = Object.assign(\n          M._convertAndFormatPCRS(\n            bounds,\n            this._properties.crs,\n            this._properties.projection\n          ),\n          { zoom: zoomBounds }\n        );\n      }\n    },\n\n    addTo: function (map) {\n      map.addLayer(this);\n      return this;\n    },\n    getEvents: function () {\n      return { zoomanim: this._onZoomAnim };\n    },\n    redraw: function () {\n      // for now, only redraw templated layers.\n      if (this._properties._mapExtents) {\n        for (let i = 0; i < this._properties._mapExtents.length; i++) {\n          if (this._properties._mapExtents[i].templatedLayer) {\n            this._properties._mapExtents[i].templatedLayer.redraw();\n          }\n        }\n      }\n    },\n    _onZoomAnim: function (e) {\n      // this callback will be invoked AFTER <layer- > has been removed\n      // but due to the characteristic of JavaScript, the context (this pointer) can still be used\n      // the easiest way to solve this:\n      if (!this._map) {\n        return;\n      }\n      // get the min and max zooms from all extents\n      var toZoom = e.zoom,\n        zoom =\n          this._properties && this._properties._mapExtents\n            ? this._properties._mapExtents[0].querySelector(\n                'map-input[type=zoom]'\n              )\n            : null,\n        min =\n          zoom && zoom.hasAttribute('min')\n            ? parseInt(zoom.getAttribute('min'))\n            : this._map.getMinZoom(),\n        max =\n          zoom && zoom.hasAttribute('max')\n            ? parseInt(zoom.getAttribute('max'))\n            : this._map.getMaxZoom();\n      if (zoom) {\n        for (let i = 1; i < this._properties._mapExtents.length; i++) {\n          zoom = this._properties._mapExtents[i].querySelector(\n            'map-input[type=zoom]'\n          );\n          if (zoom && zoom.hasAttribute('min')) {\n            min = Math.min(parseInt(zoom.getAttribute('min')), min);\n          }\n          if (zoom && zoom.hasAttribute('max')) {\n            max = Math.max(parseInt(zoom.getAttribute('max')), max);\n          }\n        }\n      }\n      var canZoom =\n        (toZoom < min && this._properties.zoomout) ||\n        (toZoom > max && this._properties.zoomin);\n      if (!(min <= toZoom && toZoom <= max)) {\n        if (this._properties.zoomin && toZoom > max) {\n          // this._href is the 'original' url from which this layer came\n          // since we are following a zoom link we will be getting a new\n          // layer almost, resetting child content as appropriate\n          this._href = this._properties.zoomin;\n          this._layerEl.src = this._properties.zoomin;\n          // this.href is the \"public\" property. When a dynamic layer is\n          // accessed, this value changes with every new extent received\n          this.href = this._properties.zoomin;\n          this._layerEl.src = this._properties.zoomin;\n        } else if (this._properties.zoomout && toZoom < min) {\n          this._href = this._properties.zoomout;\n          this.href = this._properties.zoomout;\n          this._layerEl.src = this._properties.zoomout;\n        }\n      }\n      if (this._templatedLayer && canZoom) ;\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      if (this._staticTileLayer) map.removeLayer(this._staticTileLayer);\n      if (this._mapmlvectors) map.removeLayer(this._mapmlvectors);\n      if (this._imageLayer) map.removeLayer(this._imageLayer);\n      if (this._properties && this._properties._mapExtents)\n        this._removeExtents(map);\n\n      map.fire('checkdisabled');\n      map.off('popupopen', this._attachSkipButtons);\n    },\n    getAttribution: function () {\n      return this.options.attribution;\n    },\n    getLayerUserControlsHTML: function () {\n      return this._mapmlLayerItem\n        ? this._mapmlLayerItem\n        : this._createLayerControlHTML();\n    },\n    _createLayerControlHTML: function () {\n      if (!this._mapmlLayerItem) {\n        var fieldset = L.DomUtil.create('fieldset', 'mapml-layer-item'),\n          input = L.DomUtil.create('input'),\n          layerItemName = L.DomUtil.create('span', 'mapml-layer-item-name'),\n          settingsButtonNameIcon = L.DomUtil.create('span'),\n          layerItemProperty = L.DomUtil.create(\n            'div',\n            'mapml-layer-item-properties',\n            fieldset\n          ),\n          layerItemSettings = L.DomUtil.create(\n            'div',\n            'mapml-layer-item-settings',\n            fieldset\n          ),\n          itemToggleLabel = L.DomUtil.create(\n            'label',\n            'mapml-layer-item-toggle',\n            layerItemProperty\n          ),\n          layerItemControls = L.DomUtil.create(\n            'div',\n            'mapml-layer-item-controls',\n            layerItemProperty\n          ),\n          opacityControl = L.DomUtil.create(\n            'details',\n            'mapml-layer-item-opacity mapml-control-layers',\n            layerItemSettings\n          ),\n          opacity = L.DomUtil.create('input'),\n          opacityControlSummary = L.DomUtil.create('summary'),\n          svgSettingsControlIcon = L.SVG.create('svg'),\n          settingsControlPath1 = L.SVG.create('path'),\n          settingsControlPath2 = L.SVG.create('path'),\n          extentsFieldset = L.DomUtil.create(\n            'fieldset',\n            'mapml-layer-grouped-extents'\n          ),\n          mapEl = this._layerEl.parentNode;\n        this.opacityEl = opacity;\n        this._mapmlLayerItem = fieldset;\n\n        // append the paths in svg for the remove layer and toggle icons\n        svgSettingsControlIcon.setAttribute('viewBox', '0 0 24 24');\n        svgSettingsControlIcon.setAttribute('height', '22');\n        svgSettingsControlIcon.setAttribute('width', '22');\n        svgSettingsControlIcon.setAttribute('fill', 'currentColor');\n        settingsControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n        settingsControlPath1.setAttribute('fill', 'none');\n        settingsControlPath2.setAttribute(\n          'd',\n          'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z'\n        );\n        svgSettingsControlIcon.appendChild(settingsControlPath1);\n        svgSettingsControlIcon.appendChild(settingsControlPath2);\n\n        layerItemSettings.hidden = true;\n        settingsButtonNameIcon.setAttribute('aria-hidden', true);\n\n        let removeControlButton = L.DomUtil.create(\n          'button',\n          'mapml-layer-item-remove-control',\n          layerItemControls\n        );\n        removeControlButton.type = 'button';\n        removeControlButton.title = 'Remove Layer';\n        removeControlButton.innerHTML =\n          \"<span aria-hidden='true'>&#10005;</span>\";\n        removeControlButton.classList.add('mapml-button');\n        //L.DomEvent.disableClickPropagation(removeControlButton);\n        L.DomEvent.on(removeControlButton, 'click', L.DomEvent.stop);\n        L.DomEvent.on(\n          removeControlButton,\n          'click',\n          (e) => {\n            let fieldset = 0,\n              elem,\n              root;\n            root =\n              mapEl.tagName === 'MAPML-VIEWER'\n                ? mapEl.shadowRoot\n                : mapEl.querySelector('.mapml-web-map').shadowRoot;\n            if (\n              e.target.closest('fieldset').nextElementSibling &&\n              !e.target.closest('fieldset').nextElementSibling.disbaled\n            ) {\n              elem = e.target.closest('fieldset').previousElementSibling;\n              while (elem) {\n                fieldset += 2; // find the next layer menu item\n                elem = elem.previousElementSibling;\n              }\n            } else {\n              // focus on the link\n              elem = 'link';\n            }\n            mapEl.removeChild(\n              e.target.closest('fieldset').querySelector('span').layer._layerEl\n            );\n            elem = elem\n              ? root.querySelector('.leaflet-control-attribution')\n                  .firstElementChild\n              : (elem = root.querySelectorAll('input')[fieldset]);\n            elem.focus();\n          },\n          this\n        );\n\n        let itemSettingControlButton = L.DomUtil.create(\n          'button',\n          'mapml-layer-item-settings-control',\n          layerItemControls\n        );\n        itemSettingControlButton.type = 'button';\n        itemSettingControlButton.title = 'Layer Settings';\n        itemSettingControlButton.setAttribute('aria-expanded', false);\n        itemSettingControlButton.classList.add('mapml-button');\n        L.DomEvent.on(\n          itemSettingControlButton,\n          'click',\n          (e) => {\n            let layerControl = this._layerEl._layerControl._container;\n            if (!layerControl._isExpanded && e.pointerType === 'touch') {\n              layerControl._isExpanded = true;\n              return;\n            }\n            if (layerItemSettings.hidden === true) {\n              itemSettingControlButton.setAttribute('aria-expanded', true);\n              layerItemSettings.hidden = false;\n            } else {\n              itemSettingControlButton.setAttribute('aria-expanded', false);\n              layerItemSettings.hidden = true;\n            }\n          },\n          this\n        );\n\n        input.defaultChecked = this._map ? true : false;\n        input.type = 'checkbox';\n        input.setAttribute('class', 'leaflet-control-layers-selector');\n        layerItemName.layer = this;\n\n        if (this._legendUrl) {\n          var legendLink = document.createElement('a');\n          legendLink.text = ' ' + this._title;\n          legendLink.href = this._legendUrl;\n          legendLink.target = '_blank';\n          legendLink.draggable = false;\n          layerItemName.appendChild(legendLink);\n        } else {\n          layerItemName.innerHTML = this._title;\n        }\n        layerItemName.id =\n          'mapml-layer-item-name-{' + L.stamp(layerItemName) + '}';\n        opacityControlSummary.innerText = 'Opacity';\n        opacityControlSummary.id =\n          'mapml-layer-item-opacity-' + L.stamp(opacityControlSummary);\n        opacityControl.appendChild(opacityControlSummary);\n        opacityControl.appendChild(opacity);\n        opacity.setAttribute('type', 'range');\n        opacity.setAttribute('min', '0');\n        opacity.setAttribute('max', '1.0');\n        opacity.setAttribute('value', this._container.style.opacity || '1.0');\n        opacity.setAttribute('step', '0.1');\n        opacity.setAttribute('aria-labelledby', opacityControlSummary.id);\n        opacity.value = this._container.style.opacity || '1.0';\n\n        fieldset.setAttribute('aria-grabbed', 'false');\n        fieldset.setAttribute('aria-labelledby', layerItemName.id);\n\n        fieldset.ontouchstart = fieldset.onmousedown = (downEvent) => {\n          if (\n            (downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n              downEvent.target.tagName.toLowerCase() !== 'input') ||\n            downEvent.target.tagName.toLowerCase() === 'label'\n          ) {\n            downEvent =\n              downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n            let control = fieldset,\n              controls = fieldset.parentNode,\n              moving = false,\n              yPos = downEvent.clientY;\n\n            document.body.ontouchmove = document.body.onmousemove = (\n              moveEvent\n            ) => {\n              moveEvent.preventDefault();\n              moveEvent =\n                moveEvent instanceof TouchEvent\n                  ? moveEvent.touches[0]\n                  : moveEvent;\n\n              // Fixes flickering by only moving element when there is enough space\n              let offset = moveEvent.clientY - yPos;\n              moving = Math.abs(offset) > 5 || moving;\n              if (\n                (controls && !moving) ||\n                (controls && controls.childElementCount <= 1) ||\n                controls.getBoundingClientRect().top >\n                  control.getBoundingClientRect().bottom ||\n                controls.getBoundingClientRect().bottom <\n                  control.getBoundingClientRect().top\n              ) {\n                return;\n              }\n\n              controls.classList.add('mapml-draggable');\n              control.style.transform = 'translateY(' + offset + 'px)';\n              control.style.pointerEvents = 'none';\n\n              let x = moveEvent.clientX,\n                y = moveEvent.clientY,\n                root =\n                  mapEl.tagName === 'MAPML-VIEWER'\n                    ? mapEl.shadowRoot\n                    : mapEl.querySelector('.mapml-web-map').shadowRoot,\n                elementAt = root.elementFromPoint(x, y),\n                swapControl =\n                  !elementAt || !elementAt.closest('fieldset')\n                    ? control\n                    : elementAt.closest('fieldset');\n\n              swapControl =\n                Math.abs(offset) <= swapControl.offsetHeight\n                  ? control\n                  : swapControl;\n\n              control.setAttribute('aria-grabbed', 'true');\n              control.setAttribute('aria-dropeffect', 'move');\n              if (swapControl && controls === swapControl.parentNode) {\n                swapControl =\n                  swapControl !== control.nextSibling\n                    ? swapControl\n                    : swapControl.nextSibling;\n                if (control !== swapControl) {\n                  yPos = moveEvent.clientY;\n                  control.style.transform = null;\n                }\n                controls.insertBefore(control, swapControl);\n              }\n            };\n\n            document.body.ontouchend = document.body.onmouseup = () => {\n              control.setAttribute('aria-grabbed', 'false');\n              control.removeAttribute('aria-dropeffect');\n              control.style.pointerEvents = null;\n              control.style.transform = null;\n              let controlsElems = controls.children,\n                zIndex = 1;\n              // re-order layer elements DOM order\n              for (let c of controlsElems) {\n                let layerEl = c.querySelector('span').layer._layerEl;\n                layerEl.setAttribute('data-moving', '');\n                mapEl.insertAdjacentElement('beforeend', layerEl);\n                layerEl.removeAttribute('data-moving');\n              }\n              // update zIndex of all layer- elements\n              let layers = mapEl.querySelectorAll('layer-');\n              for (let i = 0; i < layers.length; i++) {\n                let layer = layers[i]._layer;\n                if (layer.options.zIndex !== zIndex) {\n                  layer.setZIndex(zIndex);\n                }\n                zIndex++;\n              }\n              controls.classList.remove('mapml-draggable');\n              document.body.ontouchmove =\n                document.body.onmousemove =\n                document.body.onmouseup =\n                  null;\n            };\n          }\n        };\n\n        L.DomEvent.on(opacity, 'change', this._changeOpacity, this);\n\n        itemToggleLabel.appendChild(input);\n        itemToggleLabel.appendChild(layerItemName);\n        itemSettingControlButton.appendChild(settingsButtonNameIcon);\n        settingsButtonNameIcon.appendChild(svgSettingsControlIcon);\n\n        if (this._styles) {\n          layerItemSettings.appendChild(this._styles);\n        }\n\n        if (this._userInputs) {\n          var frag = document.createDocumentFragment();\n          var templates = this._properties._templateVars;\n          if (templates) {\n            for (var i = 0; i < templates.length; i++) {\n              var template = templates[i];\n              for (var j = 0; j < template.values.length; j++) {\n                var mapmlInput = template.values[j],\n                  id = '#' + mapmlInput.getAttribute('id');\n                // don't add it again if it is referenced > once\n                if (\n                  mapmlInput.tagName.toLowerCase() === 'map-select' &&\n                  !frag.querySelector(id)\n                ) {\n                  // generate a <details><summary></summary><select...></details>\n                  var selectdetails = L.DomUtil.create(\n                      'details',\n                      'mapml-layer-item-time mapml-control-layers',\n                      frag\n                    ),\n                    selectsummary = L.DomUtil.create('summary'),\n                    selectSummaryLabel = L.DomUtil.create('label');\n                  selectSummaryLabel.innerText = mapmlInput.getAttribute('name');\n                  selectSummaryLabel.setAttribute(\n                    'for',\n                    mapmlInput.getAttribute('id')\n                  );\n                  selectsummary.appendChild(selectSummaryLabel);\n                  selectdetails.appendChild(selectsummary);\n                  selectdetails.appendChild(mapmlInput.htmlselect);\n                }\n              }\n            }\n          }\n          layerItemSettings.appendChild(frag);\n        }\n\n        // if there are extents, add them to the layer control\n        if (this._properties && this._properties._mapExtents) {\n          var allHidden = true;\n          this._layerItemSettingsHTML = layerItemSettings;\n          this._propertiesGroupAnatomy = extentsFieldset;\n          extentsFieldset.setAttribute('aria-label', 'Sublayers');\n          for (let j = 0; j < this._properties._mapExtents.length; j++) {\n            extentsFieldset.appendChild(\n              this._properties._mapExtents[j].extentAnatomy\n            );\n            if (!this._properties._mapExtents[j].hidden) allHidden = false;\n          }\n          if (!allHidden) layerItemSettings.appendChild(extentsFieldset);\n        }\n      }\n      return this._mapmlLayerItem;\n    },\n    _initialize: function (content) {\n      if (!this._href && !content) {\n        return;\n      }\n      var layer = this;\n      // the this._href (comes from layer@src) should take precedence over\n      // content of the <layer> element, but if no this._href / src is provided\n      // but there *is* child content of the <layer> element (which is copied/\n      // referred to by this._content), we should use that content.\n      _processContent.call(this, content, this._href ? false : true);\n      function _processContent(mapml, local) {\n        var base = new URL(\n          mapml.querySelector('map-base')\n            ? mapml.querySelector('map-base').getAttribute('href')\n            : local\n            ? mapml.baseURI\n            : layer._href,\n          layer._href\n        ).href;\n        layer._properties = {};\n        // sets layer._properties.projection\n        determineLayerProjection();\n        // requires that layer._properties.projection be set\n        if (selectMatchingAlternateProjection()) return;\n        // set layer._properties._mapExtents and layer._properties._templateVars\n        if (layer._properties.crs) processExtents();\n        layer._styles = getAlternateStyles();\n        parseLicenseAndLegend();\n        setLayerTitle();\n        setZoomInOrOutLinks();\n        // crs is only set if the layer has the same projection as the map\n        if (layer._properties.crs) processTiles();\n        processFeatures();\n        M._parseStylesheetAsHTML(mapml, base, layer._container);\n        layer._validateExtent();\n        copyRemoteContentToShadowRoot();\n        // update controls if needed based on mapml-viewer controls/controlslist attribute\n        if (layer._layerEl.parentElement) {\n          // if layer does not have a parent Element, do not need to set Controls\n          layer._layerEl.parentElement._toggleControls();\n        }\n        // local functions\n        // sets layer._properties.projection.  Supposed to replace / simplify\n        // the dependencies on convoluted getProjection() interface, but doesn't quite\n        // succeed, yet.\n        function determineLayerProjection() {\n          let projection = layer.options.mapprojection;\n          if (mapml.querySelector('map-meta[name=projection][content]')) {\n            projection =\n              M._metaContentToObject(\n                mapml\n                  .querySelector('map-meta[name=projection]')\n                  .getAttribute('content')\n              ).content || projection;\n          } else if (mapml.querySelector('map-extent[units]')) {\n            const getProjectionFrom = (extents) => {\n              let extentProj = extents[0].attributes.units.value;\n              let isMatch = true;\n              for (let i = 0; i < extents.length; i++) {\n                if (extentProj !== extents[i].attributes.units.value) {\n                  isMatch = false;\n                }\n              }\n              return isMatch ? extentProj : null;\n            };\n            projection =\n              getProjectionFrom(\n                Array.from(mapml.querySelectorAll('map-extent[units]'))\n              ) || projection;\n          } else {\n            console.log(\n              `A projection was not assigned to the '${layer._layerEl.label}' Layer. Please specify a projection for that layer using a map-meta element. See more here - https://maps4html.org/web-map-doc/docs/elements/meta/`\n            );\n          }\n          layer._properties.projection = projection;\n          if (layer._properties.projection === layer.options.mapprojection) {\n            layer._properties.crs = M[layer._properties.projection];\n          }\n        }\n        // determine if, where there's no match of the current layer's projection\n        // and that of the map, if there is a linked alternate text/mapml\n        // resource that matches the map's projection\n        function selectMatchingAlternateProjection() {\n          let selectedAlternate =\n            layer._properties.projection !== layer.options.mapprojection &&\n            mapml.querySelector(\n              'map-head map-link[rel=alternate][projection=' +\n                layer.options.mapprojection +\n                '][href]'\n            );\n          try {\n            if (selectedAlternate) {\n              let url = new URL(selectedAlternate.getAttribute('href'), base)\n                .href;\n              layer._layerEl.dispatchEvent(\n                new CustomEvent('changeprojection', {\n                  detail: {\n                    href: url\n                  }\n                })\n              );\n              return true;\n              //if this is the only layer, but the projection doesn't match,\n              // set the map's projection to that of the layer\n            } else if (\n              layer._properties.projection !== layer.options.mapprojection &&\n              layer._layerEl.parentElement.layers.length === 1\n            ) {\n              layer._layerEl.parentElement.projection =\n                layer._properties.projection;\n              return true;\n            }\n          } catch (error) {}\n          return false;\n        }\n        // initialize layer._properties._mapExtents (and associated/derived/convenience property _templateVars\n        function processExtents() {\n          let projectionMatch =\n            layer._properties.projection === layer.options.mapprojection;\n          let extents = mapml.querySelectorAll('map-extent[units]');\n          if (extents.length === 0) {\n            return;\n          }\n          layer._properties._mapExtents = []; // stores all the map-extent elements in the layer\n          layer._properties._templateVars = []; // stores all template variables coming from all extents\n          for (let j = 0; j < extents.length; j++) {\n            if (\n              extents[j].querySelector(\n                'map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]'\n              )\n            ) {\n              extents[j]._templateVars = _initTemplateVars.call(\n                layer,\n                extents[j],\n                mapml.querySelector('map-meta[name=extent]'),\n                layer._properties.projection,\n                mapml,\n                base,\n                projectionMatch\n              );\n              extents[j].extentAnatomy = createLayerControlExtentHTML.call(\n                layer,\n                extents[j]\n              );\n              layer._properties._mapExtents.push(extents[j]);\n              // get rid of layer._properties._templateVars, TBD.\n              layer._properties._templateVars =\n                layer._properties._templateVars.concat(extents[j]._templateVars);\n            }\n          }\n        }\n        function createLayerControlExtentHTML(mapExtent) {\n          var extent = L.DomUtil.create('fieldset', 'mapml-layer-extent'),\n            extentProperties = L.DomUtil.create(\n              'div',\n              'mapml-layer-item-properties',\n              extent\n            ),\n            extentSettings = L.DomUtil.create(\n              'div',\n              'mapml-layer-item-settings',\n              extent\n            ),\n            extentLabel = L.DomUtil.create(\n              'label',\n              'mapml-layer-item-toggle',\n              extentProperties\n            ),\n            input = L.DomUtil.create('input'),\n            svgExtentControlIcon = L.SVG.create('svg'),\n            extentControlPath1 = L.SVG.create('path'),\n            extentControlPath2 = L.SVG.create('path'),\n            extentNameIcon = L.DomUtil.create('span'),\n            extentItemControls = L.DomUtil.create(\n              'div',\n              'mapml-layer-item-controls',\n              extentProperties\n            ),\n            opacityControl = L.DomUtil.create(\n              'details',\n              'mapml-layer-item-opacity',\n              extentSettings\n            ),\n            extentOpacitySummary = L.DomUtil.create(\n              'summary',\n              '',\n              opacityControl\n            ),\n            mapEl = this._layerEl.parentNode,\n            layerEl = this._layerEl,\n            opacity = L.DomUtil.create('input', '', opacityControl);\n          extentSettings.hidden = true;\n          extent.setAttribute('aria-grabbed', 'false');\n          if (!mapExtent.hasAttribute('label')) {\n            // if a label attribute is not present, set it to hidden in layer control\n            extent.setAttribute('hidden', '');\n            mapExtent.hidden = true;\n          }\n\n          // append the svg paths\n          svgExtentControlIcon.setAttribute('viewBox', '0 0 24 24');\n          svgExtentControlIcon.setAttribute('height', '22');\n          svgExtentControlIcon.setAttribute('width', '22');\n          extentControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n          extentControlPath1.setAttribute('fill', 'none');\n          extentControlPath2.setAttribute(\n            'd',\n            'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z'\n          );\n          svgExtentControlIcon.appendChild(extentControlPath1);\n          svgExtentControlIcon.appendChild(extentControlPath2);\n\n          let removeExtentButton = L.DomUtil.create(\n            'button',\n            'mapml-layer-item-remove-control',\n            extentItemControls\n          );\n          removeExtentButton.type = 'button';\n          removeExtentButton.title = 'Remove Sub Layer';\n          removeExtentButton.innerHTML =\n            \"<span aria-hidden='true'>&#10005;</span>\";\n          removeExtentButton.classList.add('mapml-button');\n          L.DomEvent.on(removeExtentButton, 'click', L.DomEvent.stop);\n          L.DomEvent.on(\n            removeExtentButton,\n            'click',\n            (e) => {\n              let allRemoved = true;\n              e.target.checked = false;\n              mapExtent.removed = true;\n              mapExtent.checked = false;\n              if (this._layerEl.checked) this._changeExtent(e, mapExtent);\n              mapExtent.extentAnatomy.parentNode.removeChild(\n                mapExtent.extentAnatomy\n              );\n              for (let j = 0; j < this._properties._mapExtents.length; j++) {\n                if (!this._properties._mapExtents[j].removed) allRemoved = false;\n              }\n              if (allRemoved)\n                this._layerItemSettingsHTML.removeChild(\n                  this._propertiesGroupAnatomy\n                );\n            },\n            this\n          );\n\n          let extentsettingsButton = L.DomUtil.create(\n            'button',\n            'mapml-layer-item-settings-control',\n            extentItemControls\n          );\n          extentsettingsButton.type = 'button';\n          extentsettingsButton.title = 'Extent Settings';\n          extentsettingsButton.setAttribute('aria-expanded', false);\n          extentsettingsButton.classList.add('mapml-button');\n          L.DomEvent.on(\n            extentsettingsButton,\n            'click',\n            (e) => {\n              if (extentSettings.hidden === true) {\n                extentsettingsButton.setAttribute('aria-expanded', true);\n                extentSettings.hidden = false;\n              } else {\n                extentsettingsButton.setAttribute('aria-expanded', false);\n                extentSettings.hidden = true;\n              }\n            },\n            this\n          );\n\n          extentNameIcon.setAttribute('aria-hidden', true);\n          extentLabel.appendChild(input);\n          extentsettingsButton.appendChild(extentNameIcon);\n          extentNameIcon.appendChild(svgExtentControlIcon);\n          extentOpacitySummary.innerText = 'Opacity';\n          extentOpacitySummary.id =\n            'mapml-layer-item-opacity-' + L.stamp(extentOpacitySummary);\n          opacity.setAttribute('type', 'range');\n          opacity.setAttribute('min', '0');\n          opacity.setAttribute('max', '1.0');\n          opacity.setAttribute('step', '0.1');\n          opacity.setAttribute(\n            'aria-labelledby',\n            'mapml-layer-item-opacity-' + L.stamp(extentOpacitySummary)\n          );\n          let opacityValue = mapExtent.hasAttribute('opacity')\n            ? mapExtent.getAttribute('opacity')\n            : '1.0';\n          mapExtent._templateVars.opacity = opacityValue;\n          opacity.setAttribute('value', opacityValue);\n          opacity.value = opacityValue;\n          L.DomEvent.on(opacity, 'change', this._changeExtentOpacity, mapExtent);\n\n          var extentItemNameSpan = L.DomUtil.create(\n            'span',\n            'mapml-layer-item-name',\n            extentLabel\n          );\n          input.defaultChecked = mapExtent ? true : false;\n          mapExtent.checked = input.defaultChecked;\n          input.type = 'checkbox';\n          extentItemNameSpan.innerHTML = mapExtent.getAttribute('label');\n          L.DomEvent.on(input, 'change', (e) => {\n            this._changeExtent(e, mapExtent);\n          });\n          extentItemNameSpan.id =\n            'mapml-extent-item-name-{' + L.stamp(extentItemNameSpan) + '}';\n          extent.setAttribute('aria-labelledby', extentItemNameSpan.id);\n          extentItemNameSpan.extent = mapExtent;\n\n          extent.ontouchstart = extent.onmousedown = (downEvent) => {\n            if (\n              (downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n                downEvent.target.tagName.toLowerCase() !== 'input') ||\n              downEvent.target.tagName.toLowerCase() === 'label'\n            ) {\n              downEvent.stopPropagation();\n              downEvent =\n                downEvent instanceof TouchEvent\n                  ? downEvent.touches[0]\n                  : downEvent;\n\n              let control = extent,\n                controls = extent.parentNode,\n                moving = false,\n                yPos = downEvent.clientY;\n\n              document.body.ontouchmove = document.body.onmousemove = (\n                moveEvent\n              ) => {\n                moveEvent.preventDefault();\n                moveEvent =\n                  moveEvent instanceof TouchEvent\n                    ? moveEvent.touches[0]\n                    : moveEvent;\n\n                // Fixes flickering by only moving element when there is enough space\n                let offset = moveEvent.clientY - yPos;\n                moving = Math.abs(offset) > 5 || moving;\n                if (\n                  (controls && !moving) ||\n                  (controls && controls.childElementCount <= 1) ||\n                  controls.getBoundingClientRect().top >\n                    control.getBoundingClientRect().bottom ||\n                  controls.getBoundingClientRect().bottom <\n                    control.getBoundingClientRect().top\n                ) {\n                  return;\n                }\n\n                controls.classList.add('mapml-draggable');\n                control.style.transform = 'translateY(' + offset + 'px)';\n                control.style.pointerEvents = 'none';\n\n                let x = moveEvent.clientX,\n                  y = moveEvent.clientY,\n                  root =\n                    mapEl.tagName === 'MAPML-VIEWER'\n                      ? mapEl.shadowRoot\n                      : mapEl.querySelector('.mapml-web-map').shadowRoot,\n                  elementAt = root.elementFromPoint(x, y),\n                  swapControl =\n                    !elementAt || !elementAt.closest('fieldset')\n                      ? control\n                      : elementAt.closest('fieldset');\n\n                swapControl =\n                  Math.abs(offset) <= swapControl.offsetHeight\n                    ? control\n                    : swapControl;\n\n                control.setAttribute('aria-grabbed', 'true');\n                control.setAttribute('aria-dropeffect', 'move');\n                if (swapControl && controls === swapControl.parentNode) {\n                  swapControl =\n                    swapControl !== control.nextSibling\n                      ? swapControl\n                      : swapControl.nextSibling;\n                  if (control !== swapControl) {\n                    yPos = moveEvent.clientY;\n                    control.style.transform = null;\n                  }\n                  controls.insertBefore(control, swapControl);\n                }\n              };\n\n              document.body.ontouchend = document.body.onmouseup = () => {\n                control.setAttribute('aria-grabbed', 'false');\n                control.removeAttribute('aria-dropeffect');\n                control.style.pointerEvents = null;\n                control.style.transform = null;\n                let controlsElems = controls.children,\n                  zIndex = 0;\n                for (let c of controlsElems) {\n                  let extentEl = c.querySelector('span').extent;\n\n                  extentEl.setAttribute('data-moving', '');\n                  layerEl.insertAdjacentElement('beforeend', extentEl);\n                  extentEl.removeAttribute('data-moving');\n\n                  extentEl.extentZIndex = zIndex;\n                  extentEl.templatedLayer.setZIndex(zIndex);\n                  zIndex++;\n                }\n                controls.classList.remove('mapml-draggable');\n                document.body.ontouchmove =\n                  document.body.onmousemove =\n                  document.body.ontouchend =\n                  document.body.onmouseup =\n                    null;\n              };\n            }\n          };\n          return extent;\n        }\n        function _initTemplateVars(\n          serverExtent,\n          metaExtent,\n          projection,\n          mapml,\n          base,\n          projectionMatch\n        ) {\n          var templateVars = [];\n          // set up the URL template and associated inputs (which yield variable values when processed)\n          var tlist = serverExtent.querySelectorAll(\n              'map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]'\n            ),\n            varNamesRe = new RegExp('(?:{)(.*?)(?:})', 'g'),\n            zoomInput = serverExtent.querySelector('map-input[type=\"zoom\" i]'),\n            includesZoom = false,\n            extentFallback = {};\n\n          extentFallback.zoom = 0;\n          if (metaExtent) {\n            let content = M._metaContentToObject(\n                metaExtent.getAttribute('content')\n              ),\n              cs;\n\n            extentFallback.zoom = content.zoom || extentFallback.zoom;\n\n            let metaKeys = Object.keys(content);\n            for (let i = 0; i < metaKeys.length; i++) {\n              if (!metaKeys[i].includes('zoom')) {\n                cs = M.axisToCS(metaKeys[i].split('-')[2]);\n                break;\n              }\n            }\n            let axes = M.csToAxes(cs);\n            extentFallback.bounds = M.boundsToPCRSBounds(\n              L.bounds(\n                L.point(\n                  +content[`top-left-${axes[0]}`],\n                  +content[`top-left-${axes[1]}`]\n                ),\n                L.point(\n                  +content[`bottom-right-${axes[0]}`],\n                  +content[`bottom-right-${axes[1]}`]\n                )\n              ),\n              extentFallback.zoom,\n              projection,\n              cs\n            );\n          } else {\n            // for custom projections, M[projection] may not be loaded, so uses M['OSMTILE'] as backup, this code will need to get rerun once projection is changed and M[projection] is available\n            // TODO: This is a temporary fix, _initTemplateVars (or processinitialextent) should not be called when projection of the layer and map do not match, this should be called/reinitialized once the layer projection matches with the map projection\n            let fallbackProjection = M[projection] || M.OSMTILE;\n            extentFallback.bounds = fallbackProjection.options.crs.pcrs.bounds;\n          }\n\n          for (var i = 0; i < tlist.length; i++) {\n            var t = tlist[i],\n              template = t.getAttribute('tref');\n            t.zoomInput = zoomInput;\n            if (!template) {\n              template = BLANK_TT_TREF;\n              let blankInputs = mapml.querySelectorAll('map-input');\n              for (let i of blankInputs) {\n                template += `{${i.getAttribute('name')}}`;\n              }\n            }\n\n            var v,\n              title = t.hasAttribute('title')\n                ? t.getAttribute('title')\n                : 'Query this layer',\n              vcount = template.match(varNamesRe),\n              trel =\n                !t.hasAttribute('rel') ||\n                t.getAttribute('rel').toLowerCase() === 'tile'\n                  ? 'tile'\n                  : t.getAttribute('rel').toLowerCase(),\n              ttype = !t.hasAttribute('type')\n                ? 'image/*'\n                : t.getAttribute('type').toLowerCase(),\n              inputs = [],\n              tms = t && t.hasAttribute('tms');\n            var zoomBounds = mapml.querySelector('map-meta[name=zoom]')\n              ? M._metaContentToObject(\n                  mapml\n                    .querySelector('map-meta[name=zoom]')\n                    .getAttribute('content')\n                )\n              : undefined;\n            while ((v = varNamesRe.exec(template)) !== null) {\n              var varName = v[1],\n                inp = serverExtent.querySelector(\n                  'map-input[name=' +\n                    varName +\n                    '],map-select[name=' +\n                    varName +\n                    ']'\n                );\n              if (inp) {\n                if (\n                  inp.hasAttribute('type') &&\n                  inp.getAttribute('type') === 'location' &&\n                  (!inp.hasAttribute('min') || !inp.hasAttribute('max')) &&\n                  inp.hasAttribute('axis') &&\n                  !['i', 'j'].includes(inp.getAttribute('axis').toLowerCase())\n                ) {\n                  if (\n                    zoomInput &&\n                    template.includes(`{${zoomInput.getAttribute('name')}}`)\n                  ) {\n                    zoomInput.setAttribute('value', extentFallback.zoom);\n                  }\n                  let axis = inp.getAttribute('axis'),\n                    axisBounds = M.convertPCRSBounds(\n                      extentFallback.bounds,\n                      extentFallback.zoom,\n                      projection,\n                      M.axisToCS(axis)\n                    );\n                  inp.setAttribute('min', axisBounds.min[M.axisToXY(axis)]);\n                  inp.setAttribute('max', axisBounds.max[M.axisToXY(axis)]);\n                }\n\n                inputs.push(inp);\n                includesZoom =\n                  includesZoom ||\n                  (inp.hasAttribute('type') &&\n                    inp.getAttribute('type').toLowerCase() === 'zoom');\n                if (inp.tagName.toLowerCase() === 'map-select') {\n                  // use a throwaway div to parse the input from MapML into HTML\n                  var div = document.createElement('div');\n                  div.insertAdjacentHTML('afterbegin', inp.outerHTML);\n                  // parse\n                  inp.htmlselect = div.querySelector('map-select');\n                  inp.htmlselect = transcribe(inp.htmlselect);\n\n                  // this goes into the layer control, so add a listener\n                  L.DomEvent.on(inp.htmlselect, 'change', layer.redraw, layer);\n                  if (!layer._userInputs) {\n                    layer._userInputs = [];\n                  }\n                  layer._userInputs.push(inp.htmlselect);\n                }\n                // TODO: if this is an input@type=location\n                // get the TCRS min,max attribute values at the identified zoom level\n                // save this information as properties of the serverExtent,\n                // perhaps as a bounds object so that it can be easily used\n                // later by the layer control to determine when to enable\n                // disable the layer for drawing.\n              } else {\n                console.log(\n                  'input with name=' +\n                    varName +\n                    ' not found for template variable of same name'\n                );\n                // no match found, template won't be used\n                break;\n              }\n            }\n            if (\n              (template && vcount.length === inputs.length) ||\n              template === BLANK_TT_TREF\n            ) {\n              if (trel === 'query') {\n                layer.queryable = true;\n              }\n              if (!includesZoom && zoomInput) {\n                inputs.push(zoomInput);\n              }\n              let step = zoomInput ? zoomInput.getAttribute('step') : 1;\n              if (!step || step === '0' || isNaN(step)) step = 1;\n              // template has a matching input for every variable reference {varref}\n              templateVars.push({\n                template: decodeURI(new URL(template, base)),\n                linkEl: t,\n                title: title,\n                rel: trel,\n                type: ttype,\n                values: inputs,\n                zoomBounds: zoomBounds,\n                extentPCRSFallback: { bounds: extentFallback.bounds },\n                projectionMatch: projectionMatch,\n                projection:\n                  serverExtent.getAttribute('units') || FALLBACK_PROJECTION,\n                tms: tms,\n                step: step\n              });\n            }\n          }\n          return templateVars;\n        }\n        function transcribe(element) {\n          var select = document.createElement('select');\n          var elementAttrNames = element.getAttributeNames();\n\n          for (let i = 0; i < elementAttrNames.length; i++) {\n            select.setAttribute(\n              elementAttrNames[i],\n              element.getAttribute(elementAttrNames[i])\n            );\n          }\n\n          var options = element.children;\n\n          for (let i = 0; i < options.length; i++) {\n            var option = document.createElement('option');\n            var optionAttrNames = options[i].getAttributeNames();\n\n            for (let j = 0; j < optionAttrNames.length; j++) {\n              option.setAttribute(\n                optionAttrNames[j],\n                options[i].getAttribute(optionAttrNames[j])\n              );\n            }\n\n            option.innerHTML = options[i].innerHTML;\n            select.appendChild(option);\n          }\n          return select;\n        }\n        function setZoomInOrOutLinks() {\n          var zoomin = mapml.querySelector('map-link[rel=zoomin]'),\n            zoomout = mapml.querySelector('map-link[rel=zoomout]');\n          if (zoomin) {\n            layer._properties.zoomin = new URL(\n              zoomin.getAttribute('href'),\n              base\n            ).href;\n          }\n          if (zoomout) {\n            layer._properties.zoomout = new URL(\n              zoomout.getAttribute('href'),\n              base\n            ).href;\n          }\n        }\n        function processFeatures() {\n          let native = M.getNativeVariables(layer._content);\n          layer._mapmlvectors = M.featureLayer(null, {\n            // pass the vector layer a renderer of its own, otherwise leaflet\n            // puts everything into the overlayPane\n            renderer: M.featureRenderer(),\n            // pass the vector layer the container for the parent into which\n            // it will append its own container for rendering into\n            pane: layer._container,\n            opacity: layer.options.opacity,\n            projection: layer._properties.projection,\n            // by NOT passing options.extent, we are asking the FeatureLayer\n            // to dynamically update its .layerBounds property as features are\n            // added or removed from it\n            native: native,\n            // each owned child layer gets a reference to the root layer\n            _leafletLayer: layer,\n            static: true,\n            onEachFeature: function (properties, geometry) {\n              // need to parse as HTML to preserve semantics and styles\n              if (properties) {\n                var c = document.createElement('div');\n                c.classList.add('mapml-popup-content');\n                c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n                geometry.bindPopup(c, { autoClose: false, minWidth: 165 });\n              }\n            }\n          });\n        }\n        function processTiles() {\n          if (mapml.querySelector('map-tile')) {\n            var tiles = document.createElement('map-tiles'),\n              zoom =\n                mapml.querySelector('map-meta[name=zoom][content]') ||\n                mapml.querySelector('map-input[type=zoom][value]');\n            tiles.setAttribute(\n              'zoom',\n              (zoom && zoom.getAttribute('content')) ||\n                (zoom && zoom.getAttribute('value')) ||\n                '0'\n            );\n            var newTiles = mapml.getElementsByTagName('map-tile');\n            for (var nt = 0; nt < newTiles.length; nt++) {\n              tiles.appendChild(document.importNode(newTiles[nt], true));\n            }\n            layer._mapmlTileContainer.appendChild(tiles);\n            layer._staticTileLayer = M.staticTileLayer({\n              pane: layer._container,\n              _leafletLayer: layer,\n              projection: layer._properties.projection,\n              className: 'mapml-static-tile-layer',\n              tileContainer: layer._mapmlTileContainer,\n              maxZoomBound: layer._properties.crs.options.resolutions.length - 1,\n              tileSize: layer._properties.crs.options.crs.tile.bounds.max.x\n            });\n          }\n        }\n        function getAlternateStyles() {\n          var styleLinks = mapml.querySelectorAll(\n            'map-link[rel=style],map-link[rel=\"self style\"],map-link[rel=\"style self\"]'\n          );\n          if (styleLinks.length > 1) {\n            var stylesControl = document.createElement('details'),\n              stylesControlSummary = document.createElement('summary');\n            stylesControlSummary.innerText = 'Style';\n            stylesControl.appendChild(stylesControlSummary);\n\n            var changeStyle = function (e) {\n              L.DomEvent.stop(e);\n              layer._layerEl.dispatchEvent(\n                new CustomEvent('changestyle', {\n                  detail: {\n                    src: e.target.getAttribute('data-href')\n                  }\n                })\n              );\n            };\n\n            for (var j = 0; j < styleLinks.length; j++) {\n              var styleOption = document.createElement('div'),\n                styleOptionInput = styleOption.appendChild(\n                  document.createElement('input')\n                );\n              styleOptionInput.setAttribute('type', 'radio');\n              styleOptionInput.setAttribute(\n                'id',\n                'rad-' + L.stamp(styleOptionInput)\n              );\n              styleOptionInput.setAttribute('name', 'styles-' + layer._title);\n              styleOptionInput.setAttribute(\n                'value',\n                styleLinks[j].getAttribute('title')\n              );\n              styleOptionInput.setAttribute(\n                'data-href',\n                new URL(styleLinks[j].getAttribute('href'), base).href\n              );\n              var styleOptionLabel = styleOption.appendChild(\n                document.createElement('label')\n              );\n              styleOptionLabel.setAttribute(\n                'for',\n                'rad-' + L.stamp(styleOptionInput)\n              );\n              styleOptionLabel.innerText = styleLinks[j].getAttribute('title');\n              if (\n                styleLinks[j].getAttribute('rel') === 'style self' ||\n                styleLinks[j].getAttribute('rel') === 'self style'\n              ) {\n                styleOptionInput.checked = true;\n              }\n              stylesControl.appendChild(styleOption);\n              L.DomUtil.addClass(\n                stylesControl,\n                'mapml-layer-item-style mapml-control-layers'\n              );\n              L.DomEvent.on(styleOptionInput, 'click', changeStyle, layer);\n            }\n            return stylesControl;\n          }\n        }\n        function setLayerTitle() {\n          if (mapml.querySelector('map-title')) {\n            layer._title = mapml.querySelector('map-title').textContent.trim();\n            layer._titleIsReadOnly = true;\n          } else if (mapml instanceof Element && mapml.hasAttribute('label')) {\n            layer._title = mapml.getAttribute('label').trim();\n          }\n          // _mapmlLayerItem is set to the root element representing this layer\n          // in the layer control, iff the layer is not 'hidden'\n          layer._createLayerControlHTML();\n        }\n        function copyRemoteContentToShadowRoot() {\n          // only run when content is loaded from network, puts features etc\n          // into layer shadow root\n          if (local) {\n            return;\n          }\n          let shadowRoot = layer._layerEl.shadowRoot;\n          let elements = mapml.children[0].children[1].children;\n          if (elements) {\n            let baseURL = mapml.children[0].children[0]\n              .querySelector('map-base')\n              ?.getAttribute('href');\n            for (let el of elements) {\n              // if not clone, the elements will be **REMOVED** from mapml file and re-attached to the layer's shadow root\n              // which makes the this._content (mapml file) changed and thus affects the later generation process of this._mapmlvectors\n              let node = el.cloneNode(true);\n              el._DOMnode = node;\n              // resolve relative url\n              if (node.nodeName === 'map-link') {\n                let url = node.getAttribute('href') || node.getAttribute('tref');\n                // if relative\n                if (\n                  url &&\n                  (url.indexOf('http://') === 0 || url.indexOf('https://') === 0)\n                ) {\n                  let resolvedURL = baseURL + url;\n                  if (node.hasAttribute('href')) {\n                    node.setAttribute('href', resolvedURL);\n                  } else {\n                    node.setAttribute('tref', resolvedURL);\n                  }\n                }\n              }\n              shadowRoot.appendChild(node);\n            }\n          }\n        }\n        function parseLicenseAndLegend() {\n          var licenseLink = mapml.querySelector('map-link[rel=license]'),\n            licenseTitle,\n            licenseUrl,\n            attText;\n          if (licenseLink) {\n            licenseTitle = licenseLink.getAttribute('title');\n            licenseUrl = licenseLink.getAttribute('href');\n            attText =\n              '<a href=\"' +\n              licenseUrl +\n              '\" title=\"' +\n              licenseTitle +\n              '\">' +\n              licenseTitle +\n              '</a>';\n          }\n          L.setOptions(layer, { attribution: attText });\n          var legendLink = mapml.querySelector('map-link[rel=legend]');\n          if (legendLink) {\n            layer._legendUrl = legendLink.getAttribute('href');\n          }\n          if (layer._map) {\n            // if the layer is checked in the layer control, force the addition\n            // of the attribution just received\n            if (layer._map.hasLayer(layer)) {\n              layer._map.attributionControl.addAttribution(\n                layer.getAttribution()\n              );\n            }\n          }\n        }\n      }\n    },\n    _validateExtent: function () {\n      // TODO: change so that the _extent bounds are set based on inputs\n      if (!this._properties || !this._map) {\n        return;\n      }\n      var serverExtent = this._properties._mapExtents\n          ? this._properties._mapExtents\n          : [this._properties],\n        lp;\n\n      // loop through the map-extent elements and assign each one its crs\n      for (let i = 0; i < serverExtent.length; i++) {\n        if (!serverExtent[i].querySelector) {\n          return;\n        }\n        if (\n          serverExtent[i].querySelector(\n            '[type=zoom][min=\"\"], [type=zoom][max=\"\"]'\n          )\n        ) {\n          var zoom = serverExtent[i].querySelector('[type=zoom]');\n          zoom.setAttribute('min', this._map.getMinZoom());\n          zoom.setAttribute('max', this._map.getMaxZoom());\n        }\n        lp = serverExtent[i].hasAttribute('units')\n          ? serverExtent[i].getAttribute('units')\n          : null;\n        if (lp && M[lp]) {\n          if (this._properties._mapExtents)\n            this._properties._mapExtents[i].crs = M[lp];\n          else this._properties.crs = M[lp];\n        } else {\n          if (this._properties._mapExtents)\n            this._properties._mapExtents[i].crs = M.OSMTILE;\n          else this._properties.crs = M.OSMTILE;\n        }\n      }\n    },\n    // new getProjection, maybe simpler, but doesn't work...\n    getProjection: function () {\n      if (!this._properties) {\n        return;\n      }\n      return this._properties.projection;\n    },\n    getQueryTemplates: function (pcrsClick) {\n      if (this._properties && this._properties._queries) {\n        var templates = [];\n        // only return queries that are in bounds\n        if (\n          this._layerEl.checked &&\n          !this._layerEl.hidden &&\n          this._mapmlLayerItem\n        ) {\n          let layerAndExtents = this._mapmlLayerItem.querySelectorAll(\n            '.mapml-layer-item-name'\n          );\n          for (let i = 0; i < layerAndExtents.length; i++) {\n            if (\n              layerAndExtents[i].extent ||\n              this._properties._mapExtents.length === 1\n            ) {\n              // the layer won't have an .extent property, this is kind of a hack\n              let extent =\n                layerAndExtents[i].extent || this._properties._mapExtents[0];\n              for (let j = 0; j < extent._templateVars.length; j++) {\n                if (extent.checked) {\n                  let template = extent._templateVars[j];\n                  // for each template in the extent, see if it corresponds to one in the this._properties._queries array\n                  for (let k = 0; k < this._properties._queries.length; k++) {\n                    let queryTemplate = this._properties._queries[k];\n                    if (\n                      template === queryTemplate &&\n                      queryTemplate.extentBounds.contains(pcrsClick)\n                    ) {\n                      templates.push(queryTemplate);\n                    }\n                  }\n                }\n              }\n            }\n          }\n          return templates;\n        }\n      }\n    },\n    _attachSkipButtons: function (e) {\n      let popup = e.popup,\n        map = e.target,\n        layer,\n        group,\n        content = popup._container.getElementsByClassName(\n          'mapml-popup-content'\n        )[0];\n\n      popup._container.setAttribute('role', 'dialog');\n      content.setAttribute('tabindex', '-1');\n      // https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/467#issuecomment-844307818\n      content.setAttribute('role', 'document');\n      popup._count = 0; // used for feature pagination\n\n      if (popup._source._eventParents) {\n        // check if the popup is for a feature or query\n        layer =\n          popup._source._eventParents[\n            Object.keys(popup._source._eventParents)[0]\n          ]; // get first parent of feature, there should only be one\n        group = popup._source.group;\n        // if the popup is for a static / templated feature, the \"zoom to here\" link can be attached once the popup opens\n        attachZoomLink.call(popup);\n      } else {\n        layer = popup._source._templatedLayer;\n        // if the popup is for a query, the \"zoom to here\" link should be re-attached every time new pagination features are displayed\n        map.on('attachZoomLink', attachZoomLink, popup);\n      }\n\n      if (popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')) {\n        L.DomUtil.remove(\n          popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')\n        );\n        L.DomUtil.remove(popup._container.querySelector('hr'));\n      }\n      //add when popopen event happens instead\n      let div = L.DomUtil.create('nav', 'mapml-focus-buttons');\n\n      // creates |< button, focuses map\n      let mapFocusButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      mapFocusButton.type = 'button';\n      mapFocusButton.title = 'Focus Map';\n      mapFocusButton.innerHTML = \"<span aria-hidden='true'>|&#10094;</span>\";\n      L.DomEvent.on(\n        mapFocusButton,\n        'click',\n        (e) => {\n          L.DomEvent.stop(e);\n          map.featureIndex._sortIndex();\n          map.closePopup();\n          map._container.focus();\n        },\n        popup\n      );\n\n      // creates < button, focuses previous feature, if none exists focuses the current feature\n      let previousButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      previousButton.type = 'button';\n      previousButton.title = 'Previous Feature';\n      previousButton.innerHTML = \"<span aria-hidden='true'>&#10094;</span>\";\n      L.DomEvent.on(previousButton, 'click', layer._previousFeature, popup);\n\n      // static feature counter that 1/1\n      let featureCount = L.DomUtil.create('p', 'mapml-feature-count', div),\n        totalFeatures = this._totalFeatureCount ? this._totalFeatureCount : 1;\n      featureCount.innerText = popup._count + 1 + '/' + totalFeatures;\n\n      // creates > button, focuses next feature, if none exists focuses the current feature\n      let nextButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      nextButton.type = 'button';\n      nextButton.title = 'Next Feature';\n      nextButton.innerHTML = \"<span aria-hidden='true'>&#10095;</span>\";\n      L.DomEvent.on(nextButton, 'click', layer._nextFeature, popup);\n\n      // creates >| button, focuses map controls\n      let controlFocusButton = L.DomUtil.create(\n        'button',\n        'mapml-popup-button',\n        div\n      );\n      controlFocusButton.type = 'button';\n      controlFocusButton.title = 'Focus Controls';\n      controlFocusButton.innerHTML = \"<span aria-hidden='true'>&#10095;|</span>\";\n      L.DomEvent.on(\n        controlFocusButton,\n        'click',\n        (e) => {\n          map.featureIndex._sortIndex();\n          map.featureIndex.currentIndex =\n            map.featureIndex.inBoundFeatures.length - 1;\n          map.featureIndex.inBoundFeatures[0].path.setAttribute('tabindex', -1);\n          map.featureIndex.inBoundFeatures[\n            map.featureIndex.currentIndex\n          ].path.setAttribute('tabindex', 0);\n          L.DomEvent.stop(e);\n          map.closePopup();\n          map._controlContainer.querySelector('A:not([hidden])').focus();\n        },\n        popup\n      );\n\n      let divider = L.DomUtil.create('hr', 'mapml-popup-divider');\n\n      popup._navigationBar = div;\n      popup._content.appendChild(divider);\n      popup._content.appendChild(div);\n\n      content.focus();\n\n      if (group && !M.options.featureIndexOverlayOption) {\n        // e.target = this._map\n        // Looks for keydown, more specifically tab and shift tab\n        group.setAttribute('aria-expanded', 'true');\n        map.on('keydown', focusFeature);\n      } else {\n        map.on('keydown', focusMap);\n      }\n      // When popup is open, what gets focused with tab needs to be done using JS as the DOM order is not in an accessibility friendly manner\n      function focusFeature(focusEvent) {\n        let path =\n          focusEvent.originalEvent.path ||\n          focusEvent.originalEvent.composedPath();\n        let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n        if (\n          (path[0].classList.contains('leaflet-popup-close-button') &&\n            isTab &&\n            !shiftPressed) ||\n          focusEvent.originalEvent.keyCode === 27 ||\n          (path[0].classList.contains('leaflet-popup-close-button') &&\n            focusEvent.originalEvent.keyCode === 13)\n        ) {\n          setTimeout(() => {\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        } else if (\n          path[0].classList.contains('mapml-popup-content') &&\n          isTab &&\n          shiftPressed\n        ) {\n          setTimeout(() => {\n            //timeout needed so focus of the feature is done even after the keypressup event occurs\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        } else if (\n          path[0] === popup._content.querySelector('a') &&\n          isTab &&\n          shiftPressed\n        ) {\n          setTimeout(() => {\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        }\n      }\n\n      function focusMap(focusEvent) {\n        let path =\n          focusEvent.originalEvent.path ||\n          focusEvent.originalEvent.composedPath();\n        let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n\n        if (\n          (focusEvent.originalEvent.keyCode === 13 &&\n            path[0].classList.contains('leaflet-popup-close-button')) ||\n          focusEvent.originalEvent.keyCode === 27\n        ) {\n          L.DomEvent.stopPropagation(focusEvent);\n          map.closePopup(popup);\n          map._container.focus();\n          if (focusEvent.originalEvent.keyCode !== 27) map._popupClosed = true;\n        } else if (\n          isTab &&\n          path[0].classList.contains('leaflet-popup-close-button')\n        ) {\n          map.closePopup(popup);\n        } else if (\n          path[0].classList.contains('mapml-popup-content') &&\n          isTab &&\n          shiftPressed\n        ) {\n          map.closePopup(popup);\n          setTimeout(() => {\n            //timeout needed so focus of the feature is done even after the keypressup event occurs\n            L.DomEvent.stop(focusEvent);\n            map._container.focus();\n          }, 0);\n        } else if (\n          path[0] === popup._content.querySelector('a') &&\n          isTab &&\n          shiftPressed\n        ) {\n          map.closePopup(popup);\n          setTimeout(() => {\n            L.DomEvent.stop(focusEvent);\n            map._container.focus();\n          }, 0);\n        }\n      }\n\n      function attachZoomLink(e) {\n        // this === popup\n        let content = this._content,\n          featureEl = e ? e.currFeature : this._source._groupLayer._featureEl;\n        if (content.querySelector('a.mapml-zoom-link')) {\n          content.querySelector('a.mapml-zoom-link').remove();\n        }\n        if (!featureEl.querySelector('map-geometry')) return;\n        featureEl.whenReady().then(() => {\n          let tL = featureEl.extent.topLeft.gcrs,\n            bR = featureEl.extent.bottomRight.gcrs,\n            center = L.latLngBounds(\n              L.latLng(tL.horizontal, tL.vertical),\n              L.latLng(bR.horizontal, bR.vertical)\n            ).getCenter(true);\n          let zoomLink = document.createElement('a');\n          zoomLink.href = `#${featureEl.getMaxZoom()},${center.lng},${\n          center.lat\n        }`;\n          zoomLink.innerHTML = `${M.options.locale.popupZoom}`;\n          zoomLink.className = 'mapml-zoom-link';\n          zoomLink.onclick = zoomLink.onkeydown = function (e) {\n            if (!(e instanceof MouseEvent) && e.keyCode !== 13) return;\n            e.preventDefault();\n            featureEl.zoomTo();\n            featureEl._map.closePopup();\n            featureEl._map.getContainer().focus();\n          };\n          // we found that the popupopen event is fired as many times as there\n          // are layers on the map (<layer-> elements / MapMLLayers that is).\n          // In each case the target layer is always this layer, so we can't\n          // detect and conditionally add the zoomLink if the target is not this.\n          // so, like Ahmad, we are taking a 'delete everyting each time'\n          // approach (see _attachSkipButtons for this approach taken with\n          // feature navigation buttons); obviously he dealt with this leaflet bug\n          // this way some time ago, and we can't figure out how to get around it\n          // apart from this slightly non-optimal method. Revisit sometime!\n          let link = content.querySelector('.mapml-zoom-link');\n          if (link) link.remove();\n          content.insertBefore(\n            zoomLink,\n            content.querySelector('hr.mapml-popup-divider')\n          );\n        });\n      }\n\n      // if popup closes then the focusFeature handler can be removed\n      map.on('popupclose', removeHandlers);\n      function removeHandlers(removeEvent) {\n        if (removeEvent.popup === popup) {\n          map.off('keydown', focusFeature);\n          map.off('keydown', focusMap);\n          map.off('popupopen', attachZoomLink);\n          map.off('popupclose', removeHandlers);\n          if (group) group.setAttribute('aria-expanded', 'false');\n        }\n      }\n    }\n  });\n  var mapMLLayer = function (url, node, mapml, options) {\n    if (!url && !node) return null;\n    return new MapMLLayer(url, node, mapml, options);\n  };\n\n  var DebugOverlay = L.Layer.extend({\n    onAdd: function (map) {\n      let mapSize = map.getSize();\n\n      //conditionally show container for debug panel/banner only when the map has enough space for it\n      if (mapSize.x > 400 || mapSize.y > 300) {\n        this._container = L.DomUtil.create(\n          'table',\n          'mapml-debug',\n          map._container\n        );\n\n        this._panel = debugPanel({\n          className: 'mapml-debug-panel',\n          pane: this._container\n        });\n        map.addLayer(this._panel);\n      }\n\n      this._grid = debugGrid({\n        className: 'mapml-debug-grid',\n        pane: map._panes.mapPane,\n        zIndex: 400,\n        tileSize: map.options.crs.options.crs.tile.bounds.max.x\n      });\n      map.addLayer(this._grid);\n\n      this._vectors = debugVectors({\n        className: 'mapml-debug-vectors',\n        pane: map._panes.mapPane,\n        toolPane: this._container\n      });\n      map.addLayer(this._vectors);\n    },\n\n    onRemove: function (map) {\n      map.removeLayer(this._grid);\n      map.removeLayer(this._vectors);\n      if (this._panel) {\n        //conditionally remove the panel, as it's not always added\n        map.removeLayer(this._panel);\n        L.DomUtil.remove(this._container);\n      }\n    }\n  });\n\n  var debugOverlay = function () {\n    return new DebugOverlay();\n  };\n\n  var DebugPanel = L.Layer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n    },\n\n    onAdd: function (map) {\n      this._title = L.DomUtil.create(\n        'caption',\n        'mapml-debug-banner',\n        this.options.pane\n      );\n      this._title.innerHTML = 'Debug mode';\n\n      map.debug = {};\n      map.debug._infoContainer = this._debugContainer = L.DomUtil.create(\n        'tbody',\n        'mapml-debug-panel',\n        this.options.pane\n      );\n\n      let infoContainer = map.debug._infoContainer;\n\n      map.debug._tileCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._tileMatrixCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._mapCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._tcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._pcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._gcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n\n      this._map.on('mousemove', this._updateCoords);\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._title);\n      if (this._debugContainer) {\n        L.DomUtil.remove(this._debugContainer);\n        this._map.off('mousemove', this._updateCoords);\n      }\n    },\n    _updateCoords: function (e) {\n      if (this.contextMenu._visible) return;\n      let mapEl = this.options.mapEl,\n        point = mapEl._map.project(e.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointI = point.x % tileSize,\n        pointJ = point.y % tileSize;\n\n      if (pointI < 0) pointI += tileSize;\n      if (pointJ < 0) pointJ += tileSize;\n\n      this.debug._tileCoord.innerHTML = `\n      <th scope=\"row\">tile: </th>\n      <td>i: ${Math.trunc(pointI)}, </td>\n      <td>j: ${Math.trunc(pointJ)}</td>\n      `;\n      this.debug._mapCoord.innerHTML = `\n      <th scope=\"row\">map: </th>\n      <td>i: ${Math.trunc(e.containerPoint.x)}, </td>\n      <td>j: ${Math.trunc(e.containerPoint.y)}</td>\n      `;\n      this.debug._gcrsCoord.innerHTML = `\n      <th scope=\"row\">gcrs: </th>\n      <td>lon: ${e.latlng.lng.toFixed(6)}, </td>\n      <td>lat: ${e.latlng.lat.toFixed(6)}</td>\n      `;\n      this.debug._tcrsCoord.innerHTML = `\n      <th scope=\"row\">tcrs: </th>\n      <td>x: ${Math.trunc(point.x)}, </td>\n      <td>y: ${Math.trunc(point.y)}</td>\n      `;\n      this.debug._tileMatrixCoord.innerHTML = `\n      <th scope=\"row\">tilematrix: </th>\n      <td>column: ${Math.trunc(point.x / tileSize)}, </td>\n      <td>row: ${Math.trunc(point.y / tileSize)}</td>\n      `;\n      this.debug._pcrsCoord.innerHTML = `\n      <th scope=\"row\">pcrs: </th>\n      <td>easting: ${pcrs.x.toFixed(2)}, </td>\n      <td>northing: ${pcrs.y.toFixed(2)}</td>\n      `;\n    }\n  });\n\n  var debugPanel = function (options) {\n    return new DebugPanel(options);\n  };\n\n  var DebugGrid = L.GridLayer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.GridLayer.prototype.initialize.call(this, this._map);\n    },\n\n    createTile: function (coords) {\n      let tile = L.DomUtil.create('div', 'mapml-debug-tile');\n      tile.setAttribute('col', coords.x);\n      tile.setAttribute('row', coords.y);\n      tile.setAttribute('zoom', coords.z);\n      tile.innerHTML = [\n        `col: ${coords.x}`,\n        `row: ${coords.y}`,\n        `zoom: ${coords.z}`\n      ].join(', ');\n\n      tile.style.outline = '1px dashed red';\n      return tile;\n    }\n  });\n\n  var debugGrid = function (options) {\n    return new DebugGrid(options);\n  };\n\n  var DebugVectors = L.LayerGroup.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.LayerGroup.prototype.initialize.call(this, this._map, options);\n    },\n    onAdd: function (map) {\n      map.on('overlayremove', this._mapLayerUpdate, this);\n      map.on('overlayadd', this._mapLayerUpdate, this);\n      let center = map.options.crs.transformation.transform(\n        L.point(0, 0),\n        map.options.crs.scale(0)\n      );\n      this._centerVector = L.circle(map.options.crs.pointToLatLng(center, 0), {\n        radius: 250\n      });\n      this._centerVector.bindTooltip('Projection Center');\n\n      this._addBounds(map);\n    },\n    onRemove: function (map) {\n      this.clearLayers();\n    },\n\n    _addBounds: function (map) {\n      let id = Object.keys(map._layers),\n        layers = map._layers,\n        colors = ['#FF5733', '#8DFF33', '#3397FF', '#E433FF', '#F3FF33'],\n        j = 0;\n\n      this.addLayer(this._centerVector);\n\n      for (let i of id) {\n        if (layers[i].layerBounds || layers[i].extentBounds) {\n          let boundsArray;\n          if (layers[i].layerBounds) {\n            boundsArray = [\n              layers[i].layerBounds.min,\n              L.point(layers[i].layerBounds.max.x, layers[i].layerBounds.min.y),\n              layers[i].layerBounds.max,\n              L.point(layers[i].layerBounds.min.x, layers[i].layerBounds.max.y)\n            ];\n          } else {\n            boundsArray = [\n              layers[i].extentBounds.min,\n              L.point(layers[i].extentBounds.max.x, layers[i].extentBounds.min.y),\n              layers[i].extentBounds.max,\n              L.point(layers[i].extentBounds.min.x, layers[i].extentBounds.max.y)\n            ];\n          }\n          let boundsRect = projectedExtent(boundsArray, {\n            color: colors[j % colors.length],\n            weight: 2,\n            opacity: 1,\n            fillOpacity: 0.01,\n            fill: true\n          });\n          if (layers[i].options._leafletLayer)\n            boundsRect.bindTooltip(layers[i].options._leafletLayer._title, {\n              sticky: true\n            });\n          this.addLayer(boundsRect);\n          j++;\n        }\n      }\n\n      if (map.totalLayerBounds) {\n        let totalBoundsArray = [\n          map.totalLayerBounds.min,\n          L.point(map.totalLayerBounds.max.x, map.totalLayerBounds.min.y),\n          map.totalLayerBounds.max,\n          L.point(map.totalLayerBounds.min.x, map.totalLayerBounds.max.y)\n        ];\n\n        let totalBounds = projectedExtent(totalBoundsArray, {\n          color: '#808080',\n          weight: 5,\n          opacity: 0.5,\n          fill: false\n        });\n        this.addLayer(totalBounds);\n      }\n    },\n\n    _mapLayerUpdate: function (e) {\n      this.clearLayers();\n      this._addBounds(e.target);\n    }\n  });\n\n  var debugVectors = function (options) {\n    return new DebugVectors(options);\n  };\n\n  var ProjectedExtent = L.Path.extend({\n    getCenter: function (round) {\n      let crs = this._map.options.crs;\n      return crs.unproject(L.bounds(this._locations).getCenter());\n    },\n\n    options: {\n      className: 'mapml-debug-extent'\n    },\n    initialize: function (locations, options) {\n      //locations passed in as pcrs coordinates\n      this._locations = locations;\n      L.setOptions(this, options);\n    },\n\n    _project: function () {\n      this._rings = [];\n      let scale = this._map.options.crs.scale(this._map.getZoom()),\n        map = this._map;\n      for (let i = 0; i < this._locations.length; i++) {\n        let point = map.options.crs.transformation.transform(\n          this._locations[i],\n          scale\n        );\n        //substract the pixel origin from the pixel coordinates to get the location relative to map viewport\n        this._rings.push(\n          L.point(point.x, point.y)._subtract(map.getPixelOrigin())\n        );\n      }\n      //leaflet SVG renderer looks for and array of arrays to build polygons,\n      //in this case it only deals with a rectangle so one closed array or points\n      this._parts = [this._rings];\n    },\n\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updatePoly(this, true); //passing true creates a closed path i.e. a rectangle\n    }\n  });\n\n  var projectedExtent = function (locations, options) {\n    return new ProjectedExtent(locations, options);\n  };\n\n  var QueryHandler = L.Handler.extend({\n    addHooks: function () {\n      // get a reference to the actual <map> element, so we can\n      // use its layers property to iterate the layers from top down\n      // evaluating if they are 'on the map' (enabled)\n      L.setOptions(this, { mapEl: this._map.options.mapEl });\n      L.DomEvent.on(this._map, 'click', this._queryTopLayer, this);\n      L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n    },\n    removeHooks: function () {\n      L.DomEvent.off(this._map, 'click', this._queryTopLayer, this);\n      L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n    },\n    _getTopQueryableLayer: function () {\n      var layers = this.options.mapEl.layers;\n      // work backwards in document order (top down)\n      for (var l = layers.length - 1; l >= 0; l--) {\n        var mapmlLayer = layers[l]._layer;\n        if (layers[l].checked && mapmlLayer && mapmlLayer.queryable) {\n          return mapmlLayer;\n        }\n      }\n    },\n    _queryTopLayerAtMapCenter: function (event) {\n      setTimeout(() => {\n        if (\n          this._map.isFocused &&\n          !this._map._popupClosed &&\n          (event.originalEvent.key === ' ' || +event.originalEvent.keyCode === 13)\n        ) {\n          this._map.fire('click', {\n            latlng: this._map.getCenter(),\n            layerPoint: this._map.latLngToLayerPoint(this._map.getCenter()),\n            containerPoint: this._map.latLngToContainerPoint(\n              this._map.getCenter()\n            )\n          });\n        } else {\n          delete this._map._popupClosed;\n        }\n      }, 0);\n    },\n    _queryTopLayer: function (event) {\n      var layer = this._getTopQueryableLayer();\n      if (layer) {\n        if (layer._mapmlFeatures) delete layer._mapmlFeatures;\n        this._query(event, layer);\n      }\n    },\n    _query(e, layer) {\n      var zoom = e.target.getZoom(),\n        map = this._map,\n        crs = layer._properties.crs, // the crs for each extent would be the same\n        tileSize = map.options.crs.options.crs.tile.bounds.max.x,\n        container = layer._container,\n        popupOptions = {\n          autoClose: false,\n          autoPan: true,\n          maxHeight: map.getSize().y * 0.5 - 50\n        },\n        tcrs2pcrs = function (c) {\n          return crs.transformation.untransform(c, crs.scale(zoom));\n        },\n        tcrs2gcrs = function (c) {\n          return crs.unproject(\n            crs.transformation.untransform(c, crs.scale(zoom)),\n            zoom\n          );\n        };\n      var tcrsClickLoc = crs.latLngToPoint(e.latlng, zoom),\n        tileMatrixClickLoc = tcrsClickLoc.divideBy(tileSize).floor(),\n        tileBounds = new L.Bounds(\n          tcrsClickLoc.divideBy(tileSize).floor().multiplyBy(tileSize),\n          tcrsClickLoc.divideBy(tileSize).ceil().multiplyBy(tileSize)\n        );\n\n      let point = this._map.project(e.latlng),\n        scale = this._map.options.crs.scale(this._map.getZoom()),\n        pcrsClick = this._map.options.crs.transformation.untransform(\n          point,\n          scale\n        );\n      let templates = layer.getQueryTemplates(pcrsClick);\n\n      let fetches = [];\n\n      var fetchFeatures = function (template, obj) {\n        const parser = new DOMParser();\n        return fetch(L.Util.template(template.template, obj), {\n          redirect: 'follow'\n        })\n          .then((response) => {\n            if (response.status >= 200 && response.status < 300) {\n              return response.text().then((text) => {\n                return {\n                  contenttype: response.headers.get('Content-Type'),\n                  text: text\n                };\n              });\n            } else {\n              throw new Error(response.status);\n            }\n          })\n          .then((response) => {\n            let features = [];\n            if (response.contenttype.startsWith('text/mapml')) {\n              // the mapmldoc could have <map-meta> elements that are important, perhaps\n              // also, the mapmldoc can have many features\n              let mapmldoc = parser.parseFromString(\n                response.text,\n                'application/xml'\n              );\n              features = Array.prototype.slice.call(\n                mapmldoc.querySelectorAll('map-feature')\n              );\n              // <map-meta> elements for this query\n              layer.queryMetas = Array.prototype.slice.call(\n                mapmldoc.querySelectorAll(\n                  'map-meta[name=cs], map-meta[name=zoom], map-meta[name=projection]'\n                )\n              );\n            } else {\n              // synthesize a single feature from text or html content\n              let geom =\n                  \"<map-geometry cs='gcrs'><map-point><map-coordinates>\" +\n                  e.latlng.lng +\n                  ' ' +\n                  e.latlng.lat +\n                  '</map-coordinates></map-point></map-geometry>',\n                feature = parser\n                  .parseFromString(\n                    '<map-feature><map-properties>' +\n                      response.text +\n                      '</map-properties>' +\n                      geom +\n                      '</map-feature>',\n                    'text/html'\n                  )\n                  .querySelector('map-feature');\n              features.push(feature);\n            }\n            return { features: features, template: template };\n          })\n          .catch((err) => {\n            console.log('Looks like there was a problem. Status: ' + err.message);\n          });\n      };\n\n      for (let i = 0; i < templates.length; i++) {\n        var obj = {},\n          template = templates[i];\n\n        // all of the following are locations that might be used in a query, I think.\n        obj[template.query.tilei] =\n          tcrsClickLoc.x.toFixed() - tileMatrixClickLoc.x * tileSize;\n        obj[template.query.tilej] =\n          tcrsClickLoc.y.toFixed() - tileMatrixClickLoc.y * tileSize;\n\n        // this forces the click to the centre of the map extent in the layer crs\n        obj[template.query.mapi] = map.getSize().divideBy(2).x.toFixed();\n        obj[template.query.mapj] = map.getSize().divideBy(2).y.toFixed();\n\n        obj[template.query.pixelleft] = crs.pointToLatLng(tcrsClickLoc, zoom).lng;\n        obj[template.query.pixeltop] = crs.pointToLatLng(tcrsClickLoc, zoom).lat;\n        obj[template.query.pixelright] = crs.pointToLatLng(\n          tcrsClickLoc.add([1, 1]),\n          zoom\n        ).lng;\n        obj[template.query.pixelbottom] = crs.pointToLatLng(\n          tcrsClickLoc.add([1, 1]),\n          zoom\n        ).lat;\n\n        obj[template.query.column] = tileMatrixClickLoc.x;\n        obj[template.query.row] = tileMatrixClickLoc.y;\n        obj[template.query.x] = tcrsClickLoc.x.toFixed();\n        obj[template.query.y] = tcrsClickLoc.y.toFixed();\n\n        // whereas the layerPoint is calculated relative to the origin plus / minus any\n        // pan movements so is equal to containerPoint at first before any pans, but\n        // changes as the map pans.\n        obj[template.query.easting] = tcrs2pcrs(tcrsClickLoc).x;\n        obj[template.query.northing] = tcrs2pcrs(tcrsClickLoc).y;\n        obj[template.query.longitude] = tcrs2gcrs(tcrsClickLoc).lng;\n        obj[template.query.latitude] = tcrs2gcrs(tcrsClickLoc).lat;\n        obj[template.query.zoom] = zoom;\n        obj[template.query.width] = map.getSize().x;\n        obj[template.query.height] = map.getSize().y;\n        // assumes the click is at the centre of the map, per template.query.mapi, mapj above\n        obj[template.query.mapbottom] = tcrs2pcrs(\n          tcrsClickLoc.add(map.getSize().divideBy(2))\n        ).y;\n        obj[template.query.mapleft] = tcrs2pcrs(\n          tcrsClickLoc.subtract(map.getSize().divideBy(2))\n        ).x;\n        obj[template.query.maptop] = tcrs2pcrs(\n          tcrsClickLoc.subtract(map.getSize().divideBy(2))\n        ).y;\n        obj[template.query.mapright] = tcrs2pcrs(\n          tcrsClickLoc.add(map.getSize().divideBy(2))\n        ).x;\n\n        obj[template.query.tilebottom] = tcrs2pcrs(tileBounds.max).y;\n        obj[template.query.tileleft] = tcrs2pcrs(tileBounds.min).x;\n        obj[template.query.tiletop] = tcrs2pcrs(tileBounds.min).y;\n        obj[template.query.tileright] = tcrs2pcrs(tileBounds.max).x;\n        // add hidden or other variables that may be present into the values to\n        // be processed by L.Util.template below.\n        for (var v in template.query) {\n          if (\n            [\n              'mapi',\n              'mapj',\n              'tilei',\n              'tilej',\n              'row',\n              'col',\n              'x',\n              'y',\n              'easting',\n              'northing',\n              'longitude',\n              'latitude',\n              'width',\n              'height',\n              'zoom',\n              'mapleft',\n              'mapright',\n              ',maptop',\n              'mapbottom',\n              'tileleft',\n              'tileright',\n              'tiletop',\n              'tilebottom',\n              'pixeltop',\n              'pixelbottom',\n              'pixelleft',\n              'pixelright'\n            ].indexOf(v) < 0\n          ) {\n            obj[v] = template.query[v];\n          }\n        }\n\n        if (template.extentBounds.contains(pcrsClick)) {\n          fetches.push(fetchFeatures(template, obj));\n        }\n      }\n      Promise.allSettled(fetches).then((results) => {\n        layer._mapmlFeatures = [];\n        // f is an array of {features[], template}\n\n        for (let f of results) {\n          if (f.status === 'fulfilled') {\n            // create connection between queried <map-feature> and its parent <map-extent>\n            for (let feature of f.value.features) {\n              feature._extentEl = f.value.template._extentEl;\n            }\n            layer._mapmlFeatures = layer._mapmlFeatures.concat(f.value.features);\n          }\n        }\n        if (layer._mapmlFeatures.length > 0)\n          displayFeaturesPopup(layer._mapmlFeatures, e.latlng);\n      });\n\n      function displayFeaturesPopup(features, loc) {\n        if (features.length === 0) return;\n        let f = M.featureLayer(features, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: container,\n          //color: 'yellow',\n          // instead of unprojecting and then projecting and scaling,\n          // a much smarter approach would be to scale at the current\n          // zoom\n          projection: map.options.projection,\n          _leafletLayer: layer,\n          query: true,\n          static: true\n        });\n        f.addTo(map);\n\n        let div = L.DomUtil.create('div', 'mapml-popup-content'),\n          c = L.DomUtil.create('iframe');\n        c.style = 'border: none';\n        c.srcdoc = features[0].querySelector(\n          'map-feature map-properties'\n        ).innerHTML;\n        c.setAttribute('sandbox', 'allow-same-origin allow-forms');\n        div.appendChild(c);\n        // passing a latlng to the popup is necessary for when there is no\n        // geometry / null geometry\n        layer._totalFeatureCount = features.length;\n        layer.bindPopup(div, popupOptions).openPopup(loc);\n        layer.on('popupclose', function () {\n          map.removeLayer(f);\n        });\n        f.showPaginationFeature({\n          i: 0,\n          popup: layer._popup,\n          meta: layer.queryMetas\n        });\n      }\n    }\n  });\n\n  /*\n  MIT License related to portions of M.ContextMenu \n  Copyright (c) 2017 adam.ratcliffe@gmail.com\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the Software), \n  to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \n  and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  */\n  /* global M, KeyboardEvent */\n\n  var ContextMenu = L.Handler.extend({\n    _touchstart: L.Browser.msPointer\n      ? 'MSPointerDown'\n      : L.Browser.pointer\n      ? 'pointerdown'\n      : 'touchstart',\n\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.activeIndex = 0; //current fous index on menu\n      this.excludedIndices = [4, 7]; //menu indexes that are --------\n      this.isRunned = false; //variable for tracking edge case\n      //setting the items in the context menu and their callback functions\n      this._menuItems = {};\n\n      const CTXBACK = 0,\n        CTXFWD = 1,\n        CTXRELOAD = 2,\n        CTXFULLSCR = 3,\n        CTXSPACER1 = 4,\n        CTXCOPY = 5,\n        CTXPASTE = 6,\n        CTXSPACER2 = 7,\n        CTXCNTRLS = 8,\n        CTXDEBUG = 9,\n        CTXVWSRC = 10;\n      this._menuItems.CTXBACK = CTXBACK;\n      this._menuItems.CTXFWD = CTXFWD;\n      this._menuItems.CTXRELOAD = CTXRELOAD;\n      this._menuItems.CTXFULLSCR = CTXFULLSCR;\n      this._menuItems.CTXSPACER1 = CTXSPACER1;\n      this._menuItems.CTXCOPY = CTXCOPY;\n      this._menuItems.CTXPASTE = CTXPASTE;\n      this._menuItems.CTXSPACER2 = CTXSPACER2;\n      this._menuItems.CTXCNTRLS = CTXCNTRLS;\n      this._menuItems.CTXDEBUG = CTXDEBUG;\n      this._menuItems.CTXVWSRC = CTXVWSRC;\n\n      this._items = [\n        {\n          // 0\n          text: M.options.locale.cmBack + ' (<kbd>Alt+Left Arrow</kbd>)',\n          callback: this._goBack\n        },\n        {\n          // 1\n          text: M.options.locale.cmForward + ' (<kbd>Alt+Right Arrow</kbd>)',\n          callback: this._goForward\n        },\n        {\n          // 2\n          text: M.options.locale.cmReload + ' (<kbd>Ctrl+R</kbd>)',\n          callback: this._reload\n        },\n        {\n          // 3\n          text: M.options.locale.btnFullScreen + ' (<kbd>F</kbd>)',\n          callback: this._toggleFullScreen\n        },\n        {\n          // 4\n          spacer: '-'\n        },\n        {\n          // 5\n          text: M.options.locale.cmCopyCoords + ' (<kbd>C</kbd>)<span></span>',\n          callback: this._copyCoords,\n          hideOnSelect: false,\n          popup: true,\n          submenu: [\n            {\n              // 5.0\n              text: M.options.locale.cmCopyMapML,\n              callback: this._copyMapML\n            },\n            {\n              // 5.1\n              text: M.options.locale.cmCopyExtent,\n              callback: this._copyExtent\n            },\n            {\n              // 5.2\n              text: M.options.locale.cmCopyLocation,\n              callback: this._copyLocation\n            }\n          ]\n        },\n        {\n          // 6\n          text: M.options.locale.cmPasteLayer + ' (<kbd>P</kbd>)',\n          callback: this._paste\n        },\n        {\n          // 7\n          spacer: '-'\n        },\n        {\n          // 8\n          text: M.options.locale.cmToggleControls + ' (<kbd>T</kbd>)',\n          callback: this._toggleControls\n        },\n        {\n          // 9\n          text: M.options.locale.cmToggleDebug + ' (<kbd>D</kbd>)',\n          callback: this._toggleDebug\n        },\n        {\n          // 10\n          text: M.options.locale.cmViewSource + ' (<kbd>V</kbd>)',\n          callback: this._viewSource\n        }\n      ];\n\n      // setting the default cs for copying location and extent\n      // should be public as they are used in tests\n      this.defExtCS = M.options.defaultExtCoor;\n      this.defLocCS = M.options.defaultLocCoor;\n      const LYRZOOMTO = 0,\n        LYRCOPY = 1;\n      this._menuItems.LYRZOOMTO = LYRZOOMTO;\n      this._menuItems.LYRCOPY = LYRCOPY;\n      this._layerItems = [\n        {\n          // 0\n          text: M.options.locale.lmZoomToLayer + ' (<kbd>Z</kbd>)',\n          callback: this._zoomToLayer\n        },\n        {\n          // 1\n          text: M.options.locale.lmCopyLayer + ' (<kbd>L</kbd>)',\n          callback: this._copyLayer\n        }\n      ];\n      this._mapMenuVisible = false;\n      this._keyboardEvent = false;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu',\n        map.getContainer()\n      );\n      this._container.setAttribute('hidden', '');\n\n      this._items[CTXBACK].el = this._createItem(\n        this._container,\n        this._items[CTXBACK]\n      );\n      this._items[CTXFWD].el = this._createItem(\n        this._container,\n        this._items[CTXFWD]\n      );\n      this._items[CTXRELOAD].el = this._createItem(\n        this._container,\n        this._items[CTXRELOAD]\n      );\n      this._items[CTXFULLSCR].el = this._createItem(\n        this._container,\n        this._items[CTXFULLSCR]\n      );\n      this._items[CTXSPACER1].el = this._createItem(\n        this._container,\n        this._items[CTXSPACER1]\n      );\n      this._items[CTXCOPY].el = this._createItem(\n        this._container,\n        this._items[CTXCOPY]\n      );\n\n      this._copySubMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-submenu',\n        this._container\n      );\n      this._copySubMenu.id = 'mapml-copy-submenu';\n      this._copySubMenu.setAttribute('hidden', '');\n\n      this._clickEvent = null;\n\n      const CPYMENUMAP = 0,\n        CPYMENUEXTENT = 1,\n        CPYMENULOC = 2;\n      this._menuItems.CPYMENUMAP = CPYMENUMAP;\n      this._menuItems.CPYMENUEXTENT = CPYMENUEXTENT;\n      this._menuItems.CPYMENULOC = CPYMENULOC;\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENUMAP],\n        CPYMENUMAP\n      );\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENUEXTENT],\n        CPYMENUEXTENT\n      );\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENULOC],\n        CPYMENULOC\n      );\n\n      this._items[CTXPASTE].el = this._createItem(\n        this._container,\n        this._items[CTXPASTE]\n      );\n      this._items[CTXSPACER2].el = this._createItem(\n        this._container,\n        this._items[CTXSPACER2]\n      );\n      this._items[CTXCNTRLS].el = this._createItem(\n        this._container,\n        this._items[CTXCNTRLS]\n      );\n      this._items[CTXDEBUG].el = this._createItem(\n        this._container,\n        this._items[CTXDEBUG]\n      );\n      this._items[CTXVWSRC].el = this._createItem(\n        this._container,\n        this._items[CTXVWSRC]\n      );\n\n      this._layerMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-layer-menu',\n        map.getContainer()\n      );\n      this._layerMenu.setAttribute('hidden', '');\n      this._createItem(this._layerMenu, this._layerItems[LYRZOOMTO]);\n      this._createItem(this._layerMenu, this._layerItems[LYRCOPY]);\n\n      L.DomEvent.on(this._container, 'click', L.DomEvent.stop)\n        .on(this._container, 'mousedown', L.DomEvent.stop)\n        .on(this._container, 'dblclick', L.DomEvent.stop)\n        .on(this._container, 'contextmenu', L.DomEvent.stop)\n        .on(this._layerMenu, 'click', L.DomEvent.stop)\n        .on(this._layerMenu, 'mousedown', L.DomEvent.stop)\n        .on(this._layerMenu, 'dblclick', L.DomEvent.stop)\n        .on(this._layerMenu, 'contextmenu', L.DomEvent.stop);\n\n      this.t = document.createElement('template');\n      this.t.innerHTML = `<map-feature zoom=\"\">\n        <map-featurecaption></map-featurecaption>\n        <map-properties>\n            <h2></h2>\n            <div style=\"text-align:center\"></div>\n        </map-properties>\n        <map-geometry cs=\"\">\n          <map-point>\n            <map-coordinates></map-coordinates>\n          </map-point>\n        </map-geometry>\n      </map-feature>`;\n    },\n\n    addHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent.on(container, 'mouseleave', this._hide, this).on(\n        document,\n        'keydown',\n        this._onKeyDown,\n        this\n      );\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.on(\n        {\n          contextmenu: this._show,\n          mousedown: this._hide,\n          zoomstart: this._hide\n        },\n        this\n      );\n    },\n\n    removeHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent.off(container, 'mouseleave', this._hide, this).off(\n        document,\n        'keydown',\n        this._onKeyDown,\n        this\n      );\n\n      if (L.Browser.touch) {\n        L.DomEvent.off(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.off(\n        {\n          contextmenu: this._show,\n          mousedown: this._hide,\n          zoomstart: this._hide\n        },\n        this\n      );\n    },\n\n    _updateCS: function () {\n      if (\n        this.defExtCS !== M.options.defaultExtCoor ||\n        this.defLocCS !== M.options.defaultLocCoor\n      ) {\n        this.defExtCS = M.options.defaultExtCoor;\n        this.defLocCS = M.options.defaultLocCoor;\n      }\n    },\n\n    _copyExtent: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        coord = context.defExtCS ? context.defExtCS.toLowerCase() : 'pcrs',\n        tL =\n          e instanceof KeyboardEvent\n            ? this.extent.topLeft[coord]\n            : this.options.mapEl.extent.topLeft[coord],\n        bR =\n          e instanceof KeyboardEvent\n            ? this.extent.bottomRight[coord]\n            : this.options.mapEl.extent.bottomRight[coord],\n        data = '';\n      switch (coord) {\n        case 'MapML':\n        default:\n          if (coord === 'pcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-easting=${Math.round(\n            tL.horizontal\n          )}, top-left-northing=${Math.round(\n            tL.vertical\n          )}, bottom-right-easting=${Math.round(\n            bR.horizontal\n          )}, bottom-right-northing=${Math.round(bR.vertical)}\"></map-meta>`;\n          } else if (coord === 'gcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-longitude=${tL.horizontal}, top-left-latitude=${tL.vertical}, bottom-right-longitude=${bR.horizontal}, bottom-right-latitude=${bR.vertical}\"></map-meta>`;\n          } else if (coord === 'tcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-x=${\n            tL[0].horizontal\n          }, top-left-y=${tL[0].vertical}, bottom-right-x=${\n            bR[bR.length - 1].horizontal\n          }, bottom-right-y=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else if (coord === 'tilematrix') {\n            data = `<map-meta name=\"extent\" content=\"top-left-column=${\n            tL[0].horizontal\n          }, top-left-row=${tL[0].vertical}, bottom-right-column=${\n            bR[bR.length - 1].horizontal\n          }, bottom-right-row=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else {\n            console.log('not support');\n          }\n          break;\n      }\n      context._copyData(data);\n    },\n\n    _zoomToLayer: function (e) {\n      let context =\n        e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu;\n      context._layerClicked.layer._layerEl.zoomTo();\n    },\n\n    _copyLayer: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        layerElem = context._layerClicked.layer._layerEl;\n      context._copyData(layerElem.getOuterHTML());\n    },\n\n    _goForward: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.forward();\n    },\n\n    _goBack: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.back();\n    },\n\n    _reload: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.reload();\n    },\n\n    _toggleFullScreen: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl._toggleFullScreen();\n    },\n\n    _toggleControls: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      if (mapEl.controls) {\n        mapEl.controls = false;\n      } else {\n        mapEl.controls = true;\n      }\n    },\n\n    _copyMapML: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl =\n          e instanceof KeyboardEvent\n            ? this._map.options.mapEl\n            : this.options.mapEl;\n      context._copyData(\n        mapEl.outerHTML.replace(\n          /<div class=\"mapml-web-map\">.*?<\\/div>|<style>\\[is=\"web-map\"].*?<\\/style>|<style>mapml-viewer.*?<\\/style>/gm,\n          ''\n        )\n      );\n    },\n\n    // Add support for pasting GeoJSON in the future\n    _paste: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl =\n          e instanceof KeyboardEvent\n            ? this._map.options.mapEl\n            : this.options.mapEl;\n      navigator.clipboard.readText().then((layer) => {\n        M._pasteLayer(mapEl, layer);\n      });\n    },\n\n    _viewSource: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.viewSource();\n    },\n\n    _toggleDebug: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.toggleDebug();\n    },\n\n    _copyCoords: function (e) {\n      let directory = this.contextMenu ? this.contextMenu : this;\n      directory._showCopySubMenu(e);\n    },\n\n    _copyData: function (data) {\n      const el = document.createElement('textarea');\n      el.value = data;\n      document.body.appendChild(el);\n      el.select();\n      document.execCommand('copy');\n      document.body.removeChild(el);\n    },\n\n    _copyLocation: function (e) {\n      const menu = this.contextMenu;\n      switch (menu.defLocCS.toLowerCase()) {\n        case 'tile':\n          menu._copyTile.call(this, e);\n          break;\n        case 'tilematrix':\n          menu._copyTileMatrix.call(this, e);\n          break;\n        case 'map':\n          menu._copyMap.call(this, e);\n          break;\n        case 'tcrs':\n          menu._copyTCRS.call(this, e);\n          break;\n        case 'pcrs':\n          menu._copyPCRS.call(this, e);\n          break;\n        case 'gcrs':\n        default:\n          menu._copyGCRS.call(this, e);\n          break;\n      }\n    },\n\n    _copyGCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} gcrs location`;\n      h2.textContent = `Copied ${projection} gcrs location`;\n      div.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        pt = { x: point.x.toFixed(), y: point.y.toFixed() },\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'tcrs');\n      caption.textContent = `Copied ${projection} tcrs location`;\n      h2.textContent = `Copied ${projection} tcrs location`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${pt.x} ${pt.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTileMatrix: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      div.textContent = `${Math.trunc(point.x / tileSize)} ${Math.trunc(\n      point.y / tileSize\n    )}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyPCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation\n          .untransform(point, scale)\n          .round(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'pcrs');\n      caption.textContent = `Copied ${projection} pcrs location`;\n      h2.textContent = `Copied ${projection} pcrs location`;\n      div.textContent = `${pcrs.x} ${pcrs.y}`;\n      coords.textContent = `${pcrs.x} ${pcrs.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTile: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        // the _map.project method returns pixels, while the _map.crs.project\n        // method returns meters, confusingly:\n        // https://leafletjs.com/reference.html#map-project\n        // https://leafletjs.com/reference.html#crs-project\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointX = point.x % tileSize,\n        pointY = point.y % tileSize,\n        pt = L.point(pointX, pointY).trunc(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      if (pt.x < 0) pt.x += tileSize;\n      if (pt.y < 0) pt.y += tileSize;\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyMap: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        mapPt = click.containerPoint.trunc(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} map location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} map location (not implemented yet)`;\n      div.textContent = `${mapPt.x} ${mapPt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyAllCoords: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointX = point.x % tileSize,\n        pointY = point.y % tileSize,\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale);\n      let allData = `z:${mapEl.zoom}\\n`;\n      allData += `tile: i:${Math.trunc(pointX)}, j:${Math.trunc(pointY)}\\n`;\n      allData += `tilematrix: column:${Math.trunc(\n      point.x / tileSize\n    )}, row:${Math.trunc(point.y / tileSize)}\\n`;\n      allData += `map: i:${Math.trunc(click.containerPoint.x)}, j:${Math.trunc(\n      click.containerPoint.y\n    )}\\n`;\n      allData += `tcrs: x:${Math.trunc(point.x)}, y:${Math.trunc(point.y)}\\n`;\n      allData += `pcrs: easting:${pcrs.x.toFixed(2)}, northing:${pcrs.y.toFixed(\n      2\n    )}\\n`;\n      allData += `gcrs: lon :${click.latlng.lng.toFixed(\n      6\n    )}, lat:${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(allData);\n    },\n\n    _createItem: function (container, options, index) {\n      if (options.spacer) {\n        return this._createSeparator(container, index);\n      }\n\n      var itemCls = 'mapml-contextmenu-item',\n        el = this._insertElementAt('button', itemCls, container, index),\n        callback = this._createEventHandler(\n          el,\n          options.callback,\n          options.context,\n          options.hideOnSelect\n        ),\n        html = '';\n\n      el.innerHTML = html + options.text;\n      el.setAttribute('type', 'button');\n      el.classList.add('mapml-button');\n      if (options.popup) {\n        el.setAttribute('aria-haspopup', 'true');\n        el.setAttribute('aria-expanded', 'false');\n        el.setAttribute('aria-controls', 'mapml-copy-submenu');\n      }\n\n      L.DomEvent.on(el, 'mouseover', this._onItemMouseOver, this)\n        .on(el, 'mouseout', this._onItemMouseOut, this)\n        .on(el, 'mousedown', L.DomEvent.stopPropagation)\n        .on(el, 'click', callback);\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(el, this._touchstart, L.DomEvent.stopPropagation);\n      }\n\n      // Devices without a mouse fire \"mouseover\" on tap, but never mouseout\"\n      if (!L.Browser.pointer) {\n        L.DomEvent.on(el, 'click', this._onItemMouseOut, this);\n      }\n\n      return {\n        id: L.Util.stamp(el),\n        el: el,\n        callback: callback\n      };\n    },\n\n    _createSeparator: function (container, index) {\n      let el = this._insertElementAt(\n        'div',\n        'mapml-contextmenu-separator',\n        container,\n        index\n      );\n\n      return {\n        id: L.Util.stamp(el),\n        el: el\n      };\n    },\n\n    _createEventHandler: function (el, func, context, hideOnSelect) {\n      let parent = this;\n\n      hideOnSelect = hideOnSelect !== undefined ? hideOnSelect : true;\n\n      return function (e) {\n        let map = parent._map,\n          containerPoint = parent._showLocation.containerPoint,\n          layerPoint = map.containerPointToLayerPoint(containerPoint),\n          latlng = map.layerPointToLatLng(layerPoint),\n          relatedTarget = parent._showLocation.relatedTarget,\n          data = {\n            containerPoint: containerPoint,\n            layerPoint: layerPoint,\n            latlng: latlng,\n            relatedTarget: relatedTarget\n          };\n\n        if (hideOnSelect) {\n          parent._hide();\n        }\n\n        if (func) {\n          func.call(context || map, data);\n        }\n\n        parent._map.fire('contextmenu.select', {\n          contextmenu: parent,\n          el: el\n        });\n      };\n    },\n\n    _insertElementAt: function (tagName, className, container, index) {\n      let refEl,\n        el = document.createElement(tagName);\n\n      el.className = className;\n\n      if (index !== undefined) {\n        refEl = container.children[index];\n      }\n\n      if (refEl) {\n        container.insertBefore(el, refEl);\n      } else {\n        container.appendChild(el);\n      }\n\n      return el;\n    },\n\n    _show: function (e) {\n      // don't show a context menu for features\n      if (e.originalEvent.target.closest('.mapml-vector-container')) return;\n      if (this._mapMenuVisible) this._hide();\n      this._clickEvent = e;\n      let elem = e.originalEvent.target;\n      if (elem.closest('fieldset')) {\n        elem = elem.closest('fieldset');\n        elem =\n          elem.className === 'mapml-layer-extent'\n            ? elem\n                .closest('fieldset')\n                .parentNode.parentNode.parentNode.querySelector('span')\n            : elem.querySelector('span');\n        if (!elem.layer.validProjection) return;\n        this._layerClicked = elem;\n        this._layerMenu.removeAttribute('hidden');\n        this._showAtPoint(e.containerPoint, e, this._layerMenu);\n      } else if (\n        elem.classList.contains('leaflet-container') ||\n        elem.classList.contains('mapml-debug-extent') ||\n        elem.tagName === 'path'\n      ) {\n        let layerList = this._map.options.mapEl.layers;\n        this._layerClicked = Array.from(layerList).find((el) => el.checked);\n        // the 'hidden' attribute must be removed before any attempt to get the size of container\n        let pt = e.containerPoint;\n        // this is for firefox, which reports the e.containerPoint as x=0 when you\n        // use a keyboard Shift+F10 to display the context menu; this appears\n        // to be because blink returns a PointerEvent of type==='contextmenu',\n        // while gecko returns an object (for e.originalEvent).\n        if (L.Browser.gecko) {\n          const getCenter = function (el) {\n            let w = el.getBoundingClientRect().width;\n            let h = el.getBoundingClientRect().height;\n            return { x: Number.parseInt(w / 2), y: Number.parseInt(h / 2) };\n          };\n          pt = getCenter(this._map.getContainer());\n        }\n        this._container.removeAttribute('hidden');\n        this._showAtPoint(pt, e, this._container);\n        this._updateCS();\n      }\n      if (e.originalEvent.button === 0 || e.originalEvent.button === -1) {\n        this._keyboardEvent = true;\n        if (this._layerClicked.className.includes('mapml-layer-item')) {\n          let activeEl = document.activeElement;\n          this._elementInFocus = activeEl.shadowRoot.activeElement;\n          this._layerMenuTabs = 1;\n          this._layerMenu.firstChild.focus();\n        } else {\n          this._container.querySelectorAll('button:not([disabled])')[0].focus();\n        }\n      }\n    },\n\n    _showAtPoint: function (pt, data, container) {\n      if (this._items.length) {\n        let event = L.extend(data || {}, { contextmenu: this });\n\n        this._showLocation = {\n          containerPoint: pt\n        };\n\n        if (data && data.relatedTarget) {\n          this._showLocation.relatedTarget = data.relatedTarget;\n        }\n\n        this._setPosition(pt, container);\n\n        if (!this._mapMenuVisible) {\n          container.removeAttribute('hidden');\n          this._mapMenuVisible = true;\n        }\n\n        this._map.fire('contextmenu.show', event);\n      }\n    },\n\n    _hide: function () {\n      if (this._mapMenuVisible) {\n        this._mapMenuVisible = false;\n        this._container.setAttribute('hidden', '');\n        this._copySubMenu.setAttribute('hidden', '');\n        this._layerMenu.setAttribute('hidden', '');\n        this._map.fire('contextmenu.hide', { contextmenu: this });\n        setTimeout(() => this._map._container.focus(), 0);\n        this.activeIndex = 0;\n        this.isRunned = false;\n      }\n    },\n\n    _setPosition: function (pt, container) {\n      let mapSize = this._map.getSize(),\n        containerSize = this._getElementSize(container),\n        anchor;\n\n      if (this._map.options.contextmenuAnchor) {\n        anchor = L.point(this._map.options.contextmenuAnchor);\n        pt = pt.add(anchor);\n      }\n\n      container._leaflet_pos = pt;\n\n      if (pt.x + containerSize.x > mapSize.x) {\n        container.style.left = 'auto';\n        container.style.right =\n          Math.min(\n            Math.max(mapSize.x - pt.x, 0),\n            mapSize.x - containerSize.x - 1\n          ) + 'px';\n      } else {\n        container.style.left = Math.max(pt.x, 0) + 'px';\n        container.style.right = 'auto';\n      }\n\n      if (pt.y + containerSize.y > mapSize.y) {\n        container.style.top = 'auto';\n        container.style.bottom =\n          Math.min(\n            Math.max(mapSize.y - pt.y, 0),\n            mapSize.y - containerSize.y - 1\n          ) + 'px';\n      } else {\n        container.style.top = Math.max(pt.y, 0) + 'px';\n        container.style.bottom = 'auto';\n      }\n    },\n\n    _getElementSize: function (el) {\n      let size = this._size;\n\n      if (!size || this._sizeChanged) {\n        size = {};\n\n        el.style.left = '-999999px';\n        el.style.right = 'auto';\n\n        size.x = el.offsetWidth;\n        size.y = el.offsetHeight;\n\n        el.style.left = 'auto';\n\n        this._sizeChanged = false;\n      }\n\n      return size;\n    },\n\n    // once tab is clicked on the layer menu, change the focus back to the layer control\n    _focusOnLayerControl: function () {\n      this._mapMenuVisible = false;\n      delete this._layerMenuTabs;\n      this._layerMenu.setAttribute('hidden', '');\n      if (this._elementInFocus) {\n        this._elementInFocus.focus();\n      } else {\n        this._layerClicked.parentElement.firstChild.focus();\n      }\n      delete this._elementInFocus;\n    },\n\n    _setActiveItem: function (index) {\n      if (\n        document.activeElement.shadowRoot === null &&\n        this.noActiveEl === true\n      ) {\n        //bug fix when theres no active element\n        this.noActiveEl = false;\n        //setting this._items[9] is just for preventing some diabled index, it will be override by later code.\n        this._items[9].el.el.focus();\n      }\n      if (\n        document.activeElement.shadowRoot.activeElement.innerHTML ===\n        this._items[index].el.el.innerHTML\n      ) {\n        //edge case where pressing shift f10 focuses the first element on contextmenu (if already focused, have to press arrow twice to go down)\n        let next = index + 1;\n        while (this._items[next].el.el.disabled) {\n          next++;\n          if (next >= this._items.length) {\n            next = 0;\n          }\n        }\n        this._setActiveItem(next);\n      } else {\n        if (this.excludedIndices.includes(index)) {\n          // find the next or previous non-excluded item\n          let nextIndex = index + 1;\n          let prevIndex = index - 1;\n          while (\n            this.excludedIndices.includes(nextIndex) ||\n            this._items[nextIndex].el.el.disabled\n          ) {\n            nextIndex++;\n            if (nextIndex >= this._items.length) {\n              nextIndex = 0;\n            }\n          }\n          while (\n            this.excludedIndices.includes(prevIndex) ||\n            this._items[prevIndex].el.el.disabled\n          ) {\n            prevIndex--;\n            if (prevIndex < 0) {\n              prevIndex = this._items.length - 1;\n            }\n          }\n          // set the active item to the next or previous non-excluded item\n          if (this.activeIndex < index) {\n            this._setActiveItem(nextIndex);\n          } else {\n            this._setActiveItem(prevIndex);\n          }\n        } else {\n          // set the focus item\n          this._items[index].el.el.focus();\n          this.activeIndex = index;\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      if (!this._mapMenuVisible || e.key === 'Shift') return;\n\n      if (e.code === 'Enter' || e.code === 'Tab' || e.code.startsWith('Arrow'))\n        e.preventDefault();\n\n      if (e.code === 'ArrowUp' || (e.shiftKey && e.code === 'Tab')) {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          (document.activeElement.shadowRoot === null || //null happens when the focus is on submenu and when mouse hovers on main menu, submenu disappears\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML)\n        ) {\n          //\"map\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML\n        ) {\n          //\"extent\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n        ) {\n          //\"Location\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();\n        } else if (\n          !this._layerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          //\"zoom to layer\" on layermenu\n          this._layerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else {\n          if (this.activeIndex > 0) {\n            let prevIndex = this.activeIndex - 1;\n            while (this._items[prevIndex].el.el.disabled) {\n              prevIndex--;\n              if (prevIndex < 0) {\n                prevIndex = this._items.length - 1;\n              }\n            }\n            this._setActiveItem(prevIndex);\n          } else {\n            this._setActiveItem(this._items.length - 1);\n          }\n        }\n      } else if (e.code === 'ArrowDown' || e.code === 'Tab') {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          (document.activeElement.shadowRoot === null ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML)\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();\n        } else if (\n          !this._layerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          this._layerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else {\n          if (this.activeIndex < this._items.length - 1) {\n            //edge case at index 0\n            if (\n              !this.isRunned &&\n              this.activeIndex === 0 &&\n              !this._items[this.activeIndex].el.el.disabled\n            ) {\n              this._setActiveItem(0);\n              this.isRunned = true;\n            } else {\n              //edge case over\n              let nextIndex = this.activeIndex + 1;\n              while (this._items[nextIndex].el.el.disabled) {\n                nextIndex++;\n                if (nextIndex >= this._items.length) {\n                  nextIndex = 0;\n                }\n              }\n              this._setActiveItem(nextIndex);\n            }\n          } else {\n            let nextIndex = 0;\n            while (this._items[nextIndex].el.el.disabled) {\n              nextIndex++;\n              if (nextIndex >= this._items.length) {\n                nextIndex = 0;\n              }\n            }\n            this._setActiveItem(nextIndex);\n          }\n        }\n      } else if (e.code === 'ArrowRight') {\n        if (\n          document.activeElement.shadowRoot !== null &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML && //'copy'\n          this._copySubMenu.hasAttribute('hidden')\n        ) {\n          this._showCopySubMenu();\n          this._copySubMenu.children[0].focus();\n        } else if (\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML &&\n          !this._copySubMenu.hasAttribute('hidden')\n        ) {\n          this._copySubMenu.children[0].focus();\n        }\n      } else if (e.code === 'ArrowLeft') {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot !== null\n        ) {\n          if (\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUEXTENT]\n                .innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n          ) {\n            this._copySubMenu.setAttribute('hidden', '');\n            this._setActiveItem(this._menuItems.CTXCOPY);\n          }\n        }\n      } else if (e.code === 'Escape') {\n        if (this._layerMenuTabs) {\n          L.DomEvent.stop(e);\n          this._focusOnLayerControl();\n          return;\n        }\n        if (document.activeElement.shadowRoot === null) {\n          this._hide();\n        } else {\n          if (!this._copySubMenu.hasAttribute('hidden')) {\n            if (\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENUMAP]\n                  .innerHTML ||\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENUEXTENT]\n                  .innerHTML ||\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n            ) {\n              this._copySubMenu.setAttribute('hidden', '');\n              this._setActiveItem(this._menuItems.CTXCOPY);\n            }\n          } else {\n            this._hide();\n          }\n        }\n      } else if (\n        e.code !== 'KeyC' &&\n        document.activeElement.shadowRoot.activeElement.innerHTML !==\n          this._items[this._menuItems.CTXCOPY].el.el.innerHTML\n      ) {\n        this._hide();\n      }\n      // using KeyboardEvent.code for its mnemonics and case-independence\n      switch (e.code) {\n        case 'Enter':\n          if (\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML\n          ) {\n            this._copyCoords({\n              latlng: this._map.getCenter()\n            });\n            this._copySubMenu.firstChild.focus();\n          } else {\n            if (\n              this._map._container.parentNode.activeElement.parentNode.classList.contains(\n                'mapml-contextmenu'\n              )\n            )\n              this._map._container.parentNode.activeElement.click();\n          }\n          break;\n        case 'Space':\n          if (\n            this._map._container.parentNode.activeElement.parentNode.classList.contains(\n              'mapml-contextmenu'\n            )\n          )\n            this._map._container.parentNode.activeElement.click();\n          break;\n        case 'KeyC':\n          this._copyCoords({\n            latlng: this._map.getCenter()\n          });\n          this._copySubMenu.firstChild.focus();\n          break;\n        case 'KeyD':\n          this._toggleDebug(e);\n          break;\n        case 'KeyM':\n          this._copyMapML(e);\n          break;\n        case 'KeyL':\n          if (this._layerClicked.className.includes('mapml-layer-item'))\n            this._copyLayer(e);\n          break;\n        case 'KeyF':\n          this._toggleFullScreen(e);\n          break;\n        case 'KeyP':\n          this._paste(e);\n          break;\n        case 'KeyT':\n          this._toggleControls(e);\n          break;\n        case 'KeyV':\n          this._viewSource(e);\n          break;\n        case 'KeyZ':\n          if (this._layerClicked.className.includes('mapml-layer-item')) {\n            this._zoomToLayer(e);\n          }\n          break;\n      }\n    },\n\n    _showCopySubMenu: function (e) {\n      let mapSize = this._map.getSize(),\n        click = this._clickEvent,\n        menu = this._copySubMenu,\n        copyEl = this._items[5].el.el;\n\n      copyEl.setAttribute('aria-expanded', 'true');\n      menu.removeAttribute('hidden');\n\n      const menuWidth = this._container.offsetWidth,\n        menuHeight = this._container.offsetHeight,\n        submenuWidth = menu.offsetWidth;\n      if (click.containerPoint.x + menuWidth + submenuWidth > mapSize.x) {\n        menu.style.left = 'auto';\n        menu.style.right = menuWidth + 'px';\n      } else {\n        menu.style.left = menuWidth + 'px';\n        menu.style.right = 'auto';\n      }\n\n      menu.style.top = 100 - 22 + 'px';\n      menu.style.bottom = 'auto';\n    },\n\n    _hideCopySubMenu: function (e) {\n      if (\n        !e.relatedTarget ||\n        !e.relatedTarget.parentElement ||\n        e.relatedTarget.parentElement.classList.contains('mapml-submenu') ||\n        e.relatedTarget.classList.contains('mapml-submenu')\n      )\n        return;\n      let menu = this._copySubMenu,\n        copyEl = this._items[4].el.el;\n      copyEl.setAttribute('aria-expanded', 'false');\n      menu.setAttribute('hidden', '');\n      this.noActiveEl = true; //variable to keep track of no focus element on contextmenu, bug fix for arrow key navigation\n    },\n\n    _onItemMouseOver: function (e) {\n      L.DomUtil.addClass(e.target || e.srcElement, 'over');\n      if (e.srcElement.innerText === M.options.locale.cmCopyCoords + ' (C)')\n        this._showCopySubMenu(e);\n    },\n\n    _onItemMouseOut: function (e) {\n      L.DomUtil.removeClass(e.target || e.srcElement, 'over');\n      this._hideCopySubMenu(e);\n    },\n\n    toggleContextMenuItem: function (options, state) {\n      options = options.toUpperCase();\n      if (state === 'disabled') {\n        if (options === 'CONTROLS') {\n          this._items[8].el.el.disabled = true;\n        } else if (options === 'BACK') {\n          this._items[0].el.el.disabled = true;\n        } else if (options === 'FORWARD') {\n          this._items[1].el.el.disabled = true;\n        } else if (options === 'RELOAD') {\n          this._items[2].el.el.disabled = true;\n        }\n      } else if (state === 'enabled') {\n        if (options === 'CONTROLS') {\n          this._items[8].el.el.disabled = false;\n        } else if (options === 'BACK') {\n          this._items[0].el.el.disabled = false;\n        } else if (options === 'FORWARD') {\n          this._items[1].el.el.disabled = false;\n        } else if (options === 'RELOAD') {\n          this._items[2].el.el.disabled = false;\n        }\n      }\n    },\n\n    setViewFullScreenInnerHTML: function (options) {\n      if (options === 'view') {\n        this._map.contextMenu._items[3].el.el.innerHTML =\n          M.options.locale.btnFullScreen + ' (<kbd>F</kbd>)';\n      } else if (options === 'exit') {\n        this._map.contextMenu._items[3].el.el.innerHTML =\n          M.options.locale.btnExitFullScreen + ' (<kbd>F</kbd>)';\n      }\n    }\n  });\n\n  var Util = {\n    // _convertAndFormatPCRS returns the converted CRS and formatted pcrsBounds in gcrs, pcrs, tcrs, and tilematrix. Used for setting extent for the map and layer (map.extent, layer.extent).\n    // _convertAndFormatPCRS: L.Bounds, _map, projection -> {...}\n    _convertAndFormatPCRS: function (pcrsBounds, crs, projection) {\n      if (!pcrsBounds || !crs) return {};\n\n      let tcrsTopLeft = [],\n        tcrsBottomRight = [],\n        tileMatrixTopLeft = [],\n        tileMatrixBottomRight = [],\n        tileSize = crs.options.crs.tile.bounds.max.y;\n\n      for (let i = 0; i < crs.options.resolutions.length; i++) {\n        let scale = crs.scale(i),\n          minConverted = crs.transformation.transform(pcrsBounds.min, scale),\n          maxConverted = crs.transformation.transform(pcrsBounds.max, scale);\n\n        tcrsTopLeft.push({\n          horizontal: minConverted.x,\n          vertical: maxConverted.y\n        });\n        tcrsBottomRight.push({\n          horizontal: maxConverted.x,\n          vertical: minConverted.y\n        });\n\n        //converts the tcrs values from earlier to tilematrix\n        tileMatrixTopLeft.push({\n          horizontal: tcrsTopLeft[i].horizontal / tileSize,\n          vertical: tcrsTopLeft[i].vertical / tileSize\n        });\n        tileMatrixBottomRight.push({\n          horizontal: tcrsBottomRight[i].horizontal / tileSize,\n          vertical: tcrsBottomRight[i].vertical / tileSize\n        });\n      }\n\n      //converts the gcrs, I believe it can take any number values from -inf to +inf\n      let unprojectedMin = crs.unproject(pcrsBounds.min),\n        unprojectedMax = crs.unproject(pcrsBounds.max);\n\n      let gcrs = {\n        topLeft: {\n          horizontal: unprojectedMin.lng,\n          vertical: unprojectedMax.lat\n        },\n        bottomRight: {\n          horizontal: unprojectedMax.lng,\n          vertical: unprojectedMin.lat\n        }\n      };\n\n      //formats known pcrs bounds to correct format\n      let pcrs = {\n        topLeft: {\n          horizontal: pcrsBounds.min.x,\n          vertical: pcrsBounds.max.y\n        },\n        bottomRight: {\n          horizontal: pcrsBounds.max.x,\n          vertical: pcrsBounds.min.y\n        }\n      };\n\n      //formats all extent data\n      let extent = {\n        topLeft: {\n          tcrs: tcrsTopLeft,\n          tilematrix: tileMatrixTopLeft,\n          gcrs: gcrs.topLeft,\n          pcrs: pcrs.topLeft\n        },\n        bottomRight: {\n          tcrs: tcrsBottomRight,\n          tilematrix: tileMatrixBottomRight,\n          gcrs: gcrs.bottomRight,\n          pcrs: pcrs.bottomRight\n        }\n      };\n      if (projection) {\n        extent.projection = projection;\n      }\n      return extent;\n    },\n\n    // _extractInputBounds extracts and returns Input Bounds from the provided template\n    // _extractInputBounds: Object -> {zoomBounds: ..., bounds: ...}\n    _extractInputBounds: function (template) {\n      if (!template) return undefined;\n\n      //sets variables with their respective fallback values incase content is missing from the template\n      let inputs = template.values,\n        projection = template.projection || FALLBACK_PROJECTION,\n        value = 0,\n        boundsUnit = FALLBACK_CS;\n      let bounds = this[projection].options.crs.tilematrix.bounds(0),\n        defaultMinZoom = 0,\n        defaultMaxZoom = this[projection].options.resolutions.length - 1,\n        nativeMinZoom = defaultMinZoom,\n        nativeMaxZoom = defaultMaxZoom;\n      let locInputs = false,\n        numberOfAxes = 0;\n      for (let i = 0; i < inputs.length; i++) {\n        switch (inputs[i].getAttribute('type')) {\n          case 'zoom':\n            nativeMinZoom = +(inputs[i].hasAttribute('min') &&\n            !isNaN(+inputs[i].getAttribute('min'))\n              ? inputs[i].getAttribute('min')\n              : defaultMinZoom);\n            nativeMaxZoom = +(inputs[i].hasAttribute('max') &&\n            !isNaN(+inputs[i].getAttribute('max'))\n              ? inputs[i].getAttribute('max')\n              : defaultMaxZoom);\n            value = +inputs[i].getAttribute('value');\n            break;\n          case 'location':\n            if (!inputs[i].getAttribute('max') || !inputs[i].getAttribute('min'))\n              continue;\n            let max = +inputs[i].getAttribute('max'),\n              min = +inputs[i].getAttribute('min');\n            switch (inputs[i].getAttribute('axis').toLowerCase()) {\n              case 'x':\n              case 'longitude':\n              case 'column':\n              case 'easting':\n                boundsUnit = M.axisToCS(\n                  inputs[i].getAttribute('axis').toLowerCase()\n                );\n                bounds.min.x = min;\n                bounds.max.x = max;\n                numberOfAxes++;\n                break;\n              case 'y':\n              case 'latitude':\n              case 'row':\n              case 'northing':\n                boundsUnit = M.axisToCS(\n                  inputs[i].getAttribute('axis').toLowerCase()\n                );\n                bounds.min.y = min;\n                bounds.max.y = max;\n                numberOfAxes++;\n                break;\n            }\n            break;\n        }\n      }\n      if (numberOfAxes >= 2) {\n        locInputs = true;\n      }\n      // min/maxZoom are copied from <meta name=zoom content=\"min=n,max=m>, are *display* range for content\n      // min/maxNativeZoom are received from <input type=zoom min=... max=...>, describe *server* content availability\n      let zoomBounds = {\n        minZoom:\n          template.zoomBounds?.min && !isNaN(+template.zoomBounds.min)\n            ? +template.zoomBounds.min\n            : defaultMinZoom,\n        maxZoom:\n          template.zoomBounds?.max && !isNaN(+template.zoomBounds.max)\n            ? +template.zoomBounds.max\n            : defaultMaxZoom,\n        minNativeZoom: nativeMinZoom,\n        maxNativeZoom: nativeMaxZoom\n      };\n      if (\n        !locInputs &&\n        template.extentPCRSFallback &&\n        template.extentPCRSFallback.bounds\n      ) {\n        bounds = template.extentPCRSFallback.bounds;\n      } else if (locInputs) {\n        bounds = this.boundsToPCRSBounds(bounds, value, projection, boundsUnit);\n      } else {\n        bounds = this[projection].options.crs.pcrs.bounds;\n      }\n      return {\n        zoomBounds: zoomBounds,\n        bounds: bounds\n      };\n    },\n\n    // axisToCS returns the CRS when given the axis:\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToCS: (Axis String) -> (CRS String)\n    axisToCS: function (axis) {\n      try {\n        switch (axis.toLowerCase()) {\n          case 'row':\n          case 'column':\n            return 'TILEMATRIX';\n          case 'i':\n          case 'j':\n            return ['MAP', 'TILE'];\n          case 'x':\n          case 'y':\n            return 'TCRS';\n          case 'latitude':\n          case 'longitude':\n            return 'GCRS';\n          case 'northing':\n          case 'easting':\n            return 'PCRS';\n          default:\n            return FALLBACK_CS;\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // csToAxes takes a given cs and retuns the axes, first horizontal then vertical\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // csToAxes: (CRS String) -> [(horizontal axis String), (Vertical axis String)]\n    csToAxes: function (cs) {\n      try {\n        switch (cs.toLowerCase()) {\n          case 'tilematrix':\n            return ['column', 'row'];\n          case 'map':\n          case 'tile':\n            return ['i', 'j'];\n          case 'tcrs':\n            return ['x', 'y'];\n          case 'gcrs':\n            return ['longitude', 'latitude'];\n          case 'pcrs':\n            return ['easting', 'northing'];\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // axisToXY takes horizontal axis and returns 'x', or takes vertical axis and returns 'y'\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToXY: (Axis String) -> 'x' or 'y'\n    axisToXY: function (axis) {\n      try {\n        switch (axis.toLowerCase()) {\n          case 'i':\n          case 'column':\n          case 'longitude':\n          case 'x':\n          case 'easting':\n            return 'x';\n          case 'row':\n          case 'j':\n          case 'latitude':\n          case 'y':\n          case 'northing':\n            return 'y';\n\n          default:\n            return undefined;\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // convertPCRSBounds converts pcrsBounds to the given cs Bounds.\n    // convertPCRSBounds: L.Bounds, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.Bounds\n    convertPCRSBounds: function (pcrsBounds, zoom, projection, cs) {\n      if (\n        !pcrsBounds ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection ||\n        !cs\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      switch (cs.toUpperCase()) {\n        case 'PCRS':\n          return pcrsBounds;\n        case 'TCRS':\n        case 'TILEMATRIX':\n          let minPixel = projection.transformation.transform(\n              pcrsBounds.min,\n              projection.scale(+zoom)\n            ),\n            maxPixel = projection.transformation.transform(\n              pcrsBounds.max,\n              projection.scale(+zoom)\n            );\n          if (cs.toUpperCase() === 'TCRS') return L.bounds(minPixel, maxPixel);\n          let tileSize = projection.options.crs.tile.bounds.max.x;\n          return L.bounds(\n            L.point(minPixel.x / tileSize, minPixel.y / tileSize),\n            L.point(maxPixel.x / tileSize, maxPixel.y / tileSize)\n          );\n        case 'GCRS':\n          let minGCRS = projection.unproject(pcrsBounds.min),\n            maxGCRS = projection.unproject(pcrsBounds.max);\n          return L.bounds(\n            L.point(minGCRS.lng, minGCRS.lat),\n            L.point(maxGCRS.lng, maxGCRS.lat)\n          );\n        default:\n          return undefined;\n      }\n    },\n\n    // pointToPCRSPoint takes a point, with a projection and cs and converts it to a pcrs L.point/L.latLng\n    //pointToPCRSPoint: L.Point, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.point|L.latLng\n    pointToPCRSPoint: function (point, zoom, projection, cs) {\n      if (\n        !point ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !cs ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      let tileSize = projection.options.crs.tile.bounds.max.x;\n      switch (cs.toUpperCase()) {\n        case 'TILEMATRIX':\n          return M.pixelToPCRSPoint(\n            L.point(point.x * tileSize, point.y * tileSize),\n            zoom,\n            projection\n          );\n        case 'PCRS':\n          return point;\n        case 'TCRS' :\n          return M.pixelToPCRSPoint(point, zoom, projection);\n        case 'GCRS':\n          return projection.project(L.latLng(point.y, point.x));\n        default:\n          return undefined;\n      }\n    },\n\n    // pixelToPCRSPoint takes a pixel L.point, the zoom and projection and returns a L.point in pcrs\n    // pixelToPCRSPoint: L.Point, Int, L.CRS|Str -> L.point\n    pixelToPCRSPoint: function (point, zoom, projection) {\n      if (\n        !point ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return projection.transformation.untransform(point, projection.scale(zoom));\n    },\n\n    // boundsToPCRSBounds converts bounds with projection and cs to PCRS bounds\n    // boundsToPCRSBounds: L.bounds, Int, L.CRS|Str, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.bounds\n    boundsToPCRSBounds: function (bounds, zoom, projection, cs) {\n      if (\n        !bounds ||\n        !bounds.max ||\n        !bounds.min ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection ||\n        !cs\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return L.bounds(\n        M.pointToPCRSPoint(bounds.min, zoom, projection, cs),\n        M.pointToPCRSPoint(bounds.max, zoom, projection, cs)\n      );\n    },\n\n    //L.bounds have fixed point positions, where min is always topleft, max is always bottom right, and the values are always sorted by leaflet\n    //important to consider when working with pcrs where the origin is not topleft but rather bottomleft, could lead to confusion\n    pixelToPCRSBounds: function (bounds, zoom, projection) {\n      if (\n        !bounds ||\n        !bounds.max ||\n        !bounds.min ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return L.bounds(\n        M.pixelToPCRSPoint(bounds.min, zoom, projection),\n        M.pixelToPCRSPoint(bounds.max, zoom, projection)\n      );\n    },\n\n    //meta content is the content attribute of meta\n    // input \"max=5,min=4\" => [[max,5][min,5]]\n    _metaContentToObject: function (input) {\n      if (!input || input instanceof Object) return {};\n      let content = input.split(/\\s+/).join('');\n      let contentArray = {};\n      let stringSplit = content.split(',');\n\n      for (let i = 0; i < stringSplit.length; i++) {\n        let prop = stringSplit[i].split('=');\n        if (prop.length === 2) contentArray[prop[0]] = prop[1];\n      }\n      if (contentArray !== '' && stringSplit[0].split('=').length === 1)\n        contentArray.content = stringSplit[0];\n      return contentArray;\n    },\n\n    // _coordsToArray returns an array of arrays of coordinate pairs\n    // _coordsToArray: (\"1,2,3,4\") -> [[1,2],[3,4]]\n    _coordsToArray: function (containerPoints) {\n      for (\n        var i = 1, pairs = [], coords = containerPoints.split(',');\n        i < coords.length;\n        i += 2\n      ) {\n        pairs.push([parseInt(coords[i - 1]), parseInt(coords[i])]);\n      }\n      return pairs;\n    },\n\n    // _parseStylesheetAsHTML parses map-link and map-style from mapml and inserts them to the container as HTML\n    _parseStylesheetAsHTML: function (mapml, base, container) {\n      if (\n        !(container instanceof Element) ||\n        !mapml ||\n        !mapml.querySelector('map-link[rel=stylesheet],map-style')\n      )\n        return;\n\n      if (base instanceof Element) {\n        base = base.getAttribute('href')\n          ? base.getAttribute('href')\n          : document.URL;\n      } else if (!base || base === '' || base instanceof Object) {\n        return;\n      }\n\n      var ss = [];\n      var stylesheets = mapml.querySelectorAll(\n        'map-link[rel=stylesheet],map-style'\n      );\n      for (var i = 0; i < stylesheets.length; i++) {\n        if (stylesheets[i].nodeName.toUpperCase() === 'MAP-LINK') {\n          var href = stylesheets[i].hasAttribute('href')\n            ? new URL(stylesheets[i].getAttribute('href'), base).href\n            : null;\n          if (href) {\n            if (!container.querySelector(\"link[href='\" + href + \"']\")) {\n              var linkElm = document.createElement('link');\n              linkElm.setAttribute('href', href);\n              linkElm.setAttribute('rel', 'stylesheet');\n              ss.push(linkElm);\n            }\n          }\n        } else {\n          // <map-style>\n          var styleElm = document.createElement('style');\n          styleElm.textContent = stylesheets[i].textContent;\n          ss.push(styleElm);\n        }\n      }\n      // insert <link> or <style> elements after the begining  of the container\n      // element, in document order as copied from original mapml document\n      // note the code below assumes hrefs have been resolved and elements\n      // re-parsed from xml and serialized as html elements ready for insertion\n      for (var s = ss.length - 1; s >= 0; s--) {\n        container.insertAdjacentElement('afterbegin', ss[s]);\n      }\n    },\n\n    // _splitCoordinate splits string coordinates to an array as floating point numbers\n    _splitCoordinate: function (element, index, array) {\n      var a = [];\n      element.split(/\\s+/gim).forEach(M._parseNumber, a);\n      this.push(a);\n    },\n\n    // _parseNumber parses a string as a floating point number, helper function for _splitCoordinate\n    _parseNumber: function (element, index, array) {\n      this.push(parseFloat(element));\n    },\n\n    // _handleLink handles map-a links, when clicked on a map-a link\n    _handleLink: function (link, leafletLayer) {\n      let zoomTo,\n        justPan = false,\n        layer,\n        map = leafletLayer._map,\n        opacity;\n      if (link.type === 'text/html' && link.target !== '_blank') {\n        // all other target values other than blank behave as _top\n        link.target = '_top';\n      } else if (link.type !== 'text/html' && link.url.includes('#')) {\n        let hash = link.url.split('#'),\n          loc = hash[1].split(',');\n        zoomTo = { z: loc[0] || 0, lng: loc[1] || 0, lat: loc[2] || 0 };\n        justPan = !hash[0]; // if the first half of the array is an empty string then the link is just for panning\n        if (['/', '.', '#'].includes(link.url[0])) link.target = '_self';\n      }\n      if (!justPan) {\n        layer = document.createElement('layer-');\n        layer.setAttribute('src', link.url);\n        layer.setAttribute('checked', '');\n        switch (link.target) {\n          case '_blank':\n            if (link.type === 'text/html') {\n              window.open(link.url);\n            } else {\n              postTraversalSetup();\n              map.options.mapEl.appendChild(layer);\n            }\n            break;\n          case '_parent':\n            postTraversalSetup();\n            for (let l of map.options.mapEl.querySelectorAll('layer-'))\n              if (l._layer !== leafletLayer) map.options.mapEl.removeChild(l);\n            map.options.mapEl.appendChild(layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            break;\n          case '_top':\n            window.location.href = link.url;\n            break;\n          default:\n            postTraversalSetup();\n            opacity = leafletLayer._layerEl.opacity;\n            leafletLayer._layerEl.insertAdjacentElement('beforebegin', layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n        }\n      } else if (zoomTo && !link.inPlace && justPan) {\n        leafletLayer._map.options.mapEl.zoomTo(\n          +zoomTo.lat,\n          +zoomTo.lng,\n          +zoomTo.z\n        );\n        if (opacity) layer.opacity = opacity;\n        map.getContainer().focus();\n      }\n\n      function postTraversalSetup() {\n        // when the projection is changed as part of the link traversal process,\n        // it's necessary to set the map viewer's lat, lon and zoom NOW, so that\n        // the promises that are created when the viewer's projection is changed\n        // can use the viewer's lat, lon and zoom properties that were in effect\n        // before the projection change i.e. in the closure for that code\n        // see mapml-viewer / map is=web-map projection attributeChangedCallback\n        // specifically required for use cases like changing projection after\n        // link traversal, e.g. BC link here https://maps4html.org/experiments/linking/features/\n        if (!link.inPlace && zoomTo) updateMapZoomTo(zoomTo);\n        // the layer is newly created, so have to wait until it's fully init'd\n        // before setting properties.\n        layer.whenReady().then(() => {\n          // TODO refactor _setLayerElExtent so that it's invoked automatically\n          // by layer.extent getter TBD.\n          if (!layer.extent) {\n            layer._layer._setLayerElExtent();\n          }\n          // if the map projection isnt' changed by link traversal, it's necessary\n          // to perform pan/zoom operations after the layer is ready\n          if (!link.inPlace && zoomTo)\n            layer.parentElement.zoomTo(+zoomTo.lat, +zoomTo.lng, +zoomTo.z);\n          else if (!link.inPlace) layer.zoomTo();\n          // not sure if this is necessary\n          if (opacity) layer.opacity = opacity;\n          // this is necessary to display the FeatureIndexOverlay, I believe\n          map.getContainer().focus();\n        });\n      }\n\n      function updateMapZoomTo(zoomTo) {\n        // can't use mapEl.zoomTo(...) here, it's too slow!\n        map.options.mapEl.lat = +zoomTo.lat;\n        map.options.mapEl.lon = +zoomTo.lng;\n        map.options.mapEl.zoom = +zoomTo.z;\n      }\n    },\n    getBounds: function (mapml) {\n      if (!mapml) return null;\n      let cs = FALLBACK_CS,\n        projection =\n          (mapml.querySelector('map-meta[name=projection]') &&\n            M._metaContentToObject(\n              mapml\n                .querySelector('map-meta[name=projection]')\n                .getAttribute('content')\n            ).content.toUpperCase()) ||\n          FALLBACK_PROJECTION;\n      try {\n        let meta =\n          mapml.querySelector('map-meta[name=extent]') &&\n          M._metaContentToObject(\n            mapml.querySelector('map-meta[name=extent]').getAttribute('content')\n          );\n\n        let zoom = meta.zoom || 0;\n\n        let metaKeys = Object.keys(meta);\n        for (let i = 0; i < metaKeys.length; i++) {\n          if (!metaKeys[i].includes('zoom')) {\n            cs = M.axisToCS(metaKeys[i].split('-')[2]);\n            break;\n          }\n        }\n        let axes = M.csToAxes(cs);\n        return M.boundsToPCRSBounds(\n          L.bounds(\n            L.point(+meta[`top-left-${axes[0]}`], +meta[`top-left-${axes[1]}`]),\n            L.point(\n              +meta[`bottom-right-${axes[0]}`],\n              +meta[`bottom-right-${axes[1]}`]\n            )\n          ),\n          zoom,\n          projection,\n          cs\n        );\n      } catch (error) {\n        //if error then by default set the layer to osm and bounds to the entire map view\n        return M.boundsToPCRSBounds(\n          M[projection].options.crs.tilematrix.bounds(0),\n          0,\n          projection,\n          cs\n        );\n      }\n    },\n    getZoomBounds: function (mapml, nativeZoom) {\n      if (!mapml) return null;\n      let nMin = 100,\n        nMax = 0,\n        features = mapml.querySelectorAll('map-feature'),\n        meta,\n        projection;\n      for (let i = 0; i < features.length; i++) {\n        let lZoom = +features[i].getAttribute('zoom');\n        if (!features[i].getAttribute('zoom')) lZoom = nativeZoom;\n        nMax = Math.max(nMax, lZoom);\n        nMin = Math.min(nMin, lZoom);\n      }\n      try {\n        projection = M._metaContentToObject(\n          mapml.querySelector('map-meta[name=projection]').getAttribute('content')\n        ).content;\n        meta = M._metaContentToObject(\n          mapml.querySelector('map-meta[name=zoom]').getAttribute('content')\n        );\n      } catch (error) {\n        return {\n          minZoom: 0,\n          maxZoom:\n            M[projection || FALLBACK_PROJECTION].options.resolutions.length - 1,\n          minNativeZoom: nMin,\n          maxNativeZoom: nMax\n        };\n      }\n      return {\n        minZoom: +meta.min,\n        maxZoom: +meta.max,\n        minNativeZoom: nMin,\n        maxNativeZoom: nMax\n      };\n    },\n    // getNativeVariables: returns an object with the native zoom and CS,\n    //                     based on the map-metas that are available within\n    //                     the layer or the fallback default values.\n    // getNativeVariables: mapml-||layer-||null||[map-feature,...] -> {zoom: _, val: _}\n    // mapml can be a mapml- element, layer- element, null, or an array of map-features\n    getNativeVariables: function (mapml) {\n      let nativeZoom, nativeCS;\n      // when mapml is an array of features provided by the query\n      if (\n        mapml.length &&\n        mapml[0].parentElement.parentElement &&\n        mapml[0].parentElement.parentElement.tagName === 'mapml-'\n      ) {\n        let mapmlEl = mapml[0].parentElement.parentElement;\n        nativeZoom =\n          (mapmlEl.querySelector &&\n            mapmlEl.querySelector('map-meta[name=zoom]') &&\n            +M._metaContentToObject(\n              mapmlEl.querySelector('map-meta[name=zoom]').getAttribute('content')\n            ).value) ||\n          0;\n        nativeCS =\n          (mapmlEl.querySelector &&\n            mapmlEl.querySelector('map-meta[name=cs]') &&\n            M._metaContentToObject(\n              mapmlEl.querySelector('map-meta[name=cs]').getAttribute('content')\n            ).content) ||\n          'GCRS';\n      } else {\n        // when mapml is null or a layer-/mapml- element\n        nativeZoom =\n          (mapml.querySelector &&\n            mapml.querySelector('map-meta[name=zoom]') &&\n            +M._metaContentToObject(\n              mapml.querySelector('map-meta[name=zoom]').getAttribute('content')\n            ).value) ||\n          0;\n        nativeCS =\n          (mapml.querySelector &&\n            mapml.querySelector('map-meta[name=cs]') &&\n            M._metaContentToObject(\n              mapml.querySelector('map-meta[name=cs]').getAttribute('content')\n            ).content) ||\n          'GCRS';\n      }\n      return { zoom: nativeZoom, cs: nativeCS };\n    },\n\n    // _gcrsToTileMatrix returns the [column, row] of the tiles at map center. Used for Announce movement for screen readers\n    // _gcrsToTileMatrix: map/mapml-viewer -> [column, row]\n    _gcrsToTileMatrix: function (mapEl) {\n      let point = mapEl._map.project(mapEl._map.getCenter());\n      let tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.y;\n      let column = Math.trunc(point.x / tileSize);\n      let row = Math.trunc(point.y / tileSize);\n      return [column, row];\n    },\n\n    // Pastes text to a mapml-viewer/map element(mapEl), text can be a mapml link, geojson, or a layer-\n    //    used for pasting layers through ctrl+v, drag/drop, and pasting through the contextmenu\n    // _pasteLayer: HTMLElement Str -> None\n    // Effects: append a layer- element to mapEl, if it is valid\n    _pasteLayer: function (mapEl, text) {\n      try {\n        new URL(text);\n        // create a new <layer-> child of the <mapml-viewer> element\n        let l =\n          '<layer- src=\"' +\n          text +\n          '\" label=\"' +\n          M.options.locale.dfLayer +\n          '\" checked=\"\"></layer->';\n        mapEl.insertAdjacentHTML('beforeend', l);\n        mapEl.lastElementChild.whenReady().catch(() => {\n          if (mapEl) {\n            // should invoke lifecyle callbacks automatically by removing it from DOM\n            mapEl.removeChild(mapEl.lastChild);\n          }\n          // garbage collect it\n          l = null;\n        });\n      } catch (err) {\n        text = text\n          .replace(/(<!--.*?-->)|(<!--[\\S\\s]+?-->)|(<!--[\\S\\s]*?$)/g, '')\n          .trim();\n        if (text.slice(0, 7) === '<layer-' && text.slice(-9) === '</layer->') {\n          mapEl.insertAdjacentHTML('beforeend', text);\n        } else if (\n          text.slice(0, 12) === '<map-feature' &&\n          text.slice(-14) === '</map-feature>'\n        ) {\n          let layer =\n            `<layer- label=\"${M.options.locale.dfPastedLayer}\" checked>\n                       <map-meta name='projection' content='${mapEl.projection}'></map-meta>` +\n            text +\n            '</layer->';\n          mapEl.insertAdjacentHTML('beforeend', layer);\n        } else {\n          try {\n            mapEl.geojson2mapml(JSON.parse(text));\n          } catch {\n            console.log('Invalid Input!');\n          }\n        }\n      }\n    },\n\n    // Takes GeoJSON Properties to return an HTML table, helper function\n    //    for geojson2mapml\n    // _properties2Table: geojsonPropertiesOBJ -> HTML Table\n    _properties2Table: function (json) {\n      let table = document.createElement('table');\n\n      // Creating a Table Header\n      let thead = table.createTHead();\n      let row = thead.insertRow();\n      let th1 = document.createElement('th');\n      let th2 = document.createElement('th');\n      th1.appendChild(document.createTextNode('Property name'));\n      th2.appendChild(document.createTextNode('Property value'));\n      th1.setAttribute('role', 'columnheader');\n      th2.setAttribute('role', 'columnheader');\n      th1.setAttribute('scope', 'col');\n      th2.setAttribute('scope', 'col');\n      row.appendChild(th1);\n      row.appendChild(th2);\n\n      // Creating table body and populating it from the JSON\n      let tbody = table.createTBody();\n      for (let key in json) {\n        if (json.hasOwnProperty(key)) {\n          let row = tbody.insertRow();\n          let th = document.createElement('th');\n          let td = document.createElement('td');\n          th.appendChild(document.createTextNode(key));\n          td.appendChild(document.createTextNode(json[key]));\n          th.setAttribute('scope', 'row');\n          td.setAttribute('itemprop', key);\n          row.appendChild(th);\n          row.appendChild(td);\n        }\n      }\n      return table;\n    },\n\n    // Takes bbox array and a x,y coordinate to possibly update the extent, returns extent\n    //    for geojson2mapml\n    // _updateExtent: [min x, min y, max x, max y], x, y -> [min x, min y, max x, max y]\n    _updateExtent: function (bboxExtent, x, y) {\n      if (bboxExtent === {}) {\n        return bboxExtent;\n      }\n      bboxExtent[0] = Math.min(x, bboxExtent[0]);\n      bboxExtent[1] = Math.min(y, bboxExtent[1]);\n      bboxExtent[2] = Math.max(x, bboxExtent[2]);\n      bboxExtent[3] = Math.max(y, bboxExtent[3]);\n      return bboxExtent;\n    },\n\n    // Takes a GeoJSON geojson and an options Object which returns a <layer-> Element\n    // The options object can contain the following:\n    //      label            - String, contains the layer name, if included overrides the default label mapping\n    //      projection       - String, contains the projection of the layer (OSMTILE, WGS84, CBMTILE, APSTILE), defaults to   OSMTILE\n    //      caption          - Function | String, function accepts one argument being the feature object which produces the   featurecaption string OR a string that is the name of the property that will be mapped to featurecaption\n    //      properties       - Function | String | HTMLElement, a function which maps the geojson feature to an HTMLElement   or a string that will be parsed as an HTMLElement or an HTMLElement\n    //      geometryFunction - Function, A function you supply that can add classes, hyperlinks and spans to the created  <map-geometry> element, default would be the plain map-geometry element\n    // geojson2mapml: geojson Object <layer-> [min x, min y, max x, max y] -> <layer->\n    geojson2mapml: function (json, options = {}, layer = null, bboxExtent = {}) {\n      let defaults = {\n        label: null,\n        projection: 'OSMTILE',\n        caption: null,\n        properties: null,\n        geometryFunction: null\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      // If string json is received\n      if (typeof json === 'string') {\n        json = JSON.parse(json);\n      }\n      let geometryType = [\n        'POINT',\n        'LINESTRING',\n        'POLYGON',\n        'MULTIPOINT',\n        'MULTILINESTRING',\n        'MULTIPOLYGON',\n        'GEOMETRYCOLLECTION'\n      ];\n      let jsonType = json.type.toUpperCase();\n      let out = '';\n      let setExtent = false;\n\n      // HTML parser\n      let parser = new DOMParser();\n\n      // initializing layer\n      if (layer === null) {\n        if (!json.bbox) {\n          setExtent = true;\n        }\n        // creating an empty mapml layer\n        let xmlStringLayer =\n          \"<layer- label='' checked><map-meta name='projection' content='\" +\n          options.projection +\n          \"'></map-meta><map-meta name='cs' content='gcrs'></map-meta></layer->\";\n        layer = parser.parseFromString(xmlStringLayer, 'text/html');\n        //console.log(layer)\n        if (options.label !== null) {\n          layer.querySelector('layer-').setAttribute('label', options.label);\n        } else if (json.name) {\n          layer.querySelector('layer-').setAttribute('label', json.name);\n        } else if (json.title) {\n          layer.querySelector('layer-').setAttribute('label', json.title);\n        } else {\n          layer\n            .querySelector('layer-')\n            .setAttribute('label', M.options.locale.dfLayer);\n        }\n      }\n      let point = '<map-point></map-point>';\n      point = parser.parseFromString(point, 'text/html');\n\n      let multiPoint =\n        '<map-multipoint><map-coordinates></map-coordinates></map-multipoint>';\n      multiPoint = parser.parseFromString(multiPoint, 'text/html');\n\n      let linestring =\n        '<map-linestring><map-coordinates></map-coordinates></map-linestring>';\n      linestring = parser.parseFromString(linestring, 'text/html');\n\n      let multilinestring = '<map-multilinestring></map-multilinestring>';\n      multilinestring = parser.parseFromString(multilinestring, 'text/html');\n\n      let polygon = '<map-polygon></map-polygon>';\n      polygon = parser.parseFromString(polygon, 'text/html');\n\n      let multiPolygon = '<map-multipolygon></map-multipolygon>';\n      multiPolygon = parser.parseFromString(multiPolygon, 'text/html');\n\n      let geometrycollection =\n        '<map-geometrycollection></map-geometrycollection>';\n      geometrycollection = parser.parseFromString(\n        geometrycollection,\n        'text/html'\n      );\n\n      let feature =\n        '<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>';\n      feature = parser.parseFromString(feature, 'text/html');\n\n      // Template to add coordinates to Geometries\n      let coords = '<map-coordinates></map-coordinates>';\n      coords = parser.parseFromString(coords, 'text/html');\n\n      //console.log(layer);\n      if (jsonType === 'FEATURECOLLECTION') {\n        // Setting bbox if it exists\n        if (json.bbox) {\n          layer\n            .querySelector('layer-')\n            .insertAdjacentHTML(\n              'afterbegin',\n              \"<map-meta name='extent' content='top-left-longitude=\" +\n                json.bbox[0] +\n                ', top-left-latitude=' +\n                json.bbox[1] +\n                ', bottom-right-longitude=' +\n                json.bbox[2] +\n                ',bottom-right-latitude=' +\n                json.bbox[3] +\n                \"'></map-meta>\"\n            );\n        } else {\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        }\n\n        let features = json.features;\n        //console.log(\"Features length - \" + features.length);\n        for (let l = 0; l < features.length; l++) {\n          M.geojson2mapml(features[l], options, layer, bboxExtent);\n        }\n      } else if (jsonType === 'FEATURE') {\n        let clone_feature = feature.cloneNode(true);\n        let curr_feature = clone_feature.querySelector('map-feature');\n\n        // Setting bbox if it exists\n        if (json.bbox) {\n          layer\n            .querySelector('layer-')\n            .insertAdjacentHTML(\n              'afterbegin',\n              \"<map-meta name='extent' content='top-left-longitude=\" +\n                json.bbox[0] +\n                ', top-left-latitude=' +\n                json.bbox[1] +\n                ', bottom-right-longitude=' +\n                json.bbox[2] +\n                ',bottom-right-latitude=' +\n                json.bbox[3] +\n                \"'></map-meta>\"\n            );\n        } else if (\n          typeof bboxExtent === 'object' &&\n          bboxExtent.length === undefined\n        ) {\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        }\n\n        // Setting featurecaption\n        let featureCaption = layer.querySelector('layer-').getAttribute('label');\n        if (typeof options.caption === 'function') {\n          featureCaption = options.caption(json);\n        } else if (typeof options.caption === 'string') {\n          featureCaption = json.properties[options.caption];\n          // if property does not exist\n          if (featureCaption === undefined) {\n            featureCaption = options.caption;\n          }\n        } else if (json.id) {\n          // when no caption option available try setting id as featurecaption\n          featureCaption = json.id;\n        }\n        curr_feature.querySelector('map-featurecaption').innerHTML =\n          featureCaption;\n\n        // Setting Properties\n        let p;\n        // if properties function is passed\n        if (typeof options.properties === 'function') {\n          p = options.properties(json);\n          // if function output is not an element, ignore the properties.\n          if (!(p instanceof Element)) {\n            p = false;\n            console.error(\n              'options.properties function returns a string instead of an HTMLElement.'\n            );\n          }\n        } else if (typeof options.properties === 'string') {\n          // if properties string is passed\n          curr_feature\n            .querySelector('map-properties')\n            .insertAdjacentHTML('beforeend', options.properties);\n          p = false;\n        } else if (options.properties instanceof HTMLElement) {\n          // if an HTMLElement is passed - NOT TESTED\n          p = options.properties;\n        } else {\n          // If no properties function, string or HTMLElement is passed\n          p = M._properties2Table(json.properties);\n        }\n\n        if (p) {\n          curr_feature.querySelector('map-properties').appendChild(p);\n        }\n\n        // Setting map-geometry\n        let g = M.geojson2mapml(json.geometry, options, layer, bboxExtent);\n        if (typeof options.geometryFunction === 'function') {\n          curr_feature\n            .querySelector('map-geometry')\n            .appendChild(options.geometryFunction(g, json));\n        } else {\n          curr_feature.querySelector('map-geometry').appendChild(g);\n        }\n\n        // Appending feature to layer\n        layer.querySelector('layer-').appendChild(curr_feature);\n      } else if (geometryType.includes(jsonType)) {\n        //console.log(\"Geometry Type - \" + jsonType);\n        switch (jsonType) {\n          case 'POINT':\n            bboxExtent = M._updateExtent(\n              bboxExtent,\n              json.coordinates[0],\n              json.coordinates[1]\n            );\n            out = json.coordinates[0] + ' ' + json.coordinates[1];\n\n            // Create Point element\n            let clone_point = point.cloneNode(true);\n            clone_point = clone_point.querySelector('map-point');\n\n            // Create map-coords to add to the polygon\n            let clone_coords = coords.cloneNode(true);\n            clone_coords = clone_coords.querySelector('map-coordinates');\n\n            clone_coords.innerHTML = out;\n\n            clone_point.appendChild(clone_coords);\n            //console.log(clone_point);\n            return clone_point;\n\n          case 'LINESTRING':\n            let clone_linestring = linestring.cloneNode(true);\n            let linestring_coordindates =\n              clone_linestring.querySelector('map-coordinates');\n\n            out = '';\n\n            for (let x = 0; x < json.coordinates.length; x++) {\n              bboxExtent = M._updateExtent(\n                bboxExtent,\n                json.coordinates[x][0],\n                json.coordinates[x][1]\n              );\n              out =\n                out + json.coordinates[x][0] + ' ' + json.coordinates[x][1] + ' ';\n            }\n\n            linestring_coordindates.innerHTML = out;\n            //console.log(clone_linestring.querySelector('map-linestring'));\n            return clone_linestring.querySelector('map-linestring');\n\n          case 'POLYGON':\n            let clone_polygon = polygon.cloneNode(true);\n            clone_polygon = clone_polygon.querySelector('map-polygon');\n\n            // Going over each coordinates\n            for (let y = 0; y < json.coordinates.length; y++) {\n              let out = '';\n              let clone_coords = coords.cloneNode(true);\n              clone_coords = clone_coords.querySelector('map-coordinates');\n\n              // Going over coordinates for the polygon\n              for (let x = 0; x < json.coordinates[y].length; x++) {\n                bboxExtent = M._updateExtent(\n                  bboxExtent,\n                  json.coordinates[y][x][0],\n                  json.coordinates[y][x][1]\n                );\n                out =\n                  out +\n                  json.coordinates[y][x][0] +\n                  ' ' +\n                  json.coordinates[y][x][1] +\n                  ' ';\n              }\n\n              // Create map-coordinates element and append it to clone_polygon\n              clone_coords.innerHTML = out;\n\n              clone_polygon.appendChild(clone_coords);\n            }\n            //console.log(clone_polygon);\n            return clone_polygon;\n\n          case 'MULTIPOINT':\n            out = '';\n            // Create multipoint element\n            let clone_multipoint = multiPoint.cloneNode(true);\n            clone_multipoint = clone_multipoint.querySelector('map-multipoint');\n\n            for (let i = 0; i < json.coordinates.length; i++) {\n              bboxExtent = M._updateExtent(\n                bboxExtent,\n                json.coordinates[i][0],\n                json.coordinates[i][1]\n              );\n              out =\n                out + json.coordinates[i][0] + ' ' + json.coordinates[i][1] + ' ';\n            }\n            clone_multipoint.querySelector('map-coordinates').innerHTML = out;\n            return clone_multipoint;\n\n          case 'MULTILINESTRING':\n            let clone_multilinestring = multilinestring.cloneNode(true);\n            clone_multilinestring = clone_multilinestring.querySelector(\n              'map-multilinestring'\n            );\n\n            for (let i = 0; i < json.coordinates.length; i++) {\n              let out = '';\n              let clone_coords = coords.cloneNode(true);\n              clone_coords = clone_coords.querySelector('map-coordinates');\n              for (let y = 0; y < json.coordinates[i].length; y++) {\n                bboxExtent = M._updateExtent(\n                  bboxExtent,\n                  json.coordinates[i][y][0],\n                  json.coordinates[i][y][1]\n                );\n                out =\n                  out +\n                  json.coordinates[i][y][0] +\n                  ' ' +\n                  json.coordinates[i][y][1] +\n                  ' ';\n              }\n              clone_coords.innerHTML = out;\n              clone_multilinestring.appendChild(clone_coords);\n            }\n            return clone_multilinestring;\n\n          case 'MULTIPOLYGON':\n            let m = multiPolygon.cloneNode(true);\n            m = m.querySelector('map-multiPolygon');\n\n            // Going over each Polygon\n            for (let i = 0; i < json.coordinates.length; i++) {\n              let clone_polygon = polygon.cloneNode(true);\n              clone_polygon = clone_polygon.querySelector('map-polygon');\n\n              // Going over each coordinates\n              for (let y = 0; y < json.coordinates[i].length; y++) {\n                let out = '';\n                let clone_coords = coords.cloneNode(true);\n                clone_coords = clone_coords.querySelector('map-coordinates');\n\n                // Going over coordinates for the polygon\n                for (let x = 0; x < json.coordinates[i][y].length; x++) {\n                  bboxExtent = M._updateExtent(\n                    bboxExtent,\n                    json.coordinates[i][y][x][0],\n                    json.coordinates[i][y][x][1]\n                  );\n                  out =\n                    out +\n                    json.coordinates[i][y][x][0] +\n                    ' ' +\n                    json.coordinates[i][y][x][1] +\n                    ' ';\n                }\n\n                // Create map-coordinates element and append it to clone_polygon\n                clone_coords.innerHTML = out;\n\n                clone_polygon.appendChild(clone_coords);\n              }\n              m.appendChild(clone_polygon);\n            }\n            return m;\n          case 'GEOMETRYCOLLECTION': // ---------------------------------------------------------------------------\n            let g = geometrycollection.cloneNode(true);\n            g = g.querySelector('map-geometrycollection');\n            //console.log(json.geometries);\n            for (let i = 0; i < json.geometries.length; i++) {\n              let fg = M.geojson2mapml(\n                json.geometries[i],\n                options,\n                layer,\n                bboxExtent\n              );\n              g.appendChild(fg);\n            }\n            return g;\n        }\n      }\n      //Add default bbox\n      if (setExtent) {\n        layer\n          .querySelector('layer-')\n          .insertAdjacentHTML(\n            'afterbegin',\n            \"<map-meta name='extent' content='top-left-longitude=\" +\n              bboxExtent[0] +\n              ', top-left-latitude=' +\n              bboxExtent[1] +\n              ', bottom-right-longitude=' +\n              bboxExtent[2] +\n              ',bottom-right-latitude=' +\n              bboxExtent[3] +\n              \"'></map-meta>\"\n          );\n      }\n      return layer.querySelector('layer-');\n    },\n\n    // Takes an array of length n to return an array of arrays with length 2, helper function\n    //    for mapml2geojson\n    // _breakArray: arr(float) -> arr(arr(float, float))\n    _breakArray: function (arr) {\n      let size = 2;\n      let arrayOfArrays = [];\n      // removing anything other than numbers, ., - (used to remove <map-span> tags)\n      arr = arr.filter((x) => !/[^\\d.-]/g.test(x)).filter((x) => x);\n      for (let i = 0; i < arr.length; i += size) {\n        arrayOfArrays.push(arr.slice(i, i + size).map(Number));\n      }\n      return arrayOfArrays;\n    },\n\n    // Takes an HTML Table to return geojson properties, helper function\n    //    for mapml2geojson\n    // _table2properties: HTML Table -> geojson\n    _table2properties: function (table) {\n      // removing thead, if it exists\n      let head = table.querySelector('thead');\n      if (head !== null) {\n        table.querySelector('thead').remove();\n      }\n      let json = {};\n      table.querySelectorAll('tr').forEach((tr) => {\n        let tableData = tr.querySelectorAll('th, td');\n        json[tableData[0].innerHTML] = tableData[1].innerHTML;\n      });\n      return json;\n    },\n\n    // Converts a geometry element (el) to geojson, helper function\n    //    for mapml2geojson, NOTE - el can not be a map-geometrycollection\n    // _geometry2geojson: (child of <map-geometry>), Proj4, Proj4, Bool -> geojson\n    _geometry2geojson: function (el, source, dest, transform) {\n      // remove map-a, map-span elements if the geometry is wrapped in them\n      while (\n        el.nodeName.toUpperCase() === 'MAP-SPAN' ||\n        el.nodeName.toUpperCase() === 'MAP-A'\n      ) {\n        el = el.firstElementChild;\n      }\n      let elem = el.nodeName;\n      let j = {};\n      let coord;\n\n      switch (elem.toUpperCase()) {\n        case 'MAP-POINT':\n          j.type = 'Point';\n          if (transform) {\n            let pointConv = proj4.transform(\n              source,\n              dest,\n              el\n                .querySelector('map-coordinates')\n                .innerHTML.split(/[<>\\ ]/g)\n                .map(Number)\n            );\n            j.coordinates = [pointConv.x, pointConv.y];\n          } else {\n            j.coordinates = el\n              .querySelector('map-coordinates')\n              .innerHTML.split(/[<>\\ ]/g)\n              .map(Number);\n          }\n          break;\n        case 'MAP-LINESTRING':\n          j.type = 'LineString';\n          coord = el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g);\n          coord = M._breakArray(coord);\n          if (transform) {\n            coord = M._pcrsToGcrs(coord, source, dest);\n          }\n          j.coordinates = coord;\n          break;\n        case 'MAP-POLYGON':\n          j.type = 'Polygon';\n          j.coordinates = [];\n          let x = 0;\n          el.querySelectorAll('map-coordinates').forEach((coord) => {\n            coord = coord.innerHTML.split(/[<>\\ ]/g);\n            coord = M._breakArray(coord);\n            if (transform) {\n              coord = M._pcrsToGcrs(coord, source, dest);\n            }\n            j.coordinates[x] = coord;\n            x++;\n          });\n          break;\n        case 'MAP-MULTIPOINT':\n          j.type = 'MultiPoint';\n          coord = M._breakArray(\n            el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g)\n          );\n          if (transform) {\n            coord = M._pcrsToGcrs(coord, source, dest);\n          }\n          j.coordinates = coord;\n          break;\n        case 'MAP-MULTILINESTRING':\n          j.type = 'MultiLineString';\n          j.coordinates = [];\n          let i = 0;\n          el.querySelectorAll('map-coordinates').forEach((coord) => {\n            coord = coord.innerHTML.split(/[<>\\ ]/g);\n            coord = M._breakArray(coord);\n            if (transform) {\n              coord = M._pcrsToGcrs(coord, source, dest);\n            }\n            j.coordinates[i] = coord;\n            i++;\n          });\n          break;\n        case 'MAP-MULTIPOLYGON':\n          j.type = 'MultiPolygon';\n          j.coordinates = [];\n          let p = 0;\n          el.querySelectorAll('map-polygon').forEach((poly) => {\n            let y = 0;\n            j.coordinates.push([]);\n            poly.querySelectorAll('map-coordinates').forEach((coord) => {\n              coord = coord.innerHTML.split(/[<>\\ ]/g);\n              coord = M._breakArray(coord);\n              if (transform) {\n                coord = M._pcrsToGcrs(coord, source, dest);\n              }\n              j.coordinates[p].push([]);\n              j.coordinates[p][y] = coord;\n              y++;\n            });\n            p++;\n          });\n          break;\n      }\n      return j;\n    },\n\n    // _pcrsToGcrs: arrof([x,y]) Proj4, Proj4 -> arrof[x,y]\n    _pcrsToGcrs: function (arr, source, dest) {\n      let newArr = [];\n      for (let i = 0; i < arr.length; i++) {\n        let conv = proj4.transform(source, dest, arr[i]);\n        conv = [conv.x, conv.y];\n        newArr.push(conv);\n      }\n      return newArr;\n    },\n\n    // Takes an <layer-> element and returns a geojson feature collection object\n    // The options object can contain the following:\n    //      propertyFunction   - function(<map-properties>), A function that maps the features' <map-properties> element to   a GeoJSON \"properties\" member.\n    //      transform          - Bool, Transform coordinates to gcrs values, defaults to True\n    // mapml2geojson: <layer-> Object -> GeoJSON\n    mapml2geojson: function (element, options = {}) {\n      let defaults = {\n        propertyFunction: null,\n        transform: true\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      let json = {};\n      json.type = 'FeatureCollection';\n      json.title = element.getAttribute('label');\n      json.features = [];\n\n      // Transforming Coordinates to gcrs if transformation = true and coordinate is not (EPSG:3857 or EPSG:4326)\n      let source = null;\n      let dest = null;\n      if (options.transform) {\n        source = new proj4.Proj(element.parentElement._map.options.crs.code);\n        dest = new proj4.Proj('EPSG:4326');\n        if (\n          element.parentElement._map.options.crs.code === 'EPSG:3857' ||\n          element.parentElement._map.options.crs.code === 'EPSG:4326'\n        ) {\n          options.transform = false;\n        }\n      }\n\n      // Setting all meta settings, if any\n      let metas = element.querySelectorAll('map-meta');\n      metas.forEach((meta) => {\n        let name = meta.getAttribute('name');\n        if (name === 'extent') {\n          let content = meta.getAttribute('content');\n          let arr = content.split(',');\n          let ex = {};\n          for (let i = 0; i < arr.length; i++) {\n            let s = arr[i].split('=');\n            s[0] = s[0].trim(); // removing whitespace\n            s[1] = parseFloat(s[1]);\n            ex[s[0]] = s[1];\n          }\n          json.bbox = [\n            ex['top-left-longitude'],\n            ex['top-left-latitude'],\n            ex['bottom-right-longitude'],\n            ex['bottom-right-latitude']\n          ];\n        }\n      });\n\n      // Iterating over each feature\n      let features = element.querySelectorAll('map-feature');\n      let num = 0;\n\n      // Going over each feature in the layer\n      features.forEach((feature) => {\n        //console.log(feature);\n\n        json.features[num] = { type: 'Feature' };\n        json.features[num].geometry = {};\n        json.features[num].properties = {};\n\n        // setting properties when function presented\n        if (!feature.querySelector('map-properties')) {\n          json.features[num].properties = null;\n        } else if (typeof options.propertyFunction === 'function') {\n          let properties = options.propertyFunction(\n            feature.querySelector('map-properties')\n          );\n          json.features[num].properties = properties;\n        } else if (\n          feature.querySelector('map-properties').querySelector('table') !== null\n        ) {\n          // setting properties when table presented\n          let table = feature\n              .querySelector('map-properties')\n              .querySelector('table')\n              .cloneNode(true),\n            properties = M._table2properties(table);\n          json.features[num].properties = properties;\n        } else {\n          // when no table present, strip any possible html tags to only get text\n          json.features[num].properties = {\n            prop0: feature\n              .querySelector('map-properties')\n              .innerHTML.replace(/(<([^>]+)>)/gi, '')\n          };\n        }\n\n        let geom = feature.querySelector('map-geometry').firstElementChild;\n\n        // remove map-a, map-span elements if the geometry is wrapped in them\n        while (\n          geom.nodeName.toUpperCase() === 'MAP-SPAN' ||\n          geom.nodeName.toUpperCase() === 'MAP-A'\n        ) {\n          geom = geom.firstElementChild;\n        }\n\n        // Adding Geometry\n        if (geom.nodeName.toUpperCase() !== 'MAP-GEOMETRYCOLLECTION') {\n          json.features[num].geometry = M._geometry2geojson(\n            geom,\n            source,\n            dest,\n            options.transform\n          );\n        } else {\n          json.features[num].geometry.type = 'GeometryCollection';\n          json.features[num].geometry.geometries = [];\n\n          let geoms = geom.children;\n          Array.from(geoms).forEach((g) => {\n            // omit all map-span, map-a that may be present in geometry-collection\n            let n = g.nodeName.toUpperCase();\n            if (n === 'MAP-SPAN' || n === 'MAP-A') {\n              g = g.cloneNode(true);\n              [...g.querySelectorAll('map-a, map-span')].forEach((e) =>\n                e.replaceWith(...e.children)\n              );\n              Array.from(g.children).forEach((i) => {\n                i = M._geometry2geojson(i, source, dest, options.transform);\n                json.features[num].geometry.geometries.push(i);\n              });\n            } else {\n              g = M._geometry2geojson(g, source, dest, options.transform);\n              json.features[num].geometry.geometries.push(g);\n            }\n          });\n        }\n        //going to next feature\n        num++;\n      });\n\n      return json;\n    },\n\n    // Takes leaflet bound, leaflet map and min and max zoom limit,\n    // return the maximum zoom level that can show the bound completely\n    // getMaxZoom: L.Bound, L.Map, Number, Number -> Number\n    getMaxZoom: function (bound, map, minZoom, maxZoom) {\n      if (!bound) return;\n\n      let newZoom = map.getZoom(),\n        scale = map.options.crs.scale(newZoom),\n        mapCenterTCRS = map.options.crs.transformation.transform(\n          bound.getCenter(true),\n          scale\n        );\n\n      let mapHalf = map.getSize().divideBy(2),\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round(),\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n\n      let mapTlPCRSNew = M.pixelToPCRSPoint(\n          mapTlNew,\n          newZoom,\n          map.options.projection\n        ),\n        mapBrPCRSNew = M.pixelToPCRSPoint(\n          mapBrNew,\n          newZoom,\n          map.options.projection\n        );\n\n      let mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew),\n        zOffset = mapPCRS.contains(bound) ? 1 : -1;\n\n      while (\n        (zOffset === -1 && !mapPCRS.contains(bound) && newZoom - 1 >= minZoom) ||\n        (zOffset === 1 && mapPCRS.contains(bound) && newZoom + 1 <= maxZoom)\n      ) {\n        newZoom += zOffset;\n        scale = map.options.crs.scale(newZoom);\n        mapCenterTCRS = map.options.crs.transformation.transform(\n          bound.getCenter(true),\n          scale\n        );\n\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round();\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n        mapTlPCRSNew = M.pixelToPCRSPoint(\n          mapTlNew,\n          newZoom,\n          map.options.projection\n        );\n        mapBrPCRSNew = M.pixelToPCRSPoint(\n          mapBrNew,\n          newZoom,\n          map.options.projection\n        );\n\n        mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew);\n      }\n\n      if (\n        zOffset === 1 &&\n        newZoom - 1 >= 0 &&\n        !(newZoom === maxZoom && mapPCRS.contains(bound))\n      )\n        newZoom--;\n      return newZoom;\n    }\n  };\n\n  var AttributionButton = L.Control.Attribution.extend({\n    options: {\n      prefix:\n        '<img src=\"https://www.w3.org/community/src/templates/wordpress/StoryTeller/favicon.ico\" style=\"position: relative; top: 5px\" alt=\"W3C Community and Business Groups logo\"> <a href=\"https://www.w3.org/community/maps4html/\">Maps for HTML Community Group</a> | <img src=\"data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTIiIGhlaWdodD0iOCI+PHBhdGggZmlsbD0iIzRDN0JFMSIgZD0iTTAgMGgxMnY0SDB6Ii8+PHBhdGggZmlsbD0iI0ZGRDUwMCIgZD0iTTAgNGgxMnYzSDB6Ii8+PHBhdGggZmlsbD0iI0UwQkMwMCIgZD0iTTAgN2gxMnYxSDB6Ii8+PC9zdmc+\" style=\"padding-right: 0.3em;\" alt=\"Slava Ukraini\"> <a href=\"https://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a> '\n    },\n\n    onAdd: function (map) {\n      map.attributionControl = this;\n      this._container = L.DomUtil.create(\n        'details',\n        'leaflet-control-attribution'\n      );\n      L.DomEvent.disableClickPropagation(this._container);\n\n      for (var i in map._layers) {\n        if (map._layers[i].getAttribution) {\n          this.addAttribution(map._layers[i].getAttribution());\n        }\n      }\n\n      this._update();\n\n      map.on('layeradd', this._addAttribution, this);\n\n      let dialog = document.createElement('dialog');\n      dialog.setAttribute('class', 'shortcuts-dialog');\n      dialog.setAttribute('autofocus', '');\n      dialog.onclick = function (e) {\n        e.stopPropagation();\n      };\n      dialog.innerHTML =\n        `<b>${M.options.locale.kbdShortcuts} </b><button aria-label=\"Close\" onclick='this.parentElement.close()'>X</button>` +\n        `<ul><b>${M.options.locale.kbdMovement}</b><li><kbd>&#8593</kbd> ${M.options.locale.kbdPanUp}</li><li><kbd>&#8595</kbd> ${M.options.locale.kbdPanDown}</li><li><kbd>&#8592</kbd> ${M.options.locale.kbdPanLeft}</li><li><kbd>&#8594</kbd> ${M.options.locale.kbdPanRight}</li><li><kbd>+</kbd> ${M.options.locale.btnZoomIn}</li><li><kbd>-</kbd> ${M.options.locale.btnZoomOut}</li><li><kbd>shift</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 3x ${M.options.locale.kbdPanIncrement}</li><li><kbd>ctrl</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 0.2x ${M.options.locale.kbdPanIncrement}</li><li><kbd>shift</kbd> + <kbd>+/-</kbd> ${M.options.locale.kbdZoom}</li></ul>` +\n        `<ul><b>${M.options.locale.kbdFeature}</b><li><kbd>&#8592/&#8593</kbd> ${M.options.locale.kbdPrevFeature}</li><li><kbd>&#8594/&#8595</kbd> ${M.options.locale.kbdNextFeature}</li></ul>`;\n      map._container.appendChild(dialog);\n\n      return this._container;\n    },\n\n    _update: function () {\n      if (!this._map) {\n        return;\n      }\n\n      var attribs = [];\n\n      for (var i in this._attributions) {\n        if (this._attributions[i]) {\n          attribs.push(i);\n        }\n      }\n\n      var prefixAndAttribs = [];\n\n      if (this.options.prefix) {\n        prefixAndAttribs.push(this.options.prefix);\n      }\n      if (attribs.length) {\n        prefixAndAttribs.push(attribs.join(', '));\n      }\n      this._container.innerHTML =\n        `<summary><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" height=\"30px\" viewBox=\"0 0 24 24\" width=\"30px\" fill=\"currentColor\"><path d=\"M0 0h24v24H0V0z\" fill=\"none\"></path><path d=\"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z\"></path></svg></summary>` +\n        '<div class=\"mapml-attribution-container\">' +\n        `<button onclick=\"this.closest(\\'.leaflet-container\\').querySelector(\\'.shortcuts-dialog\\').showModal()\" class=\"shortcuts-button mapml-button\">${M.options.locale.kbdShortcuts}</button> | ` +\n        prefixAndAttribs.join(' <span aria-hidden=\"true\">|</span> ') +\n        '</div>';\n      this._container.setAttribute('role', 'group');\n      this._container.setAttribute(\n        'aria-label',\n        `${M.options.locale.btnAttribution}`\n      );\n    }\n  });\n\n  L.Map.mergeOptions({\n    attributionControl: false,\n    toggleableAttributionControl: true\n  });\n\n  L.Map.addInitHook(function () {\n    if (this.options.toggleableAttributionControl) {\n      new AttributionButton().addTo(this);\n    }\n  });\n\n  var attributionButton = function (options) {\n    return new AttributionButton(options);\n  };\n\n  var ReloadButton = L.Control.extend({\n    options: {\n      position: 'topleft'\n    },\n\n    onAdd: function (map) {\n      let container = L.DomUtil.create('div', 'mapml-reload-button leaflet-bar');\n\n      let link = L.DomUtil.create('button', 'mapml-reload-button', container);\n      link.innerHTML = \"<span aria-hidden='true'>&#x021BA</span>\";\n      link.title = M.options.locale.cmReload;\n      link.setAttribute('type', 'button');\n      link.classList.add('mapml-button');\n      link.setAttribute('aria-label', 'Reload');\n\n      L.DomEvent.disableClickPropagation(link);\n      L.DomEvent.on(link, 'click', L.DomEvent.stop);\n      L.DomEvent.on(link, 'click', this._goReload, this);\n\n      this._reloadButton = link;\n\n      this._updateDisabled();\n      map.on('moveend', this._updateDisabled, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('moveend', this._updateDisabled, this);\n    },\n\n    disable: function () {\n      this._disabled = true;\n      this._updateDisabled();\n      return this;\n    },\n\n    enable: function () {\n      this._disabled = false;\n      this._updateDisabled();\n      return this;\n    },\n\n    _goReload: function (e) {\n      if (!this._disabled && this._map.options.mapEl._history.length > 1) {\n        this._map.options.mapEl.reload();\n      }\n    },\n\n    _updateDisabled: function () {\n      setTimeout(() => {\n        L.DomUtil.removeClass(this._reloadButton, 'leaflet-disabled');\n        this._reloadButton.setAttribute('aria-disabled', 'false');\n\n        if (\n          this._map &&\n          (this._disabled || this._map.options.mapEl._history.length <= 1)\n        ) {\n          L.DomUtil.addClass(this._reloadButton, 'leaflet-disabled');\n          this._reloadButton.setAttribute('aria-disabled', 'true');\n        }\n      }, 0);\n    }\n  });\n\n  var reloadButton = function (options) {\n    return new ReloadButton(options);\n  };\n\n  var ScaleBar = L.Control.Scale.extend({\n    options: {\n      maxWidth: 100,\n      updateWhenIdle: true,\n      position: 'bottomleft'\n    },\n\n    onAdd: function (map) {\n      // create output tag for screenreader to read from\n      let outputScale =\n        \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output-scale'></output>\";\n      map._container.insertAdjacentHTML('beforeend', outputScale);\n\n      // initialize _container\n      this._container = L.DomUtil.create('div', 'mapml-control-scale');\n      let scaleControl = L.Control.Scale.prototype.onAdd.call(this, map);\n      this._container.appendChild(scaleControl);\n      this._container.setAttribute('tabindex', 0);\n      this._scaleControl = this;\n\n      // run on load\n      setTimeout(() => {\n        this._updateOutput();\n        this._focusOutput();\n      }, 0);\n\n      // update whenever map is zoomed or dragged\n      map.on('zoomend moveend', this._updateOutput, this);\n\n      // have screenreader read out everytime the map is focused\n      this._map._container.addEventListener('focus', () => this._focusOutput());\n\n      return this._container;\n    },\n\n    onRemove: function (map) {\n      map.off('zoomend moveend', this._updateOutput, this);\n    },\n\n    getContainer: function () {\n      return this._container;\n    },\n\n    _pixelsToDistance: function (px, units) {\n      let dpi = window.devicePixelRatio * 96; // default dpi\n      if (units === 'metric') {\n        return (px / dpi) * 2.54; // inches to cm\n      }\n      return px / dpi;\n    },\n\n    _scaleLength: function (scale) {\n      let scaleLength = scale.getAttribute('style');\n      let finalLength = parseInt(scaleLength.match(/width:\\s*(\\d+)px/)[1]);\n\n      return finalLength;\n    },\n\n    _focusOutput: function () {\n      setTimeout(() => {\n        let outputFocus = this._map._container.querySelector(\n          '.mapml-screen-reader-output-scale'\n        );\n        outputFocus.textContent = '';\n        setTimeout(() => {\n          outputFocus.textContent = this._container.getAttribute('aria-label');\n        }, 100);\n      }, 0);\n    },\n\n    _updateOutput: function () {\n      let output = '';\n      let scaleLine = this._scaleControl\n        .getContainer()\n        .getElementsByClassName('leaflet-control-scale-line')[0];\n\n      if (this.options.metric) {\n        let distance = parseFloat(\n          this._pixelsToDistance(this._scaleLength(scaleLine), 'metric').toFixed(\n            1\n          )\n        );\n        output = `${distance} centimeters to ${scaleLine.textContent.trim()}`;\n        output = output.replace(/(\\d+)\\s*m\\b/g, '$1 meters');\n        output = output.replace(/ km/g, ' kilometers');\n      } else {\n        let distance = parseFloat(\n          this._pixelsToDistance(\n            this._scaleLength(scaleLine),\n            'imperial'\n          ).toFixed(1)\n        );\n        output = `${distance} inches to ${scaleLine.textContent.trim()}`;\n        output = output.replace(/ft/g, 'feet');\n        output = output.replace(/mi/g, 'miles');\n      }\n\n      this._container.setAttribute('aria-label', output);\n      this._map._container.querySelector(\n        '.mapml-screen-reader-output-scale'\n      ).textContent = output;\n    }\n  });\n  var scaleBar = function (options) {\n    return new ScaleBar(options);\n  };\n\n  var FullscreenButton = L.Control.extend({\n    options: {\n      position: 'topleft',\n      title: {\n        false: 'View Fullscreen',\n        true: 'Exit Fullscreen'\n      }\n    },\n\n    onAdd: function (map) {\n      var container = L.DomUtil.create(\n        'div',\n        'leaflet-control-fullscreen leaflet-bar leaflet-control'\n      );\n\n      this.link = L.DomUtil.create(\n        'a',\n        'leaflet-control-fullscreen-button leaflet-bar-part',\n        container\n      );\n      this.link.href = '#';\n      this.link.setAttribute('role', 'button');\n\n      this._map = map;\n      this._map.on('fullscreenchange', this._toggleTitle, this);\n      this._toggleTitle();\n\n      L.DomEvent.on(this.link, 'click', this._click, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('fullscreenchange', this._toggleTitle, this);\n    },\n\n    _click: function (e) {\n      L.DomEvent.stopPropagation(e);\n      L.DomEvent.preventDefault(e);\n      this._map.toggleFullscreen(this.options);\n    },\n\n    _toggleTitle: function () {\n      this.link.title = this.options.title[this._map.isFullscreen()];\n    }\n  });\n\n  L.Map.include({\n    isFullscreen: function () {\n      return this._isFullscreen || false;\n    },\n\n    toggleFullscreen: function (options) {\n      // the <map> element can't contain a shadow root, so we used a child <div>\n      // <mapml-viewer> can contain a shadow root, so return it directly\n      var mapEl = this.getContainer().getRootNode().host,\n        container = mapEl.nodeName === 'DIV' ? mapEl.parentElement : mapEl;\n      if (this.isFullscreen()) {\n        if (options && options.pseudoFullscreen) {\n          this._disablePseudoFullscreen(container);\n        } else if (document.exitFullscreen) {\n          document.exitFullscreen();\n        } else if (document.mozCancelFullScreen) {\n          document.mozCancelFullScreen();\n        } else if (document.webkitCancelFullScreen) {\n          document.webkitCancelFullScreen();\n        } else if (document.msExitFullscreen) {\n          document.msExitFullscreen();\n        } else {\n          this._disablePseudoFullscreen(container);\n        }\n      } else {\n        if (options && options.pseudoFullscreen) {\n          this._enablePseudoFullscreen(container);\n        } else if (container.requestFullscreen) {\n          container.requestFullscreen();\n        } else if (container.mozRequestFullScreen) {\n          container.mozRequestFullScreen();\n        } else if (container.webkitRequestFullscreen) {\n          container.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n        } else if (container.msRequestFullscreen) {\n          container.msRequestFullscreen();\n        } else {\n          this._enablePseudoFullscreen(container);\n        }\n      }\n      this.getContainer().focus();\n    },\n\n    _enablePseudoFullscreen: function (container) {\n      L.DomUtil.addClass(container, 'leaflet-pseudo-fullscreen');\n      this._setFullscreen(true);\n      this.fire('fullscreenchange');\n    },\n\n    _disablePseudoFullscreen: function (container) {\n      L.DomUtil.removeClass(container, 'leaflet-pseudo-fullscreen');\n      this._setFullscreen(false);\n      this.fire('fullscreenchange');\n    },\n\n    _setFullscreen: function (fullscreen) {\n      this._isFullscreen = fullscreen;\n      var container = this.getContainer().getRootNode().host;\n      if (fullscreen) {\n        L.DomUtil.addClass(container, 'mapml-fullscreen-on');\n      } else {\n        L.DomUtil.removeClass(container, 'mapml-fullscreen-on');\n      }\n      this.invalidateSize();\n    },\n\n    _onFullscreenChange: function (e) {\n      var fullscreenElement =\n          document.fullscreenElement ||\n          document.mozFullScreenElement ||\n          document.webkitFullscreenElement ||\n          document.msFullscreenElement,\n        mapEl = this.getContainer().getRootNode().host,\n        container = mapEl.nodeName === 'DIV' ? mapEl.parentElement : mapEl;\n\n      if (fullscreenElement === container && !this._isFullscreen) {\n        this._setFullscreen(true);\n        this.fire('fullscreenchange');\n      } else if (fullscreenElement !== container && this._isFullscreen) {\n        this._setFullscreen(false);\n        this.fire('fullscreenchange');\n      }\n    }\n  });\n\n  L.Map.mergeOptions({\n    fullscreenControl: false\n  });\n\n  L.Map.addInitHook(function () {\n    if (this.options.fullscreenControl) {\n      this.fullscreenControl = new FullscreenButton(\n        this.options.fullscreenControl\n      );\n      this.addControl(this.fullscreenControl);\n    }\n\n    var fullscreenchange;\n\n    if ('onfullscreenchange' in document) {\n      fullscreenchange = 'fullscreenchange';\n    } else if ('onmozfullscreenchange' in document) {\n      fullscreenchange = 'mozfullscreenchange';\n    } else if ('onwebkitfullscreenchange' in document) {\n      fullscreenchange = 'webkitfullscreenchange';\n    } else if ('onmsfullscreenchange' in document) {\n      fullscreenchange = 'MSFullscreenChange';\n    }\n\n    if (fullscreenchange) {\n      var onFullscreenChange = L.bind(this._onFullscreenChange, this);\n\n      this.whenReady(function () {\n        L.DomEvent.on(document, fullscreenchange, onFullscreenChange);\n      });\n\n      this.on('unload', function () {\n        L.DomEvent.off(document, fullscreenchange, onFullscreenChange);\n      });\n    }\n  });\n\n  var fullscreenButton = function (options) {\n    return new FullscreenButton(options);\n  };\n\n  var GeolocationButton = L.Control.extend({\n    options: {\n      position: 'bottomright'\n    },\n\n    onAdd: function (map) {\n      // customize locate control to focus map after start/stop, so that\n      // featureIndexOverlay is correctly displayed\n      L.Control.CustomLocate = L.Control.Locate.extend({\n        start: function () {\n          L.Control.Locate.prototype.start.call(this);\n          map.getContainer().focus();\n        },\n        stop: function () {\n          L.Control.Locate.prototype.stop.call(this);\n          map.getContainer().focus();\n        }\n      });\n      this.locateControl = new L.Control.CustomLocate({\n        showPopup: false,\n        strings: {\n          title: M.options.locale.btnLocTrackOff\n        },\n        position: this.options.position,\n        locateOptions: {\n          maxZoom: 16\n        }\n      }).addTo(map);\n\n      var container = this.locateControl._container;\n      var button = this.locateControl;\n      var observer = new MutationObserver(function (mutations) {\n        if (\n          container.classList.contains('active') &&\n          container.classList.contains('following')\n        ) {\n          container.firstChild.title = M.options.locale.btnLocTrackOn;\n          button._marker.bindTooltip(M.options.locale.btnMyLocTrackOn, {\n            permanent: true\n          });\n        } else if (container.classList.contains('active')) {\n          container.firstChild.title = M.options.locale.btnLocTrackLastKnown;\n          button._marker.bindTooltip(M.options.locale.btnMyLastKnownLocTrackOn);\n        } else {\n          container.firstChild.title = M.options.locale.btnLocTrackOff;\n        }\n      });\n      var observerConfig = { attributes: true, attributeFilter: ['class'] };\n      observer.observe(container, observerConfig);\n\n      return container;\n    },\n\n    stop: function () {\n      return this.locateControl.stop();\n    }\n  });\n\n  var geolocationButton = function (options) {\n    return new GeolocationButton(options);\n  };\n\n  var Crosshair = L.Layer.extend({\n    onAdd: function (map) {\n      // SVG crosshair design from https://github.com/xguaita/Leaflet.MapCenterCoord/blob/master/src/icons/MapCenterCoordIcon1.svg?short_path=81a5c76\n      // Optimized with SVGOMG: https://jakearchibald.github.io/svgomg/\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><g stroke=\"#fff\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"50.028\" cy=\"50.219\" r=\"3.923\" stroke-width=\"2\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z\"/><path stroke-width=\"3\" d=\"M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z\" color=\"currentColor\" overflow=\"visible\"/></g></svg>`;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-crosshair',\n        map._container\n      );\n      this._container.innerHTML = svgInnerHTML;\n      map.isFocused = false;\n      this._isQueryable = false;\n\n      map.on(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents,\n        this\n      );\n      map.on('popupopen', this._isMapFocused, this);\n      L.DomEvent.on(\n        map._container,\n        'keydown keyup mousedown',\n        this._isMapFocused,\n        this\n      );\n\n      this._addOrRemoveCrosshair();\n    },\n\n    onRemove: function (map) {\n      map.off(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents\n      );\n      map.off('popupopen', this._isMapFocused);\n      L.DomEvent.off(\n        map._container,\n        'keydown keyup mousedown',\n        this._isMapFocused\n      );\n    },\n\n    _toggleEvents: function () {\n      if (this._hasQueryableLayer()) {\n        this._map.on('viewreset move moveend', this._addOrRemoveCrosshair, this);\n      } else {\n        this._map.off('viewreset move moveend', this._addOrRemoveCrosshair, this);\n      }\n      this._addOrRemoveCrosshair();\n    },\n\n    _addOrRemoveCrosshair: function (e) {\n      if (this._hasQueryableLayer()) {\n        this._container.removeAttribute('hidden');\n      } else {\n        this._container.setAttribute('hidden', '');\n      }\n    },\n\n    _addOrRemoveMapOutline: function (e) {\n      let mapContainer = this._map._container;\n      if (this._map.isFocused && !this._outline) {\n        this._outline = L.DomUtil.create('div', 'mapml-outline', mapContainer);\n      } else if (!this._map.isFocused && this._outline) {\n        L.DomUtil.remove(this._outline);\n        delete this._outline;\n      }\n    },\n\n    _hasQueryableLayer: function () {\n      let layers = this._map.options.mapEl.layers;\n      if (this._map.isFocused) {\n        for (let layer of layers) {\n          if (layer.checked && layer._layer.queryable) {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    // TODO: should be merged with the 'mapfocused' event emitted by mapml-viewer and map, not trivial\n    _isMapFocused: function (e) {\n      //set this._map.isFocused = true if arrow buttons are used\n      if (!this._map._container.parentNode.activeElement) {\n        this._map.isFocused = false;\n        return;\n      }\n      let isLeafletContainer =\n        this._map._container.parentNode.activeElement.classList.contains(\n          'leaflet-container'\n        );\n      if (\n        isLeafletContainer &&\n        ['keydown'].includes(e.type) &&\n        e.shiftKey &&\n        e.keyCode === 9\n      ) {\n        this._map.isFocused = false;\n      } else\n        this._map.isFocused =\n          isLeafletContainer && ['keyup', 'keydown'].includes(e.type);\n\n      if (this._map.isFocused) this._map.fire('mapkeyboardfocused');\n      this._addOrRemoveMapOutline();\n      this._addOrRemoveCrosshair();\n    }\n  });\n\n  var crosshair = function (options) {\n    return new Crosshair(options);\n  };\n\n  /**\n   * M.Path is a extension of L.Path that understands mapml feature markup\n   * It converts the markup to the following structure (abstract enough to encompass all feature types) for example:\n   *  this._outlinePath = HTMLElement;\n   *  this._parts = [\n   *    {\n   *      path: HTMLElement,\n   *      rings:[\n   *        {points:[{x:1,y:1}, ...]},\n   *        ...\n   *      ],\n   *      subrings:[\n   *        {points:[{x:2, y:2}, ...], cls:\"Span Class Name\", path: HTMLElement,},\n   *        ...\n   *      ],\n   *      cls:\"className\",\n   *    },\n   *    ...\n   *  ];\n   */\n  var Path = L.Path.extend({\n    /**\n     * Initializes the M.Path\n     * @param {HTMLElement} markup - The markup representation of the feature\n     * @param {Object} options - The options of the feature\n     */\n    initialize: function (markup, options) {\n      this.type = markup.tagName.toUpperCase();\n\n      if (this.type === 'MAP-POINT' || this.type === 'MAP-MULTIPOINT')\n        options.fillOpacity = 1;\n\n      if (options.wrappers.length > 0)\n        options = Object.assign(this._convertWrappers(options.wrappers), options);\n      L.setOptions(this, options);\n\n      this.group = this.options.group;\n      this.options.interactive =\n        this.options.link ||\n        (this.options.properties && this.options.onEachFeature);\n\n      this._parts = [];\n      this._markup = markup;\n      this.options.zoom = markup.getAttribute('zoom') || this.options.nativeZoom;\n\n      this._convertMarkup();\n\n      if (markup.querySelector('map-span') || markup.querySelector('map-a')) {\n        this._generateOutlinePoints();\n      }\n\n      this.isClosed = this._isClosed();\n    },\n\n    /**\n     * Attaches link handler to the sub parts' paths\n     * @param {SVGElement} elem - The element to add listeners to, either path or g elements\n     * @param {Object} link - The link object that contains the url, type and target data\n     * @param leafletLayer\n     */\n    attachLinkHandler: function (elem, link, leafletLayer) {\n      let dragStart,\n        container = document.createElement('div'),\n        p = document.createElement('p'),\n        hovered = false;\n      container.classList.add('mapml-link-preview');\n      container.appendChild(p);\n      elem.classList.add('map-a');\n      if (link.visited) elem.classList.add('map-a-visited');\n      elem.mousedown = (e) => (dragStart = { x: e.clientX, y: e.clientY });\n      L.DomEvent.on(elem, 'mousedown', elem.mousedown, this);\n      elem.mouseup = (e) => {\n        if (e.button !== 0) return; // don't trigger when button isn't left click\n        let onTop = true,\n          nextLayer = this.options._leafletLayer._layerEl.nextElementSibling;\n        while (nextLayer && onTop) {\n          if (nextLayer.tagName && nextLayer.tagName.toUpperCase() === 'LAYER-')\n            onTop = !(\n              nextLayer.checked &&\n              nextLayer._layer &&\n              nextLayer._layer.queryable\n            );\n          nextLayer = nextLayer.nextElementSibling;\n        }\n        if (onTop && dragStart) {\n          //M._handleLink gets called twice, once in the target phase on the path\n          //element, then in the bubble phase on the g element\n          //Using stopPropagation leaves the mouse in the mousedown state\n          if (e.eventPhase === Event.BUBBLING_PHASE) return;\n          let dist = Math.sqrt(\n            Math.pow(dragStart.x - e.clientX, 2) +\n              Math.pow(dragStart.y - e.clientY, 2)\n          );\n          if (dist <= 5) {\n            link.visited = true;\n            elem.setAttribute('stroke', '#6c00a2');\n            elem.classList.add('map-a-visited');\n            M._handleLink(link, leafletLayer);\n          }\n        }\n      };\n      L.DomEvent.on(elem, 'mouseup', elem.mouseup, this);\n      L.DomEvent.on(\n        elem,\n        'keypress',\n        (e) => {\n          L.DomEvent.stop(e);\n          if (e.keyCode === 13 || e.keyCode === 32) {\n            link.visited = true;\n            elem.setAttribute('stroke', '#6c00a2');\n            elem.classList.add('map-a-visited');\n            M._handleLink(link, leafletLayer);\n          }\n        },\n        this\n      );\n      L.DomEvent.on(\n        elem,\n        'mouseenter keyup',\n        (e) => {\n          if (e.target !== e.currentTarget) return;\n          hovered = true;\n          let resolver = document.createElement('a'),\n            mapWidth = this._map.getContainer().clientWidth;\n          resolver.href = link.url;\n          p.innerHTML = resolver.href;\n\n          this._map.getContainer().appendChild(container);\n\n          while (p.clientWidth > mapWidth / 2) {\n            p.innerHTML =\n              p.innerHTML.substring(0, p.innerHTML.length - 5) + '...';\n          }\n          setTimeout(() => {\n            if (hovered) p.innerHTML = resolver.href;\n          }, 1000);\n        },\n        this\n      );\n      L.DomEvent.on(\n        elem,\n        'mouseout keydown mousedown',\n        (e) => {\n          if (e.target !== e.currentTarget || !container.parentElement) return;\n          hovered = false;\n          this._map.getContainer().removeChild(container);\n        },\n        this\n      );\n      leafletLayer.on('add', addMouseHandler, leafletLayer);\n      function handleMouse(e) {\n        //adds a lot of event handlers\n        if (!container.parentElement) return;\n        hovered = false;\n        this._map.getContainer().removeChild(container);\n      }\n      function addMouseHandler() {\n        L.DomEvent.on(\n          this._map.getContainer(),\n          'mouseout mouseenter click',\n          handleMouse,\n          this\n        );\n      }\n      leafletLayer.on('remove', removeMouseHandler, leafletLayer);\n      function removeMouseHandler() {\n        L.DomEvent.off(this._map.getContainer(), {\n          mouseout: handleMouse,\n          mouseenter: handleMouse,\n          click: handleMouse\n        });\n      }\n    },\n\n    /**\n     * Updates internal structure of the feature to the new map state, the structure can be found in this._parts\n     * @param {L.Map} addedMap - The map that the feature is part of, can be left blank in the case of static features\n     * @param {L.Point} tileOrigin - The tile origin for the feature, if blank then it takes the maps pixel origin in the function\n     * @param {int} zoomingTo - The zoom the map is animating to, if left blank then it takes the map zoom, its provided because in templated tiles zoom is delayed\n     * @private\n     */\n    _project: function (addedMap, tileOrigin = undefined, zoomingTo = undefined) {\n      let map = addedMap || this._map,\n        origin = tileOrigin || map.getPixelOrigin(),\n        zoom = zoomingTo === undefined ? map.getZoom() : zoomingTo;\n      for (let p of this._parts) {\n        p.pixelRings = this._convertRing(p.rings, map, origin, zoom);\n        for (let subP of p.subrings) {\n          subP.pixelSubrings = this._convertRing([subP], map, origin, zoom);\n        }\n      }\n      if (!this._outline) return;\n      this.pixelOutline = [];\n      for (let o of this._outline) {\n        this.pixelOutline = this.pixelOutline.concat(\n          this._convertRing(o, map, origin, zoom)\n        );\n      }\n    },\n\n    /**\n     * Converts the PCRS points to pixel points that can be used to create the SVG\n     * @param {L.Point[][]} r - Is the rings of a feature, either the mainParts, subParts or outline\n     * @param {L.Map} map - The map that the feature is part of\n     * @param {L.Point} origin - The origin used to calculate the pixel points\n     * @param {int} zoom - The current zoom level of the map\n     * @returns {L.Point[][]}\n     * @private\n     */\n    _convertRing: function (r, map, origin, zoom) {\n      // TODO: Implement Ramer-Douglas-Peucer Algo for simplifying points\n      let scale = map.options.crs.scale(zoom),\n        parts = [];\n      for (let sub of r) {\n        let interm = [];\n        for (let p of sub.points) {\n          let conv = map.options.crs.transformation.transform(p, scale);\n          interm.push(L.point(conv.x, conv.y)._subtract(origin).round());\n        }\n        parts.push(interm);\n      }\n      return parts;\n    },\n\n    /**\n     * Updates the features\n     * @private\n     */\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updateFeature(this);\n    },\n\n    /**\n     * Converts the map-spans, a and divs around a geometry subtype into options for the feature\n     * @param {HTMLElement[]} elems - The current zoom level of the map\n     * @private\n     */\n    _convertWrappers: function (elems) {\n      if (!elems || elems.length === 0) return;\n      let classList = '',\n        output = {};\n      for (let elem of elems) {\n        if (elem.tagName.toUpperCase() !== 'MAP-A' && elem.className) {\n          classList += `${elem.className} `;\n        } else if (!output.link && elem.getAttribute('href')) {\n          let link = {};\n          link.url = elem.getAttribute('href');\n          if (elem.hasAttribute('target'))\n            link.target = elem.getAttribute('target');\n          if (elem.hasAttribute('type')) link.type = elem.getAttribute('type');\n          if (elem.hasAttribute('inplace')) link.inPlace = true;\n          output.link = link;\n        }\n      }\n      output.className = `${classList} ${this.options.className}`.trim();\n      return output;\n    },\n\n    /**\n     * Converts this._markup to the internal structure of features\n     * @private\n     */\n    _convertMarkup: function () {\n      if (!this._markup) return;\n\n      let attr = this._markup.attributes;\n      this.featureAttributes = {};\n      if (\n        this.options.link &&\n        this._markup.parentElement.tagName.toUpperCase() === 'MAP-A' &&\n        this._markup.parentElement.parentElement.tagName.toUpperCase() !==\n          'MAP-GEOMETRY'\n      )\n        this.featureAttributes.tabindex = '0';\n      for (let i = 0; i < attr.length; i++) {\n        this.featureAttributes[attr[i].name] = attr[i].value;\n      }\n\n      let first = true;\n      for (let c of this._markup.querySelectorAll('map-coordinates')) {\n        //loops through the coordinates of the child\n        let ring = [],\n          subRings = [];\n        this._coordinateToArrays(c, ring, subRings, this.options.className); //creates an array of pcrs points for the main ring and the subparts\n        if (!first && this.type === 'MAP-POLYGON') {\n          this._parts[0].rings.push(ring[0]);\n          if (subRings.length > 0)\n            this._parts[0].subrings = this._parts[0].subrings.concat(subRings);\n        } else if (this.type === 'MAP-MULTIPOINT') {\n          for (let point of ring[0].points.concat(subRings)) {\n            this._parts.push({\n              rings: [{ points: [point] }],\n              subrings: [],\n              cls: `${point.cls || ''} ${this.options.className || ''}`.trim()\n            });\n          }\n        } else {\n          this._parts.push({\n            rings: ring,\n            subrings: subRings,\n            cls: `${this.featureAttributes.class || ''} ${\n            this.options.className || ''\n          }`.trim()\n          });\n        }\n        first = false;\n      }\n    },\n\n    /**\n     * Generates the feature outline, subtracting the map-spans to generate those separately\n     * @private\n     */\n    _generateOutlinePoints: function () {\n      if (\n        this.type === 'MAP-MULTIPOINT' ||\n        this.type === 'MAP-POINT' ||\n        this.type === 'MAP-LINESTRING' ||\n        this.type === 'MAP-MULTILINESTRING'\n      )\n        return;\n\n      this._outline = [];\n      for (let coords of this._markup.querySelectorAll('map-coordinates')) {\n        let nodes = coords.childNodes,\n          cur = 0,\n          tempDiv = document.createElement('div'),\n          nodeLength = nodes.length;\n        for (let i = 0; i < nodes.length; i++) {\n          if (nodes[i].textContent.trim().length === 0) {\n            nodes[i].remove();\n          }\n        }\n        for (let n of nodes) {\n          let line = [];\n          if (!n.tagName) {\n            //no tagName means it's text content\n            let c = '',\n              ind = (((cur - 1) % nodes.length) + nodes.length) % nodes.length; // this equation turns Javascript's % to how it behaves in C for example\n            if (nodes[ind].tagName) {\n              let prev = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${prev[prev.length - 2]} ${prev[prev.length - 1]} `;\n            }\n            c += n.textContent;\n            ind = (((cur + 1) % nodes.length) + nodes.length) % nodes.length; // this is equivalent to C/C++'s (cur + 1) % nodes.length\n            if (nodes[ind].tagName) {\n              let next = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${next[0]} ${next[1]} `;\n            }\n            tempDiv.innerHTML = c;\n            this._coordinateToArrays(\n              tempDiv,\n              line,\n              [],\n              true,\n              this.featureAttributes.class || this.options.className\n            );\n            this._outline.push(line);\n          }\n          cur++;\n        }\n      }\n    },\n\n    /**\n     * Converts map-coordinates element to an object representing the parts and subParts\n     * @param {HTMLElement} coords - A single map-coordinates element\n     * @param {Object[]} main - An empty array representing the main parts\n     * @param {Object[]} subParts - An empty array representing the sub parts\n     * @param {boolean} isFirst - A true | false representing if the current HTML element is the parent map-coordinates element or not\n     * @param {string} cls - The class of the coordinate/span\n     * @param parents\n     * @private\n     */\n    _coordinateToArrays: function (\n      coords,\n      main,\n      subParts,\n      isFirst = true,\n      cls = undefined,\n      parents = []\n    ) {\n      for (let span of coords.children) {\n        this._coordinateToArrays(\n          span,\n          main,\n          subParts,\n          false,\n          span.getAttribute('class'),\n          parents.concat([span])\n        );\n      }\n      let noSpan = coords.textContent.replace(/(<([^>]+)>)/gi, ''),\n        pairs = noSpan.match(/(\\S+\\s+\\S+)/gim),\n        local = [],\n        bounds;\n      for (let p of pairs) {\n        let numPair = [];\n        p.split(/\\s+/gim).forEach(M._parseNumber, numPair);\n        let point = M.pointToPCRSPoint(\n          L.point(numPair),\n          this.options.zoom,\n          this.options.projection,\n          this.options.nativeCS\n        );\n        local.push(point);\n        bounds = bounds ? bounds.extend(point) : L.bounds(point, point);\n      }\n      if (this._bounds) {\n        this._bounds.extend(bounds.min);\n        this._bounds.extend(bounds.max);\n      } else {\n        this._bounds = bounds;\n      }\n      if (isFirst) {\n        main.push({ points: local });\n      } else {\n        let attrMap = {},\n          attr = coords.attributes,\n          wrapperAttr = this._convertWrappers(parents);\n        if (wrapperAttr.link) attrMap.tabindex = '0';\n        for (let i = 0; i < attr.length; i++) {\n          if (attr[i].name === 'class') continue;\n          attrMap[attr[i].name] = attr[i].value;\n        }\n        subParts.unshift({\n          points: local,\n          center: bounds.getCenter(),\n          cls: `${cls || ''} ${wrapperAttr.className || ''}`.trim(),\n          attr: attrMap,\n          link: wrapperAttr.link,\n          linkTarget: wrapperAttr.linkTarget,\n          linkType: wrapperAttr.linkType\n        });\n      }\n    },\n\n    /**\n     * Returns if the feature is closed or open, useful when styling\n     * @returns {boolean}\n     * @private\n     */\n    _isClosed: function () {\n      switch (this.type) {\n        case 'MAP-POLYGON':\n        case 'MAP-MULTIPOLYGON':\n        case 'MAP-POINT':\n        case 'MAP-MULTIPOINT':\n          return true;\n        case 'MAP-LINESTRING':\n        case 'MAP-MULTILINESTRING':\n          return false;\n        default:\n          return false;\n      }\n    },\n\n    /**\n     * Returns the center of the entire feature\n     * @returns {L.Point}\n     */\n    getCenter: function () {\n      if (!this._bounds) return null;\n      return this._map.options.crs.unproject(this._bounds.getCenter());\n    },\n\n    getPCRSCenter: function () {\n      return this._bounds.getCenter();\n    }\n  });\n\n  /**\n   *\n   * @param {HTMLElement} markup - The markup of the feature\n   * @param {Object} options - Options of the feature\n   * @returns {M.Path}\n   */\n  var path = function (markup, options) {\n    return new Path(markup, options);\n  };\n\n  /**\n   * Returns a new Feature Renderer\n   * @param {Object} options - Options for the renderer\n   * @returns {*}\n   */\n  var FeatureRenderer = L.SVG.extend({\n    /**\n     * Override method of same name from L.SVG, use the this._container property\n     * to set up the role=\"none presentation\" on featureGroupu container,\n     * per this recommendation:\n     * https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/471#issuecomment-845192246\n     * @private overrides ancestor method so that we have a _container to work with\n     */\n    _initContainer: function () {\n      // call the method we're overriding, per https://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      // note you have to pass 'this' as the first arg\n      L.SVG.prototype._initContainer.call(this);\n      // knowing that the previous method call creates the this._container, we\n      // access it and set the role=\"none presetation\" which suppresses the\n      // announcement of \"Graphic\" on each feature focus.\n      this._container.setAttribute('role', 'none presentation');\n    },\n\n    /**\n     * Creates all the appropriate path elements for a M.Path\n     * @param {M.Path} layer - The M.Path that needs paths generated\n     * @param {boolean} stampLayer - Whether or not a layer should be stamped and stored in the renderer layers\n     * @private\n     */\n    _initPath: function (layer, stampLayer = true) {\n      if (layer._outline) {\n        let outlinePath = L.SVG.create('path');\n        if (layer.options.className)\n          L.DomUtil.addClass(\n            outlinePath,\n            layer.featureAttributes.class || layer.options.className\n          );\n        L.DomUtil.addClass(outlinePath, 'mapml-feature-outline');\n        outlinePath.style.fill = 'none';\n        layer.outlinePath = outlinePath;\n      }\n\n      //creates the main parts and sub parts paths\n      for (let p of layer._parts) {\n        if (p.rings) {\n          this._createPath(\n            p,\n            layer.options.className,\n            layer.featureAttributes['aria-label'],\n            layer.options.interactive,\n            layer.featureAttributes\n          );\n          if (layer.outlinePath) p.path.style.stroke = 'none';\n        }\n        if (p.subrings) {\n          for (let r of p.subrings) {\n            this._createPath(\n              r,\n              layer.options.className,\n              r.attr['aria-label'],\n              r.link !== undefined,\n              r.attr\n            );\n          }\n        }\n        this._updateStyle(layer);\n      }\n      if (stampLayer) {\n        let stamp = L.stamp(layer);\n        this._layers[stamp] = layer;\n      }\n    },\n\n    /**\n     * Creates paths for either mainParts, subParts or outline of a feature\n     * @param {Object} ring - The ring the current path is being generated for\n     * @param {string} title - The accessible aria-label of a path\n     * @param {string} cls - The class of the path\n     * @param {boolean} interactive - The boolean representing whether a feature is interactive or not\n     * @param {Object} attr - Attributes map\n     * @private\n     */\n    _createPath: function (\n      ring,\n      cls,\n      title,\n      interactive = false,\n      attr = undefined\n    ) {\n      let p = L.SVG.create('path');\n      ring.path = p;\n      if (!attr) {\n        if (title) p.setAttribute('aria-label', title);\n      } else {\n        for (let [name, value] of Object.entries(attr)) {\n          if (name === 'id' || name === 'tabindex') continue;\n          p.setAttribute(name, value);\n        }\n      }\n      if (ring.cls || cls) {\n        L.DomUtil.addClass(p, ring.cls || cls);\n      }\n      if (interactive) {\n        L.DomUtil.addClass(p, 'leaflet-interactive');\n      }\n    },\n\n    /**\n     * Adds all the paths needed for a feature\n     * @param {M.Path} layer - The feature that needs it's paths added\n     * @param {HTMLElement} container - The location the paths need to be added to\n     * @param {boolean} interactive - Whether a feature is interactive or not\n     * @private\n     */\n    _addPath: function (layer, container = undefined, interactive = true) {\n      if (!this._rootGroup && !container) {\n        this._initContainer();\n      }\n      let c = container || this._rootGroup,\n        outlineAdded = false;\n      if (interactive) {\n        layer.addInteractiveTarget(layer.group);\n      }\n      for (let p of layer._parts) {\n        if (p.path) layer.group.appendChild(p.path);\n        if (interactive) {\n          if (layer.options.link)\n            layer.attachLinkHandler(\n              p.path,\n              layer.options.link,\n              layer.options._leafletLayer\n            );\n          layer.addInteractiveTarget(p.path);\n        }\n\n        if (!outlineAdded && layer.pixelOutline) {\n          layer.group.appendChild(layer.outlinePath);\n          outlineAdded = true;\n        }\n\n        for (let subP of p.subrings) {\n          if (subP.path) {\n            if (subP.link) {\n              layer.attachLinkHandler(\n                subP.path,\n                subP.link,\n                layer.options._leafletLayer\n              );\n              layer.addInteractiveTarget(subP.path);\n            }\n            layer.group.appendChild(subP.path);\n          }\n        }\n      }\n      c.appendChild(layer.group);\n    },\n\n    /**\n     * Removes all the paths related to a feature\n     * @param {M.Path} layer - The feature who's paths need to be removed\n     * @private\n     */\n    _removePath: function (layer) {\n      for (let p of layer._parts) {\n        if (p.path) {\n          layer.removeInteractiveTarget(p.path);\n          L.DomUtil.remove(p.path);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path) L.DomUtil.remove(subP.path);\n        }\n      }\n      if (layer.outlinePath) L.DomUtil.remove(layer.outlinePath);\n      layer.removeInteractiveTarget(layer.group);\n      L.DomUtil.remove(layer.group);\n      delete this._layers[L.stamp(layer)];\n    },\n\n    /**\n     * Updates the d attribute of all paths of a feature\n     * @param {M.Path} layer - The Feature that needs updating\n     * @private\n     */\n    _updateFeature: function (layer) {\n      if (layer.pixelOutline)\n        this._setPath(\n          layer.outlinePath,\n          this.geometryToPath(layer.pixelOutline, false)\n        );\n      for (let p of layer._parts) {\n        this._setPath(p.path, this.geometryToPath(p.pixelRings, layer.isClosed));\n        for (let subP of p.subrings) {\n          this._setPath(\n            subP.path,\n            this.geometryToPath(subP.pixelSubrings, false)\n          );\n        }\n      }\n    },\n\n    /**\n     * Generates the marker d attribute for a given point\n     * @param {L.Point} p - The point of the marker\n     * @returns {string}\n     * @private\n     */\n    _pointToMarker: function (p) {\n      return `M${p.x} ${p.y} L${p.x - 12.5} ${p.y - 30} C${p.x - 12.5} ${\n      p.y - 50\n    }, ${p.x + 12.5} ${p.y - 50}, ${p.x + 12.5} ${p.y - 30} L${p.x} ${p.y}z`;\n    },\n\n    /**\n     * Updates the styles of all paths of a feature\n     * @param {M.Path} layer - The feature that needs styles updated\n     * @private\n     */\n    _updateStyle: function (layer) {\n      this._updatePathStyle(layer.outlinePath, layer, false, true);\n      for (let p of layer._parts) {\n        if (p.path) {\n          this._updatePathStyle(p.path, layer, true);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path) this._updatePathStyle(subP.path, layer);\n        }\n      }\n    },\n\n    /**\n     * Updates the style of a single path\n     * @param {HTMLElement} path - The path that needs updating\n     * @param {M.Path} layer - The feature layer\n     * @param {boolean} isMain - Whether it's the main parts or not\n     * @param {boolean} isOutline - Whether a path is an outline or not\n     * @private\n     */\n    _updatePathStyle: function (path, layer, isMain = false, isOutline = false) {\n      if (!path || !layer) {\n        return;\n      }\n      let options = layer.options,\n        isClosed = layer.isClosed;\n      if (\n        (options.stroke && (!isClosed || isOutline)) ||\n        (isMain && !layer.outlinePath)\n      ) {\n        path.setAttribute('stroke', options.color);\n        path.setAttribute('stroke-opacity', options.opacity);\n        path.setAttribute('stroke-width', options.weight);\n        path.setAttribute('stroke-linecap', options.lineCap);\n        path.setAttribute('stroke-linejoin', options.lineJoin);\n\n        if (options.dashArray) {\n          path.setAttribute('stroke-dasharray', options.dashArray);\n        } else {\n          path.removeAttribute('stroke-dasharray');\n        }\n\n        if (options.dashOffset) {\n          path.setAttribute('stroke-dashoffset', options.dashOffset);\n        } else {\n          path.removeAttribute('stroke-dashoffset');\n        }\n\n        if (options.link) {\n          path.setAttribute(\n            'stroke',\n            options.link.visited ? '#6c00a2' : '#0000EE'\n          );\n          path.setAttribute('stroke-opacity', '1');\n          path.setAttribute('stroke-width', '1px');\n          path.setAttribute('stroke-dasharray', 'none');\n        }\n      } else {\n        path.setAttribute('stroke', 'none');\n      }\n\n      if (isClosed && !isOutline) {\n        if (!options.fill) {\n          path.setAttribute('fill', options.fillColor || options.color);\n          path.setAttribute('fill-opacity', options.fillOpacity);\n          path.setAttribute('fill-rule', options.fillRule || 'evenodd');\n        } else {\n          path.setAttribute('fill', options.color);\n        }\n      } else {\n        path.setAttribute('fill', 'none');\n      }\n    },\n\n    /**\n     * Sets the d attribute of a path\n     * @param {HTMLElement} path - The path that is being updated\n     * @param {string} def - The new d attribute of the path\n     * @private\n     */\n    _setPath: function (path, def) {\n      path.setAttribute('d', def);\n    },\n\n    /**\n     * Generates the d string of a feature part\n     * @param {L.Point[]} rings - The points making up a given part of a feature\n     * @param {boolean} closed - Whether a feature is closed or not\n     * @returns {string}\n     */\n    geometryToPath: function (rings, closed) {\n      let str = '',\n        i,\n        j,\n        len,\n        len2,\n        points,\n        p;\n\n      for (i = 0, len = rings.length; i < len; i++) {\n        points = rings[i];\n        if (points.length === 1) {\n          return this._pointToMarker(points[0]);\n        }\n        for (j = 0, len2 = points.length; j < len2; j++) {\n          p = points[j];\n          str += (j ? 'L' : 'M') + p.x + ' ' + p.y;\n        }\n        str += closed ? 'z' : '';\n      }\n      return str || 'M0 0';\n    }\n  });\n\n  /**\n   * Returns new M.FeatureRenderer\n   * @param {Object} options - Options for the renderer\n   * @returns {M.FeatureRenderer}\n   */\n  var featureRenderer = function (options) {\n    return new FeatureRenderer(options);\n  };\n\n  var Geometry = L.FeatureGroup.extend({\n    /**\n     * Initialize the feature group\n     * @param {M.Path[]} layers\n     * @param {Object} options\n     */\n    initialize: function (layers, options) {\n      if (options.wrappers && options.wrappers.length > 0)\n        options = Object.assign(\n          M.Path.prototype._convertWrappers(options.wrappers),\n          options\n        );\n\n      L.LayerGroup.prototype.initialize.call(this, layers, options);\n      this._featureEl = this.options.mapmlFeature;\n\n      if (\n        (this.options.onEachFeature && this.options.properties) ||\n        this.options.link\n      ) {\n        L.DomUtil.addClass(this.options.group, 'leaflet-interactive');\n        let firstLayer = layers[Object.keys(layers)[0]];\n        if (layers.length === 1 && firstLayer.options.link)\n          this.options.link = firstLayer.options.link;\n        if (this.options.link) {\n          M.Path.prototype.attachLinkHandler.call(\n            this,\n            this.options.group,\n            this.options.link,\n            this.options._leafletLayer\n          );\n          this.options.group.setAttribute('role', 'link');\n        } else {\n          this.options.group.setAttribute('aria-expanded', 'false');\n          this.options.group.setAttribute('role', 'button');\n          this.options.onEachFeature(this.options.properties, this);\n          this.off('click', this._openPopup);\n        }\n      }\n\n      L.DomEvent.on(this.options.group, 'keyup keydown', this._handleFocus, this);\n      this.options.group.setAttribute('aria-label', this.options.accessibleTitle);\n      if (this.options.featureID)\n        this.options.group.setAttribute('data-fid', this.options.featureID);\n      for (let feature of layers) {\n        feature._groupLayer = this;\n      }\n    },\n\n    onAdd: function (map) {\n      L.LayerGroup.prototype.onAdd.call(this, map);\n      this.updateInteraction();\n    },\n\n    updateInteraction: function () {\n      let map = this._map || this.options._leafletLayer._map;\n      if (this.options.onEachFeature || this.options.link)\n        map.featureIndex.addToIndex(\n          this,\n          this.getPCRSCenter(),\n          this.options.group\n        );\n\n      for (let layerID in this._layers) {\n        let layer = this._layers[layerID];\n        for (let part of layer._parts) {\n          if (layer.featureAttributes && layer.featureAttributes.tabindex)\n            map.featureIndex.addToIndex(layer, layer.getPCRSCenter(), part.path);\n          for (let subPart of part.subrings) {\n            if (subPart.attr && subPart.attr.tabindex)\n              map.featureIndex.addToIndex(layer, subPart.center, subPart.path);\n          }\n        }\n      }\n    },\n\n    /**\n     * Check whether the feature group should be rendered at current map zoom level\n     * @param {Number} zoom - current map zoom\n     * @param {Object} vectorMinZoom - the minimum zoom bound of vector layer\n     * @param {Object} vectorMinZoom - the maximum zoom bound of vector layer\n     * @returns {Boolean}\n     * @private\n     */\n    _checkRender: function (zoom, vectorMinZoom, vectorMaxZoom) {\n      let minZoom = this._featureEl.getAttribute('min'),\n        maxZoom = this._featureEl.getAttribute('max');\n      // if the current map zoom falls below/above the zoom bounds of the vector layer\n      if (zoom > vectorMaxZoom || zoom < vectorMinZoom) return false;\n      // if no min and max attribute present\n      if (minZoom === null && maxZoom === null) return true;\n      // if the current map zoom falls below/above the [min, max] range\n      if (\n        (minZoom !== null && zoom < +minZoom) ||\n        (maxZoom !== null && zoom > +maxZoom)\n      ) {\n        return false;\n      }\n      return true;\n    },\n\n    /**\n     * Handler for focus events\n     * @param {L.DOMEvent} e - Event that occurred\n     * @private\n     */\n    _handleFocus: function (e) {\n      // tab, shift, cr, esc, up, left, down, right,\n      if (\n        [9, 16, 27, 37, 38, 39, 40].includes(e.keyCode) &&\n        e.type === 'keydown'\n      ) {\n        let index = this._map.featureIndex.currentIndex;\n        // Down/right arrow keys replicate tabbing through the feature index\n        // Up/left arrow keys replicate shift-tabbing through the feature index\n        if (e.keyCode === 37 || e.keyCode === 38) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\n            'tabindex',\n            -1\n          );\n          if (index === 0) {\n            this._map.featureIndex.inBoundFeatures[\n              this._map.featureIndex.inBoundFeatures.length - 1\n            ].path.focus();\n            this._map.featureIndex.currentIndex =\n              this._map.featureIndex.inBoundFeatures.length - 1;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index - 1].path.focus();\n            this._map.featureIndex.currentIndex--;\n          }\n        } else if (e.keyCode === 39 || e.keyCode === 40) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\n            'tabindex',\n            -1\n          );\n          if (index === this._map.featureIndex.inBoundFeatures.length - 1) {\n            this._map.featureIndex.inBoundFeatures[0].path.focus();\n            this._map.featureIndex.currentIndex = 0;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index + 1].path.focus();\n            this._map.featureIndex.currentIndex++;\n          }\n        } else if (e.keyCode === 27) {\n          let shadowRoot = this._map.options.mapEl.shadowRoot\n            ? this._map.options.mapEl.shadowRoot\n            : this._map.options.mapEl.querySelector('.mapml-web-map').shadowRoot;\n          if (shadowRoot.activeElement.nodeName !== 'g') return;\n          this._map._container.focus();\n        } else if (e.keyCode === 9) {\n          let obj = this;\n          setTimeout(function () {\n            obj._map.featureIndex.inBoundFeatures[0].path.setAttribute(\n              'tabindex',\n              0\n            );\n          }, 0);\n        }\n        // tab, shift, cr, esc, right, left, up, down,\n        // 1, 2, 3, 4, 5, 6, 7 (featureIndexOverlay available index items\n        // [8, 9] being allocated to next, previous menu items).\n      } else if (\n        ![9, 16, 13, 27, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55].includes(\n          e.keyCode\n        )\n      ) {\n        this._map.featureIndex.currentIndex = 0;\n        this._map.featureIndex.inBoundFeatures[0].path.focus();\n      }\n\n      // 27 added so that the tooltip opens when dismissing popup with 'esc' key\n      if (e.target.tagName.toUpperCase() !== 'G') return;\n      if (\n        [9, 13, 16, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55, 27].includes(\n          e.keyCode\n        ) &&\n        e.type === 'keyup'\n      ) {\n        this.openTooltip();\n      } else if (e.keyCode === 13 || e.keyCode === 32) {\n        this.closeTooltip();\n        if (!this.options.link && this.options.onEachFeature) {\n          L.DomEvent.stop(e);\n          this.openPopup();\n        }\n      } else {\n        this.closeTooltip();\n      }\n    },\n\n    /**\n     * Add a M.Path to the M.Geometry\n     * @param layer\n     */\n    addLayer: function (layer) {\n      if (!layer.options.link && layer.options.interactive) {\n        this.options.onEachFeature(this.options.properties, layer);\n      }\n      L.FeatureGroup.prototype.addLayer.call(this, layer);\n    },\n\n    /**\n     * Focuses the previous function in the sequence on previous button press\n     * @param e\n     * @private\n     */\n    _previousFeature: function (e) {\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.max(\n        this._map.featureIndex.currentIndex - 1,\n        0\n      );\n      let prevFocus =\n        this._map.featureIndex.inBoundFeatures[\n          this._map.featureIndex.currentIndex\n        ];\n      prevFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    /**\n     * Focuses next feature in sequence\n     * @param e\n     * @private\n     */\n    _nextFeature: function (e) {\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.min(\n        this._map.featureIndex.currentIndex + 1,\n        this._map.featureIndex.inBoundFeatures.length - 1\n      );\n      let nextFocus =\n        this._map.featureIndex.inBoundFeatures[\n          this._map.featureIndex.currentIndex\n        ];\n      nextFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    getPCRSCenter: function () {\n      let bounds;\n      for (let l in this._layers) {\n        let layer = this._layers[l];\n        if (!bounds) {\n          bounds = L.bounds(layer.getPCRSCenter(), layer.getPCRSCenter());\n        } else {\n          bounds.extend(layer.getPCRSCenter());\n        }\n      }\n      return bounds.getCenter();\n    }\n  });\n\n  /**\n   * Returns new M.Geometry\n   * @param {M.Path[]} layers - Layers belonging to feature group\n   * @param {Object} options - Options for the feature group\n   * @returns {M.Geometry}\n   */\n  var geometry = function (layers, options) {\n    return new Geometry(layers, options);\n  };\n\n  var AnnounceMovement = L.Handler.extend({\n    addHooks: function () {\n      this._map.on({\n        layeradd: this.totalBounds,\n        layerremove: this.totalBounds\n      });\n\n      this._map.options.mapEl.addEventListener(\n        'map-moveend',\n        this.announceBounds\n      );\n      this._map.dragging._draggable.addEventListener('dragstart', this.dragged);\n      this._map.options.mapEl.addEventListener(\n        'mapfocused',\n        this.focusAnnouncement\n      );\n    },\n    removeHooks: function () {\n      this._map.off({\n        layeradd: this.totalBounds,\n        layerremove: this.totalBounds\n      });\n\n      this._map.options.mapEl.removeEventListener(\n        'map-moveend',\n        this.announceBounds\n      );\n      this._map.dragging._draggable.removeEventListener(\n        'dragstart',\n        this.dragged\n      );\n      this._map.options.mapEl.removeEventListener(\n        'mapfocused',\n        this.focusAnnouncement\n      );\n    },\n\n    focusAnnouncement: function () {\n      let mapEl = this;\n      setTimeout(function () {\n        let el = mapEl.querySelector('.mapml-web-map')\n          ? mapEl\n              .querySelector('.mapml-web-map')\n              .shadowRoot.querySelector('.leaflet-container')\n          : mapEl.shadowRoot.querySelector('.leaflet-container');\n\n        let mapZoom = mapEl._map.getZoom();\n        let location = M._gcrsToTileMatrix(mapEl);\n        let standard = M.options.locale.amZoom + ' ' + mapZoom;\n\n        if (mapZoom === mapEl._map._layersMaxZoom) {\n          standard = M.options.locale.amMaxZoom + ' ' + standard;\n        } else if (mapZoom === mapEl._map._layersMinZoom) {\n          standard = M.options.locale.amMinZoom + ' ' + standard;\n        }\n\n        el.setAttribute('aria-roledescription', 'region ' + standard);\n        setTimeout(function () {\n          el.removeAttribute('aria-roledescription');\n        }, 2000);\n      }, 0);\n    },\n\n    announceBounds: function () {\n      if (this._traversalCall > 0) {\n        return;\n      }\n      let mapZoom = this._map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n\n      let visible = true;\n      if (this._map.totalLayerBounds) {\n        visible =\n          mapZoom <= this._map._layersMaxZoom &&\n          mapZoom >= this._map._layersMinZoom &&\n          this._map.totalLayerBounds.overlaps(mapBounds);\n      }\n\n      let output = this.querySelector('.mapml-web-map')\n        ? this.querySelector('.mapml-web-map').shadowRoot.querySelector(\n            '.mapml-screen-reader-output'\n          )\n        : this.shadowRoot.querySelector('.mapml-screen-reader-output');\n\n      //GCRS to TileMatrix\n      let location = M._gcrsToTileMatrix(this);\n      let standard = M.options.locale.amZoom + ' ' + mapZoom;\n\n      if (!visible) {\n        let outOfBoundsPos = this._history[this._historyIndex];\n        let inBoundsPos = this._history[this._historyIndex - 1];\n        this.back();\n        this._history.pop();\n\n        if (outOfBoundsPos.zoom !== inBoundsPos.zoom) {\n          output.innerText = M.options.locale.amZoomedOut;\n        } else if (this._map.dragging._draggable.wasDragged) {\n          output.innerText = M.options.locale.amDraggedOut;\n        } else if (outOfBoundsPos.x > inBoundsPos.x) {\n          output.innerText = M.options.locale.amEastBound;\n        } else if (outOfBoundsPos.x < inBoundsPos.x) {\n          output.innerText = M.options.locale.amWestBound;\n        } else if (outOfBoundsPos.y < inBoundsPos.y) {\n          output.innerText = M.options.locale.amNorthBound;\n        } else if (outOfBoundsPos.y > inBoundsPos.y) {\n          output.innerText = M.options.locale.amSouthBound;\n        }\n      } else {\n        let prevZoom = this._history[this._historyIndex - 1]\n          ? this._history[this._historyIndex - 1].zoom\n          : this._history[this._historyIndex].zoom;\n        if (mapZoom === this._map._layersMaxZoom && mapZoom !== prevZoom) {\n          output.innerText = M.options.locale.amMaxZoom + ' ' + standard;\n        } else if (mapZoom === this._map._layersMinZoom && mapZoom !== prevZoom) {\n          output.innerText = M.options.locale.amMinZoom + ' ' + standard;\n        } else {\n          output.innerText = standard;\n        }\n      }\n      this._map.dragging._draggable.wasDragged = false;\n    },\n\n    totalBounds: function () {\n      let layers = Object.keys(this._layers);\n      let bounds = L.bounds();\n\n      layers.forEach((i) => {\n        if (this._layers[i].layerBounds) {\n          if (!bounds) {\n            let point = this._layers[i].layerBounds.getCenter();\n            bounds = L.bounds(point, point);\n          }\n          bounds.extend(this._layers[i].layerBounds.min);\n          bounds.extend(this._layers[i].layerBounds.max);\n        }\n      });\n\n      this.totalLayerBounds = bounds;\n    },\n\n    dragged: function () {\n      this.wasDragged = true;\n    }\n  });\n\n  var FeatureIndex = L.Handler.extend({\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.inBoundFeatures = [];\n      this.outBoundFeatures = [];\n      this.currentIndex = 0;\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection\n      );\n    },\n\n    addHooks: function () {\n      this._map.on('mapkeyboardfocused', this._updateMapBounds, this);\n      this._map.on('mapkeyboardfocused', this._sortIndex, this);\n    },\n\n    removeHooks: function () {\n      this._map.off('mapkeyboardfocused', this._updateMapBounds);\n      this._map.off('mapkeyboardfocused', this._sortIndex);\n    },\n\n    /**\n     * Adds a svg element to the index of tabbable features, it also keeps track of the layer it's associated + center\n     * @param layer - the layer object the feature is associated with\n     * @param lc - the layer center\n     * @param path - the svg element that needs to be focused, can be a path or g\n     */\n    addToIndex: function (layer, lc, path) {\n      let mc = this._mapPCRSBounds.getCenter();\n      let dist = Math.sqrt(Math.pow(lc.x - mc.x, 2) + Math.pow(lc.y - mc.y, 2));\n      let index = this._mapPCRSBounds.contains(lc)\n        ? this.inBoundFeatures\n        : this.outBoundFeatures;\n\n      let elem = { path: path, layer: layer, center: lc, dist: dist };\n      path.setAttribute('tabindex', -1);\n\n      index.push(elem);\n\n      // TODO: this insertion loop has potential to be improved slightly\n      for (\n        let i = index.length - 1;\n        i > 0 && index[i].dist < index[i - 1].dist;\n        i--\n      ) {\n        let tmp = index[i];\n        index[i] = index[i - 1];\n        index[i - 1] = tmp;\n      }\n\n      if (this._mapPCRSBounds.contains(lc)) this.inBoundFeatures = index;\n      else this.outBoundFeatures = index;\n    },\n\n    /**\n     * Removes features that are no longer on the map, also moves features to the respective array depending\n     * on whether the feature is in the maps viewport or not\n     */\n    cleanIndex: function () {\n      this.currentIndex = 0;\n      this.inBoundFeatures = this.inBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute('tabindex', -1);\n        if (elem.layer._map && !inbound) {\n          this.outBoundFeatures.push(elem);\n        }\n        return elem.layer._map && inbound;\n      });\n      this.outBoundFeatures = this.outBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute('tabindex', -1);\n        if (elem.layer._map && inbound) {\n          this.inBoundFeatures.push(elem);\n        }\n        return elem.layer._map && !inbound;\n      });\n    },\n\n    /**\n     * Sorts the index of features in the map's viewport based on distance from center\n     * @private\n     */\n    _sortIndex: function () {\n      this.cleanIndex();\n      if (this.inBoundFeatures.length === 0) return;\n\n      let mc = this._mapPCRSBounds.getCenter();\n\n      this.inBoundFeatures.sort(function (a, b) {\n        let ac = a.center;\n        let bc = b.center;\n        a.dist = Math.sqrt(Math.pow(ac.x - mc.x, 2) + Math.pow(ac.y - mc.y, 2));\n        b.dist = Math.sqrt(Math.pow(bc.x - mc.x, 2) + Math.pow(bc.y - mc.y, 2));\n        return a.dist - b.dist;\n      });\n      this.inBoundFeatures[0].path.setAttribute('tabindex', 0);\n    },\n\n    /**\n     * Event handler for 'mapfocused' event to update the map's bounds in terms of PCRS\n     * @param e - the event object\n     * @private\n     */\n    _updateMapBounds: function (e) {\n      // TODO: map's PCRS bounds is used in other parts of the viewer, can be moved out to the map object directly\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        this._map.getZoom(),\n        this._map.options.projection\n      );\n    }\n  });\n\n  var Options = {\n    featureIndexOverlayOption: false,\n    announceMovement: false,\n    announceScale: { metric: true, imperial: false },\n    defaultExtCoor: 'pcrs',\n    defaultLocCoor: 'gcrs',\n    locale: {\n      cmBack: 'Back',\n      cmForward: 'Forward',\n      cmReload: 'Reload',\n      cmToggleControls: 'Toggle Controls',\n      cmCopyCoords: 'Copy',\n      cmCopyMapML: 'Map',\n      cmCopyExtent: 'Extent',\n      cmCopyLocation: 'Location',\n      cmToggleDebug: 'Toggle Debug Mode',\n      cmPasteLayer: 'Paste',\n      cmViewSource: 'View Map Source',\n      lmZoomToLayer: 'Zoom To Layer',\n      lmCopyLayer: 'Copy Layer',\n      lcOpacity: 'Opacity',\n      btnAttribution: 'Map data attribution',\n      btnZoomIn: 'Zoom in',\n      btnZoomOut: 'Zoom out',\n      btnFullScreen: 'View Fullscreen',\n      btnExitFullScreen: 'Exit Fullscreen',\n      btnLocTrackOn: 'Show my location - location tracking on',\n      btnMyLocTrackOn: 'My current location, shown on map',\n      btnLocTrackOff: 'Show my location - location tracking off',\n      btnLocTrackLastKnown: 'Show my location - last known location shown',\n      btnMyLastKnownLocTrackOn: 'My last known location, shown on map',\n      amZoom: 'zoom level',\n      amColumn: 'column',\n      amRow: 'row',\n      amMaxZoom: 'At maximum zoom level, zoom in disabled',\n      amMinZoom: 'At minimum zoom level, zoom out disabled',\n      amZoomedOut: 'Zoomed out of bounds, returning to',\n      amDraggedOut: 'Dragged out of bounds, returning to',\n      amEastBound: 'Reached east bound, panning east disabled',\n      amWestBound: 'Reached west bound, panning west disabled',\n      amNorthBound: 'Reached north bound, panning north disabled',\n      amSouthBound: 'Reached south bound, panning south disabled',\n      kbdShortcuts: 'Keyboard shortcuts',\n      kbdMovement: 'Movement keys',\n      kbdFeature: 'Feature navigation keys',\n      kbdPanUp: 'Pan up',\n      kbdPanDown: 'Pan down',\n      kbdPanLeft: 'Pan left',\n      kbdPanRight: 'Pan right',\n      kbdPanIncrement: 'pan increment',\n      kbdZoom: 'Zoom in/out 3 levels',\n      kbdPrevFeature: 'Previous feature',\n      kbdNextFeature: 'Next feature',\n      dfLayer: 'Layer',\n      popupZoom: 'Zoom to here',\n      dfPastedLayer: 'Pasted layer',\n      fIndexNoFeatures: 'No features found'\n    }\n  };\n\n  L.Map.Keyboard.include({\n    _onKeyDown: function (e) {\n      if (e.altKey || e.metaKey) {\n        return;\n      }\n\n      let zoomIn = {\n        187: 187,\n        107: 107,\n        61: 61,\n        171: 171\n      };\n\n      let zoomOut = {\n        189: 189,\n        109: 109,\n        54: 54,\n        173: 173\n      };\n\n      var key = e.keyCode,\n        map = this._map,\n        offset;\n\n      if (key in this._panKeys) {\n        if (!map._panAnim || !map._panAnim._inProgress) {\n          offset = this._panKeys[key];\n          if (e.shiftKey) {\n            offset = L.point(offset).multiplyBy(3);\n          }\n          if (e.ctrlKey) {\n            offset = L.point(offset).divideBy(5);\n          }\n\n          map.panBy(offset);\n\n          if (map.options.maxBounds) {\n            map.panInsideBounds(map.options.maxBounds);\n          }\n        }\n      } else if (key in this._zoomKeys) {\n        if (\n          (key in zoomIn && map._layersMaxZoom !== map.getZoom()) ||\n          (key in zoomOut && map._layersMinZoom !== map.getZoom())\n        )\n          map.setZoom(map.getZoom() + (e.shiftKey ? 3 : 1) * this._zoomKeys[key]);\n      } else if (\n        key === 27 &&\n        map._popup &&\n        map._popup.options.closeOnEscapeKey\n      ) {\n        map.closePopup();\n      } else {\n        return;\n      }\n\n      L.DomEvent.stop(e);\n    }\n  });\n\n  var FeatureIndexOverlay = L.Layer.extend({\n    onAdd: function (map) {\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><path fill=\"none\" stroke=\"#000\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M0 0h100v100H0z\" color=\"#000\" overflow=\"visible\"/></svg>`;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-feature-index-box',\n        map._container\n      );\n      this._container.innerHTML = svgInnerHTML;\n\n      this._output = L.DomUtil.create(\n        'output',\n        'mapml-feature-index',\n        map._container\n      );\n      this._output.setAttribute('role', 'status');\n      this._output.setAttribute('aria-live', 'polite');\n      this._output.setAttribute('aria-atomic', 'true');\n      this._body = L.DomUtil.create(\n        'span',\n        'mapml-feature-index-content',\n        this._output\n      );\n      this._body.index = 0;\n      this._output.initialFocus = false;\n      map.on('focus blur popupclose', this._addOrRemoveFeatureIndex, this);\n      map.on('moveend focus templatedfeatureslayeradd', this._checkOverlap, this);\n      map.on('keydown', this._onKeyDown, this);\n      this._addOrRemoveFeatureIndex();\n    },\n\n    _calculateReticleBounds: function () {\n      let bounds = this._map.getPixelBounds();\n      let center = bounds.getCenter();\n      let wRatio =\n        Math.abs(bounds.min.x - bounds.max.x) / this._map.options.mapEl.width;\n      let hRatio =\n        Math.abs(bounds.min.y - bounds.max.y) / this._map.options.mapEl.height;\n\n      let reticleDimension = getComputedStyle(this._container).width.replace(\n        /[^\\d.]/g,\n        ''\n      );\n      if (getComputedStyle(this._container).width.slice(-1) === '%') {\n        reticleDimension =\n          (reticleDimension * this._map.options.mapEl.width) / 100;\n      }\n      let w = (wRatio * reticleDimension) / 2;\n      let h = (hRatio * reticleDimension) / 2;\n      let minPoint = L.point(center.x - w, center.y + h);\n      let maxPoint = L.point(center.x + w, center.y - h);\n      let b = L.bounds(minPoint, maxPoint);\n      return M.pixelToPCRSBounds(\n        b,\n        this._map.getZoom(),\n        this._map.options.projection\n      );\n    },\n\n    _checkOverlap: function (e) {\n      if (e.type === 'focus') this._output.initialFocus = true;\n      if (!this._output.initialFocus) return;\n      if (this._output.popupClosed) {\n        this._output.popupClosed = false;\n        return;\n      }\n\n      this._map.fire('mapkeyboardfocused');\n\n      let featureIndexBounds = this._calculateReticleBounds();\n      let features = this._map.featureIndex.inBoundFeatures;\n      let index = 1;\n      let keys = Object.keys(features);\n      let body = this._body;\n      let noFeaturesMessage = document.createElement('span');\n      noFeaturesMessage.innerHTML = M.options.locale.fIndexNoFeatures;\n\n      body.innerHTML = '';\n      body.index = 0;\n\n      body.allFeatures = [];\n      keys.forEach((i) => {\n        let layer = features[i].layer;\n        let layers = features[i].layer._layers;\n        let bounds = L.bounds();\n\n        if (layers) {\n          let keys = Object.keys(layers);\n          keys.forEach((j) => {\n            if (!bounds)\n              bounds = L.bounds(\n                layer._layers[j]._bounds.min,\n                layer._layers[j]._bounds.max\n              );\n            bounds.extend(layer._layers[j]._bounds.min);\n            bounds.extend(layer._layers[j]._bounds.max);\n          });\n        } else if (layer._bounds) {\n          bounds = L.bounds(layer._bounds.min, layer._bounds.max);\n        }\n\n        if (featureIndexBounds.overlaps(bounds)) {\n          let label = features[i].path.getAttribute('aria-label');\n\n          if (index < 8) {\n            body.appendChild(this._updateOutput(label, index, index));\n          }\n          if (index % 7 === 0 || index === 1) {\n            body.allFeatures.push([]);\n          }\n          body.allFeatures[Math.floor((index - 1) / 7)].push({\n            label,\n            index,\n            layer\n          });\n          if (body.allFeatures[1] && body.allFeatures[1].length === 1) {\n            body.appendChild(this._updateOutput('More results', 0, 9));\n          }\n          index += 1;\n        }\n      });\n      this._addToggleKeys();\n      if (index === 1) {\n        body.appendChild(noFeaturesMessage);\n      }\n    },\n\n    _updateOutput: function (label, index, key) {\n      let span = document.createElement('span');\n      span.setAttribute('data-index', index);\n      //\", \" adds a brief auditory pause when a screen reader is reading through the feature index\n      //also prevents names with numbers + key from being combined when read\n      span.innerHTML = `<kbd>${key}</kbd>` + ' ' + label + '<span>, </span>';\n      return span;\n    },\n\n    _addToggleKeys: function () {\n      let allFeatures = this._body.allFeatures;\n      for (let i = 0; i < allFeatures.length; i++) {\n        if (allFeatures[i].length === 0) return;\n        if (allFeatures[i - 1]) {\n          let label = 'Previous results';\n          allFeatures[i].push({ label });\n        }\n\n        if (allFeatures[i + 1] && allFeatures[i + 1].length > 0) {\n          let label = 'More results';\n          allFeatures[i].push({ label });\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      let body = this._body;\n      let key = e.originalEvent.keyCode;\n      if (key >= 49 && key <= 55) {\n        if (!body.allFeatures[body.index]) return;\n        let feature = body.allFeatures[body.index][key - 49];\n        if (!feature) return;\n        let layer = feature.layer;\n        if (layer) {\n          this._map.featureIndex.currentIndex = feature.index - 1;\n          if (layer._popup) {\n            this._map.closePopup();\n            layer.openPopup();\n          } else layer.options.group.focus();\n        }\n      } else if (key === 56) {\n        this._newContent(body, -1);\n      } else if (key === 57) {\n        this._newContent(body, 1);\n      }\n    },\n\n    _newContent: function (body, direction) {\n      let index = body.firstChild.getAttribute('data-index');\n      let newContent = body.allFeatures[Math.floor((index - 1) / 7 + direction)];\n      if (newContent && newContent.length > 0) {\n        body.innerHTML = '';\n        body.index += direction;\n        for (let i = 0; i < newContent.length; i++) {\n          let feature = newContent[i];\n          let index = feature.index ? feature.index : 0;\n          let key = i + 1;\n          if (feature.label === 'More results') key = 9;\n          if (feature.label === 'Previous results') key = 8;\n          body.appendChild(this._updateOutput(feature.label, index, key));\n        }\n      }\n    },\n\n    _addOrRemoveFeatureIndex: function (e) {\n      //Toggle aria-hidden attribute so screen reader rereads the feature index on focus\n      if (!this._output.initialFocus) {\n        this._output.setAttribute('aria-hidden', 'true');\n      } else if (this._output.hasAttribute('aria-hidden')) {\n        let obj = this;\n        setTimeout(function () {\n          obj._output.removeAttribute('aria-hidden');\n        }, 100);\n      }\n\n      if (e && e.type === 'popupclose') {\n        this._output.setAttribute('aria-hidden', 'true');\n        this._output.popupClosed = true;\n      } else if (e && e.type === 'focus') {\n        this._container.removeAttribute('hidden');\n        this._output.classList.remove('mapml-screen-reader-output');\n        // this is a very subtle branch.  The event that gets handled below is a blur\n        // event, which happens to have the e.target._popup property\n        // when there will be a popup.  Because blur gets handled here, it doesn't\n        // get handled in the next else if block, which would hide both the reticle\n        // and the index menu, and then recursively call this method with no event\n        // argument, which manipulates the aria-hidden attribute on the output\n        // in order to have the screenreader read its contents when the focus returns\n        // to (what exactly???).\n      } else if (e && e.target._popup) {\n        this._container.setAttribute('hidden', '');\n      } else if (e && e.type === 'blur') {\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n        this._output.initialFocus = false;\n        this._addOrRemoveFeatureIndex();\n      } else {\n        // this is the default block, called when no event is passed (recursive call)\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n      }\n    }\n  });\n\n  var featureIndexOverlay = function (options) {\n    return new FeatureIndexOverlay(options);\n  };\n\n  /*\n   * Copyright 2015-2016 Canada Centre for Mapping and Earth Observation,\n   * Earth Sciences Sector, Natural Resources Canada.\n   *\n   * License\n   *\n   * By obtaining and/or copying this work, you (the licensee) agree that you have\n   * read, understood, and will comply with the following terms and conditions.\n   *\n   * Permission to copy, modify, and distribute this work, with or without\n   * modification, for any purpose and without fee or royalty is hereby granted,\n   * provided that you include the following on ALL copies of the work or portions\n   * thereof, including modifications:\n   *\n   * The full text of this NOTICE in a location viewable to users of the\n   * redistributed or derivative work.\n   *\n   * Any pre-existing intellectual property disclaimers, notices, or terms and\n   * conditions. If none exist, the W3C Software and Document Short Notice should\n   * be included.\n   *\n   * Notice of any changes or modifications, through a copyright statement on the\n   * new code or document such as \"This software or document includes material\n   * copied from or derived from [title and URI of the W3C document].\n   * Copyright  [YEAR] W3C (MIT, ERCIM, Keio, Beihang).\"\n   *\n   * Disclaimers\n   *\n   * THIS WORK IS PROVIDED \"AS IS,\" AND COPYRIGHT HOLDERS MAKE NO REPRESENTATIONS\n   * OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF\n   * MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE\n   * SOFTWARE OR DOCUMENT WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS,\n   * TRADEMARKS OR OTHER RIGHTS.\n   * COPYRIGHT HOLDERS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR\n   * CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SOFTWARE OR DOCUMENT.\n   *\n   * The name and trademarks of copyright holders may NOT be used in advertising or\n   * publicity pertaining to the work without specific, written prior permission.\n   * Title to copyright in this work will at all times remain with copyright holders.\n   */\n\n  /* global L, Node */\n  (function (window, document, undefined$1) {\n    var M = {};\n    window.M = M;\n\n    (function () {\n      M.detectImagePath = function (container) {\n        // this relies on the CSS style leaflet-default-icon-path containing a\n        // relative url() that leads to a valid icon file.  Since that depends on\n        // how all of this stuff is deployed (i.e. custom element or as leaflet-plugin)\n        // also, because we're using 'shady DOM' api, the container must be\n        // a shady dom container, because the custom element tags it with added\n        // style-scope ... and related classes.\n        var el = L.DomUtil.create('div', 'leaflet-default-icon-path', container);\n        var path =\n          L.DomUtil.getStyle(el, 'background-image') ||\n          L.DomUtil.getStyle(el, 'backgroundImage'); // IE8\n\n        container.removeChild(el);\n\n        if (path === null || path.indexOf('url') !== 0) {\n          path = '';\n        } else {\n          path = path\n            .replace(/^url\\([\"']?/, '')\n            .replace(/marker-icon\\.png[\"']?\\)$/, '');\n        }\n\n        return path;\n      };\n      M.mime = 'text/mapml';\n\n      let mapOptions = window.document.head.querySelector('map-options');\n      M.options = Options;\n      if (mapOptions)\n        M.options = Object.assign(M.options, JSON.parse(mapOptions.innerHTML));\n\n      // see https://leafletjs.com/reference-1.5.0.html#crs-l-crs-base\n      // \"new classes can't inherit from (L.CRS), and methods can't be added\n      // to (L.CRS.anything) with the include function\n      // so we'll use the options property as a way to integrate needed\n      // properties and methods...\n      M.WGS84 = new L.Proj.CRS(\n        'EPSG:4326',\n        '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ',\n        {\n          origin: [-180, +90],\n          bounds: L.bounds([\n            [-180, -90],\n            [180, 90]\n          ]),\n          resolutions: [\n            0.703125, 0.3515625, 0.17578125, 0.087890625, 0.0439453125,\n            0.02197265625, 0.010986328125, 0.0054931640625, 0.00274658203125,\n            0.001373291015625, 0.0006866455078125, 0.0003433227539062,\n            0.0001716613769531, 0.0000858306884766, 0.0000429153442383,\n            0.0000214576721191, 0.0000107288360596, 0.0000053644180298,\n            0.0000026822090149, 0.0000013411045074, 0.0000006705522537,\n            0.0000003352761269\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.bounds.getSize().x /\n                      M.WGS84.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.bounds.getSize().y /\n                      M.WGS84.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.WGS84.options.crs.tcrs.horizontal.min,\n                    M.WGS84.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tcrs.horizontal.max(zoom),\n                    M.WGS84.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'longitude',\n                get min() {\n                  return M.WGS84.options.crs.gcrs.horizontal.min;\n                },\n                get max() {\n                  return M.WGS84.options.crs.gcrs.horizontal.max;\n                }\n              },\n              vertical: {\n                name: 'latitude',\n                get min() {\n                  return M.WGS84.options.crs.gcrs.vertical.min;\n                },\n                get max() {\n                  return M.WGS84.options.crs.gcrs.vertical.max;\n                }\n              },\n              get bounds() {\n                return M.WGS84.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -180.0,\n                max: 180.0\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -90.0,\n                max: 90.0\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.WGS84.options.crs.gcrs.vertical.min,\n                    M.WGS84.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.WGS84.options.crs.gcrs.vertical.max,\n                    M.WGS84.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.WGS84.options.crs.tile.horizontal.min,\n                    M.WGS84.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tile.horizontal.max,\n                    M.WGS84.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.crs.tcrs.horizontal.max(zoom) /\n                      M.WGS84.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.crs.tcrs.vertical.max(zoom) /\n                      M.WGS84.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.WGS84.options.crs.tilematrix.horizontal.min,\n                    M.WGS84.options.crs.tilematrix.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tilematrix.horizontal.max(zoom),\n                    M.WGS84.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.CBMTILE = new L.Proj.CRS(\n        'EPSG:3978',\n        '+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        {\n          origin: [-34655800, 39310000],\n          bounds: L.bounds([\n            [-34655800, -39000000],\n            [10000000, 39310000]\n          ]),\n          resolutions: [\n            38364.660062653464, 22489.62831258996, 13229.193125052918,\n            7937.5158750317505, 4630.2175937685215, 2645.8386250105837,\n            1587.5031750063501, 926.0435187537042, 529.1677250021168,\n            317.50063500127004, 185.20870375074085, 111.12522225044451,\n            66.1459656252646, 38.36466006265346, 22.48962831258996,\n            13.229193125052918, 7.9375158750317505, 4.6302175937685215,\n            2.6458386250105836, 1.5875031750063502, 0.92604351875370428,\n            0.52916772500211673, 0.31750063500127002, 0.18520870375074083,\n            0.11112522225044451, 0.066145965625264591\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.bounds.getSize().x /\n                      M.CBMTILE.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.bounds.getSize().y /\n                      M.CBMTILE.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.CBMTILE.options.crs.tcrs.horizontal.min,\n                    M.CBMTILE.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.tcrs.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'easting',\n                get min() {\n                  return M.CBMTILE.options.bounds.min.x;\n                },\n                get max() {\n                  return M.CBMTILE.options.bounds.max.x;\n                }\n              },\n              vertical: {\n                name: 'northing',\n                get min() {\n                  return M.CBMTILE.options.bounds.min.y;\n                },\n                get max() {\n                  return M.CBMTILE.options.bounds.max.y;\n                }\n              },\n              get bounds() {\n                return M.CBMTILE.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -141.01,\n                max: -47.74\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: 40.04,\n                max: 86.46\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.CBMTILE.options.crs.gcrs.vertical.min,\n                    M.CBMTILE.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.gcrs.vertical.max,\n                    M.CBMTILE.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.CBMTILE.options.crs.tile.horizontal.min,\n                    M.CBMTILE.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.tile.horizontal.max,\n                    M.CBMTILE.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.crs.tcrs.horizontal.max(zoom) /\n                      M.CBMTILE.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.crs.tcrs.vertical.max(zoom) /\n                      M.CBMTILE.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [0, 0],\n                  [\n                    M.CBMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.APSTILE = new L.Proj.CRS(\n        'EPSG:5936',\n        '+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs',\n        {\n          origin: [-2.8567784109255e7, 3.2567784109255e7],\n          bounds: L.bounds([\n            [-28567784.109254867, -28567784.109254755],\n            [32567784.109255023, 32567784.10925506]\n          ]),\n          resolutions: [\n            238810.813354, 119405.406677, 59702.7033384999, 29851.3516692501,\n            14925.675834625, 7462.83791731252, 3731.41895865639, 1865.70947932806,\n            932.854739664032, 466.427369832148, 233.213684916074,\n            116.606842458037, 58.3034212288862, 29.1517106145754,\n            14.5758553072877, 7.28792765351156, 3.64396382688807,\n            1.82198191331174, 0.910990956788164, 0.45549547826179\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.bounds.getSize().x /\n                      M.APSTILE.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.bounds.getSize().y /\n                      M.APSTILE.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.APSTILE.options.crs.tcrs.horizontal.min,\n                    M.APSTILE.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.tcrs.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'easting',\n                get min() {\n                  return M.APSTILE.options.bounds.min.x;\n                },\n                get max() {\n                  return M.APSTILE.options.bounds.max.x;\n                }\n              },\n              vertical: {\n                name: 'northing',\n                get min() {\n                  return M.APSTILE.options.bounds.min.y;\n                },\n                get max() {\n                  return M.APSTILE.options.bounds.max.y;\n                }\n              },\n              get bounds() {\n                return M.APSTILE.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -180.0,\n                max: 180.0\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: 60.0,\n                max: 90.0\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.APSTILE.options.crs.gcrs.vertical.min,\n                    M.APSTILE.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.gcrs.vertical.max,\n                    M.APSTILE.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.APSTILE.options.crs.tile.horizontal.min,\n                    M.APSTILE.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.tile.horizontal.max,\n                    M.APSTILE.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.crs.tcrs.horizontal.max(zoom) /\n                      M.APSTILE.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.crs.tcrs.vertical.max(zoom) /\n                      M.APSTILE.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [0, 0],\n                  [\n                    M.APSTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.OSMTILE = L.CRS.EPSG3857;\n      L.setOptions(M.OSMTILE, {\n        origin: [-20037508.342787, 20037508.342787],\n        bounds: L.bounds([\n          [-20037508.342787, -20037508.342787],\n          [20037508.342787, 20037508.342787]\n        ]),\n        resolutions: [\n          156543.0339, 78271.51695, 39135.758475, 19567.8792375, 9783.93961875,\n          4891.969809375, 2445.9849046875, 1222.9924523438, 611.49622617188,\n          305.74811308594, 152.87405654297, 76.437028271484, 38.218514135742,\n          19.109257067871, 9.5546285339355, 4.7773142669678, 2.3886571334839,\n          1.1943285667419, 0.59716428337097, 0.29858214168549, 0.14929107084274,\n          0.074645535421371, 0.03732276771068573, 0.018661383855342865,\n          0.009330691927671432495\n        ],\n        crs: {\n          tcrs: {\n            horizontal: {\n              name: 'x',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.bounds.getSize().x /\n                    M.OSMTILE.options.resolutions[zoom]\n                )\n            },\n            vertical: {\n              name: 'y',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.bounds.getSize().y /\n                    M.OSMTILE.options.resolutions[zoom]\n                )\n            },\n            bounds: (zoom) =>\n              L.bounds(\n                [\n                  M.OSMTILE.options.crs.tcrs.horizontal.min,\n                  M.OSMTILE.options.crs.tcrs.vertical.min\n                ],\n                [\n                  M.OSMTILE.options.crs.tcrs.horizontal.max(zoom),\n                  M.OSMTILE.options.crs.tcrs.vertical.max(zoom)\n                ]\n              )\n          },\n          pcrs: {\n            horizontal: {\n              name: 'easting',\n              get min() {\n                return M.OSMTILE.options.bounds.min.x;\n              },\n              get max() {\n                return M.OSMTILE.options.bounds.max.x;\n              }\n            },\n            vertical: {\n              name: 'northing',\n              get min() {\n                return M.OSMTILE.options.bounds.min.y;\n              },\n              get max() {\n                return M.OSMTILE.options.bounds.max.y;\n              }\n            },\n            get bounds() {\n              return M.OSMTILE.options.bounds;\n            }\n          },\n          gcrs: {\n            horizontal: {\n              name: 'longitude',\n              get min() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lng;\n              },\n              get max() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lng;\n              }\n            },\n            vertical: {\n              name: 'latitude',\n              get min() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lat;\n              },\n              get max() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lat;\n              }\n            },\n            get bounds() {\n              return L.latLngBounds(\n                [\n                  M.OSMTILE.options.crs.gcrs.vertical.min,\n                  M.OSMTILE.options.crs.gcrs.horizontal.min\n                ],\n                [\n                  M.OSMTILE.options.crs.gcrs.vertical.max,\n                  M.OSMTILE.options.crs.gcrs.horizontal.max\n                ]\n              );\n            }\n          },\n          map: {\n            horizontal: {\n              name: 'i',\n              min: 0,\n              max: (map) => map.getSize().x\n            },\n            vertical: {\n              name: 'j',\n              min: 0,\n              max: (map) => map.getSize().y\n            },\n            bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n          },\n          tile: {\n            horizontal: {\n              name: 'i',\n              min: 0,\n              max: 256\n            },\n            vertical: {\n              name: 'j',\n              min: 0,\n              max: 256\n            },\n            get bounds() {\n              return L.bounds(\n                [\n                  M.OSMTILE.options.crs.tile.horizontal.min,\n                  M.OSMTILE.options.crs.tile.vertical.min\n                ],\n                [\n                  M.OSMTILE.options.crs.tile.horizontal.max,\n                  M.OSMTILE.options.crs.tile.vertical.max\n                ]\n              );\n            }\n          },\n          tilematrix: {\n            horizontal: {\n              name: 'column',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.crs.tcrs.horizontal.max(zoom) /\n                    M.OSMTILE.options.crs.tile.bounds.getSize().x\n                )\n            },\n            vertical: {\n              name: 'row',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.crs.tcrs.vertical.max(zoom) /\n                    M.OSMTILE.options.crs.tile.bounds.getSize().y\n                )\n            },\n            bounds: (zoom) =>\n              L.bounds(\n                [0, 0],\n                [\n                  M.OSMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                  M.OSMTILE.options.crs.tilematrix.vertical.max(zoom)\n                ]\n              )\n          }\n        }\n      });\n    })();\n\n    M._handleLink = Util._handleLink;\n    M.convertPCRSBounds = Util.convertPCRSBounds;\n    M.axisToXY = Util.axisToXY;\n    M.csToAxes = Util.csToAxes;\n    M._convertAndFormatPCRS = Util._convertAndFormatPCRS;\n    M.axisToCS = Util.axisToCS;\n    M._parseNumber = Util._parseNumber;\n    M._extractInputBounds = Util._extractInputBounds;\n    M._splitCoordinate = Util._splitCoordinate;\n    M.boundsToPCRSBounds = Util.boundsToPCRSBounds;\n    M.pixelToPCRSBounds = Util.pixelToPCRSBounds;\n    M._metaContentToObject = Util._metaContentToObject;\n    M._coordsToArray = Util._coordsToArray;\n    M._parseStylesheetAsHTML = Util._parseStylesheetAsHTML;\n    M.pointToPCRSPoint = Util.pointToPCRSPoint;\n    M.pixelToPCRSPoint = Util.pixelToPCRSPoint;\n    M._gcrsToTileMatrix = Util._gcrsToTileMatrix;\n    M._pasteLayer = Util._pasteLayer;\n    M._properties2Table = Util._properties2Table;\n    M._updateExtent = Util._updateExtent;\n    M.geojson2mapml = Util.geojson2mapml;\n    M._breakArray = Util._breakArray;\n    M._table2properties = Util._table2properties;\n    M._geometry2geojson = Util._geometry2geojson;\n    M._pcrsToGcrs = Util._pcrsToGcrs;\n    M.mapml2geojson = Util.mapml2geojson;\n    M.getMaxZoom = Util.getMaxZoom;\n    M.getBounds = Util.getBounds;\n    M.getZoomBounds = Util.getZoomBounds;\n    M.getNativeVariables = Util.getNativeVariables;\n\n    M.QueryHandler = QueryHandler;\n    M.ContextMenu = ContextMenu;\n    M.AnnounceMovement = AnnounceMovement;\n    M.FeatureIndex = FeatureIndex;\n\n    // see https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\n    L.Map.addInitHook('addHandler', 'query', M.QueryHandler);\n    L.Map.addInitHook('addHandler', 'contextMenu', M.ContextMenu);\n    L.Map.addInitHook('addHandler', 'announceMovement', M.AnnounceMovement);\n    L.Map.addInitHook('addHandler', 'featureIndex', M.FeatureIndex);\n\n    M.MapMLLayer = MapMLLayer;\n    M.mapMLLayer = mapMLLayer;\n\n    M.ImageLayer = ImageLayer;\n    M.imageLayer = imageLayer;\n\n    M.TemplatedImageLayer = TemplatedImageLayer;\n    M.templatedImageLayer = templatedImageLayer;\n\n    M.TemplatedFeaturesLayer = TemplatedFeaturesLayer;\n    M.templatedFeaturesLayer = templatedFeaturesLayer;\n\n    M.TemplatedLayer = TemplatedLayer;\n    M.templatedLayer = templatedLayer;\n\n    M.TemplatedTileLayer = TemplatedTileLayer;\n    M.templatedTileLayer = templatedTileLayer;\n\n    M.FeatureLayer = FeatureLayer;\n    M.featureLayer = featureLayer;\n\n    M.LayerControl = LayerControl;\n    M.layerControl = layerControl;\n\n    M.AttributionButton = AttributionButton;\n    M.attributionButton = attributionButton;\n\n    M.ReloadButton = ReloadButton;\n    M.reloadButton = reloadButton;\n\n    M.ScaleBar = ScaleBar;\n    M.scaleBar = scaleBar;\n\n    M.FullscreenButton = FullscreenButton;\n    M.fullscreenButton = fullscreenButton;\n\n    M.geolocationButton = geolocationButton;\n\n    M.StaticTileLayer = StaticTileLayer;\n    M.staticTileLayer = staticTileLayer;\n\n    M.DebugOverlay = DebugOverlay;\n    M.debugOverlay = debugOverlay;\n\n    M.Crosshair = Crosshair;\n    M.crosshair = crosshair;\n\n    M.FeatureIndexOverlay = FeatureIndexOverlay;\n    M.featureIndexOverlay = featureIndexOverlay;\n\n    M.Path = Path;\n    M.path = path;\n\n    M.FeatureRenderer = FeatureRenderer;\n    M.featureRenderer = featureRenderer;\n\n    M.Geometry = Geometry;\n    M.geometry = geometry;\n  })(window);\n\n}());\n"],"names":["staticTileLayer","options","StaticTileLayer","layerControl","layers","LayerControl","L","GridLayer","extend","initialize","this","zoomBounds","_getZoomBounds","tileContainer","maxZoomBound","setOptions","_groups","_groupTiles","getElementsByTagName","_bounds","_getLayerBounds","projection","layerBounds","Object","keys","let","key","min","max","onAdd","map","_map","prototype","call","_handleMoveEnd","getEvents","events","_parentOnMoveEnd","moveend","move","e","mapZoom","getZoom","zoomLevel","maxNativeZoom","minNativeZoom","isVisible","maxZoom","minZoom","overlaps","M","pixelToPCRSBounds","getPixelBounds","_isValidTile","coords","_tileCoordsToKey","createTile","tileGroup","tileElem","document","createElement","tileSize","getTileSize","setAttribute","x","y","z","i","length","tile","width","height","alt","src","appendChild","tileGroups","crs","bounds","sCoords","split","pixelCoords","point","pixelBounds","zoom","container","meta","_metaContentToObject","getAttribute","tiles","nativeZoom","value","lZoom","Math","tileMap","row","col","tileCode","push","Control","Layers","autoZIndex","sortLayers","sortFunction","layerA","layerB","zIndex","overlays","_layerControlInputs","_layers","_lastZIndex","_handlingClick","_addLayer","_initLayout","on","_validateInput","DomEvent","mapEl","_container","_focusFirstLayer","_preventDefaultContextMenu","_update","_showControls","onRemove","off","layer","_onLayerChange","addOrUpdateOverlay","name","alreadyThere","addOverlay","removeAttribute","removeLayer","input","labels","label","checked","_layerEl","disabled","closest","style","fontStyle","_properties","_mapExtents","j","extentAnatomy","getElementsByClassName","elem","className","children","setTimeout","focus","_withinZoomBounds","range","_addItem","obj","layercontrols","getLayerUserControlsHTML","querySelector","layerId","stamp","_onInputClick","_overlaysList","collapse","target","tagName","relatedTarget","parentElement","contextMenu","_layerMenu","display","DomUtil","removeClass","originalEvent","pointerType","_isExpanded","latlng","mouseEventToLatLng","containerPoint","mouseEventToContainerPoint","preventDefault","fire","FALLBACK_PROJECTION","FALLBACK_CS","BLANK_TT_TREF","featureLayer","mapml","FeatureLayer","templatedTileLayer","template","TemplatedTileLayer","templatedLayer","templates","TemplatedLayer","templatedFeaturesLayer","TemplatedFeaturesLayer","templatedImageLayer","TemplatedImageLayer","imageLayer","url","location","size","angle","ImageLayer","mapMLLayer","node","MapMLLayer","debugOverlay","DebugOverlay","FeatureGroup","native","static","create","pane","addClass","renderer","query","_mapmlFeatures","features","getNativeVariables","nativeCS","cs","addData","_leafletLayer","_features","_staticFeature","_resetFeatures","_addZoomLimit","showPaginationFeature","remove","featureIndex","cleanIndex","featureGroupLayer","_leaflet_id","zoomend","_handleZoomEnd","feature","type","_extentEl","shadowRoot","replaceChildren","clearLayers","_featureGroup","popup","_navigationBar","innerText","_totalFeatureCount","_content","srcdoc","innerHTML","currFeature","once","withinZoom","_removeCSS","k","checkRender","_checkRender","hasLayer","addLayer","placeholder","defaultOptions","group","parentNode","replaceWith","id","insertAdjacentElement","_setZoomTransform","center","clampZoom","scale","getZoomScale","translate","multiplyBy","subtract","_getNewPixelOrigin","round","any3d","setTransform","setPosition","len","nodeType","Node","DOCUMENT_NODE","nodeName","base","hasAttribute","URL","href","_parseStylesheetAsHTML","_DOMnode","cloneNode","filter","classList","title","properties","add","insertAdjacentHTML","geometryToLayer","color","resetStyle","onEachFeature","bindTooltip","interactive","sticky","featureZoom","toUpperCase","_groupEl","Util","_setLayerStyle","setStyle","eachLayer","toDelete","querySelectorAll","removeChild","vectorOptions","geometry","svgGroup","SVG","copyOptions","assign","geo","path","featureID","wrappers","_getGeometryParents","groupOptions","mapmlFeature","accessibleTitle","collections","subType","elems","concat","TileLayer","inputData","_extractInputBounds","extentBounds","tms","opacity","_setUpTileTemplateVars","_template","_initContainer","_updateZIndex","mapBounds","linkEl","dispatchEvent","CustomEvent","detail","appendTile","startsWith","_url","includes","_fetchTile","_mapmlTileReady","getPane","fetch","getTileUrl","redirect","then","response","status","Promise","resolve","console","log","reject","text","DOMParser","parseFromString","_createFeatures","catch","markup","svg","g","xOffset","yOffset","groupID","tileFeatures","FeatureRenderer","_initPath","_project","_addPath","_updateFeature","toString","tilematrix","contains","v","zoomInput","_getZoomForUrl","pcrs","easting","left","_tileMatrixToPCRSPosition","right","northing","top","bottom","indexOf","infinite","invertedY","_globalTileRange","r","detectRetina","Browser","retina","pos","nwPoint","scaleBy","sePoint","centrePoint","floor","nw","transformation","untransform","se","cen","result","Point","east","north","inputs","values","units","axis","position","select","toLowerCase","horizontal","resolutions","isNaN","Number","parseFloat","vertical","match","parseInt","parsedselect","htmlselect","pcrs2tilematrix","c","transform","divideBy","bind","boundsToPCRSBounds","axisToCS","pcrsBounds","zmin","zmax","_clampZoom","clamp","step","Layer","_templates","rel","setZIndex","extentZIndex","errorTileUrl","hasSetBoundsHandler","_queries","extentEl","_setupQueryVars","zoomstart","_onZoomStart","redraw","closePopup","queryVarNames","pixelleft","tileleft","mapleft","pixelright","tileright","mapright","pixeltop","tiletop","maptop","pixelbottom","tilebottom","mapbottom","tilei","mapi","tilej","mapj","reset","addToMap","old_templates","undefined","_previousFeature","_count","_nextFeature","_source","changeOpacity","_setUpFeaturesTemplateVars","_onMoveEnd","featureRenderer","bindPopup","autoClose","minWidth","parent","history","_history","current","previous","steppedZoom","headers","parser","context","_pullFeatureFeed","scaleBounds","getCenter","_getfeaturesUrl","Headers","Accept","limit","el","_nativeZoom","_nativeCS","content","append","_updateTabIndex","error","layerNum","_path","childElementCount","getSize","_TCRSToPCRS","featuresVarNames","hidden","_setUpExtentTemplateVars","_clearLayer","_onAdd","containerImages","_addImage","loc","overlayToRemove","_imageOverlay","getImageUrl","_step","addTo","_overlayToRemove","_scaleImage","_image","_pixelOrigins","getPixelOrigin","pixelOrigin","_removeZoomLimit","extent","extentVarNames","ImageOverlay","_location","_size","_angle","viewreset","_reset","_zoomAnimated","zoomanim","_animateZoom","load","_onImageLoad","_initImage","addInteractiveTarget","removeInteractiveTarget","loaded","Date","_updateOpacity","image","nextFrame","fade","now","setOpacity","cancelAnimFrame","_fadeFrame","requestAnimFrame","maxNext","layerEl","_href","local","_imageContainer","_mapmlTileContainer","_initialize","_validateExtent","validProjection","getHref","_removeExtents","_changeOpacity","_opacity","opacityEl","_changeExtentOpacity","_templateVars","_changeExtent","_setLayerElExtent","stopPropagation","titleIsReadOnly","_titleIsReadOnly","setName","newName","_title","_mapmlLayerItem","getName","_validProjection","_mapmlvectors","_imageLayer","layerGroup","_staticTileLayer","createAndAdd","_templatedLayer","_attachSkipButtons","noLayer","projectionMatch","getProjection","zoomMax","zoomMin","forEach","tempExtentBounds","extentZoomBounds","_convertAndFormatPCRS","_onZoomAnim","toZoom","getMinZoom","getMaxZoom","zoomout","zoomin","getAttribution","attribution","_createLayerControlHTML","fieldset","layerItemName","settingsButtonNameIcon","layerItemProperty","layerItemSettings","itemToggleLabel","layerItemControls","opacityControl","opacityControlSummary","svgSettingsControlIcon","settingsControlPath1","settingsControlPath2","extentsFieldset","removeControlButton","stop","root","nextElementSibling","disbaled","previousElementSibling","firstElementChild","itemSettingControlButton","_layerControl","defaultChecked","_legendUrl","legendLink","draggable","ontouchstart","onmousedown","downEvent","TouchEvent","touches","control","controls","moving","yPos","clientY","body","ontouchmove","onmousemove","moveEvent","offset","abs","getBoundingClientRect","pointerEvents","clientX","elementAt","elementFromPoint","swapControl","offsetHeight","nextSibling","insertBefore","ontouchend","onmouseup","controlsElems","_layer","_styles","_userInputs","frag","createDocumentFragment","selectdetails","selectsummary","mapmlInput","selectSummaryLabel","allHidden","_layerItemSettingsHTML","_propertiesGroupAnatomy","baseURI","createLayerControlExtentHTML","mapExtent","extentProperties","extentSettings","extentLabel","svgExtentControlIcon","extentControlPath1","extentControlPath2","extentNameIcon","extentItemControls","extentOpacitySummary","removeExtentButton","allRemoved","removed","extentsettingsButton","opacityValue","extentItemNameSpan","_initTemplateVars","serverExtent","metaExtent","templateVars","tlist","varNamesRe","RegExp","includesZoom","extentFallback","metaKeys","axes","csToAxes","fallbackProjection","OSMTILE","t","vcount","trel","ttype","exec","div","varName","inp","axisBounds","convertPCRSBounds","axisToXY","outerHTML","element","elementAttrNames","getAttributeNames","option","optionAttrNames","transcribe","queryable","decodeURI","extentPCRSFallback","mapprojection","extentProj","extents","attributes","isMatch","getProjectionFrom","Array","from","determineLayerProjection","selectedAlternate","selectMatchingAlternateProjection","processExtents","styleLinks","stylesControl","stylesControlSummary","changeStyle","styleOption","styleOptionInput","styleOptionLabel","getAlternateStyles","licenseLink","licenseTitle","licenseUrl","attText","attributionControl","addAttribution","parseLicenseAndLegend","textContent","trim","Element","setLayerTitle","setZoomInOrOutLinks","newTiles","nt","importNode","processTiles","processFeatures","elements","resolvedURL","baseURL","copyRemoteContentToShadowRoot","_toggleControls","lp","getQueryTemplates","pcrsClick","layerAndExtents","queryTemplate","_eventParents","attachZoomLink","mapFocusButton","_sortIndex","previousButton","featureCount","totalFeatures","nextButton","controlFocusButton","currentIndex","inBoundFeatures","_controlContainer","divider","focusFeature","focusEvent","composedPath","isTab","keyCode","shiftPressed","shiftKey","focusMap","_popupClosed","featureEl","_groupLayer","_featureEl","whenReady","tL","topLeft","gcrs","bR","bottomRight","latLngBounds","latLng","zoomLink","lng","lat","locale","popupZoom","onclick","onkeydown","MouseEvent","zoomTo","getContainer","link","featureIndexOverlayOption","removeHandlers","removeEvent","mapSize","_panel","debugPanel","_grid","debugGrid","_panes","mapPane","_vectors","debugVectors","toolPane","DebugPanel","debug","_infoContainer","_debugContainer","infoContainer","_tileCoord","_tileMatrixCoord","_mapCoord","_tcrsCoord","_pcrsCoord","_gcrsCoord","_updateCoords","_visible","project","pointI","pointJ","trunc","toFixed","DebugGrid","join","outline","DebugVectors","LayerGroup","_mapLayerUpdate","_centerVector","circle","pointToLatLng","radius","_addBounds","colors","boundsArray","boundsRect","projectedExtent","weight","fillOpacity","fill","totalLayerBounds","totalBoundsArray","totalBounds","ProjectedExtent","Path","unproject","_locations","locations","_rings","_subtract","_parts","_renderer","_updatePoly","QueryHandler","Handler","addHooks","_queryTopLayer","_queryTopLayerAtMapCenter","removeHooks","_getTopQueryableLayer","l","mapmlLayer","event","isFocused","layerPoint","latLngToLayerPoint","latLngToContainerPoint","_query","tcrs2pcrs","tcrs2gcrs","popupOptions","autoPan","maxHeight","tcrsClickLoc","latLngToPoint","tileMatrixClickLoc","tileBounds","Bounds","ceil","fetches","column","longitude","latitude","contenttype","get","Error","mapmldoc","slice","queryMetas","geom","err","message","fetchFeatures","allSettled","f","results","openPopup","_popup","displayFeaturesPopup","ContextMenu","_touchstart","msPointer","pointer","activeIndex","excludedIndices","isRunned","_menuItems","CTXBACK","CTXFWD","CTXRELOAD","CTXFULLSCR","CTXSPACER1","CTXCOPY","CTXPASTE","CTXSPACER2","CTXCNTRLS","CTXDEBUG","CTXVWSRC","_items","cmBack","callback","_goBack","cmForward","_goForward","cmReload","_reload","btnFullScreen","_toggleFullScreen","spacer","cmCopyCoords","_copyCoords","hideOnSelect","submenu","cmCopyMapML","_copyMapML","cmCopyExtent","_copyExtent","cmCopyLocation","_copyLocation","cmPasteLayer","_paste","cmToggleControls","cmToggleDebug","_toggleDebug","cmViewSource","_viewSource","defExtCS","defaultExtCoor","defLocCS","defaultLocCoor","LYRZOOMTO","LYRCOPY","_layerItems","lmZoomToLayer","_zoomToLayer","lmCopyLayer","_copyLayer","_mapMenuVisible","_keyboardEvent","_createItem","_copySubMenu","_clickEvent","CPYMENUMAP","CPYMENUEXTENT","CPYMENULOC","_hide","_onKeyDown","touch","contextmenu","_show","mousedown","_updateCS","KeyboardEvent","coord","data","_copyData","_layerClicked","layerElem","getOuterHTML","forward","back","reload","replace","navigator","clipboard","readText","_pasteLayer","viewSource","toggleDebug","directory","_showCopySubMenu","execCommand","menu","_copyTile","_copyTileMatrix","_copyMap","_copyTCRS","_copyPCRS","_copyGCRS","click","caption","h2","pt","pointX","pointY","mapPt","_copyAllCoords","allData","index","_createSeparator","_insertElementAt","_createEventHandler","_onItemMouseOver","_onItemMouseOut","func","_showLocation","containerPointToLayerPoint","layerPointToLatLng","refEl","_showAtPoint","layerList","find","gecko","w","h","button","activeEl","activeElement","_elementInFocus","_layerMenuTabs","firstChild","_setPosition","anchor","containerSize","_getElementSize","contextmenuAnchor","_leaflet_pos","_sizeChanged","offsetWidth","_focusOnLayerControl","_setActiveItem","noActiveEl","next","nextIndex","prevIndex","code","copyEl","menuWidth","submenuWidth","_hideCopySubMenu","srcElement","toggleContextMenuItem","state","setViewFullScreenInnerHTML","btnExitFullScreen","tcrsTopLeft","tcrsBottomRight","tileMatrixTopLeft","tileMatrixBottomRight","minConverted","maxConverted","unprojectedMin","unprojectedMax","tcrs","boundsUnit","defaultMaxZoom","nativeMinZoom","nativeMaxZoom","locInputs","numberOfAxes","isFinite","minPixel","maxPixel","minGCRS","maxGCRS","pixelToPCRSPoint","pointToPCRSPoint","contentArray","stringSplit","prop","containerPoints","pairs","styleElm","ss","stylesheets","linkElm","s","array","a","_parseNumber","leafletLayer","justPan","hash","inPlace","window","open","postTraversalSetup","lon","nMin","nMax","mapmlEl","dfLayer","lastElementChild","lastChild","dfPastedLayer","geojson2mapml","JSON","parse","json","table","thead","createTHead","insertRow","th1","th2","createTextNode","tbody","createTBody","hasOwnProperty","th","td","bboxExtent","geometryFunction","jsonType","out","setExtent","bbox","xmlStringLayer","multiPoint","linestring","multilinestring","polygon","multiPolygon","geometrycollection","Infinity","NEGATIVE_INFINITY","clone_feature","curr_feature","featureCaption","p","HTMLElement","_properties2Table","_updateExtent","coordinates","clone_point","clone_coords","clone_linestring","linestring_coordindates","clone_polygon","clone_multipoint","clone_multilinestring","m","geometries","fg","arr","arrayOfArrays","test","tableData","tr","source","dest","pointConv","proj4","_breakArray","_pcrsToGcrs","poly","newArr","conv","propertyFunction","Proj","metas","ex","num","_table2properties","prop0","_geometry2geojson","geoms","n","bound","newZoom","mapCenterTCRS","mapHalf","mapTlNew","mapBrNew","mapTlPCRSNew","mapBrPCRSNew","mapPCRS","zOffset","AttributionButton","Attribution","prefix","disableClickPropagation","_addAttribution","dialog","kbdShortcuts","kbdMovement","kbdPanUp","kbdPanDown","kbdPanLeft","kbdPanRight","btnZoomIn","btnZoomOut","kbdPanIncrement","kbdZoom","kbdFeature","kbdPrevFeature","kbdNextFeature","attribs","_attributions","prefixAndAttribs","btnAttribution","Map","mergeOptions","toggleableAttributionControl","addInitHook","attributionButton","reloadButton","ReloadButton","scaleBar","ScaleBar","_goReload","_reloadButton","_updateDisabled","disable","_disabled","enable","Scale","maxWidth","updateWhenIdle","scaleControl","_scaleControl","_updateOutput","_focusOutput","addEventListener","_pixelsToDistance","px","dpi","devicePixelRatio","_scaleLength","scaleLength","outputFocus","output","scaleLine","distance","metric","FullscreenButton","false","true","_toggleTitle","_click","toggleFullscreen","isFullscreen","include","_isFullscreen","getRootNode","host","pseudoFullscreen","_disablePseudoFullscreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","_enablePseudoFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","ALLOW_KEYBOARD_INPUT","msRequestFullscreen","_setFullscreen","fullscreen","invalidateSize","_onFullscreenChange","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","fullscreenControl","fullscreenchange","onFullscreenChange","addControl","fullscreenButton","geolocationButton","GeolocationButton","crosshair","Crosshair","Geometry","CustomLocate","Locate","start","locateControl","showPopup","strings","btnLocTrackOff","locateOptions","MutationObserver","mutations","btnLocTrackOn","_marker","btnMyLocTrackOn","permanent","btnLocTrackLastKnown","btnMyLastKnownLocTrackOn","observe","attributeFilter","_isQueryable","_toggleEvents","_isMapFocused","_addOrRemoveCrosshair","_hasQueryableLayer","_addOrRemoveMapOutline","mapContainer","_outline","isLeafletContainer","_convertWrappers","_markup","_convertMarkup","_generateOutlinePoints","isClosed","_isClosed","attachLinkHandler","dragStart","hovered","handleMouse","visited","mouseup","onTop","nextLayer","eventPhase","Event","BUBBLING_PHASE","sqrt","pow","_handleLink","currentTarget","resolver","mapWidth","clientWidth","substring","mouseout","mouseenter","addedMap","tileOrigin","zoomingTo","origin","pixelRings","_convertRing","rings","subP","subrings","pixelSubrings","pixelOutline","o","parts","sub","interm","points","attr","featureAttributes","tabindex","first","ring","subRings","_coordinateToArrays","cls","class","nodes","childNodes","cur","tempDiv","prev","line","ind","main","subParts","isFirst","parents","span","noSpan","numPair","attrMap","wrapperAttr","unshift","linkTarget","linkType","getPCRSCenter","stampLayer","outlinePath","_createPath","stroke","_updateStyle","entries","_rootGroup","outlineAdded","_removePath","_setPath","geometryToPath","_pointToMarker","_updatePathStyle","isMain","isOutline","lineCap","lineJoin","dashArray","dashOffset","fillColor","fillRule","def","closed","str","len2","firstLayer","_openPopup","_handleFocus","updateInteraction","layerID","addToIndex","part","subPart","vectorMinZoom","vectorMaxZoom","openTooltip","closeTooltip","prevFocus","nextFocus","AnnounceMovement","layeradd","layerremove","announceBounds","dragging","_draggable","dragged","focusAnnouncement","removeEventListener","_gcrsToTileMatrix","standard","amZoom","_layersMaxZoom","amMaxZoom","_layersMinZoom","amMinZoom","_traversalCall","visible","outOfBoundsPos","prevZoom","_historyIndex","inBoundsPos","pop","amZoomedOut","wasDragged","amDraggedOut","amEastBound","amWestBound","amNorthBound","amSouthBound","FeatureIndex","outBoundFeatures","_mapPCRSBounds","_updateMapBounds","lc","mc","dist","tmp","inbound","sort","b","ac","bc","Options","announceMovement","announceScale","imperial","lcOpacity","amColumn","amRow","fIndexNoFeatures","Keyboard","altKey","metaKey","_panKeys","_panAnim","_inProgress","ctrlKey","panBy","maxBounds","panInsideBounds","_zoomKeys","187","107","61","171","189","109","54","173","setZoom","closeOnEscapeKey","featureIndexOverlay","FeatureIndexOverlay","_output","_body","initialFocus","_addOrRemoveFeatureIndex","_checkOverlap","_calculateReticleBounds","wRatio","hRatio","reticleDimension","getComputedStyle","minPoint","maxPoint","popupClosed","featureIndexBounds","noFeaturesMessage","allFeatures","_addToggleKeys","_newContent","direction","newContent","detectImagePath","getStyle","mime","mapOptions","head","WGS84","CRS","CBMTILE","APSTILE","EPSG3857","_splitCoordinate","_coordsToArray","mapml2geojson","getBounds","getZoomBounds"],"mappings":"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"}