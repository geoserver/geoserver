/* (c) 2021 Open Source Geospatial Foundation - all rights reserved
 * This code is licensed under the GPL 2.0 license, available at the root
 * application directory.
 * Copyright © 2019 World Wide Web Consortium, (Massachusetts Institute of Technology, 
 * European Research Consortium for Informatics and Mathematics, Keio    
 * University, Beihang). All Rights Reserved. This work is distributed under the 
 * W3C® Software License [1] in the hope that it will be useful, but WITHOUT ANY 
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR 
 * A PARTICULAR PURPOSE.
 * [1] http://www.w3.org/Consortium/Legal/copyright-software
 * 
 */
/*! @maps4html/web-map-custom-element 24-07-2021 */

!function(){"use strict";function t(t){return new i(t)}function e(t,e){return new o(t,e)}var i=L.GridLayer.extend({initialize:function(t){this.zoomBounds=this._getZoomBounds(t.tileContainer,t.maxZoomBound),L.extend(t,this.zoomBounds),L.setOptions(this,t),this._groups=this._groupTiles(this.options.tileContainer.getElementsByTagName("map-tile"))},onAdd:function(){this._bounds=this._getLayerBounds(this._groups,this._map.options.projection),this.layerBounds=this._bounds[Object.keys(this._bounds)[0]];for(var t of Object.keys(this._bounds))this.layerBounds.extend(this._bounds[t].min),this.layerBounds.extend(this._bounds[t].max);L.GridLayer.prototype.onAdd.call(this,this._map),this._handleMoveEnd()},getEvents:function(){let t=L.GridLayer.prototype.getEvents.call(this,this._map);return this._parentOnMoveEnd=t.moveend,t.moveend=this._handleMoveEnd,t.move=()=>{},t},_handleMoveEnd:function(t){var e=this._map.getZoom();let i=e;i=i>this.options.maxNativeZoom?this.options.maxNativeZoom:i,i=i<this.options.minNativeZoom?this.options.minNativeZoom:i,this.isVisible=e<=this.zoomBounds.maxZoom&&e>=this.zoomBounds.minZoom&&this._bounds[i]&&this._bounds[i].overlaps(M.pixelToPCRSBounds(this._map.getPixelBounds(),this._map.getZoom(),this._map.options.projection)),this.isVisible&&this._parentOnMoveEnd()},_isValidTile(t){return this._groups[this._tileCoordsToKey(t)]},createTile:function(t){let i=this._groups[this._tileCoordsToKey(t)]||[],o=document.createElement("map-tile"),n=this.getTileSize();o.setAttribute("col",t.x),o.setAttribute("row",t.y),o.setAttribute("zoom",t.z);for(let e=0;e<i.length;e++){let t=document.createElement("img");t.width=n.x,t.height=n.y,t.alt="",t.setAttribute("role","presentation"),t.src=i[e].src,o.appendChild(t)}return o},_getLayerBounds:function(t,e){let i={},o=M[e].options.crs.tile.bounds.max.x;for(var n in t){let t=n.split(":"),e={};e.x=+t[0]*o,e.y=+t[1]*o,e.z=+t[2],t[2]in i?(i[t[2]].extend(L.point(e.x,e.y)),i[t[2]].extend(L.point(e.x+o,e.y+o))):i[t[2]]=L.bounds(L.point(e.x,e.y),L.point(e.x+o,e.y+o))}for(var a in i){var s=+a;i[a]=M.pixelToPCRSBounds(i[a],s,e)}return i},_getZoomBounds:function(t,e){if(!t)return null;let i=M.metaContentToObject(t.getElementsByTagName("map-tiles")[0].getAttribute("zoom")),o={},n=t.getElementsByTagName("map-tile");o.nativeZoom=+i.value||0,o.maxNativeZoom=0,o.minNativeZoom=e;for(let e=0;e<n.length;e++){let t=+n[e].getAttribute("zoom");n[e].getAttribute("zoom")||(t=o.nativeZoom),o.minNativeZoom=Math.min(o.minNativeZoom,t),o.maxNativeZoom=Math.max(o.maxNativeZoom,t)}return o.minZoom=o.minNativeZoom-2<=0?0:o.minNativeZoom-2,o.maxZoom=e,i.min&&(o.minZoom=+i.min<o.minNativeZoom-2?o.minNativeZoom-2:+i.min),i.max&&(o.maxZoom=+i.max),o},_groupTiles:function(i){let o={};for(let e=0;e<i.length;e++){let t={};t.row=+i[e].getAttribute("row"),t.col=+i[e].getAttribute("col"),t.zoom=+i[e].getAttribute("zoom")||this.options.nativeZoom,t.src=i[e].getAttribute("src");var n=t.col+":"+t.row+":"+t.zoom;n in o?o[n].push(t):o[n]=[t]}return o}}),o=L.Control.Layers.extend({options:{autoZIndex:!1,sortLayers:!0,sortFunction:function(t,e){return t.options.zIndex<e.options.zIndex?-1:t.options.zIndex>e.options.zIndex?1:0}},initialize:function(t,e){for(var i in L.setOptions(this,e),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[i],i,!0)},onAdd:function(){return this._initLayout(),this._map.on("validate",this._validateInput,this),L.DomEvent.on(this.options.mapEl,"layerchange",this._validateInput,this),L.DomEvent.on(this._container,"keydown",this._focusFirstLayer,this._container),this._update(),this._layers.length<1&&!this._map._showControls?this._container.setAttribute("hidden",""):this._map._showControls=!0,this._container},onRemove:function(t){t.off("validate",this._validateInput,this),L.DomEvent.off(this._container,"keydown",this._focusFirstLayer,this._container);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this),this._layers[e].layer.off("extentload",this._validateInput,this)},addOrUpdateOverlay:function(t,e){for(var i=!1,o=0;o<this._layers.length;o++)if(this._layers[o].layer===t){i=!0,this._layers[o].name=e;break}return i||this.addOverlay(t,e),0<this._layers.length&&(this._container.removeAttribute("hidden"),this._map._showControls=!0),this._map?this._update():this},removeLayer:function(t){L.Control.Layers.prototype.removeLayer.call(this,t),0===this._layers.length&&this._container.setAttribute("hidden","")},_validateInput:function(t){for(let o=0;o<this._layers.length;o++)if(this._layers[o].input.labels[0]){let t=this._layers[o].input.labels[0].getElementsByTagName("span"),e=this._layers[o].input.labels[0].getElementsByTagName("input");if(e[0].checked=this._layers[o].layer._layerEl.checked,this._layers[o].layer._layerEl.disabled&&this._layers[o].layer._layerEl.checked?(e[0].closest("fieldset").disabled=!0,t[0].style.fontStyle="italic"):(e[0].closest("fieldset").disabled=!1,t[0].style.fontStyle="normal"),this._layers[o].layer._extent&&this._layers[o].layer._extent._mapExtents)for(let i=0;i<this._layers[o].layer._extent._mapExtents.length;i++){let t=this._layers[o].layer._extent._mapExtents[i].extentAnatomy,e=t.getElementsByClassName("mapml-layer-item-name")[0];this._layers[o].layer._extent._mapExtents[i].disabled&&this._layers[o].layer._extent._mapExtents[i].checked?(e.style.fontStyle="italic",t.disabled=!0):(e.style.fontStyle="normal",t.disabled=!1)}}},_focusFirstLayer:function(t){var e;"Enter"!==t.key||"leaflet-control-layers leaflet-control leaflet-control-layers-expanded"==this.className||(e=this.children[1].children[2].children[0].children[0].children[0].children[0])&&setTimeout(()=>e.focus(),0)},_withinZoomBounds:function(t,e){return e.min<=t&&t<=e.max},_addItem:function(t){var e=t.layer.getLayerUserControlsHTML();return t.input=e.querySelector("input"),this._layerControlInputs.push(t.input),t.input.layerId=L.stamp(t.layer),L.DomEvent.on(t.input,"click",this._onInputClick,this),t.layer.on("extentload",this._validateInput,this),this._overlaysList.appendChild(e),e},collapse:function(t){return"SELECT"===t.target.tagName||t.relatedTarget&&t.relatedTarget.parentElement&&("mapml-contextmenu mapml-layer-menu"===t.relatedTarget.className||"mapml-contextmenu mapml-layer-menu"===t.relatedTarget.parentElement.className)||this._map&&"block"===this._map.contextMenu._layerMenu.style.display||L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this}});const B="OSMTILE",d="TILEMATRIX",P="mapmltemplatedtileplaceholder";function n(t,e){return new h(t,e)}function a(t,e){return new _(t,e)}function s(t,e){return new y(t,e)}function r(t,e){return new x(t,e)}function l(t,e){return new g(t,e)}function m(t,e,i,o,n,a){return new f(t,e,i,o,n,a)}function u(t,e,i){return t||e?new b(t,e,i):null}function p(){return new v}function c(t){return new J(t)}var h=L.FeatureGroup.extend({initialize:function(t,e){var i;L.setOptions(this,e),this.options.static&&(this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"leaflet-pane mapml-vector-container"),L.setOptions(this.options.renderer,{pane:this._container})),this._layers={},this.options.query&&(this._mapmlFeatures=t.features||t,this.isVisible=!0,i=this._getNativeVariables(t),this.options.nativeZoom=i.zoom,this.options.nativeCS=i.cs),t&&!this.options.query&&(i=this._getNativeVariables(t),!t.querySelector("map-extent")&&t.querySelector("map-feature")&&this.options.static&&(this._features={},this._staticFeature=!0,this.isVisible=!0,this.zoomBounds=this._getZoomBounds(t,i.zoom),this.layerBounds=this._getLayerBounds(t),L.extend(this.options,this.zoomBounds)),this.addData(t,i.cs,i.zoom),this._staticFeature&&(this._resetFeatures(this._clampZoom(this.options._leafletLayer._map.getZoom())),this.options._leafletLayer._map._addZoomLimit(this)))},onAdd:function(t){L.FeatureGroup.prototype.onAdd.call(this,t),this._mapmlFeatures&&t.on("featurepagination",this.showPaginationFeature,this)},onRemove:function(t){this._mapmlFeatures&&(t.off("featurepagination",this.showPaginationFeature,this),delete this._mapmlFeatures,L.DomUtil.remove(this._container)),L.FeatureGroup.prototype.onRemove.call(this,t),this._map.featureIndex.cleanIndex()},getEvents:function(){return this._staticFeature?{moveend:this._handleMoveEnd,zoomend:this._handleZoomEnd}:{moveend:this._removeCSS}},showPaginationFeature:function(e){if(this.options.query&&this._mapmlFeatures[e.i]){let t=this._mapmlFeatures[e.i];this.clearLayers(),this.addData(t,this.options.nativeCS,this.options.nativeZoom),e.popup._navigationBar.querySelector("p").innerText=e.i+1+"/"+this.options._leafletLayer._totalFeatureCount,e.popup._content.querySelector("iframe").setAttribute("sandbox","allow-same-origin allow-forms"),e.popup._content.querySelector("iframe").srcdoc=t.querySelector("map-properties").innerHTML}},_getNativeVariables:function(t){return{zoom:t.querySelector&&t.querySelector("map-meta[name=zoom]")&&+M.metaContentToObject(t.querySelector("map-meta[name=zoom]").getAttribute("content")).value||0,cs:t.querySelector&&t.querySelector("map-meta[name=cs]")&&M.metaContentToObject(t.querySelector("map-meta[name=cs]").getAttribute("content")).content||"PCRS"}},_handleMoveEnd:function(){var t=this._map.getZoom(),e=t<=this.zoomBounds.maxZoom&&t>=this.zoomBounds.minZoom;this.isVisible=e&&this._layers&&this.layerBounds&&this.layerBounds.overlaps(M.pixelToPCRSBounds(this._map.getPixelBounds(),t,this._map.options.projection)),this._removeCSS()},_handleZoomEnd:function(t){var e=this._map.getZoom();e>this.zoomBounds.maxZoom||e<this.zoomBounds.minZoom?this.clearLayers():(e=this._clampZoom(e),this._resetFeatures(e))},_getLayerBounds:function(t){if(!t)return null;let i=d,o=t.querySelector("map-meta[name=projection]")&&M.metaContentToObject(t.querySelector("map-meta[name=projection]").getAttribute("content")).content.toUpperCase()||B;try{var n=t.querySelector("map-meta[name=extent]")&&M.metaContentToObject(t.querySelector("map-meta[name=extent]").getAttribute("content")),a=n.zoom||0;let e=Object.keys(n);for(let t=0;t<e.length;t++)if(!e[t].includes("zoom")){i=M.axisToCS(e[t].split("-")[2]);break}var s=M.csToAxes(i);return M.boundsToPCRSBounds(L.bounds(L.point(+n["top-left-"+s[0]],+n["top-left-"+s[1]]),L.point(+n["bottom-right-"+s[0]],+n["bottom-right-"+s[1]])),a,o,i)}catch(t){return M.boundsToPCRSBounds(M[o].options.crs.tilematrix.bounds(0),0,o,i)}},_resetFeatures:function(e){if(this.clearLayers(),this._map&&this._map.featureIndex.cleanIndex(),this._features&&this._features[e])for(let t=0;t<this._features[e].length;t++)this.addLayer(this._features[e][t])},_clampZoom:function(t){return t>this.zoomBounds.maxZoom||t<this.zoomBounds.minZoom?t:void 0!==this.zoomBounds.minNativeZoom&&t<this.zoomBounds.minNativeZoom?this.zoomBounds.minNativeZoom:void 0!==this.zoomBounds.maxNativeZoom&&this.zoomBounds.maxNativeZoom<t?this.zoomBounds.maxNativeZoom:t},_setZoomTransform:function(t,e){var i=this._map.getZoomScale(this._map.getZoom(),e),t=t.multiplyBy(i).subtract(this._map._getNewPixelOrigin(t,this._map.getZoom())).round();any3d?L.setTransform(this._layers[e],t,i):L.setPosition(this._layers[e],t)},_getZoomBounds:function(t,i){if(!t)return null;let o=100,n=0,a=t.getElementsByTagName("map-feature"),e,s;for(let e=0;e<a.length;e++){let t=+a[e].getAttribute("zoom");a[e].getAttribute("zoom")||(t=i),n=Math.max(n,t),o=Math.min(o,t)}try{s=M.metaContentToObject(t.querySelector("map-meta[name=projection]").getAttribute("content")).content,e=M.metaContentToObject(t.querySelector("map-meta[name=zoom]").getAttribute("content"))}catch(t){return{minZoom:0,maxZoom:M[s||B].options.resolutions.length-1,minNativeZoom:o,maxNativeZoom:n}}return{minZoom:+e.min,maxZoom:+e.max,minNativeZoom:o,maxNativeZoom:n}},addData:function(o,n,a){var t,e,i,s=o.nodeType===Node.DOCUMENT_NODE||"LAYER-"===o.nodeName?o.getElementsByTagName("map-feature"):null;if((o.nodeType===Node.DOCUMENT_NODE?o.querySelector("map-link[rel=stylesheet],map-style"):null)&&(r=o.querySelector("map-base")&&o.querySelector("map-base").hasAttribute("href")?new URL(o.querySelector("map-base").getAttribute("href")).href:o.URL,M.parseStylesheetAsHTML(o,r,this._container)),s){for(t=0,e=s.length;t<e;t++)(i=s[t]).getElementsByTagName("map-geometry").length&&i.getElementsByTagName("map-coordinates").length&&this.addData(i,n,a);return this}var r=this.options;if(!r.filter||r.filter(o)){o.classList.length&&(r.className=o.classList.value);let t=o.getAttribute("zoom")||a,e=o.querySelector("map-featurecaption");e=e?e.innerHTML:"Feature",o.querySelector("map-properties")&&(r.properties=document.createElement("div"),r.properties.classList.add("mapml-popup-content"),r.properties.insertAdjacentHTML("afterbegin",o.querySelector("map-properties").innerHTML));let i=this.geometryToLayer(o,r,n,+t,e);if(i){if(!i.options.color&&o.hasAttribute("class")&&(i.options.className=o.getAttribute("class")),i.defaultOptions=i.options,this.resetStyle(i),r.onEachFeature&&i.bindTooltip(e,{interactive:!0,sticky:!0}),!this._staticFeature)return this.addLayer(i);o=o.getAttribute("zoom")||a;o in this._features?this._features[o].push(i):this._features[o]=[i]}}},resetStyle:function(t){var e=this.options.style;e&&(L.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(e){this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)},_removeCSS:function(){var e=this._container.querySelectorAll("link[rel=stylesheet],style");for(let t=0;t<e.length;t++)this._container.removeChild(e[t])},geometryToLayer:function(i,o,t,n,a){let s="MAP-FEATURE"===i.tagName.toUpperCase()?i.getElementsByTagName("map-geometry")[0]:i,r=s?.getAttribute("cs")||t,l=[],m=L.SVG.create("g"),u=Object.assign({},o);if(s){for(var p of s.querySelectorAll("map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint"))l.push(M.feature(p,Object.assign(u,{nativeCS:r,nativeZoom:n,projection:this.options.projection,featureID:i.id,group:m,wrappers:this._getGeometryParents(p.parentElement),featureLayer:this,_leafletLayer:this.options._leafletLayer})));let t={group:m,featureID:i.id,accessibleTitle:a,onEachFeature:o.onEachFeature,properties:o.properties,_leafletLayer:this.options._leafletLayer},e=s.querySelector("map-multipolygon")||s.querySelector("map-geometrycollection");return e&&(t.wrappers=this._getGeometryParents(e.parentElement)),M.featureGroup(l,t)}},_getGeometryParents:function(t,e=[]){return t&&"MAP-GEOMETRY"!==t.tagName.toUpperCase()?"MAP-MULTIPOLYGON"===t.tagName.toUpperCase()||"MAP-GEOMETRYCOLLECTION"===t.tagName.toUpperCase()?this._getGeometryParents(t.parentElement,e):this._getGeometryParents(t.parentElement,e.concat([t])):e}}),_=L.TileLayer.extend({initialize:function(t,e){var i=M.extractInputBounds(t);this.zoomBounds=i.zoomBounds,this.extentBounds=i.bounds,this.isVisible=!0,L.extend(e,this.zoomBounds),e.tms=t.tms,delete e.opacity,L.setOptions(this,e),this._setUpTileTemplateVars(t),t.tile.subdomains&&L.setOptions(this,L.extend(this.options,{subdomains:t.tile.subdomains})),this._template=t,this._initContainer(),L.TileLayer.prototype.initialize.call(this,t.template,L.extend(e,{pane:this._container}))},onAdd:function(){this._map._addZoomLimit(this),L.TileLayer.prototype.onAdd.call(this,this._map),this._handleMoveEnd()},getEvents:function(){let t=L.TileLayer.prototype.getEvents.call(this,this._map);return this._parentOnMoveEnd=t.moveend,t.moveend=this._handleMoveEnd,t},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"mapml-templated-tile-container"),this._updateZIndex())},_handleMoveEnd:function(t){var e=this._map.getZoom(),i=M.pixelToPCRSBounds(this._map.getPixelBounds(),e,this._map.options.projection);this.isVisible=e<=this.options.maxZoom&&e>=this.options.minZoom&&this.extentBounds.overlaps(i),this.isVisible&&this._parentOnMoveEnd()},createTile:function(e){let i=document.createElement("DIV"),o=this.getTileSize();if(L.DomUtil.addClass(i,"mapml-tile-group"),L.DomUtil.addClass(i,"leaflet-tile"),this._template.linkEl.dispatchEvent(new CustomEvent("tileloadstart",{detail:{x:e.x,y:e.y,zoom:e.z,appendTile:t=>{i.appendChild(t)}}})),this._template.type.startsWith("image/")){let t=L.TileLayer.prototype.createTile.call(this,e,function(){});t.width=o.x,t.height=o.y,i.appendChild(t)}else this._url.includes(P)||this._fetchTile(e,i);return i},_mapmlTileReady:function(t){L.DomUtil.addClass(t,"leaflet-tile-loaded")},getPane:function(){return this.options.pane},_fetchTile:function(e,i){fetch(this.getTileUrl(e),{redirect:"follow"}).then(function(t){return 200<=t.status&&t.status<300?Promise.resolve(t):(console.log("Looks like there was a problem. Status Code: "+t.status),Promise.reject(t))}).then(function(t){return t.text()}).then(t=>{return(new DOMParser).parseFromString(t,"application/xml")}).then(t=>{this._createFeatures(t,e,i),this._mapmlTileReady(i)}).catch(t=>{console.log("Error Creating Tile")})},_createFeatures:function(t,e,i){var o;t.querySelector("map-link[rel=stylesheet],map-style")&&(o=t.querySelector("map-base")&&t.querySelector("map-base").hasAttribute("href")?new URL(t.querySelector("map-base").getAttribute("href")).href:t.URL,M.parseStylesheetAsHTML(t,o,i));let n=L.SVG.create("svg"),a=L.SVG.create("g"),s=this._map.options.crs.options.crs.tile.bounds.max.x,r=e.x*s,l=e.y*s;var m,u=M.mapMlFeatures(t,{projection:this._map.options.projection,static:!1,interactive:!1});for(m in u._layers)for(var p in u._layers[m]._layers){let t=u._layers[m]._layers[p];M.FeatureRenderer.prototype._initPath(t,!1),t._project(this._map,L.point([r,l]),e.z),M.FeatureRenderer.prototype._addPath(t,a,!1),M.FeatureRenderer.prototype._updateFeature(t)}n.setAttribute("width",s.toString()),n.setAttribute("height",s.toString()),n.appendChild(a),i.appendChild(n)},getTileUrl:function(t){if(t.z>=this._template.tilematrix.bounds.length||!this._template.tilematrix.bounds[t.z].contains(t))return"";var e,i={};for(e in i[this._template.tilematrix.col.name]=t.x,i[this._template.tilematrix.row.name]=t.y,i[this._template.zoom.name]=this._getZoomForUrl(),i[this._template.pcrs.easting.left]=this._tileMatrixToPCRSPosition(t,"top-left").x,i[this._template.pcrs.easting.right]=this._tileMatrixToPCRSPosition(t,"top-right").x,i[this._template.pcrs.northing.top]=this._tileMatrixToPCRSPosition(t,"top-left").y,i[this._template.pcrs.northing.bottom]=this._tileMatrixToPCRSPosition(t,"bottom-left").y,i[this._template.tile.server]=this._getSubdomain(t),this._template.tile)["row","col","zoom","left","right","top","bottom"].indexOf(e)<0&&(i[e]=this._template.tile[e]);return this._map&&!this._map.options.crs.infinite&&(t=this._globalTileRange.max.y-t.y,this.options.tms&&(i[this._template.tilematrix.row.name]=t)),i.r=this.options.detectRetina&&L.Browser.retina&&0<this.options.maxZoom?"@2x":"",L.Util.template(this._url,i)},_tileMatrixToPCRSPosition:function(t,e){var i=this._map.options.crs,o=this.getTileSize(),n=t.scaleBy(o),a=n.add(o),o=n.add(Math.floor(o/2)),s=i.transformation.untransform(n,i.scale(t.z)),r=i.transformation.untransform(a,i.scale(t.z)),l=i.transformation.untransform(o,i.scale(t.z)),m=null;switch(e){case"top-left":m=s;break;case"bottom-left":m=new L.Point(s.x,r.y);break;case"center-left":m=new L.Point(s.x,l.y);break;case"top-right":m=new L.Point(r.x,s.y);break;case"bottom-right":m=r;break;case"center-right":m=new L.Point(r.x,l.y);break;case"top-center":m=new L.Point(l.x,s.y);break;case"bottom-center":m=new L.Point(l.x,r.y);break;case"center":m=l}return m},_setUpTileTemplateVars:function(t){t.tile={};for(var e,i,o,n,a,s=t.values,r=this.options.crs.options,l=0;l<t.values.length;l++){var m=s[l].getAttribute("type"),u=s[l].getAttribute("units"),p=s[l].getAttribute("axis"),c=s[l].getAttribute("name"),h=s[l].getAttribute("position"),d="hidden"===m&&s[l].hasAttribute("shard"),_="map-select"===s[l].tagName.toLowerCase(),y=s[l].getAttribute("value"),x=s[l].getAttribute("min"),g=s[l].getAttribute("max");if("location"===m&&"tilematrix"===u)switch(p){case"column":a={name:c,min:r.crs.tilematrix.horizontal.min,max:r.crs.tilematrix.horizontal.max(r.resolutions.length-1)},isNaN(Number.parseFloat(x))||(a.min=Number.parseFloat(x)),isNaN(Number.parseFloat(g))||(a.max=Number.parseFloat(g));break;case"row":n={name:c,min:r.crs.tilematrix.vertical.min,max:r.crs.tilematrix.vertical.max(r.resolutions.length-1)},isNaN(Number.parseFloat(x))||(n.min=Number.parseFloat(x)),isNaN(Number.parseFloat(g))||(n.max=Number.parseFloat(g));break;case"longitude":case"easting":i=i||{min:r.crs.pcrs.horizontal.min,max:r.crs.pcrs.horizontal.max},isNaN(Number.parseFloat(x))||(i.min=Number.parseFloat(x)),isNaN(Number.parseFloat(g))||(i.max=Number.parseFloat(g)),h&&(h.match(/.*?-left/i)?i.left=c:h.match(/.*?-right/i)&&(i.right=c));break;case"latitude":case"northing":o=o||{min:r.crs.pcrs.vertical.min,max:r.crs.pcrs.vertical.max},isNaN(Number.parseFloat(x))||(o.min=Number.parseFloat(x)),isNaN(Number.parseFloat(g))||(o.max=Number.parseFloat(g)),h&&(h.match(/top-.*?/i)?o.top=c:h.match(/bottom-.*?/i)&&(o.bottom=c))}else if(m&&"zoom"===m.toLowerCase())e={name:c,min:0,max:r.resolutions.length,value:r.resolutions.length},!isNaN(Number.parseInt(y,10))&&Number.parseInt(y,10)>=e.min&&Number.parseInt(y,10)<=e.max?e.value=Number.parseInt(y,10):e.value=e.max,!isNaN(Number.parseInt(x,10))&&Number.parseInt(x,10)>=e.min&&Number.parseInt(x,10)<=e.max&&(e.min=Number.parseInt(x,10)),!isNaN(Number.parseInt(g,10))&&Number.parseInt(g,10)>=e.min&&Number.parseInt(g,10)<=e.max&&(e.max=Number.parseInt(g,10)),t.zoom=e;else if(d)t.tile.server=c,t.tile.subdomains=s[l].servers.slice();else if(_){const z=s[l].htmlselect;t.tile[c]=function(){return z.value}}else{const k=s[l];t.tile[c]=function(){return k.getAttribute("value")}}}function f(t,e){return b.transform(t,E(e)).divideBy(v).floor()}var b=this.options.crs.transformation,v=this.options.crs.options.crs.tile.bounds.max.x,E=L.bind(this.options.crs.scale,this.options.crs);i&&o?(t.pcrs={},t.pcrs.bounds=L.bounds([i.min,o.min],[i.max,o.max]),t.pcrs.easting=i,t.pcrs.northing=o):a&&n&&!isNaN(e.value)?(t.pcrs||(t.pcrs={},t.pcrs.easting="",t.pcrs.northing=""),t.pcrs.bounds=M.boundsToPCRSBounds(L.bounds(L.point([a.min,n.min]),L.point([a.max,n.max])),e.value,this.options.crs,M.axisToCS("column")),t.tilematrix={},t.tilematrix.col=a,t.tilematrix.row=n):console.log("Unable to determine bounds for tile template: "+t.template),t.tilematrix||(t.tilematrix={},t.tilematrix.col={},t.tilematrix.row={}),t.tilematrix.bounds=[];for(var A=t.pcrs.bounds,C=t.zoom?t.zoom.min:0,S=t.zoom?t.zoom.max:r.resolutions.length,T=0;T<=S;T++)t.tilematrix.bounds[T]=C<=T?L.bounds(f(A.min,T),f(A.max,T)):L.bounds(L.point([-1,-1]),L.point([-1,-1]))}}),y=L.Layer.extend({initialize:function(t,e){this._templates=t,L.setOptions(this,e),this._container=L.DomUtil.create("div","leaflet-layer",e.pane),this._container.style.opacity=this.options.opacity,L.DomUtil.addClass(this._container,"mapml-templatedlayer-container");for(var i,o=0;o<t.length;o++)"tile"===t[o].rel?(this.setZIndex(e.extentZIndex),this._templates[o].layer=M.templatedTileLayer(t[o],L.Util.extend(e,{errorTileUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",zIndex:e.extentZIndex,pane:this._container}))):"image"===t[o].rel?(this.setZIndex(e.extentZIndex),this._templates[o].layer=M.templatedImageLayer(t[o],L.Util.extend(e,{zIndex:e.extentZIndex,pane:this._container}))):"features"===t[o].rel?(this.setZIndex(e.extentZIndex),this._templates[o].layer=M.templatedFeaturesLayer(t[o],L.Util.extend(e,{zIndex:e.extentZIndex,pane:this._container}))):"query"===t[o].rel&&(this.hasSetBoundsHandler=!0,this._queries||(this._queries=[]),i=M.extractInputBounds(t[o]),t[o].extentBounds=i.bounds,t[o].zoomBounds=i.zoomBounds,this._queries.push(L.extend(t[o],this._setupQueryVars(t[o]))))},getEvents:function(){return{zoomstart:this._onZoomStart}},redraw:function(){this.closePopup();for(var t=0;t<this._templates.length;t++)"tile"!==this._templates[t].rel&&"image"!==this._templates[t].rel&&"features"!==this._templates[t].rel||this._templates[t].layer.redraw()},_onZoomStart:function(){this.closePopup()},_setupQueryVars:function(t){for(var e={query:{}},i=t.values,o=0;o<t.values.length;o++){var n=i[o].getAttribute("type"),a=i[o].getAttribute("units"),s=i[o].getAttribute("axis"),r=i[o].getAttribute("name"),l=i[o].getAttribute("position"),m=i[o].getAttribute("rel"),u="map-select"===i[o].tagName.toLowerCase();if("width"===n)e.query.width=r;else if("height"===n)e.query.height=r;else if("location"===n)switch(s){case"x":case"y":case"column":case"row":e.query[s]=r;break;case"longitude":case"easting":l?l.match(/.*?-left/i)?"pixel"===m?e.query.pixelleft=r:"tile"===m?e.query.tileleft=r:e.query.mapleft=r:l.match(/.*?-right/i)&&("pixel"===m?e.query.pixelright=r:"tile"===m?e.query.tileright=r:e.query.mapright=r):e.query[s]=r;break;case"latitude":case"northing":l?l.match(/top-.*?/i)?"pixel"===m?e.query.pixeltop=r:"tile"===m?e.query.tiletop=r:e.query.maptop=r:l.match(/bottom-.*?/i)&&("pixel"===m?e.query.pixelbottom=r:"tile"===m?e.query.tilebottom=r:e.query.mapbottom=r):e.query[s]=r;break;case"i":"tile"===a?e.query.tilei=r:e.query.mapi=r;break;case"j":"tile"===a?e.query.tilej=r:e.query.mapj=r}else if("zoom"===n)e.query.zoom=r;else if(u){const p=i[o].htmlselect;e.query[r]=function(){return p.value}}else{const c=i[o];e.query[r]=function(){return c.getAttribute("value")}}}return e.query.title=t.title,e},reset:function(t,e){if(t&&this._map){var i=this._map&&this._map.hasLayer(this),o=this._templates;delete this._queries,this._map.off("click",null,this),this._templates=t;for(var n=0;n<t.length;n++)"tile"===t[n].rel?this._templates[n].layer=M.templatedTileLayer(t[n],L.Util.extend(this.options,{errorTileUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",zIndex:e,pane:this._container})):"image"===t[n].rel?this._templates[n].layer=M.templatedImageLayer(t[n],L.Util.extend(this.options,{zIndex:e,pane:this._container})):"features"===t[n].rel?this._templates[n].layer=M.templatedFeaturesLayer(t[n],L.Util.extend(this.options,{zIndex:e,pane:this._container})):"query"===t[n].rel&&(this._queries||(this._queries=[]),this._queries.push(L.extend(t[n],this._setupQueryVars(t[n])))),i&&this.onAdd(this._map);for(n=0;n<o.length;n++)this._map.hasLayer(o[n].layer)&&this._map.removeLayer(o[n].layer)}},onAdd:function(t){for(var e=0;e<this._templates.length;e++)"query"!==this._templates[e].rel&&t.addLayer(this._templates[e].layer)},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(t){L.DomUtil.remove(this._container);for(var e=0;e<this._templates.length;e++)"query"!==this._templates[e].rel&&t.removeLayer(this._templates[e].layer)},_previousFeature:function(t){0<=this._count+-1&&(this._count--,this._map.fire("featurepagination",{i:this._count,popup:this}))},_nextFeature:function(t){this._count+1<this._source._totalFeatureCount&&(this._count++,this._map.fire("featurepagination",{i:this._count,popup:this}))},changeOpacity:function(t){this._container.style.opacity=t}}),x=L.Layer.extend({initialize:function(t,e){var i=M.extractInputBounds(t);this.zoomBounds=i.zoomBounds,this.extentBounds=i.bounds,this.isVisible=!0,this._template=t,this._container=L.DomUtil.create("div","leaflet-layer",e.pane),L.extend(e,this.zoomBounds),L.DomUtil.addClass(this._container,"mapml-features-container"),delete e.opacity,L.setOptions(this,L.extend(e,this._setUpFeaturesTemplateVars(t)))},getEvents:function(){return{moveend:this._onMoveEnd}},onAdd:function(){this._map._addZoomLimit(this);var n,t=new Headers({Accept:"text/mapml"}),a=new DOMParser,e=this.options.opacity||1,i=this._container,o=this._map;this._features||(this._features=M.mapMlFeatures(null,{renderer:M.featureRenderer(),pane:i,opacity:e,projection:o.options.projection,static:!0,onEachFeature:function(t,e){var i=document.createElement("div");i.classList.add("mapml-popup-content"),i.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(i,{autoClose:!1,minWidth:108})}}));var s=this._features,r=function(i,o){return fetch(i,{redirect:"follow",headers:t}).then(function(t){return t.text()}).then(function(t){n=a.parseFromString(t,"application/xml");var e=new URL(n.querySelector("map-base")?n.querySelector("map-base").getAttribute("href"):i).href;i=(i=n.querySelector("map-link[rel=next]")?n.querySelector("map-link[rel=next]").getAttribute("href"):null)?new URL(i,e).href:null;t=n.querySelector("map-meta[name=zoom]")&&+M.metaContentToObject(n.querySelector("map-meta[name=zoom]").getAttribute("content")).value||0,e=n.querySelector("map-meta[name=cs]")&&M.metaContentToObject(n.querySelector("map-meta[name=cs]").getAttribute("content")).content||"GCRS";if(s.addData(n,e,t),i&&--o)return r(i,o)})};r(this._getfeaturesUrl(),10).then(function(){o.addLayer(s),o.fire("moveend")}).catch(function(t){console.log(t)})},redraw:function(){this._onMoveEnd()},_onMoveEnd:function(){var n,t,a,s,e,i,r,o=this._map.getZoom(),l=M.pixelToPCRSBounds(this._map.getPixelBounds(),o,this._map.options.projection);this.isVisible=o<=this.zoomBounds.maxZoom&&o>=this.zoomBounds.minZoom&&this.extentBounds.overlaps(l),this._features.clearLayers(),this.isVisible&&(t=new Headers({Accept:"text/mapml;q=0.9,application/geo+json;q=0.8"}),a=new DOMParser,s=this._features,e=this._map,(r=function(i,o){return fetch(i,{redirect:"follow",headers:t}).then(function(t){return t.text()}).then(function(t){n=a.parseFromString(t,"application/xml");var e=new URL(n.querySelector("map-base")?n.querySelector("map-base").getAttribute("href"):i).href;i=(i=n.querySelector("map-link[rel=next]")?n.querySelector("map-link[rel=next]").getAttribute("href"):null)?new URL(i,e).href:null;t=n.querySelector("map-meta[name=zoom]")&&+M.metaContentToObject(n.querySelector("map-meta[name=zoom]").getAttribute("content")).value||0,e=n.querySelector("map-meta[name=cs]")&&M.metaContentToObject(n.querySelector("map-meta[name=cs]").getAttribute("content")).content||"GCRS";if(s.addData(n,e,t),i&&--o)return r(i,o)})})((i=this)._getfeaturesUrl(),10).then(function(){e.addLayer(s),M.TemplatedFeaturesLayer.prototype._updateTabIndex(i)}).catch(function(t){console.log(t)}))},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateTabIndex:function(t){var i,o=t||this;for(i in o._features._layers){let e=o._features._layers[i];if(e._path&&("M0 0"!==e._path.getAttribute("d")?e._path.setAttribute("tabindex",0):e._path.removeAttribute("tabindex"),0===e._path.childElementCount)){let t=document.createElement("title");t.innerText="Feature",e._path.appendChild(t)}}},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(){this._map.removeLayer(this._features)},_getfeaturesUrl:function(){var t,e={};for(t in this.options.feature.zoom&&(e[this.options.feature.zoom]=this._map.getZoom()),this.options.feature.width&&(e[this.options.feature.width]=this._map.getSize().x),this.options.feature.height&&(e[this.options.feature.height]=this._map.getSize().y),this.options.feature.bottom&&(e[this.options.feature.bottom]=this._TCRSToPCRS(this._map.getPixelBounds().max,this._map.getZoom()).y),this.options.feature.left&&(e[this.options.feature.left]=this._TCRSToPCRS(this._map.getPixelBounds().min,this._map.getZoom()).x),this.options.feature.top&&(e[this.options.feature.top]=this._TCRSToPCRS(this._map.getPixelBounds().min,this._map.getZoom()).y),this.options.feature.right&&(e[this.options.feature.right]=this._TCRSToPCRS(this._map.getPixelBounds().max,this._map.getZoom()).x),this.options.feature)["width","height","left","right","top","bottom","zoom"].indexOf(t)<0&&(e[t]=this.options.feature[t]);return L.Util.template(this._template.template,e)},_TCRSToPCRS:function(t,e){var i=this._map.options.crs;return i.transformation.untransform(t,i.scale(e))},_setUpFeaturesTemplateVars:function(t){var e={feature:{}},i=t.values;e.feature.hidden=[];for(var o=0;o<i.length;o++){var n=i[o].getAttribute("type"),a=i[o].getAttribute("units"),s=i[o].getAttribute("axis"),r=i[o].getAttribute("name"),l=i[o].getAttribute("position"),m=(i[o].getAttribute("value"),"map-select"===i[o].tagName.toLowerCase());if("width"===n)e.feature.width=r;else if("height"===n)e.feature.height=r;else if("zoom"===n)e.feature.zoom=r;else if("location"!==n||"pcrs"!==a&&"gcrs"!==a)if(m){const u=i[o].htmlselect;e.feature[r]=function(){return u.value}}else{const p=i[o];e.feature[r]=function(){return p.getAttribute("value")}}else switch(s){case"x":case"longitude":case"easting":l&&(l.match(/.*?-left/i)?e.feature.left=r:l.match(/.*?-right/i)&&(e.feature.right=r));break;case"y":case"latitude":case"northing":l&&(l.match(/top-.*?/i)?e.feature.top=r:l.match(/bottom-.*?/i)&&(e.feature.bottom=r))}}return e}}),g=L.Layer.extend({initialize:function(t,e){this._template=t,this._container=L.DomUtil.create("div","leaflet-layer",e.pane),L.DomUtil.addClass(this._container,"mapml-image-container");var i=M.extractInputBounds(t);this.zoomBounds=i.zoomBounds,this.extentBounds=i.bounds,this.isVisible=!0,delete e.opacity,L.extend(e,this.zoomBounds),L.setOptions(this,L.extend(e,this._setUpExtentTemplateVars(t)))},getEvents:function(){return{moveend:this._onMoveEnd}},onAdd:function(){this._map._addZoomLimit(this),this.setZIndex(this.options.zIndex),this._onMoveEnd()},redraw:function(){this._onMoveEnd()},_clearLayer:function(){var e=this._container.querySelectorAll("img");for(let t=0;t<e.length;t++)this._container.removeChild(e[t])},_onMoveEnd:function(){var t,e,i,o=this._map.getZoom(),n=M.pixelToPCRSBounds(this._map.getPixelBounds(),o,this._map.options.projection);this.isVisible=o<=this.zoomBounds.maxZoom&&o>=this.zoomBounds.minZoom&&this.extentBounds.overlaps(n),this.isVisible?(e=(t=this._map).getPixelBounds().min.subtract(t.getPixelOrigin()),o=t.getSize(),n=this.getImageUrl(),i=this._imageOverlay,this._imageOverlay=M.imageOverlay(n,e,o,0,this._container),this._imageOverlay.addTo(t),i&&this._imageOverlay.on("load error",function(){t.removeLayer(i)})):this._clearLayer()},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(t){this._clearLayer(),t._removeZoomLimit(this),this._container=null},getImageUrl:function(){var t,e={};for(t in e[this.options.extent.width]=this._map.getSize().x,e[this.options.extent.height]=this._map.getSize().y,e[this.options.extent.bottom]=this._TCRSToPCRS(this._map.getPixelBounds().max,this._map.getZoom()).y,e[this.options.extent.left]=this._TCRSToPCRS(this._map.getPixelBounds().min,this._map.getZoom()).x,e[this.options.extent.top]=this._TCRSToPCRS(this._map.getPixelBounds().min,this._map.getZoom()).y,e[this.options.extent.right]=this._TCRSToPCRS(this._map.getPixelBounds().max,this._map.getZoom()).x,this.options.extent)["width","height","left","right","top","bottom"].indexOf(t)<0&&(e[t]=this.options.extent[t]);return L.Util.template(this._template.template,e)},_TCRSToPCRS:function(t,e){var i=this._map.options.crs;return i.transformation.untransform(t,i.scale(e))},_setUpExtentTemplateVars:function(t){for(var e={extent:{}},i=t.values,o=0;o<t.values.length;o++){var n=i[o].getAttribute("type"),a=i[o].getAttribute("units"),s=i[o].getAttribute("axis"),r=i[o].getAttribute("name"),l=i[o].getAttribute("position"),m="map-select"===i[o].tagName.toLowerCase();if("width"===n)e.extent.width=r;else if("height"===n)e.extent.height=r;else if("location"!==n||"pcrs"!==a&&"gcrs"!==a)if(m){const u=i[o].htmlselect;e.extent[r]=function(){return u.value}}else{const p=i[o];e.extent[r]=function(){return p.getAttribute("value")}}else switch(s){case"longitude":case"easting":l&&(l.match(/.*?-left/i)?e.extent.left=r:l.match(/.*?-right/i)&&(e.extent.right=r));break;case"latitude":case"northing":l&&(l.match(/top-.*?/i)?e.extent.top=r:l.match(/bottom-.*?/i)&&(e.extent.bottom=r))}}return e}}),f=L.ImageOverlay.extend({initialize:function(t,e,i,o,n,a){this._container=n,this._url=t,this._location=e,this._size=L.point(i),this._angle=o,L.setOptions(this,a)},getEvents:function(){var t={viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},onAdd:function(){this.on({load:this._onImageLoad}),this._image||this._initImage(),this.options.interactive&&(L.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this._container.appendChild(this._image),this._reset()},onRemove:function(){L.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},_onImageLoad:function(){this._image&&(this._image.loaded=+new Date,this._updateOpacity())},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),t=this._map.getPixelOrigin().add(this._location).multiplyBy(e).subtract(this._map._getNewPixelOrigin(t.center,t.zoom)).round();L.Browser.any3d?L.DomUtil.setTransform(this._image,t,e):L.DomUtil.setPosition(this._image,t)},_reset:function(){var t=this._image,e=this._location,i=this._size;L.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){var t,e,i;this._map&&(i=+new Date,t=!1,e=this._image,i=Math.min(1,(i-e.loaded)/200),L.DomUtil.setOpacity(e,i),(t=i<1?!0:t)&&(L.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this)),L.DomUtil.addClass(e,"leaflet-image-loaded"))}}),b=L.Layer.extend({options:{maxNext:10,zIndex:0,maxZoom:25},initialize:function(t,e,i){var o;t&&(this._href=t),e&&(o=!!(this._layerEl=e).querySelector("map-feature,map-tile,map-extent"),!t&&o&&(this._content=e)),L.setOptions(this,i),this._container=L.DomUtil.create("div","leaflet-layer"),L.DomUtil.addClass(this._container,"mapml-layer"),this._imageContainer=L.DomUtil.create("div","leaflet-layer",this._container),L.DomUtil.addClass(this._imageContainer,"mapml-image-container"),this._mapmlTileContainer=L.DomUtil.create("div","mapml-tile-container",this._container),!o&&e&&e.hasAttribute("label")&&(this._title=e.getAttribute("label")),this._initialize(o?e:null),this.on("attached",this._validateExtent,this),this.validProjection=!0,this._mapmlLayerItem={}},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_removeExtents:function(e){if(this._extent._mapExtents)for(let t=0;t<this._extent._mapExtents.length;t++)this._extent._mapExtents[t].templatedLayer&&e.removeLayer(this._extent._mapExtents[t].templatedLayer);this._extent._queries&&delete this._extent._queries},_changeOpacity:function(t){t&&t.target&&0<=t.target.value&&t.target.value<=1&&this.changeOpacity(t.target.value)},changeOpacity:function(t){this._container.style.opacity=t,this.opacityEl&&(this.opacityEl.value=t)},_changeExtentOpacity:function(t){t&&t.target&&0<=t.target.value&&t.target.value<=1&&(this.templatedLayer.changeOpacity(t.target.value),this._templateVars.opacity=t.target.value)},_changeExtent:function(t,e){t.target.checked?(e.checked=!0,this._layerEl.checked&&(e.templatedLayer=M.templatedLayer(e._templateVars,{pane:this._container,opacity:e._templateVars.opacity,_leafletLayer:this,crs:e.crs,extentZIndex:e.extentZIndex}).addTo(this._map),e.templatedLayer.setZIndex(),this._setLayerElExtent())):(L.DomEvent.stopPropagation(t),e.checked=!1,this._layerEl.checked&&this._map.removeLayer(e.templatedLayer),this._setLayerElExtent())},onAdd:function(e){if(!this._extent&&!this._extent_mapExtents||this._validProjection(e)){this._map=e,this._content?(this._mapmlvectors||(this._mapmlvectors=M.mapMlFeatures(this._content,{renderer:M.featureRenderer(),pane:this._container,opacity:this.options.opacity,projection:e.options.projection,_leafletLayer:this,static:!0,onEachFeature:function(t,e){var i;t&&((i=document.createElement("div")).classList.add("mapml-popup-content"),i.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(i,{autoClose:!1,minWidth:165}))}})),this._setLayerElExtent(),e.addLayer(this._mapmlvectors)):this.once("extentload",function(){this._validProjection(e)?(this._mapmlvectors||(this._mapmlvectors=M.mapMlFeatures(this._content,{renderer:M.featureRenderer(),pane:this._container,opacity:this.options.opacity,projection:e.options.projection,_leafletLayer:this,static:!0,onEachFeature:function(t,e){var i;t&&((i=document.createElement("div")).classList.add("mapml-popup-content"),i.insertAdjacentHTML("afterbegin",t.innerHTML),e.bindPopup(i,{autoClose:!1,minWidth:165}))}}).addTo(e)),this._setLayerElExtent()):this.validProjection=!1},this),this._imageLayer||(this._imageLayer=L.layerGroup()),e.addLayer(this._imageLayer),(!this._staticTileLayer||null===this._staticTileLayer._container)&&0<this._mapmlTileContainer.getElementsByTagName("map-tiles").length&&(this._staticTileLayer=M.mapMLStaticTileLayer({pane:this._container,_leafletLayer:this,className:"mapml-static-tile-layer",tileContainer:this._mapmlTileContainer,maxZoomBound:e.options.crs.options.resolutions.length-1,tileSize:e.options.crs.options.crs.tile.bounds.max.x}),e.addLayer(this._staticTileLayer),this._setLayerElExtent());const t=function(){if(this._extent&&this._extent._mapExtents){for(let t=0;t<this._extent._mapExtents.length;t++)this._extent._mapExtents[t]._templateVars&&this._extent._mapExtents[t].checked&&(this._extent._mapExtents[t].extentZIndex||(this._extent._mapExtents[t].extentZIndex=t),this._templatedLayer=M.templatedLayer(this._extent._mapExtents[t]._templateVars,{pane:this._container,opacity:this._extent._mapExtents[t]._templateVars.opacity,_leafletLayer:this,crs:this._extent.crs,extentZIndex:this._extent._mapExtents[t].extentZIndex}).addTo(e),this._extent._mapExtents[t].templatedLayer=this._templatedLayer,this._templatedLayer._queries&&(this._extent._queries||(this._extent._queries=[]),this._extent._queries=this._extent._queries.concat(this._templatedLayer._queries)));this._setLayerElExtent()}}.bind(this);this._extent&&this._extent._mapExtents&&this._extent._mapExtents[0]._templateVars?t():this.once("extentload",function(){this._validProjection(e)?t():this.validProjection=!1},this),this.setZIndex(this.options.zIndex),this.getPane().appendChild(this._container),setTimeout(()=>{e.fire("checkdisabled")},0),e.on("popupopen",this._attachSkipButtons,this)}else this.validProjection=!1},_validProjection:function(e){let i=!1;if(this._extent&&this._extent._mapExtents)for(let t=0;t<this._extent._mapExtents.length;t++)if(this._extent._mapExtents[t]._templateVars)for(var o of this._extent._mapExtents[t]._templateVars)if(!o.projectionMatch&&o.projection!==e.options.projection){i=!0;break}return!(i||this.getProjection()!==e.options.projection.toUpperCase())},_setLayerElExtent:function(){let o,n,a,s,r,e={minZoom:0,maxZoom:0,maxNativeZoom:0,minNativeZoom:0};["_staticTileLayer","_imageLayer","_mapmlvectors","_templatedLayer"].forEach(t=>{if(this[t])if("_templatedLayer"===t){for(let e=0;e<this._extent._mapExtents.length;e++)for(let t=0;t<this._extent._mapExtents[e]._templateVars.length;t++){var i=M.extractInputBounds(this._extent._mapExtents[e]._templateVars[t]);this._extent._mapExtents[e]._templateVars[t].tempExtentBounds=i.bounds,this._extent._mapExtents[e]._templateVars[t].extentZoomBounds=i.zoomBounds}for(let e=0;e<this._extent._mapExtents.length;e++)if(this._extent._mapExtents[e].checked)for(let t=0;t<this._extent._mapExtents[e]._templateVars.length;t++)r=o?(o.extend(this._extent._mapExtents[e]._templateVars[t].tempExtentBounds.min),o.extend(this._extent._mapExtents[e]._templateVars[t].tempExtentBounds.max),n=Math.max(n,this._extent._mapExtents[e]._templateVars[t].extentZoomBounds.maxZoom),a=Math.min(a,this._extent._mapExtents[e]._templateVars[t].extentZoomBounds.minZoom),s=Math.max(s,this._extent._mapExtents[e]._templateVars[t].extentZoomBounds.maxNativeZoom),Math.min(r,this._extent._mapExtents[e]._templateVars[t].extentZoomBounds.minNativeZoom)):(o=this._extent._mapExtents[e]._templateVars[t].tempExtentBounds,n=this._extent._mapExtents[e]._templateVars[t].extentZoomBounds.maxZoom,a=this._extent._mapExtents[e]._templateVars[t].extentZoomBounds.minZoom,s=this._extent._mapExtents[e]._templateVars[t].extentZoomBounds.maxNativeZoom,this._extent._mapExtents[e]._templateVars[t].extentZoomBounds.minNativeZoom);e.minZoom=a,e.maxZoom=n,e.minNativeZoom=r,e.maxNativeZoom=s,this._extent.zoomBounds=e,this._extent.layerBounds=o;for(let t=0;t<this._extent._mapExtents.length;t++)this._extent._mapExtents[t].templatedLayer.layerBounds=o,this._extent._mapExtents[t].templatedLayer.zoomBounds=e}else this[t].layerBounds&&(o?(o.extend(this[t].layerBounds.min),o.extend(this[t].layerBounds.max)):(o=this[t].layerBounds,e=this[t].zoomBounds))}),o&&(this._layerEl.extent=Object.assign(M.convertAndFormatPCRS(o,this._map),{zoom:e}))},addTo:function(t){return t.addLayer(this),this},getEvents:function(){return{zoomanim:this._onZoomAnim}},redraw:function(){if(this._extent._mapExtents)for(let t=0;t<this._extent._mapExtents.length;t++)this._extent._mapExtents[t].templatedLayer&&this._extent._mapExtents[t].templatedLayer.redraw()},_onZoomAnim:function(t){var t=t.zoom,e=this._extent&&this._extent._mapExtents?this._extent._mapExtents[0].querySelector("map-input[type=zoom]"):null,i=e&&e.hasAttribute("min")?parseInt(e.getAttribute("min")):this._map.getMinZoom(),o=e&&e.hasAttribute("max")?parseInt(e.getAttribute("max")):this._map.getMaxZoom();if(e)for(let t=1;t<this._extent._mapExtents.length;t++)(e=this._extent._mapExtents[t].querySelector("map-input[type=zoom]"))&&e.hasAttribute("min")&&(i=Math.min(parseInt(e.getAttribute("min")),i)),e&&e.hasAttribute("max")&&(o=Math.max(parseInt(e.getAttribute("max")),o));t<i&&this._extent.zoomout||o<t&&this._extent.zoomin;i<=t&&t<=o||(this._extent.zoomin&&o<t?(this._href=this._extent.zoomin,this._layerEl.src=this._extent.zoomin,this.href=this._extent.zoomin,this._layerEl.src=this._extent.zoomin):this._extent.zoomout&&t<i&&(this._href=this._extent.zoomout,this.href=this._extent.zoomout,this._layerEl.src=this._extent.zoomout)),this._templatedLayer},onRemove:function(t){L.DomUtil.remove(this._container),this._staticTileLayer&&t.removeLayer(this._staticTileLayer),this._mapmlvectors&&t.removeLayer(this._mapmlvectors),this._imageLayer&&t.removeLayer(this._imageLayer),this._extent&&this._extent._mapExtents&&this._removeExtents(t),t.fire("checkdisabled"),t.off("popupopen",this._attachSkipButtons)},getAttribution:function(){return this.options.attribution},getLayerExtentHTML:function(t,i){var o=L.DomUtil.create("fieldset","mapml-layer-extent"),e=L.DomUtil.create("div","mapml-layer-item-properties",o),n=L.DomUtil.create("div","mapml-layer-item-settings",o),a=L.DomUtil.create("label","mapml-layer-item-toggle",e),s=L.DomUtil.create("input"),r=L.SVG.create("svg"),l=L.SVG.create("path"),m=L.SVG.create("path"),u=L.DomUtil.create("span"),p=L.DomUtil.create("div","mapml-layer-item-controls",e),c=L.DomUtil.create("details","mapml-layer-item-opacity",n),e=L.DomUtil.create("summary","",c),h=this._layerEl.parentNode,d=this._layerEl,c=L.DomUtil.create("input","",c);n.hidden=!0,o.setAttribute("aria-grabbed","false"),t||(o.setAttribute("hidden",""),this._extent._mapExtents[i].hidden=!0),r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("height","22"),r.setAttribute("width","22"),l.setAttribute("d","M0 0h24v24H0z"),l.setAttribute("fill","none"),m.setAttribute("d","M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"),r.appendChild(l),r.appendChild(m);let _=L.DomUtil.create("button","mapml-layer-item-remove-control",p);_.type="button",_.title="Remove Sub Layer",_.innerHTML="<span aria-hidden='true'>&#10005;</span>",_.classList.add("mapml-button"),L.DomEvent.on(_,"click",L.DomEvent.stop),L.DomEvent.on(_,"click",t=>{let e=!0;t.target.checked=!1,this._extent._mapExtents[i].removed=!0,this._extent._mapExtents[i].checked=!1,this._layerEl.checked&&this._changeExtent(t,this._extent._mapExtents[i]),this._extent._mapExtents[i].extentAnatomy.parentNode.removeChild(this._extent._mapExtents[i].extentAnatomy);for(let t=0;t<this._extent._mapExtents.length;t++)this._extent._mapExtents[t].removed||(e=!1);e&&this._layerItemSettingsHTML.removeChild(this._extentGroupAnatomy)},this);let y=L.DomUtil.create("button","mapml-layer-item-settings-control",p);y.type="button",y.title="Extent Settings",y.setAttribute("aria-expanded",!1),y.classList.add("mapml-button"),L.DomEvent.on(y,"click",t=>{!0===n.hidden?(y.setAttribute("aria-expanded",!0),n.hidden=!1):(y.setAttribute("aria-expanded",!1),n.hidden=!0)},this),u.setAttribute("aria-hidden",!0),a.appendChild(s),y.appendChild(u),u.appendChild(r),e.innerText="Opacity",e.id="mapml-layer-item-opacity-"+L.stamp(e),c.setAttribute("type","range"),c.setAttribute("min","0"),c.setAttribute("max","1.0"),c.setAttribute("value",this._extent._mapExtents[i]._templateVars.opacity||"1.0"),c.setAttribute("step","0.1"),c.setAttribute("aria-labelledby","mapml-layer-item-opacity-"+L.stamp(e)),this._extent._mapExtents[i]._templateVars.opacity=this._extent._mapExtents[i]._templateVars.opacity||"1.0",L.DomEvent.on(c,"change",this._changeExtentOpacity,this._extent._mapExtents[i]);a=L.DomUtil.create("span","mapml-layer-item-name",a);return s.defaultChecked=!!this._extent._mapExtents[i],this._extent._mapExtents[i].checked=s.defaultChecked,s.type="checkbox",a.innerHTML=t,L.DomEvent.on(s,"change",t=>{this._changeExtent(t,this._extent._mapExtents[i])}),a.id="mapml-extent-item-name-{"+L.stamp(a)+"}",o.setAttribute("aria-labelledby",a.id),a.extent=this._extent._mapExtents[i],o.onmousedown=e=>{if("input"!==e.target.tagName.toLowerCase()&&"select"!==e.target.tagName.toLowerCase()){e.preventDefault(),e.stopPropagation();let r=o,l=o.parentNode,t=!1,m=e.clientY;document.body.onmousemove=a=>{a.preventDefault();var s=a.clientY-m;if(t=5<Math.abs(s)||t,!(l&&!t||l&&l.childElementCount<=1||l.getBoundingClientRect().top>r.getBoundingClientRect().bottom||l.getBoundingClientRect().bottom<r.getBoundingClientRect().top)){l.classList.add("mapml-draggable"),r.style.transform="translateY("+s+"px)",r.style.pointerEvents="none";let t=a.clientX,e=a.clientY,i=("MAPML-VIEWER"===h.tagName?h:h.querySelector(".mapml-web-map")).shadowRoot,o=i.elementFromPoint(t,e),n=o&&o.closest("fieldset")?o.closest("fieldset"):r;n=Math.abs(s)<=n.offsetHeight?r:n,r.setAttribute("aria-grabbed","true"),r.setAttribute("aria-dropeffect","move"),n&&l===n.parentNode&&(n=n!==r.nextSibling?n:n.nextSibling,r!==n&&(m=a.clientY,r.style.transform=null),l.insertBefore(r,n))}},document.body.onmouseup=()=>{r.setAttribute("aria-grabbed","false"),r.removeAttribute("aria-dropeffect"),r.style.pointerEvents=null,r.style.transform=null;let t=l.children,e=0;for(var i of t){let t=i.querySelector("span").extent;t.setAttribute("data-moving",""),d.insertAdjacentElement("beforeend",t),t.removeAttribute("data-moving"),t.extentZIndex=e,t.templatedLayer.setZIndex(e),e++}l.classList.remove("mapml-draggable"),document.body.onmousemove=document.body.onmouseup=null}}},o},getLayerUserControlsHTML:function(){var i=L.DomUtil.create("fieldset","mapml-layer-item"),t=L.DomUtil.create("input"),e=L.DomUtil.create("span","mapml-layer-item-name"),o=L.DomUtil.create("span"),n=L.DomUtil.create("div","mapml-layer-item-properties",i),a=L.DomUtil.create("div","mapml-layer-item-settings",i),s=L.DomUtil.create("label","mapml-layer-item-toggle",n),r=L.DomUtil.create("div","mapml-layer-item-controls",n),l=L.DomUtil.create("details","mapml-layer-item-opacity mapml-control-layers",a),m=L.DomUtil.create("input"),u=L.DomUtil.create("summary"),p=L.SVG.create("svg"),c=L.SVG.create("path"),n=L.SVG.create("path"),h=L.DomUtil.create("fieldset","mapml-layer-grouped-extents"),d=this._layerEl.parentNode;this.opacityEl=m,this._mapmlLayerItem=i,p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("height","22"),p.setAttribute("width","22"),c.setAttribute("d","M0 0h24v24H0z"),c.setAttribute("fill","none"),n.setAttribute("d","M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"),p.appendChild(c),p.appendChild(n),a.hidden=!0,o.setAttribute("aria-hidden",!0);let _=L.DomUtil.create("button","mapml-layer-item-remove-control",r);_.type="button",_.title="Remove Layer",_.innerHTML="<span aria-hidden='true'>&#10005;</span>",_.classList.add("mapml-button"),L.DomEvent.on(_,"click",L.DomEvent.stop),L.DomEvent.on(_,"click",t=>{let e=0,i,o;if(o=("MAPML-VIEWER"===d.tagName?d:d.querySelector(".mapml-web-map")).shadowRoot,t.target.closest("fieldset").nextElementSibling&&!t.target.closest("fieldset").nextElementSibling.disbaled)for(i=t.target.closest("fieldset").previousElementSibling;i;)e+=2,i=i.previousElementSibling;else i="link";d.removeChild(t.target.closest("fieldset").querySelector("span").layer._layerEl),i=i?o.querySelector(".leaflet-control-attribution").firstElementChild:i=o.querySelectorAll("input")[e],i.focus()},this);let y=L.DomUtil.create("button","mapml-layer-item-settings-control",r);if(y.type="button",y.title="Layer Settings",y.setAttribute("aria-expanded",!1),y.classList.add("mapml-button"),L.DomEvent.on(y,"click",t=>{!0===a.hidden?(y.setAttribute("aria-expanded",!0),a.hidden=!1):(y.setAttribute("aria-expanded",!1),a.hidden=!0)},this),t.defaultChecked=!!this._map,t.type="checkbox",(e.layer=this)._legendUrl?((r=document.createElement("a")).text=" "+this._title,r.href=this._legendUrl,r.target="_blank",r.draggable=!1,e.appendChild(r)):e.innerHTML=this._title,e.id="mapml-layer-item-name-{"+L.stamp(e)+"}",u.innerText="Opacity",u.id="mapml-layer-item-opacity-"+L.stamp(u),l.appendChild(u),l.appendChild(m),m.setAttribute("type","range"),m.setAttribute("min","0"),m.setAttribute("max","1.0"),m.setAttribute("value",this._container.style.opacity||"1.0"),m.setAttribute("step","0.1"),m.setAttribute("aria-labelledby",u.id),m.value=this._container.style.opacity||"1.0",i.setAttribute("aria-grabbed","false"),i.setAttribute("aria-labelledby",e.id),i.onmousedown=e=>{if("input"!==e.target.tagName.toLowerCase()&&"select"!==e.target.tagName.toLowerCase()){e.preventDefault();let r=i,l=i.parentNode,t=!1,m=e.clientY;document.body.onmousemove=a=>{a.preventDefault();var s=a.clientY-m;if(t=5<Math.abs(s)||t,!(l&&!t||l&&l.childElementCount<=1||l.getBoundingClientRect().top>r.getBoundingClientRect().bottom||l.getBoundingClientRect().bottom<r.getBoundingClientRect().top)){l.classList.add("mapml-draggable"),r.style.transform="translateY("+s+"px)",r.style.pointerEvents="none";let t=a.clientX,e=a.clientY,i=("MAPML-VIEWER"===d.tagName?d:d.querySelector(".mapml-web-map")).shadowRoot,o=i.elementFromPoint(t,e),n=o&&o.closest("fieldset")?o.closest("fieldset"):r;n=Math.abs(s)<=n.offsetHeight?r:n,r.setAttribute("aria-grabbed","true"),r.setAttribute("aria-dropeffect","move"),n&&l===n.parentNode&&(n=n!==r.nextSibling?n:n.nextSibling,r!==n&&(m=a.clientY,r.style.transform=null),l.insertBefore(r,n))}},document.body.onmouseup=()=>{r.setAttribute("aria-grabbed","false"),r.removeAttribute("aria-dropeffect"),r.style.pointerEvents=null,r.style.transform=null;let t=l.children,e=1;for(var i of t){let t=i.querySelector("span").layer._layerEl;t.setAttribute("data-moving",""),d.insertAdjacentElement("beforeend",t),t.removeAttribute("data-moving"),t._layer.setZIndex(e),e++}l.classList.remove("mapml-draggable"),document.body.onmousemove=document.body.onmouseup=null}}},L.DomEvent.on(m,"change",this._changeOpacity,this),s.appendChild(t),s.appendChild(e),y.appendChild(o),o.appendChild(p),this._styles&&a.appendChild(this._styles),this._userInputs){var x=document.createDocumentFragment(),g=this._extent._templateVars;if(g)for(var f=0;f<g.length;f++)for(var b=g[f],v=0;v<b.values.length;v++){var E,M,A=b.values[v],C="#"+A.getAttribute("id");"map-select"!==A.tagName.toLowerCase()||x.querySelector(C)||(E=L.DomUtil.create("details","mapml-layer-item-time mapml-control-layers",x),M=L.DomUtil.create("summary"),(C=L.DomUtil.create("label")).innerText=A.getAttribute("name"),C.setAttribute("for",A.getAttribute("id")),M.appendChild(C),E.appendChild(M),E.appendChild(A.htmlselect))}a.appendChild(x)}if(this._extent&&this._extent._mapExtents){var S=!0;this._layerItemSettingsHTML=a,(this._extentGroupAnatomy=h).setAttribute("aria-label","Sublayers");for(let t=0;t<this._extent._mapExtents.length;t++)h.appendChild(this._extent._mapExtents[t].extentAnatomy),this._extent._mapExtents[t].hidden||(S=!1);S||a.appendChild(h)}return this._mapmlLayerItem},_initialize:function(t){var I,e,i,o;function E(t,o,n,e,i,a){var s=[],r=t.querySelectorAll("map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]"),l=new RegExp("(?:{)(.*?)(?:})","g"),m=t.querySelector('map-input[type="zoom" i]'),u=!1,p={zoom:0};if(o){let t=M.metaContentToObject(o.getAttribute("content")),e;p.zoom=t.zoom||p.zoom;let i=Object.keys(t);for(let t=0;t<i.length;t++)if(!i[t].includes("zoom")){e=M.axisToCS(i[t].split("-")[2]);break}o=M.csToAxes(e);p.bounds=M.boundsToPCRSBounds(L.bounds(L.point(+t["top-left-"+o[0]],+t["top-left-"+o[1]]),L.point(+t["bottom-right-"+o[0]],+t["bottom-right-"+o[1]])),p.zoom,n,e)}else p.bounds=M[n].options.crs.pcrs.bounds;for(var c=0;c<r.length;c++){var h=r[c];if(!(_=h.getAttribute("tref"))){var d,_=P;for(d of e.querySelectorAll("map-input"))_+=`{${d.getAttribute("name")}}`}for(var y=h.hasAttribute("title")?h.getAttribute("title"):"Query this layer",x=_.match(l),g=h.hasAttribute("rel")&&"tile"!==h.getAttribute("rel").toLowerCase()?h.getAttribute("rel").toLowerCase():"tile",f=h.hasAttribute("type")?h.getAttribute("type").toLowerCase():"image/*",b=[],v=h&&h.hasAttribute("tms"),E=e.querySelector("map-meta[name=zoom]")?M.metaContentToObject(e.querySelector("map-meta[name=zoom]").getAttribute("content")):void 0;null!==(A=l.exec(_));){var A,C=A[1],S=t.querySelector("map-input[name="+C+"],map-select[name="+C+"]");if(!S){console.log("input with name="+C+" not found for template variable of same name");break}if(S.hasAttribute("type")&&"location"===S.getAttribute("type")&&!S.hasAttribute("min")&&S.hasAttribute("axis")&&!["i","j"].includes(S.getAttribute("axis").toLowerCase())&&(m.setAttribute("value",p.zoom),A=S.getAttribute("axis"),C=M.convertPCRSBounds(p.bounds,p.zoom,n,M.axisToCS(A)),S.setAttribute("min",C.min[M.axisToXY(A)]),S.setAttribute("max",C.max[M.axisToXY(A)])),b.push(S),u=u||S.hasAttribute("type")&&"zoom"===S.getAttribute("type").toLowerCase(),S.hasAttribute("shard")){var T=S.getAttribute("list");S.servers=[];var z=t.querySelectorAll("map-datalist#"+T+" > map-option");0===z.length&&S.hasAttribute("value")&&(z=S.getAttribute("value").split(""));for(var k=0;k<z.length;k++)z[k].getAttribute?S.servers.push(z[k].getAttribute("value")):S.servers.push(z[k])}else"map-select"===S.tagName.toLowerCase()&&((T=document.createElement("div")).insertAdjacentHTML("afterbegin",S.outerHTML),S.htmlselect=T.querySelector("map-select"),S.htmlselect=function(e){var i=document.createElement("select"),o=e.getAttributeNames();for(let t=0;t<o.length;t++)i.setAttribute(o[t],e.getAttribute(o[t]));var n=e.children;for(let e=0;e<n.length;e++){var a=document.createElement("option"),s=n[e].getAttributeNames();for(let t=0;t<s.length;t++)a.setAttribute(s[t],n[e].getAttribute(s[t]));a.innerHTML=n[e].innerHTML,i.appendChild(a)}return i}(S.htmlselect),L.DomEvent.on(S.htmlselect,"change",I.redraw,I),I._userInputs||(I._userInputs=[]),I._userInputs.push(S.htmlselect))}(_&&x.length===b.length||_===P)&&("query"===g&&(I.queryable=!0),!u&&m&&b.push(m),s.push({template:decodeURI(new URL(_,i)),linkEl:h,title:y,rel:g,type:f,values:b,zoomBounds:E,extentPCRSFallback:{bounds:p.bounds},projectionMatch:a,projection:t.getAttribute("units")||B,tms:v}))}return s}function n(t){var e=this.responseXML||t;if(e.querySelector&&e.querySelector("map-feature")&&(I._content=e),!this.responseXML&&this.responseText&&(e=(new DOMParser).parseFromString(this.responseText,"text/xml")),this.readyState===this.DONE&&e.querySelector&&!e.querySelector("parsererror")){var i,o=e.querySelectorAll("map-extent");if(o.length||(m=e.querySelector("map-meta[name=projection]")),1<=o.length)for(let t=0;t<o.length&&(n=(i="map-extent"===o[t].tagName.toLowerCase()&&o[t].hasAttribute("units")?o[t].getAttribute("units"):i)&&i===I.options.mapprojection);t++);else m&&"map-meta"===m.tagName.toLowerCase()&&m.hasAttribute("content")&&(n=(i=M.metaContentToObject(m.getAttribute("content")).content)&&i===I.options.mapprojection);var n,a,s=e.querySelector("map-meta[name=extent]"),r=!n&&e.querySelector("map-head map-link[rel=alternate][projection="+I.options.mapprojection+"]"),l=new URL(e.querySelector("map-base")?e.querySelector("map-base").getAttribute("href"):e.baseURI||this.responseURL,this.responseURL).href;if(!n&&r&&r.hasAttribute("href"))return void I.fire("changeprojection",{href:new URL(r.getAttribute("href"),l).href},!1);if(!n&&I._map&&1===I._map.options.mapEl.querySelectorAll("layer-").length)return void(I._map.options.mapEl.projection=i);if(m)I._extent=m;else{I._extent={},n&&(I._extent.crs=M[i]),I._extent._mapExtents=[],I._extent._templateVars=[];for(let t=0;t<o.length;t++)o[t].querySelector("map-link[rel=tile],map-link[rel=image],map-link[rel=features],map-link[rel=query]")&&o[t].hasAttribute("units")&&(I._extent._mapExtents.push(o[t]),n=n||r,a=E.call(I,o[t],s,i,e,l,n),I._extent._mapExtents[t]._templateVars=a,I._extent._templateVars=I._extent._templateVars.concat(a))}I._parseLicenseAndLegend(e,I,i);var t=e.querySelector("map-link[rel=zoomin]"),m=e.querySelector("map-link[rel=zoomout]");if(delete I._extent.zoomin,delete I._extent.zoomout,t&&(I._extent.zoomin=new URL(t.getAttribute("href"),l).href),m&&(I._extent.zoomout=new URL(m.getAttribute("href"),l).href),I._extent._mapExtents)for(let t=0;t<I._extent._mapExtents.length;t++)I._extent._mapExtents[t].templatedLayer&&I._extent._mapExtents[t].templatedLayer.reset(I._extent._mapExtents[t]._templateVars,I._extent._mapExtents[t].extentZIndex);if(e.querySelector("map-tile")){var u=document.createElement("map-tiles"),p=e.querySelector("map-meta[name=zoom][content]")||e.querySelector("map-input[type=zoom][value]");u.setAttribute("zoom",p&&p.getAttribute("content")||p&&p.getAttribute("value")||"0");for(var c=e.getElementsByTagName("map-tile"),h=0;h<c.length;h++)u.appendChild(document.importNode(c[h],!0));I._mapmlTileContainer.appendChild(u)}if(M.parseStylesheetAsHTML(e,l,I._container),I._extent._mapExtents)for(let t=0;t<I._extent._mapExtents.length;t++){var d=I._extent._mapExtents[t].getAttribute("label"),d=I.getLayerExtentHTML(d,t);I._extent._mapExtents[t].extentAnatomy=d}var _=e.querySelectorAll('map-link[rel=style],map-link[rel="self style"],map-link[rel="style self"]');if(1<_.length){var y=document.createElement("details"),p=document.createElement("summary");p.innerText="Style",y.appendChild(p);for(var x=function(t){I.fire("changestyle",{src:t.target.getAttribute("data-href")},!1)},g=0;g<_.length;g++){var f=document.createElement("div"),b=f.appendChild(document.createElement("input"));b.setAttribute("type","radio"),b.setAttribute("id","rad-"+L.stamp(b)),b.setAttribute("name","styles-"+this._title),b.setAttribute("value",_[g].getAttribute("title")),b.setAttribute("data-href",new URL(_[g].getAttribute("href"),l).href);var v=f.appendChild(document.createElement("label"));v.setAttribute("for","rad-"+L.stamp(b)),v.innerText=_[g].getAttribute("title"),"style self"!==_[g].getAttribute("rel")&&"self style"!==_[g].getAttribute("rel")||(b.checked=!0),y.appendChild(f),L.DomUtil.addClass(y,"mapml-layer-item-style mapml-control-layers"),L.DomEvent.on(b,"click",x,I)}I._styles=y}e.querySelector("map-title")?I._title=e.querySelector("map-title").textContent.trim():e instanceof Element&&e.hasAttribute("label")&&(I._title=e.getAttribute("label").trim()),I._map&&(I._validateExtent(),I._map.hasLayer(I)&&I._map.attributionControl.addAttribution(I.getAttribution()))}else I.error=!0;I.fire("extentload",I,!1),I._layerEl.dispatchEvent(new CustomEvent("extentload",{detail:I}))}(this._href||t)&&((I=this)._href?(e=new XMLHttpRequest,i=this._href,o=n,e.onreadystatechange=function(){this.readyState===this.DONE&&(400!==this.status&&404!==this.status&&500!==this.status&&406!==this.status||(I.error=!0,I.fire("extentload",I,!0),e.abort()))},e.onload=o,e.onerror=function(){I.error=!0,I.fire("extentload",I,!0)},e.open("GET",i),e.setRequestHeader("Accept",M.mime),e.overrideMimeType("text/xml"),e.send()):t&&n.call(this,t))},_validateExtent:function(){if(this._extent&&this._map){var e,i=this._extent._mapExtents||[this._extent];for(let t=0;t<i.length;t++){if(!i[t].querySelector)return;i[t].querySelector('[type=zoom][min=""], [type=zoom][max=""]')&&((e=i[t].querySelector("[type=zoom]")).setAttribute("min",this._map.getMinZoom()),e.setAttribute("max",this._map.getMaxZoom())),(e=i[t].hasAttribute("units")?i[t].getAttribute("units"):null)&&M[e]?this._extent._mapExtents?this._extent._mapExtents[t].crs=M[e]:this._extent.crs=M[e]:this._extent._mapExtents?this._extent._mapExtents[t].crs=M.OSMTILE:this._extent.crs=M.OSMTILE}}},getProjection:function(){if(this._extent){let t=this._extent._mapExtents?this._extent._mapExtents[0]:this._extent;if(!t)return B;switch(t.tagName.toUpperCase()){case"MAP-EXTENT":if(t.hasAttribute("units"))return t.getAttribute("units").toUpperCase();break;case"MAP-INPUT":if(t.hasAttribute("value"))return t.getAttribute("value").toUpperCase();break;case"MAP-META":if(t.hasAttribute("content"))return M.metaContentToObject(t.getAttribute("content")).content.toUpperCase();break;default:return B}return B}},_parseLicenseAndLegend:function(t,e){var i,o=t.querySelector("map-link[rel=license]");o&&(i=o.getAttribute("title"),i='<a href="'+o.getAttribute("href")+'" title="'+i+'">'+i+"</a>"),L.setOptions(e,{attribution:i});t=t.querySelector("map-link[rel=legend]");t&&(e._legendUrl=t.getAttribute("href"))},getQueryTemplates:function(i){if(this._extent&&this._extent._queries){var o=[];if(this._layerEl.checked&&!this._layerEl.hidden&&this._mapmlLayerItem){var e=this._mapmlLayerItem.querySelectorAll(".mapml-layer-item-name");for(let t=0;t<e.length;t++)if(e[t].extent||1===this._extent._mapExtents.length){var n=e[t].extent||this._extent._mapExtents[0];for(let t=0;t<n._templateVars.length;t++)if(n.checked){var a=n._templateVars[t];for(let e=0;e<this._extent._queries.length;e++){let t=this._extent._queries[e];a===t&&t.extentBounds.contains(i)&&o.push(t)}}}return o}}},_attachSkipButtons:function(t){let n=t.popup,a=t.target,e,s,i=n._container.getElementsByClassName("mapml-popup-content")[0];n._container.setAttribute("role","dialog"),i.setAttribute("tabindex","-1"),i.setAttribute("role","document"),n._count=0,n._source._eventParents?(e=n._source._eventParents[Object.keys(n._source._eventParents)[0]],s=n._source.group):e=n._source._templatedLayer,n._container.querySelector('nav[class="mapml-focus-buttons"]')&&(L.DomUtil.remove(n._container.querySelector('nav[class="mapml-focus-buttons"]')),L.DomUtil.remove(n._container.querySelector("hr")));var o=L.DomUtil.create("nav","mapml-focus-buttons");let r=L.DomUtil.create("button","mapml-popup-button",o);r.type="button",r.title="Focus Map",r.innerHTML="<span aria-hidden='true'>|&#10094;</span>",L.DomEvent.on(r,"click",t=>{L.DomEvent.stop(t),a.featureIndex._sortIndex(),a.closePopup(),a._container.focus()},n);let l=L.DomUtil.create("button","mapml-popup-button",o);l.type="button",l.title="Previous Feature",l.innerHTML="<span aria-hidden='true'>&#10094;</span>",L.DomEvent.on(l,"click",e._previousFeature,n);let m=L.DomUtil.create("p","mapml-feature-count",o),u=this._totalFeatureCount||1;m.innerText=n._count+1+"/"+u;let p=L.DomUtil.create("button","mapml-popup-button",o);p.type="button",p.title="Next Feature",p.innerHTML="<span aria-hidden='true'>&#10095;</span>",L.DomEvent.on(p,"click",e._nextFeature,n);let c=L.DomUtil.create("button","mapml-popup-button",o);c.type="button",c.title="Focus Controls",c.innerHTML="<span aria-hidden='true'>&#10095;|</span>",L.DomEvent.on(c,"click",t=>{a.featureIndex._sortIndex(),a.featureIndex.currentIndex=a.featureIndex.inBoundFeatures.length-1,a.featureIndex.inBoundFeatures[0].path.setAttribute("tabindex",-1),a.featureIndex.inBoundFeatures[a.featureIndex.currentIndex].path.setAttribute("tabindex",0),L.DomEvent.stop(t),a.closePopup(),a._controlContainer.querySelector("A").focus()},n);t=L.DomUtil.create("hr");function h(t){let e=t.originalEvent.path||t.originalEvent.composedPath();var i=9===t.originalEvent.keyCode,o=t.originalEvent.shiftKey;(e[0].classList.contains("leaflet-popup-close-button")&&i&&!o||27===t.originalEvent.keyCode||("Focus Map"===e[0].title||e[0].classList.contains("mapml-popup-content"))&&i&&o)&&setTimeout(()=>{L.DomEvent.stop(t),a.closePopup(n),s.focus()},0)}function d(t){let e=t.originalEvent.path||t.originalEvent.composedPath();var i=9===t.originalEvent.keyCode,o=t.originalEvent.shiftKey;13===t.originalEvent.keyCode&&e[0].classList.contains("leaflet-popup-close-button")||27===t.originalEvent.keyCode?(L.DomEvent.stopPropagation(t),a._container.focus(),a.closePopup(n),27!==t.originalEvent.keyCode&&(a._popupClosed=!0)):i&&e[0].classList.contains("leaflet-popup-close-button")?a.closePopup(n):("Focus Map"===e[0].title||e[0].classList.contains("mapml-popup-content"))&&i&&o&&setTimeout(()=>{L.DomEvent.stop(t),a.closePopup(n),a._container.focus()},0)}n._navigationBar=o,n._content.appendChild(t),n._content.appendChild(o),i.focus(),s?(s.setAttribute("aria-expanded","true"),a.on("keydown",h)):a.on("keydown",d),a.on("popupclose",function t(e){e.popup===n&&(a.off("keydown",h),a.off("keydown",d),a.off("popupclose",t),s&&s.setAttribute("aria-expanded","false"))})}}),v=L.Layer.extend({onAdd:function(t){var e=t.getSize();(400<e.x||300<e.y)&&(this._container=L.DomUtil.create("table","mapml-debug",t._container),this._panel=A({className:"mapml-debug-panel",pane:this._container}),t.addLayer(this._panel)),this._grid=S({className:"mapml-debug-grid",pane:t._panes.mapPane,zIndex:400,tileSize:t.options.crs.options.crs.tile.bounds.max.x}),t.addLayer(this._grid),this._vectors=z({className:"mapml-debug-vectors",pane:t._panes.mapPane,toolPane:this._container}),t.addLayer(this._vectors)},onRemove:function(t){t.removeLayer(this._grid),t.removeLayer(this._vectors),this._panel&&(t.removeLayer(this._panel),L.DomUtil.remove(this._container))}}),E=L.Layer.extend({initialize:function(t){L.setOptions(this,t)},onAdd:function(t){this._title=L.DomUtil.create("caption","mapml-debug-banner",this.options.pane),this._title.innerHTML="Debug mode",t.debug={},t.debug._infoContainer=this._debugContainer=L.DomUtil.create("tbody","mapml-debug-panel",this.options.pane);var e=t.debug._infoContainer;t.debug._tileCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._tileMatrixCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._mapCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._tcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._pcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),t.debug._gcrsCoord=L.DomUtil.create("tr","mapml-debug-coordinates",e),this._map.on("mousemove",this._updateCoords)},onRemove:function(){L.DomUtil.remove(this._title),this._debugContainer&&(L.DomUtil.remove(this._debugContainer),this._map.off("mousemove",this._updateCoords))},_updateCoords:function(r){if(!this.contextMenu._visible){let t=this.options.mapEl,e=t._map.project(r.latlng),i=t._map.options.crs.scale(+t.zoom),o=t._map.options.crs.transformation.untransform(e,i),n=t._map.options.crs.options.crs.tile.bounds.max.x,a=e.x%n,s=e.y%n;a<0&&(a+=n),s<0&&(s+=n),this.debug._tileCoord.innerHTML=`
      <th scope="row">tile: </th>
      <td>i: ${Math.trunc(a)}, </td>
      <td>j: ${Math.trunc(s)}</td>
      `,this.debug._mapCoord.innerHTML=`
      <th scope="row">map: </th>
      <td>i: ${Math.trunc(r.containerPoint.x)}, </td>
      <td>j: ${Math.trunc(r.containerPoint.y)}</td>
      `,this.debug._gcrsCoord.innerHTML=`
      <th scope="row">gcrs: </th>
      <td>lon: ${r.latlng.lng.toFixed(6)}, </td>
      <td>lat: ${r.latlng.lat.toFixed(6)}</td>
      `,this.debug._tcrsCoord.innerHTML=`
      <th scope="row">tcrs: </th>
      <td>x: ${Math.trunc(e.x)}, </td>
      <td>y: ${Math.trunc(e.y)}</td>
      `,this.debug._tileMatrixCoord.innerHTML=`
      <th scope="row">tilematrix: </th>
      <td>column: ${Math.trunc(e.x/n)}, </td>
      <td>row: ${Math.trunc(e.y/n)}</td>
      `,this.debug._pcrsCoord.innerHTML=`
      <th scope="row">pcrs: </th>
      <td>easting: ${o.x.toFixed(2)}, </td>
      <td>northing: ${o.y.toFixed(2)}</td>
      `}}}),A=function(t){return new E(t)},C=L.GridLayer.extend({initialize:function(t){L.setOptions(this,t),L.GridLayer.prototype.initialize.call(this,this._map)},createTile:function(t){let e=L.DomUtil.create("div","mapml-debug-tile");return e.setAttribute("col",t.x),e.setAttribute("row",t.y),e.setAttribute("zoom",t.z),e.innerHTML=["col: "+t.x,"row: "+t.y,"zoom: "+t.z].join(", "),e.style.outline="1px dashed red",e}}),S=function(t){return new C(t)},T=L.LayerGroup.extend({initialize:function(t){L.setOptions(this,t),L.LayerGroup.prototype.initialize.call(this,this._map,t)},onAdd:function(t){t.on("overlayremove",this._mapLayerUpdate,this),t.on("overlayadd",this._mapLayerUpdate,this);var e=t.options.crs.transformation.transform(L.point(0,0),t.options.crs.scale(0));this._centerVector=L.circle(t.options.crs.pointToLatLng(e,0),{radius:250}),this._centerVector.bindTooltip("Projection Center"),this._addBounds(t)},onRemove:function(t){this.clearLayers()},_addBounds:function(t){let e=Object.keys(t._layers),i=t._layers,o=["#FF5733","#8DFF33","#3397FF","#E433FF","#F3FF33"],n=0;this.addLayer(this._centerVector);for(var a of e)if(i[a].layerBounds||i[a].extentBounds){let t;t=i[a].layerBounds?[i[a].layerBounds.min,L.point(i[a].layerBounds.max.x,i[a].layerBounds.min.y),i[a].layerBounds.max,L.point(i[a].layerBounds.min.x,i[a].layerBounds.max.y)]:[i[a].extentBounds.min,L.point(i[a].extentBounds.max.x,i[a].extentBounds.min.y),i[a].extentBounds.max,L.point(i[a].extentBounds.min.x,i[a].extentBounds.max.y)];let e=I(t,{color:o[n%o.length],weight:2,opacity:1,fillOpacity:.01,fill:!0});i[a].options._leafletLayer&&e.bindTooltip(i[a].options._leafletLayer._title,{sticky:!0}),this.addLayer(e),n++}t.totalLayerBounds&&(t=[t.totalLayerBounds.min,L.point(t.totalLayerBounds.max.x,t.totalLayerBounds.min.y),t.totalLayerBounds.max,L.point(t.totalLayerBounds.min.x,t.totalLayerBounds.max.y)],t=I(t,{color:"#808080",weight:5,opacity:.5,fill:!1}),this.addLayer(t))},_mapLayerUpdate:function(t){this.clearLayers(),this._addBounds(t.target)}}),z=function(t){return new T(t)},k=L.Path.extend({options:{className:"mapml-debug-extent"},initialize:function(t,e){this._locations=t,L.setOptions(this,e)},_project:function(){this._rings=[];let e=this._map.options.crs.scale(this._map.getZoom()),i=this._map;for(let t=0;t<this._locations.length;t++){var o=i.options.crs.transformation.transform(this._locations[t],e);this._rings.push(L.point(o.x,o.y)._subtract(i.getPixelOrigin()))}this._parts=[this._rings]},_update:function(){this._map&&this._renderer._updatePoly(this,!0)}}),I=function(t,e){return new k(t,e)},w=L.Handler.extend({addHooks:function(){L.setOptions(this,{mapEl:this._map.options.mapEl}),L.DomEvent.on(this._map,"click",this._queryTopLayer,this),L.DomEvent.on(this._map,"keypress",this._queryTopLayerAtMapCenter,this)},removeHooks:function(){L.DomEvent.off(this._map,"click",this._queryTopLayer,this),L.DomEvent.on(this._map,"keypress",this._queryTopLayerAtMapCenter,this)},_getTopQueryableLayer:function(){for(var t=this.options.mapEl.layers,e=t.length-1;0<=e;e--){var i=t[e]._layer;if(t[e].checked&&i.queryable)return i}},_queryTopLayerAtMapCenter:function(t){setTimeout(()=>{!this._map.isFocused||this._map._popupClosed||" "!==t.originalEvent.key&&13!=+t.originalEvent.keyCode?delete this._map._popupClosed:this._map.fire("click",{latlng:this._map.getCenter(),layerPoint:this._map.latLngToLayerPoint(this._map.getCenter()),containerPoint:this._map.latLngToContainerPoint(this._map.getCenter())})},0)},_queryTopLayer:function(t){var e=this._getTopQueryableLayer();e&&(e._mapmlFeatures&&delete e._mapmlFeatures,this._query(t,e))},_query(a,s){function e(t){return l.transformation.untransform(t,l.scale(n))}function i(t){return l.unproject(l.transformation.untransform(t,l.scale(n)),n)}function o(t,e,o){const n=new DOMParser;fetch(L.Util.template(t.template,e),{redirect:"follow"}).then(e=>{if(200<=e.status&&e.status<300)return e.text().then(t=>({contenttype:e.headers.get("Content-Type"),text:t}));throw new Error(e.status)}).then(i=>{if(s._mapmlFeatures||(s._mapmlFeatures=[]),i.contenttype.startsWith("text/mapml")){let t=n.parseFromString(i.text,"application/xml"),e=Array.prototype.slice.call(t.querySelectorAll("map-feature"));e.length&&(s._mapmlFeatures=s._mapmlFeatures.concat(e))}else{var t="<map-geometry cs='gcrs'>"+a.latlng.lng+" "+a.latlng.lat+"</map-geometry>",t=n.parseFromString("<map-feature><map-properties>"+i.text+"</map-properties>"+t+"</map-feature>","text/html").querySelector("map-feature");s._mapmlFeatures.push(t)}if(o)return function(t,e){let i=M.mapMlFeatures(t,{renderer:M.featureRenderer(),pane:u,projection:r.options.projection,_leafletLayer:s,query:!0,static:!0});i.addTo(r);let o=L.DomUtil.create("div","mapml-popup-content"),n=L.DomUtil.create("iframe");n.style="border: none",n.srcdoc=t[0].querySelector("map-feature map-properties").innerHTML,n.setAttribute("sandbox","allow-same-origin allow-forms"),o.appendChild(n),s._totalFeatureCount=t.length,s.bindPopup(o,p).openPopup(e),s.on("popupclose",function(){r.removeLayer(i)}),i.showPaginationFeature({i:0,popup:s._popup})}(s._mapmlFeatures,a.latlng)}).catch(t=>{console.log("Looks like there was a problem. Status: "+t.message)})}var n=a.target.getZoom(),r=this._map,l=s._extent.crs,m=r.options.crs.options.crs.tile.bounds.max.x,u=s._container,p={autoClose:!1,autoPan:!0,maxHeight:.5*r.getSize().y-50},c=l.latLngToPoint(a.latlng,n),h=c.divideBy(m).floor(),d=new L.Bounds(c.divideBy(m).floor().multiplyBy(m),c.divideBy(m).ceil().multiplyBy(m)),t=this._map.project(a.latlng),_=this._map.options.crs.scale(this._map.getZoom()),y=this._map.options.crs.transformation.untransform(t,_),x=s.getQueryTemplates(y);for(let t=0;t<x.length;t++){var g,f={},b=x[t];for(g in f[b.query.tilei]=c.x.toFixed()-h.x*m,f[b.query.tilej]=c.y.toFixed()-h.y*m,f[b.query.mapi]=r.getSize().divideBy(2).x.toFixed(),f[b.query.mapj]=r.getSize().divideBy(2).y.toFixed(),f[b.query.pixelleft]=l.pointToLatLng(c,n).lng,f[b.query.pixeltop]=l.pointToLatLng(c,n).lat,f[b.query.pixelright]=l.pointToLatLng(c.add([1,1]),n).lng,f[b.query.pixelbottom]=l.pointToLatLng(c.add([1,1]),n).lat,f[b.query.column]=h.x,f[b.query.row]=h.y,f[b.query.x]=c.x.toFixed(),f[b.query.y]=c.y.toFixed(),f[b.query.easting]=e(c).x,f[b.query.northing]=e(c).y,f[b.query.longitude]=i(c).lng,f[b.query.latitude]=i(c).lat,f[b.query.zoom]=n,f[b.query.width]=r.getSize().x,f[b.query.height]=r.getSize().y,f[b.query.mapbottom]=e(c.add(r.getSize().divideBy(2))).y,f[b.query.mapleft]=e(c.subtract(r.getSize().divideBy(2))).x,f[b.query.maptop]=e(c.subtract(r.getSize().divideBy(2))).y,f[b.query.mapright]=e(c.add(r.getSize().divideBy(2))).x,f[b.query.tilebottom]=e(d.max).y,f[b.query.tileleft]=e(d.min).x,f[b.query.tiletop]=e(d.min).y,f[b.query.tileright]=e(d.max).x,b.query)["mapi","mapj","tilei","tilej","row","col","x","y","easting","northing","longitude","latitude","width","height","zoom","mapleft","mapright",",maptop","mapbottom","tileleft","tileright","tiletop","tilebottom","pixeltop","pixelbottom","pixelleft","pixelright"].indexOf(g)<0&&(f[g]=b.query[g]);b.extentBounds.contains(y)&&o(b,f,t===x.length-1)}}}),F=L.Handler.extend({_touchstart:L.Browser.msPointer?"MSPointerDown":L.Browser.pointer?"pointerdown":"touchstart",initialize:function(t){L.Handler.prototype.initialize.call(this,t),this._items=[{text:M.options.locale.cmBack+" (<kbd>B</kbd>)",callback:this._goBack},{text:M.options.locale.cmForward+" (<kbd>F</kbd>)",callback:this._goForward},{text:M.options.locale.cmReload+" (<kbd>R</kbd>)",callback:this._reload},{spacer:"-"},{text:M.options.locale.cmToggleControls+" (<kbd>T</kbd>)",callback:this._toggleControls},{text:M.options.locale.cmCopyCoords+" (<kbd>C</kbd>)<span></span>",callback:this._copyCoords,hideOnSelect:!1,popup:!0,submenu:[{text:"tile",callback:this._copyTile},{text:"tilematrix",callback:this._copyTileMatrix},{spacer:"-"},{text:"map",callback:this._copyMap},{spacer:"-"},{text:"tcrs",callback:this._copyTCRS},{text:"pcrs",callback:this._copyPCRS},{text:"gcrs",callback:this._copyGCRS},{spacer:"-"},{text:M.options.locale.cmCopyAll,callback:this._copyAllCoords}]},{text:M.options.locale.cmToggleDebug+" (<kbd>D</kbd>)",callback:this._toggleDebug},{text:M.options.locale.cmCopyMapML+" (<kbd>M</kbd>)",callback:this._copyMapML},{text:M.options.locale.cmViewSource+" (<kbd>V</kbd>)",callback:this._viewSource}],this._layerItems=[{text:M.options.locale.lmZoomToLayer+" (<kbd>Z</kbd>)",callback:this._zoomToLayer},{text:M.options.locale.lmCopyExtent+" (<kbd>C</kbd>)",callback:this._copyLayerExtent}],this._mapMenuVisible=!1,this._keyboardEvent=!1,this._container=L.DomUtil.create("div","mapml-contextmenu",t._container),this._container.setAttribute("hidden","");for(let t=0;t<6;t++)this._items[t].el=this._createItem(this._container,this._items[t]);this._coordMenu=L.DomUtil.create("div","mapml-contextmenu mapml-submenu",this._container),this._coordMenu.id="mapml-copy-submenu",this._coordMenu.setAttribute("hidden",""),this._clickEvent=null;for(let t=0;t<this._items[5].submenu.length;t++)this._createItem(this._coordMenu,this._items[5].submenu[t],t);this._items[6].el=this._createItem(this._container,this._items[6]),this._items[7].el=this._createItem(this._container,this._items[7]),this._items[8].el=this._createItem(this._container,this._items[8]),this._layerMenu=L.DomUtil.create("div","mapml-contextmenu mapml-layer-menu",t._container),this._layerMenu.setAttribute("hidden","");for(let t=0;t<this._layerItems.length;t++)this._createItem(this._layerMenu,this._layerItems[t]);L.DomEvent.on(this._container,"click",L.DomEvent.stop).on(this._container,"mousedown",L.DomEvent.stop).on(this._container,"dblclick",L.DomEvent.stop).on(this._container,"contextmenu",L.DomEvent.stop).on(this._layerMenu,"click",L.DomEvent.stop).on(this._layerMenu,"mousedown",L.DomEvent.stop).on(this._layerMenu,"dblclick",L.DomEvent.stop).on(this._layerMenu,"contextmenu",L.DomEvent.stop)},addHooks:function(){var t=this._map.getContainer();L.DomEvent.on(t,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),L.Browser.touch&&L.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var t=this._map.getContainer();L.DomEvent.off(t,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),L.Browser.touch&&L.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},_copyLayerExtent:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,i=e._layerClicked.layer._layerEl,o=i.extent.topLeft.pcrs,n=i.extent.bottomRight.pcrs;t=`<map-meta name="extent" content="top-left-easting=${o.horizontal}, top-left-northing=${o.vertical}, bottom-right-easting=${n.horizontal}, bottom-right-northing=${n.vertical}"></map-meta>`;e._copyData(t)},_zoomToLayer:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu;e._layerClicked.layer._layerEl.focus()},_goForward:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.forward()},_goBack:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.back()},_reload:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.reload()},_toggleControls:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e._toggleControls()},_copyMapML:function(t){let e=(t instanceof KeyboardEvent?this._map:this).contextMenu,i=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e._copyData(i.outerHTML.replace(/<div class="mapml-web-map">.*?<\/div>|<style>\[is="web-map"].*?<\/style>|<style>mapml-viewer.*?<\/style>/gm,""))},_viewSource:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.viewSource()},_toggleDebug:function(t){let e=(t instanceof KeyboardEvent?this._map:this).options.mapEl;e.toggleDebug()},_copyCoords:function(t){let e=this.contextMenu||this;e._showCoordMenu(t)},_copyData:function(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)},_copyGCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent;this.contextMenu._copyData(`z:${e.zoom}, lon :${i.latlng.lng.toFixed(6)}, lat:`+i.latlng.lat.toFixed(6))},_copyTCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng);this.contextMenu._copyData(`z:${e.zoom}, x:${o.x}, y:`+o.y)},_copyTileMatrix:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x;this.contextMenu._copyData(`z:${e.zoom}, column:${Math.trunc(o.x/n)}, row:`+Math.trunc(o.y/n))},_copyPCRS:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=e._map.options.crs.scale(+e.zoom),a=e._map.options.crs.transformation.untransform(o,n);this.contextMenu._copyData(`z:${e.zoom}, easting:${a.x.toFixed(2)}, northing:`+a.y.toFixed(2))},_copyTile:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.options.crs.project(i.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x,a=o.x%n,s=o.y%n;a<0&&(a+=n),s<0&&(s+=n),this.contextMenu._copyData(`z:${e.zoom}, i:${Math.trunc(a)}, j:`+Math.trunc(s))},_copyMap:function(t){var e=this.options.mapEl,i=this.contextMenu._clickEvent;this.contextMenu._copyData(`z:${e.zoom}, i:${Math.trunc(i.containerPoint.x)}, j:`+Math.trunc(i.containerPoint.y))},_copyAllCoords:function(t){let e=this.options.mapEl,i=this.contextMenu._clickEvent,o=e._map.project(i.latlng),n=e._map.options.crs.options.crs.tile.bounds.max.x,a=o.x%n,s=o.y%n,r=e._map.options.crs.scale(+e.zoom),l=e._map.options.crs.transformation.untransform(o,r);var m=`z:${e.zoom}
`;m+=`tile: i:${Math.trunc(a)}, j:${Math.trunc(s)}
`,m+=`tilematrix: column:${Math.trunc(o.x/n)}, row:${Math.trunc(o.y/n)}
`,m+=`map: i:${Math.trunc(i.containerPoint.x)}, j:${Math.trunc(i.containerPoint.y)}
`,m+=`tcrs: x:${Math.trunc(o.x)}, y:${Math.trunc(o.y)}
`,m+=`pcrs: easting:${l.x.toFixed(2)}, northing:${l.y.toFixed(2)}
`,m+=`gcrs: lon :${i.latlng.lng.toFixed(6)}, lat:`+i.latlng.lat.toFixed(6),this.contextMenu._copyData(m)},_createItem:function(t,e,i){if(e.spacer)return this._createSeparator(t,i);t=this._insertElementAt("button","mapml-contextmenu-item",t,i),i=this._createEventHandler(t,e.callback,e.context,e.hideOnSelect);return t.innerHTML=""+e.text,t.setAttribute("type","button"),t.classList.add("mapml-button"),e.popup&&(t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","mapml-copy-submenu")),L.DomEvent.on(t,"mouseover",this._onItemMouseOver,this).on(t,"mouseout",this._onItemMouseOut,this).on(t,"mousedown",L.DomEvent.stopPropagation).on(t,"click",i),L.Browser.touch&&L.DomEvent.on(t,this._touchstart,L.DomEvent.stopPropagation),L.Browser.pointer||L.DomEvent.on(t,"click",this._onItemMouseOut,this),{id:L.Util.stamp(t),el:t,callback:i}},_createSeparator:function(t,e){e=this._insertElementAt("div","mapml-contextmenu-separator",t,e);return{id:L.Util.stamp(e),el:e}},_createEventHandler:function(r,l,m,u){let p=this;return u=void 0===u||u,function(t){let e=p._map,i=p._showLocation.containerPoint,o=e.containerPointToLayerPoint(i),n=e.layerPointToLatLng(o),a=p._showLocation.relatedTarget,s={containerPoint:i,layerPoint:o,latlng:n,relatedTarget:a};u&&p._hide(),l&&l.call(m||e,s),p._map.fire("contextmenu.select",{contextmenu:p,el:r})}},_insertElementAt:function(t,e,i,o){let n,a=document.createElement(t);return a.className=e,void 0!==o&&(n=i.children[o]),n?i.insertBefore(a,n):i.appendChild(a),a},_show:function(t){this._mapMenuVisible&&this._hide();let e=(this._clickEvent=t).originalEvent.target;if(e.closest("fieldset")){if(e=e.closest("fieldset"),e=("mapml-layer-extent"===e.className?e.closest("fieldset").parentNode.parentNode.parentNode:e).querySelector("span"),!e.layer.validProjection)return;this._layerClicked=e,this._showAtPoint(t.containerPoint,t,this._layerMenu)}else(e.classList.contains("leaflet-container")||e.classList.contains("mapml-debug-extent")||"path"===e.tagName)&&(this._layerClicked=void 0,this._showAtPoint(t.containerPoint,t,this._container));0!==t.originalEvent.button&&-1!==t.originalEvent.button||(this._keyboardEvent=!0,this._layerClicked?(t=document.activeElement,this._elementInFocus=t.shadowRoot.activeElement,this._layerMenuTabs=1,this._layerMenu.firstChild.focus()):this._container.firstChild.focus())},_showAtPoint:function(t,e,i){var o;this._items.length&&(o=L.extend(e||{},{contextmenu:this}),this._showLocation={containerPoint:t},e&&e.relatedTarget&&(this._showLocation.relatedTarget=e.relatedTarget),this._setPosition(t,i),this._mapMenuVisible||(i.removeAttribute("hidden"),this._mapMenuVisible=!0),this._map.fire("contextmenu.show",o))},_hide:function(){this._mapMenuVisible&&(this._mapMenuVisible=!1,this._container.setAttribute("hidden",""),this._coordMenu.setAttribute("hidden",""),this._layerMenu.setAttribute("hidden",""),this._map.fire("contextmenu.hide",{contextmenu:this}),setTimeout(()=>this._map._container.focus(),0))},_setPosition:function(t,e){var i,o=this._map.getSize(),n=this._getElementSize(e);this._map.options.contextmenuAnchor&&(i=L.point(this._map.options.contextmenuAnchor),t=t.add(i)),(e._leaflet_pos=t).x+n.x>o.x?(e.style.left="auto",e.style.right=Math.min(Math.max(o.x-t.x,0),o.x-n.x-1)+"px"):(e.style.left=Math.max(t.x,0)+"px",e.style.right="auto"),t.y+n.y>o.y?(e.style.top="auto",e.style.bottom=Math.min(Math.max(o.y-t.y,0),o.y-n.y-1)+"px"):(e.style.top=Math.max(t.y,0)+"px",e.style.bottom="auto")},_getElementSize:function(t){let e=this._size;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",this._sizeChanged=!1),e},_focusOnLayerControl:function(){this._mapMenuVisible=!1,delete this._layerMenuTabs,this._layerMenu.setAttribute("hidden",""),(this._elementInFocus||this._layerClicked.parentElement.firstChild).focus(),delete this._elementInFocus},_onKeyDown:function(t){if(this._mapMenuVisible){var e=t.keyCode,i=t.path||t.composedPath();switch(13===e&&t.preventDefault(),!this._layerMenuTabs||9!==e&&27!==e?16===e||9===e||!this._layerClicked&&67===e||i[0].innerText===M.options.locale.cmCopyCoords+" (C)"||this._hide():(t.shiftKey?--this._layerMenuTabs:this._layerMenuTabs+=1,0!==this._layerMenuTabs&&3!==this._layerMenuTabs&&27!==e||(L.DomEvent.stop(t),this._focusOnLayerControl())),e){case 13:case 32:this._map._container.parentNode.activeElement.parentNode.classList.contains("mapml-contextmenu")&&this._map._container.parentNode.activeElement.click();break;case 66:this._goBack(t);break;case 67:this._layerClicked?this._copyLayerExtent(t):this._copyCoords({latlng:this._map.getCenter()});break;case 68:this._toggleDebug(t);break;case 77:this._copyMapML(t);break;case 70:this._goForward(t);break;case 82:this._reload(t);break;case 84:this._toggleControls(t);break;case 86:this._viewSource(t);break;case 90:this._layerClicked&&this._zoomToLayer(t)}}},_showCoordMenu:function(t){let e=this._map.getSize(),i=this._clickEvent,o=this._coordMenu,n=this._items[5].el.el;n.setAttribute("aria-expanded","true"),o.removeAttribute("hidden"),i.containerPoint.x+160+80>e.x?(o.style.left="auto",o.style.right="160px"):(o.style.left="160px",o.style.right="auto"),i.containerPoint.y+160>e.y?(o.style.top="auto",o.style.bottom="20px"):(o.style.top="100px",o.style.bottom="auto"),this._keyboardEvent&&o.firstChild.focus()},_hideCoordMenu:function(t){if(!t.srcElement.parentElement.classList.contains("mapml-submenu")&&t.srcElement.innerText!==M.options.locale.cmCopyCoords+" (C)"){let t=this._coordMenu,e=this._items[5].el.el;e.setAttribute("aria-expanded","false"),t.setAttribute("hidden","")}},_onItemMouseOver:function(t){L.DomUtil.addClass(t.target||t.srcElement,"over"),t.srcElement.innerText===M.options.locale.cmCopyCoords+" (C)"&&this._showCoordMenu(t)},_onItemMouseOut:function(t){L.DomUtil.removeClass(t.target||t.srcElement,"over"),this._hideCoordMenu(t)}}),D=function(e,i){if(!e||!i)return{};let o=[],n=[],a=[],s=[],r=i.options.crs.options.crs.tile.bounds.max.y;for(let t=0;t<i.options.crs.options.resolutions.length;t++){var l=i.options.crs.scale(t),m=i.options.crs.transformation.transform(e.min,l),l=i.options.crs.transformation.transform(e.max,l);o.push({horizontal:m.x,vertical:l.y}),n.push({horizontal:l.x,vertical:m.y}),a.push({horizontal:o[t].horizontal/r,vertical:o[t].vertical/r}),s.push({horizontal:n[t].horizontal/r,vertical:n[t].vertical/r})}var t=i.options.crs.unproject(e.min),u=i.options.crs.unproject(e.max);let p={horizontal:t.lng,vertical:u.lat},c={horizontal:u.lng,vertical:t.lat},h={horizontal:e.min.x,vertical:e.max.y},d={horizontal:e.max.x,vertical:e.min.y};return{topLeft:{tcrs:o,tilematrix:a,gcrs:p,pcrs:h},bottomRight:{tcrs:n,tilematrix:s,gcrs:c,pcrs:d},projection:i.options.projection}},N=function(u){if(u){let e=u.values,t=u.projection||B,i=0,o=d,n=this[t].options.crs.tilematrix.bounds(0),a=this[t].options.resolutions.length-1,s=0,r=a,l=!1,m=0;for(let t=0;t<e.length;t++)switch(e[t].getAttribute("type")){case"zoom":s=+(e[t].hasAttribute("min")&&!isNaN(+e[t].getAttribute("min"))?e[t].getAttribute("min"):0),r=+(e[t].hasAttribute("max")&&!isNaN(+e[t].getAttribute("max"))?e[t].getAttribute("max"):a),i=+e[t].getAttribute("value");break;case"location":if(!e[t].getAttribute("max")||!e[t].getAttribute("min"))continue;var p=+e[t].getAttribute("max"),c=+e[t].getAttribute("min");switch(e[t].getAttribute("axis").toLowerCase()){case"x":case"longitude":case"column":case"easting":o=M.axisToCS(e[t].getAttribute("axis").toLowerCase()),n.min.x=c,n.max.x=p,m++;break;case"y":case"latitude":case"row":case"northing":o=M.axisToCS(e[t].getAttribute("axis").toLowerCase()),n.min.y=c,n.max.y=p,m++}}2<=m&&(l=!0);var h={minZoom:u.zoomBounds?.min&&!isNaN(+u.zoomBounds.min)?+u.zoomBounds.min:0,maxZoom:u.zoomBounds?.max&&!isNaN(+u.zoomBounds.max)?+u.zoomBounds.max:a,minNativeZoom:s,maxNativeZoom:r};return n=!l&&u.extentPCRSFallback&&u.extentPCRSFallback.bounds?u.extentPCRSFallback.bounds:l?this.boundsToPCRSBounds(n,i,t,o):this[t].options.crs.pcrs.bounds,{zoomBounds:h,bounds:n}}},q=function(t){try{switch(t.toLowerCase()){case"row":case"column":return"TILEMATRIX";case"i":case"j":return["MAP","TILE"];case"x":case"y":return"TCRS";case"latitude":case"longitude":return"GCRS";case"northing":case"easting":return"PCRS";default:return d}}catch(t){return}},R=function(t){try{switch(t.toLowerCase()){case"tilematrix":return["column","row"];case"map":case"tile":return["i","j"];case"tcrs":return["x","y"];case"gcrs":return["longitude","latitude"];case"pcrs":return["easting","northing"]}}catch(t){return}},O=function(t){try{switch(t.toLowerCase()){case"i":case"column":case"longitude":case"x":case"easting":return"x";case"row":case"j":case"latitude":case"y":case"northing":return"y";default:return}}catch(t){return}},Z=function(t,e,i,o){if(t&&(e||0===e)&&Number.isFinite(+e)&&i&&o)switch(i="string"==typeof i?M[i]:i,o.toUpperCase()){case"PCRS":return t;case"TCRS":case"TILEMATRIX":var n=i.transformation.transform(t.min,i.scale(+e)),a=i.transformation.transform(t.max,i.scale(+e));if("TCRS"===o.toUpperCase())return L.bounds(n,a);var s=i.options.crs.tile.bounds.max.x;return L.bounds(L.point(n.x/s,n.y/s),L.point(a.x/s,a.y/s));case"GCRS":a=i.unproject(t.min),s=i.unproject(t.max);return L.bounds(L.point(a.lng,a.lat),L.point(s.lng,s.lat));default:return}},U=function(t,e,i,o){if(t&&(e||0===e)&&Number.isFinite(+e)&&o&&i){var n=(i="string"==typeof i?M[i]:i).options.crs.tile.bounds.max.x;switch(o.toUpperCase()){case"TILEMATRIX":return M.pixelToPCRSPoint(L.point(t.x*n,t.y*n),e,i);case"PCRS":return t;case"TCRS":return M.pixelToPCRSPoint(t,e,i);case"GCRS":return i.project(L.latLng(t.y,t.x));default:return}}},j=function(t,e,i){if(t&&(e||0===e)&&Number.isFinite(+e)&&i)return(i="string"==typeof i?M[i]:i).transformation.untransform(t,i.scale(e))},V=function(t,e,i,o){if(t&&t.max&&t.min&&(e||0===e)&&Number.isFinite(+e)&&i&&o)return i="string"==typeof i?M[i]:i,L.bounds(M.pointToPCRSPoint(t.min,e,i,o),M.pointToPCRSPoint(t.max,e,i,o))},G=function(t,e,i){if(t&&t.max&&t.min&&(e||0===e)&&Number.isFinite(+e)&&i)return i="string"==typeof i?M[i]:i,L.bounds(M.pixelToPCRSPoint(t.min,e,i),M.pixelToPCRSPoint(t.max,e,i))},H=function(t){if(!t||t instanceof Object)return{};let e=t.split(/\s+/).join(""),i={},o=e.split(",");for(let t=0;t<o.length;t++){var n=o[t].split("=");2===n.length&&(i[n[0]]=n[1])}return""!==i&&1===o[0].split("=").length&&(i.content=o[0]),i},$=function(t){for(var e=1,i=[],o=t.split(",");e<o.length;e+=2)i.push([parseInt(o[e-1]),parseInt(o[e])]);return i},W=function(t,e,i){if(i instanceof Element&&t&&t.querySelector("map-link[rel=stylesheet],map-style")){if(e instanceof Element)e=e.getAttribute("href")?e.getAttribute("href"):document.URL;else if(!e||""===e||e instanceof Object)return;for(var o,n,a=[],s=t.querySelectorAll("map-link[rel=stylesheet],map-style"),r=0;r<s.length;r++)"MAP-LINK"===s[r].nodeName.toUpperCase()?(o=s[r].hasAttribute("href")?new URL(s[r].getAttribute("href"),e).href:null)&&(i.querySelector("link[href='"+o+"']")||((n=document.createElement("link")).setAttribute("href",o),n.setAttribute("rel","stylesheet"),a.push(n))):((n=document.createElement("style")).textContent=s[r].textContent,a.push(n));for(var l=a.length-1;0<=l;l--)i.insertAdjacentElement("afterbegin",a[l])}},K=function(t,e,i){var o=[];t.split(/\s+/gim).forEach(M.parseNumber,o),this.push(o)},Y=function(t,e,i){this.push(parseFloat(t))},Q=function(o,t){let n,i=!1,a,s=t._map,r;if("text/html"===o.type&&"_blank"!==o.target)o.target="_top";else if("text/html"!==o.type&&o.url.includes("#")){let t=o.url.split("#"),e=t[1].split(",");n={z:e[0]||0,lng:e[1]||0,lat:e[2]||0},i=!t[0],["/",".","#"].includes(o.url[0])&&(o.target="_self")}if(i)n&&!o.inPlace&&i&&(t._map.options.mapEl.zoomTo(+n.lat,+n.lng,+n.z),r&&(a.opacity=r));else{let i=!1;switch(a=document.createElement("layer-"),a.setAttribute("src",o.url),a.setAttribute("checked",""),o.target){case"_blank":"text/html"===o.type?window.open(o.url):(s.options.mapEl.appendChild(a),i=!0);break;case"_parent":for(var e of s.options.mapEl.querySelectorAll("layer-"))e._layer!==t&&s.options.mapEl.removeChild(e);s.options.mapEl.appendChild(a),s.options.mapEl.removeChild(t._layerEl),i=!0;break;case"_top":window.location.href=o.url;break;default:r=t._layerEl.opacity,t._layerEl.insertAdjacentElement("beforebegin",a),s.options.mapEl.removeChild(t._layerEl),i=!0}!o.inPlace&&i&&L.DomEvent.on(a,"extentload",function t(e){i&&["_parent","_self"].includes(o.target)&&1===a.parentElement.querySelectorAll("layer-").length&&(a.parentElement.projection=a._layer.getProjection()),a.extent&&(n?a.parentElement.zoomTo(+n.lat,+n.lng,+n.z):a.focus(),L.DomEvent.off(a,"extentload",t)),r&&(a.opacity=r),s.getContainer().focus()})}},X=function(t){var e=t._map.project(t._map.getCenter()),t=t._map.options.crs.options.crs.tile.bounds.max.y;return[Math.trunc(e.x/t),Math.trunc(e.y/t)]},J=L.Control.extend({options:{position:"topleft"},onAdd:function(t){var e=L.DomUtil.create("div","mapml-reload-button leaflet-bar");let i=L.DomUtil.create("button","mapml-reload-button",e);return i.innerHTML="<span aria-hidden='true'>&#x021BA</span>",i.title=M.options.locale.cmReload,i.setAttribute("type","button"),i.classList.add("mapml-button"),i.setAttribute("aria-label","Reload"),L.DomEvent.disableClickPropagation(i),L.DomEvent.on(i,"click",L.DomEvent.stop),L.DomEvent.on(i,"click",this._goReload,this),this._reloadButton=i,this._updateDisabled(),t.on("moveend",this._updateDisabled,this),e},onRemove:function(t){t.off("moveend",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_goReload:function(t){!this._disabled&&1<this._map.options.mapEl._history.length&&this._map.options.mapEl.reload()},_updateDisabled:function(){setTimeout(()=>{L.DomUtil.removeClass(this._reloadButton,"leaflet-disabled"),this._reloadButton.setAttribute("aria-disabled","false"),this._map&&(this._disabled||this._map.options.mapEl._history.length<=1)&&(L.DomUtil.addClass(this._reloadButton,"leaflet-disabled"),this._reloadButton.setAttribute("aria-disabled","true"))},0)}}),tt=L.Control.extend({options:{position:"topleft",title:{false:"View fullscreen",true:"Exit fullscreen"}},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",e),this.link.href="#",this.link.setAttribute("role","button"),this._map=t,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),e},onRemove:function(t){t.off("fullscreenchange",this._toggleTitle,this)},_click:function(t){L.DomEvent.stopPropagation(t),L.DomEvent.preventDefault(t),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(t){var e=this.getContainer().getRootNode().host,e="DIV"===e.nodeName?e.parentElement:e;this.isFullscreen()?t&&t.pseudoFullscreen?this._disablePseudoFullscreen(e):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(e):t&&t.pseudoFullscreen?this._enablePseudoFullscreen(e):e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen?e.msRequestFullscreen():this._enablePseudoFullscreen(e)},_enablePseudoFullscreen:function(t){L.DomUtil.addClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(t){L.DomUtil.removeClass(t,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(t){this._isFullscreen=t;var e=this.getContainer().getRootNode().host;t?L.DomUtil.addClass(e,"mapml-fullscreen-on"):L.DomUtil.removeClass(e,"mapml-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(t){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,i=this.getContainer().getRootNode().host,i="DIV"===i.nodeName?i.parentElement:i;e!==i||this._isFullscreen?e!==i&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange")):(this._setFullscreen(!0),this.fire("fullscreenchange"))}}),L.Map.mergeOptions({fullscreenControl:!1}),L.Map.addInitHook(function(){var t,e;this.options.fullscreenControl&&(this.fullscreenControl=new tt(this.options.fullscreenControl),this.addControl(this.fullscreenControl)),"onfullscreenchange"in document?t="fullscreenchange":"onmozfullscreenchange"in document?t="mozfullscreenchange":"onwebkitfullscreenchange"in document?t="webkitfullscreenchange":"onmsfullscreenchange"in document&&(t="MSFullscreenChange"),t&&(e=L.bind(this._onFullscreenChange,this),this.whenReady(function(){L.DomEvent.on(document,t,e)}),this.on("unload",function(){L.DomEvent.off(document,t,e)}))});function et(t){return new tt(t)}function it(t){return new lt(t)}function ot(t,e){return new mt(t,e)}function nt(t){return new ut(t)}function at(t,e){return new pt(t,e)}var st,rt,lt=L.Layer.extend({onAdd:function(t){this._container=L.DomUtil.create("div","mapml-crosshair",t._container),this._container.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 100 100"><g stroke="#fff" stroke-linecap="round" stroke-linejoin="round"><circle cx="50.028" cy="50.219" r="3.923" stroke-width="2" color="currentColor" overflow="visible"/><path stroke-width="3" d="M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z" color="currentColor" overflow="visible"/><path stroke-width="3" d="M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z"/><path stroke-width="3" d="M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z" color="currentColor" overflow="visible"/></g></svg>',t.isFocused=!1,this._isQueryable=!1,t.on("layerchange layeradd layerremove overlayremove",this._toggleEvents,this),t.on("popupopen",this._isMapFocused,this),L.DomEvent.on(t._container,"keydown keyup mousedown",this._isMapFocused,this),this._addOrRemoveCrosshair()},onRemove:function(t){t.off("layerchange layeradd layerremove overlayremove",this._toggleEvents),t.off("popupopen",this._isMapFocused),L.DomEvent.off(t._container,"keydown keyup mousedown",this._isMapFocused)},_toggleEvents:function(){this._hasQueryableLayer()?this._map.on("viewreset move moveend",this._addOrRemoveCrosshair,this):this._map.off("viewreset move moveend",this._addOrRemoveCrosshair,this),this._addOrRemoveCrosshair()},_addOrRemoveCrosshair:function(t){this._hasQueryableLayer()?this._container.removeAttribute("hidden"):this._container.setAttribute("hidden","")},_addOrRemoveMapOutline:function(t){var e=this._map._container;this._map.isFocused&&!this._outline?this._outline=L.DomUtil.create("div","mapml-outline",e):!this._map.isFocused&&this._outline&&(L.DomUtil.remove(this._outline),delete this._outline)},_hasQueryableLayer:function(){var t=this._map.options.mapEl.layers;if(this._map.isFocused)for(var e of t)if(e.checked&&e._layer.queryable)return!0;return!1},_isMapFocused:function(t){var e;this._map._container.parentNode.activeElement?((e=this._map._container.parentNode.activeElement.classList.contains("leaflet-container"))&&["keydown"].includes(t.type)&&t.shiftKey&&9===t.keyCode?this._map.isFocused=!1:this._map.isFocused=e&&["keyup","keydown"].includes(t.type),this._map.isFocused&&this._map.fire("mapkeyboardfocused"),this._addOrRemoveMapOutline(),this._addOrRemoveCrosshair()):this._map.isFocused=!1}}),mt=L.Path.extend({initialize:function(t,e){this.type=t.tagName.toUpperCase(),"MAP-POINT"!==this.type&&"MAP-MULTIPOINT"!==this.type||(e.fillOpacity=1),0<e.wrappers.length&&(e=Object.assign(this._convertWrappers(e.wrappers),e)),L.setOptions(this,e),this.group=this.options.group,this.options.interactive=this.options.link||this.options.properties&&this.options.onEachFeature,this._parts=[],this._markup=t,this.options.zoom=t.getAttribute("zoom")||this.options.nativeZoom,this._convertMarkup(),(t.querySelector("map-span")||t.querySelector("map-a"))&&this._generateOutlinePoints(),this.isClosed=this._isClosed()},attachLinkHandler:function(o,n,a){let s,i=document.createElement("div"),r=document.createElement("p"),l=!1;i.classList.add("mapml-link-preview"),i.appendChild(r),o.classList.add("map-a"),n.visited&&o.classList.add("map-a-visited"),L.DomEvent.on(o,"mousedown",t=>s={x:t.clientX,y:t.clientY},this),L.DomEvent.on(o,"mouseup",i=>{if(0===i.button){let t=!0,e=this.options._leafletLayer._layerEl.nextElementSibling;for(;e&&t;)e.tagName&&"LAYER-"===e.tagName.toUpperCase()&&(t=!(e.checked&&e._layer.queryable)),e=e.nextElementSibling;t&&s&&(L.DomEvent.stop(i),Math.sqrt(Math.pow(s.x-i.clientX,2)+Math.pow(s.y-i.clientY,2))<=5&&(n.visited=!0,o.setAttribute("stroke","#6c00a2"),o.classList.add("map-a-visited"),M.handleLink(n,a)))}},this),L.DomEvent.on(o,"keypress",t=>{L.DomEvent.stop(t),13!==t.keyCode&&32!==t.keyCode||(n.visited=!0,o.setAttribute("stroke","#6c00a2"),o.classList.add("map-a-visited"),M.handleLink(n,a))},this),L.DomEvent.on(o,"mouseenter keyup",t=>{if(t.target===t.currentTarget){l=!0;let t=document.createElement("a"),e=this._map.getContainer().clientWidth;for(t.href=n.url,r.innerHTML=t.href,this._map.getContainer().appendChild(i);r.clientWidth>e/2;)r.innerHTML=r.innerHTML.substring(0,r.innerHTML.length-5)+"...";setTimeout(()=>{l&&(r.innerHTML=t.href)},1e3)}},this),L.DomEvent.on(o,"mouseout keydown mousedown",t=>{t.target===t.currentTarget&&i.parentElement&&(l=!1,this._map.getContainer().removeChild(i))},this),L.DomEvent.on(a._map.getContainer(),"mouseout mouseenter click",t=>{i.parentElement&&(l=!1,this._map.getContainer().removeChild(i))},this)},_project:function(t,e=void 0,i=void 0){let o=t||this._map,n=e||o.getPixelOrigin(),a=void 0===i?o.getZoom():i;for(var s of this._parts){s.pixelRings=this._convertRing(s.rings,o,n,a);for(var r of s.subrings)r.pixelSubrings=this._convertRing([r],o,n,a)}if(this._outline){this.pixelOutline=[];for(var l of this._outline)this.pixelOutline=this.pixelOutline.concat(this._convertRing(l,o,n,a))}},_convertRing:function(t,e,i,o){let n=e.options.crs.scale(o),a=[];for(var s of t){let t=[];for(var r of s.points){r=e.options.crs.transformation.transform(r,n);t.push(L.point(r.x,r.y)._subtract(i).round())}a.push(t)}return a},_update:function(){this._map&&this._renderer._updateFeature(this)},_convertWrappers:function(i){if(i&&0!==i.length){let t="",e={};for(var o of i)if("MAP-A"!==o.tagName.toUpperCase()&&o.className)t+=o.className+" ";else if(!e.link&&o.getAttribute("href")){let t={};t.url=o.getAttribute("href"),o.hasAttribute("target")&&(t.target=o.getAttribute("target")),o.hasAttribute("type")&&(t.type=o.getAttribute("type")),o.hasAttribute("inplace")&&(t.inPlace=!0),e.link=t}return e.className=(t+" "+this.options.className).trim(),e}},_convertMarkup:function(){if(this._markup){var o,e=this._markup.attributes;this.featureAttributes={},this.options.link&&"MAP-A"===this._markup.parentElement.tagName.toUpperCase()&&"MAP-GEOMETRY"!==this._markup.parentElement.parentElement.tagName.toUpperCase()&&(this.featureAttributes.tabindex="0");for(let t=0;t<e.length;t++)this.featureAttributes[e[t].name]=e[t].value;let i=!0;for(o of this._markup.querySelectorAll("map-coordinates")){let t=[],e=[];if(this._coordinateToArrays(o,t,e,this.options.className),i||"MAP-POLYGON"!==this.type)if("MAP-MULTIPOINT"===this.type)for(var n of t[0].points.concat(e))this._parts.push({rings:[{points:[n]}],subrings:[],cls:(`${n.cls||""} `+(this.options.className||"")).trim()});else this._parts.push({rings:t,subrings:e,cls:(`${this.featureAttributes.class||""} `+(this.options.className||"")).trim()});else this._parts[0].rings.push(t[0]),0<e.length&&(this._parts[0].subrings=this._parts[0].subrings.concat(e));i=!1}}},_generateOutlinePoints:function(){if("MAP-MULTIPOINT"!==this.type&&"MAP-POINT"!==this.type&&"MAP-LINESTRING"!==this.type&&"MAP-MULTILINESTRING"!==this.type){this._outline=[];for(var t of this._markup.querySelectorAll("map-coordinates")){let i=t.childNodes,o=0,n=document.createElement("div");i.length;for(let t=0;t<i.length;t++)0===i[t].textContent.trim().length&&i[t].remove();for(var a of i){var s,r=[];if(!a.tagName){let t="",e=((o-1)%i.length+i.length)%i.length;i[e].tagName&&(s=i[e].textContent.trim().split(/\s+/),t+=`${s[s.length-2]} ${s[s.length-1]} `),t+=a.textContent,e=((o+1)%i.length+i.length)%i.length,i[e].tagName&&(a=i[e].textContent.trim().split(/\s+/),t+=`${a[0]} ${a[1]} `),n.innerHTML=t,this._coordinateToArrays(n,r,[],!0,this.featureAttributes.class||this.options.className),this._outline.push(r)}o++}}}},_coordinateToArrays:function(o,t,n,e=!0,a=void 0,s=[]){for(var i of o.children)this._coordinateToArrays(i,t,n,!1,i.getAttribute("class"),s.concat([i]));let r=o.textContent.replace(/(<([^>]+)>)/gi,""),l=r.match(/(\S+\s+\S+)/gim),m=[],u;for(var p of l){var c=[];p.split(/\s+/gim).forEach(M.parseNumber,c);c=M.pointToPCRSPoint(L.point(c),this.options.zoom,this.options.projection,this.options.nativeCS);m.push(c),u=u?u.extend(c):L.bounds(c,c)}if(this._bounds?(this._bounds.extend(u.min),this._bounds.extend(u.max)):this._bounds=u,e)t.push({points:m});else{let e={},i=o.attributes,t=this._convertWrappers(s);t.link&&(e.tabindex="0");for(let t=0;t<i.length;t++)"class"!==i[t].name&&(e[i[t].name]=i[t].value);n.unshift({points:m,center:u.getCenter(),cls:(`${a||""} `+(t.className||"")).trim(),attr:e,link:t.link,linkTarget:t.linkTarget,linkType:t.linkType})}},_isClosed:function(){switch(this.type){case"MAP-POLYGON":case"MAP-MULTIPOLYGON":case"MAP-POINT":case"MAP-MULTIPOINT":return!0;default:return!1}},getCenter:function(){return this._bounds?this._map.options.crs.unproject(this._bounds.getCenter()):null},getPCRSCenter:function(){return this._bounds.getCenter()}}),ut=L.SVG.extend({_initContainer:function(){L.SVG.prototype._initContainer.call(this),this._container.setAttribute("role","none presentation")},_initPath:function(e,t=!0){if(e._outline){let t=L.SVG.create("path");e.options.className&&L.DomUtil.addClass(t,e.featureAttributes.class||e.options.className),L.DomUtil.addClass(t,"mapml-feature-outline"),t.style.fill="none",e.outlinePath=t}for(var i of e._parts){if(i.rings&&(this._createPath(i,e.options.className,e.featureAttributes["aria-label"],e.options.interactive,e.featureAttributes),e.outlinePath&&(i.path.style.stroke="none")),i.subrings)for(var o of i.subrings)this._createPath(o,e.options.className,o.attr["aria-label"],void 0!==o.link,o.attr);this._updateStyle(e)}t&&(t=L.stamp(e),this._layers[t]=e)},_createPath:function(t,e,i,o=!1,n=void 0){let a=L.SVG.create("path");if(t.path=a,n)for(var[s,r]of Object.entries(n))"id"!==s&&"tabindex"!==s&&a.setAttribute(s,r);else i&&a.setAttribute("aria-label",i);(t.cls||e)&&L.DomUtil.addClass(a,t.cls||e),o&&L.DomUtil.addClass(a,"leaflet-interactive")},_addPath:function(t,e=void 0,i=!0){this._rootGroup||e||this._initContainer();let o=e||this._rootGroup,n=!1;i&&t.addInteractiveTarget(t.group);for(var a of t._parts){a.path&&t.group.appendChild(a.path),i&&(t.options.link&&t.attachLinkHandler(a.path,t.options.link,t.options._leafletLayer),t.addInteractiveTarget(a.path)),!n&&t.pixelOutline&&(t.group.appendChild(t.outlinePath),n=!0);for(var s of a.subrings)s.path&&(s.link&&(t.attachLinkHandler(s.path,s.link,t.options._leafletLayer),t.addInteractiveTarget(s.path)),t.group.appendChild(s.path))}o.appendChild(t.group)},_removePath:function(t){for(var e of t._parts){e.path&&(t.removeInteractiveTarget(e.path),L.DomUtil.remove(e.path));for(var i of e.subrings)i.path&&L.DomUtil.remove(i.path)}t.outlinePath&&L.DomUtil.remove(t.outlinePath),t.removeInteractiveTarget(t.group),L.DomUtil.remove(t.group),delete this._layers[L.stamp(t)]},_updateFeature:function(t){t.pixelOutline&&this._setPath(t.outlinePath,this.geometryToPath(t.pixelOutline,!1));for(var e of t._parts){this._setPath(e.path,this.geometryToPath(e.pixelRings,t.isClosed));for(var i of e.subrings)this._setPath(i.path,this.geometryToPath(i.pixelSubrings,!1))}},_pointToMarker:function(t){return`M${t.x} ${t.y} L${t.x-12.5} ${t.y-30} C${t.x-12.5} ${t.y-50}, ${t.x+12.5} ${t.y-50}, ${t.x+12.5} ${t.y-30} L${t.x} ${t.y}z`},_updateStyle:function(t){this._updatePathStyle(t.outlinePath,t,!1,!0);for(var e of t._parts){e.path&&this._updatePathStyle(e.path,t,!0);for(var i of e.subrings)i.path&&this._updatePathStyle(i.path,t)}},_updatePathStyle:function(t,e,i=!1,o=!1){var n,a;t&&e&&(n=e.options,a=e.isClosed,n.stroke&&(!a||o)||i&&!e.outlinePath?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset"),n.link&&(t.setAttribute("stroke",n.link.visited?"#6c00a2":"#0000EE"),t.setAttribute("stroke-opacity","1"),t.setAttribute("stroke-width","1px"),t.setAttribute("stroke-dasharray","none"))):t.setAttribute("stroke","none"),a&&!o?n.fill?t.setAttribute("fill",n.color):(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_setPath:function(t,e){t.setAttribute("d",e)},geometryToPath:function(t,e){let i="",o,n,a,s,r,l;for(o=0,a=t.length;o<a;o++){if(1===(r=t[o]).length)return this._pointToMarker(r[0]);for(n=0,s=r.length;n<s;n++)l=r[n],i+=(n?"L":"M")+l.x+" "+l.y;i+=e?"z":""}return i||"M0 0"}}),pt=L.FeatureGroup.extend({initialize:function(t,e){e.wrappers&&0<e.wrappers.length&&(e=Object.assign(M.Feature.prototype._convertWrappers(e.wrappers),e)),L.LayerGroup.prototype.initialize.call(this,t,e),(this.options.onEachFeature&&this.options.properties||this.options.link)&&(L.DomUtil.addClass(this.options.group,"leaflet-interactive"),L.DomEvent.on(this.options.group,"keyup keydown mousedown",this._handleFocus,this),e=t[Object.keys(t)[0]],1===t.length&&e.options.link&&(this.options.link=e.options.link),this.options.link?(M.Feature.prototype.attachLinkHandler.call(this,this.options.group,this.options.link,this.options._leafletLayer),this.options.group.setAttribute("role","link")):(this.options.group.setAttribute("aria-expanded","false"),this.options.group.setAttribute("role","button"),this.options.onEachFeature(this.options.properties,this),this.off("click",this._openPopup))),this.options.group.setAttribute("aria-label",this.options.accessibleTitle),this.options.featureID&&this.options.group.setAttribute("data-fid",this.options.featureID)},onAdd:function(t){L.LayerGroup.prototype.onAdd.call(this,t),this.updateInteraction()},updateInteraction:function(){let e=this._map||this.options._leafletLayer._map;for(var i in(this.options.onEachFeature&&this.options.properties||this.options.link)&&e.featureIndex.addToIndex(this,this.getPCRSCenter(),this.options.group),this._layers){let t=this._layers[i];for(var o of t._parts){t.featureAttributes&&t.featureAttributes.tabindex&&e.featureIndex.addToIndex(t,t.getPCRSCenter(),o.path);for(var n of o.subrings)n.attr&&n.attr.tabindex&&e.featureIndex.addToIndex(t,n.center,n.path)}}},_handleFocus:function(t){var e;9!==t.keyCode&&16!==t.keyCode||"keydown"!==t.type?[9,16,13,27].includes(t.keyCode)||(this._map.featureIndex.currentIndex=0,this._map.featureIndex.inBoundFeatures[0].path.focus()):(e=this._map.featureIndex.currentIndex,9===t.keyCode&&t.shiftKey?(e===this._map.featureIndex.inBoundFeatures.length-1&&this._map.featureIndex.inBoundFeatures[e].path.setAttribute("tabindex",-1),0!==e&&(L.DomEvent.stop(t),this._map.featureIndex.inBoundFeatures[e-1].path.focus(),this._map.featureIndex.currentIndex--)):9===t.keyCode&&(e!==this._map.featureIndex.inBoundFeatures.length-1?(L.DomEvent.stop(t),this._map.featureIndex.inBoundFeatures[e+1].path.focus(),this._map.featureIndex.currentIndex++):(this._map.featureIndex.inBoundFeatures[0].path.setAttribute("tabindex",-1),this._map.featureIndex.inBoundFeatures[e].path.setAttribute("tabindex",0)))),"G"===t.target.tagName.toUpperCase()&&(9!==t.keyCode&&16!==t.keyCode&&13!==t.keyCode||"keyup"!==t.type?13===t.keyCode||32===t.keyCode?(this.closeTooltip(),!this.options.link&&this.options.onEachFeature&&(L.DomEvent.stop(t),this.openPopup())):this.closeTooltip():this.openTooltip())},addLayer:function(t){!t.options.link&&t.options.interactive&&this.options.onEachFeature(this.options.properties,t),L.FeatureGroup.prototype.addLayer.call(this,t)},_previousFeature:function(t){L.DomEvent.stop(t),this._map.featureIndex.currentIndex=Math.max(this._map.featureIndex.currentIndex-1,0);let e=this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];e.path.focus(),this._map.closePopup()},_nextFeature:function(t){L.DomEvent.stop(t),this._map.featureIndex.currentIndex=Math.min(this._map.featureIndex.currentIndex+1,this._map.featureIndex.inBoundFeatures.length-1);let e=this._map.featureIndex.inBoundFeatures[this._map.featureIndex.currentIndex];e.path.focus(),this._map.closePopup()},getPCRSCenter:function(){let e;for(var i in this._layers){let t=this._layers[i];e?e.extend(t.getPCRSCenter()):e=L.bounds(t.getPCRSCenter(),t.getPCRSCenter())}return e.getCenter()}}),ct=L.Handler.extend({addHooks:function(){this._map.on({layeradd:this.totalBounds,layerremove:this.totalBounds}),this._map.options.mapEl.addEventListener("moveend",this.announceBounds),this._map.dragging._draggable.addEventListener("dragstart",this.dragged),this._map.options.mapEl.addEventListener("mapfocused",this.focusAnnouncement)},removeHooks:function(){this._map.off({layeradd:this.totalBounds,layerremove:this.totalBounds}),this._map.options.mapEl.removeEventListener("moveend",this.announceBounds),this._map.dragging._draggable.removeEventListener("dragstart",this.dragged),this._map.options.mapEl.removeEventListener("mapfocused",this.focusAnnouncement)},focusAnnouncement:function(){let n=this;setTimeout(function(){let t=(n.querySelector(".mapml-web-map")?n.querySelector(".mapml-web-map"):n).shadowRoot.querySelector(".leaflet-container");var e=n._map.getZoom(),i=M.gcrsToTileMatrix(n);let o=M.options.locale.amZoom+" "+e+" "+M.options.locale.amColumn+" "+i[0]+" "+M.options.locale.amRow+" "+i[1];e===n._map._layersMaxZoom?o=M.options.locale.amMaxZoom+" "+o:e===n._map._layersMinZoom&&(o=M.options.locale.amMinZoom+" "+o),t.setAttribute("aria-roledescription","region "+o),setTimeout(function(){t.removeAttribute("aria-roledescription")},2e3)},0)},announceBounds:function(){if(!(0<this._traversalCall)){var i=this._map.getZoom(),o=M.pixelToPCRSBounds(this._map.getPixelBounds(),i,this._map.options.projection);let t=!0;this._map.totalLayerBounds&&(t=i<=this._map._layersMaxZoom&&i>=this._map._layersMinZoom&&this._map.totalLayerBounds.overlaps(o));let e=(this.querySelector(".mapml-web-map")?this.querySelector(".mapml-web-map"):this).shadowRoot.querySelector(".mapml-screen-reader-output");var n,o=M.gcrsToTileMatrix(this),o=M.options.locale.amZoom+" "+i+" "+M.options.locale.amColumn+" "+o[0]+" "+M.options.locale.amRow+" "+o[1];t?(n=(this._history[this._historyIndex-1]?this._history[this._historyIndex-1]:this._history[this._historyIndex]).zoom,i===this._map._layersMaxZoom&&i!==n?e.innerText=M.options.locale.amMaxZoom+" "+o:i===this._map._layersMinZoom&&i!==n?e.innerText=M.options.locale.amMinZoom+" "+o:e.innerText=o):(n=this._history[this._historyIndex],o=this._history[this._historyIndex-1],this.back(),this._history.pop(),n.zoom!==o.zoom?e.innerText=M.options.locale.amZoomedOut:this._map.dragging._draggable.wasDragged?e.innerText=M.options.locale.amDraggedOut:n.x>o.x?e.innerText=M.options.locale.amEastBound:n.x<o.x?e.innerText=M.options.locale.amWestBound:n.y<o.y?e.innerText=M.options.locale.amNorthBound:n.y>o.y&&(e.innerText=M.options.locale.amSouthBound)),this._map.dragging._draggable.wasDragged=!1}},totalBounds:function(){let t=Object.keys(this._layers),i=L.bounds();t.forEach(t=>{var e;this._layers[t].layerBounds&&(i||(e=this._layers[t].layerBounds.getCenter(),i=L.bounds(e,e)),i.extend(this._layers[t].layerBounds.min),i.extend(this._layers[t].layerBounds.max))}),this.totalLayerBounds=i},dragged:function(){this.wasDragged=!0}}),ht=L.Handler.extend({initialize:function(t){L.Handler.prototype.initialize.call(this,t),this.inBoundFeatures=[],this.outBoundFeatures=[],this.currentIndex=0,this._mapPCRSBounds=M.pixelToPCRSBounds(t.getPixelBounds(),t.getZoom(),t.options.projection)},addHooks:function(){this._map.on("mapkeyboardfocused",this._updateMapBounds,this),this._map.on("mapkeyboardfocused",this._sortIndex,this)},removeHooks:function(){this._map.off("mapkeyboardfocused",this._updateMapBounds),this._map.off("mapkeyboardfocused",this._sortIndex)},addToIndex:function(t,e,i){var o=this._mapPCRSBounds.getCenter(),o=Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2));let n=this._mapPCRSBounds.contains(e)?this.inBoundFeatures:this.outBoundFeatures;o={path:i,layer:t,center:e,dist:o};i.setAttribute("tabindex",-1),n.push(o);for(let t=n.length-1;0<t&&n[t].dist<n[t-1].dist;t--){var a=n[t];n[t]=n[t-1],n[t-1]=a}this._mapPCRSBounds.contains(e)?this.inBoundFeatures=n:this.outBoundFeatures=n},cleanIndex:function(){this.currentIndex=0,this.inBoundFeatures=this.inBoundFeatures.filter(t=>{var e=this._mapPCRSBounds.contains(t.center);return t.path.setAttribute("tabindex",-1),t.layer._map&&!e&&this.outBoundFeatures.push(t),t.layer._map&&e}),this.outBoundFeatures=this.outBoundFeatures.filter(t=>{var e=this._mapPCRSBounds.contains(t.center);return t.path.setAttribute("tabindex",-1),t.layer._map&&e&&this.inBoundFeatures.push(t),t.layer._map&&!e})},_sortIndex:function(){if(this.cleanIndex(),0!==this.inBoundFeatures.length){let n=this._mapPCRSBounds.getCenter();this.inBoundFeatures.sort(function(t,e){var i=t.center,o=e.center;return t.dist=Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)),e.dist=Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2)),t.dist-e.dist}),this.inBoundFeatures[0].path.setAttribute("tabindex",0)}},_updateMapBounds:function(t){this._mapPCRSBounds=M.pixelToPCRSBounds(this._map.getPixelBounds(),this._map.getZoom(),this._map.options.projection)}}),dt={announceMovement:!1,locale:{cmBack:"Back",cmForward:"Forward",cmReload:"Reload",cmToggleControls:"Toggle Controls",cmCopyCoords:"Copy Coordinates",cmToggleDebug:"Toggle Debug Mode",cmCopyMapML:"Copy MapML",cmViewSource:"View Map Source",cmCopyAll:"All",lmZoomToLayer:"Zoom To Layer",lmCopyExtent:"Copy Extent",lcOpacity:"Opacity",btnZoomIn:"Zoom in",btnZoomOut:"Zoom out",btnFullScreen:"View fullscreen",amZoom:"zoom level",amColumn:"column",amRow:"row",amMaxZoom:"At maximum zoom level, zoom in disabled",amMinZoom:"At minimum zoom level, zoom out disabled",amZoomedOut:"Zoomed out of bounds, returning to",amDraggedOut:"Dragged out of bounds, returning to",amEastBound:"Reached east bound, panning east disabled",amWestBound:"Reached west bound, panning west disabled",amNorthBound:"Reached north bound, panning north disabled",amSouthBound:"Reached south bound, panning south disabled"}};L.Map.Keyboard.include({_onKeyDown:function(t){if(!t.altKey&&!t.metaKey){var e,i=t.keyCode,o=this._map;if(i in this._panKeys)o._panAnim&&o._panAnim._inProgress||(e=this._panKeys[i],t.shiftKey&&(e=L.point(e).multiplyBy(3)),t.ctrlKey&&(e=L.point(e).divideBy(5)),o.panBy(e),o.options.maxBounds&&o.panInsideBounds(o.options.maxBounds));else if(i in this._zoomKeys)(i in{187:187,107:107,61:61,171:171}&&o._layersMaxZoom!==o.getZoom()||i in{189:189,109:109,54:54,173:173}&&o._layersMinZoom!==o.getZoom())&&o.setZoom(o.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!o._popup||!o._popup.options.closeOnEscapeKey)return;o.closePopup()}L.DomEvent.stop(t)}}}),st=window,rt={},st.M=rt,function(){rt.detectImagePath=function(t){var e=L.DomUtil.create("div","leaflet-default-icon-path",t),i=L.DomUtil.getStyle(e,"background-image")||L.DomUtil.getStyle(e,"backgroundImage");return t.removeChild(e),i=null===i||0!==i.indexOf("url")?"":i.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")},rt.mime="text/mapml";var t=st.document.head.querySelector("map-options");rt.options=dt,t&&(rt.options=Object.assign(rt.options,JSON.parse(t.innerHTML))),rt.WGS84=new L.Proj.CRS("EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ",{origin:[-180,90],bounds:L.bounds([[-180,-90],[180,90]]),resolutions:[.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.0003433227539062,.0001716613769531,858306884766e-16,429153442383e-16,214576721191e-16,107288360596e-16,53644180298e-16,26822090149e-16,13411045074e-16,6.705522537e-7,3.352761269e-7],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>(rt.WGS84.options.bounds.getSize().x/rt.WGS84.options.resolutions[t]).toFixed()},vertical:{name:"y",min:0,max:t=>(rt.WGS84.options.bounds.getSize().y/rt.WGS84.options.resolutions[t]).toFixed()},bounds:t=>L.bounds([rt.WGS84.options.crs.tcrs.horizontal.min,rt.WGS84.options.crs.tcrs.vertical.min],[rt.WGS84.options.crs.tcrs.horizontal.max(t),rt.WGS84.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"longitude",get min(){return rt.WGS84.options.crs.gcrs.horizontal.min},get max(){return rt.WGS84.options.crs.gcrs.horizontal.max}},vertical:{name:"latitude",get min(){return rt.WGS84.options.crs.gcrs.vertical.min},get max(){return rt.WGS84.options.crs.gcrs.vertical.max}},get bounds(){return rt.WGS84.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-180,max:180},vertical:{name:"latitude",min:-90,max:90},get bounds(){return L.latLngBounds([rt.WGS84.options.crs.gcrs.vertical.min,rt.WGS84.options.crs.gcrs.horizontal.min],[rt.WGS84.options.crs.gcrs.vertical.max,rt.WGS84.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([rt.WGS84.options.crs.tile.horizontal.min,rt.WGS84.options.crs.tile.vertical.min],[rt.WGS84.options.crs.tile.horizontal.max,rt.WGS84.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>(rt.WGS84.options.crs.tcrs.horizontal.max(t)/rt.WGS84.options.crs.tile.bounds.getSize().x).toFixed()},vertical:{name:"row",min:0,max:t=>(rt.WGS84.options.crs.tcrs.vertical.max(t)/rt.WGS84.options.crs.tile.bounds.getSize().y).toFixed()},bounds:t=>L.bounds([rt.WGS84.options.crs.tilematrix.horizontal.min,rt.WGS84.options.crs.tilematrix.vertical.min],[rt.WGS84.options.crs.tilematrix.horizontal.max(t),rt.WGS84.options.crs.tilematrix.vertical.max(t)])}}}),rt.CBMTILE=new L.Proj.CRS("EPSG:3978","+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",{origin:[-34655800,3931e4],bounds:L.bounds([[-34655800,-39e6],[1e7,3931e4]]),resolutions:[38364.660062653464,22489.62831258996,13229.193125052918,7937.5158750317505,4630.2175937685215,2645.8386250105837,1587.5031750063501,926.0435187537042,529.1677250021168,317.50063500127004,185.20870375074085,111.12522225044451,66.1459656252646,38.36466006265346,22.48962831258996,13.229193125052918,7.9375158750317505,4.6302175937685215,2.6458386250105836,1.5875031750063502,.9260435187537043,.5291677250021167,.31750063500127,.18520870375074083,.11112522225044451,.06614596562526459],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>(rt.CBMTILE.options.bounds.getSize().x/rt.CBMTILE.options.resolutions[t]).toFixed()},vertical:{name:"y",min:0,max:t=>(rt.CBMTILE.options.bounds.getSize().y/rt.CBMTILE.options.resolutions[t]).toFixed()},bounds:t=>L.bounds([rt.CBMTILE.options.crs.tcrs.horizontal.min,rt.CBMTILE.options.crs.tcrs.vertical.min],[rt.CBMTILE.options.crs.tcrs.horizontal.max(t),rt.CBMTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return rt.CBMTILE.options.bounds.min.x},get max(){return rt.CBMTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return rt.CBMTILE.options.bounds.min.y},get max(){return rt.CBMTILE.options.bounds.max.y}},get bounds(){return rt.CBMTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-141.01,max:-47.74},vertical:{name:"latitude",min:40.04,max:86.46},get bounds(){return L.latLngBounds([rt.CBMTILE.options.crs.gcrs.vertical.min,rt.CBMTILE.options.crs.gcrs.horizontal.min],[rt.CBMTILE.options.crs.gcrs.vertical.max,rt.CBMTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([rt.CBMTILE.options.crs.tile.horizontal.min,rt.CBMTILE.options.crs.tile.vertical.min],[rt.CBMTILE.options.crs.tile.horizontal.max,rt.CBMTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>(rt.CBMTILE.options.crs.tcrs.horizontal.max(t)/rt.CBMTILE.options.crs.tile.bounds.getSize().x).toFixed()},vertical:{name:"row",min:0,max:t=>(rt.CBMTILE.options.crs.tcrs.vertical.max(t)/rt.CBMTILE.options.crs.tile.bounds.getSize().y).toFixed()},bounds:t=>L.bounds([0,0],[rt.CBMTILE.options.crs.tilematrix.horizontal.max(t),rt.CBMTILE.options.crs.tilematrix.vertical.max(t)])}}}),rt.APSTILE=new L.Proj.CRS("EPSG:5936","+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs",{origin:[-28567784.109255,32567784.109255],bounds:L.bounds([[-28567784.109254867,-28567784.109254755],[32567784.109255023,32567784.10925506]]),resolutions:[238810.813354,119405.406677,59702.7033384999,29851.3516692501,14925.675834625,7462.83791731252,3731.41895865639,1865.70947932806,932.854739664032,466.427369832148,233.213684916074,116.606842458037,58.3034212288862,29.1517106145754,14.5758553072877,7.28792765351156,3.64396382688807,1.82198191331174,.910990956788164,.45549547826179],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>(rt.APSTILE.options.bounds.getSize().x/rt.APSTILE.options.resolutions[t]).toFixed()},vertical:{name:"y",min:0,max:t=>(rt.APSTILE.options.bounds.getSize().y/rt.APSTILE.options.resolutions[t]).toFixed()},bounds:t=>L.bounds([rt.APSTILE.options.crs.tcrs.horizontal.min,rt.APSTILE.options.crs.tcrs.vertical.min],[rt.APSTILE.options.crs.tcrs.horizontal.max(t),rt.APSTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return rt.APSTILE.options.bounds.min.x},get max(){return rt.APSTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return rt.APSTILE.options.bounds.min.y},get max(){return rt.APSTILE.options.bounds.max.y}},get bounds(){return rt.APSTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",min:-180,max:180},vertical:{name:"latitude",min:60,max:90},get bounds(){return L.latLngBounds([rt.APSTILE.options.crs.gcrs.vertical.min,rt.APSTILE.options.crs.gcrs.horizontal.min],[rt.APSTILE.options.crs.gcrs.vertical.max,rt.APSTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([rt.APSTILE.options.crs.tile.horizontal.min,rt.APSTILE.options.crs.tile.vertical.min],[rt.APSTILE.options.crs.tile.horizontal.max,rt.APSTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>(rt.APSTILE.options.crs.tcrs.horizontal.max(t)/rt.APSTILE.options.crs.tile.bounds.getSize().x).toFixed()},vertical:{name:"row",min:0,max:t=>(rt.APSTILE.options.crs.tcrs.vertical.max(t)/rt.APSTILE.options.crs.tile.bounds.getSize().y).toFixed()},bounds:t=>L.bounds([0,0],[rt.APSTILE.options.crs.tilematrix.horizontal.max(t),rt.APSTILE.options.crs.tilematrix.vertical.max(t)])}}}),rt.OSMTILE=L.CRS.EPSG3857,L.setOptions(rt.OSMTILE,{origin:[-20037508.342787,20037508.342787],bounds:L.bounds([[-20037508.342787,-20037508.342787],[20037508.342787,20037508.342787]]),resolutions:[156543.0339,78271.51695,39135.758475,19567.8792375,9783.93961875,4891.969809375,2445.9849046875,1222.9924523438,611.49622617188,305.74811308594,152.87405654297,76.437028271484,38.218514135742,19.109257067871,9.5546285339355,4.7773142669678,2.3886571334839,1.1943285667419,.59716428337097,.29858214168549,.14929107084274,.074645535421371,.03732276771068573,.018661383855342866,.009330691927671433],crs:{tcrs:{horizontal:{name:"x",min:0,max:t=>(rt.OSMTILE.options.bounds.getSize().x/rt.OSMTILE.options.resolutions[t]).toFixed()},vertical:{name:"y",min:0,max:t=>(rt.OSMTILE.options.bounds.getSize().y/rt.OSMTILE.options.resolutions[t]).toFixed()},bounds:t=>L.bounds([rt.OSMTILE.options.crs.tcrs.horizontal.min,rt.OSMTILE.options.crs.tcrs.vertical.min],[rt.OSMTILE.options.crs.tcrs.horizontal.max(t),rt.OSMTILE.options.crs.tcrs.vertical.max(t)])},pcrs:{horizontal:{name:"easting",get min(){return rt.OSMTILE.options.bounds.min.x},get max(){return rt.OSMTILE.options.bounds.max.x}},vertical:{name:"northing",get min(){return rt.OSMTILE.options.bounds.min.y},get max(){return rt.OSMTILE.options.bounds.max.y}},get bounds(){return rt.OSMTILE.options.bounds}},gcrs:{horizontal:{name:"longitude",get min(){return rt.OSMTILE.unproject(rt.OSMTILE.options.bounds.min).lng},get max(){return rt.OSMTILE.unproject(rt.OSMTILE.options.bounds.max).lng}},vertical:{name:"latitude",get min(){return rt.OSMTILE.unproject(rt.OSMTILE.options.bounds.min).lat},get max(){return rt.OSMTILE.unproject(rt.OSMTILE.options.bounds.max).lat}},get bounds(){return L.latLngBounds([rt.OSMTILE.options.crs.gcrs.vertical.min,rt.OSMTILE.options.crs.gcrs.horizontal.min],[rt.OSMTILE.options.crs.gcrs.vertical.max,rt.OSMTILE.options.crs.gcrs.horizontal.max])}},map:{horizontal:{name:"i",min:0,max:t=>t.getSize().x},vertical:{name:"j",min:0,max:t=>t.getSize().y},bounds:t=>L.bounds(L.point([0,0]),t.getSize())},tile:{horizontal:{name:"i",min:0,max:256},vertical:{name:"j",min:0,max:256},get bounds(){return L.bounds([rt.OSMTILE.options.crs.tile.horizontal.min,rt.OSMTILE.options.crs.tile.vertical.min],[rt.OSMTILE.options.crs.tile.horizontal.max,rt.OSMTILE.options.crs.tile.vertical.max])}},tilematrix:{horizontal:{name:"column",min:0,max:t=>(rt.OSMTILE.options.crs.tcrs.horizontal.max(t)/rt.OSMTILE.options.crs.tile.bounds.getSize().x).toFixed()},vertical:{name:"row",min:0,max:t=>(rt.OSMTILE.options.crs.tcrs.vertical.max(t)/rt.OSMTILE.options.crs.tile.bounds.getSize().y).toFixed()},bounds:t=>L.bounds([0,0],[rt.OSMTILE.options.crs.tilematrix.horizontal.max(t),rt.OSMTILE.options.crs.tilematrix.vertical.max(t)])}}})}(),rt.handleLink=Q,rt.convertPCRSBounds=Z,rt.axisToXY=O,rt.csToAxes=R,rt.convertAndFormatPCRS=D,rt.axisToCS=q,rt.parseNumber=Y,rt.extractInputBounds=N,rt.splitCoordinate=K,rt.boundsToPCRSBounds=V,rt.pixelToPCRSBounds=G,rt.metaContentToObject=H,rt.coordsToArray=$,rt.parseStylesheetAsHTML=W,rt.pointToPCRSPoint=U,rt.pixelToPCRSPoint=j,rt.gcrsToTileMatrix=X,rt.QueryHandler=w,rt.ContextMenu=F,rt.AnnounceMovement=ct,rt.FeatureIndex=ht,L.Map.addInitHook("addHandler","query",rt.QueryHandler),L.Map.addInitHook("addHandler","contextMenu",rt.ContextMenu),L.Map.addInitHook("addHandler","announceMovement",rt.AnnounceMovement),L.Map.addInitHook("addHandler","featureIndex",rt.FeatureIndex),rt.MapMLLayer=b,rt.mapMLLayer=u,rt.ImageOverlay=f,rt.imageOverlay=m,rt.TemplatedImageLayer=g,rt.templatedImageLayer=l,rt.TemplatedFeaturesLayer=x,rt.templatedFeaturesLayer=r,rt.TemplatedLayer=y,rt.templatedLayer=s,rt.TemplatedTileLayer=_,rt.templatedTileLayer=a,rt.MapMLFeatures=h,rt.mapMlFeatures=n,rt.MapMLLayerControl=o,rt.mapMlLayerControl=e,rt.ReloadButton=J,rt.reloadButton=c,rt.FullscreenButton=tt,rt.fullscreenButton=et,rt.MapMLStaticTileLayer=i,rt.mapMLStaticTileLayer=t,rt.DebugOverlay=v,rt.debugOverlay=p,rt.Crosshair=lt,rt.crosshair=it,rt.Feature=mt,rt.feature=ot,rt.FeatureRenderer=ut,rt.featureRenderer=nt,rt.FeatureGroup=pt,rt.featureGroup=at}();